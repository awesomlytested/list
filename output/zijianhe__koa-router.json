{"repo":"ZijianHe/koa-router","url":"https://github.com/ZijianHe/koa-router","branch":"master","configs":[{"package":"koa-router","lang":"js","dir":"test","framework":"mocha","pattern":"**/*.{js,ts}"}],"tests":[{"name":"should expose Router","suites":["module"],"updatePoint":{"line":8,"column":26,"index":143},"line":8,"code":"  it('should expose Router', function (done) {\n    var Router = require('..');\n\n    should.exist(Router);\n    Router.should.be.type('function');\n    done();\n  });","file":"index.js","skipped":false,"dir":"test"},{"name":"composes multiple callbacks/middlware","suites":["Layer"],"updatePoint":{"line":12,"column":43,"index":304},"line":12,"code":"  it('composes multiple callbacks/middlware', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/:category/:title', function (ctx, next) {\n      ctx.status = 500;\n      return next();\n    }, function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    });\n    request(http.createServer(app.callback())).get('/programming/how-to-node').expect(204).end(function (err) {\n      if (err) return done(err);\n      done();\n    });\n  });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"captures URL path parameters","suites":["Layer","Layer#match()"],"updatePoint":{"line":29,"column":36,"index":849},"line":29,"code":"    it('captures URL path parameters', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('/:category/:title', function (ctx) {\n        ctx.should.have.property('params');\n        ctx.params.should.be.type('object');\n        ctx.params.should.have.property('category', 'match');\n        ctx.params.should.have.property('title', 'this');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/match/this').expect(204).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"return orginal path parameters when decodeURIComponent throw error","suites":["Layer","Layer#match()"],"updatePoint":{"line":45,"column":74,"index":1511},"line":45,"code":"    it('return orginal path parameters when decodeURIComponent throw error', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('/:category/:title', function (ctx) {\n        ctx.should.have.property('params');\n        ctx.params.should.be.type('object');\n        ctx.params.should.have.property('category', '100%');\n        ctx.params.should.have.property('title', '101%');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/100%/101%').expect(204).end(done);\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"populates ctx.captures with regexp captures","suites":["Layer","Layer#match()"],"updatePoint":{"line":58,"column":51,"index":2072},"line":58,"code":"    it('populates ctx.captures with regexp captures', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api\\/([^\\/]+)\\/?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.instanceOf(Array);\n        ctx.captures.should.have.property(0, '1');\n        return next();\n      }, function (ctx) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.instanceOf(Array);\n        ctx.captures.should.have.property(0, '1');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api/1').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"return orginal ctx.captures when decodeURIComponent throw error","suites":["Layer","Layer#match()"],"updatePoint":{"line":78,"column":71,"index":2864},"line":78,"code":"    it('return orginal ctx.captures when decodeURIComponent throw error', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api\\/([^\\/]+)\\/?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, '101%');\n        return next();\n      }, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, '101%');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api/101%').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"populates ctx.captures with regexp captures include undefiend","suites":["Layer","Layer#match()"],"updatePoint":{"line":98,"column":69,"index":3663},"line":98,"code":"    it('populates ctx.captures with regexp captures include undefiend', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api(\\/.+)?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, undefined);\n        return next();\n      }, function (ctx) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, undefined);\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"should throw friendly error message when handle not exists","suites":["Layer","Layer#match()"],"updatePoint":{"line":118,"column":66,"index":4448},"line":118,"code":"    it('should throw friendly error message when handle not exists', function () {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      var notexistHandle = undefined;\n      (function () {\n        router.get('/foo', notexistHandle);\n      }).should.throw('get `/foo`: `middleware` must be a function, not `undefined`');\n      (function () {\n        router.get('foo router', '/foo', notexistHandle);\n      }).should.throw('get `foo router`: `middleware` must be a function, not `undefined`');\n      (function () {\n        router.post('/foo', function () {}, notexistHandle);\n      }).should.throw('post `/foo`: `middleware` must be a function, not `undefined`');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"composes middleware for param fn","suites":["Layer","Layer#param()"],"updatePoint":{"line":135,"column":40,"index":5185},"line":135,"code":"    it('composes middleware for param fn', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var route = new Layer('/users/:user', ['GET'], [function (ctx) {\n        ctx.body = ctx.user;\n      }]);\n      route.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      router.stack.push(route);\n      app.use(router.middleware());\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"ignores params which are not matched","suites":["Layer","Layer#param()"],"updatePoint":{"line":157,"column":44,"index":5941},"line":157,"code":"    it('ignores params which are not matched', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var route = new Layer('/users/:user', ['GET'], [function (ctx) {\n        ctx.body = ctx.user;\n      }]);\n      route.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      route.param('title', function (id, ctx, next) {\n        ctx.user = {\n          name: 'mark'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      router.stack.push(route);\n      app.use(router.middleware());\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"generates route URL","suites":["Layer","Layer#url()"],"updatePoint":{"line":188,"column":27,"index":6910},"line":188,"code":"    it('generates route URL', function () {\n      var route = new Layer('/:category/:title', ['get'], [function () {}], 'books');\n      var url = route.url({\n        category: 'programming',\n        title: 'how-to-node'\n      });\n      url.should.equal('/programming/how-to-node');\n      url = route.url('programming', 'how-to-node');\n      url.should.equal('/programming/how-to-node');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"escapes using encodeURIComponent()","suites":["Layer","Layer#url()"],"updatePoint":{"line":198,"column":42,"index":7320},"line":198,"code":"    it('escapes using encodeURIComponent()', function () {\n      var route = new Layer('/:category/:title', ['get'], [function () {}], 'books');\n      var url = route.url({\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"creates new router with koa app","suites":["Router"],"updatePoint":{"line":16,"column":37,"index":421},"line":16,"code":"  it('creates new router with koa app', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.should.be.instanceOf(Router);\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"shares context between routers (gh-205)","suites":["Router"],"updatePoint":{"line":22,"column":45,"index":602},"line":22,"code":"  it('shares context between routers (gh-205)', function (done) {\n    var app = new Koa();\n    var router1 = new Router();\n    var router2 = new Router();\n    router1.get('/', function (ctx, next) {\n      ctx.foo = 'bar';\n      return next();\n    });\n    router2.get('/', function (ctx, next) {\n      ctx.baz = 'qux';\n      ctx.body = {\n        foo: ctx.foo\n      };\n      return next();\n    });\n    app.use(router1.routes()).use(router2.routes());\n    request(http.createServer(app.callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('foo', 'bar');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not register middleware more than once (gh-184)","suites":["Router"],"updatePoint":{"line":44,"column":58,"index":1274},"line":44,"code":"  it('does not register middleware more than once (gh-184)', function (done) {\n    var app = new Koa();\n    var parentRouter = new Router();\n    var nestedRouter = new Router();\n    nestedRouter.get('/first-nested-route', function (ctx, next) {\n      ctx.body = {\n        n: ctx.n\n      };\n    }).get('/second-nested-route', function (ctx, next) {\n      return next();\n    }).get('/third-nested-route', function (ctx, next) {\n      return next();\n    });\n    parentRouter.use('/parent-route', function (ctx, next) {\n      ctx.n = ctx.n ? ctx.n + 1 : 1;\n      return next();\n    }, nestedRouter.routes());\n    app.use(parentRouter.routes());\n    request(http.createServer(app.callback())).get('/parent-route/first-nested-route').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('n', 1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"router can be accecced with ctx","suites":["Router"],"updatePoint":{"line":68,"column":37,"index":2129},"line":68,"code":"  it('router can be accecced with ctx', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('home', '/', function (ctx) {\n      ctx.body = {\n        url: ctx.router.url('home')\n      };\n    });\n    app.use(router.routes());\n    request(http.createServer(app.callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body.url).to.eql(\"/\");\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers multiple middleware for one route","suites":["Router"],"updatePoint":{"line":83,"column":49,"index":2597},"line":83,"code":"  it('registers multiple middleware for one route', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('/double', function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body = {\n            message: 'Hello'\n          };\n          resolve(next());\n        }, 1);\n      });\n    }, function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body.message += ' World';\n          resolve(next());\n        }, 1);\n      });\n    }, function (ctx, next) {\n      ctx.body.message += '!';\n    });\n    app.use(router.routes());\n    request(http.createServer(app.callback())).get('/double').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body.message).to.eql('Hello World!');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not break when nested-routes use regexp paths","suites":["Router"],"updatePoint":{"line":112,"column":56,"index":3507},"line":112,"code":"  it('does not break when nested-routes use regexp paths', function (done) {\n    var app = new Koa();\n    var parentRouter = new Router();\n    var nestedRouter = new Router();\n    nestedRouter.get(/^\\/\\w$/i, function (ctx, next) {\n      return next();\n    }).get('/first-nested-route', function (ctx, next) {\n      return next();\n    }).get('/second-nested-route', function (ctx, next) {\n      return next();\n    });\n    parentRouter.use('/parent-route', function (ctx, next) {\n      return next();\n    }, nestedRouter.routes());\n    app.use(parentRouter.routes());\n    app.should.be.ok;\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"exposes middleware factory","suites":["Router"],"updatePoint":{"line":130,"column":32,"index":4089},"line":130,"code":"  it('exposes middleware factory', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.should.have.property('routes');\n    router.routes.should.be.type('function');\n    var middleware = router.routes();\n    should.exist(middleware);\n    middleware.should.be.type('function');\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports promises for async/await","suites":["Router"],"updatePoint":{"line":140,"column":39,"index":4423},"line":140,"code":"  it('supports promises for async/await', function (done) {\n    var app = new Koa();\n    app.experimental = true;\n    var router = Router();\n    router.get('/async', function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body = {\n            msg: 'promises!'\n          };\n          resolve();\n        }, 1);\n      });\n    });\n    app.use(router.routes()).use(router.allowedMethods());\n    request(http.createServer(app.callback())).get('/async').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'promises!');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches middleware only if route was matched (gh-182)","suites":["Router"],"updatePoint":{"line":161,"column":59,"index":5118},"line":161,"code":"  it('matches middleware only if route was matched (gh-182)', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    var otherRouter = new Router();\n    router.use(function (ctx, next) {\n      ctx.body = {\n        bar: 'baz'\n      };\n      return next();\n    });\n    otherRouter.get('/bar', function (ctx) {\n      ctx.body = ctx.body || {\n        foo: 'bar'\n      };\n    });\n    app.use(router.routes()).use(otherRouter.routes());\n    request(http.createServer(app.callback())).get('/bar').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('foo', 'bar');\n      expect(res.body).to.not.have.property('bar');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches first to last","suites":["Router"],"updatePoint":{"line":184,"column":27,"index":5805},"line":184,"code":"  it('matches first to last', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('user_page', '/user/(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 1\n      };\n    }).all('app', '/app/(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 2\n      };\n    }).all('view', '(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 3\n      };\n    });\n    request(http.createServer(app.use(router.routes()).callback())).get('/user/account.jsx').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('order', 1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not run subsequent middleware without calling next","suites":["Router"],"updatePoint":{"line":206,"column":61,"index":6494},"line":206,"code":"  it('does not run subsequent middleware without calling next', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('user_page', '/user/(.*).jsx', function (ctx) {// no next()\n    }, function (ctx) {\n      ctx.body = {\n        order: 1\n      };\n    });\n    request(http.createServer(app.use(router.routes()).callback())).get('/user/account.jsx').expect(404).end(done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"nests routers with prefixes at root","suites":["Router"],"updatePoint":{"line":217,"column":41,"index":6886},"line":217,"code":"  it('nests routers with prefixes at root', function (done) {\n    var app = new Koa();\n    var api = new Router();\n    var forums = new Router({\n      prefix: '/forums'\n    });\n    var posts = new Router({\n      prefix: '/:fid/posts'\n    });\n    var server;\n    posts.get('/', function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    }).get('/:pid', function (ctx, next) {\n      ctx.body = ctx.params;\n      return next();\n    });\n    forums.use(posts.routes());\n    server = http.createServer(app.use(forums.routes()).callback());\n    request(server).get('/forums/1/posts').expect(204).end(function (err) {\n      if (err) return done(err);\n      request(server).get('/forums/1').expect(404).end(function (err) {\n        if (err) return done(err);\n        request(server).get('/forums/1/posts/2').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('fid', '1');\n          expect(res.body).to.have.property('pid', '2');\n          done();\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"nests routers with prefixes at path","suites":["Router"],"updatePoint":{"line":249,"column":41,"index":7941},"line":249,"code":"  it('nests routers with prefixes at path', function (done) {\n    var app = new Koa();\n    var api = new Router();\n    var forums = new Router({\n      prefix: '/api'\n    });\n    var posts = new Router({\n      prefix: '/posts'\n    });\n    var server;\n    posts.get('/', function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    }).get('/:pid', function (ctx, next) {\n      ctx.body = ctx.params;\n      return next();\n    });\n    forums.use('/forums/:fid', posts.routes());\n    server = http.createServer(app.use(forums.routes()).callback());\n    request(server).get('/api/forums/1/posts').expect(204).end(function (err) {\n      if (err) return done(err);\n      request(server).get('/api/forums/1').expect(404).end(function (err) {\n        if (err) return done(err);\n        request(server).get('/api/forums/1/posts/2').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('fid', '1');\n          expect(res.body).to.have.property('pid', '2');\n          done();\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs subrouter middleware after parent","suites":["Router"],"updatePoint":{"line":281,"column":44,"index":9019},"line":281,"code":"  it('runs subrouter middleware after parent', function (done) {\n    var app = new Koa();\n    var subrouter = Router().use(function (ctx, next) {\n      ctx.msg = 'subrouter';\n      return next();\n    }).get('/', function (ctx) {\n      ctx.body = {\n        msg: ctx.msg\n      };\n    });\n    var router = Router().use(function (ctx, next) {\n      ctx.msg = 'router';\n      return next();\n    }).use(subrouter.routes());\n    request(http.createServer(app.use(router.routes()).callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'subrouter');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parent middleware for subrouter routes","suites":["Router"],"updatePoint":{"line":301,"column":49,"index":9679},"line":301,"code":"  it('runs parent middleware for subrouter routes', function (done) {\n    var app = new Koa();\n    var subrouter = Router().get('/sub', function (ctx) {\n      ctx.body = {\n        msg: ctx.msg\n      };\n    });\n    var router = Router().use(function (ctx, next) {\n      ctx.msg = 'router';\n      return next();\n    }).use('/parent', subrouter.routes());\n    request(http.createServer(app.use(router.routes()).callback())).get('/parent/sub').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'router');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches corresponding requests","suites":["Router"],"updatePoint":{"line":318,"column":36,"index":10263},"line":318,"code":"  it('matches corresponding requests', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/:category/:title', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.params.should.have.property('title', 'how-to-node');\n      ctx.status = 204;\n    });\n    router.post('/:category', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.status = 204;\n    });\n    router.put('/:category/not-a-title', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.params.should.not.have.property('title');\n      ctx.status = 204;\n    });\n    var server = http.createServer(app.callback());\n    request(server).get('/programming/how-to-node').expect(204).end(function (err, res) {\n      if (err) return done(err);\n      request(server).post('/programming').expect(204).end(function (err, res) {\n        if (err) return done(err);\n        request(server).put('/programming/not-a-title').expect(204).end(function (err, res) {\n          done(err);\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"executes route middleware using `app.context`","suites":["Router"],"updatePoint":{"line":350,"column":51,"index":11556},"line":350,"code":"  it('executes route middleware using `app.context`', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.use(function (ctx, next) {\n      ctx.bar = 'baz';\n      return next();\n    });\n    router.get('/:category/:title', function (ctx, next) {\n      ctx.foo = 'bar';\n      return next();\n    }, function (ctx) {\n      ctx.should.have.property('bar', 'baz');\n      ctx.should.have.property('foo', 'bar');\n      ctx.should.have.property('app');\n      ctx.should.have.property('req');\n      ctx.should.have.property('res');\n      ctx.status = 204;\n      done();\n    });\n    request(http.createServer(app.callback())).get('/match/this').expect(204).end(function (err) {\n      if (err) return done(err);\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not match after ctx.throw()","suites":["Router"],"updatePoint":{"line":374,"column":38,"index":12319},"line":374,"code":"  it('does not match after ctx.throw()', function (done) {\n    var app = new Koa();\n    var counter = 0;\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/', function (ctx) {\n      counter++;\n      ctx.throw(403);\n    });\n    router.get('/', function () {\n      counter++;\n    });\n    var server = http.createServer(app.callback());\n    request(server).get('/').expect(403).end(function (err, res) {\n      if (err) return done(err);\n      counter.should.equal(1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports promises for route middleware","suites":["Router"],"updatePoint":{"line":393,"column":44,"index":12845},"line":393,"code":"  it('supports promises for route middleware', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n\n    var readVersion = function () {\n      return new Promise(function (resolve, reject) {\n        var packagePath = path.join(__dirname, '..', '..', 'package.json');\n        fs.readFile(packagePath, 'utf8', function (err, data) {\n          if (err) return reject(err);\n          resolve(JSON.parse(data).version);\n        });\n      });\n    };\n\n    router.get('/', function (ctx, next) {\n      return next();\n    }, function (ctx) {\n      return readVersion().then(function () {\n        ctx.status = 204;\n      });\n    });\n    request(http.createServer(app.callback())).get('/').expect(204).end(done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds to OPTIONS requests","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":418,"column":36,"index":13648},"line":418,"code":"    it('responds to OPTIONS requests', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function (ctx, next) {});\n      router.put('/users', function (ctx, next) {});\n      request(http.createServer(app.callback())).options('/users').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('content-length', '0');\n        res.header.should.have.property('allow', 'HEAD, GET, PUT');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 405 Method Not Allowed","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":432,"column":44,"index":14257},"line":432,"code":"    it('responds with 405 Method Not Allowed', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('allow', 'HEAD, GET, PUT');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 405 Method Not Allowed using the \"throw\" option","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":446,"column":69,"index":14852},"line":446,"code":"    it('responds with 405 Method Not Allowed using the \"throw\" option', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.name.should.equal('MethodNotAllowedError');\n          err.statusCode.should.equal(405); // translate the HTTPError to a normal response\n\n          ctx.body = err.name;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err); // the 'Allow' header is not set when throwing\n\n        res.header.should.not.have.property('allow');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with user-provided throwable using the \"throw\" and \"methodNotAllowed\" options","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":473,"column":94,"index":15918},"line":473,"code":"    it('responds with user-provided throwable using the \"throw\" and \"methodNotAllowed\" options', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.message.should.equal('Custom Not Allowed Error');\n          err.statusCode.should.equal(405); // translate the HTTPError to a normal response\n\n          ctx.body = err.body;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true,\n        methodNotAllowed: function () {\n          var notAllowedErr = new Error('Custom Not Allowed Error');\n          notAllowedErr.type = 'custom';\n          notAllowedErr.statusCode = 405;\n          notAllowedErr.body = {\n            error: 'Custom Not Allowed Error',\n            statusCode: 405,\n            otherStuff: true\n          };\n          return notAllowedErr;\n        }\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err); // the 'Allow' header is not set when throwing\n\n        res.header.should.not.have.property('allow');\n        res.body.should.eql({\n          error: 'Custom Not Allowed Error',\n          statusCode: 405,\n          otherStuff: true\n        });\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 501 Not Implemented","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":516,"column":41,"index":17464},"line":516,"code":"    it('responds with 501 Not Implemented', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 501 Not Implemented using the \"throw\" option","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":528,"column":66,"index":17944},"line":528,"code":"    it('responds with 501 Not Implemented using the \"throw\" option', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.name.should.equal('NotImplementedError');\n          err.statusCode.should.equal(501); // translate the HTTPError to a normal response\n\n          ctx.body = err.name;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err); // the 'Allow' header is not set when throwing\n\n        res.header.should.not.have.property('allow');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with user-provided throwable using the \"throw\" and \"notImplemented\" options","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":554,"column":92,"index":18962},"line":554,"code":"    it('responds with user-provided throwable using the \"throw\" and \"notImplemented\" options', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that our custom error was thrown\n          err.message.should.equal('Custom Not Implemented Error');\n          err.type.should.equal('custom');\n          err.statusCode.should.equal(501); // translate the HTTPError to a normal response\n\n          ctx.body = err.body;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true,\n        notImplemented: function () {\n          var notImplementedErr = new Error('Custom Not Implemented Error');\n          notImplementedErr.type = 'custom';\n          notImplementedErr.statusCode = 501;\n          notImplementedErr.body = {\n            error: 'Custom Not Implemented Error',\n            statusCode: 501,\n            otherStuff: true\n          };\n          return notImplementedErr;\n        }\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err); // the 'Allow' header is not set when throwing\n\n        res.header.should.not.have.property('allow');\n        res.body.should.eql({\n          error: 'Custom Not Implemented Error',\n          statusCode: 501,\n          otherStuff: true\n        });\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not send 405 if route matched but status is 404","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":597,"column":60,"index":20555},"line":597,"code":"    it('does not send 405 if route matched but status is 404', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function (ctx, next) {\n        ctx.status = 404;\n      });\n      request(http.createServer(app.callback())).get('/users').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"sets the allowed methods to a single Allow header #273","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":610,"column":62,"index":21026},"line":610,"code":"    it('sets the allowed methods to a single Allow header #273', function (done) {\n      // https://tools.ietf.org/html/rfc7231#section-7.4.1\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/', function (ctx, next) {});\n      request(http.createServer(app.callback())).options('/').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('allow', 'HEAD, GET');\n        let allowHeaders = res.res.rawHeaders.filter(item => item == 'Allow');\n        expect(allowHeaders.length).to.eql(1);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports custom routing detect path: ctx.routerPath","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":626,"column":57,"index":21707},"line":626,"code":"  it('supports custom routing detect path: ctx.routerPath', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(function (ctx, next) {\n      // bind helloworld.example.com/users => example.com/helloworld/users\n      var appname = ctx.request.hostname.split('.', 1)[0];\n      ctx.routerPath = '/' + appname + ctx.path;\n      return next();\n    });\n    app.use(router.routes());\n    router.get('/helloworld/users', function (ctx) {\n      ctx.body = ctx.method + ' ' + ctx.url;\n    });\n    request(http.createServer(app.callback())).get('/users').set('Host', 'helloworld.example.com').expect(200).expect('GET /users', done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route specific to HTTP verb","suites":["Router","Router#[verb]()"],"updatePoint":{"line":642,"column":45,"index":22401},"line":642,"code":"    it('registers route specific to HTTP verb', function () {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      methods.forEach(function (method) {\n        router.should.have.property(method);\n        router[method].should.be.type('function');\n        router[method]('/', function () {});\n      });\n      router.stack.should.have.length(methods.length);\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with a regexp path","suites":["Router","Router#[verb]()"],"updatePoint":{"line":653,"column":42,"index":22808},"line":653,"code":"    it('registers route with a regexp path', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](/^\\/\\w$/i, function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with a given name","suites":["Router","Router#[verb]()"],"updatePoint":{"line":659,"column":41,"index":23031},"line":659,"code":"    it('registers route with a given name', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](method, '/', function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with with a given name and regexp path","suites":["Router","Router#[verb]()"],"updatePoint":{"line":665,"column":62,"index":23277},"line":665,"code":"    it('registers route with with a given name and regexp path', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](method, /^\\/$/i, function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"enables route chaining","suites":["Router","Router#[verb]()"],"updatePoint":{"line":671,"column":30,"index":23495},"line":671,"code":"    it('enables route chaining', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method]('/', function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers array of paths (gh-203)","suites":["Router","Router#[verb]()"],"updatePoint":{"line":677,"column":41,"index":23712},"line":677,"code":"    it('registers array of paths (gh-203)', function () {\n      var router = new Router();\n      router.get(['/one', '/two'], function (ctx, next) {\n        return next();\n      });\n      expect(router.stack).to.have.property('length', 2);\n      expect(router.stack[0]).to.have.property('path', '/one');\n      expect(router.stack[1]).to.have.property('path', '/two');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"resolves non-parameterized routes without attached parameters","suites":["Router","Router#[verb]()"],"updatePoint":{"line":686,"column":69,"index":24116},"line":686,"code":"    it('resolves non-parameterized routes without attached parameters', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/notparameter', function (ctx, next) {\n        ctx.body = {\n          param: ctx.params.parameter\n        };\n      });\n      router.get('/:parameter', function (ctx, next) {\n        ctx.body = {\n          param: ctx.params.parameter\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/notparameter').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body.param).to.equal(undefined);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"uses router middleware without path","suites":["Router","Router#use()"],"updatePoint":{"line":708,"column":43,"index":24824},"line":708,"code":"    it('uses router middleware without path', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(function (ctx, next) {\n        ctx.foo = 'baz';\n        return next();\n      });\n      router.use(function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      });\n      router.get('/foo/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"uses router middleware at given path","suites":["Router","Router#use()"],"updatePoint":{"line":731,"column":44,"index":25534},"line":731,"code":"    it('uses router middleware at given path', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use('/foo/bar', function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      });\n      router.get('/foo/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs router middleware before subrouter middleware","suites":["Router","Router#use()"],"updatePoint":{"line":750,"column":58,"index":26172},"line":750,"code":"    it('runs router middleware before subrouter middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var subrouter = new Router();\n      router.use(function (ctx, next) {\n        ctx.foo = 'boo';\n        return next();\n      });\n      subrouter.use(function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      }).get('/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      router.use('/foo', subrouter.routes());\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"assigns middleware to array of paths","suites":["Router","Router#use()"],"updatePoint":{"line":774,"column":44,"index":26949},"line":774,"code":"    it('assigns middleware to array of paths', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(['/foo', '/bar'], function (ctx, next) {\n        ctx.foo = 'foo';\n        ctx.bar = 'bar';\n        return next();\n      });\n      router.get('/foo', function (ctx, next) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      router.get('/bar', function (ctx) {\n        ctx.body = {\n          foobar: 'foo' + ctx.bar\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        request(http.createServer(app.callback())).get('/bar').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('foobar', 'foobar');\n          done();\n        });\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"without path, does not set params.0 to the matched path - gh-247","suites":["Router","Router#use()"],"updatePoint":{"line":803,"column":72,"index":27965},"line":803,"code":"    it('without path, does not set params.0 to the matched path - gh-247', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(function (ctx, next) {\n        return next();\n      });\n      router.get('/foo/:id', function (ctx) {\n        ctx.body = ctx.params;\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/815').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('id', '815');\n        expect(res.body).to.not.have.property('0');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not add an erroneous (.*) to unprefiexed nested routers - gh-369 gh-410","suites":["Router","Router#use()"],"updatePoint":{"line":820,"column":84,"index":28602},"line":820,"code":"    it('does not add an erroneous (.*) to unprefiexed nested routers - gh-369 gh-410', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var nested = new Router();\n      var called = 0;\n      nested.get('/', (ctx, next) => {\n        ctx.body = 'root';\n        called += 1;\n        return next();\n      }).get('/test', (ctx, next) => {\n        ctx.body = 'test';\n        called += 1;\n        return next();\n      });\n      router.use(nested.routes());\n      app.use(router.routes());\n      request(app.callback()).get('/test').expect(200).expect('test').end(function (err, res) {\n        if (err) return done(err);\n        expect(called).to.eql(1, 'too many routes matched');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers new routes","suites":["Router","Router#register()"],"updatePoint":{"line":844,"column":28,"index":29341},"line":844,"code":"    it('registers new routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.should.have.property('register');\n      router.register.should.be.type('function');\n      var route = router.register('/', ['GET', 'POST'], function () {});\n      app.use(router.routes());\n      router.stack.should.be.an.instanceOf(Array);\n      router.stack.should.have.property('length', 1);\n      router.stack[0].should.have.property('path', '/');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers redirect routes","suites":["Router","Router#redirect()"],"updatePoint":{"line":858,"column":33,"index":29893},"line":858,"code":"    it('registers redirect routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.should.have.property('redirect');\n      router.redirect.should.be.type('function');\n      router.redirect('/source', '/destination', 302);\n      app.use(router.routes());\n      router.stack.should.have.property('length', 1);\n      router.stack[0].should.be.instanceOf(Layer);\n      router.stack[0].should.have.property('path', '/source');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"redirects using route names","suites":["Router","Router#redirect()"],"updatePoint":{"line":870,"column":35,"index":30383},"line":870,"code":"    it('redirects using route names', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('home', '/', function () {});\n      router.get('sign-up-form', '/sign-up-form', function () {});\n      router.redirect('home', 'sign-up-form');\n      request(http.createServer(app.callback())).post('/').expect(301).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('location', '/sign-up-form');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"inherits routes from nested router","suites":["Router","Router#route()"],"updatePoint":{"line":885,"column":42,"index":30984},"line":885,"code":"    it('inherits routes from nested router', function () {\n      var app = new Koa();\n      var subrouter = Router().get('child', '/hello', function (ctx) {\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var router = Router().use(subrouter.routes());\n      expect(router.route('child')).to.have.property('name', 'child');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name","suites":["Router","Router#url()"],"updatePoint":{"line":897,"column":42,"index":31387},"line":897,"code":"    it('generates URL for given route name', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('books', '/:category/:title', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('books', {\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n      url = router.url('books', 'programming', 'how to node');\n      url.should.equal('/programming/how%20to%20node');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name within embedded routers","suites":["Router","Router#url()"],"updatePoint":{"line":913,"column":66,"index":31973},"line":913,"code":"    it('generates URL for given route name within embedded routers', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        prefix: \"/books\"\n      });\n      var embeddedRouter = new Router({\n        prefix: \"/chapters\"\n      });\n      embeddedRouter.get('chapters', '/:chapterName/:pageNumber', function (ctx) {\n        ctx.status = 204;\n      });\n      router.use(embeddedRouter.routes());\n      app.use(router.routes());\n      var url = router.url('chapters', {\n        chapterName: 'Learning ECMA6',\n        pageNumber: 123\n      });\n      url.should.equal('/books/chapters/Learning%20ECMA6/123');\n      url = router.url('chapters', 'Learning ECMA6', 123);\n      url.should.equal('/books/chapters/Learning%20ECMA6/123');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name within two embedded routers","suites":["Router","Router#url()"],"updatePoint":{"line":935,"column":70,"index":32753},"line":935,"code":"    it('generates URL for given route name within two embedded routers', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        prefix: \"/books\"\n      });\n      var embeddedRouter = new Router({\n        prefix: \"/chapters\"\n      });\n      var embeddedRouter2 = new Router({\n        prefix: \"/:chapterName/pages\"\n      });\n      embeddedRouter2.get('chapters', '/:pageNumber', function (ctx) {\n        ctx.status = 204;\n      });\n      embeddedRouter.use(embeddedRouter2.routes());\n      router.use(embeddedRouter.routes());\n      app.use(router.routes());\n      var url = router.url('chapters', {\n        chapterName: 'Learning ECMA6',\n        pageNumber: 123\n      });\n      url.should.equal('/books/chapters/Learning%20ECMA6/pages/123');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name with params and query params","suites":["Router","Router#url()"],"updatePoint":{"line":959,"column":71,"index":33546},"line":959,"code":"    it('generates URL for given route name with params and query params', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('books', '/books/:category/:id', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('books', 'programming', 4, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = router.url('books', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = router.url('books', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: 'page=3&limit=10'\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name without params and query params","suites":["Router","Router#url()"],"updatePoint":{"line":991,"column":74,"index":34461},"line":991,"code":"    it('generates URL for given route name without params and query params', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('category', '/category', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('category', {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/category?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware","suites":["Router","Router#param()"],"updatePoint":{"line":1008,"column":33,"index":34911},"line":1008,"code":"    it('runs parameter middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      }).get('/users/:user', function (ctx, next) {\n        ctx.body = ctx.user;\n      });\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware in order of URL appearance","suites":["Router","Router#param()"],"updatePoint":{"line":1028,"column":60,"index":35618},"line":1028,"code":"    it('runs parameter middleware in order of URL appearance', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n\n        if (ctx.ranFirst) {\n          ctx.user.ordered = 'parameters';\n        }\n\n        if (!id) return ctx.status = 404;\n        return next();\n      }).param('first', function (id, ctx, next) {\n        ctx.ranFirst = true;\n\n        if (ctx.user) {\n          ctx.ranFirst = false;\n        }\n\n        if (!id) return ctx.status = 404;\n        return next();\n      }).get('/:first/users/:user', function (ctx) {\n        ctx.body = ctx.user;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/first/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        res.body.should.have.property('ordered', 'parameters');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware in order of URL appearance even when added in random order","suites":["Router","Router#param()"],"updatePoint":{"line":1062,"column":92,"index":36713},"line":1062,"code":"    it('runs parameter middleware in order of URL appearance even when added in random order', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router // intentional random order\n      .param('a', function (id, ctx, next) {\n        ctx.state.loaded = [id];\n        return next();\n      }).param('d', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).param('c', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).param('b', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).get('/:a/:b/:c/:d', function (ctx, next) {\n        ctx.body = ctx.state.loaded;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/1/2/3/4').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.eql(['1', '2', '3', '4']);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parent parameter middleware for subrouter","suites":["Router","Router#param()"],"updatePoint":{"line":1088,"column":54,"index":37690},"line":1088,"code":"    it('runs parent parameter middleware for subrouter', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var subrouter = new Router();\n      subrouter.get('/:cid', function (ctx) {\n        ctx.body = {\n          id: ctx.params.id,\n          cid: ctx.params.cid\n        };\n      });\n      router.param('id', function (id, ctx, next) {\n        ctx.params.id = 'ran';\n        if (!id) return ctx.status = 404;\n        return next();\n      }).use('/:id/children', subrouter.routes());\n      request(http.createServer(app.use(router.routes()).callback())).get('/did-not-run/children/2').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('id', 'ran');\n        res.body.should.have.property('cid', '2');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 200","suites":["Router","Router#opts"],"updatePoint":{"line":1113,"column":25,"index":38577},"line":1113,"code":"    it('responds with 200', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.text.should.equal('hello');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should allow setting a prefix","suites":["Router","Router#opts"],"updatePoint":{"line":1127,"column":37,"index":39036},"line":1127,"code":"    it('should allow setting a prefix', function (done) {\n      var app = new Koa();\n      var routes = Router({\n        prefix: '/things/:thing_id'\n      });\n      routes.get('/list', function (ctx) {\n        ctx.body = ctx.params;\n      });\n      app.use(routes.routes());\n      request(http.createServer(app.callback())).get('/things/1/list').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.body.thing_id.should.equal('1');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 404 when has a trailing slash","suites":["Router","Router#opts"],"updatePoint":{"line":1142,"column":51,"index":39548},"line":1142,"code":"    it('responds with 404 when has a trailing slash', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info/').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 200","suites":["Router","use middleware with opts"],"updatePoint":{"line":1157,"column":25,"index":40015},"line":1157,"code":"    it('responds with 200', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.text.should.equal('hello');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 404 when has a trailing slash","suites":["Router","use middleware with opts"],"updatePoint":{"line":1171,"column":51,"index":40488},"line":1171,"code":"    it('responds with 404 when has a trailing slash', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info/').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should return composed middleware","suites":["Router","router.routes()"],"updatePoint":{"line":1186,"column":41,"index":40962},"line":1186,"code":"    it('should return composed middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var middlewareCount = 0;\n\n      var middlewareA = function (ctx, next) {\n        middlewareCount++;\n        return next();\n      };\n\n      var middlewareB = function (ctx, next) {\n        middlewareCount++;\n        return next();\n      };\n\n      router.use(middlewareA, middlewareB);\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var routerMiddleware = router.routes();\n      expect(routerMiddleware).to.be.a('function');\n      request(http.createServer(app.use(routerMiddleware).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.an('object');\n        expect(res.body).to.have.property('hello', 'world');\n        expect(middlewareCount).to.equal(2);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"places a `_matchedRoute` value on context","suites":["Router","router.routes()"],"updatePoint":{"line":1218,"column":49,"index":41977},"line":1218,"code":"    it('places a `_matchedRoute` value on context', function (done) {\n      var app = new Koa();\n      var router = new Router();\n\n      var middleware = function (ctx, next) {\n        expect(ctx._matchedRoute).to.be('/users/:id');\n        return next();\n      };\n\n      router.use(middleware);\n      router.get('/users/:id', function (ctx, next) {\n        expect(ctx._matchedRoute).to.be('/users/:id');\n        should.exist(ctx.params.id);\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var routerMiddleware = router.routes();\n      request(http.createServer(app.use(routerMiddleware).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"places a `_matchedRouteName` value on the context for a named route","suites":["Router","router.routes()"],"updatePoint":{"line":1241,"column":75,"index":42751},"line":1241,"code":"    it('places a `_matchedRouteName` value on the context for a named route', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('users#show', '/users/:id', function (ctx, next) {\n        expect(ctx._matchedRouteName).to.be('users#show');\n        ctx.status = 200;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not place a `_matchedRouteName` value on the context for unnamed routes","suites":["Router","router.routes()"],"updatePoint":{"line":1253,"column":84,"index":43272},"line":1253,"code":"    it('does not place a `_matchedRouteName` value on the context for unnamed routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx, next) {\n        expect(ctx._matchedRouteName).to.be(undefined);\n        ctx.status = 200;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should default to GET","suites":["Router","If no HEAD method, default to GET"],"updatePoint":{"line":1267,"column":29,"index":43789},"line":1267,"code":"    it('should default to GET', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).head('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.empty();\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should work with middleware","suites":["Router","If no HEAD method, default to GET"],"updatePoint":{"line":1280,"column":35,"index":44262},"line":1280,"code":"    it('should work with middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).head('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.empty();\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should set opts.prefix","suites":["Router","Router#prefix"],"updatePoint":{"line":1295,"column":30,"index":44778},"line":1295,"code":"    it('should set opts.prefix', function () {\n      var router = Router();\n      expect(router.opts).to.not.have.key('prefix');\n      router.prefix('/things/:thing_id');\n      expect(router.opts.prefix).to.equal('/things/:thing_id');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should prefix existing routes","suites":["Router","Router#prefix"],"updatePoint":{"line":1301,"column":37,"index":45028},"line":1301,"code":"    it('should prefix existing routes', function () {\n      var router = Router();\n      router.get('/users/:id', function (ctx) {\n        ctx.body = 'test';\n      });\n      router.prefix('/things/:thing_id');\n      var route = router.stack[0];\n      expect(route.path).to.equal('/things/:thing_id/users/:id');\n      expect(route.paramNames).to.have.length(2);\n      expect(route.paramNames[0]).to.have.property('name', 'thing_id');\n      expect(route.paramNames[1]).to.have.property('name', 'id');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not set params.0 to the matched path","suites":["Router","Router#prefix","when used with .use(fn) - gh-247"],"updatePoint":{"line":1314,"column":51,"index":45612},"line":1314,"code":"      it('does not set params.0 to the matched path', function (done) {\n        var app = new Koa();\n        var router = new Router();\n        router.use(function (ctx, next) {\n          return next();\n        });\n        router.get('/foo/:id', function (ctx) {\n          ctx.body = ctx.params;\n        });\n        router.prefix('/things');\n        app.use(router.routes());\n        request(http.createServer(app.callback())).get('/things/foo/108').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('id', '108');\n          expect(res.body).to.not.have.property('0');\n          done();\n        });\n      });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support root level router middleware","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1363,"column":55,"index":47201},"line":1363,"code":"        it('should support root level router middleware', function (done) {\n          request(server).get(prefix).expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support requests with a trailing path slash","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1372,"column":62,"index":47608},"line":1372,"code":"        it('should support requests with a trailing path slash', function (done) {\n          request(server).get('/admin/').expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support requests without a trailing path slash","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1381,"column":65,"index":48021},"line":1381,"code":"        it('should support requests without a trailing path slash', function (done) {\n          request(server).get('/admin').expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates route URL","suites":["Router","Static Router#url()"],"updatePoint":{"line":1394,"column":27,"index":48464},"line":1394,"code":"    it('generates route URL', function () {\n      var url = Router.url('/:category/:title', {\n        category: 'programming',\n        title: 'how-to-node'\n      });\n      url.should.equal('/programming/how-to-node');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"escapes using encodeURIComponent()","suites":["Router","Static Router#url()"],"updatePoint":{"line":1401,"column":42,"index":48705},"line":1401,"code":"    it('escapes using encodeURIComponent()', function () {\n      var url = Router.url('/:category/:title', {\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates route URL with params and query params","suites":["Router","Static Router#url()"],"updatePoint":{"line":1408,"column":56,"index":48964},"line":1408,"code":"    it('generates route URL with params and query params', function (done) {\n      var url = Router.url('/books/:category/:id', 'programming', 4, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = Router.url('/books/:category/:id', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = Router.url('/books/:category/:id', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: 'page=3&limit=10'\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates router URL without params and with with query params","suites":["Router","Static Router#url()"],"updatePoint":{"line":1435,"column":70,"index":49757},"line":1435,"code":"    it('generates router URL without params and with with query params', function (done) {\n      var url = Router.url('/category', {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/category?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"}]}