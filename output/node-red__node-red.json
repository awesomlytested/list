{"repo":"node-red/node-red","url":"https://github.com/node-red/node-red","branch":"master","configs":[{"package":"node-red","lang":"js","dir":"test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"inject value of environment variable ","suites":["inject node"],"updatePoint":{"line":102,"column":43,"index":2785},"line":102,"code":"  it('inject value of environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"NR_TEST\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"foo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      process.env.NR_TEST = 'foo';\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of node as environment variable ","suites":["inject node"],"updatePoint":{"line":131,"column":50,"index":3509},"line":131,"code":"  it('inject name of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"NAME\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of node as environment variable ","suites":["inject node"],"updatePoint":{"line":159,"column":48,"index":4172},"line":159,"code":"  it('inject id of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject path of node as environment variable ","suites":["inject node"],"updatePoint":{"line":187,"column":50,"index":4833},"line":187,"code":"  it('inject path of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_PATH\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow/n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":215,"column":50,"index":5501},"line":215,"code":"  it('inject name of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_FLOW_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      label: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"FLOW\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":247,"column":48,"index":6230},"line":247,"code":"  it('inject id of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_FLOW_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      name: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of group as environment variable ","suites":["inject node"],"updatePoint":{"line":279,"column":51,"index":6959},"line":279,"code":"  it('inject name of group as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_GROUP_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"GROUP\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of group as environment variable ","suites":["inject node"],"updatePoint":{"line":312,"column":49,"index":7706},"line":312,"code":"  it('inject id of group as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_GROUP_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"g0\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":345,"column":66,"index":8465},"line":345,"code":"  it('inject name of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"NAME\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":373,"column":64,"index":9147},"line":373,"code":"  it('inject id of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject path of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":401,"column":66,"index":9827},"line":401,"code":"  it('inject path of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_PATH}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow/n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of flow as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":429,"column":66,"index":10514},"line":429,"code":"  it('inject name of flow as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_FLOW_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      label: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"FLOW\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":461,"column":48,"index":11246},"line":461,"code":"  it('inject id of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_FLOW_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      name: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of group as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":493,"column":67,"index":11994},"line":493,"code":"  it('inject name of group as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_GROUP_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"GROUP\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of group as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":526,"column":65,"index":12760},"line":526,"code":"  it('inject id of group as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_GROUP_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"g0\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of flow context property","suites":["inject node"],"updatePoint":{"line":559,"column":45,"index":13501},"line":559,"code":"  it('sets the value of flow context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"flowValue\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"changeMe\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.context().flow.set(\"flowValue\", \"changeMe\");\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable flow context property","suites":["inject node"],"updatePoint":{"line":588,"column":57,"index":14259},"line":588,"code":"  it('sets the value of persistable flow context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory0)::flowValue\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\", \"t1\");\n            msg.should.have.property(\"payload\", \"changeMe\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.context().flow.set(\"flowValue\", \"changeMe\", \"memory0\", function (err) {\n          n1.receive({});\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable flow context property","suites":["inject node"],"updatePoint":{"line":620,"column":61,"index":15143},"line":620,"code":"  it('sets the value of two persistable flow context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n\n            count++;\n\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().flow;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of global context property","suites":["inject node"],"updatePoint":{"line":679,"column":47,"index":16669},"line":679,"code":"  it('sets the value of global context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"globalValue\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"changeMe\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.context().global.set(\"globalValue\", \"changeMe\");\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable global context property","suites":["inject node"],"updatePoint":{"line":707,"column":59,"index":17420},"line":707,"code":"  it('sets the value of persistable global context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\", \"t1\");\n            msg.should.have.property(\"payload\", \"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n1.context().global;\n        global.set(\"val\", \"foo\", \"memory1\", function (err) {\n          n1.receive({});\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable global context property","suites":["inject node"],"updatePoint":{"line":741,"column":63,"index":18334},"line":741,"code":"  it('sets the value of two persistable global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n\n            count++;\n\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().global;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable flow & global context property","suites":["inject node"],"updatePoint":{"line":800,"column":66,"index":19885},"line":800,"code":"  it('sets the value of persistable flow & global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n\n            count++;\n\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n0.context();\n        var flow = context.flow;\n        var global = context.global;\n        flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable global context property","suites":["inject node"],"updatePoint":{"line":861,"column":63,"index":21493},"line":861,"code":"  it('sets the value of two persistable global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n\n            count++;\n\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().global;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with default delay property","suites":["inject node"],"updatePoint":{"line":920,"column":52,"index":23030},"line":920,"code":"  it('should inject once with default delay property', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('onceDelay', 100);\n      done();\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with default delay","suites":["inject node"],"updatePoint":{"line":938,"column":43,"index":23450},"line":938,"code":"  it('should inject once with default delay', function (done) {\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 't1');\n          msg.should.have.property('payload');\n          should(msg.payload).be.lessThan(timestamp.getTime());\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with 500 msec. delay","suites":["inject node"],"updatePoint":{"line":966,"column":45,"index":24192},"line":966,"code":"  it('should inject once with 500 msec. delay', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      onceDelay: 0.5,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('onceDelay', 500);\n      done();\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with delay of two seconds","suites":["inject node"],"updatePoint":{"line":985,"column":50,"index":24641},"line":985,"code":"  it('should inject once with delay of two seconds', function (done) {\n    this.timeout(2700); // have to wait for the inject with delay of two seconds\n\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      onceDelay: 2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't1');\n        should(msg.payload).be.greaterThan(timestamp.getTime());\n        done();\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject repeatedly","suites":["inject node"],"updatePoint":{"line":1011,"column":30,"index":25351},"line":1011,"code":"  it('should inject repeatedly', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      payload: \"payload\",\n      topic: \"t2\",\n      repeat: 0.2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't2');\n        msg.should.have.property('payload', 'payload');\n        count += 1;\n\n        if (count > 2) {\n          helper.clearFlows().then(function () {\n            done();\n          });\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with delay of two seconds and repeatedly","suites":["inject node"],"updatePoint":{"line":1038,"column":65,"index":26024},"line":1038,"code":"  it('should inject once with delay of two seconds and repeatedly', function (done) {\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      repeat: 0.2,\n      once: true,\n      onceDelay: 1.2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't1');\n        should(msg.payload).be.greaterThan(timestamp.getTime());\n        count += 1;\n\n        if (count > 2) {\n          helper.clearFlows().then(function () {\n            done();\n          });\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject with cron","suites":["inject node"],"updatePoint":{"line":1070,"column":29,"index":26816},"line":1070,"code":"  it('should inject with cron', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      payloadType: \"date\",\n      topic: \"t3\",\n      crontab: \"* * * * * *\",\n      wires: [[\"n3\"]]\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }], function () {\n      var n3 = helper.getNode(\"n3\");\n      n3.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't3');\n        msg.should.have.property('payload').be.a.Number();\n        helper.clearFlows().then(function () {\n          done();\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject multiple properties ","suites":["inject node"],"updatePoint":{"line":1092,"column":40,"index":27396},"line":1092,"code":"  it('should inject multiple properties ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"topic\",\n        v: \"t1\",\n        vt: \"str\"\n      }, {\n        p: \"payload\",\n        v: \"foo\",\n        vt: \"str\"\n      }, {\n        p: \"x\",\n        v: 10,\n        \"vt\": \"num\"\n      }, {\n        p: \"y\",\n        v: \"x+2\",\n        \"vt\": \"jsonata\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"foo\");\n          msg.should.have.property(\"x\", 10);\n          msg.should.have.property(\"y\", 12);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject custom properties in message","suites":["inject node"],"updatePoint":{"line":1136,"column":48,"index":28383},"line":1136,"code":"  it('should inject custom properties in message', function (done) {\n    //n1: inject node with  { topic:\"static\", payload:\"static\", bool1:true, str1:\"1\" }\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"payload\",\n        v: \"static\",\n        vt: \"str\"\n      }, {\n        p: \"topic\",\n        v: \"static\",\n        vt: \"str\"\n      }, {\n        p: \"bool1\",\n        v: \"true\",\n        vt: \"bool\"\n      }, {\n        p: \"str1\",\n        v: \"1\",\n        vt: \"str\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.not.have.property(\"payload\"); //payload removed\n\n          msg.should.have.property(\"topic\", \"t_override\"); //changed value to t_override\n\n          msg.should.have.property(\"str1\", 1); //changed type from str to num\n\n          msg.should.have.property(\"num1\", 1); //new prop\n\n          msg.should.have.property(\"bool1\", false); //changed value to false\n\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        __user_inject_props__: [{\n          p: \"topic\",\n          v: \"t_override\",\n          vt: \"str\"\n        }, //change value to t_override\n        {\n          p: \"str1\",\n          v: \"1\",\n          vt: \"num\"\n        }, //change type\n        {\n          p: \"num1\",\n          v: \"1\",\n          vt: \"num\"\n        }, //new prop\n        {\n          p: \"bool1\",\n          v: \"false\",\n          vt: \"bool\"\n        } //change value to false\n        ]\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject multiple properties using legacy props if needed","suites":["inject node"],"updatePoint":{"line":1209,"column":68,"index":30121},"line":1209,"code":"  it('should inject multiple properties using legacy props if needed', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      payload: \"123\",\n      payloadType: \"num\",\n      topic: \"foo\",\n      props: [{\n        p: \"topic\",\n        vt: \"str\"\n      }, {\n        p: \"payload\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"foo\");\n          msg.should.have.property(\"payload\", 123);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should report invalid JSONata expression","suites":["inject node"],"updatePoint":{"line":1243,"column":46,"index":30898},"line":1243,"code":"  it('should report invalid JSONata expression', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"topic\",\n        v: \"t1\",\n        vt: \"str\"\n      }, {\n        p: \"payload\",\n        v: \"@\",\n        vt: \"jsonata\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.not.have.property(\"payload\");\n          count++;\n\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.on(\"call:error\", function (err) {\n        count++;\n\n        if (count == 2) {\n          done();\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject message","suites":["inject node","post"],"updatePoint":{"line":1290,"column":29,"index":31885},"line":1290,"code":"    it('should inject message', function (done) {\n      helper.load(injectNode, [{\n        id: \"n1\",\n        type: \"inject\",\n        payloadType: \"str\",\n        topic: \"t4\",\n        payload: \"hello\",\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }], function () {\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 't4');\n          msg.should.have.property('payload', 'hello');\n          helper.clearFlows().then(function () {\n            done();\n          });\n        });\n\n        try {\n          helper.request().post('/inject/n1').expect(200).end(function (err) {\n            if (err) {\n              console.log(err);\n              return helper.clearFlows().then(function () {\n                done(err);\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject custom properties in posted message","suites":["inject node","post"],"updatePoint":{"line":1325,"column":57,"index":32849},"line":1325,"code":"    it('should inject custom properties in posted message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"inject\",\n        payloadType: \"str\",\n        topic: \"t4\",\n        payload: \"hello\",\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(injectNode, flow, function () {\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          msg.should.not.have.property(\"payload\"); //payload removed\n\n          msg.should.have.property(\"topic\", \"t_override\"); //changed value to t_override\n\n          msg.should.have.property(\"str1\", \"1\"); //injected prop\n\n          msg.should.have.property(\"num1\", 1); //injected prop\n\n          msg.should.have.property(\"bool1\", true); //injected prop\n\n          msg.should.have.property(\"jsonata1\", \"AB\"); //injected prop\n\n          helper.clearFlows().then(function () {\n            done();\n          });\n        });\n\n        try {\n          helper.request().post('/inject/n1').send({\n            __user_inject_props__: [{\n              p: \"topic\",\n              v: \"t_override\",\n              vt: \"str\"\n            }, //change value to t_override\n            {\n              p: \"str1\",\n              v: \"1\",\n              vt: \"str\"\n            }, //new prop\n            {\n              p: \"num1\",\n              v: \"1\",\n              vt: \"num\"\n            }, //new prop\n            {\n              p: \"bool1\",\n              v: \"true\",\n              vt: \"bool\"\n            }, //new prop\n            {\n              p: \"jsonata1\",\n              v: '\"A\" & \"B\"',\n              vt: \"jsonata\"\n            } //new prop\n            ]\n          }).expect(200).end(function (err) {\n            if (err) {\n              console.log(err);\n              return helper.clearFlows().then(function () {\n                done(err);\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should fail for invalid node","suites":["inject node","post"],"updatePoint":{"line":1398,"column":36,"index":34798},"line":1398,"code":"    it('should fail for invalid node', function (done) {\n      helper.request().post('/inject/invalid').expect(404).end(done);\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["debug node"],"updatePoint":{"line":39,"column":22,"index":1175},"line":39,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\",\n      complete: \"false\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'Debug');\n      n1.should.have.property('complete', \"payload\");\n      done();\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish on input","suites":["debug node"],"updatePoint":{"line":53,"column":29,"index":1547},"line":53,"code":"  it('should publish on input', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            name: \"Debug\",\n            msg: \"test\",\n            path: \"global\",\n            format: \"string[4]\",\n            property: \"payload\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish to console","suites":["debug node"],"updatePoint":{"line":80,"column":31,"index":2196},"line":80,"code":"  it('should publish to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var count = 0;\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"test\",\n            property: \"payload\",\n            format: \"string[4]\",\n            path: \"global\"\n          }\n        }]);\n        count++;\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: 'n1',\n            type: 'debug',\n            msg: 'test',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message","suites":["debug node"],"updatePoint":{"line":128,"column":37,"index":3455},"line":128,"code":"  it('should publish complete message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"payload\":\"test\"}',\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message to console","suites":["debug node"],"updatePoint":{"line":153,"column":48,"index":4075},"line":153,"code":"  it('should publish complete message to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"true\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"payload\":\"test\"}',\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: '\\n{ payload: \\'test\\' }',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish other property","suites":["debug node"],"updatePoint":{"line":199,"column":35,"index":5315},"line":199,"code":"  it('should publish other property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"foo\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\",\n          foo: \"bar\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"bar\",\n            property: \"foo\",\n            format: \"string[3]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish multi-level properties","suites":["debug node"],"updatePoint":{"line":226,"column":43,"index":5968},"line":226,"code":"  it('should publish multi-level properties', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"foo.bar\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\",\n          foo: {\n            bar: \"bar\"\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"bar\",\n            property: \"foo.bar\",\n            format: \"string[3]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an Error","suites":["debug node"],"updatePoint":{"line":255,"column":29,"index":6646},"line":255,"code":"  it('should publish an Error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: new Error(\"oops\")\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"name\":\"Error\",\"message\":\"oops\"}',\n            property: \"payload\",\n            format: \"error\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a boolean","suites":["debug node"],"updatePoint":{"line":280,"column":30,"index":7282},"line":280,"code":"  it('should publish a boolean', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: true\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: 'true',\n            property: \"payload\",\n            format: \"boolean\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a number","suites":["debug node"],"updatePoint":{"line":305,"column":29,"index":7877},"line":305,"code":"  it('should publish a number', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: 7\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"7\",\n            property: \"payload\",\n            format: \"number\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a NaN","suites":["debug node"],"updatePoint":{"line":331,"column":26,"index":8485},"line":331,"code":"  it('should publish a NaN', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Number.NaN\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"NaN\",\n            property: \"payload\",\n            format: \"number\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish with no payload","suites":["debug node"],"updatePoint":{"line":357,"column":36,"index":9114},"line":357,"code":"  it('should publish with no payload', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {});\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '(undefined)',\n            property: \"payload\",\n            format: \"undefined\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a null","suites":["debug node"],"updatePoint":{"line":380,"column":27,"index":9683},"line":380,"code":"  it('should publish a null', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '(undefined)',\n            property: \"payload\",\n            format: \"null\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object","suites":["debug node"],"updatePoint":{"line":405,"column":30,"index":10283},"line":405,"code":"  it('should publish an object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo'\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with no-prototype-builtins","suites":["debug node"],"updatePoint":{"line":432,"column":57,"index":10948},"line":432,"code":"  it('should publish an object with no-prototype-builtins', function (done) {\n    const flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const payload = Object.create(null);\n      payload.type = 'foo';\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: payload\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with overriden hasOwnProperty","suites":["debug node"],"updatePoint":{"line":459,"column":60,"index":11661},"line":459,"code":"  it('should publish an object with overriden hasOwnProperty', function (done) {\n    const flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo',\n            hasOwnProperty: null\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\",\"hasOwnProperty\":null}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an array","suites":["debug node"],"updatePoint":{"line":487,"column":29,"index":12358},"line":487,"code":"  it('should publish an array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: [0, 1, 2, 3]\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '[0,1,2,3]',\n            format: \"array[4]\",\n            property: \"payload\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with circular references","suites":["debug node"],"updatePoint":{"line":512,"column":55,"index":12993},"line":512,"code":"  it('should publish an object with circular references', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        var o = {\n          name: 'bar'\n        };\n        o.o = o;\n        n1.emit(\"input\", {\n          payload: o\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"name\":\"bar\",\"o\":\"[Circular ~]\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object to console","suites":["debug node"],"updatePoint":{"line":541,"column":41,"index":13693},"line":541,"code":"  it('should publish an object to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo'\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: '\\n{ type: \\'foo\\' }',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a string after a newline to console if the string contains \\n","suites":["debug node"],"updatePoint":{"line":589,"column":83,"index":15013},"line":589,"code":"  it('should publish a string after a newline to console if the string contains \\\\n', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\\ntest\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"test\\ntest\",\n            property: \"payload\",\n            format: \"string[9]\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: \"\\ntest\\ntest\",\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message with edit","suites":["debug node"],"updatePoint":{"line":635,"column":47,"index":16264},"line":635,"code":"  it('should publish complete message with edit', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\",\n      complete: \"true\",\n      targetType: \"jsonata\",\n      complete: '\"<\" & payload & \">\"'\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            name: \"Debug\",\n            msg: \"<test>\",\n            format: \"string[6]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a long message","suites":["debug node"],"updatePoint":{"line":664,"column":36,"index":16979},"line":664,"code":"  it('should truncate a long message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Array(1002).join(\"X\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: Array(1001).join(\"X\") + '...',\n            property: \"payload\",\n            format: \"string[1001]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a long string in the object","suites":["debug node"],"updatePoint":{"line":690,"column":49,"index":17658},"line":690,"code":"  it('should truncate a long string in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Array(1002).join(\"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"foo\":\"' + Array(1001).join(\"X\") + '...\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large array","suites":["debug node"],"updatePoint":{"line":718,"column":35,"index":18363},"line":718,"code":"  it('should truncate a large array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Array(1001).fill(\"X\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              __enc__: true,\n              type: \"array\",\n              data: Array(1000).fill(\"X\"),\n              length: 1001\n            }),\n            property: \"payload\",\n            format: \"array[1001]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large array in the object","suites":["debug node"],"updatePoint":{"line":749,"column":49,"index":19171},"line":749,"code":"  it('should truncate a large array in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Array(1001).fill(\"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              foo: {\n                __enc__: true,\n                type: \"array\",\n                data: Array(1000).fill(\"X\"),\n                length: 1001\n              }\n            }),\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large buffer","suites":["debug node"],"updatePoint":{"line":784,"column":36,"index":20037},"line":784,"code":"  it('should truncate a large buffer', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Buffer.alloc(501, \"\\\"\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a[0].should.eql({\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: Array(1001).join(\"2\"),\n            property: \"payload\",\n            format: \"buffer[501]\",\n            path: \"global\"\n          }\n        });\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large buffer in the object","suites":["debug node"],"updatePoint":{"line":810,"column":50,"index":20711},"line":810,"code":"  it('should truncate a large buffer in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Buffer.alloc(1001, \"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a[0].should.eql({\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              foo: {\n                type: \"Buffer\",\n                data: Array(1000).fill(88),\n                __enc__: true,\n                length: 1001\n              }\n            }),\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        });\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should convert Buffer to hex","suites":["debug node"],"updatePoint":{"line":845,"column":34,"index":21578},"line":845,"code":"  it('should convert Buffer to hex', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Buffer.from('HELLO', 'utf8')\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '48454c4c4f',\n            property: \"payload\",\n            format: \"buffer[5]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish when active","suites":["debug node"],"updatePoint":{"line":870,"column":32,"index":22208},"line":870,"code":"  it('should publish when active', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      active: false\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"message 1\"\n        });\n        helper.request().post('/debug/n1/enable').expect(200).end(function (err) {\n          if (err) {\n            return done(err);\n          }\n\n          n1.emit(\"input\", {\n            payload: \"message 2\"\n          });\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"message 2\",\n            property: \"payload\",\n            format: \"string[9]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should not publish when inactive","suites":["debug node"],"updatePoint":{"line":905,"column":38,"index":23082},"line":905,"code":"  it('should not publish when inactive', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      active: true\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function (close) {\n        helper.request().post('/debug/n1/disable').expect(201).end(function (err) {\n          if (err) {\n            close();\n            return done(err);\n          }\n\n          n1.emit(\"input\", {\n            payload: \"message\"\n          });\n          setTimeout(function () {\n            close();\n            done();\n          }, 200);\n        });\n      }, function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      }, function () {});\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 404 on invalid state","suites":["debug node","post"],"updatePoint":{"line":934,"column":42,"index":23855},"line":934,"code":"    it('should return 404 on invalid state', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/n1/foobar').expect(404).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 404 on invalid node","suites":["debug node","post"],"updatePoint":{"line":944,"column":41,"index":24149},"line":944,"code":"    it('should return 404 on invalid node', function (done) {\n      helper.request().post('/debug/n99/enable').expect(404).end(done);\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 400 for invalid bulk disable","suites":["debug node","post"],"updatePoint":{"line":947,"column":50,"index":24300},"line":947,"code":"    it('should return 400 for invalid bulk disable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/disable').send({}).set('Content-type', 'application/json').expect(400).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return success for bulk disable","suites":["debug node","post"],"updatePoint":{"line":957,"column":46,"index":24646},"line":957,"code":"    it('should return success for bulk disable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/disable').send({\n          nodes: ['n1']\n        }).set('Content-type', 'application/json').expect(201).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return the view.html","suites":["debug node","get"],"updatePoint":{"line":971,"column":35,"index":25052},"line":971,"code":"    it('should return the view.html', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\"\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().get('/debug/view/view.html').expect(200).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should output a message when called","suites":["catch Node"],"updatePoint":{"line":26,"column":41,"index":946},"line":26,"code":"  it('should output a message when called', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"catch\",\n      name: \"catch\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(catchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.should.have.property('name', 'catch');\n      n2.on(\"input\", function (msg) {\n        msg.should.be.a.Error();\n        msg.toString().should.equal(\"Error: big error\");\n        done();\n      });\n      var err = new Error(\"big error\");\n      n1.emit(\"input\", err);\n    });\n  });","file":"nodes/core/common/25-catch_spec.js","skipped":false,"dir":"test"},{"name":"should output a message when called","suites":["status Node"],"updatePoint":{"line":26,"column":41,"index":948},"line":26,"code":"  it('should output a message when called', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"status\",\n      name: \"status\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(catchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.should.have.property('name', 'status');\n      n2.on(\"input\", function (msg) {\n        msg.text.should.equal(\"Oh dear\");\n        msg.should.have.property('source');\n        msg.source.should.have.property('id', \"12345\");\n        msg.source.should.have.property('type', \"testnode\");\n        msg.source.should.have.property('name', \"fred\");\n        done();\n      });\n      var mst = {\n        text: \"Oh dear\",\n        source: {\n          id: \"12345\",\n          type: \"testnode\",\n          name: \"fred\"\n        }\n      };\n      n1.emit(\"input\", mst);\n    });\n  });","file":"nodes/core/common/25-status_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded (link in)","suites":["link Node"],"updatePoint":{"line":34,"column":32,"index":1089},"line":34,"code":"  it('should be loaded (link in)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link in\",\n      name: \"link-in\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'link-in');\n      done();\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded (link out)","suites":["link Node"],"updatePoint":{"line":46,"column":33,"index":1391},"line":46,"code":"  it('should be loaded (link out)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'link-out');\n      done();\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked","suites":["link Node"],"updatePoint":{"line":58,"column":22,"index":1685},"line":58,"code":"  it('should be linked', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\",\n      links: [\"n2\"]\n    }, {\n      id: \"n2\",\n      type: \"link in\",\n      name: \"link-in\",\n      wires: [[\"n3\"]]\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n3 = helper.getNode(\"n3\");\n      n3.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked to multiple nodes","suites":["link Node"],"updatePoint":{"line":89,"column":40,"index":2374},"line":89,"code":"  it('should be linked to multiple nodes', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\",\n      links: [\"n2\", \"n3\"]\n    }, {\n      id: \"n2\",\n      type: \"link in\",\n      name: \"link-in0\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n3\",\n      type: \"link in\",\n      name: \"link-in1\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n4\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n4 = helper.getNode(\"n4\");\n      var count = 0;\n      n4.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          count++;\n\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked from multiple nodes","suites":["link Node"],"updatePoint":{"line":130,"column":42,"index":3249},"line":130,"code":"  it('should be linked from multiple nodes', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out0\",\n      links: [\"n3\"]\n    }, {\n      id: \"n2\",\n      type: \"link out\",\n      name: \"link-out1\",\n      links: [\"n3\"]\n    }, {\n      id: \"n3\",\n      type: \"link in\",\n      name: \"link-in\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n4\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n4 = helper.getNode(\"n4\");\n      var count = 0;\n      n4.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          count++;\n\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n      n2.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should call static link-in node and get response","suites":["link Node","link-call node"],"updatePoint":{"line":176,"column":56,"index":4266},"line":176,"code":"    it('should call static link-in node and get response', function (done) {\n      var flow = [{\n        id: \"link-in-1\",\n        type: \"link in\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        type: \"link call\",\n        links: [\"link-in-1\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var func = helper.getNode(\"func\");\n        func.on(\"input\", function (msg, send, done) {\n          msg.payload = \"123\";\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '123');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"hello\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should call link-in node by name and get response","suites":["link Node","link-call node"],"updatePoint":{"line":220,"column":57,"index":5387},"line":220,"code":"    it('should call link-in node by name and get response', function (done) {\n      this.timeout(500);\n      var payload = Date.now();\n      var flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"tab-flow-2\",\n        type: \"tab\",\n        label: \"Flow 2\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-2\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var func = helper.getNode(\"func\");\n        func.on(\"input\", function (msg, send, done) {\n          msg.payload += msg.payload;\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.eql(payload + payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: payload,\n          target: \"double payload\"\n        });\n      });\n    }); // //TODO: This test is DISABLED - helper.load() calls callback but none of the nodes are available (issue loading a flow with a subflow)","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should timeout waiting for link return","suites":["link Node","link-call node"],"updatePoint":{"line":323,"column":46,"index":9240},"line":323,"code":"    it('should timeout waiting for link return', function (done) {\n      this.timeout(1000);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"\"\n      }, //not return mode, cause link-call timeout\n      {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"static\",\n        \"timeout\": \"0.5\",\n        links: [\"link-in-1\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCallNode = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, done) {\n          msg.payload += msg.payload;\n          send(msg);\n          done();\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\", \"timeout\");\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCallNode.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should raise error due to multiple targets on same tab","suites":["link Node","link-call node"],"updatePoint":{"line":392,"column":62,"index":11162},"line":392,"code":"    it('should raise error due to multiple targets on same tab', function (done) {\n      this.timeout(55500);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCall = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, _done) {\n          done(new Error(\"Function should not be called\"));\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\");\n            msg.error.message.should.match(/.*Multiple link-in nodes.*/);\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCall.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should raise error due to multiple targets on different tabs","suites":["link Node","link-call node"],"updatePoint":{"line":464,"column":68,"index":13195},"line":464,"code":"    it('should raise error due to multiple targets on different tabs', function (done) {\n      this.timeout(500);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"tab-flow-2\",\n        type: \"tab\",\n        label: \"Flow 2\"\n      }, {\n        id: \"tab-flow-3\",\n        type: \"tab\",\n        label: \"Flow 3\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-2\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-3\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCall = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, _done) {\n          done(new Error(\"Function should not be called\"));\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\");\n            msg.error.message.should.match(/.*Multiple link-in nodes.*/);\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCall.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should not raise error after deploying a name change to a duplicate link-in node","suites":["link Node","link-call node"],"updatePoint":{"line":544,"column":88,"index":15410},"line":544,"code":"    it('should not raise error after deploying a name change to a duplicate link-in node', async function () {\n      this.timeout(400);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"duplicate\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"duplicate\",\n        wires: [[\"link-out-1\"]]\n      }, //duplicate name\n      {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      await helper.load(linkNode, flow);\n      const linkIn2before = helper.getNode(\"link-in-2\");\n      linkIn2before.should.have.property(\"name\", \"duplicate\"); // check link-in-2 has been deployed with the duplicate name\n      //modify the flow and deploy change\n\n      const newConfig = clone(flow);\n      newConfig[2].name = \"add\"; // change nodes name\n\n      await helper.setFlows(newConfig, \"nodes\"); // deploy \"nodes\" only\n\n      const helperNode = helper.getNode(\"n4\");\n      const linkCall2 = helper.getNode(\"link-call\");\n      const linkIn2after = helper.getNode(\"link-in-2\");\n      linkIn2after.should.have.property(\"name\", \"add\"); // check link-in-2 no longer has a duplicate name\n      //poke { payload: \"hello\", target: \"add\" } into the link-call node and \n      //ensure that a message arrives via the link-in node named \"add\"\n\n      await new Promise((resolve, reject) => {\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"add\");\n            msg.should.not.have.property(\"error\");\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n        linkCall2.receive({\n          payload: \"hello\",\n          target: \"add\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should allow nested link-call flows","suites":["link Node","link-call node"],"updatePoint":{"line":613,"column":43,"index":17532},"line":613,"code":"    it('should allow nested link-call flows', function (done) {\n      this.timeout(500);\n      var flow = [\n      /** Multiply by 2 link flow **/\n      {\n        id: \"li1\",\n        type: \"link in\",\n        wires: [[\"m2\"]]\n      }, {\n        id: \"m2\",\n        type: \"helper\",\n        wires: [[\"lo1\"]]\n      }, {\n        id: \"lo1\",\n        type: \"link out\",\n        mode: \"return\"\n      },\n      /** Multiply by 3 link flow **/\n      {\n        id: \"li2\",\n        type: \"link in\",\n        wires: [[\"m3\"]]\n      }, {\n        id: \"m3\",\n        type: \"helper\",\n        wires: [[\"lo2\"]]\n      }, {\n        id: \"lo2\",\n        type: \"link out\",\n        mode: \"return\"\n      },\n      /** Multiply by 6 link flow **/\n      {\n        id: \"li3\",\n        type: \"link in\",\n        wires: [[\"link-call-1\"]]\n      }, {\n        id: \"link-call-1\",\n        type: \"link call\",\n        links: [\"li1\"],\n        wires: [[\"link-call-2\"]]\n      }, {\n        id: \"link-call-2\",\n        type: \"link call\",\n        links: [\"li2\"],\n        wires: [[\"lo3\"]]\n      }, {\n        id: \"lo3\",\n        type: \"link out\",\n        mode: \"return\"\n      },\n      /** Test Flow Entry **/\n      {\n        id: \"link-call\",\n        type: \"link call\",\n        links: [\"li3\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var m2 = helper.getNode(\"m2\");\n        m2.on(\"input\", function (msg, send, done) {\n          msg.payload *= 2;\n          send(msg);\n          done();\n        });\n        var m3 = helper.getNode(\"m3\");\n        m3.on(\"input\", function (msg, send, done) {\n          msg.payload *= 3;\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 24);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 4\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["comment Node"],"updatePoint":{"line":26,"column":22,"index":933},"line":26,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"comment\",\n      name: \"comment\"\n    }];\n    helper.load(commentNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'comment');\n      done();\n    });\n  });","file":"nodes/core/common/90-comment_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["unknown Node"],"updatePoint":{"line":26,"column":22,"index":929},"line":26,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"unknown\",\n      name: \"unknown\"\n    }];\n    helper.load(unknown, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'unknown');\n      done();\n    });\n  });","file":"nodes/core/common/98-unknown_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message using send()","suites":["function node"],"updatePoint":{"line":59,"column":47,"index":1637},"line":59,"code":"  it('should send returned message using send()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should do something with the catch node","suites":["function node"],"updatePoint":{"line":83,"column":45,"index":2246},"line":83,"code":"  it('should do something with the catch node', function (done) {\n    var flow = [{\n      \"id\": \"funcNode\",\n      \"type\": \"function\",\n      \"wires\": [[\"goodNode\"]],\n      \"func\": \"node.error('This is an error', msg);\"\n    }, {\n      \"id\": \"goodNode\",\n      \"type\": \"helper\"\n    }, {\n      \"id\": \"badNode\",\n      \"type\": \"helper\"\n    }, {\n      \"id\": \"catchNode\",\n      \"type\": \"catch\",\n      \"scope\": null,\n      \"uncaught\": false,\n      \"wires\": [[\"badNode\"]]\n    }];\n\n    var catchNodeModule = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/25-catch.js\");\n\n    helper.load([catchNodeModule, functionNode], flow, function () {\n      var funcNode = helper.getNode(\"funcNode\");\n      var catchNode = helper.getNode(\"catchNode\");\n      var goodNode = helper.getNode(\"goodNode\");\n      var badNode = helper.getNode(\"badNode\");\n      badNode.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('error');\n        msg.error.should.have.property('message', \"This is an error\");\n        msg.error.should.have.property('source');\n        msg.error.source.should.have.property('id', \"funcNode\");\n        done();\n      });\n      funcNode.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["function node"],"updatePoint":{"line":125,"column":22,"index":3556},"line":125,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      name: \"function\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'function');\n      done();\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message","suites":["function node"],"updatePoint":{"line":137,"column":34,"index":3866},"line":137,"code":"  it('should send returned message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message using send()","suites":["function node"],"updatePoint":{"line":161,"column":47,"index":4473},"line":161,"code":"  it('should send returned message using send()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount","suites":["function node"],"updatePoint":{"line":185,"column":71,"index":5108},"line":185,"code":"  it('should allow accessing node.id and node.name and node.outputCount', function (done) {\n    var flow = [{\n      id: \"n1\",\n      name: \"test-function\",\n      outputs: 2,\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [{ topic: node.name, payload:node.id, outputCount: node.outputCount }];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          // Use this form of assert as `msg` is created inside\n          // the sandbox and doesn't get all the should.js monkey patching\n          should.equal(msg.payload, n1.id);\n          should.equal(msg.topic, n1.name);\n          should.equal(msg.outputCount, n1.outputs);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone single message sent using send()","suites":["function node"],"updatePoint":{"line":248,"column":51,"index":6795},"line":248,"code":"  it('should clone single message sent using send()', function (done) {\n    testSendCloning(\"msg\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should not clone single message sent using send(,false)","suites":["function node"],"updatePoint":{"line":251,"column":61,"index":6917},"line":251,"code":"  it('should not clone single message sent using send(,false)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg,false); msg.payload = 'changed';\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'changed');\n        done();\n      });\n      var origMessage = {\n        payload: \"foo\",\n        topic: \"bar\"\n      };\n      n1.receive(origMessage);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 1","suites":["function node"],"updatePoint":{"line":276,"column":60,"index":7613},"line":276,"code":"  it('should clone first message sent using send() - array 1', function (done) {\n    testSendCloning(\"[msg]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 2","suites":["function node"],"updatePoint":{"line":279,"column":60,"index":7736},"line":279,"code":"  it('should clone first message sent using send() - array 2', function (done) {\n    testSendCloning(\"[[msg],[null]]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 3","suites":["function node"],"updatePoint":{"line":282,"column":60,"index":7868},"line":282,"code":"  it('should clone first message sent using send() - array 3', function (done) {\n    testSendCloning(\"[null,msg]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 3","suites":["function node"],"updatePoint":{"line":285,"column":60,"index":7996},"line":285,"code":"  it('should clone first message sent using send() - array 3', function (done) {\n    testSendCloning(\"[null,[msg]]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should pass through _topic","suites":["function node"],"updatePoint":{"line":288,"column":32,"index":8098},"line":288,"code":"  it('should pass through _topic', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('_topic', 'baz');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        _topic: \"baz\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send to multiple outputs","suites":["function node"],"updatePoint":{"line":314,"column":37,"index":8769},"line":314,"code":"  it('should send to multiple outputs', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"], [\"n3\"]],\n      func: \"return [{payload: '1'},{payload: '2'}];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        should(msg).have.property('payload', '1');\n        count++;\n\n        if (count == 2) {\n          done();\n        }\n      });\n      n3.on(\"input\", function (msg) {\n        should(msg).have.property('payload', '2');\n        count++;\n\n        if (count == 2) {\n          done();\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send to multiple messages","suites":["function node"],"updatePoint":{"line":354,"column":38,"index":9683},"line":354,"code":"  it('should send to multiple messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [[{payload: 1},{payload: 2}]];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        count++;\n\n        try {\n          should(msg).have.property('payload', count);\n          should(msg).have.property('_msgid', 1234);\n\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        _msgid: 1234\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow input to be discarded by returning null","suites":["function node"],"updatePoint":{"line":389,"column":58,"index":10508},"line":389,"code":"  it('should allow input to be discarded by returning null', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return null\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, 20);\n      n2.on(\"input\", function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle null amongst valid messages","suites":["function node"],"updatePoint":{"line":414,"column":47,"index":11113},"line":414,"code":"  it('should handle null amongst valid messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [[msg,null,msg],null]\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var n2MsgCount = 0;\n      var n3MsgCount = 0;\n      n2.on(\"input\", function (msg) {\n        n2MsgCount++;\n      });\n      n3.on(\"input\", function (msg) {\n        n3MsgCount++;\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        n2MsgCount.should.equal(2);\n        n3MsgCount.should.equal(0);\n        done();\n      }, 20);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in global context","suites":["function node"],"updatePoint":{"line":450,"column":39,"index":11971},"line":450,"code":"  it('should get keys in global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - string","suites":["function node"],"updatePoint":{"line":514,"column":59,"index":13764},"line":514,"code":"  it('should drop and log non-object message types - string', function (done) {\n    testNonObjectMessage('return \"foo\"', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - buffer","suites":["function node"],"updatePoint":{"line":517,"column":59,"index":13898},"line":517,"code":"  it('should drop and log non-object message types - buffer', function (done) {\n    testNonObjectMessage('return Buffer.from(\"hello\")', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - array","suites":["function node"],"updatePoint":{"line":520,"column":58,"index":14046},"line":520,"code":"  it('should drop and log non-object message types - array', function (done) {\n    testNonObjectMessage('return [[[1,2,3]]]', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - boolean","suites":["function node"],"updatePoint":{"line":523,"column":60,"index":14187},"line":523,"code":"  it('should drop and log non-object message types - boolean', function (done) {\n    testNonObjectMessage('return true', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - number","suites":["function node"],"updatePoint":{"line":526,"column":59,"index":14320},"line":526,"code":"  it('should drop and log non-object message types - number', function (done) {\n    testNonObjectMessage('return 123', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle and log script error","suites":["function node"],"updatePoint":{"line":529,"column":40,"index":14433},"line":529,"code":"  it('should handle and log script error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"var a = 1;\\nretunr\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"function\";\n          });\n          logEvents.should.have.length(1);\n          var msg = logEvents[0][0];\n          msg.should.have.property('level', helper.log().ERROR);\n          msg.should.have.property('id', 'n1');\n          msg.should.have.property('type', 'function');\n          msg.should.have.property('msg', 'ReferenceError: retunr is not defined (line 2, col 1)');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 50);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle node.on()","suites":["function node"],"updatePoint":{"line":561,"column":29,"index":15437},"line":561,"code":"  it('should handle node.on()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.on('close',function(){ node.log('closed')});\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        n1.close().then(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().INFO);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', 'closed');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      }, 100);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set node context","suites":["function node"],"updatePoint":{"line":595,"column":29,"index":16505},"line":595,"code":"  it('should set node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n1.context().get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":620,"column":56,"index":17199},"line":620,"code":"  it('should set persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":653,"column":60,"index":18123},"line":653,"code":"  it('should set two persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1');context.set('count','1','memory2');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (single call, w/o callback)","suites":["function node"],"updatePoint":{"line":689,"column":73,"index":19231},"line":689,"code":"  it('should set two persistable node context (single call, w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set(['count1','count2'],['0','1'],'memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count1\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count2\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable node context (w callback)","suites":["function node"],"updatePoint":{"line":725,"column":54,"index":20305},"line":725,"code":"  it('should set persistable node context (w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (w callback)","suites":["function node"],"updatePoint":{"line":758,"column":58,"index":21252},"line":758,"code":"  it('should set two persistable node context (w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1', function (err) { context.set('count', '1', 'memory2', function (err) { node.send(msg); }); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"0\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (single call, w callback)","suites":["function node"],"updatePoint":{"line":794,"column":71,"index":22406},"line":794,"code":"  it('should set two persistable node context (single call, w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set(['count1','count2'],['0','1'],'memory1', function(err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count1\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count2\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set default persistable node context","suites":["function node"],"updatePoint":{"line":830,"column":49,"index":23499},"line":830,"code":"  it('should set default persistable node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get node context","suites":["function node"],"updatePoint":{"line":863,"column":29,"index":24382},"line":863,"code":"  it('should get node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":909,"column":56,"index":25717},"line":909,"code":"  it('should get persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable node context (w/ callback)","suites":["function node"],"updatePoint":{"line":936,"column":55,"index":26488},"line":936,"code":"  it('should get persistable node context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.get('count','memory1',function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in node context","suites":["function node"],"updatePoint":{"line":963,"column":37,"index":27275},"line":963,"code":"  it('should get keys in node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":988,"column":64,"index":27968},"line":988,"code":"  it('should get keys in persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys('memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable node context (w/ callback)","suites":["function node"],"updatePoint":{"line":1019,"column":63,"index":28825},"line":1019,"code":"  it('should get keys in persistable node context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.keys('memory1', function(err, keys) { msg.payload=keys; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in default persistable node context","suites":["function node"],"updatePoint":{"line":1050,"column":57,"index":29712},"line":1050,"code":"  it('should get keys in default persistable node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n1.context().set(\"number\", \"1\", \"memory2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set flow context","suites":["function node"],"updatePoint":{"line":1082,"column":29,"index":30578},"line":1082,"code":"  it('should set flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n2.context().flow.get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1109,"column":56,"index":31310},"line":1109,"code":"  it('should set persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1144,"column":60,"index":32272},"line":1144,"code":"  it('should set two persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1');flow.set('count','1','memory2');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n2.context().flow.get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1182,"column":55,"index":33402},"line":1182,"code":"  it('should set persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1217,"column":59,"index":34388},"line":1217,"code":"  it('should set two persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1', function (err) { flow.set('count','1','memory2', function (err) { node.send(msg); }); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n2.context().flow.get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get flow context","suites":["function node"],"updatePoint":{"line":1255,"column":29,"index":35538},"line":1255,"code":"  it('should get flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1282,"column":56,"index":36261},"line":1282,"code":"  it('should get persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1311,"column":55,"index":37070},"line":1311,"code":"  it('should get persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.get('count','memory1', function(err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get flow context","suites":["function node"],"updatePoint":{"line":1340,"column":29,"index":37887},"line":1340,"code":"  it('should get flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.flow.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in flow context","suites":["function node"],"updatePoint":{"line":1367,"column":37,"index":38599},"line":1367,"code":"  it('should get keys in flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1394,"column":64,"index":39330},"line":1394,"code":"  it('should get keys in persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.keys('memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1427,"column":63,"index":40225},"line":1427,"code":"  it('should get keys in persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.keys('memory1', function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set global context","suites":["function node"],"updatePoint":{"line":1460,"column":31,"index":41123},"line":1460,"code":"  it('should set global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n2.context().global.get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1485,"column":58,"index":41825},"line":1485,"code":"  it('should set persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().global.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1518,"column":57,"index":42752},"line":1518,"code":"  it('should set persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().global.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get global context","suites":["function node"],"updatePoint":{"line":1551,"column":31,"index":43678},"line":1551,"code":"  it('should get global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1576,"column":58,"index":44371},"line":1576,"code":"  it('should get persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('count', 'memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    initContext(function () {\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", 'memory1');\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1603,"column":57,"index":45151},"line":1603,"code":"  it('should get persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.get('count', 'memory1', function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    initContext(function () {\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", 'memory1');\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get global context","suites":["function node"],"updatePoint":{"line":1630,"column":31,"index":45940},"line":1630,"code":"  it('should get global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.global.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1655,"column":58,"index":46641},"line":1655,"code":"  it('should get persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.global.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '0');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1686,"column":57,"index":47507},"line":1686,"code":"  it('should get persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.global.get('count','memory1', function (err, val) { msg.payload = val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '0');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on get persistable context","suites":["function node"],"updatePoint":{"line":1717,"column":52,"index":48405},"line":1717,"code":"  it('should handle error on get persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count','memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on set persistable context","suites":["function node"],"updatePoint":{"line":1742,"column":52,"index":49091},"line":1742,"code":"  it('should handle error on set persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.set('count','0','memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on get keys in persistable context","suites":["function node"],"updatePoint":{"line":1766,"column":60,"index":49733},"line":1766,"code":"  it('should handle error on get keys in persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys('memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle setTimeout()","suites":["function node"],"updatePoint":{"line":1791,"column":32,"index":50392},"line":1791,"code":"  it('should handle setTimeout()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"setTimeout(function(){node.send(msg);},700);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        var endTime = process.hrtime(startTime);\n        var nanoTime = endTime[0] * 1000000000 + endTime[1];\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n\n        if (600000000 < nanoTime && nanoTime < 800000000) {\n          done();\n        } else {\n          try {\n            should.fail(null, null, \"Delayed time was not between 900 and 1100 ms\");\n          } catch (err) {\n            done(err);\n          }\n        }\n      });\n      var startTime = process.hrtime();\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle setInterval()","suites":["function node"],"updatePoint":{"line":1827,"column":33,"index":51420},"line":1827,"code":"  it('should handle setInterval()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"setInterval(function(){node.send(msg);},100);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        count++;\n\n        if (count > 2) {\n          done();\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle clearInterval()","suites":["function node"],"updatePoint":{"line":1856,"column":35,"index":52125},"line":1856,"code":"  it('should handle clearInterval()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"var id=setInterval(null,100);setTimeout(function(){clearInterval(id);node.send(msg);},500);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id","suites":["function node"],"updatePoint":{"line":1880,"column":36,"index":52801},"line":1880,"code":"  it('should allow accessing node.id', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = node.id; return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', n1.id);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.name","suites":["function node"],"updatePoint":{"line":1903,"column":38,"index":53372},"line":1903,"code":"  it('should allow accessing node.name', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = node.name; return msg;\",\n      \"name\": \"name of node\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', n1.name);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should use the same Date object from outside the sandbox","suites":["function node"],"updatePoint":{"line":1927,"column":62,"index":54001},"line":1927,"code":"  it('should use the same Date object from outside the sandbox', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('typeTest')(new Date());return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"typeTest\", function (d) {\n        return d instanceof Date;\n      });\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', true);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing env vars","suites":["function node"],"updatePoint":{"line":1953,"column":37,"index":54695},"line":1953,"code":"  it('should allow accessing env vars', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = env.get('_TEST_FOO_'); return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      delete process.env._TEST_FOO_;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (count === 0) {\n            msg.should.have.property('payload', undefined);\n            process.env._TEST_FOO_ = \"hello\";\n            count++;\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          } else {\n            msg.should.have.property('payload', \"hello\");\n            delete process.env._TEST_FOO_;\n            done();\n          }\n        } catch (err) {\n          delete process.env._TEST_FOO_;\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should execute initialization","suites":["function node"],"updatePoint":{"line":1994,"column":35,"index":55783},"line":1994,"code":"  it('should execute initialization', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = global.get('X'); return msg;\",\n      initialize: \"global.set('X','bar');\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"bar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should wait completion of initialization","suites":["function node"],"updatePoint":{"line":2017,"column":46,"index":56392},"line":2017,"code":"  it('should wait completion of initialization', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = global.get('X'); return msg;\",\n      initialize: \"global.set('X', '-'); return new Promise((resolve, reject) => setTimeout(() => { global.set('X','bar'); resolve(); }, 500));\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"bar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should execute","suites":["function node","finalize function"],"updatePoint":{"line":2041,"column":22,"index":57125},"line":2041,"code":"    it('should execute', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [],\n        func: \"return msg;\",\n        finalize: \"global.set('X','bar');\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var ctx = n1.context().global;\n        helper.unload().then(function () {\n          ctx.get('X').should.equal(\"bar\");\n          done();\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount","suites":["function node","finalize function"],"updatePoint":{"line":2058,"column":73,"index":57649},"line":2058,"code":"    it('should allow accessing node.id and node.name and node.outputCount', function (done) {\n      var flow = [{\n        id: \"n1\",\n        name: \"test-function\",\n        outputs: 2,\n        type: \"function\",\n        wires: [[\"n2\"]],\n        finalize: \"global.set('finalize-data', { topic: node.name, payload:node.id, outputCount: node.outputCount});\",\n        func: \"return msg;\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var ctx = n1.context().global;\n        helper.unload().then(function () {\n          const finalizeData = ctx.get('finalize-data');\n          should.equal(finalizeData.payload, n1.id);\n          should.equal(finalizeData.topic, n1.name);\n          should.equal(finalizeData.outputCount, n1.outputs);\n          done();\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if using OS module with functionExternalModules set to false","suites":["function node","externalModules"],"updatePoint":{"line":2085,"column":80,"index":58630},"line":2085,"code":"    it('should fail if using OS module with functionExternalModules set to false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"os\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      RED.settings.functionExternalModules = false;\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        should.not.exist(n1);\n        done();\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if using OS module without it listed in libs","suites":["function node","externalModules"],"updatePoint":{"line":2106,"column":64,"index":59225},"line":2106,"code":"    it('should fail if using OS module without it listed in libs', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var messageReceived = false;\n        n2.on(\"input\", function (msg) {\n          messageReceived = true;\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            messageReceived.should.be.false();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should require the OS module","suites":["function node","externalModules"],"updatePoint":{"line":2137,"column":36,"index":60056},"line":2137,"code":"    it('should require the OS module', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"os\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', require('os').type());\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if module variable name clashes with sandbox builtin","suites":["function node","externalModules"],"updatePoint":{"line":2169,"column":72,"index":60956},"line":2169,"code":"    it('should fail if module variable name clashes with sandbox builtin', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"flow\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        should.not.exist(n1);\n        done();\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Info Message","suites":["function node","Logger"],"updatePoint":{"line":2225,"column":34,"index":62569},"line":2225,"code":"    it('should log an Info Message', function (done) {\n      testLog(\"\", \"node.log('test');\", \"INFO\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Debug Message","suites":["function node","Logger"],"updatePoint":{"line":2228,"column":34,"index":62686},"line":2228,"code":"    it('should log a Debug Message', function (done) {\n      testLog(\"\", \"node.debug('test');\", \"DEBUG\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Trace Message","suites":["function node","Logger"],"updatePoint":{"line":2231,"column":34,"index":62806},"line":2231,"code":"    it('should log a Trace Message', function (done) {\n      testLog(\"\", \"node.trace('test');\", \"TRACE\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Warning Message","suites":["function node","Logger"],"updatePoint":{"line":2234,"column":36,"index":62928},"line":2234,"code":"    it('should log a Warning Message', function (done) {\n      testLog(\"\", \"node.warn('test');\", \"WARN\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Error Message","suites":["function node","Logger"],"updatePoint":{"line":2237,"column":35,"index":63047},"line":2237,"code":"    it('should log an Error Message', function (done) {\n      testLog(\"\", \"node.error('test');\", \"ERROR\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Info Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2240,"column":47,"index":63180},"line":2240,"code":"    it('should log an Info Message - initialise', function (done) {\n      testLog(\"node.log('test');\", \"\", \"INFO\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Debug Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2243,"column":47,"index":63310},"line":2243,"code":"    it('should log a Debug Message - initialise', function (done) {\n      testLog(\"node.debug('test');\", \"\", \"DEBUG\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Trace Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2246,"column":47,"index":63443},"line":2246,"code":"    it('should log a Trace Message - initialise', function (done) {\n      testLog(\"node.trace('test');\", \"\", \"TRACE\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Warning Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2249,"column":49,"index":63578},"line":2249,"code":"    it('should log a Warning Message - initialise', function (done) {\n      testLog(\"node.warn('test');\", \"\", \"WARN\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Error Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2252,"column":48,"index":63710},"line":2252,"code":"    it('should log an Error Message - initialise', function (done) {\n      testLog(\"node.error('test');\", \"\", \"ERROR\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown string","suites":["function node","Logger"],"updatePoint":{"line":2255,"column":34,"index":63830},"line":2255,"code":"    it('should catch thrown string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw \\\"small mistake\\\";\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', 'small mistake');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown number","suites":["function node","Logger"],"updatePoint":{"line":2287,"column":34,"index":64867},"line":2287,"code":"    it('should catch thrown number', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw 99;\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', '99');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown object (bad practice)","suites":["function node","Logger"],"updatePoint":{"line":2319,"column":49,"index":65893},"line":2319,"code":"    it('should catch thrown object (bad practice)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw {a:1};\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', '{\"a\":1}');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should delay handling messages until init completes","suites":["function node","init function"],"updatePoint":{"line":2353,"column":59,"index":66985},"line":2353,"code":"    it('should delay handling messages until init completes', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        initialize: `\n                return new Promise((resolve,reject) => {\n                    setTimeout(resolve,200)\n                })`,\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var receivedMsgs = [];\n        n2.on(\"input\", function (msg) {\n          msg.delta = Date.now() - msg.payload;\n          receivedMsgs.push(msg);\n\n          if (receivedMsgs.length === 5) {\n            var errors = receivedMsgs.filter(msg => msg.delta < 200);\n\n            if (errors.length > 0) {\n              done(new Error(`Message received before init completed - was ${msg.delta} expected >300`));\n            } else {\n              done();\n            }\n          }\n        });\n\n        for (var i = 0; i < 5; i++) {\n          n1.receive({\n            payload: Date.now(),\n            topic: \"msg\" + i\n          });\n        }\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount and sending message","suites":["function node","init function"],"updatePoint":{"line":2394,"column":93,"index":68210},"line":2394,"code":"    it('should allow accessing node.id and node.name and node.outputCount and sending message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        name: \"test-function\",\n        outputs: 1,\n        type: \"function\",\n        wires: [[\"n2\"]],\n        initialize: \"setTimeout(function() { node.send({ topic: node.name, payload:node.id, outputCount: node.outputCount})},10)\",\n        func: \"\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            // Use this form of assert as `msg` is created inside\n            // the sandbox and doesn't get all the should.js monkey patching\n            should.equal(msg.payload, n1.id);\n            should.equal(msg.topic, n1.name);\n            should.equal(msg.outputCount, n1.outputs);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with some defaults","suites":["switch Node"],"updatePoint":{"line":59,"column":41,"index":1695},"line":59,"code":"  it('should be loaded with some defaults', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"name\": \"switchNode\"\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      switchNode1.should.have.property('name', 'switchNode');\n      switchNode1.should.have.property('checkall', \"true\");\n      switchNode1.should.have.property('rules', []);\n      done();\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload equals given value","suites":["switch Node"],"updatePoint":{"line":267,"column":48,"index":8202},"line":267,"code":"  it('should check if payload equals given value', function (done) {\n    genericSwitchTest(\"eq\", \"Hello\", true, true, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't equal to desired string","suites":["switch Node"],"updatePoint":{"line":270,"column":77,"index":8371},"line":270,"code":"  it('should return nothing when the payload doesn\\'t equal to desired string', function (done) {\n    genericSwitchTest(\"eq\", \"Hello\", true, false, \"Hello!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload NOT equals given value","suites":["switch Node"],"updatePoint":{"line":273,"column":52,"index":8517},"line":273,"code":"  it('should check if payload NOT equals given value', function (done) {\n    genericSwitchTest(\"neq\", \"Hello\", true, true, \"HEllO\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload does equal to desired string","suites":["switch Node"],"updatePoint":{"line":276,"column":73,"index":8683},"line":276,"code":"  it('should return nothing when the payload does equal to desired string', function (done) {\n    genericSwitchTest(\"neq\", \"Hello\", true, false, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload equals given numeric value","suites":["switch Node"],"updatePoint":{"line":279,"column":56,"index":8833},"line":279,"code":"  it('should check if payload equals given numeric value', function (done) {\n    genericSwitchTest(\"eq\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't equal to desired numeric value","suites":["switch Node"],"updatePoint":{"line":282,"column":84,"index":8997},"line":282,"code":"  it('should return nothing when the payload doesn\\'t equal to desired numeric value', function (done) {\n    genericSwitchTest(\"eq\", 2, true, false, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload NOT equals given numeric value","suites":["switch Node"],"updatePoint":{"line":285,"column":60,"index":9138},"line":285,"code":"  it('should check if payload NOT equals given numeric value', function (done) {\n    genericSwitchTest(\"neq\", 55667744, true, true, -1234, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload does equal to desired numeric value","suites":["switch Node"],"updatePoint":{"line":288,"column":80,"index":9310},"line":288,"code":"  it('should return nothing when the payload does equal to desired numeric value', function (done) {\n    genericSwitchTest(\"neq\", 10, true, false, 10, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is less than given value","suites":["switch Node"],"updatePoint":{"line":291,"column":54,"index":9448},"line":291,"code":"  it('should check if payload is less than given value', function (done) {\n    genericSwitchTest(\"lt\", 3, true, true, 2, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not less than desired string","suites":["switch Node"],"updatePoint":{"line":294,"column":76,"index":9604},"line":294,"code":"  it('should return nothing when the payload is not less than desired string', function (done) {\n    genericSwitchTest(\"lt\", 3, true, false, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload less than equals given value","suites":["switch Node"],"updatePoint":{"line":297,"column":58,"index":9743},"line":297,"code":"  it('should check if payload less than equals given value', function (done) {\n    genericSwitchTest(\"lte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than given value","suites":["switch Node"],"updatePoint":{"line":300,"column":57,"index":9881},"line":300,"code":"  it('should check if payload is greater than given value', function (done) {\n    genericSwitchTest(\"gt\", 3, true, true, 6, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not greater than desired string","suites":["switch Node"],"updatePoint":{"line":303,"column":79,"index":10040},"line":303,"code":"  it('should return nothing when the payload is not greater than desired string', function (done) {\n    genericSwitchTest(\"gt\", 3, true, false, -1, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than/equals given value","suites":["switch Node"],"updatePoint":{"line":306,"column":64,"index":10186},"line":306,"code":"  it('should check if payload is greater than/equals given value', function (done) {\n    genericSwitchTest(\"gte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not greater than desired string","suites":["switch Node"],"updatePoint":{"line":309,"column":79,"index":10346},"line":309,"code":"  it('should return nothing when the payload is not greater than desired string', function (done) {\n    genericSwitchTest(\"gt\", 3, true, false, -1, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than/equals given value","suites":["switch Node"],"updatePoint":{"line":312,"column":64,"index":10492},"line":312,"code":"  it('should check if payload is greater than/equals given value', function (done) {\n    genericSwitchTest(\"gte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match if a payload has a required property","suites":["switch Node"],"updatePoint":{"line":315,"column":55,"index":10628},"line":315,"code":"  it('should match if a payload has a required property', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, true, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if a payload does not have a required property","suites":["switch Node"],"updatePoint":{"line":320,"column":69,"index":10798},"line":320,"code":"  it('should not match if a payload does not have a required property', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, {\n      b: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the key is not a string","suites":["switch Node"],"updatePoint":{"line":325,"column":49,"index":10949},"line":325,"code":"  it('should not match if the key is not a string', function (done) {\n    genericSwitchTest(\"hask\", 1, true, false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the parent object does not exist - null","suites":["switch Node"],"updatePoint":{"line":330,"column":65,"index":11114},"line":330,"code":"  it('should not match if the parent object does not exist - null', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the parent object does not exist - undefined","suites":["switch Node"],"updatePoint":{"line":333,"column":70,"index":11272},"line":333,"code":"  it('should not match if the parent object does not exist - undefined', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given values","suites":["switch Node"],"updatePoint":{"line":336,"column":53,"index":11418},"line":336,"code":"  it('should check if payload is between given values', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"3\", \"5\", true, true, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given values in \"wrong\" order","suites":["switch Node"],"updatePoint":{"line":339,"column":70,"index":11578},"line":339,"code":"  it('should check if payload is between given values in \"wrong\" order', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"5\", \"3\", true, true, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given string values","suites":["switch Node"],"updatePoint":{"line":342,"column":60,"index":11728},"line":342,"code":"  it('should check if payload is between given string values', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"c\", \"e\", true, true, \"d\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not between given values","suites":["switch Node"],"updatePoint":{"line":345,"column":57,"index":11877},"line":345,"code":"  it('should check if payload is not between given values', function (done) {\n    twoFieldSwitchTest(\"btwn\", 3, 5, true, false, 12, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload contains given value","suites":["switch Node"],"updatePoint":{"line":348,"column":50,"index":12015},"line":348,"code":"  it('should check if payload contains given value', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, true, \"Hello World!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't contain desired string","suites":["switch Node"],"updatePoint":{"line":351,"column":76,"index":12192},"line":351,"code":"  it('should return nothing when the payload doesn\\'t contain desired string', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, false, \"This is not a greeting!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match regex","suites":["switch Node"],"updatePoint":{"line":354,"column":24,"index":12329},"line":354,"code":"  it('should match regex', function (done) {\n    genericSwitchTest(\"regex\", \"[abc]+\", true, true, \"abbabac\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type string ","suites":["switch Node"],"updatePoint":{"line":357,"column":48,"index":12475},"line":357,"code":"  it('should check if payload if of type string ', function (done) {\n    genericSwitchTest(\"istype\", \"string\", true, true, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number ","suites":["switch Node"],"updatePoint":{"line":360,"column":48,"index":12620},"line":360,"code":"  it('should check if payload if of type number ', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 999, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number 0","suites":["switch Node"],"updatePoint":{"line":363,"column":49,"index":12762},"line":363,"code":"  it('should check if payload if of type number 0', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number NaN","suites":["switch Node"],"updatePoint":{"line":366,"column":51,"index":12904},"line":366,"code":"  it('should check if payload if of type number NaN', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, false, parseInt(\"banana\"), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number Infinity","suites":["switch Node"],"updatePoint":{"line":369,"column":56,"index":13069},"line":369,"code":"  it('should check if payload if of type number Infinity', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 1 / 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type boolean true","suites":["switch Node"],"updatePoint":{"line":372,"column":53,"index":13217},"line":372,"code":"  it('should check if payload if of type boolean true', function (done) {\n    genericSwitchTest(\"istype\", \"boolean\", true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type boolean false","suites":["switch Node"],"updatePoint":{"line":375,"column":54,"index":13366},"line":375,"code":"  it('should check if payload if of type boolean false', function (done) {\n    genericSwitchTest(\"istype\", \"boolean\", true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type array ","suites":["switch Node"],"updatePoint":{"line":378,"column":47,"index":13508},"line":378,"code":"  it('should check if payload if of type array ', function (done) {\n    genericSwitchTest(\"istype\", \"array\", true, true, [1, 2, 3, \"a\", \"b\"], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type buffer ","suites":["switch Node"],"updatePoint":{"line":381,"column":48,"index":13664},"line":381,"code":"  it('should check if payload if of type buffer ', function (done) {\n    genericSwitchTest(\"istype\", \"buffer\", true, true, Buffer.from(\"Hello\"), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type object ","suites":["switch Node"],"updatePoint":{"line":384,"column":48,"index":13822},"line":384,"code":"  it('should check if payload if of type object ', function (done) {\n    genericSwitchTest(\"istype\", \"object\", true, true, {\n      a: 1,\n      b: \"b\",\n      c: true\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type JSON string ","suites":["switch Node"],"updatePoint":{"line":391,"column":53,"index":14012},"line":391,"code":"  it('should check if payload if of type JSON string ', function (done) {\n    genericSwitchTest(\"istype\", \"json\", true, true, JSON.stringify({\n      a: 1,\n      b: \"b\",\n      c: true\n    }), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type JSON string (and fail if not) ","suites":["switch Node"],"updatePoint":{"line":398,"column":71,"index":14234},"line":398,"code":"  it('should check if payload if of type JSON string (and fail if not) ', function (done) {\n    genericSwitchTest(\"istype\", \"json\", true, false, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type null","suites":["switch Node"],"updatePoint":{"line":401,"column":45,"index":14375},"line":401,"code":"  it('should check if payload if of type null', function (done) {\n    genericSwitchTest(\"istype\", \"null\", true, true, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type undefined","suites":["switch Node"],"updatePoint":{"line":404,"column":50,"index":14517},"line":404,"code":"  it('should check if payload if of type undefined', function (done) {\n    genericSwitchTest(\"istype\", \"undefined\", true, true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow context","suites":["switch Node"],"updatePoint":{"line":407,"column":32,"index":14651},"line":407,"code":"  it('should handle flow context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"foo\",\n      \"propertyType\": \"flow\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"bar\",\n        \"vt\": \"flow\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.context().flow.set(\"foo\", \"flowValue\");\n      switchNode1.context().flow.set(\"bar\", \"flowValue\");\n      switchNode1.receive({\n        payload: \"value\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable flow context","suites":["switch Node"],"updatePoint":{"line":445,"column":44,"index":15654},"line":445,"code":"  it('should handle persistable flow context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"#:(memory1)::foo\",\n      \"propertyType\": \"flow\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"#:(memory1)::bar\",\n        \"vt\": \"flow\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"value\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        switchNode1.context().flow.set(\"foo\", \"flowValue\", \"memory1\", function (err) {\n          switchNode1.context().flow.set(\"bar\", \"flowValue\", \"memory1\", function (err) {\n            switchNode1.receive({\n              payload: \"value\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle global context","suites":["switch Node"],"updatePoint":{"line":487,"column":34,"index":16839},"line":487,"code":"  it('should handle global context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"foo\",\n      \"propertyType\": \"global\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"bar\",\n        \"vt\": \"global\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.context().global.set(\"foo\", \"globalValue\");\n      switchNode1.context().global.set(\"bar\", \"globalValue\");\n      switchNode1.receive({\n        payload: \"value\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable global context","suites":["switch Node"],"updatePoint":{"line":524,"column":46,"index":17837},"line":524,"code":"  it('should handle persistable global context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"#:(memory1)::foo\",\n      \"propertyType\": \"global\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"#:(memory1)::bar\",\n        \"vt\": \"global\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        switchNode1.context().global.set(\"foo\", \"globalValue\", \"memory1\", function (err) {\n          switchNode1.context().global.set(\"bar\", \"globalValue\", \"memory1\", function (err) {\n            switchNode1.receive({\n              payload: \"foo\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare value - matches","suites":["switch Node"],"updatePoint":{"line":565,"column":69,"index":19046},"line":565,"code":"  it('should use a nested message property to compare value - matches', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"bar\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, true, {\n      topic: \"foo\",\n      payload: {\n        \"foo\": \"bar\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare value - no match","suites":["switch Node"],"updatePoint":{"line":590,"column":70,"index":19613},"line":590,"code":"  it('should use a nested message property to compare value - no match', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"bar\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, false, {\n      topic: \"foo\",\n      payload: {\n        \"foo\": \"none\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare nested message property - matches","suites":["switch Node"],"updatePoint":{"line":615,"column":87,"index":20199},"line":615,"code":"  it('should use a nested message property to compare nested message property - matches', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"payload[msg.topic2]\",\n        vt: \"msg\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, true, {\n      topic: \"foo\",\n      topic2: \"foo2\",\n      payload: {\n        \"foo\": \"bar\",\n        \"foo2\": \"bar\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare nested message property - no match","suites":["switch Node"],"updatePoint":{"line":643,"column":88,"index":20864},"line":643,"code":"  it('should use a nested message property to compare nested message property - no match', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"payload[msg.topic2]\",\n        vt: \"msg\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, false, {\n      topic: \"foo\",\n      topic2: \"foo2\",\n      payload: {\n        \"foo\": \"bar\",\n        \"foo2\": \"none\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match regex with ignore-case flag set true","suites":["switch Node"],"updatePoint":{"line":671,"column":55,"index":21498},"line":671,"code":"  it('should match regex with ignore-case flag set true', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\",\n        \"case\": true\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match regex with ignore-case flag unset","suites":["switch Node"],"updatePoint":{"line":692,"column":56,"index":22006},"line":692,"code":"  it('should not match regex with ignore-case flag unset', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, false, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match regex with ignore-case flag set false","suites":["switch Node"],"updatePoint":{"line":712,"column":60,"index":22497},"line":712,"code":"  it('should not match regex with ignore-case flag set false', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\",\n        case: false\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, false, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't match regex","suites":["switch Node"],"updatePoint":{"line":733,"column":65,"index":23014},"line":733,"code":"  it('should return nothing when the payload doesn\\'t match regex', function (done) {\n    genericSwitchTest(\"regex\", \"\\\\d+\", true, false, \"This is not a digit\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't contain desired string","suites":["switch Node"],"updatePoint":{"line":736,"column":76,"index":23199},"line":736,"code":"  it('should return nothing when the payload doesn\\'t contain desired string', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, false, \"This is not a greeting!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is true","suites":["switch Node"],"updatePoint":{"line":739,"column":35,"index":23347},"line":739,"code":"  it('should check if input is true', function (done) {\n    singularSwitchTest(true, true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends nothing when input is false and checking for true","suites":["switch Node"],"updatePoint":{"line":742,"column":61,"index":23489},"line":742,"code":"  it('sends nothing when input is false and checking for true', function (done) {\n    singularSwitchTest(true, true, false, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed false","suites":["switch Node"],"updatePoint":{"line":745,"column":43,"index":23615},"line":745,"code":"  it('should check if input is indeed false', function (done) {\n    singularSwitchTest(false, true, true, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends nothing when input is false and checking for true","suites":["switch Node"],"updatePoint":{"line":748,"column":61,"index":23759},"line":748,"code":"  it('sends nothing when input is false and checking for true', function (done) {\n    singularSwitchTest(false, true, false, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (string)","suites":["switch Node"],"updatePoint":{"line":751,"column":47,"index":23889},"line":751,"code":"  it('should check if payload is empty (string)', function (done) {\n    singularSwitchTest(\"empty\", true, true, \"\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (array)","suites":["switch Node"],"updatePoint":{"line":754,"column":46,"index":24017},"line":754,"code":"  it('should check if payload is empty (array)', function (done) {\n    singularSwitchTest(\"empty\", true, true, [], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (buffer)","suites":["switch Node"],"updatePoint":{"line":757,"column":47,"index":24146},"line":757,"code":"  it('should check if payload is empty (buffer)', function (done) {\n    singularSwitchTest(\"empty\", true, true, Buffer.alloc(0), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (object)","suites":["switch Node"],"updatePoint":{"line":760,"column":47,"index":24288},"line":760,"code":"  it('should check if payload is empty (object)', function (done) {\n    singularSwitchTest(\"empty\", true, true, {}, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty string)","suites":["switch Node"],"updatePoint":{"line":763,"column":57,"index":24427},"line":763,"code":"  it('should check if payload is empty (non-empty string)', function (done) {\n    singularSwitchTest(\"empty\", true, false, \"1\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty array)","suites":["switch Node"],"updatePoint":{"line":766,"column":56,"index":24567},"line":766,"code":"  it('should check if payload is empty (non-empty array)', function (done) {\n    singularSwitchTest(\"empty\", true, false, [1], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty buffer)","suites":["switch Node"],"updatePoint":{"line":769,"column":57,"index":24708},"line":769,"code":"  it('should check if payload is empty (non-empty buffer)', function (done) {\n    singularSwitchTest(\"empty\", true, false, Buffer.alloc(1), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty object)","suites":["switch Node"],"updatePoint":{"line":772,"column":57,"index":24861},"line":772,"code":"  it('should check if payload is empty (non-empty object)', function (done) {\n    singularSwitchTest(\"empty\", true, false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (null)","suites":["switch Node"],"updatePoint":{"line":777,"column":45,"index":25005},"line":777,"code":"  it('should check if payload is empty (null)', function (done) {\n    singularSwitchTest(\"empty\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (undefined)","suites":["switch Node"],"updatePoint":{"line":780,"column":50,"index":25140},"line":780,"code":"  it('should check if payload is empty (undefined)', function (done) {\n    singularSwitchTest(\"empty\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (0)","suites":["switch Node"],"updatePoint":{"line":783,"column":42,"index":25272},"line":783,"code":"  it('should check if payload is empty (0)', function (done) {\n    singularSwitchTest(\"empty\", true, false, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (string)","suites":["switch Node"],"updatePoint":{"line":786,"column":51,"index":25405},"line":786,"code":"  it('should check if payload is not empty (string)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, \"\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (array)","suites":["switch Node"],"updatePoint":{"line":789,"column":50,"index":25539},"line":789,"code":"  it('should check if payload is not empty (array)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, [], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (buffer)","suites":["switch Node"],"updatePoint":{"line":792,"column":51,"index":25674},"line":792,"code":"  it('should check if payload is not empty (buffer)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, Buffer.alloc(0), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (object)","suites":["switch Node"],"updatePoint":{"line":795,"column":51,"index":25822},"line":795,"code":"  it('should check if payload is not empty (object)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, {}, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty string)","suites":["switch Node"],"updatePoint":{"line":798,"column":61,"index":25967},"line":798,"code":"  it('should check if payload is not empty (non-empty string)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, \"1\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty array)","suites":["switch Node"],"updatePoint":{"line":801,"column":60,"index":26113},"line":801,"code":"  it('should check if payload is not empty (non-empty array)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, [1], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty buffer)","suites":["switch Node"],"updatePoint":{"line":804,"column":61,"index":26260},"line":804,"code":"  it('should check if payload is not empty (non-empty buffer)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, Buffer.alloc(1), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty object)","suites":["switch Node"],"updatePoint":{"line":807,"column":61,"index":26419},"line":807,"code":"  it('should check if payload is not empty (non-empty object)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (null)","suites":["switch Node"],"updatePoint":{"line":812,"column":49,"index":26569},"line":812,"code":"  it('should check if payload is not empty (null)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (undefined)","suites":["switch Node"],"updatePoint":{"line":815,"column":54,"index":26709},"line":815,"code":"  it('should check if payload is not empty (undefined)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (0)","suites":["switch Node"],"updatePoint":{"line":818,"column":46,"index":26846},"line":818,"code":"  it('should check if payload is not empty (0)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check input against a previous value","suites":["switch Node"],"updatePoint":{"line":821,"column":49,"index":26978},"line":821,"code":"  it('should check input against a previous value', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": \"\",\n        \"vt\": \"prev\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          try {\n            if (c === 0) {\n              msg.payload.should.equal(1);\n            }\n\n            if (c === 1) {\n              msg.payload.should.equal(2);\n              done();\n            }\n\n            c += 1;\n          } catch (err) {\n            done(err);\n          }\n        } else {\n          done();\n        }\n      });\n      switchNode1.receive({\n        payload: 1\n      });\n      switchNode1.receive({\n        payload: 0\n      });\n      switchNode1.receive({\n        payload: -2\n      });\n      switchNode1.receive({\n        payload: 2\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check input against a previous value (2nd option)","suites":["switch Node"],"updatePoint":{"line":878,"column":62,"index":28249},"line":878,"code":"  it('should check input against a previous value (2nd option)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"10\",\n        \"vt\": \"num\",\n        \"v2\": \"\",\n        \"v2t\": \"prev\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          try {\n            if (c === 0) {\n              msg.payload.should.equal(20);\n            }\n\n            if (c === 1) {\n              msg.payload.should.equal(25);\n              done();\n            }\n\n            c += 1;\n          } catch (err) {\n            done(err);\n          }\n        } else {//done();\n        }\n      });\n      switchNode1.receive({\n        payload: 0\n      });\n      switchNode1.receive({\n        payload: 20\n      }); // between 10 and 0\n\n      switchNode1.receive({\n        payload: 30\n      }); // between 10 and 20\n\n      switchNode1.receive({\n        payload: 20\n      }); // between 10 and 30  yes\n\n      switchNode1.receive({\n        payload: 30\n      }); // between 10 and 20  no\n\n      switchNode1.receive({\n        payload: 25\n      }); // between 10 and 30  yes\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed null","suites":["switch Node"],"updatePoint":{"line":946,"column":42,"index":29777},"line":946,"code":"  it('should check if input is indeed null', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"null\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload === null) {\n          done();\n        } else {\n          console.log(\"msg is \", msg);\n        }\n      });\n      switchNode1.receive({\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed undefined","suites":["switch Node"],"updatePoint":{"line":978,"column":47,"index":30569},"line":978,"code":"  it('should check if input is indeed undefined', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"null\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload === undefined) {\n          done();\n        } else {\n          console.log(\"msg is \", msg);\n        }\n      });\n      switchNode1.receive({\n        payload: undefined\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should treat non-existant msg property conditional as undefined","suites":["switch Node"],"updatePoint":{"line":1010,"column":69,"index":31393},"line":1010,"code":"  it('should treat non-existant msg property conditional as undefined', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"z\": \"feee1df.c3263e\",\n      \"name\": \"\",\n      \"property\": \"payload\",\n      \"propertyType\": \"msg\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"this.does.not.exist\",\n        \"vt\": \"msg\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": 1,\n      \"x\": 190,\n      \"y\": 440,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var received = [];\n      helperNode1.on(\"input\", function (msg) {\n        received.push(msg);\n      }); // First message should be dropped as payload is not undefined\n\n      switchNode1.receive({\n        topic: \"messageOne\",\n        payload: \"\"\n      }); // Second message should pass through as payload is undefined\n\n      switchNode1.receive({\n        topic: \"messageTwo\",\n        payload: undefined\n      });\n      setTimeout(function () {\n        try {\n          received.should.have.lengthOf(1);\n          received[0].should.have.a.property(\"topic\", \"messageTwo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 500);\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed not null","suites":["switch Node"],"updatePoint":{"line":1061,"column":46,"index":32764},"line":1061,"code":"  it('should check if input is indeed not null', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"nnull\"\n      }],\n      checkall: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          done();\n        } else {\n          try {\n            msg.payload.should.equal(\"Anything here\");\n          } catch (err) {\n            done(err);\n          }\n        }\n      });\n      switchNode1.receive({\n        payload: \"Anything here\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends a message when the \"else/otherwise\" statement is selected","suites":["switch Node"],"updatePoint":{"line":1097,"column":69,"index":33675},"line":1097,"code":"  it('sends a message when the \"else/otherwise\" statement is selected', function (done) {\n    singularSwitchTest(\"else\", true, true, 123456, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"handles more than one switch statement","suites":["switch Node"],"updatePoint":{"line":1100,"column":44,"index":33804},"line":1100,"code":"  it('handles more than one switch statement', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"Hello\"\n      }, {\n        \"t\": \"cont\",\n        \"v\": \"ello\"\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      outputs: 3,\n      wires: [[\"helperNode1\"], [\"helperNode2\"], [\"helperNode3\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode3\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var helperNode2 = helper.getNode(\"helperNode2\");\n      var helperNode3 = helper.getNode(\"helperNode3\");\n      var nodeHitCount = 0;\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          nodeHitCount++;\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          nodeHitCount++;\n\n          if (nodeHitCount == 2) {\n            done();\n          } else {\n            try {\n              should.fail(null, null, \"Both statements should be triggered!\");\n            } catch (err) {\n              done(err);\n            }\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode3.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"Hello\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"stops after first statement","suites":["switch Node"],"updatePoint":{"line":1175,"column":33,"index":35695},"line":1175,"code":"  it('stops after first statement', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"Hello\"\n      }, {\n        \"t\": \"cont\",\n        \"v\": \"ello\"\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: \"false\",\n      outputs: 3,\n      wires: [[\"helperNode1\"], [\"helperNode2\"], [\"helperNode3\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode3\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var helperNode2 = helper.getNode(\"helperNode2\");\n      var helperNode3 = helper.getNode(\"helperNode3\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode2.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode3.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"Hello\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle JSONata expression","suites":["switch Node"],"updatePoint":{"line":1238,"column":38,"index":37333},"line":1238,"code":"  it('should handle JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs(payload)\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$sqrt(16)\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$sqrt(36)\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, -5, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow and global contexts with JSONata expression","suites":["switch Node"],"updatePoint":{"line":1262,"column":68,"index":37932},"line":1262,"code":"  it('should handle flow and global contexts with JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs($flowContext(\\\"payload\\\"))\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$flowContext(\\\"vt\\\")\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$globalContext(\\\"v2t\\\")\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]],\n      z: \"flow\"\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: [],\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      switchNode1.context().flow.set(\"payload\", -5);\n      switchNode1.context().flow.set(\"vt\", 4);\n      switchNode1.context().global.set(\"v2t\", 6);\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.payload, \"pass\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"pass\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable flow and global contexts with JSONata expression","suites":["switch Node"],"updatePoint":{"line":1308,"column":80,"index":39184},"line":1308,"code":"  it('should handle persistable flow and global contexts with JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs($flowContext(\\\"payload\\\",\\\"memory1\\\"))\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$flowContext(\\\"vt\\\",\\\"memory1\\\")\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$globalContext(\\\"v2t\\\",\\\"memory1\\\")\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]],\n      z: \"flow\"\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: [],\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        switchNode1.context().flow.set([\"payload\", \"vt\"], [-7, 6], \"memory1\", function () {\n          switchNode1.context().global.set(\"v2t\", 8, \"memory1\", function () {\n            helperNode1.on(\"input\", function (msg) {\n              try {\n                should.equal(msg.payload, \"pass\");\n                done();\n              } catch (err) {\n                done(err);\n              }\n            });\n            switchNode1.receive({\n              payload: \"pass\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle env var expression","suites":["switch Node"],"updatePoint":{"line":1357,"column":38,"index":40588},"line":1357,"code":"  it('should handle env var expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"VAR\",\n      propertyType: \"env\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"VAL\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    process.env.VAR = \"VAL\";\n    customFlowSwitchTest(flow, true, \"OK\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1379,"column":54,"index":41104},"line":1379,"code":"  it('should take head of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": 3\n      }],\n      checkall: false,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1400,"column":51,"index":41627},"line":1400,"code":"  it('should take head of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": 3\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (w. context)","suites":["switch Node"],"updatePoint":{"line":1421,"column":55,"index":42152},"line":1421,"code":"  it('should take head of message sequence (w. context)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": \"count\",\n        vt: \"global\"\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, function (node) {\n      node.context().global.set(\"count\", 3);\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (w. JSONata)","suites":["switch Node"],"updatePoint":{"line":1445,"column":55,"index":42764},"line":1445,"code":"  it('should take head of message sequence (w. JSONata)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": \"1+4/2\",\n        vt: \"jsonata\"\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take tail of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1467,"column":54,"index":43317},"line":1467,"code":"  it('should take tail of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 3\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [2, 3, 4], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take tail of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1488,"column":51,"index":43839},"line":1488,"code":"  it('should take tail of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 3\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [2, 3, 4], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take slice of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1509,"column":55,"index":44363},"line":1509,"code":"  it('should take slice of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"index\",\n        \"v\": 1,\n        \"v2\": 3\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 2, 3], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take slice of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1531,"column":52,"index":44904},"line":1531,"code":"  it('should take slice of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"index\",\n        \"v\": 1,\n        \"v2\": 3\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 2, 3], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check JSONata expression is true","suites":["switch Node"],"updatePoint":{"line":1553,"column":45,"index":45436},"line":1553,"code":"  it('should check JSONata expression is true', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"payload%2 = 1\",\n        \"vt\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, 9, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use $I in JSONata expression","suites":["switch Node"],"updatePoint":{"line":1574,"column":52,"index":45939},"line":1574,"code":"  it('should be able to use $I in JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"$I % 2 = 1\",\n        vt: \"jsonata\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 3], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use $N in JSONata expression","suites":["switch Node"],"updatePoint":{"line":1596,"column":52,"index":46498},"line":1596,"code":"  it('should be able to use $N in JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"payload >= $N-2\",\n        vt: \"jsonata\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [3, 4], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not repair message sequence for each port","suites":["switch Node"],"updatePoint":{"line":1714,"column":54,"index":49602},"line":1714,"code":"  it('should not repair message sequence for each port', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": 0\n      }, {\n        \"t\": \"lt\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    }];\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2],\n        vf: function (x) {\n          return x > 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, -1],\n        vf: function (x) {\n          return x < 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [0],\n        vf: function (x) {\n          return x == 0;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should repair message sequence for each port","suites":["switch Node"],"updatePoint":{"line":1772,"column":50,"index":50716},"line":1772,"code":"  it('should repair message sequence for each port', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": 0\n      }, {\n        \"t\": \"lt\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }, // >0\n    {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    }, // <0\n    {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    } // ==0\n    ];\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2],\n        vf: function (x) {\n          return x > 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, -1],\n        vf: function (x) {\n          return x < 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [0],\n        vf: function (x) {\n          return x == 0;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should repair message sequence for each port (overlap)","suites":["switch Node"],"updatePoint":{"line":1833,"column":60,"index":51870},"line":1833,"code":"  it('should repair message sequence for each port (overlap)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gte\",\n        \"v\": 0\n      }, {\n        \"t\": \"lte\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }, // >=0\n    {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    }, // <=0\n    {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    } // none\n    ];\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2, 0],\n        vf: function (x) {\n          return x >= 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, 0, -1],\n        vf: function (x) {\n          return x <= 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [],\n        vf: function (x) {\n          return false;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["switch Node"],"updatePoint":{"line":1894,"column":45,"index":53020},"line":1894,"code":"  it('should handle too many pending messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 2\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 3,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"switch\");\n        evt.should.have.property('msg', \"switch.errors.too-many\");\n        done();\n      }, 150);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid jsonata expression","suites":["switch Node"],"updatePoint":{"line":1960,"column":46,"index":54480},"line":1960,"code":"  it('should handle invalid jsonata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$invalidExpression(payload)\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$sqrt(16)\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$sqrt(36)\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"switchNode1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"switchNode1\");\n        evt.should.have.property('type', \"switch\");\n        done();\n      }, 150);\n      n1.receive({\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty rule","suites":["switch Node"],"updatePoint":{"line":1998,"column":30,"index":55481},"line":1998,"code":"  it('should handle empty rule', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [],\n      checkall: true,\n      outputs: 0,\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"switchNode1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n\n        if (logEvents.length === 0) {\n          done();\n        }\n      }, 150);\n      n1.receive({\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should load node with defaults","suites":["change Node"],"updatePoint":{"line":58,"column":36,"index":1604},"line":58,"code":"  it('should load node with defaults', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\"\n    }];\n    helper.load(changeNode, flow, function () {\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        fromt: 'str',\n        pt: 'msg',\n        tot: 'str',\n        t: undefined,\n        p: ''\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load defaults if set to replace","suites":["change Node"],"updatePoint":{"line":76,"column":44,"index":2067},"line":76,"code":"  it('should load defaults if set to replace', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\",\n      action: \"replace\"\n    }];\n    helper.load(changeNode, flow, function () {\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        fromt: 'str',\n        p: '',\n        pt: 'msg',\n        t: 'set',\n        to: '',\n        tot: 'str'\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load defaults if set to change","suites":["change Node"],"updatePoint":{"line":96,"column":43,"index":2566},"line":96,"code":"  it('should load defaults if set to change', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\",\n      action: \"change\"\n    }];\n    helper.load(changeNode, flow, function () {\n      //console.log(helper.getNode(\"c1\"));\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        from: '',\n        fromRE: /(?:)/g,\n        fromt: 'str',\n        p: '',\n        pt: 'msg',\n        re: undefined,\n        t: 'change',\n        to: '',\n        tot: 'str'\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should no-op if there are no rules","suites":["change Node"],"updatePoint":{"line":120,"column":40,"index":3173},"line":120,"code":"  it('should no-op if there are no rules', function (done) {\n    var flow = [{\n      \"id\": \"changeNode1\",\n      \"type\": \"change\",\n      \"rules\": [],\n      \"action\": \"\",\n      \"property\": \"\",\n      \"from\": \"\",\n      \"to\": \"\",\n      \"reg\": false,\n      \"name\": \"changeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(changeNode, flow, function () {\n      var changeNode1 = helper.getNode(\"changeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.should.eql(sentMsg);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var sentMsg = {\n        payload: \"leaveMeAlong\"\n      };\n      changeNode1.receive(sentMsg);\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of the message property","suites":["change Node","#set"],"updatePoint":{"line":155,"column":46,"index":4048},"line":155,"code":"    it('sets the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"changed\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"changed\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of global context property","suites":["change Node","#set"],"updatePoint":{"line":187,"column":49,"index":4936},"line":187,"code":"    it('sets the value of global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"globalValue\",\n          \"pt\": \"global\",\n          \"to\": \"changed\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            changeNode1.context().global.get(\"globalValue\").should.equal(\"changed\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"changeMe\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable global context property","suites":["change Node","#set"],"updatePoint":{"line":222,"column":61,"index":5964},"line":222,"code":"    it('sets the value of persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"#:(memory1)::globalValue\",\n          \"pt\": \"global\",\n          \"to\": \"changed\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              changeNode1.context().global.get(\"globalValue\", \"memory1\", function (err, val) {\n                val.should.equal(\"changed\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"changeMe\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value and type of the message property","suites":["change Node","#set"],"updatePoint":{"line":262,"column":55,"index":7193},"line":262,"code":"    it('sets the value and type of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"12345\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(12345);\n            var t = typeof msg.payload;\n            t.should.equal(\"number\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of an already set multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":299,"column":69,"index":8219},"line":299,"code":"    it('sets the value of an already set multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"bar\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          foo: {\n            bar: \"foo\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of an empty multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":333,"column":63,"index":9135},"line":333,"code":"    it('sets the value of an empty multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"bar\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({});\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property to another message property","suites":["change Node","#set"],"updatePoint":{"line":363,"column":72,"index":9999},"line":363,"code":"    it('sets the value of a message property to another message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo\",\n        \"from\": \"\",\n        \"to\": \"msg.fred\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        var rule = helper.getNode(\"changeNode1\").rules[0];\n        rule.t.should.eql('set');\n        rule.tot.should.eql('msg');\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          fred: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a multi-level message property to another multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":398,"column":96,"index":11044},"line":398,"code":"    it('sets the value of a multi-level message property to another multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"msg.fred.red\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          fred: {\n            red: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"doesn't set the value of a message property when the 'to' message property does not exist","suites":["change Node","#set"],"updatePoint":{"line":432,"column":100,"index":12007},"line":432,"code":"    it('doesn\\'t set the value of a message property when the \\'to\\' message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"msg.fred.red\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.foo);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({});\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"overrides the value of a message property when the 'to' message property does not exist","suites":["change Node","#set"],"updatePoint":{"line":462,"column":97,"index":12899},"line":462,"code":"    it('overrides the value of a message property when the \\'to\\' message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.foo\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the message property to null when the 'to' message property equals null","suites":["change Node","#set"],"updatePoint":{"line":494,"column":86,"index":13815},"line":494,"code":"    it('sets the message property to null when the \\'to\\' message property equals null', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.foo\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            (msg.payload === null).should.be.true();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello\",\n          foo: null\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"does not set other properties using = inside to property","suites":["change Node","#set"],"updatePoint":{"line":527,"column":64,"index":14740},"line":527,"code":"    it('does not set other properties using = inside to property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.otherProp=10\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"splits dot delimited properties into objects","suites":["change Node","#set"],"updatePoint":{"line":559,"column":52,"index":15634},"line":559,"code":"    it('splits dot delimited properties into objects', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"pay.load\",\n        \"from\": \"\",\n        \"to\": \"10\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.pay.load.should.equal(\"10\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          pay: {\n            load: \"changeMe\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to flow context property","suites":["change Node","#set"],"updatePoint":{"line":593,"column":50,"index":16543},"line":593,"code":"    it('changes the value to flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"flowValue\",\n          \"tot\": \"flow\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"flowValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to persistable flow context property","suites":["change Node","#set"],"updatePoint":{"line":628,"column":62,"index":17533},"line":628,"code":"    it('changes the value to persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"#:(memory1)::flowValue\",\n          \"tot\": \"flow\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"Hello World!\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"flowValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to global context property","suites":["change Node","#set"],"updatePoint":{"line":666,"column":52,"index":18647},"line":666,"code":"    it('changes the value to global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"globalValue\",\n          \"tot\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to persistable global context property","suites":["change Node","#set"],"updatePoint":{"line":700,"column":64,"index":19626},"line":700,"code":"    it('changes the value to persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"#:(memory1)::globalValue\",\n          \"tot\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"Hello World!\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a number","suites":["change Node","#set"],"updatePoint":{"line":737,"column":37,"index":20712},"line":737,"code":"    it('changes the value to a number', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"123\",\n          \"tot\": \"num\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(123);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a boolean value","suites":["change Node","#set"],"updatePoint":{"line":770,"column":44,"index":21576},"line":770,"code":"    it('changes the value to a boolean value', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"true\",\n          \"tot\": \"bool\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(true);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a js object","suites":["change Node","#set"],"updatePoint":{"line":803,"column":40,"index":22439},"line":803,"code":"    it('changes the value to a js object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": '{\"a\":123}',\n          \"tot\": \"json\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql({\n              a: 123\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a buffer object","suites":["change Node","#set"],"updatePoint":{"line":838,"column":44,"index":23343},"line":838,"code":"    it('changes the value to a buffer object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"[72,101,108,108,111,32,87,111,114,108,100]\",\n          \"tot\": \"bin\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            var buff = Buffer.from(\"Hello World\");\n            msg.payload.should.eql(buff);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of the message property to the current timestamp","suites":["change Node","#set"],"updatePoint":{"line":872,"column":71,"index":24325},"line":872,"code":"    it('sets the value of the message property to the current timestamp', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"ts\",\n          \"pt\": \"msg\",\n          \"to\": \"\",\n          \"tot\": \"date\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            (Date.now() - msg.ts).should.be.approximately(0, 50);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: Date.now()\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property","suites":["change Node","#set","env var"],"updatePoint":{"line":913,"column":43,"index":25427},"line":913,"code":"      it('sets the value using env property', function (done) {\n        var flow = [{\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"foo\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from tab","suites":["change Node","#set","env var"],"updatePoint":{"line":948,"column":52,"index":26427},"line":948,"code":"      it('sets the value using env property from tab', function (done) {\n        var flow = [{\n          \"id\": \"tab1\",\n          \"type\": \"tab\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"z\": \"tab1\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from group","suites":["change Node","#set","env var"],"updatePoint":{"line":992,"column":54,"index":27634},"line":992,"code":"      it('sets the value using env property from group', function (done) {\n        var flow = [{\n          \"id\": \"group1\",\n          \"type\": \"group\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"g\": \"group1\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from nested group","suites":["change Node","#set","env var"],"updatePoint":{"line":1036,"column":61,"index":28854},"line":1036,"code":"      it('sets the value using env property from nested group', function (done) {\n        var flow = [{\n          \"id\": \"group1\",\n          \"type\": \"group\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"group2\",\n          \"type\": \"group\",\n          \"g\": \"group1\",\n          \"env\": []\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"g\": \"group2\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1086,"column":39,"index":30171},"line":1086,"code":"    it('changes the value using jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$length(payload)\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(12);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid jsonata expression","suites":["change Node","#set","env var"],"updatePoint":{"line":1119,"column":42,"index":31061},"line":1119,"code":"    it('reports invalid jsonata expression', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$invalid(payload)\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          done(\"Invalid jsonata expression passed message through\");\n        });\n        changeNode1.on(\"call:error\", function (err) {\n          // Expect error to be called\n          done();\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using flow context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1151,"column":57,"index":32022},"line":1151,"code":"    it('changes the value using flow context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$flowContext(\\\"foo\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        changeNode1.context().flow.set(\"foo\", \"bar\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using global context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1190,"column":59,"index":33088},"line":1190,"code":"    it('changes the value using global context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$globalContext(\\\"foo\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        changeNode1.context().global.set(\"foo\", \"bar\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable flow context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1229,"column":69,"index":34168},"line":1229,"code":"    it('changes the value using persistable flow context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$flowContext(\\\"foo\\\",\\\"memory1\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"foo\", \"bar\", \"memory1\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              changeNode1.context().flow.set(\"foo\", \"error!\");\n              changeNode1.receive({\n                payload: \"Hello World!\"\n              });\n            }\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable global context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1276,"column":71,"index":35531},"line":1276,"code":"    it('changes the value using persistable global context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$globalContext(\\\"foo\\\",\\\"memory1\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"foo\", \"bar\", \"memory1\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              changeNode1.context().global.set(\"foo\", \"error!\");\n              changeNode1.receive({\n                payload: \"Hello World!\"\n              });\n            }\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property","suites":["change Node","#set","env var"],"updatePoint":{"line":1323,"column":68,"index":36897},"line":1323,"code":"    it('sets the value of a message property using a nested property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\",\n          lookup: {\n            a: 1,\n            b: 2\n          },\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a nested message property using a message property","suites":["change Node","#set","env var"],"updatePoint":{"line":1367,"column":76,"index":38018},"line":1367,"code":"    it('sets the value of a nested message property using a message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"lookup[msg.topic]\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.lookup.b.should.equal(\"newValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var msg = {\n          payload: \"newValue\",\n          lookup: {\n            a: 1,\n            b: 2\n          },\n          topic: \"b\"\n        };\n        changeNode1.receive(msg);\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property in flow context","suites":["change Node","#set","env var"],"updatePoint":{"line":1412,"column":84,"index":39188},"line":1412,"code":"    it('sets the value of a message property using a nested property in flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"flow\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property in flow context","suites":["change Node","#set","env var"],"updatePoint":{"line":1457,"column":84,"index":40363},"line":1457,"code":"    it('sets the value of a message property using a nested property in flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"flow\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a nested flow context property using a message property","suites":["change Node","#set","env var"],"updatePoint":{"line":1502,"column":81,"index":41535},"line":1502,"code":"    it('sets the value of a nested flow context property using a message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"lookup[msg.topic]\",\n          \"pt\": \"flow\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"newValue\");\n            changeNode1.context().flow.get(\"lookup.b\").should.eql(\"newValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"newValue\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deep copies the property if selected","suites":["change Node","#set","env var"],"updatePoint":{"line":1548,"column":44,"index":42766},"line":1548,"code":"    it('deep copies the property if selected', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"source\",\n          \"tot\": \"msg\",\n          \"dc\": true\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            // Check payload has been set to a clone of original object\n            // - the JSON should match\n            JSON.stringify(msg.payload).should.equal(JSON.stringify(originalObject)); // - but they must be different objects\n\n            msg.payload.should.not.equal(originalObject); // Modify nested property of original object\n\n            originalObject.a.c = 3; // Check that modification hasn't happened on cloned prop\n\n            msg.payload.a.should.not.have.property('c');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var originalObject = {\n          a: {\n            b: 2\n          }\n        };\n        changeNode1.receive({\n          source: originalObject\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the message property","suites":["change Node","#change"],"updatePoint":{"line":1598,"column":49,"index":44277},"line":1598,"code":"    it('changes the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the message property for partial match","suites":["change Node","#change"],"updatePoint":{"line":1630,"column":90,"index":45221},"line":1630,"code":"    it('changes the value and doesnt change type of the message property for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Change456Me\");\n            var t = typeof msg.payload;\n            t.should.equal(\"string\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Change123Me\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the message property if a complete match","suites":["change Node","#change"],"updatePoint":{"line":1669,"column":78,"index":46319},"line":1669,"code":"    it('changes the value and type of the message property if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(456);\n            var t = typeof msg.payload;\n            t.should.equal(\"number\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"123\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of a multi-level message property","suites":["change Node","#change"],"updatePoint":{"line":1708,"column":59,"index":47380},"line":1708,"code":"    it('changes the value of a multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo.bar\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          foo: {\n            bar: \"Hello World!\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if the changed message property does not exist","suites":["change Node","#change"],"updatePoint":{"line":1742,"column":78,"index":48339},"line":1742,"code":"    it('sends unaltered message if the changed message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if a changed multi-level message property does not exist","suites":["change Node","#change"],"updatePoint":{"line":1774,"column":88,"index":49275},"line":1774,"code":"    it('sends unaltered message if a changed multi-level message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo.bar\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the message property based on a regex","suites":["change Node","#change"],"updatePoint":{"line":1806,"column":66,"index":50193},"line":1806,"code":"    it('changes the value of the message property based on a regex', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"\\\\d+\",\n        \"to\": \"NUMBER\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Replace all numbers NUMBER and NUMBER\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Replace all numbers 12 and 14\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"supports regex groups","suites":["change Node","#change"],"updatePoint":{"line":1838,"column":29,"index":51113},"line":1838,"code":"    it('supports regex groups', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"(Hello)\",\n        \"to\": \"$1-$1-$1\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello-Hello-Hello World\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid regex","suites":["change Node","#change"],"updatePoint":{"line":1870,"column":29,"index":52006},"line":1870,"code":"    it('reports invalid regex', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"\\\\+**+\",\n        \"to\": \"NUMBER\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"change\";\n        });\n        logEvents.should.have.length(1);\n        var msg = logEvents[0][0];\n        msg.should.have.property('level', helper.log().ERROR);\n        msg.should.have.property('id', 'changeNode1');\n        done();\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"supports regex groups - new rule format","suites":["change Node","#change"],"updatePoint":{"line":1897,"column":47,"index":52832},"line":1897,"code":"    it('supports regex groups - new rule format', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"(Hello)\",\n          \"to\": \"$1-$1-$1\",\n          \"fromt\": \"re\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello-Hello-Hello World\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value - new rule format","suites":["change Node","#change"],"updatePoint":{"line":1932,"column":43,"index":53792},"line":1932,"code":"    it('changes the value - new rule format', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"ABC\",\n          \"to\": \"123\",\n          \"fromt\": \"str\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using msg property","suites":["change Node","#change"],"updatePoint":{"line":1967,"column":44,"index":54729},"line":1967,"code":"    it('changes the value using msg property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"msg\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"abcABCabc\",\n          topic: \"ABC\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using flow context property","suites":["change Node","#change"],"updatePoint":{"line":2003,"column":53,"index":55701},"line":2003,"code":"    it('changes the value using flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"flow\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"topic\", \"ABC\");\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable flow context property","suites":["change Node","#change"],"updatePoint":{"line":2040,"column":65,"index":56739},"line":2040,"code":"    it('changes the value using persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"123\",\n          \"fromt\": \"flow\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abc123abc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"topic\", \"ABC\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"abcABCabc\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using global context property","suites":["change Node","#change"],"updatePoint":{"line":2080,"column":55,"index":57901},"line":2080,"code":"    it('changes the value using global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"topic\", \"ABC\");\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable global context property","suites":["change Node","#change"],"updatePoint":{"line":2116,"column":67,"index":58924},"line":2116,"code":"    it('changes the value using persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"123\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abc123abc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"topic\", \"ABC\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"abcABCabc\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the number using global context property","suites":["change Node","#change"],"updatePoint":{"line":2155,"column":56,"index":60070},"line":2155,"code":"    it('changes the number using global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"ABC\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"ABC\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"topic\", 123);\n        changeNode1.receive({\n          payload: 123\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the number using persistable global context property","suites":["change Node","#change"],"updatePoint":{"line":2191,"column":68,"index":61078},"line":2191,"code":"    it('changes the number using persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"ABC\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"ABC\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"topic\", 123, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: 123\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - string payload","suites":["change Node","#change"],"updatePoint":{"line":2230,"column":55,"index":62207},"line":2230,"code":"    it('changes the value using number - string payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"123\",\n          \"to\": \"456\",\n          \"fromt\": \"num\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"456\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"123\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number payload","suites":["change Node","#change"],"updatePoint":{"line":2265,"column":55,"index":63143},"line":2265,"code":"    it('changes the value using number - number payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"123\",\n          \"to\": \"abc\",\n          \"fromt\": \"num\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: 123\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - string payload","suites":["change Node","#change"],"updatePoint":{"line":2300,"column":56,"index":64078},"line":2300,"code":"    it('changes the value using boolean - string payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"true\",\n          \"to\": \"xxx\",\n          \"fromt\": \"bool\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"xxx\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"true\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean payload","suites":["change Node","#change"],"updatePoint":{"line":2335,"column":57,"index":65019},"line":2335,"code":"    it('changes the value using boolean - boolean payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"true\",\n          \"to\": \"xxx\",\n          \"fromt\": \"bool\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"xxx\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: true\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the global context","suites":["change Node","#change"],"updatePoint":{"line":2370,"column":47,"index":65948},"line":2370,"code":"    it('changes the value of the global context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"global\",\n          \"from\": \"Hello\",\n          \"fromt\": \"str\",\n          \"to\": \"Goodbye\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().global.get(\"payload\").should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"payload\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the persistable global context","suites":["change Node","#change"],"updatePoint":{"line":2410,"column":59,"index":67093},"line":2410,"code":"    it('changes the value of the persistable global context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"global\",\n          \"from\": \"Hello\",\n          \"fromt\": \"str\",\n          \"to\": \"Goodbye\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().global.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"Goodbye World!\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"payload\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the flow context for partial match","suites":["change Node","#change"],"updatePoint":{"line":2455,"column":86,"index":68472},"line":2455,"code":"    it('changes the value and doesnt change type of the flow context for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"Change456Me\");\n            helperNode1.context().flow.get(\"payload\").should.be.a.String();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", \"Change123Me\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the persistable flow context for partial match","suites":["change Node","#change"],"updatePoint":{"line":2496,"column":98,"index":69716},"line":2496,"code":"    it('changes the value and doesnt change type of the persistable flow context for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"Change456Me\");\n                val.should.be.a.String();\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", \"Change123Me\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the flow context if a complete match","suites":["change Node","#change"],"updatePoint":{"line":2542,"column":74,"index":71109},"line":2542,"code":"    it('changes the value and type of the flow context if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(456);\n            helperNode1.context().flow.get(\"payload\").should.be.a.Number();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", \"123\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the persistable flow context if a complete match","suites":["change Node","#change"],"updatePoint":{"line":2583,"column":86,"index":72323},"line":2583,"code":"    it('changes the value and type of the persistable flow context if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.be.a.Number();\n                val.should.equal(456);\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", \"123\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number flow context","suites":["change Node","#change"],"updatePoint":{"line":2629,"column":60,"index":73684},"line":2629,"code":"    it('changes the value using number - number flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"num\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", 123);\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number persistable flow context","suites":["change Node","#change"],"updatePoint":{"line":2669,"column":72,"index":74808},"line":2669,"code":"    it('changes the value using number - number persistable flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"num\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"abc\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", 123, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean flow context","suites":["change Node","#change"],"updatePoint":{"line":2714,"column":62,"index":76129},"line":2714,"code":"    it('changes the value using boolean - boolean flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"true\",\n          \"fromt\": \"bool\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", true);\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean persistable flow context","suites":["change Node","#change"],"updatePoint":{"line":2754,"column":74,"index":77258},"line":2754,"code":"    it('changes the value using boolean - boolean persistable flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"true\",\n          \"fromt\": \"bool\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"abc\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", true, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid fromValue","suites":["change Node","#change"],"updatePoint":{"line":2799,"column":33,"index":78553},"line":2799,"code":"    it('reports invalid fromValue', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"null\",\n          \"fromt\": \"msg\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"change\";\n          });\n          logEvents.should.have.length(1);\n          var msg = logEvents[0][0];\n          msg.should.have.property('level', helper.log().ERROR);\n          msg.should.have.property('id', 'changeNode1');\n          done();\n        }, 25);\n        changeNode1.receive({\n          payload: \"\",\n          null: null\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using env property","suites":["change Node","#change","env var"],"updatePoint":{"line":2843,"column":46,"index":79823},"line":2843,"code":"      it('changes the value using env property', function (done) {\n        var flow = [{\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          rules: [{\n            \"t\": \"change\",\n            \"p\": \"payload\",\n            \"from\": \"topic\",\n            \"to\": \"NR_TEST_A\",\n            \"fromt\": \"msg\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abcfooabc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"abcABCabc\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of the message property","suites":["change Node","#delete"],"updatePoint":{"line":2882,"column":49,"index":80917},"line":2882,"code":"    it('deletes the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"This won't get through!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of global context property","suites":["change Node","#delete"],"updatePoint":{"line":2914,"column":52,"index":81819},"line":2914,"code":"    it('deletes the value of global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"delete\",\n          \"p\": \"globalValue\",\n          \"pt\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            changeNode1.context().global.should.not.have.property(\"globalValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of persistable global context property","suites":["change Node","#delete"],"updatePoint":{"line":2947,"column":64,"index":82803},"line":2947,"code":"    it('deletes the value of persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"delete\",\n          \"p\": \"#:(memory1)::globalValue\",\n          \"pt\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              changeNode1.context().global.get(\"globalValue\", \"memory1\", function (err, val) {\n                should.equal(undefined);\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of a multi-level message property","suites":["change Node","#delete"],"updatePoint":{"line":2985,"column":59,"index":83988},"line":2985,"code":"    it('deletes the value of a multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo.bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"This won't get through!\",\n          foo: {\n            bar: \"This will be deleted!\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if the deleted message property does not exist","suites":["change Node","#delete"],"updatePoint":{"line":3020,"column":78,"index":84987},"line":3020,"code":"    it('sends unaltered message if the deleted message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo');\n            msg.payload.should.equal('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"payload\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if a deleted multi-level message property does not exist","suites":["change Node","#delete"],"updatePoint":{"line":3053,"column":88,"index":85950},"line":3053,"code":"    it('sends unaltered message if a deleted multi-level message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo.bar');\n            msg.payload.should.equal('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"payload\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of the message property","suites":["change Node","#move"],"updatePoint":{"line":3088,"column":47,"index":86920},"line":3088,"code":"    it('moves the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"topic\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('topic');\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"You've got to move it move it.\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          topic: \"You've got to move it move it.\",\n          payload: {\n            foo: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object","suites":["change Node","#move"],"updatePoint":{"line":3127,"column":52,"index":88036},"line":3127,"code":"    it('moves the value of a message property object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"topic\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('topic');\n            msg.should.have.property('payload');\n            msg.payload.should.have.property('foo');\n            msg.payload.foo.should.have.property('bar');\n            msg.payload.foo.bar.should.equal(1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          topic: {\n            foo: {\n              bar: 1\n            }\n          },\n          payload: \"String\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object to itself","suites":["change Node","#move"],"updatePoint":{"line":3170,"column":62,"index":89256},"line":3170,"code":"    it('moves the value of a message property object to itself', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object to a sub-property","suites":["change Node","#move"],"updatePoint":{"line":3205,"column":70,"index":90232},"line":3205,"code":"    it('moves the value of a message property object to a sub-property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"payload.foo\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.have.property('foo');\n            msg.payload.foo.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message sub-property object to a property","suites":["change Node","#move"],"updatePoint":{"line":3241,"column":70,"index":91269},"line":3241,"code":"    it('moves the value of a message sub-property object to a property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload.foo\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"bar\");\n            (typeof msg.payload).should.equal(\"string\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: {\n            foo: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"handles multiple rules","suites":["change Node","- multiple rules"],"updatePoint":{"line":3281,"column":30,"index":92348},"line":3281,"code":"    it('handles multiple rules', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          t: \"set\",\n          p: \"payload\",\n          to: \"newValue\"\n        }, {\n          t: \"change\",\n          p: \"changeProperty\",\n          from: \"this\",\n          to: \"that\"\n        }, {\n          t: \"delete\",\n          p: \"deleteProperty\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"newValue\");\n            msg.changeProperty.should.equal(\"change that value\");\n            should.not.exist(msg.deleteProperty);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\",\n          changeProperty: \"change this value\",\n          deleteProperty: \"delete this value\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"applies multiple rules in order","suites":["change Node","- multiple rules"],"updatePoint":{"line":3324,"column":39,"index":93557},"line":3324,"code":"    it('applies multiple rules in order', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          t: \"set\",\n          p: \"payload\",\n          to: \"a this (hi)\"\n        }, {\n          t: \"change\",\n          p: \"payload\",\n          from: \"this\",\n          to: \"that\"\n        }, {\n          t: \"change\",\n          p: \"payload\",\n          from: \"\\\\(.*\\\\)\",\n          to: \"[new]\",\n          re: true\n        }]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"a that [new]\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access two persistable flow context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3366,"column":56,"index":94637},"line":3366,"code":"    it('can access two persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"flow\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"flow\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var flow = changeNode1.context().flow;\n          flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n            flow.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access two persistable global context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3413,"column":58,"index":96006},"line":3413,"code":"    it('can access two persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"global\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"global\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var global = changeNode1.context().global;\n          global.set(\"val\", \"foo\", \"memory0\", function (err) {\n            global.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access persistable global & flow context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3460,"column":61,"index":97390},"line":3460,"code":"    it('can access persistable global & flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"flow\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"global\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var context = changeNode1.context();\n          var flow = context.flow;\n          var global = context.global;\n          flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n            global.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load some defaults","suites":["range Node"],"updatePoint":{"line":30,"column":31,"index":1038},"line":30,"code":"  it('should load some defaults', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"name\": \"rangeNode\"\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      rangeNode1.should.have.property('name', 'rangeNode');\n      rangeNode1.should.have.property('round', false);\n      done();\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"ranges numbers up tenfold","suites":["range Node"],"updatePoint":{"line":90,"column":31,"index":2855},"line":90,"code":"  it('ranges numbers up tenfold', function (done) {\n    genericRangeTest(\"scale\", 0, 100, 0, 1000, false, 50, 500, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"ranges numbers down such as centimetres to metres","suites":["range Node"],"updatePoint":{"line":93,"column":55,"index":3007},"line":93,"code":"  it('ranges numbers down such as centimetres to metres', function (done) {\n    genericRangeTest(\"scale\", 0, 100, 0, 1, false, 55, 0.55, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers down say for degree/rotation reading 1/2","suites":["range Node"],"updatePoint":{"line":96,"column":60,"index":3162},"line":96,"code":"  it('wraps numbers down say for degree/rotation reading 1/2', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 15, 180, done); // 1/2 around wrap => \"one and a half turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 1/3","suites":["range Node"],"updatePoint":{"line":99,"column":62,"index":3362},"line":99,"code":"  it('wraps numbers around say for degree/rotation reading 1/3', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 13.3333, 120, done); // 1/3 around wrap => \"one and a third turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 1/4","suites":["range Node"],"updatePoint":{"line":102,"column":62,"index":3568},"line":102,"code":"  it('wraps numbers around say for degree/rotation reading 1/4', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 12.5, 90, done); // 1/4 around wrap => \"one and a quarter turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers down say for degree/rotation reading 1/4","suites":["range Node"],"updatePoint":{"line":105,"column":60,"index":3770},"line":105,"code":"  it('wraps numbers down say for degree/rotation reading 1/4', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, -12.5, 270, done); // 1/4 backwards wrap => \"one and a quarter turns backwards\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 0","suites":["range Node"],"updatePoint":{"line":108,"column":60,"index":3987},"line":108,"code":"  it('wraps numbers around say for degree/rotation reading 0', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, -10, 0, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"clamps numbers within a range - over max","suites":["range Node"],"updatePoint":{"line":111,"column":46,"index":4125},"line":111,"code":"  it('clamps numbers within a range - over max', function (done) {\n    genericRangeTest(\"clamp\", 0, 10, 0, 1000, false, 111, 1000, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"clamps numbers within a range - below min","suites":["range Node"],"updatePoint":{"line":114,"column":47,"index":4270},"line":114,"code":"  it('clamps numbers within a range - below min', function (done) {\n    genericRangeTest(\"clamp\", 0, 10, 0, 1000, false, -1, 0, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"just passes on msg if payload not present","suites":["range Node"],"updatePoint":{"line":117,"column":47,"index":4411},"line":117,"code":"  it('just passes on msg if payload not present', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"minin\": 0,\n      \"maxin\": 100,\n      \"minout\": 0,\n      \"maxout\": 100,\n      \"action\": \"scale\",\n      \"round\": true,\n      \"name\": \"rangeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.should.not.have.property('payload');\n          msg.topic.should.equal(\"pass on\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      rangeNode1.receive({\n        topic: \"pass on\"\n      });\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"reports if input is not a number","suites":["range Node"],"updatePoint":{"line":151,"column":38,"index":5272},"line":151,"code":"  it('reports if input is not a number', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"minin\": 0,\n      \"maxin\": 0,\n      \"minout\": 0,\n      \"maxout\": 0,\n      \"action\": \"scale\",\n      \"round\": true,\n      \"name\": \"rangeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      rangeNode1.on(\"call:log\", function (args) {\n        var log = args.args[0];\n\n        if (log.indexOf(\"notnumber\") > -1) {\n          rangeNode1.log.restore();\n          done();\n        } else {\n          try {\n            should.fail(null, null, \"Non-number inputs should be reported!\");\n          } catch (err) {\n            rangeNode1.log.restore();\n            done(err);\n          }\n        }\n      });\n      rangeNode1.receive({\n        payload: \"NOT A NUMBER\"\n      });\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload using node-configured template","suites":["template node"],"updatePoint":{"line":64,"column":58,"index":1759},"line":64,"code":"  it('should modify payload using node-configured template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          msg.should.have.property('template', 'this should be ignored as the node has its own template {{payload}}');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"this should be ignored as the node has its own template {{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify the configured property using msg.template","suites":["template node"],"updatePoint":{"line":95,"column":62,"index":2708},"line":95,"code":"  it('should modify the configured property using msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"randomProperty\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('template', 'payload={{payload}}');\n        msg.should.have.property('randomProperty', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"payload={{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should be able to overwrite msg.template using the template from msg.template","suites":["template node"],"updatePoint":{"line":123,"column":83,"index":3552},"line":123,"code":"  it('should be able to overwrite msg.template using the template from msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'topic=bar');\n        msg.should.have.property('template', 'topic={{topic}}');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"topic={{topic}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from msg.template","suites":["template node"],"updatePoint":{"line":150,"column":45,"index":4282},"line":150,"code":"  it('should modify payload from msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var received = [];\n      n2.on(\"input\", function (msg) {\n        try {\n          received.push(msg);\n\n          if (received.length === 3) {\n            received[0].should.have.property('topic', 'bar');\n            received[0].should.have.property('payload', 'topic=bar');\n            received[0].should.have.property('template', 'topic={{topic}}');\n            received[1].should.have.property('topic', 'another bar');\n            received[1].should.have.property('payload', 'topic=another bar');\n            received[1].should.have.property('template', 'topic={{topic}}');\n            received[2].should.have.property('topic', 'bar');\n            received[2].should.have.property('payload', 'payload=foo');\n            received[2].should.have.property('template', 'payload={{payload}}');\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"topic={{topic}}\"\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"another bar\",\n        template: \"topic={{topic}}\"\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"payload={{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from env variable","suites":["template node","env var"],"updatePoint":{"line":209,"column":47,"index":6070},"line":209,"code":"    it('should modify payload from env variable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        z: \"t1\",\n        type: \"template\",\n        field: \"payload\",\n        template: \"payload={{env.TEST}}\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        z: \"t1\",\n        type: \"helper\"\n      }];\n      helper.load(templateNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', 'payload=xyzzy');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from flow context","suites":["template node","env var"],"updatePoint":{"line":236,"column":45,"index":6758},"line":236,"code":"  it('should modify payload from flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"value\", \"foo\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable flow context","suites":["template node","env var"],"updatePoint":{"line":264,"column":57,"index":7497},"line":264,"code":"  it('should modify payload from persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle nested context tags - property not set","suites":["template node","env var"],"updatePoint":{"line":295,"column":58,"index":8359},"line":295,"code":"  it('should handle nested context tags - property not set', function (done) {\n    // This comes from the Coursera Node-RED course and is a good example of\n    // multiple conditional tags\n    var template = `{{#flow.time}}time={{flow.time}}{{/flow.time}}{{^flow.time}}!time{{/flow.time}}{{#flow.random}}random={{flow.random}}randomtime={{flow.randomtime}}{{/flow.random}}{{^flow.random}}!random{{/flow.random}}`;\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: template,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '!time!random');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle nested context tags - property set","suites":["template node","env var"],"updatePoint":{"line":331,"column":54,"index":9517},"line":331,"code":"  it('should handle nested context tags - property set', function (done) {\n    // This comes from the Coursera Node-RED course and is a good example of\n    // multiple conditional tags\n    var template = `{{#flow.time}}time={{flow.time}}{{/flow.time}}{{^flow.time}}!time{{/flow.time}}{{#flow.random}}random={{flow.random}}randomtime={{flow.randomtime}}{{/flow.random}}{{^flow.random}}!random{{/flow.random}}`;\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: template,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'time=123random=456randomtime=789');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.context().flow.set([\"time\", \"random\", \"randomtime\"], [\"123\", \"456\", \"789\"], function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from two persistable flow context","suites":["template node","env var"],"updatePoint":{"line":369,"column":61,"index":10826},"line":369,"code":"  it('should modify payload from two persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}/{{flow[memory2].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().flow.set(\"value\", \"bar\", \"memory2\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from global context","suites":["template node","env var"],"updatePoint":{"line":402,"column":47,"index":11803},"line":402,"code":"  it('should modify payload from global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"value\", \"foo\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable global context","suites":["template node","env var"],"updatePoint":{"line":430,"column":59,"index":12548},"line":430,"code":"  it('should modify payload from persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          done();\n        });\n        n1.context().global.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from two persistable global context","suites":["template node","env var"],"updatePoint":{"line":461,"column":63,"index":13419},"line":461,"code":"  it('should modify payload from two persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global[memory1].value}}/{{global[memory2].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().global.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().global.set(\"value\", \"bar\", \"memory2\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable flow & global context","suites":["template node","env var"],"updatePoint":{"line":494,"column":66,"index":14423},"line":494,"code":"  it('should modify payload from persistable flow & global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}/{{global[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().global.set(\"value\", \"bar\", \"memory1\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing node context","suites":["template node","env var"],"updatePoint":{"line":527,"column":40,"index":15397},"line":527,"code":"  it('should handle missing node context', function (done) {\n    // this is artificial test because in flow there is missing z property (probably never happen in real usage)\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow.value}},{{global.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=,');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle escape characters in Mustache format and JSON output mode","suites":["template node","env var"],"updatePoint":{"line":553,"column":77,"index":16209},"line":553,"code":"  it('should handle escape characters in Mustache format and JSON output mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      syntax: \"mustache\",\n      template: \"{\\\"data\\\":\\\"{{payload}}\\\"}\",\n      output: \"json\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.payload.should.have.property('data', 'line\\t1\\nline\\\\2\\r\\nline\\b3\\f');\n        done();\n      });\n      n1.receive({\n        payload: \"line\\t1\\nline\\\\2\\r\\nline\\b3\\f\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload in plain text mode","suites":["template node","env var"],"updatePoint":{"line":578,"column":46,"index":16891},"line":578,"code":"  it('should modify payload in plain text mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      syntax: \"plain\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload={{payload}}');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify flow context","suites":["template node","env var"],"updatePoint":{"line":604,"column":32,"index":17558},"line":604,"code":"  it('should modify flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      fieldType: \"flow\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        // mesage is intact\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo'); // result is in flow context\n\n        n2.context().flow.get(\"payload\").should.equal(\"payload=foo\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify persistable flow context","suites":["template node","env var"],"updatePoint":{"line":635,"column":44,"index":18381},"line":635,"code":"  it('should modify persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"#:(memory1)::payload\",\n      fieldType: \"flow\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // mesage is intact\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'foo'); // result is in flow context\n\n          n2.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n            val.should.equal(\"payload=foo\");\n            done();\n          });\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify global context","suites":["template node","env var"],"updatePoint":{"line":670,"column":34,"index":19340},"line":670,"code":"  it('should modify global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      fieldType: \"global\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        // mesage is intact\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo'); // result is in global context\n\n        n2.context().global.get(\"payload\").should.equal(\"payload=foo\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify persistable global context","suites":["template node","env var"],"updatePoint":{"line":701,"column":46,"index":20171},"line":701,"code":"  it('should modify persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"#:(memory1)::payload\",\n      fieldType: \"global\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // mesage is intact\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'foo'); // result is in global context\n\n          n2.context().global.get(\"payload\", \"memory1\", function (err, val) {\n            val.should.equal(\"payload=foo\");\n            done();\n          });\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle if the field isn't set","suites":["template node","env var"],"updatePoint":{"line":736,"column":43,"index":21145},"line":736,"code":"  it('should handle if the field isn\\'t set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle deeper objects","suites":["template node","env var"],"updatePoint":{"line":760,"column":34,"index":21759},"line":760,"code":"  it('should handle deeper objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"topic.foo.bar\",\n      template: \"payload={{payload.doh.rei.me}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic');\n        msg.topic.should.have.property('foo');\n        msg.topic.foo.should.have.a.property('bar', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: {\n          doh: {\n            rei: {\n              me: \"foo\"\n            }\n          }\n        }\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle block contexts objects","suites":["template node","env var"],"updatePoint":{"line":791,"column":42,"index":22540},"line":791,"code":"  it('should handle block contexts objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      template: \"A{{#payload.A}}{{payload.A}}{{.}}{{/payload.A}}B\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', 'AabcabcB');\n        done();\n      });\n      n1.receive({\n        payload: {\n          A: \"abc\"\n        }\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should raise error if passed bad template","suites":["template node","env var"],"updatePoint":{"line":815,"column":47,"index":23146},"line":815,"code":"  it('should raise error if passed bad template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{payload\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"template\";\n        });\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"Unclosed tag at \");\n        done();\n      }, 25);\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["delay Node"],"updatePoint":{"line":39,"column":22,"index":1312},"line":39,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"day\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 86400000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set rate to hour","suites":["delay Node"],"updatePoint":{"line":63,"column":40,"index":1998},"line":63,"code":"  it('should be able to set rate to hour', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"hour\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 3600000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set rate to minute","suites":["delay Node"],"updatePoint":{"line":87,"column":42,"index":2686},"line":87,"code":"  it('should be able to set rate to minute', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"minute\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 60000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in seconds","suites":["delay Node"],"updatePoint":{"line":213,"column":35,"index":6803},"line":213,"code":"  it('delays the message in seconds', function (done) {\n    genericDelayTest(0.5, \"seconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":216,"column":40,"index":6914},"line":216,"code":"  it('delays the message in milliseconds', function (done) {\n    genericDelayTest(500, \"milliseconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in minutes","suites":["delay Node"],"updatePoint":{"line":219,"column":35,"index":7025},"line":219,"code":"  it('delays the message in minutes', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.00833, \"minutes\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in hours","suites":["delay Node"],"updatePoint":{"line":223,"column":33,"index":7165},"line":223,"code":"  it('delays the message in hours', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.0001388, \"hours\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in days","suites":["delay Node"],"updatePoint":{"line":227,"column":32,"index":7304},"line":227,"code":"  it('delays the message in days', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.000005787, \"days\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per second","suites":["delay Node"],"updatePoint":{"line":307,"column":45,"index":9976},"line":307,"code":"  it('limits the message rate to 1 per second', function (done) {\n    genericRateLimitSECONDSTest(1, 1, 1500, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per 2 seconds","suites":["delay Node"],"updatePoint":{"line":310,"column":48,"index":10108},"line":310,"code":"  it('limits the message rate to 1 per 2 seconds', function (done) {\n    this.timeout(6000);\n    genericRateLimitSECONDSTest(1, 2, 3000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per seconds, 2 seconds","suites":["delay Node"],"updatePoint":{"line":314,"column":57,"index":10273},"line":314,"code":"  it('limits the message rate to 2 per seconds, 2 seconds', function (done) {\n    this.timeout(6000);\n    genericRateLimitSECONDSTest(2, 1, 2100, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate using msg.rate","suites":["delay Node"],"updatePoint":{"line":318,"column":44,"index":10425},"line":318,"code":"  it('limits the message rate using msg.rate', function (done) {\n    RED.settings.nodeMessageBufferMaxLength = 3;\n    genericRateLimitSECONDSTest(1, 1, 1500, 2000, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per second, 4 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":445,"column":67,"index":14517},"line":445,"code":"  it('limits the message rate to 1 per second, 4 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(1, 1, 4000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per 2 seconds, 4 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":449,"column":70,"index":14692},"line":449,"code":"  it('limits the message rate to 1 per 2 seconds, 4 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(1, 2, 4500, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per second, 5 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":453,"column":67,"index":14864},"line":453,"code":"  it('limits the message rate to 2 per second, 5 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(2, 1, 5000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per second, 5 seconds, with drop, 2nd output","suites":["delay Node"],"updatePoint":{"line":457,"column":79,"index":15048},"line":457,"code":"  it('limits the message rate to 2 per second, 5 seconds, with drop, 2nd output', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(2, 1, 5000, null, true, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate with drop using msg.rate","suites":["delay Node"],"updatePoint":{"line":461,"column":54,"index":15213},"line":461,"code":"  it('limits the message rate with drop using msg.rate', function (done) {\n    this.timeout(6000);\n    RED.settings.nodeMessageBufferMaxLength = 3;\n    dropRateLimitSECONDSTest(2, 1, 5000, 1000, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay set by msg.delay the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":565,"column":65,"index":19574},"line":565,"code":"  it('variable delay set by msg.delay the message in milliseconds', function (done) {\n    variableDelayTest(\"200\", \"300\", \"milliseconds\", 250, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is the default if msg.delay not specified","suites":["delay Node"],"updatePoint":{"line":568,"column":62,"index":19727},"line":568,"code":"  it('variable delay is the default if msg.delay not specified', function (done) {\n    variableDelayTest(\"450\", \"550\", \"milliseconds\", null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is zero if msg.delay is zero","suites":["delay Node"],"updatePoint":{"line":571,"column":49,"index":19868},"line":571,"code":"  it('variable delay is zero if msg.delay is zero', function (done) {\n    variableDelayTest(\"0\", \"20\", \"milliseconds\", 0, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is zero if msg.delay is negative","suites":["delay Node"],"updatePoint":{"line":574,"column":53,"index":20007},"line":574,"code":"  it('variable delay is zero if msg.delay is negative', function (done) {\n    variableDelayTest(\"0\", \"20\", \"milliseconds\", -250, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in seconds","suites":["delay Node"],"updatePoint":{"line":652,"column":44,"index":23239},"line":652,"code":"  it('randomly delays the message in seconds', function (done) {\n    randomDelayTest(0.4, 0.8, \"seconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":655,"column":49,"index":23363},"line":655,"code":"  it('randomly delays the message in milliseconds', function (done) {\n    randomDelayTest(\"400\", \"800\", \"milliseconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in minutes","suites":["delay Node"],"updatePoint":{"line":658,"column":44,"index":23491},"line":658,"code":"  it('randomly delays the message in minutes', function (done) {\n    randomDelayTest(0.0066, 0.0133, \"minutes\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in hours","suites":["delay Node"],"updatePoint":{"line":661,"column":33,"index":23605},"line":661,"code":"  it('delays the message in hours', function (done) {\n    randomDelayTest(0.000111111, 0.000222222, \"hours\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in days","suites":["delay Node"],"updatePoint":{"line":664,"column":32,"index":23726},"line":664,"code":"  it('delays the message in days', function (done) {\n    randomDelayTest(0.0000046296, 0.0000092593, \"days\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"handles delay queue","suites":["delay Node"],"updatePoint":{"line":667,"column":25,"index":23841},"line":667,"code":"  it('handles delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      id: \"delayNode1\",\n      type: \"delay\",\n      \"name\": \"delayNode\",\n      \"nbRateUnits\": \"1\",\n      \"pauseType\": \"queue\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 4,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"_none_\") {\n            msg.payload.should.equal(2);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else if (msg.topic === \"A\") {\n            msg.payload.should.equal(4);\n            (Date.now() - t).should.be.approximately(750, 200);\n          } else {\n            msg.topic.should.equal(\"B\");\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(1000, 200);\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      setTimeout(function () {\n        // send test messages\n        delayNode1.receive({\n          payload: 1\n        }); // send something with blank topic\n\n        delayNode1.receive({\n          payload: 1,\n          topic: \"A\"\n        }); // and something with a fixed topic\n\n        delayNode1.receive({\n          payload: 1,\n          topic: \"B\"\n        }); // and something else with a fixed topic (3rd tick)\n\n        delayNode1.receive({\n          payload: 2,\n          topic: \"A\"\n        }); // these should replace them in queue\n\n        delayNode1.receive({\n          payload: 3,\n          topic: \"A\"\n        }); //  ditto\n\n        delayNode1.receive({\n          payload: 2\n        }); // so only this should get out on first tick\n\n        delayNode1.receive({\n          payload: 4,\n          topic: \"A\"\n        }); // and this one on second tick\n      }, 275); // wait one tick beofre starting.. (to test no messages in queue path.)\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"handles timed queue","suites":["delay Node"],"updatePoint":{"line":751,"column":25,"index":26216},"line":751,"code":"  it('handles timed queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"timed\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"_none_\") {\n            msg.payload.should.equal(2);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else if (msg.topic === \"A\") {\n            msg.payload.should.equal(4);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else {\n            msg.topic.should.equal(\"B\");\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(500, 200);\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1\n      }); // send something with blank topic\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"A\"\n      }); // and something with a fixed topic\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"B\"\n      }); // and something else with a fixed topic\n\n      delayNode1.receive({\n        payload: 2,\n        topic: \"A\"\n      }); // these should replace them in queue\n\n      delayNode1.receive({\n        payload: 3,\n        topic: \"A\"\n      }); //  ditto\n\n      delayNode1.receive({\n        payload: 2\n      }); // so all should go on first tick\n\n      delayNode1.receive({\n        payload: 4,\n        topic: \"A\"\n      }); //  and nothing on second\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can flush delay queue","suites":["delay Node"],"updatePoint":{"line":832,"column":27,"index":28366},"line":832,"code":"  it('can flush delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else {\n            if (msg.topic === \"bar\") {\n              msg.payload.should.equal(1);\n              (Date.now() - t).should.be.approximately(0, 100);\n              c = c + 1;\n            }\n          }\n\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part flush delay queue","suites":["delay Node"],"updatePoint":{"line":923,"column":32,"index":30667},"line":923,"code":"  it('can part flush delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else if (msg.topic === \"bar\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(200, 100);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(400, 100);\n            c = c + 1;\n          }\n\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 2\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can reset delay queue","suites":["delay Node"],"updatePoint":{"line":1021,"column":27,"index":33113},"line":1021,"code":"  it('can reset delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        c = c + 1;\n      });\n      setTimeout(function () {\n        if (c === 0) {\n          done();\n        }\n      }, 700); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          reset: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can flush rate limit queue","suites":["delay Node"],"updatePoint":{"line":1096,"column":32,"index":34935},"line":1096,"code":"  it('can flush rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else {\n            if (msg.topic === \"bar\") {\n              msg.payload.should.equal(1);\n              (Date.now() - t).should.be.approximately(0, 100);\n              c = c + 1;\n            }\n          }\n\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part flush rate limit queue","suites":["delay Node"],"updatePoint":{"line":1187,"column":37,"index":37240},"line":1187,"code":"  it('can part flush rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else if (msg.topic === \"bar\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(200, 100);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(400, 100);\n            c = c + 1;\n          }\n\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 2\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part push to front of rate limit queue","suites":["delay Node"],"updatePoint":{"line":1285,"column":48,"index":39706},"line":1285,"code":"  it('can part push to front of rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 1,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"aoo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(2, 50);\n            c = c + 1;\n          } else if (msg.topic === \"eoo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(4, 50);\n            c = c + 1;\n          } else if (msg.topic === \"coo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(202, 50);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(406, 50);\n            c = c + 1;\n          } else if (msg.topic === \"doo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(4, 50);\n            c = c + 1;\n          }\n\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      }); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"aoo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"coo\",\n          toFront: true\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"doo\",\n          toFront: true,\n          flush: 1\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"eoo\",\n          toFront: true\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can reset rate limit queue","suites":["delay Node"],"updatePoint":{"line":1395,"column":32,"index":42586},"line":1395,"code":"  it('can reset rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      setTimeout(function () {\n        if (c === 1) {\n          done();\n        }\n      }, 700); // send test messages\n\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n\n      setImmediate(function () {\n        delayNode1.receive({\n          reset: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delay)","suites":["delay Node"],"updatePoint":{"line":1536,"column":61,"index":46269},"line":1536,"code":"  it('calls done when queued message is emitted (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1545,"column":62,"index":46488},"line":1545,"code":"  it('calls done when queued message is emitted (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delay)","suites":["delay Node"],"updatePoint":{"line":1555,"column":61,"index":46728},"line":1555,"code":"  it('calls done when queued message is emitted (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: delay)","suites":["delay Node"],"updatePoint":{"line":1564,"column":61,"index":46947},"line":1564,"code":"  it('calls done when queued message is cleared (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1580,"column":62,"index":47267},"line":1580,"code":"  it('calls done when queued message is cleared (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: random)","suites":["delay Node"],"updatePoint":{"line":1597,"column":62,"index":47609},"line":1597,"code":"  it('calls done when queued message is cleared (type: random)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: delay)","suites":["delay Node"],"updatePoint":{"line":1613,"column":61,"index":47929},"line":1613,"code":"  it('calls done when queued message is flushed (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1629,"column":62,"index":48249},"line":1629,"code":"  it('calls done when queued message is flushed (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: random)","suites":["delay Node"],"updatePoint":{"line":1646,"column":62,"index":48591},"line":1646,"code":"  it('calls done when queued message is flushed (type: random)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is emitted (drop: false)","suites":["delay Node"],"updatePoint":{"line":1662,"column":60,"index":48910},"line":1662,"code":"  it('calls done when rated message is emitted (drop: false)', function (done) {\n    mapiDoneTestHelper(done, \"rate\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is emitted (drop: true)","suites":["delay Node"],"updatePoint":{"line":1677,"column":59,"index":49204},"line":1677,"code":"  it('calls done when rated message is emitted (drop: true)', function (done) {\n    mapiDoneTestHelper(done, \"rate\", true, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 0,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is flushed","suites":["delay Node"],"updatePoint":{"line":1692,"column":46,"index":49481},"line":1692,"code":"  it('calls done when rated message is flushed', function (done) {\n    mapiDoneTestHelper(done, \"rate\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 3,\n        flush: true\n      },\n      avr: 0,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued messages are sent (queue)","suites":["delay Node"],"updatePoint":{"line":1714,"column":54,"index":49867},"line":1714,"code":"  it('calls done when queued messages are sent (queue)', function (done) {\n    this.timeout(3000);\n    mapiDoneTestHelper(done, \"queue\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"A\"\n      },\n      avr: 1000,\n      var: 700\n    }, {\n      msg: {\n        payload: 2,\n        topic: \"B\"\n      },\n      avr: 2000,\n      var: 700\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued messages are sent (timed)","suites":["delay Node"],"updatePoint":{"line":1732,"column":54,"index":50224},"line":1732,"code":"  it('calls done when queued messages are sent (timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 500,\n      var: 700\n    }, {\n      msg: {\n        payload: 2,\n        topic: \"b\"\n      },\n      avr: 500,\n      var: 700\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queue is reset (queue/timed)","suites":["delay Node"],"updatePoint":{"line":1749,"column":50,"index":50551},"line":1749,"code":"  it('calls done when queue is reset (queue/timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 0,\n      var: 500\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 0,\n      var: 500\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queue is flushed (queue/timed)","suites":["delay Node"],"updatePoint":{"line":1766,"column":52,"index":50877},"line":1766,"code":"  it('calls done when queue is flushed (queue/timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 0,\n      var: 500\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 0,\n      var: 500\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with correct defaults","suites":["trigger node"],"updatePoint":{"line":63,"column":44,"index":1737},"line":63,"code":"  it(\"should be loaded with correct defaults\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'triggerNode');\n      n1.should.have.property('op1', '1');\n      n1.should.have.property('op2', '0');\n      n1.should.have.property('op1type', 'str');\n      n1.should.have.property('op2type', 'str');\n      n1.should.have.property('extend', \"false\");\n      n1.should.have.property('units', 'ms');\n      n1.should.have.property('duration', 250);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in seconds","suites":["trigger node"],"updatePoint":{"line":83,"column":44,"index":2416},"line":83,"code":"  it(\"should be able to set delay in seconds\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"s\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 1000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in minutes","suites":["trigger node"],"updatePoint":{"line":98,"column":44,"index":2801},"line":98,"code":"  it(\"should be able to set delay in minutes\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"min\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 60000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in hours","suites":["trigger node"],"updatePoint":{"line":113,"column":42,"index":3187},"line":113,"code":"  it(\"should be able to set delay in hours\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"hr\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 3600000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should output 1 then 0 when triggered (default)","suites":["trigger node"],"updatePoint":{"line":224,"column":53,"index":6162},"line":224,"code":"  it('should output 1 then 0 when triggered (default)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"20\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", '1');\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", '0');\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should ignore any other inputs while triggered if extend is false","suites":["trigger node"],"updatePoint":{"line":257,"column":71,"index":6978},"line":257,"code":"  it('should ignore any other inputs while triggered if extend is false', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var errored = false;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", '1');\n          } else {\n            msg.should.have.a.property(\"payload\", '0');\n          }\n\n          c += 1;\n        } catch (err) {\n          errored = true;\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (!errored) {\n          try {\n            c.should.equal(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      }, 100);\n      n1.emit(\"input\", {\n        payload: null\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 10);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 30);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should ignore msg.delay if overrideDelay not set","suites":["trigger node"],"updatePoint":{"line":312,"column":54,"index":8233},"line":312,"code":"  it('should ignore msg.delay if overrideDelay not set', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var firstTime;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          firstTime = Date.now();\n        } else if (c === 1) {\n          try {\n            var delta = Date.now() - firstTime;\n            delta.should.be.greaterThan(30);\n            delta.should.be.lessThan(100);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n\n        c++;\n      });\n      n1.emit(\"input\", {\n        payload: null,\n        delay: 300\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.delay if overrideDelay is set","suites":["trigger node"],"updatePoint":{"line":350,"column":50,"index":9136},"line":350,"code":"  it('should use msg.delay if overrideDelay is set', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      overrideDelay: true,\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var firstTime;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          firstTime = Date.now();\n        } else if (c === 1) {\n          try {\n            var delta = Date.now() - firstTime;\n            delta.should.be.greaterThan(270);\n            delta.should.be.lessThan(380);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n\n        c++;\n      });\n      n1.emit(\"input\", {\n        payload: null,\n        delay: 300\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle true and false as strings and delay of 0","suites":["trigger node"],"updatePoint":{"line":389,"column":60,"index":10077},"line":389,"code":"  it('should handle true and false as strings and delay of 0', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      op2type: \"val\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", true);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", false);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics as one if not asked to handle","suites":["trigger node"],"updatePoint":{"line":426,"column":65,"index":10973},"line":426,"code":"  it('should handle multiple topics as one if not asked to handle', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"all\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics individually if asked to do so","suites":["trigger node"],"updatePoint":{"line":476,"column":66,"index":12163},"line":476,"code":"  it('should handle multiple topics individually if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"C\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics individually, and extend one, if asked to do so","suites":["trigger node"],"updatePoint":{"line":538,"column":83,"index":13932},"line":538,"code":"  it('should handle multiple topics individually, and extend one, if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      extend: \"true\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"B\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"B\"\n        });\n      }, 20);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple other properties individually if asked to do so","suites":["trigger node"],"updatePoint":{"line":607,"column":76,"index":15843},"line":607,"code":"  it('should handle multiple other properties individually if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      topic: \"foo\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"B\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"C\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        foo: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        foo: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        foo: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from flow and global context variables","suites":["trigger node"],"updatePoint":{"line":670,"column":76,"index":17607},"line":670,"code":"  it('should be able to return things from flow and global context variables', function (done) {\n    var spy = sinon.stub(RED.util, 'evaluateNodeProperty').callsFake(function (arg1, arg2, arg3, arg4, arg5) {\n      if (arg5) {\n        arg5(null, arg1);\n      } else {\n        return arg1;\n      }\n    });\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1: \"foo\",\n      op1type: \"flow\",\n      op2: \"bar\",\n      op2type: \"global\",\n      duration: \"20\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"foo\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"bar\");\n            RED.util.evaluateNodeProperty.restore();\n            done();\n          }\n        } catch (err) {\n          RED.util.evaluateNodeProperty.restore();\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from persistable flow and global context variables","suites":["trigger node"],"updatePoint":{"line":716,"column":88,"index":18839},"line":716,"code":"  it('should be able to return things from persistable flow and global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      \"op1\": \"#:(memory1)::foo\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory1)::bar\",\n      \"op2type\": \"global\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (c === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n              c += 1;\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n1.context();\n        var flow = context.flow;\n        var global = context.global;\n        flow.set(\"foo\", \"foo\", \"memory1\", function (err) {\n          global.set(\"bar\", \"bar\", \"memory1\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable global context variables","suites":["trigger node"],"updatePoint":{"line":763,"column":88,"index":20167},"line":763,"code":"  it('should be able to return things from multiple persistable global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"global\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"global\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n\n            count++;\n\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n1.context().global;\n        global.set(\"val\", \"foo\", \"memory1\", function (err) {\n          global.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable flow context variables","suites":["trigger node"],"updatePoint":{"line":811,"column":86,"index":21458},"line":811,"code":"  it('should be able to return things from multiple persistable flow context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"flow\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n\n            count++;\n\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var flow = n1.context().flow;\n        flow.set(\"val\", \"foo\", \"memory1\", function (err) {\n          flow.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable flow & global context variables","suites":["trigger node"],"updatePoint":{"line":859,"column":95,"index":22746},"line":859,"code":"  it('should be able to return things from multiple persistable flow & global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"global\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n\n            count++;\n\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n1.context();\n        var flow = context.flow;\n        var global = context.flow;\n        flow.set(\"val\", \"foo\", \"memory1\", function (err) {\n          global.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to not output anything on first trigger","suites":["trigger node"],"updatePoint":{"line":909,"column":60,"index":24069},"line":909,"code":"  it('should be able to not output anything on first trigger', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"nul\",\n      op1: \"true\",\n      op2: \"false\",\n      op2type: \"val\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", false);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to not output anything on second edge","suites":["trigger node"],"updatePoint":{"line":940,"column":58,"index":24804},"line":940,"code":"  it('should be able to not output anything on second edge', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op2type: \"nul\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        c.should.equal(1); // should only have had one output.\n\n        done();\n      }, 90);\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to reset correctly having not output anything on second edge","suites":["trigger node"],"updatePoint":{"line":977,"column":81,"index":25703},"line":977,"code":"  it('should be able to reset correctly having not output anything on second edge', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op2type: \"nul\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      duration: \"100\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var errors = [];\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"topic\", \"pass\");\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } catch (err) {\n          errors.push(err);\n        }\n      });\n      setTimeout(function () {\n        if (errors.length > 0) {\n          done(errors[0]);\n        } else {\n          c.should.equal(2);\n          done();\n        }\n      }, 350);\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"pass\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"should-block\"\n        });\n      }, 50);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 3,\n          topic: \"pass\"\n        });\n      }, 200);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"should-block\"\n        });\n      }, 250);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay","suites":["trigger node"],"updatePoint":{"line":1038,"column":40,"index":27130},"line":1038,"code":"  it('should be able to extend the delay', function (done) {\n    this.timeout(5000); // add extra time for flake\n\n    var spy = sinon.stub(RED.util, 'evaluateNodeProperty').callsFake(function (arg1, arg2, arg3, arg4, arg5) {\n      if (arg5) {\n        arg5(null, arg1);\n      } else {\n        return arg1;\n      }\n    });\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"flow\",\n      op1: \"foo\",\n      op2: \"bar\",\n      op2type: \"global\",\n      duration: \"100\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"foo\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"bar\"); //console.log(Date.now() - ss);\n\n            (Date.now() - ss).should.be.greaterThan(149);\n            spy.restore();\n            done();\n          }\n        } catch (err) {\n          spy.restore();\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 50);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay (but with no 2nd output)","suites":["trigger node"],"updatePoint":{"line":1095,"column":65,"index":28592},"line":1095,"code":"  it('should be able to extend the delay (but with no 2nd output)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"pay\",\n      op2type: \"nul\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"200\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Hello\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            (Date.now() - ss).should.be.greaterThan(300);\n            done();\n          }\n        } catch (err) {\n          console.log(err);\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Error\"\n        });\n      }, 50);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Error\"\n        });\n      }, 100);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\"\n        });\n      }, 330);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay and output the most recent payload","suites":["trigger node"],"updatePoint":{"line":1151,"column":75,"index":29977},"line":1151,"code":"  it('should be able to extend the delay and output the most recent payload', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"60\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", \"World\");\n          (Date.now() - ss).should.be.greaterThan(120);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye\"\n        });\n      }, 40);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\"\n        });\n      }, 80);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able output the 2nd payload","suites":["trigger node"],"updatePoint":{"line":1196,"column":43,"index":31049},"line":1196,"code":"  it('should be able output the 2nd payload', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"false\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Goodbye\");\n            msg.should.have.a.property(\"topic\", \"test2\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            msg.should.have.a.property(\"topic\", \"test3\");\n            (Date.now() - ss).should.be.greaterThan(70);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\",\n        topic: \"test1\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\",\n          topic: \"test3\"\n        });\n      }, 80);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able output the 2nd payload and handle multiple topics","suites":["trigger node"],"updatePoint":{"line":1251,"column":70,"index":32484},"line":1251,"code":"  it('should be able output the 2nd payload and handle multiple topics', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"false\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"80\",\n      bytopic: \"topic\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Goodbye1\");\n            msg.should.have.a.property(\"topic\", \"test1\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"Goodbye2\");\n            msg.should.have.a.property(\"topic\", \"test2\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"Hello1\",\n        topic: \"test1\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Hello2\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye2\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye1\",\n          topic: \"test1\"\n        });\n      }, 20);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to apply mustache templates to payloads","suites":["trigger node"],"updatePoint":{"line":1311,"column":60,"index":33996},"line":1311,"code":"  it('should be able to apply mustache templates to payloads', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"{{payload}}\",\n      op2: \"{{topic}}\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Hello\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"Hello\",\n        topic: \"World\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to send 2nd message to a 2nd output","suites":["trigger node"],"updatePoint":{"line":1349,"column":56,"index":34926},"line":1349,"code":"  it('should be able to send 2nd message to a 2nd output', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"hello\",\n      op2: \"world\",\n      duration: \"50\",\n      outputs: 2,\n      wires: [[\"n2\"], [\"n3\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"hello\");\n            msg.should.have.a.property(\"topic\", \"test\");\n            c += 1;\n          } else {\n            done(err);\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n3.on(\"input\", function (msg) {\n        try {\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", \"world\");\n            msg.should.have.a.property(\"topic\", \"test\");\n            done();\n          } else {\n            done(err);\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"go\",\n        topic: \"test\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle string null as null","suites":["trigger node"],"updatePoint":{"line":1405,"column":39,"index":36267},"line":1405,"code":"  it('should handle string null as null', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"pay\",\n      op1: \"null\",\n      op2: \"null\",\n      duration: \"40\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", null);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"World\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle string null as null on op2","suites":["trigger node"],"updatePoint":{"line":1442,"column":46,"index":37148},"line":1442,"code":"  it('should handle string null as null on op2', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"null\",\n      op2: \"null\",\n      duration: \"40\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", null);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", null);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"null\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout","suites":["trigger node"],"updatePoint":{"line":1479,"column":63,"index":38042},"line":1479,"code":"  it('should be able to set infinite timeout, and clear timeout', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"0\",\n      extend: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        reset: true\n      }); // clear the blockage\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by message","suites":["trigger node"],"updatePoint":{"line":1531,"column":74,"index":39211},"line":1531,"code":"  it('should be able to set infinite timeout, and clear timeout by message', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"boo\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // don't clear the blockage\n\n      n1.emit(\"input\", {\n        payload: \"boo\"\n      }); // clear the blockage\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 50);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by boolean true","suites":["trigger node"],"updatePoint":{"line":1588,"column":79,"index":40475},"line":1588,"code":"  it('should be able to set infinite timeout, and clear timeout by boolean true', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"true\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: false\n      }); // don't clear the blockage\n\n      n1.emit(\"input\", {\n        payload: true\n      }); // clear the blockage\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by boolean false","suites":["trigger node"],"updatePoint":{"line":1644,"column":80,"index":41739},"line":1644,"code":"  it('should be able to set infinite timeout, and clear timeout by boolean false', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"false\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // don't clear the blockage\n\n      n1.emit(\"input\", {\n        payload: false\n      }); // clear the blockage\n\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set a repeat, and clear loop by reset","suites":["trigger node"],"updatePoint":{"line":1700,"column":61,"index":42986},"line":1700,"code":"  it('should be able to set a repeat, and clear loop by reset', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"boo\",\n      op1: \"\",\n      op1type: \"pay\",\n      duration: -25,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c += 1;\n\n        try {\n          msg.should.have.property('payload', 'foo');\n          msg.payload = \"bar\"; // try to provoke pass by reference error\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // trigger\n\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // trigger\n\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          reset: true\n        }); // reset\n      }, 90);\n      setTimeout(function () {\n        c.should.within(2, 5); // should send foo between 2 and 5 times.\n\n        done();\n      }, 180);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when first message has been processed","suites":["trigger node","messaging API"],"updatePoint":{"line":1800,"column":64,"index":45804},"line":1800,"code":"    it('should call done() when first message has been processed', function (done) {\n      // not when second and more messages are emitted.\n      mapiDoneTriggerTestHelper(done, {\n        units: \"s\",\n        duration: \"1\"\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\"\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when it receives reset message","suites":["trigger node","messaging API"],"updatePoint":{"line":1815,"column":57,"index":46169},"line":1815,"code":"    it('should call done() when it receives reset message', function (done) {\n      mapiDoneTriggerTestHelper(done, {\n        units: \"s\",\n        duration: \"1\"\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          reset: true\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with any defaults","suites":["exec node"],"updatePoint":{"line":37,"column":40,"index":1186},"line":37,"code":"  it('should be loaded with any defaults', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"exec\",\n      name: \"exec1\"\n    }];\n    helper.load(execNode, flow, function () {\n      try {\n        var n1 = helper.getNode(\"n1\");\n        n1.should.have.property(\"name\", \"exec1\");\n        n1.should.have.property(\"cmd\", \"\");\n        n1.should.have.property(\"append\", \"\");\n        n1.should.have.property(\"addpay\", \"payload\");\n        n1.should.have.property(\"timer\", 0);\n        n1.should.have.property(\"oldrc\", \"false\");\n        n1.should.have.property(\"execOpt\");\n        n1.execOpt.should.have.property(\"encoding\", 'binary');\n        n1.execOpt.should.have.property(\"maxBuffer\", 10000000);\n        n1.execOpt.should.have.property(\"windowsHide\", false);\n        n1.should.have.property(\"spawnOpt\");\n        n1.spawnOpt.should.have.property(\"windowsHide\", false);\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command","suites":["exec node","calling exec"],"updatePoint":{"line":65,"column":36,"index":2176},"line":65,"code":"    it('should exec a simple command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n\n        var completeTest = function () {\n          received = received + 1;\n\n          if (received < 3) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 0);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command with appended value from message","suites":["exec node","calling exec"],"updatePoint":{"line":144,"column":69,"index":4495},"line":144,"code":"    it('should exec a simple command with appended value from message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"]],\n        command: \"echo\",\n        addpay: \"topic\",\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"bar more\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command with extra parameters","suites":["exec node","calling exec"],"updatePoint":{"line":176,"column":58,"index":5340},"line":176,"code":"    it('should exec a simple command with extra parameters', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: \"payload\",\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n\n        var completeTest = function () {\n          received++;\n\n          if (received < 2) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo and more\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO AND MORE\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return a binary buffer","suites":["exec node","calling exec"],"updatePoint":{"line":249,"column":48,"index":7430},"line":249,"code":"    it('should be able to return a binary buffer', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: true,\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3(\"error\", Buffer.from([0x01, 0x02, 0x03, 0x88]), Buffer.from([0x01, 0x02, 0x03, 0x88]));\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          //console.log(\"n2\",msg);\n          try {\n            msg.should.have.property(\"payload\");\n            Buffer.isBuffer(msg.payload).should.be.true();\n            msg.payload.length.should.equal(4);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to timeout a long running command","suites":["exec node","calling exec"],"updatePoint":{"line":294,"column":56,"index":8812},"line":294,"code":"    it('should be able to timeout a long running command', function (done) {\n      var flow;\n\n      if (osType === \"Windows_NT\") {\n        // Although Windows timeout command is equivalent to sleep, this cannot be used because it promptly outputs a message.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"0.3\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"0.3\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command","suites":["exec node","calling exec"],"updatePoint":{"line":357,"column":53,"index":10460},"line":357,"code":"    it('should be able to kill a long running command', function (done) {\n      var flow;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", null);\n            msg.rc.should.have.property(\"signal\", \"SIGTERM\");\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command - SIGINT","suites":["exec node","calling exec"],"updatePoint":{"line":433,"column":62,"index":12384},"line":433,"code":"    it('should be able to kill a long running command - SIGINT', function (done) {\n      var flow;\n      var sig = \"SIGINT\";\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", null);\n            msg.rc.should.have.property(\"signal\", \"SIGINT\");\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", sig);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"SIGINT\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return the rc for a failing command","suites":["exec node","calling exec"],"updatePoint":{"line":510,"column":50,"index":14321},"line":510,"code":"    it('should return the rc for a failing command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"error\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3({\n          code: 1\n        }, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n\n        var completeTest = function () {\n          received++;\n\n          if (received < 3) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"error\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 1);\n            msg.rc.should.have.property(\"message\", undefined);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ERROR\");\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object","suites":["exec node","calling exec"],"updatePoint":{"line":591,"column":57,"index":16639},"line":591,"code":"    it('should preserve existing properties on msg object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n\n        var completeTest = function () {\n          received = received + 1;\n\n          if (received < 3) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\",\n          foo: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object for a failing command","suites":["exec node","calling exec"],"updatePoint":{"line":674,"column":79,"index":19146},"line":674,"code":"    it('should preserve existing properties on msg object for a failing command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"error\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3({\n          code: 1\n        }, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n\n        var completeTest = function () {\n          received++;\n\n          if (received < 3) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"error\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 1);\n            msg.rc.should.have.property(\"message\", undefined);\n            msg.should.have.property(\"foo\", null);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ERROR\");\n            msg.should.have.property(\"foo\", null);\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            msg.should.have.property(\"foo\", null);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\",\n          foo: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command","suites":["exec node","calling spawn"],"updatePoint":{"line":760,"column":37,"index":21637},"line":760,"code":"    it('should spawn a simple command', function (done) {\n      var flow;\n      var expected;\n\n      if (osType === \"Windows_NT\") {\n        // Need to use cmd to spawn a process because Windows echo command is a built-in command and cannot be spawned.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"hello world\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"hello world\\n\";\n      }\n\n      var events = require('events');\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var payload = \"\";\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            payload += msg.payload;\n\n            if (payload.endsWith(\"\\n\")) {\n              payload.should.equal(expected);\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"hello world\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command with a non string payload parameter","suites":["exec node","calling spawn"],"updatePoint":{"line":837,"column":73,"index":23632},"line":837,"code":"    it('should spawn a simple command with a non string payload parameter', function (done) {\n      var flow;\n      var expected;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \" deg C\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"12345 deg C\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \" deg C\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"12345 deg C\\n\";\n      }\n\n      var payload = \"\";\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            payload += msg.payload;\n\n            if (payload.endsWith(\"\\n\")) {\n              payload.should.equal(expected);\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 12345\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command and return binary buffer","suites":["exec node","calling spawn"],"updatePoint":{"line":911,"column":62,"index":25459},"line":911,"code":"    it('should spawn a simple command and return binary buffer', function (done) {\n      var flow;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            Buffer.isBuffer(msg.payload).should.be.true();\n\n            if (osType === \"Windows_NT\") {\n              msg.payload.length.should.equalOneOf(6, 8);\n            } else {\n              msg.payload.length.should.equal(7);\n            }\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: Buffer.from([0x01, 0x02, 0x03, 0x88])\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should work if passed multiple words to spawn command","suites":["exec node","calling spawn"],"updatePoint":{"line":982,"column":61,"index":27217},"line":982,"code":"    it('should work if passed multiple words to spawn command', function (done) {\n      var flow;\n      var expected;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\n\";\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n\n        var completeTest = function () {\n          received++;\n\n          if (received < 2) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(expected);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            should.exist(msg.payload);\n            msg.payload.should.have.property(\"code\", 0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          var payload = msg.payload;\n\n          if (messages[0]) {\n            messages[0].payload += payload;\n          } else {\n            messages[0] = msg;\n          }\n\n          if (payload.endsWith(\"\\n\")) {\n            completeTest();\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          fred: 123\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a bad command","suites":["exec node","calling spawn"],"updatePoint":{"line":1083,"column":48,"index":29704},"line":1083,"code":"    it('should return an error for a bad command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"madeupcommandshouldfail\",\n        addpay: false,\n        append: \"\",\n        useSpawn: \"true\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\");\n            msg.payload.code.should.be.below(0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a failing command","suites":["exec node","calling spawn"],"updatePoint":{"line":1123,"column":52,"index":30760},"line":1123,"code":"    it('should return an error for a failing command', function (done) {\n      var flow;\n      var expected;\n      var expectedFound = false;\n\n      if (osType === \"Windows_NT\") {\n        // Cannot use mkdir because Windows mkdir command automatically creates non-existent directories.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"IP address must be specified.\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"mkdir /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = ' directory';\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n3.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n\n            if (msg.payload.indexOf(expected) >= 0) {\n              // The error text on the stderr stream might get sent in more than one piece.\n              // We only need to know that it occurred before the return code is sent,\n              // as checked below in node n4.\n              expectedFound = true;\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            expectedFound.should.be.true;\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to timeout a long running command","suites":["exec node","calling spawn"],"updatePoint":{"line":1208,"column":56,"index":33160},"line":1208,"code":"    it('should be able to timeout a long running command', function (done) {\n      var flow;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000\",\n          timer: \"0.3\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"0.3\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", null);\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command","suites":["exec node","calling spawn"],"updatePoint":{"line":1273,"column":53,"index":34791},"line":1273,"code":"    it('should be able to kill a long running command', function (done) {\n      var flow;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command - SIGINT","suites":["exec node","calling spawn"],"updatePoint":{"line":1340,"column":62,"index":36425},"line":1340,"code":"    it('should be able to kill a long running command - SIGINT', function (done) {\n      var flow;\n      var sig = \"SIGINT\";\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", sig);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"SIGINT\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object","suites":["exec node","calling spawn"],"updatePoint":{"line":1408,"column":57,"index":38080},"line":1408,"code":"    it('should preserve existing properties on msg object', function (done) {\n      var flow;\n      var expected;\n\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\n\";\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n\n        var completeTest = function () {\n          received++;\n\n          if (received < 2) {\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(expected);\n            msg.should.have.property(\"foo\", 123);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            should.exist(msg.payload);\n            msg.payload.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", 123);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n\n        n2.on(\"input\", function (msg) {\n          var payload = msg.payload;\n\n          if (messages[0]) {\n            messages[0].payload += payload;\n          } else {\n            messages[0] = msg;\n          }\n\n          if (payload.endsWith(\"\\n\")) {\n            completeTest();\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          foo: 123\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object for a failing command","suites":["exec node","calling spawn"],"updatePoint":{"line":1511,"column":79,"index":40697},"line":1511,"code":"    it('should preserve existing properties on msg object for a failing command', function (done) {\n      var flow;\n      var expected;\n\n      if (osType === \"Windows_NT\") {\n        // Cannot use mkdir because Windows mkdir command automatically creates non-existent directories.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"IP address must be specified.\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"mkdir /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = ' directory';\n      }\n\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n\n        var completeTest = function () {\n          if (messages[0] === null || messages[1] === null) {\n            // We have not yet had responses on both ports.\n            return;\n          }\n\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.should.have.property(\"foo\", \"baz\");\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            msg.should.have.property(\"foo\", \"baz\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n\n        n3.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          foo: \"baz\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with correct defaults","suites":["rbe node"],"updatePoint":{"line":18,"column":44,"index":453},"line":18,"code":"  it(\"should be loaded with correct defaults\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      \"name\": \"rbe1\",\n      \"wires\": [[]]\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property(\"name\", \"rbe1\");\n      n1.should.have.property(\"func\", \"rbe\");\n      n1.should.have.property(\"gap\", \"0\");\n      done();\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if payload changes - with multiple topics (rbe)","suites":["rbe node"],"updatePoint":{"line":33,"column":77,"index":905},"line":33,"code":"  it('should only send output if payload changes - with multiple topics (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 2);\n          c += 1;\n        } else if (c == 2) {\n          msg.should.have.a.property(\"payload\");\n          msg.payload.should.have.a.property(\"b\", 1);\n          msg.payload.should.have.a.property(\"c\", 2);\n          c += 1;\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 4) {\n          msg.should.have.a.property(\"payload\", false);\n          c += 1;\n        } else if (c == 5) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 6) {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else if (c == 7) {\n          msg.should.have.a.property(\"topic\", \"b\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else {\n          c += 1;\n          msg.should.have.a.property(\"topic\", \"c\");\n          msg.should.have.a.property(\"payload\", 1);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n      n1.emit(\"input\", {\n        payload: false\n      });\n      n1.emit(\"input\", {\n        payload: false\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should ignore multiple topics if told to (rbe)","suites":["rbe node"],"updatePoint":{"line":151,"column":52,"index":3681},"line":151,"code":"  it('should ignore multiple topics if told to (rbe)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      septopics: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 2);\n          c += 1;\n        } else if (c == 2) {\n          msg.should.have.a.property(\"payload\");\n          msg.payload.should.have.a.property(\"b\", 1);\n          msg.payload.should.have.a.property(\"c\", 2);\n          c += 1;\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 4) {\n          msg.should.have.a.property(\"payload\", false);\n          c += 1;\n        } else if (c == 5) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 6) {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 2);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: false\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: false\n      });\n      n1.emit(\"input\", {\n        topic: \"d\",\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"d\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 2\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if another chosen property changes - foo (rbe)","suites":["rbe node"],"updatePoint":{"line":274,"column":76,"index":6512},"line":274,"code":"  it('should only send output if another chosen property changes - foo (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      property: \"foo\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"foo\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"foo\", \"b\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"foo\");\n          msg.foo.should.have.a.property(\"b\", 1);\n          msg.foo.should.have.a.property(\"c\", 2);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"b\"\n      });\n      n1.emit(\"input\", {\n        foo: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        foo: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if payload changes - ignoring first value (rbei)","suites":["rbe node"],"updatePoint":{"line":342,"column":78,"index":7977},"line":342,"code":"  it('should only send output if payload changes - ignoring first value (rbei)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbei\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          msg.should.have.a.property(\"topic\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          msg.should.have.a.property(\"topic\", \"b\");\n          c += 1;\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", \"c\");\n          msg.should.have.a.property(\"topic\", \"a\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"payload\", \"c\");\n          msg.should.have.a.property(\"topic\", \"b\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"b\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"b\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"b\",\n        topic: \"b\"\n      });\n      n1.emit(\"input\", {\n        payload: \"c\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"c\",\n        topic: \"b\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should send output if queue is reset (rbe)","suites":["rbe node"],"updatePoint":{"line":406,"column":48,"index":9552},"line":406,"code":"  it('should send output if queue is reset (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 4) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 5) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 6) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"payload\", \"c\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        reset: true\n      }); // reset all\n\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        reset: \"\"\n      }); // reset b\n\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        reset: \"\"\n      }); // reset all\n\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\"\n      }); // don't reset a non topic\n\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if x away from original value (deadbandEq)","suites":["rbe node"],"updatePoint":{"line":519,"column":72,"index":12109},"line":519,"code":"  it('should only send output if x away from original value (deadbandEq)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadbandEq\",\n      gap: \"10\",\n      inout: \"out\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 10);\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", 20);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 4\n      });\n      n1.emit(\"input\", {\n        payload: 6\n      });\n      n1.emit(\"input\", {\n        payload: 8\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if more than x away from original value (deadband)","suites":["rbe node"],"updatePoint":{"line":573,"column":80,"index":13328},"line":573,"code":"  it('should only send output if more than x away from original value (deadband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1; //console.log(c,msg);\n\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 20);\n        } else {\n          msg.should.have.a.property(\"payload\", \"5 deg\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 4\n      });\n      n1.emit(\"input\", {\n        payload: \"6 deg\"\n      });\n      n1.emit(\"input\", {\n        payload: 8\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: \"5 deg\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if more than x% away from original value (deadband)","suites":["rbe node"],"updatePoint":{"line":626,"column":81,"index":14552},"line":626,"code":"  it('should only send output if more than x% away from original value (deadband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10%\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 100);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 111);\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", 135);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 100\n      });\n      n1.emit(\"input\", {\n        payload: 95\n      });\n      n1.emit(\"input\", {\n        payload: 105\n      });\n      n1.emit(\"input\", {\n        payload: 111\n      });\n      n1.emit(\"input\", {\n        payload: 120\n      });\n      n1.emit(\"input\", {\n        payload: 135\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should warn if no number found in deadband mode","suites":["rbe node"],"updatePoint":{"line":673,"column":53,"index":15628},"line":673,"code":"  it('should warn if no number found in deadband mode', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c += 1;\n      });\n      setTimeout(function () {\n        c.should.equal(0);\n        helper.log().called.should.be.true;\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"rbe\";\n        });\n        logEvents.should.have.length(1);\n        var msg = logEvents[0][0];\n        msg.should.have.property('level', helper.log().WARN);\n        msg.should.have.property('id', 'n1');\n        msg.should.have.property('type', 'rbe');\n        msg.should.have.property('msg', 'rbe.warn.nonumber');\n        done();\n      }, 50);\n      n1.emit(\"input\", {\n        payload: \"banana\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if x away or greater from original value (narrowbandEq)","suites":["rbe node"],"updatePoint":{"line":710,"column":84,"index":16727},"line":710,"code":"  it('should not send output if x away or greater from original value (narrowbandEq)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowbandEq\",\n      gap: \"10\",\n      inout: \"out\",\n      start: \"1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1; //console.log(c,msg);\n\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 5);\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", 10);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 100\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 5\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 25\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if more than x away from original value (narrowband)","suites":["rbe node"],"updatePoint":{"line":765,"column":81,"index":17993},"line":765,"code":"  it('should not send output if more than x away from original value (narrowband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"6 deg\");\n        } else {\n          msg.should.have.a.property(\"payload\", \"5 deg\");\n          done();\n        }\n\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 40\n      });\n      n1.emit(\"input\", {\n        payload: \"6 deg\"\n      });\n      n1.emit(\"input\", {\n        payload: 18\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 50\n      });\n      n1.emit(\"input\", {\n        payload: \"5 deg\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should send output if gap is 0 and input doesnt change (narrowband)","suites":["rbe node"],"updatePoint":{"line":818,"column":73,"index":19194},"line":818,"code":"  it('should send output if gap is 0 and input doesnt change (narrowband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 1);\n        } else if (c === 4) {\n          msg.should.have.a.property(\"payload\", 1);\n          done();\n        }\n\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if more than x away from original value (narrowband in step mode)","suites":["rbe node"],"updatePoint":{"line":863,"column":94,"index":20209},"line":863,"code":"  it('should not send output if more than x away from original value (narrowband in step mode)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"10\",\n      inout: \"in\",\n      start: \"500\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 55);\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 205);\n          done();\n        }\n\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 50\n      });\n      n1.emit(\"input\", {\n        payload: 55\n      });\n      n1.emit(\"input\", {\n        payload: 200\n      });\n      n1.emit(\"input\", {\n        payload: 205\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should get plain text content","suites":["HTTP Request Node","request"],"updatePoint":{"line":415,"column":37,"index":12450},"line":415,"code":"    it('should get plain text content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.redirectList.length.should.equal(0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should get JSON content","suites":["HTTP Request Node","request"],"updatePoint":{"line":448,"column":31,"index":13484},"line":448,"code":"    it('should get JSON content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/json-valid')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              a: 1\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send the payload as the body of a POST as application/json","suites":["HTTP Request Node","request"],"updatePoint":{"line":481,"column":73,"index":14462},"line":481,"code":"    it('should send the payload as the body of a POST as application/json', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('{\"foo\":\"abcde\"}');\n            msg.payload.headers.should.have.property('content-type').which.startWith('application/json');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a payload of 0 as the body of a POST as text/plain","suites":["HTTP Request Node","request"],"updatePoint":{"line":516,"column":70,"index":15602},"line":516,"code":"    it('should send a payload of 0 as the body of a POST as text/plain', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('0');\n            msg.payload.headers.should.have.property('content-length', '1');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 0,\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send an Object payload as the body of a POST","suites":["HTTP Request Node","request"],"updatePoint":{"line":552,"column":59,"index":16728},"line":552,"code":"    it('should send an Object payload as the body of a POST', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('{\"foo\":\"abcde\"}');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          },\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a Buffer as the body of a POST","suites":["HTTP Request Node","request"],"updatePoint":{"line":590,"column":50,"index":17917},"line":590,"code":"    it('should send a Buffer as the body of a POST', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('hello');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: Buffer.from('hello'),\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send form-based request","suites":["HTTP Request Node","request"],"updatePoint":{"line":626,"column":38,"index":19066},"line":626,"code":"    it('should send form-based request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.body.should.equal(\"foo=1%202%203&bar=\");\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('content-type', 'application/x-www-form-urlencoded');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: '1 2 3',\n            bar: ''\n          },\n          headers: {\n            'content-type': 'application/x-www-form-urlencoded'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send PUT request","suites":["HTTP Request Node","request"],"updatePoint":{"line":663,"column":31,"index":20153},"line":663,"code":"    it('should send PUT request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"PUT\",\n        ret: \"obj\",\n        url: getTestURL('/putInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send DELETE request","suites":["HTTP Request Node","request"],"updatePoint":{"line":699,"column":34,"index":21279},"line":699,"code":"    it('should send DELETE request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"DELETE\",\n        ret: \"obj\",\n        url: getTestURL('/deleteInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send HEAD request","suites":["HTTP Request Node","request"],"updatePoint":{"line":730,"column":32,"index":22076},"line":730,"code":"    it('should send HEAD request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"txt\",\n        url: getTestURL('/headInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"head\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send PATCH request","suites":["HTTP Request Node","request"],"updatePoint":{"line":760,"column":33,"index":22862},"line":760,"code":"    it('should send PATCH request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"PATCH\",\n        ret: \"obj\",\n        url: getTestURL('/patchInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('etag');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send OPTIONS request","suites":["HTTP Request Node","request"],"updatePoint":{"line":795,"column":35,"index":23849},"line":795,"code":"    it('should send OPTIONS request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"obj\",\n        url: getTestURL('/*')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"options\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send TRACE request","suites":["HTTP Request Node","request"],"updatePoint":{"line":824,"column":33,"index":24575},"line":824,"code":"    it('should send TRACE request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"obj\",\n        url: getTestURL('/traceInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"trace\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should get Buffer content","suites":["HTTP Request Node","request"],"updatePoint":{"line":857,"column":33,"index":25425},"line":857,"code":"    it('should get Buffer content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"bin\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            Buffer.isBuffer(msg.payload).should.be.true();\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return plain text when JSON fails to parse","suites":["HTTP Request Node","request"],"updatePoint":{"line":889,"column":57,"index":26368},"line":889,"code":"    it('should return plain text when JSON fails to parse', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/json-invalid')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', \"{a:1\");\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return the status code","suites":["HTTP Request Node","request"],"updatePoint":{"line":920,"column":37,"index":27284},"line":920,"code":"    it('should return the status code', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/statusCode204')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.url","suites":["HTTP Request Node","request"],"updatePoint":{"line":949,"column":26,"index":28039},"line":949,"code":"    it('should use msg.url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: \"/foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when URL is not provided","suites":["HTTP Request Node","request"],"updatePoint":{"line":979,"column":55,"index":28842},"line":979,"code":"    it('should output an error when URL is not provided', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: \"\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"no url allowed though\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the message to provide the url","suites":["HTTP Request Node","request"],"updatePoint":{"line":1010,"column":51,"index":29623},"line":1010,"code":"    it('should allow the message to provide the url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: getTestURL('/text')\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the url to contain mustache placeholders","suites":["HTTP Request Node","request"],"updatePoint":{"line":1042,"column":61,"index":30636},"line":1042,"code":"    it('should allow the url to contain mustache placeholders', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/te{{placeholder}}')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          placeholder: \"xt\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the url to be missing the http:// prefix","suites":["HTTP Request Node","request"],"updatePoint":{"line":1075,"column":61,"index":31689},"line":1075,"code":"    it('should allow the url to be missing the http:// prefix', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text').substring(\"http://\".length)\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject non http:// schemes - node config","suites":["HTTP Request Node","request"],"updatePoint":{"line":1107,"column":55,"index":32722},"line":1107,"code":"    it('should reject non http:// schemes - node config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: \"ftp://foo\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"non http(s):// scheme allowed through\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject non http:// schemes - msg.url","suites":["HTTP Request Node","request"],"updatePoint":{"line":1138,"column":51,"index":33528},"line":1138,"code":"    it('should reject non http:// schemes - msg.url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: \"ftp://foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"non http(s):// scheme allowed through\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.method","suites":["HTTP Request Node","request"],"updatePoint":{"line":1169,"column":29,"index":34314},"line":1169,"code":"    it('should use msg.method', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"POST\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the message to provide the method","suites":["HTTP Request Node","request"],"updatePoint":{"line":1199,"column":54,"index":35119},"line":1199,"code":"    it('should allow the message to provide the method', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"get\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive msg.responseUrl","suites":["HTTP Request Node","request"],"updatePoint":{"line":1232,"column":38,"index":36132},"line":1232,"code":"    it('should receive msg.responseUrl', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('responseUrl', getTestURL('/text'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive msg.responseUrl when redirected","suites":["HTTP Request Node","request"],"updatePoint":{"line":1261,"column":54,"index":36927},"line":1261,"code":"    it('should receive msg.responseUrl when redirected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/redirectToText')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('responseUrl', getTestURL('/text'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should prevent following redirect when msg.followRedirects is false","suites":["HTTP Request Node","request"],"updatePoint":{"line":1291,"column":75,"index":37811},"line":1291,"code":"    it('should prevent following redirect when msg.followRedirects is false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/redirectToText')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 302);\n            msg.should.have.property('responseUrl', getTestURL('/redirectToText'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          followRedirects: false\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when request timeout occurred","suites":["HTTP Request Node","request"],"updatePoint":{"line":1321,"column":60,"index":38666},"line":1321,"code":"    it('should output an error when request timeout occurred', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var timeout = RED.settings.httpRequestTimeout;\n      RED.settings.httpRequestTimeout = 50;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode');\n            /TIMEDOUT/.test(msg.statusCode).should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(1);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().ERROR,\n              id: 'n1',\n              type: 'http request',\n              msg: 'common.notification.errors.no-response',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          } finally {\n            RED.settings.httpRequestTimeout = timeout;\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when request timeout occurred when set via msg.requestTimeout","suites":["HTTP Request Node","request"],"updatePoint":{"line":1367,"column":92,"index":40173},"line":1367,"code":"    it('should output an error when request timeout occurred when set via msg.requestTimeout', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode');\n            /TIMEDOUT/.test(msg.statusCode).should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(1);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().ERROR,\n              id: 'n1',\n              type: 'http request',\n              msg: 'common.notification.errors.no-response',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 50\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is not a number","suites":["HTTP Request Node","request"],"updatePoint":{"line":1410,"column":67,"index":41511},"line":1410,"code":"    it('should show a warning if msg.requestTimeout is not a number', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnan',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is negative","suites":["HTTP Request Node","request"],"updatePoint":{"line":1452,"column":63,"index":42776},"line":1452,"code":"    it('should show a warning if msg.requestTimeout is negative', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnegative',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: -4\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is set to 0","suites":["HTTP Request Node","request"],"updatePoint":{"line":1494,"column":63,"index":44043},"line":1494,"code":"    it('should show a warning if msg.requestTimeout is set to 0', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnegative',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 0\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should pass if response time is faster than timeout set via msg.requestTimeout","suites":["HTTP Request Node","request"],"updatePoint":{"line":1536,"column":86,"index":45332},"line":1536,"code":"    it('should pass if response time is faster than timeout set via msg.requestTimeout', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout50ms')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 100\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should append query params to url - obj","suites":["HTTP Request Node","request"],"updatePoint":{"line":1565,"column":47,"index":46084},"line":1565,"code":"    it('should append query params to url - obj', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        paytoqs: true,\n        ret: \"obj\",\n        url: getTestURL('/getQueryParams')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              query: {\n                a: '1',\n                b: '2',\n                c: '3'\n              },\n              url: '/getQueryParams?a=1&b=2&c=3'\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            a: 1,\n            b: 2,\n            c: 3\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 400","suites":["HTTP Request Node","request"],"updatePoint":{"line":1607,"column":59,"index":47179},"line":1607,"code":"    it('should send a msg for non-2xx response status - 400', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/400')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '400'\n            });\n            msg.should.have.property('statusCode', 400);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 404","suites":["HTTP Request Node","request"],"updatePoint":{"line":1636,"column":59,"index":47978},"line":1636,"code":"    it('should send a msg for non-2xx response status - 404', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/404')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '404'\n            });\n            msg.should.have.property('statusCode', 404);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 500","suites":["HTTP Request Node","request"],"updatePoint":{"line":1665,"column":59,"index":48777},"line":1665,"code":"    it('should send a msg for non-2xx response status - 500', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/500')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '500'\n            });\n            msg.should.have.property('statusCode', 500);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode the url to handle special characters","suites":["HTTP Request Node","request"],"updatePoint":{"line":1694,"column":58,"index":49575},"line":1694,"code":"    it('should encode the url to handle special characters', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              query: {\n                a: 'b',\n                c: ['T24,0|H80%|W S8,3m/s']\n              },\n              url: '/getQueryParams?a=b&c[0].Text=T24,0%C2%B0|H80%25|W%20S8,3m/s'\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          url: getTestURL('/getQueryParams') + \"?a=b&c[0].Text=T24,0|H80%|W%20S8,3m/s\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive cookie","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1731,"column":29,"index":50652},"line":1731,"code":"    it('should receive cookie', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/setCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.responseCookies.should.have.property('data');\n            msg.responseCookies.data.should.have.property('value', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie with string","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1761,"column":38,"index":51501},"line":1761,"code":"    it('should send cookie with string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: 'abc'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies with string","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1793,"column":48,"index":52342},"line":1793,"code":"    it('should send multiple cookies with string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: 'abc',\n            foo: 'bar'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie with object data","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1827,"column":43,"index":53262},"line":1827,"code":"    it('should send cookie with object data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: 'abc'\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies with object data","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1861,"column":53,"index":54145},"line":1861,"code":"    it('should send multiple cookies with object data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: 'abc'\n            },\n            foo: {\n              value: 'bar'\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode cookie value","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1899,"column":34,"index":55130},"line":1899,"code":"    it('should encode cookie value', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = ';,/?:@ &=+$#';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', encodeURIComponent(value));\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: value\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode cookie object","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1932,"column":35,"index":56014},"line":1932,"code":"    it('should encode cookie object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = ';,/?:@ &=+$#';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', encodeURIComponent(value));\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: value,\n              encode: true\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not encode cookie when encode option is false","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1968,"column":60,"index":56988},"line":1968,"code":"    it('should not encode cookie when encode option is false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = '!#$%&\\'()*+-./:<>?@[]^_`{|}~';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', value);\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: value,\n              encode: false\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie by msg.headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2004,"column":41,"index":57940},"line":2004,"code":"    it('should send cookie by msg.headers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            boo: '123'\n          },\n          headers: {\n            'cookie': 'data=abc'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies by msg.headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2039,"column":51,"index":58850},"line":2039,"code":"    it('should send multiple cookies by msg.headers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            boo: '123'\n          },\n          headers: {\n            'cookie': 'data=abc; foo=bar;'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should convert all HTTP headers into lower case","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2075,"column":55,"index":59834},"line":2075,"code":"    it('should convert all HTTP headers into lower case', function (done) {\n      // This is a bad test. Express lower-cases headers in the `req.headers` object,\n      // so this is actually testing express, not the original request.\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.payload.headers.should.have.property('content-length', \"3\");\n            msg.payload.headers.should.have.property('if-modified-since', 'Sun, 01 Jun 2000 00:00:00 GMT');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'Content-Type': 'text/plain',\n            'Content-Length': \"3\",\n            'If-Modified-Since': 'Sun, 01 Jun 2000 00:00:00 GMT'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should keep HTTP header case as provided by the user","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2114,"column":60,"index":61245},"line":2114,"code":"    it('should keep HTTP header case as provided by the user', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/rawHeaders')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('Content-Type').which.startWith('text/plain');\n            msg.payload.headers.should.have.property('X-Test-HEAD', \"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'Content-Type': 'text/plain',\n            \"X-Test-HEAD\": \"foo\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive HTTP header","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2149,"column":34,"index":62294},"line":2149,"code":"    it('should receive HTTP header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/headersInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.headers.should.have.property('x-test-header', 'bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should ignore unmodified x-node-red-request-node header","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2178,"column":63,"index":63104},"line":2178,"code":"    it('should ignore unmodified x-node-red-request-node header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.headers.should.have.property('content-type').which.startWith('application/json');\n            msg.payload.headers.should.not.have.property('x-node-red-request-node');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }); // Pass in a headers property with an unmodified x-node-red-request-node hash\n        // This should cause the node to ignore the headers\n\n        var headers = {\n          'content-type': 'text/plain'\n        };\n        headers['x-node-red-request-node'] = require(\"hash-sum\")(headers);\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          headers: headers\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use modified msg.headers property","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2216,"column":48,"index":64308},"line":2216,"code":"    it('should use modified msg.headers property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.payload.headers.should.not.have.property('x-node-red-request-node');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }); // Pass in a headers property with a x-node-red-request-node hash that doesn't match the contents\n        // This should cause the node to use the headers\n\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          headers: {\n            'content-type': 'text/plain',\n            \"x-node-red-request-node\": \"INVALID_SUM\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use ui headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2253,"column":29,"index":65456},"line":2253,"code":"    it('should use ui headers', function (done) {\n      const flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/rawHeaders'),\n        \"headers\": [{\n          \"keyType\": \"Accept\",\n          \"keyValue\": \"\",\n          \"valueType\": \"application/json\",\n          \"valueValue\": \"\"\n        }, //set \"Accept\" to \"application/json\"\n        {\n          \"keyType\": \"Content-Type\",\n          \"keyValue\": \"\",\n          \"valueType\": \"application/json\",\n          \"valueValue\": \"\"\n        }, //overwrite msg.headers['content-type'] with UI header 'Content-Type']\n        {\n          \"keyType\": \"msg\",\n          \"keyValue\": \"dynamicHeaderName\",\n          \"valueType\": \"msg\",\n          \"valueValue\": \"dynamicHeaderValue\"\n        }, //dynamic msg.dynamicHeaderName/msg.dynamicHeaderValue\n        {\n          \"keyType\": \"other\",\n          \"keyValue\": \"static-header-name\",\n          \"valueType\": \"other\",\n          \"valueValue\": \"static-header-value\"\n        }, //static \"other\" header and value\n        {\n          \"keyType\": \"Location\",\n          \"keyValue\": \"\",\n          \"valueType\": \"other\",\n          \"valueValue\": \"\"\n        } //delete \"Location\" header (initially set in msg.headers['location'] by passing empty string for value\n        ]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        const n1 = helper.getNode(\"n1\");\n        const n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers'); //msg.headers['Accept'] should be set by Flow UI\n\n            msg.payload.headers.should.have.property('Accept').which.startWith('application/json'); //msg.headers['content-type'] should be updated to 'Content-Type' by the value set in the Flow UI\n\n            msg.payload.headers.should.have.property('Content-Type').which.startWith('application/json'); //msg.dynamicHeaderName should be present in headers with the value of msg.dynamicHeaderValue\n\n            msg.payload.headers.should.have.property('dyn-header-name').which.startWith('dyn-header-value'); //static (custom) header set in Flow UI should be present \n\n            msg.payload.headers.should.have.property('static-header-name').which.startWith('static-header-value'); //msg.headers['location'] should be deleted because Flow UI \"Location\" header has a blank value\n            //ensures headers with matching characters but different case are eliminated\n\n            msg.payload.headers.should.not.have.property('location');\n            msg.payload.headers.should.not.have.property('Location');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }); // Pass in a headers property with a \"content-type\" & \"location\" header\n        // Pass in dynamicHeaderName & dynamicHeaderValue properties to set the Flow UI `msg.xxx` header entries\n\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          dynamicHeaderName: \"dyn-header-name\",\n          dynamicHeaderValue: \"dyn-header-value\",\n          headers: {\n            'content-type': 'text/plain',\n            'location': 'london'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.rejectUnauthorized","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2337,"column":41,"index":68863},"line":2337,"code":"    it('should use msg.rejectUnauthorized', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          rejectUnauthorized: false\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2371,"column":29,"index":69963},"line":2371,"code":"    it('should use tls-config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURLWithoutProtocol('/text'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"\",\n        verifyservercert: false\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config and verify serverCert","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2414,"column":51,"index":71363},"line":2414,"code":"    it('should use tls-config and verify serverCert', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURL('/text'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"test/resources/ssl/server.crt\",\n        verifyservercert: true\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config and send client cert","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2457,"column":50,"index":72775},"line":2457,"code":"    it('should use tls-config and send client cert', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslClientTestURL('/getClientCert'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"test/resources/ssl/server.crt\",\n        verifyservercert: false\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    }); //Removing HTTP Proxy testcases as GOT + Proxy_Agent doesn't work with mock'd proxy","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http_proxy","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2503,"column":29,"index":74278},"line":2503,"code":"    it('should use http_proxy', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://localhost:\" + testProxyPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers'); //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http_proxy when environment variable is invalid","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2537,"column":66,"index":75259},"line":2537,"code":"    it('should use http_proxy when environment variable is invalid', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"invalidvalue\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    }); // Remove HTTP-Proxy Authentication tests","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use HTTP_PROXY","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2572,"column":29,"index":76239},"line":2572,"code":"    it('should use HTTP_PROXY', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.HTTP_PROXY = \"http://localhost:\" + testProxyPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers'); //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use no_proxy","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2606,"column":27,"index":77181},"line":2606,"code":"    it('should use no_proxy', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://localhost:\" + testProxyPort;\n      process.env.no_proxy = \"foo,localhost\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use NO_PROXY","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2638,"column":27,"index":78115},"line":2638,"code":"    it('should use NO_PROXY', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.HTTP_PROXY = \"http://localhost:\" + testProxyPort;\n      process.env.NO_PROXY = \"foo,localhost\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    }); // Remove HTTP-Proxy Authentication tests","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http-proxy-config","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2673,"column":36,"index":79112},"line":2673,"code":"    it('should use http-proxy-config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyPort\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers'); //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not use http-proxy-config when invalid url is specified","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2712,"column":70,"index":80204},"line":2712,"code":"    it('should not use http-proxy-config when invalid url is specified', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"invalidvalue\"\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http-proxy-config when valid noproxy is specified","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2749,"column":68,"index":81276},"line":2749,"code":"    it('should use http-proxy-config when valid noproxy is specified', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyPort,\n        noproxy: [\"foo\", \"localhost\"]\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - basic","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2788,"column":45,"index":82377},"line":2788,"code":"    it('should authenticate on server - basic', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          user: 'userfoo',\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('user', 'userfoo');\n            msg.payload.should.have.property('pass', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - basic","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2822,"column":45,"index":83330},"line":2822,"code":"    it('should authenticate on server - basic', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          user: 'foo@example.com',\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('user', 'foo@example.com');\n            msg.payload.should.have.property('pass', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - bearer","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2856,"column":46,"index":84300},"line":2856,"code":"    it('should authenticate on server - bearer', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        authType: \"bearer\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('token', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    }); // Removed the Proxy Tests until a new mock proxy can be replaced with","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on proxy server","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2893,"column":43,"index":85314},"line":2893,"code":"    it('should authenticate on proxy server', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/proxyAuthenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://foouser:barpassword@localhost:\" + testProxyAuthPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200); //msg.payload.should.have.property('user', 'foouser');\n            //msg.payload.should.have.property('pass', 'barpassword');\n\n            msg.payload.should.have.property('headers'); //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on proxy server(http-proxy-config)","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2952,"column":62,"index":87543},"line":2952,"code":"    it('should authenticate on proxy server(http-proxy-config)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/proxyAuthenticate'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyAuthPort\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        n3.credentials = {\n          username: 'foouser',\n          password: 'barpassword'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200); // msg.payload.should.have.property('user', 'foouser');\n            // msg.payload.should.have.property('pass', 'barpassword');\n\n            msg.payload.should.have.property('headers'); //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should upload a file","suites":["HTTP Request Node","file-upload"],"updatePoint":{"line":3027,"column":28,"index":90228},"line":3027,"code":"    it('should upload a file', function (done) {\n      const flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'POST',\n        ret: 'obj',\n        url: getTestURL('/file-upload'),\n        headers: [{\n          \"keyType\": \"Content-Type\",\n          \"keyValue\": \"\",\n          \"valueType\": \"multipart/form-data\",\n          \"valueValue\": \"\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property(\"body\", {\n              \"other\": \"123\"\n            });\n            msg.payload.should.have.property(\"files\");\n            msg.payload.files.should.have.length(1);\n            msg.payload.files[0].should.have.property('fieldname', 'file');\n            msg.payload.files[0].should.have.property('originalname', 'file.txt');\n            msg.payload.files[0].should.have.property('buffer', {\n              \"type\": \"Buffer\",\n              \"data\": [72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100]\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            file: {\n              value: Buffer.from(\"Hello World\"),\n              options: {\n                filename: \"file.txt\"\n              }\n            },\n            other: 123\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(no cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3081,"column":74,"index":91889},"line":3081,"code":"    it('should send cookies to the same domain when redirected(no cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n            var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n\n            if (cookies1 && Object.keys(cookies1).length != 0) {\n              done(new Error('Invalid cookie(path:/rediectToSame)'));\n              return;\n            }\n\n            if (cookies2 && Object.keys(cookies2).length != 1 || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n              done(new Error('Invalid cookie(path:/rediectReurn)'));\n              return;\n            }\n\n            var redirect1 = msg.redirectList[0];\n            redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n            redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n            redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(no cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3124,"column":83,"index":93487},"line":3124,"code":"    it('should not send cookies to the different domain when redirected(no cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n\n          if (cookies1 && Object.keys(cookies1).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(msg.cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3163,"column":75,"index":94926},"line":3163,"code":"    it('should send cookies to the same domain when redirected(msg.cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToSame)'));\n            return;\n          }\n\n          if (cookies2 && Object.keys(cookies2).length != 2 || cookies1['requestCookie'] !== 'request1' || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n          redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n          done();\n        });\n        n1.receive({\n          cookies: {\n            requestCookie: 'request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(msg.cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3206,"column":84,"index":96586},"line":3206,"code":"    it('should not send cookies to the different domain when redirected(msg.cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToDifferentDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          cookies: {\n            requestCookie: 'request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(msg.headers.cookie)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3249,"column":82,"index":98161},"line":3249,"code":"    it('should send cookies to the same domain when redirected(msg.headers.cookie)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToSame)'));\n            return;\n          }\n\n          if (cookies2 && Object.keys(cookies2).length != 2 || cookies1['requestCookie'] !== 'request1' || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n          redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(msg.headers.cookie)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3292,"column":91,"index":99835},"line":3292,"code":"    it('should not send cookies to the different domain when redirected(msg.headers.cookie)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToDifferentDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return all redirect information when redirected multiple times","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3335,"column":77,"index":101412},"line":3335,"code":"    it('should return all redirect information when redirected multiple times', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectMultipleTimes')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectToDifferentDomain');\n          redirect1.cookies.redirectMultipleTimes.Path.should.equal('/');\n          redirect1.cookies.redirectMultipleTimes.value.should.equal('multiple1');\n          var redirect2 = msg.redirectList[1];\n          redirect2.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect2.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect2.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should accept broken headers","suites":["HTTP Request Node","should parse broken headers"],"updatePoint":{"line":3387,"column":38,"index":103394},"line":3387,"code":"      it('should accept broken headers', function (done) {\n        var flow = [{\n          id: 'n1',\n          type: 'http request',\n          wires: [['n2']],\n          method: 'GET',\n          ret: 'obj',\n          url: `http://localhost:${port}/`,\n          insecureHTTPParser: true\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(httpRequestNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on('input', function (msg) {\n            try {\n              msg.payload.should.equal('HelloWorld');\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: 'foo'\n          });\n        });\n      });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject broken headers","suites":["HTTP Request Node","should parse broken headers"],"updatePoint":{"line":3416,"column":38,"index":104192},"line":3416,"code":"      it('should reject broken headers', function (done) {\n        var flow = [{\n          id: 'n1',\n          type: 'http request',\n          wires: [['n2']],\n          method: 'GET',\n          ret: 'obj',\n          url: `http://localhost:${port}/`\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(httpRequestNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on('input', function (msg) {\n            try {\n              msg.payload.should.equal(`RequestError: Parse Error: Missing expected CR after header value : http://localhost:${port}/`);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: 'foo'\n          });\n        });\n      });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded and have default values (MQTT V4)","suites":["MQTT Nodes"],"updatePoint":{"line":30,"column":56,"index":944},"line":30,"code":"  it('should be loaded and have default values (MQTT V4)', function (done) {\n    this.timeout = 2000;\n    const {\n      flow,\n      nodes\n    } = buildBasicMQTTSendRecvFlow({\n      id: \"mqtt.broker\",\n      name: \"mqtt_broker\",\n      autoConnect: false\n    }, {\n      id: \"mqtt.in\",\n      topic: \"in_topic\"\n    }, {\n      id: \"mqtt.out\",\n      topic: \"out_topic\"\n    });\n    helper.load(mqttNodes, flow, function () {\n      try {\n        const mqttIn = helper.getNode(\"mqtt.in\");\n        const mqttOut = helper.getNode(\"mqtt.out\");\n        const mqttBroker = helper.getNode(\"mqtt.broker\");\n        should(mqttIn).be.type(\"object\", \"mqtt in node should be an object\");\n        mqttIn.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n\n        mqttIn.should.have.property('datatype', 'utf8'); //default: 'utf8'\n\n        mqttIn.should.have.property('isDynamic', false); //default: false\n\n        mqttIn.should.have.property('inputs', 0); //default: 0 \n\n        mqttIn.should.have.property('qos', 2); //default: 2\n\n        mqttIn.should.have.property('topic', \"in_topic\");\n        mqttIn.should.have.property('wires', [[\"helper.node\"]]);\n        should(mqttOut).be.type(\"object\", \"mqtt out node should be an object\");\n        mqttOut.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n\n        mqttOut.should.have.property('topic', \"out_topic\");\n        should(mqttBroker).be.type(\"object\", \"mqtt broker node should be an object\");\n        mqttBroker.should.have.property('broker', BROKER_HOST);\n        mqttBroker.should.have.property('port', BROKER_PORT);\n        mqttBroker.should.have.property('brokerurl'); // mqttBroker.should.have.property('autoUnsubscribe', true);//default: true \n\n        mqttBroker.should.have.property('autoConnect', false); //Set \"autoConnect:false\" in brokerOptions \n\n        mqttBroker.should.have.property('options');\n        mqttBroker.options.should.have.property('clean', true);\n        mqttBroker.options.should.have.property('clientId');\n        mqttBroker.options.clientId.should.containEql('nodered_');\n        mqttBroker.options.should.have.property('keepalive').type(\"number\");\n        mqttBroker.options.should.have.property('reconnectPeriod').type(\"number\"); //as this is not a v5 connection, ensure v5 properties are not present\n\n        mqttBroker.options.should.not.have.property('protocolVersion', 5);\n        mqttBroker.options.should.not.have.property('properties');\n        done();\n      } catch (error) {\n        done(error);\n      }\n    });\n  });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded and have default values (MQTT V5)","suites":["MQTT Nodes"],"updatePoint":{"line":90,"column":56,"index":3521},"line":90,"code":"  it('should be loaded and have default values (MQTT V5)', function (done) {\n    this.timeout = 2000;\n    const {\n      flow,\n      nodes\n    } = buildBasicMQTTSendRecvFlow({\n      id: \"mqtt.broker\",\n      name: \"mqtt_broker\",\n      autoConnect: false,\n      cleansession: false,\n      clientid: 'clientid',\n      keepalive: 35,\n      sessionExpiry: '6000',\n      protocolVersion: '5',\n      userProps: {\n        \"prop\": \"val\"\n      }\n    }, {\n      id: \"mqtt.in\",\n      topic: \"in_topic\"\n    }, {\n      id: \"mqtt.out\",\n      topic: \"out_topic\"\n    });\n    helper.load(mqttNodes, flow, function () {\n      try {\n        const mqttIn = helper.getNode(\"mqtt.in\");\n        const mqttOut = helper.getNode(\"mqtt.out\");\n        const mqttBroker = helper.getNode(\"mqtt.broker\");\n        should(mqttIn).be.type(\"object\", \"mqtt in node should be an object\");\n        mqttIn.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n\n        mqttIn.should.have.property('datatype', 'utf8'); //default: 'utf8'\n\n        mqttIn.should.have.property('isDynamic', false); //default: false\n\n        mqttIn.should.have.property('inputs', 0); //default: 0 \n\n        mqttIn.should.have.property('qos', 2); //default: 2\n\n        mqttIn.should.have.property('topic', \"in_topic\");\n        mqttIn.should.have.property('wires', [[\"helper.node\"]]);\n        should(mqttOut).be.type(\"object\", \"mqtt out node should be an object\");\n        mqttOut.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n\n        mqttOut.should.have.property('topic', \"out_topic\");\n        should(mqttBroker).be.type(\"object\", \"mqtt broker node should be an object\");\n        mqttBroker.should.have.property('broker', BROKER_HOST);\n        mqttBroker.should.have.property('port', BROKER_PORT);\n        mqttBroker.should.have.property('brokerurl'); // mqttBroker.should.have.property('autoUnsubscribe', true);//default: true \n\n        mqttBroker.should.have.property('autoConnect', false); //Set \"autoConnect:false\" in brokerOptions \n\n        mqttBroker.should.have.property('options');\n        mqttBroker.options.should.have.property('clean', false);\n        mqttBroker.options.should.have.property('clientId', 'clientid');\n        mqttBroker.options.should.have.property('keepalive').type(\"number\", 35);\n        mqttBroker.options.should.have.property('reconnectPeriod').type(\"number\"); //as this IS a v5 connection, ensure v5 properties are not present\n\n        mqttBroker.options.should.have.property('protocolVersion', 5);\n        mqttBroker.options.should.have.property('properties');\n        mqttBroker.options.properties.should.have.property('sessionExpiryInterval');\n        done();\n      } catch (error) {\n        done(error);\n      }\n    });\n  });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"skipping MQTT tests. Set env var \"NR_MQTT_TESTS=true\" to enable. Requires a v5 capable broker running on localhost:1883.","suites":["MQTT Nodes"],"updatePoint":{"line":160,"column":128,"index":6396},"line":160,"code":"    it('skipping MQTT tests. Set env var \"NR_MQTT_TESTS=true\" to enable. Requires a v5 capable broker running on localhost:1883.', function (done) {\n      done();\n    });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"should load","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":70,"column":19,"index":1816},"line":70,"code":"    it('should load', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"path\", \"/ws\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should be server","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":81,"column":24,"index":2118},"line":81,"code":"    it('should be server', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('isServer', true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle wholemsg property","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":92,"column":39,"index":2438},"line":92,"code":"    it('should handle wholemsg property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-listener\",\n        path: \"/ws2\",\n        wholemsg: \"true\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"wholemsg\", false);\n        helper.getNode(\"n2\").should.have.property(\"wholemsg\", true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should create socket","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":109,"column":28,"index":2929},"line":109,"code":"    it('should create socket', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should close socket on delete","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":127,"column":37,"index":3377},"line":127,"code":"    it('should close socket on delete', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"close\", function (code, msg) {\n            done();\n          });\n          helper.clearFlows();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive data","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":144,"column":27,"index":3832},"line":144,"code":"    it('should receive data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", \"hello\");\n            done();\n          });\n          sock.send(\"hello\");\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":170,"column":31,"index":4515},"line":170,"code":"    it('should receive wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.send('{\"text\":\"hello\"}');\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"text\", \"hello\");\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not JSON","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":197,"column":50,"index":5251},"line":197,"code":"    it('should receive wholemsg when data not JSON', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.send('hello');\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", \"hello\");\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not object","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":224,"column":52,"index":5981},"line":224,"code":"    it('should receive wholemsg when data not object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", 123);\n            done();\n          });\n          sock.send(123);\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":251,"column":19,"index":6670},"line":251,"code":"    it('should send', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"helper\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n          helper.getNode(\"n2\").send({\n            payload: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":279,"column":28,"index":7376},"line":279,"code":"    it('should send wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n          helper.getNode(\"n3\").send({\n            text: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should do nothing if no payload","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":308,"column":39,"index":8144},"line":308,"code":"    it('should do nothing if no payload', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"helper\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          setTimeout(function () {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            logEvents.should.have.length(0);\n            done();\n          }, 100);\n          helper.getNode(\"n2\").send({\n            topic: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should echo","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":339,"column":19,"index":8962},"line":339,"code":"    it('should echo', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n          sock.send(\"hello\");\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should echo wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":366,"column":28,"index":9645},"line":366,"code":"    it('should echo wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n          sock.send('{\"text\":\"hello\"}');\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should broadcast","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":394,"column":24,"index":10389},"line":394,"code":"    it('should broadcast', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        Promise.all([createClient(\"n1\"), createClient(\"n1\")]).then(function (socks) {\n          var promises = [new Promise((resolve, reject) => {\n            socks[0].on(\"message\", function (msg, flags) {\n              try {\n                msg.should.equal(\"hello\");\n                resolve();\n              } catch (err) {\n                reject(err);\n              }\n            });\n          }), new Promise((resolve, reject) => {\n            socks[1].on(\"message\", function (msg, flags) {\n              try {\n                msg.should.equal(\"hello\");\n                resolve();\n              } catch (err) {\n                reject(err);\n              }\n            });\n          })];\n          helper.getNode(\"n3\").send({\n            payload: \"hello\"\n          });\n          return Promise.all(promises).then(() => {\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should load","suites":["websocket Node","websocket-client"],"updatePoint":{"line":442,"column":19,"index":11738},"line":442,"code":"    it('should load', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('path', getWsUrl(\"/ws\"));\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should not be server","suites":["websocket Node","websocket-client"],"updatePoint":{"line":457,"column":28,"index":12151},"line":457,"code":"    it('should not be server', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('isServer', false);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle wholemsg property","suites":["websocket Node","websocket-client"],"updatePoint":{"line":472,"column":39,"index":12569},"line":472,"code":"    it('should handle wholemsg property', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"wholemsg\", false);\n        helper.getNode(\"n2\").should.have.property(\"wholemsg\", true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle protocol property","suites":["websocket Node","websocket-client"],"updatePoint":{"line":493,"column":39,"index":13175},"line":493,"code":"    it('should handle protocol property', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        subprotocol: \"testprotocol1, testprotocol2\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"subprotocol\", []);\n        helper.getNode(\"n2\").should.have.property(\"subprotocol\", [\"testprotocol1\", \"testprotocol2\"]);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should connect to server","suites":["websocket Node","websocket-client"],"updatePoint":{"line":514,"column":32,"index":13834},"line":514,"code":"    it('should connect to server', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should initiate with subprotocol","suites":["websocket Node","websocket-client"],"updatePoint":{"line":530,"column":40,"index":14260},"line":530,"code":"    it('should initiate with subprotocol', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        subprotocol: \"testprotocol\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.should.have.property(\"protocol\", \"testprotocol\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should close on delete","suites":["websocket Node","websocket-client"],"updatePoint":{"line":548,"column":30,"index":14778},"line":548,"code":"    it('should close on delete', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('close', function () {\n            done();\n          });\n          helper.getNode(\"n2\").close();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive data","suites":["websocket Node","websocket-client"],"updatePoint":{"line":567,"column":27,"index":15288},"line":567,"code":"    it('should receive data', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('hello');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"payload\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg data ","suites":["websocket Node","websocket-client"],"updatePoint":{"line":595,"column":37,"index":16024},"line":595,"code":"    it('should receive wholemsg data ', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('{\"text\":\"hello\"}');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"text\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not JSON","suites":["websocket Node","websocket-client"],"updatePoint":{"line":624,"column":50,"index":16807},"line":624,"code":"    it('should receive wholemsg when data not JSON', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('hello');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"payload\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send","suites":["websocket Node","websocket-client"],"updatePoint":{"line":653,"column":19,"index":17551},"line":653,"code":"    it('should send', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n        });\n        getSocket(\"n1\").on(\"open\", function () {\n          helper.getNode(\"n3\").send({\n            payload: \"hello\"\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send buffer","suites":["websocket Node","websocket-client"],"updatePoint":{"line":685,"column":26,"index":18364},"line":685,"code":"    it('should send buffer', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            Buffer.isBuffer(msg).should.be.true();\n            msg.should.have.length(5);\n            done();\n          });\n        });\n        getSocket(\"n1\").on(\"open\", function () {\n          helper.getNode(\"n3\").send({\n            payload: Buffer.from(\"hello\")\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send wholemsg","suites":["websocket Node","websocket-client"],"updatePoint":{"line":718,"column":28,"index":19243},"line":718,"code":"    it('should send wholemsg', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n        });\n        getSocket(\"n1\").on('open', function () {\n          helper.getNode(\"n3\").send({\n            text: \"hello\"\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should NOT feedback more than once","suites":["websocket Node","websocket-client"],"updatePoint":{"line":751,"column":42,"index":20123},"line":751,"code":"    it('should NOT feedback more than once', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"client\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n1\",\n        type: \"websocket in\",\n        client: \"client\",\n        wires: [[\"n2\", \"output\"]]\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"server\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"output\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('client').on('open', function () {\n          helper.getNode(\"n3\").send({\n            payload: \"ping\"\n          });\n        });\n        var acc = 0;\n        helper.getNode(\"output\").on(\"input\", function (msg) {\n          acc = acc + 1;\n        });\n        setTimeout(function () {\n          acc.should.equal(1);\n          helper.clearFlows();\n          done();\n        }, 250);\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should report error if no server config","suites":["websocket Node","websocket in node"],"updatePoint":{"line":798,"column":47,"index":21303},"line":798,"code":"    it('should report error if no server config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket in\",\n        mode: \"server\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"websocket in\";\n        });\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"websocket.errors.missing-conf\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should report error if no server config","suites":["websocket Node","websocket out node"],"updatePoint":{"line":816,"column":47,"index":21924},"line":816,"code":"    it('should report error if no server config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket out\",\n        mode: \"server\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"websocket out\";\n        }); //console.log(logEvents);\n\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"websocket.errors.missing-conf\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":116,"column":38,"index":2805},"line":116,"code":"  it('should recv data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":135,"column":52,"index":3244},"line":135,"code":"  it('should recv data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:o\\n)","suites":["TCP in Node"],"updatePoint":{"line":154,"column":53,"index":3688},"line":154,"code":"  it('should recv data (Stream/String/Delimiter:o\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"o\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"fo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:o\\n) and reattach o","suites":["TCP in Node"],"updatePoint":{"line":173,"column":68,"index":4147},"line":173,"code":"  it('should recv data (Stream/String/Delimiter:o\\\\n) and reattach o', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"o\\n\",\n      trim: true,\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\\n\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":193,"column":51,"index":4610},"line":193,"code":"  it('should recv data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\\nbar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":212,"column":38,"index":5035},"line":212,"code":"  it('should recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Single/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":231,"column":38,"index":5479},"line":231,"code":"  it('should recv data (Single/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Single/String)","suites":["TCP in Node"],"updatePoint":{"line":250,"column":38,"index":5904},"line":250,"code":"  it('should recv data (Single/String)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\\nbaz\"], [\"foo\\nbar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":269,"column":38,"index":6341},"line":269,"code":"  it('should recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":288,"column":47,"index":6794},"line":288,"code":"  it('should recv multiple data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\"], [Buffer(\"foo\"), Buffer(\"bar\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":307,"column":61,"index":7264},"line":307,"code":"  it('should recv multiple data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\\nbaz\"], [\"foo\", \"bar\", \"baz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":326,"column":60,"index":7729},"line":326,"code":"  it('should recv multiple data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\\nbaz\"], [\"foo\", \"bar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":345,"column":47,"index":8177},"line":345,"code":"  it('should recv multiple data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var wdata = [\"foo\", \"bar\"];\n    var rdata = wdata.map(function (x) {\n      return Buffer(x).toString('base64');\n    });\n    testTCP0(flow, wdata, rdata, done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":368,"column":48,"index":8724},"line":368,"code":"  it('should connect & recv data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":387,"column":62,"index":9180},"line":387,"code":"  it('should connect & recv data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\"], [\"foo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":406,"column":61,"index":9639},"line":406,"code":"  it('should connect & recv data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\"], [\"foo\\nbar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":425,"column":48,"index":10081},"line":425,"code":"  it('should connect & recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Single/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":444,"column":48,"index":10542},"line":444,"code":"  it('should connect & recv data (Single/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Single/String)","suites":["TCP in Node"],"updatePoint":{"line":463,"column":48,"index":10984},"line":463,"code":"  it('should connect & recv data (Single/String)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\\nbaz\"], [\"foo\\nbar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":482,"column":48,"index":11438},"line":482,"code":"  it('should connect & recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data","suites":["TCP Request Node","single message"],"updatePoint":{"line":125,"column":31,"index":3462},"line":125,"code":"    it('should send & recv data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should retain complete message","suites":["TCP Request Node","single message"],"updatePoint":{"line":146,"column":38,"index":3916},"line":146,"code":"    it('should retain complete message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data when specified character received","suites":["TCP Request Node","single message"],"updatePoint":{"line":167,"column":65,"index":4397},"line":167,"code":"    it('should send & recv data when specified character received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"char\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo0bar0',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo0',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data after fixed number of chars received","suites":["TCP Request Node","single message"],"updatePoint":{"line":188,"column":68,"index":4887},"line":188,"code":"    it('should send & recv data after fixed number of chars received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"count\",\n        splitc: \"7\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo bar',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection","suites":["TCP Request Node","single message"],"updatePoint":{"line":209,"column":51,"index":5359},"line":209,"code":"    it('should send & receive, then keep connection', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data to/from server:port from msg","suites":["TCP Request Node","single message"],"updatePoint":{"line":230,"column":60,"index":5834},"line":230,"code":"    it('should send & recv data to/from server:port from msg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"\",\n        port: \"\",\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: \"foo\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"ACK:foo\",\n        host: 'localhost',\n        port: port\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data","suites":["TCP Request Node","many messages"],"updatePoint":{"line":255,"column":31,"index":6368},"line":255,"code":"    it('should send & recv data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: 'f',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'bar'\n      }], {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data when specified character received","suites":["TCP Request Node","many messages"],"updatePoint":{"line":282,"column":65,"index":6961},"line":282,"code":"    it('should send & recv data when specified character received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"char\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo0\",\n        topic: 'bar'\n      }, {\n        payload: \"bar0\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foo0\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data after fixed number of chars received","suites":["TCP Request Node","many messages"],"updatePoint":{"line":306,"column":68,"index":7510},"line":306,"code":"    it('should send & recv data after fixed number of chars received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"count\",\n        splitc: \"7\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"fo\",\n        topic: 'bar'\n      }, {\n        payload: \"ob\",\n        topic: 'bar'\n      }, {\n        payload: \"ar\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foo\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection","suites":["TCP Request Node","many messages"],"updatePoint":{"line":333,"column":51,"index":8093},"line":333,"code":"    it('should send & receive, then keep connection', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'bar'\n      }, {\n        payload: \"bar\",\n        topic: 'bar'\n      }, {\n        payload: \"baz\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foobarbaz\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and not split return strings","suites":["TCP Request Node","many messages"],"updatePoint":{"line":360,"column":81,"index":8713},"line":360,"code":"    it('should send & receive, then keep connection, and not split return strings', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar<A>\\nfoo\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and split return strings","suites":["TCP Request Node","many messages"],"updatePoint":{"line":385,"column":77,"index":9309},"line":385,"code":"    it('should send & receive, then keep connection, and split return strings', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"<A>\\\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and split return strings and reattach delimiter","suites":["TCP Request Node","many messages"],"updatePoint":{"line":410,"column":100,"index":9926},"line":410,"code":"    it('should send & receive, then keep connection, and split return strings and reattach delimiter', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"<A>\\\\n\",\n        trim: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar<A>\\n\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data to/from server:port from msg","suites":["TCP Request Node","many messages"],"updatePoint":{"line":436,"column":60,"index":10528},"line":436,"code":"    it('should send & recv data to/from server:port from msg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"\",\n        port: \"\",\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"f\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"o\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"o\",\n        host: \"localhost\",\n        port: port\n      }], {\n        payload: \"ACK:foo\",\n        host: 'localhost',\n        port: port\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should limit the queue size","suites":["TCP Request Node","many messages"],"updatePoint":{"line":467,"column":35,"index":11180},"line":467,"code":"    it('should limit the queue size', function (done) {\n      RED.settings.tcpMsgQueueSize = 10;\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }]; // create one more msg than is allowed\n\n      const msgs = new Array(RED.settings.tcpMsgQueueSize + 1).fill('x');\n      const expected = msgs.slice(0, -1);\n      testTCPMany(flow, msgs, \"ACK:\" + expected.join(''), done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should only retain the latest message","suites":["TCP Request Node","many messages"],"updatePoint":{"line":486,"column":45,"index":11759},"line":486,"code":"    it('should only retain the latest message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: 'f',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'baz'\n      }, {\n        payload: 'o',\n        topic: 'quux'\n      }], {\n        payload: 'ACK:foo',\n        topic: 'quux'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (Buffer)","suites":["UDP in Node"],"updatePoint":{"line":76,"column":36,"index":2090},"line":76,"code":"  it('should recv IPv4 data (Buffer)', function (done) {\n    checkRecv('buffer', 'udp4', 'hello', Buffer('hello'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (String)","suites":["UDP in Node"],"updatePoint":{"line":79,"column":36,"index":2218},"line":79,"code":"  it('should recv IPv4 data (String)', function (done) {\n    checkRecv('utf8', 'udp4', 'hello', 'hello', done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (base64)","suites":["UDP in Node"],"updatePoint":{"line":82,"column":36,"index":2336},"line":82,"code":"  it('should recv IPv4 data (base64)', function (done) {\n    checkRecv('base64', 'udp4', 'hello', Buffer('hello').toString('base64'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (Buffer)","suites":["UDP in Node"],"updatePoint":{"line":85,"column":36,"index":2483},"line":85,"code":"  it('should recv IPv6 data (Buffer)', function (done) {\n    checkRecv('buffer', 'udp6', 'hello', Buffer('hello'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (String)","suites":["UDP in Node"],"updatePoint":{"line":88,"column":36,"index":2611},"line":88,"code":"  it('should recv IPv6 data (String)', function (done) {\n    checkRecv('utf8', 'udp6', 'hello', 'hello', done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (base64)","suites":["UDP in Node"],"updatePoint":{"line":91,"column":36,"index":2729},"line":91,"code":"  it('should recv IPv6 data (base64)', function (done) {\n    checkRecv('base64', 'udp6', 'hello', Buffer('hello').toString('base64'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data","suites":["UDP out Node"],"updatePoint":{"line":83,"column":27,"index":2188},"line":83,"code":"  it('should send IPv4 data', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), false, false, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data (base64)","suites":["UDP out Node"],"updatePoint":{"line":86,"column":36,"index":2325},"line":86,"code":"  it('should send IPv4 data (base64)', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), true, false, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data with dest from msg","suites":["UDP out Node"],"updatePoint":{"line":89,"column":46,"index":2471},"line":89,"code":"  it('should send IPv4 data with dest from msg', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), false, true, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with defaults","suites":["CSV node"],"updatePoint":{"line":34,"column":36,"index":1132},"line":34,"code":"  it('should be loaded with defaults', function (done) {\n    var flow = [{\n      id: \"csvNode1\",\n      type: \"csv\",\n      name: \"csvNode\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"csvNode1\");\n      n1.should.have.property('name', 'csvNode');\n      n1.should.have.property('template', '');\n      n1.should.have.property('sep', ',');\n      n1.should.have.property('quo', '\"');\n      n1.should.have.property('ret', '\\n');\n      n1.should.have.property('winflag', false);\n      n1.should.have.property('lineend', '\\n');\n      n1.should.have.property('multi', 'one');\n      n1.should.have.property('hdrin', false);\n      done();\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple csv string to a javascript object","suites":["CSV node","csv to json"],"updatePoint":{"line":73,"column":65,"index":2328},"line":73,"code":"    it('should convert a simple csv string to a javascript object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          msg.should.have.property('columns', \"a,b,c,d\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with | separator (no template)","suites":["CSV node","csv to json"],"updatePoint":{"line":103,"column":92,"index":3180},"line":103,"code":"    it('should convert a simple string to a javascript object with | separator (no template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \"|\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            col1: 1,\n            col2: 2,\n            col3: 3,\n            col4: 4\n          });\n          msg.should.have.property('columns', \"col1,col2,col3,col4\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1|2|3|4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with tab separator (with template)","suites":["CSV node","csv to json"],"updatePoint":{"line":133,"column":96,"index":4053},"line":133,"code":"    it('should convert a simple string to a javascript object with tab separator (with template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \"\\t\",\n        temp: \"A,B,,D\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            A: 1,\n            B: 2,\n            D: 4\n          });\n          msg.should.have.property('columns', \"A,B,D\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1\\t2\\t3\\t4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with space separator (with spaced template)","suites":["CSV node","csv to json"],"updatePoint":{"line":163,"column":105,"index":4919},"line":163,"code":"    it('should convert a simple string to a javascript object with space separator (with spaced template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \" \",\n        temp: \"A, B, , D\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            A: 1,\n            B: 2,\n            D: 4\n          });\n          msg.should.have.property('columns', \"A,B,D\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1 2 3 4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should remove quotes and whitespace from template","suites":["CSV node","csv to json"],"updatePoint":{"line":193,"column":57,"index":5736},"line":193,"code":"    it('should remove quotes and whitespace from template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: '\"a\",  \"b\" , \" c \",\" d  \" ',\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should create column names if no template provided","suites":["CSV node","csv to json"],"updatePoint":{"line":222,"column":58,"index":6514},"line":222,"code":"    it('should create column names if no template provided', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: '',\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            col1: 1,\n            col2: 2,\n            col3: 3,\n            col4: 4\n          });\n          msg.should.have.property('columns', \"col1,col2,col3,col4\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow dropping of fields from the template","suites":["CSV node","csv to json"],"updatePoint":{"line":252,"column":57,"index":7348},"line":252,"code":"    it('should allow dropping of fields from the template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,,,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            d: 4\n          });\n          msg.should.have.property('columns', 'a,d');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow commas and spaces in the template","suites":["CSV node","csv to json"],"updatePoint":{"line":280,"column":54,"index":8120},"line":280,"code":"    it('should allow commas and spaces in the template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b b,\\\"c,c\\\",\\\" d, d \\\"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c,c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,\"c,c\",\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV","suites":["CSV node","csv to json"],"updatePoint":{"line":310,"column":63,"index":8984},"line":310,"code":"    it('should allow passing in a template as first line of CSV', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c,c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,\"c,c\",\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a,b b,\"c,c\",\" d, d \"' + \"\\n\" + \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (not comma)","suites":["CSV node","csv to json"],"updatePoint":{"line":341,"column":75,"index":9889},"line":341,"code":"    it('should allow passing in a template as first line of CSV (not comma)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \";\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c;c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c;c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a;b b;\"c;c\";\" d, d \"' + \"\\n\" + \"1;2;3;4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (special char /)","suites":["CSV node","csv to json"],"updatePoint":{"line":373,"column":80,"index":10815},"line":373,"code":"    it('should allow passing in a template as first line of CSV (special char /)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \"/\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c/c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c/c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a/b b/\"c/c\"/\" d, d \"' + \"\\n\" + \"1/2/3/4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (special char \\)","suites":["CSV node","csv to json"],"updatePoint":{"line":405,"column":81,"index":11742},"line":405,"code":"    it('should allow passing in a template as first line of CSV (special char \\\\)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \"\\\\\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c\\\\c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c\\\\c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a\\\\b b\\\\\"c\\\\c\"\\\\\" d, d \"' + \"\\n\" + \"1\\\\2\\\\3\\\\4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should leave numbers starting with 0, e and + as strings (except 0.)","suites":["CSV node","csv to json"],"updatePoint":{"line":437,"column":76,"index":12674},"line":437,"code":"    it('should leave numbers starting with 0, e and + as strings (except 0.)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 123,\n            b: \"0123\",\n            c: '+123',\n            d: 'e123',\n            e: 'E123',\n            f: -123\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '123,0123,+123,e123,E123,-123' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should not parse numbers when told not to do so","suites":["CSV node","csv to json"],"updatePoint":{"line":468,"column":55,"index":13519},"line":468,"code":"    it('should not parse numbers when told not to do so', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        strings: false,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: \"1.23\",\n            b: \"0123\",\n            c: \"+123\",\n            d: \"e123\",\n            e: \"0\",\n            f: \"-123\",\n            g: \"1e3\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '1.23,0123,+123,e123,0,-123,1e3' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should parse numbers when told to do so","suites":["CSV node","csv to json"],"updatePoint":{"line":501,"column":47,"index":14406},"line":501,"code":"    it('should parse numbers when told to do so', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1.23,\n            b: -123,\n            c: 1000,\n            d: 0\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = ' 1.23 ,  -123,1e3 ,    0  ' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should leave handle strings with scientific notation as numbers","suites":["CSV node","csv to json"],"updatePoint":{"line":530,"column":71,"index":15213},"line":530,"code":"    it('should leave handle strings with scientific notation as numbers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 12000,\n            b: 0.012,\n            c: -12000,\n            d: -0.012\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '12E3,12e-3,-12e3,-12E-3' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow quotes in the input (but drop blank strings)","suites":["CSV node","csv to json"],"updatePoint":{"line":559,"column":65,"index":16020},"line":559,"code":"    it('should allow quotes in the input (but drop blank strings)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g,h\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: -2,\n            c: '+3',\n            d: '04',\n            f: '-05',\n            g: 'ab\"cd',\n            h: 'with,a,comma'\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"1\",\"-2\",\"+3\",\"04\",\"\",\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow blank strings in the input if selected","suites":["CSV node","csv to json"],"updatePoint":{"line":592,"column":59,"index":16947},"line":592,"code":"    it('should allow blank strings in the input if selected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        include_empty_strings: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: '',\n            c: '',\n            d: '',\n            e: '-05',\n            f: 'ab\"cd',\n            g: 'with,a,comma'\n          }); //check_parts(msg, 0, 1);\n\n          done();\n        });\n        var testString = '\"1\",\"\",\"\",\"\",\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow missing columns (nulls) in the input if selected","suites":["CSV node","csv to json"],"updatePoint":{"line":626,"column":69,"index":17899},"line":626,"code":"    it('should allow missing columns (nulls) in the input if selected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        include_null_values: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: null,\n            c: '+3',\n            d: null,\n            e: '-05',\n            f: 'ab\"cd',\n            g: 'with,a,comma'\n          }); //check_parts(msg, 0, 1);\n\n          done();\n        });\n        var testString = '\"1\",,\"+3\",,\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle cr and lf in the input","suites":["CSV node","csv to json"],"updatePoint":{"line":660,"column":44,"index":18828},"line":660,"code":"    it('should handle cr and lf in the input', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: \"with a\\nnew line\",\n            b: \"and a\\rcarriage return\",\n            c: \"and why\\r\\nnot both\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"with a' + String.fromCharCode(10) + 'new line\",\"and a' + String.fromCharCode(13) + 'carriage return\",\"and why\\r\\nnot both\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should recover from an odd number of quotes in the input","suites":["CSV node","csv to json"],"updatePoint":{"line":689,"column":64,"index":19788},"line":689,"code":"    it('should recover from an odd number of quotes in the input', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c == 0) {\n            c = 1;\n            msg.should.have.property('payload', {\n              a: \"with,an\",\n              b: \"odd,number\",\n              c: \"ofquotes\\n\"\n            });\n            check_parts(msg, 0, 1);\n          } else {\n            msg.should.have.property('payload', {\n              a: \"this is\",\n              b: \"a normal\",\n              c: \"line\"\n            });\n            check_parts(msg, 0, 1);\n            done();\n          }\n        });\n        var testString = '\"with,a\"n,odd\",\"num\"ber\",\"of\"qu\"ot\"es\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n        n1.emit(\"input\", {\n          payload: '\"this is\",\"a normal\",\"line\"'\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should recover from an odd number of quotes in the input (2)","suites":["CSV node","csv to json"],"updatePoint":{"line":731,"column":68,"index":20985},"line":731,"code":"    it('should recover from an odd number of quotes in the input (2)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          //console.log(msg)\n          if (c == 0) {\n            c = 1;\n            msg.should.have.property('payload', {\n              a: \"with,an\",\n              b: \"odd,number\",\n              c: \"ofquotes\\nthis is,a normal,line\"\n            });\n            check_parts(msg, 0, 1);\n          } else {\n            msg.should.have.property('payload', {\n              a: \"this is\",\n              b: \"another\",\n              c: \"line\"\n            });\n            check_parts(msg, 0, 1);\n            done();\n          }\n        });\n        var testString = '\"with,a\"n,odd\",\"num\"ber\",\"of\"qu\"ot\"es\"' + String.fromCharCode(10) + '\"this is\",\"a normal\",\"line\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n        n1.emit(\"input\", {\n          payload: '\"this is\",\"another\",\"line\"'\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use the first line as a template","suites":["CSV node","csv to json"],"updatePoint":{"line":774,"column":58,"index":22278},"line":774,"code":"    it('should be able to use the first line as a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString = \"w,x,y,z\\n1,2,3,4\\n\\n5,6,7,8\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to output multiple lines as one array","suites":["CSV node","csv to json"],"updatePoint":{"line":817,"column":60,"index":23377},"line":817,"code":"    it('should be able to output multiple lines as one array', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        multi: \"yes\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          }, {\n            a: 5,\n            b: -6,\n            c: '07',\n            d: '+8'\n          }, {\n            a: 9,\n            b: 0,\n            c: 'a',\n            d: 'b'\n          }, {\n            a: 'c',\n            b: 'd',\n            c: 'e',\n            d: 'f'\n          }]);\n          msg.should.have.property('columns', 'a,b,c,d');\n          msg.should.not.have.property('parts');\n          done();\n        });\n        var testString = \"1,2,3,4\\n5,-6,07,+8\\n9,0,a,b\\nc,d,e,f\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to create an array from multiple parts","suites":["CSV node","csv to json"],"updatePoint":{"line":863,"column":61,"index":24518},"line":863,"code":"    it('should be able to create an array from multiple parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        multi: \"mult\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            \"a\": 1,\n            \"b\": 2,\n            \"c\": 3\n          }, {\n            \"a\": 4,\n            \"b\": 5,\n            \"c\": 6\n          }, {\n            \"a\": 7,\n            \"b\": 8,\n            \"c\": 9\n          }]);\n          msg.should.have.property('columns', 'a,b,c');\n          msg.should.not.have.property('parts');\n          done();\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"a,b,c\",\n          \"parts\": {\n            \"index\": 0,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"1,2,3\",\n          \"parts\": {\n            \"index\": 1,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"4,5,6\",\n          \"parts\": {\n            \"index\": 2,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"7,8,9\",\n          \"parts\": {\n            \"index\": 3,\n            count: 4,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to output multiple objects as an array from an input of parts","suites":["CSV node","csv to json"],"updatePoint":{"line":935,"column":84,"index":26249},"line":935,"code":"    it('should be able to output multiple objects as an array from an input of parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        multi: \"yes\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            \"Col1\": \"V1\",\n            \"Col2\": \"V2\"\n          }, {\n            \"Col1\": \"V3\",\n            \"Col2\": \"V4\"\n          }, {\n            \"Col1\": \"V5\",\n            \"Col2\": \"V6\"\n          }]);\n          msg.should.have.property('columns', 'Col1,Col2');\n          msg.should.have.property('parts');\n          done();\n        }); //var testString = \"1,2,3,4\\n5,-6,07,+8\\n9,0,a,b\\nc,d,e,f\";\n        // n1.emit(\"input\", {payload:testString});\n\n        n1.emit(\"input\", {\n          \"payload\": \"Col1,Col2\\nV1,V2\\nV3,V4\\nV5,V6\",\n          \"topic\": \"\",\n          \"parts\": {\n            \"id\": \"3af07e18.865652\",\n            \"type\": \"array\",\n            \"count\": 2,\n            \"len\": 1,\n            \"index\": 0\n          }\n        }); //n1.emit(\"input\", {\"payload\":\"Var1,Var2\\nW1,W2\\nW3,W4\\nW5,W6\",\"topic\":\"\",\"parts\":{\"id\":\"3af07e18.865652\",\"type\":\"array\",\"count\":2,\"len\":1,\"index\":1}});\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle numbers in strings but not IP addresses","suites":["CSV node","csv to json"],"updatePoint":{"line":980,"column":61,"index":27652},"line":980,"code":"    it('should handle numbers in strings but not IP addresses', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: \"a\",\n            b: \"127.0.0.1\",\n            c: 56.7,\n            d: -32.8,\n            e: \"+76.22C\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"a,127.0.0.1,56.7,-32.8,+76.22C\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should preserve parts property","suites":["CSV node","csv to json"],"updatePoint":{"line":1010,"column":38,"index":28436},"line":1010,"code":"    it('should preserve parts property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          check_parts(msg, 3, 4);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString,\n          parts: {\n            id: \"X\",\n            index: 3,\n            count: 4\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use the first of multiple parts as a template if parts are present","suites":["CSV node","csv to json"],"updatePoint":{"line":1044,"column":92,"index":29326},"line":1044,"code":"    it('should be able to use the first of multiple parts as a template if parts are present', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString1 = \"w,x,y,z\\n\";\n        var testString2 = \"1,2,3,4\\n\";\n        var testString3 = \"5,6,7,8\\n\";\n        n1.emit(\"input\", {\n          payload: testString1,\n          parts: {\n            id: \"X\",\n            index: 0,\n            count: 3\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString2,\n          parts: {\n            id: \"X\",\n            index: 1,\n            count: 3\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString3,\n          parts: {\n            id: \"X\",\n            index: 2,\n            count: 3\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start if requested","suites":["CSV node","csv to json"],"updatePoint":{"line":1109,"column":57,"index":30875},"line":1109,"code":"    it('should skip several lines from start if requested', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 9,\n            b: 0,\n            c: \"A\",\n            d: \"B\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start then use next line as a template","suites":["CSV node","csv to json"],"updatePoint":{"line":1139,"column":77,"index":31751},"line":1139,"code":"    it('should skip several lines from start then use next line as a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrin: true,\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            \"9\": \"C\",\n            \"0\": \"D\",\n            \"A\": \"E\",\n            \"B\": \"F\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10) + \"C,D,E,F\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start and correct parts","suites":["CSV node","csv to json"],"updatePoint":{"line":1170,"column":62,"index":32683},"line":1170,"code":"    it('should skip several lines from start and correct parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              a: 9,\n              b: 0,\n              c: \"A\",\n              d: \"B\"\n            });\n            check_parts(msg, 0, 2);\n            c = c + 1;\n          } else {\n            msg.should.have.property('payload', {\n              a: \"C\",\n              b: \"D\",\n              c: \"E\",\n              d: \"F\"\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10) + \"C,D,E,F\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to skip and then use the first of multiple parts as a template if parts are present","suites":["CSV node","csv to json"],"updatePoint":{"line":1212,"column":106,"index":33929},"line":1212,"code":"    it('should be able to skip and then use the first of multiple parts as a template if parts are present', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            msg.should.have.property('columns', 'w,x,y,z');\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            msg.should.have.property('columns', 'w,x,y,z');\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testStringA = \"foo\\n\";\n        var testStringB = \"bar\\n\";\n        var testString1 = \"w,x,y,z\\n\";\n        var testString2 = \"1,2,3,4\\n\";\n        var testString3 = \"5,6,7,8\\n\";\n        n1.emit(\"input\", {\n          payload: testStringA,\n          parts: {\n            id: \"X\",\n            index: 0,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testStringB,\n          parts: {\n            id: \"X\",\n            index: 1,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString1,\n          parts: {\n            id: \"X\",\n            index: 2,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString2,\n          parts: {\n            id: \"X\",\n            index: 3,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString3,\n          parts: {\n            id: \"X\",\n            index: 4,\n            count: 5\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1300,"column":52,"index":36065},"line":1300,"code":"    it('should convert a simple object back to a csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,,e,f,g,h,i,j,k\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // console.log(\"GOT\",msg)\n          try {\n            msg.should.have.property('payload', '4,foo,true,,0,\"Hello\\nWorld\",,,undefined,null,null\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          e: 0,\n          d: 1,\n          b: \"foo\",\n          c: true,\n          a: 4,\n          f: \"Hello\\nWorld\",\n          h: undefined,\n          i: \"undefined\",\n          j: null,\n          k: \"null\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a csv with no template","suites":["CSV node","json object to csv"],"updatePoint":{"line":1339,"column":69,"index":37075},"line":1339,"code":"    it('should convert a simple object back to a csv with no template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \" \",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // console.log(\"GOT\",msg)\n          try {\n            msg.should.have.property('payload', '1,foo,\"ba\"\"r\",\"di,ng\",,undefined,null\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: \"foo\",\n          c: \"ba\\\"r\",\n          a: \"di,ng\",\n          e: undefined,\n          f: \"undefined\",\n          g: null,\n          h: \"null\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a tsv using a tab as a separator","suites":["CSV node","json object to csv"],"updatePoint":{"line":1376,"column":79,"index":38027},"line":1376,"code":"    it('should convert a simple object back to a tsv using a tab as a separator', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        sep: \"\\t\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '1\\tfoo\\t\"ba\"\"r\"\\tdi,ng\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: \"foo\",\n          c: \"ba\\\"r\",\n          a: \"di,ng\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle a template with spaces in the property names","suites":["CSV node","json object to csv"],"updatePoint":{"line":1409,"column":66,"index":38843},"line":1409,"code":"    it('should handle a template with spaces in the property names', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b o,c p,,e\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '4,foo,true,,0\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          e: 0,\n          d: 1,\n          \"b o\": \"foo\",\n          \"c p\": true,\n          a: 4\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1442,"column":62,"index":39654},"line":1442,"code":"    it('should convert an array of objects to a multi-line csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,d,c,b\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '4,1,2,3\\n1,4,3,2\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv and add a header","suites":["CSV node","json object to csv"],"updatePoint":{"line":1479,"column":79,"index":40527},"line":1479,"code":"    it('should convert an array of objects to a multi-line csv and add a header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrout: \"all\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,b,c,d\\n4,3,2,1\\n1,2,3,\"a\\nb\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: \"a\\nb\",\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv without a template","suites":["CSV node","json object to csv"],"updatePoint":{"line":1517,"column":81,"index":41444},"line":1517,"code":"    it('should convert an array of objects to a multi-line csv without a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '1,3,2,4\\n4,2,3,1\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv without a template and with a header","suites":["CSV node","json object to csv"],"updatePoint":{"line":1554,"column":99,"index":42330},"line":1554,"code":"    it('should convert an array of objects to a multi-line csv without a template and with a header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrout: \"all\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'd,b,c,a\\n1,3,2,4\\n4,\"f\\ng\",3,1\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: \"f\\ng\"\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple array back to a csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1592,"column":51,"index":43210},"line":1592,"code":"    it('should convert a simple array back to a csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', ',0,1,foo,\"ba\"\"r\",\"di,ng\",\"fa\\nba\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [\"\", 0, 1, \"foo\", 'ba\"r', 'di,ng', \"fa\\nba\"];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of arrays back to a multi-line csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1619,"column":66,"index":43979},"line":1619,"code":"    it('should convert an array of arrays back to a multi-line csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '0,1,2,3,4\\n4,3,2,1,0\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [[0, 1, 2, 3, 4], [4, 3, 2, 1, 0]];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to include column names as first row","suites":["CSV node","json object to csv"],"updatePoint":{"line":1646,"column":59,"index":44718},"line":1646,"code":"    it('should be able to include column names as first row', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrout: true,\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,b,c,d\\r\\n4,3,2,1\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to include column names as first row, and missing properties","suites":["CSV node","json object to csv"],"updatePoint":{"line":1680,"column":83,"index":45566},"line":1680,"code":"    it('should be able to include column names as first row, and missing properties', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        hdrout: true,\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'col1,col2,col3,col4\\r\\nH1,H2,H3,H4\\r\\nA,B,,\\r\\nA,,C,\\r\\nA,,,\"D\\nE\"\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          \"col1\": \"H1\",\n          \"col2\": \"H2\",\n          \"col3\": \"H3\",\n          \"col4\": \"H4\"\n        }, {\n          \"col1\": \"A\",\n          \"col2\": \"B\"\n        }, {\n          \"col1\": \"A\",\n          \"col3\": \"C\"\n        }, {\n          \"col1\": \"A\",\n          \"col4\": \"D\\nE\"\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to pass in column names","suites":["CSV node","json object to csv"],"updatePoint":{"line":1722,"column":46,"index":46609},"line":1722,"code":"    it('should be able to pass in column names', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrout: \"once\",\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          count += 1;\n\n          try {\n            if (count === 1) {\n              msg.should.have.property('payload', 'a,,b,a\\r\\n4,,3,4\\r\\n');\n            }\n\n            if (count === 3) {\n              msg.should.have.property('payload', '4,,3,4\\r\\n');\n              done();\n            }\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }];\n        n1.emit(\"input\", {\n          payload: testJson,\n          columns: \"a,,b,a\",\n          parts: {\n            index: 0\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testJson,\n          parts: {\n            index: 1\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testJson,\n          parts: {\n            index: 2\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to pass in column names - with payload as an array","suites":["CSV node","json object to csv"],"updatePoint":{"line":1781,"column":73,"index":47968},"line":1781,"code":"    it('should be able to pass in column names - with payload as an array', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        hdrout: \"once\",\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,,b,a\\r\\n4,,3,4\\r\\n4,,3,4\\r\\n4,,3,4\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        };\n        n1.emit(\"input\", {\n          payload: [testJson, testJson, testJson],\n          columns: \"a,,b,a\"\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle quotes and sub-properties","suites":["CSV node","json object to csv"],"updatePoint":{"line":1815,"column":47,"index":48824},"line":1815,"code":"    it('should handle quotes and sub-properties', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '{},\"text,with,commas\",\"This \"\"is\"\" a banana\",\"{\"\"sub\"\":\"\"object\"\"}\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: {\n            sub: \"object\"\n          },\n          b: \"text,with,commas\",\n          c: 'This \"is\" a banana',\n          a: {\n            sub2: undefined\n          }\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should just pass through if no payload provided","suites":["CSV node","json object to csv"],"updatePoint":{"line":1852,"column":53,"index":49764},"line":1852,"code":"  it('should just pass through if no payload provided', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', {\n            a: 4,\n            b: 3,\n            c: 2,\n            d: 1\n          });\n          msg.should.not.have.property('payload');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      var testJson = {\n        d: 1,\n        b: 3,\n        c: 2,\n        a: 4\n      };\n      n1.emit(\"input\", {\n        topic: testJson\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should warn if provided a number or boolean","suites":["CSV node","json object to csv"],"updatePoint":{"line":1890,"column":49,"index":50578},"line":1890,"code":"  it('should warn if provided a number or boolean', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"csv\";\n          });\n          logEvents.should.have.length(2);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.startWith('csv.errors.csv_js');\n          logEvents[1][0].should.have.a.property('msg');\n          logEvents[1][0].msg.toString().should.startWith('csv.errors.csv_js');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 150);\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should call done when message processing is completed","suites":["CSV node","json object to csv"],"updatePoint":{"line":1926,"column":59,"index":51627},"line":1926,"code":"  it('should call done when message processing is completed', function (done) {\n    const completeNode = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/24-complete.js\");\n\n    const flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[]]\n    }, {\n      id: \"c1\",\n      type: \"complete\",\n      scope: [\"n1\"],\n      uncaught: false,\n      wires: [[\"h1\"]]\n    }, {\n      id: \"h1\",\n      type: \"helper\",\n      wires: [[]]\n    }];\n    helper.load([csvNode, completeNode], flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const h1 = helper.getNode(\"h1\");\n      h1.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property('payload', \"1,2,3,4\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"1,2,3,4\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should call done when input causes an error","suites":["CSV node","json object to csv"],"updatePoint":{"line":1961,"column":49,"index":52487},"line":1961,"code":"  it('should call done when input causes an error', function (done) {\n    const completeNode = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/24-complete.js\");\n\n    const flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[]]\n    }, {\n      id: \"c1\",\n      type: \"complete\",\n      scope: [\"n1\"],\n      uncaught: false,\n      wires: [[\"h1\"]]\n    }, {\n      id: \"h1\",\n      type: \"helper\",\n      wires: [[]]\n    }];\n    helper.load([csvNode, completeNode], flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const h1 = helper.getNode(\"h1\");\n      h1.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property('payload', 1);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      }); // neither object nor string\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["HTML node"],"updatePoint":{"line":41,"column":22,"index":1370},"line":41,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"htmlNode1\",\n      type: \"html\",\n      name: \"htmlNode\"\n    }];\n    helper.load(htmlNode, flow, function () {\n      var htmlNode1 = helper.getNode(\"htmlNode1\");\n      htmlNode1.should.have.property('name', 'htmlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select","suites":["HTML node"],"updatePoint":{"line":53,"column":63,"index":1729},"line":53,"code":"  it('should retrieve header contents if asked to by msg.select', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, 'This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }); // include 'body' in the select to verify we're in document mode\n        // for the parser. See https://github.com/node-red/node-red/issues/3079\n\n        n1.receive({\n          payload: data,\n          topic: \"bar\",\n          select: \"body h1\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select - alternative in property","suites":["HTML node"],"updatePoint":{"line":86,"column":89,"index":2755},"line":86,"code":"  it('should retrieve header contents if asked to by msg.select - alternative in property', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        property: \"foo\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.foo[0].should.equal('This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          foo: data,\n          topic: \"bar\",\n          select: \"h1\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select - alternative in and out properties","suites":["HTML node"],"updatePoint":{"line":118,"column":99,"index":3659},"line":118,"code":"  it('should retrieve header contents if asked to by msg.select - alternative in and out properties', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        property: \"foo\",\n        outproperty: \"bar\",\n        tag: \"h1\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.bar[0].should.equal('This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          foo: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should emit an empty array if no matching elements","suites":["HTML node"],"updatePoint":{"line":151,"column":56,"index":4543},"line":151,"code":"  it('should emit an empty array if no matching elements', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload');\n            msg.payload.should.be.empty;\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\",\n          select: \"h4\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve paragraph contents when specified","suites":["HTML node"],"updatePoint":{"line":183,"column":55,"index":5395},"line":183,"code":"  it('should retrieve paragraph contents when specified', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        ret: \"text\",\n        tag: \"p\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, 'There\\'s nothing to read here.');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as an array of html as default","suites":["HTML node"],"updatePoint":{"line":214,"column":66,"index":6227},"line":214,"code":"  it('should retrieve list contents as an array of html as default', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"ol\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.payload[0].indexOf(\"<li>Blue</li>\").should.be.above(-1);\n            msg.payload[0].indexOf(\"<li>Red</li>\").should.be.above(-1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as an array of text","suites":["HTML node"],"updatePoint":{"line":245,"column":55,"index":7100},"line":245,"code":"  it('should retrieve list contents as an array of text', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"ol\",\n        ret: \"text\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.payload[0].indexOf(\"Blue\").should.be.above(-1);\n            msg.payload[0].indexOf(\"Red\").should.be.above(-1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should fix up a unclosed tag","suites":["HTML node"],"updatePoint":{"line":277,"column":34,"index":7955},"line":277,"code":"  it('should fix up a unclosed tag', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"span\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, '<img src=\"foo.png\"/>');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve an attribute from a tag","suites":["HTML node"],"updatePoint":{"line":307,"column":45,"index":8738},"line":307,"code":"  it('should retrieve an attribute from a tag', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        ret: \"attr\",\n        tag: \"span img\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload[0].should.have.property('src', 'foo.png');\n            msg.should.have.property('topic', 'bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should log on error","suites":["HTML node"],"updatePoint":{"line":339,"column":25,"index":9579},"line":339,"code":"  it('should log on error', function (done) {\n    fs.readFile(file, function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"p\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        try {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n1.receive({\n            payload: null,\n            topic: \"bar\"\n          });\n          setTimeout(function () {\n            try {\n              helper.log().called.should.be.true();\n              var logEvents = helper.log().args.filter(function (evt) {\n                return evt[0].type == \"html\";\n              });\n              logEvents.should.have.length(1); // Each logEvent is the array of args passed to the function.\n\n              logEvents[0][0].should.have.a.property('msg');\n              logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          }, 50);\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should pass through if payload empty","suites":["HTML node"],"updatePoint":{"line":379,"column":42,"index":10765},"line":379,"code":"  it('should pass through if payload empty', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.not.have.property('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as html as default with output as multiple msgs","suites":["HTML node","multiple messages"],"updatePoint":{"line":433,"column":85,"index":12266},"line":433,"code":"    it('should retrieve list contents as html as default with output as multiple msgs', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n\n              if (cnt === 1) {\n                msg.payload.indexOf(\"<li>Apple</li>\").should.be.above(-1);\n                msg.payload.indexOf(\"<li>Pear</li>\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.payload.indexOf(\"<li>Potato</li>\").should.be.above(-1);\n                msg.payload.indexOf(\"<li>Parsnip</li>\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as html as default with output as multiple msgs - alternative property","suites":["HTML node","multiple messages"],"updatePoint":{"line":477,"column":108,"index":13672},"line":477,"code":"    it('should retrieve list contents as html as default with output as multiple msgs - alternative property', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          property: \"foo\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n\n              if (cnt === 1) {\n                msg.foo.indexOf(\"<li>Apple</li>\").should.be.above(-1);\n                msg.foo.indexOf(\"<li>Pear</li>\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.foo.indexOf(\"<li>Potato</li>\").should.be.above(-1);\n                msg.foo.indexOf(\"<li>Parsnip</li>\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            foo: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as text with output as multiple msgs ","suites":["HTML node","multiple messages"],"updatePoint":{"line":522,"column":75,"index":15052},"line":522,"code":"    it('should retrieve list contents as text with output as multiple msgs ', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          ret: \"text\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n\n              if (cnt === 1) {\n                msg.payload.indexOf(\"Apple\").should.be.above(-1);\n                msg.payload.indexOf(\"Pear\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.payload.indexOf(\"Potato\").should.be.above(-1);\n                msg.payload.indexOf(\"Parsnip\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve an attribute from a tag","suites":["HTML node","multiple messages"],"updatePoint":{"line":567,"column":47,"index":16384},"line":567,"code":"    it('should retrieve an attribute from a tag', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          ret: \"attr\",\n          tag: \"span img\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property('payload');\n              msg.payload.should.have.property('src', 'foo.png');\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, 0, 1);\n              cnt = 2; // frig the answer as only one img tag\n\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should not reuse message","suites":["HTML node","multiple messages"],"updatePoint":{"line":603,"column":32,"index":17415},"line":603,"code":"    it('should not reuse message', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          ret: \"text\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          var prev_msg = undefined;\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n\n              if (prev_msg == undefined) {\n                prev_msg = msg;\n              } else {\n                msg.should.not.equal(prev_msg);\n              }\n\n              if (cnt == 2) {\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid json string to a javascript object","suites":["JSON node"],"updatePoint":{"line":32,"column":63,"index":1090},"line":32,"code":"  it('should convert a valid json string to a javascript object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var jsonString = ' {\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}\\r\\n ';\n      jn1.receive({\n        payload: jsonString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a buffer of a valid json string to a javascript object","suites":["JSON node"],"updatePoint":{"line":58,"column":75,"index":1948},"line":58,"code":"  it('should convert a buffer of a valid json string to a javascript object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var jsonString = Buffer.from(' {\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}\\r\\n ');\n      jn1.receive({\n        payload: jsonString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a json string","suites":["JSON node"],"updatePoint":{"line":85,"column":57,"index":2822},"line":85,"code":"  it('should convert a javascript object to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a array to a json string","suites":["JSON node"],"updatePoint":{"line":112,"column":45,"index":3486},"line":112,"code":"  it('should convert a array to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '[1,2,3]');\n        done();\n      });\n      var obj = [1, 2, 3];\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a boolean to a json string","suites":["JSON node"],"updatePoint":{"line":134,"column":47,"index":4014},"line":134,"code":"  it('should convert a boolean to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, 'true');\n        done();\n      });\n      var obj = true;\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a json string to a boolean","suites":["JSON node"],"updatePoint":{"line":156,"column":47,"index":4534},"line":156,"code":"  it('should convert a json string to a boolean', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, true);\n        done();\n      });\n      var obj = \"true\";\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a number to a json string","suites":["JSON node"],"updatePoint":{"line":178,"column":46,"index":5053},"line":178,"code":"  it('should convert a number to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '2019');\n        done();\n      });\n      var obj = 2019;\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a json string to a number","suites":["JSON node"],"updatePoint":{"line":200,"column":46,"index":5572},"line":200,"code":"  it('should convert a json string to a number', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, 1962);\n        done();\n      });\n      var obj = '1962';\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid json string","suites":["JSON node"],"updatePoint":{"line":222,"column":66,"index":6111},"line":222,"code":"  it('should log an error if asked to parse an invalid json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        jn1.receive({\n          payload: 'foo',\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"Unexpected token o\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid json string in a buffer","suites":["JSON node"],"updatePoint":{"line":258,"column":78,"index":7162},"line":258,"code":"  it('should log an error if asked to parse an invalid json string in a buffer', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        jn1.receive({\n          payload: Buffer.from('{\"name\":foo}'),\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"Unexpected token o\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      } catch (err) {\n        done(err);\n      }\n    });\n  }); // it('should log an error if asked to parse something thats not json or js and not in force object mode', function(done) {","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass straight through if no payload set","suites":["JSON node"],"updatePoint":{"line":317,"column":52,"index":9245},"line":317,"code":"  it('should pass straight through if no payload set', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      jn1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should ensure the result is a json string","suites":["JSON node"],"updatePoint":{"line":339,"column":47,"index":9799},"line":339,"code":"  it('should ensure the result is a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      var count = 0;\n      jn2.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.payload, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n          count++;\n\n          if (count === 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n      jn1.receive({\n        payload: JSON.stringify(obj),\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should ensure the result is a JS Object","suites":["JSON node"],"updatePoint":{"line":381,"column":45,"index":10752},"line":381,"code":"  it('should ensure the result is a JS Object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      var count = 0;\n      jn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.payload.should.have.property('employees');\n          msg.payload.employees[0].should.have.property('firstName', 'John');\n          msg.payload.employees[0].should.have.property('lastName', 'Smith');\n          count++;\n\n          if (count === 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n      jn1.receive({\n        payload: JSON.stringify(obj),\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should handle any msg property - receive existing string","suites":["JSON node"],"updatePoint":{"line":426,"column":62,"index":11891},"line":426,"code":"  it('should handle any msg property - receive existing string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      property: \"one.two\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('one');\n          msg.one.should.have.property('two');\n          msg.one.two.should.have.property('employees');\n          msg.one.two.employees[0].should.have.property('firstName', 'John');\n          msg.one.two.employees[0].should.have.property('lastName', 'Smith');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var jsonString = '{\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}';\n      jn1.receive({\n        payload: \"\",\n        one: {\n          two: jsonString\n        },\n        topic: \"bar\"\n      });\n      var logEvents = helper.log().args.filter(function (evt) {\n        return evt[0].type == \"json\";\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should handle any msg property - receive existing obj","suites":["JSON node"],"updatePoint":{"line":465,"column":59,"index":13079},"line":465,"code":"  it('should handle any msg property - receive existing obj', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      property: \"one.two\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.one.two, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var jsonString = '{\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}';\n      jn1.receive({\n        payload: \"\",\n        one: {\n          two: JSON.parse(jsonString)\n        },\n        topic: \"bar\"\n      });\n      var logEvents = helper.log().args.filter(function (evt) {\n        return evt[0].type == \"json\";\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass an object if provided a valid JSON string and schema","suites":["JSON node"],"updatePoint":{"line":499,"column":70,"index":14031},"line":499,"code":"  it('should pass an object if provided a valid JSON string and schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload.number, 3);\n        should.equal(msg.payload.string, \"allo\");\n        done();\n      });\n      var jsonString = '{\"number\": 3, \"string\": \"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass an object if provided a valid object and schema and action is object","suites":["JSON node"],"updatePoint":{"line":535,"column":86,"index":14943},"line":535,"code":"  it('should pass an object if provided a valid object and schema and action is object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload.number, 3);\n        should.equal(msg.payload.string, \"allo\");\n        done();\n      });\n      var obj = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: obj,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass a string if provided a valid object and schema","suites":["JSON node"],"updatePoint":{"line":575,"column":64,"index":15862},"line":575,"code":"  it('should pass a string if provided a valid object and schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"number\":3,\"string\":\"allo\"}');\n        done();\n      });\n      var obj = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: obj,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass a string if provided a valid JSON string and schema and action is string","suites":["JSON node"],"updatePoint":{"line":613,"column":90,"index":16758},"line":613,"code":"  it('should pass a string if provided a valid JSON string and schema and action is string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"number\":3,\"string\":\"allo\"}');\n        done();\n      });\n      var jsonString = '{\"number\":3,\"string\":\"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid object and valid schema","suites":["JSON node"],"updatePoint":{"line":649,"column":70,"index":17644},"line":649,"code":"  it('should log an error if passed an invalid object and valid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid object and valid schema and action is object","suites":["JSON node"],"updatePoint":{"line":701,"column":91,"index":19052},"line":701,"code":"  it('should log an error if passed an invalid object and valid schema and action is object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid JSON string and valid schema","suites":["JSON node"],"updatePoint":{"line":754,"column":75,"index":20465},"line":754,"code":"  it('should log an error if passed an invalid JSON string and valid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var jsonString = '{\"number\":\"Hello\",\"string\":3}';\n        jn1.receive({\n          payload: jsonString,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid JSON string and valid schema and action is string","suites":["JSON node"],"updatePoint":{"line":803,"column":96,"index":21863},"line":803,"code":"  it('should log an error if passed an invalid JSON string and valid schema and action is string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var jsonString = '{\"number\":\"Hello\",\"string\":3}';\n        jn1.receive({\n          payload: jsonString,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed a valid object and invalid schema","suites":["JSON node"],"updatePoint":{"line":853,"column":69,"index":23255},"line":853,"code":"  it('should log an error if passed a valid object and invalid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = \"garbage\";\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.equal(\"json.errors.schema-error-compile\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"msg.schema property should be deleted before sending to next node (string input)","suites":["JSON node"],"updatePoint":{"line":894,"column":86,"index":24436},"line":894,"code":"  it('msg.schema property should be deleted before sending to next node (string input)', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.schema, undefined);\n        done();\n      });\n      var jsonString = '{\"number\":3,\"string\":\"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"msg.schema property should be deleted before sending to next node (object input)","suites":["JSON node"],"updatePoint":{"line":930,"column":86,"index":25316},"line":930,"code":"  it('msg.schema property should be deleted before sending to next node (object input)', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.schema, undefined);\n        done();\n      });\n      var jsonObject = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonObject,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["XML node"],"updatePoint":{"line":32,"column":22,"index":1046},"line":32,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"xmlNode1\",\n      type: \"xml\",\n      name: \"xmlNode\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var xmlNode1 = helper.getNode(\"xmlNode1\");\n      xmlNode1.should.have.property('name', 'xmlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object","suites":["XML node"],"updatePoint":{"line":44,"column":62,"index":1396},"line":44,"code":"  it('should convert a valid xml string to a javascript object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees.should.have.property('firstName');\n        should.equal(msg.payload.employees.firstName[0], 'John');\n        msg.payload.employees.should.have.property('lastName');\n        should.equal(msg.payload.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n  ';\n      n1.receive({\n        payload: string,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object - alternative property","suites":["XML node"],"updatePoint":{"line":73,"column":85,"index":2403},"line":73,"code":"  it('should convert a valid xml string to a javascript object - alternative property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      property: \"foo\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.foo.should.have.property('employees');\n        msg.foo.employees.should.have.property('firstName');\n        should.equal(msg.foo.employees.firstName[0], 'John');\n        msg.foo.employees.should.have.property('lastName');\n        should.equal(msg.foo.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n ';\n      n1.receive({\n        foo: string,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object with options","suites":["XML node"],"updatePoint":{"line":103,"column":75,"index":3398},"line":103,"code":"  it('should convert a valid xml string to a javascript object with options', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees.should.have.property('firstName');\n        should.equal(msg.payload.employees.firstName[0], 'John');\n        msg.payload.employees.should.have.property('lastName');\n        should.equal(msg.payload.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n  ';\n      n1.receive({\n        payload: string,\n        topic: \"bar\",\n        options: {\n          trim: true\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to an xml string","suites":["XML node"],"updatePoint":{"line":135,"column":57,"index":4428},"line":135,"code":"  it('should convert a javascript object to an xml string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        var index = msg.payload.indexOf('<employees><firstName>John</firstName><lastName>Smith</lastName></employees>');\n        index.should.be.above(-1);\n        done();\n      });\n      var obj = {\n        \"employees\": {\n          \"firstName\": [\"John\"],\n          \"lastName\": [\"Smith\"]\n        }\n      };\n      n1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to an xml string with options - alternative property","suites":["XML node"],"updatePoint":{"line":166,"column":93,"index":5298},"line":166,"code":"  it('should convert a javascript object to an xml string with options - alternative property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      property: \"foo\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        var index = msg.foo.indexOf('<employees>\\n  <firstName>John</firstName>\\n  <lastName>Smith</lastName>\\n</employees>');\n        index.should.be.above(-1);\n        done();\n      });\n      var obj = {\n        \"employees\": {\n          \"firstName\": [\"John\"],\n          \"lastName\": [\"Smith\"]\n        }\n      };\n      n1.receive({\n        foo: obj,\n        topic: \"bar\",\n        options: {\n          headless: true\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid xml string","suites":["XML node"],"updatePoint":{"line":201,"column":65,"index":6220},"line":201,"code":"  it('should log an error if asked to parse an invalid xml string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.receive({\n        payload: '<not valid>',\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"xml\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.startWith(\"Error: Attribute without value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 200);\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse something thats not xml or js","suites":["XML node"],"updatePoint":{"line":233,"column":73,"index":7134},"line":233,"code":"  it('should log an error if asked to parse something thats not xml or js', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.receive({\n        payload: 1,\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"xml\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg', \"xml.errors.xml_js\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 200);\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should just pass through if payload is missing","suites":["XML node"],"updatePoint":{"line":264,"column":52,"index":7943},"line":264,"code":"  it('should just pass through if payload is missing', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      n1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["YAML node"],"updatePoint":{"line":32,"column":22,"index":1049},"line":32,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"yamlNode1\",\n      type: \"yaml\",\n      name: \"yamlNode\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yamlNode1 = helper.getNode(\"yamlNode1\");\n      yamlNode1.should.have.property('name', 'yamlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid yaml string to a javascript object","suites":["YAML node"],"updatePoint":{"line":44,"column":63,"index":1408},"line":44,"code":"  it('should convert a valid yaml string to a javascript object', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var yamlString = \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\";\n      yn1.receive({\n        payload: yamlString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid yaml string to a javascript object - using another property","suites":["YAML node"],"updatePoint":{"line":71,"column":88,"index":2298},"line":71,"code":"  it('should convert a valid yaml string to a javascript object - using another property', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      property: \"foo\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.foo.should.have.property('employees');\n        msg.foo.employees[0].should.have.property('firstName', 'John');\n        msg.foo.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var yamlString = \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\";\n      yn1.receive({\n        foo: yamlString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a yaml string","suites":["YAML node"],"updatePoint":{"line":99,"column":57,"index":3164},"line":99,"code":"  it('should convert a javascript object to a yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\");\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      yn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a yaml string - using another property","suites":["YAML node"],"updatePoint":{"line":127,"column":82,"index":3891},"line":127,"code":"  it('should convert a javascript object to a yaml string - using another property', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      property: \"foo\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.foo, \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\");\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      yn1.receive({\n        foo: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array to a yaml string","suites":["YAML node"],"updatePoint":{"line":156,"column":46,"index":4597},"line":156,"code":"  it('should convert an array to a yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, \"- 1\\n- 2\\n- 3\\n\");\n        done();\n      });\n      var obj = [1, 2, 3];\n      yn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid yaml string","suites":["YAML node"],"updatePoint":{"line":179,"column":66,"index":5179},"line":179,"code":"  it('should log an error if asked to parse an invalid yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      try {\n        var yn1 = helper.getNode(\"yn1\");\n        var yn2 = helper.getNode(\"yn2\");\n        yn1.receive({\n          payload: 'employees:\\n-firstName: John\\n- lastName: Smith\\n',\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"yaml\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"end of the stream\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse something thats not yaml or js","suites":["YAML node"],"updatePoint":{"line":216,"column":74,"index":6298},"line":216,"code":"  it('should log an error if asked to parse something thats not yaml or js', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"yaml\";\n          });\n          logEvents.should.have.length(3);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.eql('yaml.errors.dropped');\n          logEvents[1][0].should.have.a.property('msg');\n          logEvents[1][0].msg.toString().should.eql('yaml.errors.dropped');\n          logEvents[2][0].should.have.a.property('msg');\n          logEvents[2][0].msg.toString().should.eql('yaml.errors.dropped-object');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 150);\n      yn1.receive({\n        payload: true\n      });\n      yn1.receive({\n        payload: 1\n      });\n      yn1.receive({\n        payload: Buffer.from(\"a\")\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should pass straight through if no payload set","suites":["YAML node"],"updatePoint":{"line":257,"column":52,"index":7540},"line":257,"code":"  it('should pass straight through if no payload set', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      yn1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["SPLIT node"],"updatePoint":{"line":39,"column":22,"index":1334},"line":39,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"splitNode1\",\n      type: \"split\",\n      name: \"splitNode\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var splitNode1 = helper.getNode(\"splitNode1\");\n      splitNode1.should.have.property('name', 'splitNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an array into multiple messages","suites":["SPLIT node"],"updatePoint":{"line":51,"column":50,"index":1688},"line":51,"code":"  it('should split an array into multiple messages', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"type\", \"array\");\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(2);\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(3);\n        }\n\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(4);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: [1, 2, 3, 4]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an array into multiple messages of a specified size","suites":["SPLIT node"],"updatePoint":{"line":91,"column":70,"index":2728},"line":91,"code":"  it('should split an array into multiple messages of a specified size', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      arraySplt: 3,\n      arraySpltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"type\", \"array\");\n        msg.parts.should.have.property(\"index\");\n        msg.payload.should.be.an.Array();\n\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(3);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: [1, 2, 3, 4]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an object into pieces","suites":["SPLIT node"],"updatePoint":{"line":126,"column":40,"index":3668},"line":126,"code":"  it('should split an object into pieces', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      var count = 0;\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\");\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"type\", \"object\");\n        msg.parts.should.have.property(\"key\");\n        msg.parts.should.have.property(\"count\");\n        msg.parts.should.have.property(\"index\");\n        msg.topic.should.equal(\"foo\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(true);\n          done();\n        }\n      });\n      sn1.receive({\n        topic: \"foo\",\n        payload: {\n          a: 1,\n          b: \"2\",\n          c: true\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an object into pieces and overwrite their topics","suites":["SPLIT node"],"updatePoint":{"line":171,"column":67,"index":4846},"line":171,"code":"  it('should split an object into pieces and overwrite their topics', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      addname: \"topic\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      var count = 0;\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\");\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"type\", \"object\");\n        msg.parts.should.have.property(\"key\");\n        msg.parts.should.have.property(\"count\");\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n          msg.topic.should.equal(\"a\");\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n          msg.topic.should.equal(\"b\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(true);\n          msg.topic.should.equal(\"c\");\n          done();\n        }\n      });\n      sn1.receive({\n        topic: \"foo\",\n        payload: {\n          a: 1,\n          b: \"2\",\n          c: true\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string into new-lines","suites":["SPLIT node"],"updatePoint":{"line":219,"column":42,"index":6101},"line":219,"code":"  it('should split a string into new-lines', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"type\", \"string\");\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"Da\");\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"ve\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\" \");\n        }\n\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"CJ\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"Da\\nve\\n \\nCJ\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string on a specified char","suites":["SPLIT node"],"updatePoint":{"line":259,"column":47,"index":7133},"line":259,"code":"  it('should split a string on a specified char', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"\\n\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 3);\n        msg.parts.should.have.property(\"ch\", \"\\n\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"1\");\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"3\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"1\\n2\\n3\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string into lengths","suites":["SPLIT node"],"updatePoint":{"line":297,"column":40,"index":8130},"line":297,"code":"  it('should split a string into lengths', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"2\",\n      spltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"ch\", \"\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"12\");\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"34\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"56\");\n        }\n\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"78\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"12345678\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string on a specified char in stream mode","suites":["SPLIT node"],"updatePoint":{"line":340,"column":62,"index":9263},"line":340,"code":"  it('should split a string on a specified char in stream mode', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"\\n\",\n      stream: true\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"ch\", \"\\n\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"1\");\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"3\");\n        }\n\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"4\");\n        }\n\n        if (msg.parts.index === 4) {\n          msg.payload.should.equal(\"5\");\n        }\n\n        if (msg.parts.index === 5) {\n          msg.payload.should.equal(\"6\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"1\\n2\\n3\\n\"\n      });\n      sn1.receive({\n        payload: \"4\\n5\\n6\\n\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a buffer into lengths","suites":["SPLIT node"],"updatePoint":{"line":393,"column":40,"index":10556},"line":393,"code":"  it('should split a buffer into lengths', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"2\",\n      spltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          //console.log(msg);\n          msg.should.have.property(\"parts\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.parts.should.have.property(\"count\", 4);\n          msg.parts.should.have.property(\"index\");\n          msg.parts.should.have.property(\"type\", \"buffer\");\n\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"12\");\n          }\n\n          if (msg.parts.index === 1) {\n            msg.payload.toString().should.equal(\"34\");\n          }\n\n          if (msg.parts.index === 2) {\n            msg.payload.toString().should.equal(\"56\");\n          }\n\n          if (msg.parts.index === 3) {\n            msg.payload.toString().should.equal(\"78\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var b = Buffer.from(\"12345678\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a buffer on another buffer (streaming)","suites":["SPLIT node"],"updatePoint":{"line":442,"column":57,"index":11898},"line":442,"code":"  it('should split a buffer on another buffer (streaming)', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"[52]\",\n      spltType: \"bin\",\n      stream: true\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"parts\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.parts.should.have.property(\"index\");\n          msg.parts.should.have.property(\"type\", \"buffer\");\n\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"123\");\n          }\n\n          if (msg.parts.index === 1) {\n            msg.payload.toString().should.equal(\"123\");\n          }\n\n          if (msg.parts.index === 2) {\n            msg.payload.toString().should.equal(\"123\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var b1 = Buffer.from(\"123412\");\n      var b2 = Buffer.from(\"341234\");\n      sn1.receive({\n        payload: b1\n      });\n      sn1.receive({\n        payload: b2\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid spltType (not an array)","suites":["SPLIT node"],"updatePoint":{"line":490,"column":51,"index":13157},"line":490,"code":"  it('should handle invalid spltType (not an array)', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"1\",\n      spltType: \"bin\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid splt length","suites":["SPLIT node"],"updatePoint":{"line":515,"column":39,"index":13769},"line":515,"code":"  it('should handle invalid splt length', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: 0,\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid array splt length","suites":["SPLIT node"],"updatePoint":{"line":540,"column":45,"index":14385},"line":540,"code":"  it('should handle invalid array splt length', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      arraySplt: 0,\n      arraySpltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should ceil count value when msg.payload type is string","suites":["SPLIT node"],"updatePoint":{"line":565,"column":61,"index":15027},"line":565,"code":"  it('should ceil count value when msg.payload type is string', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle spltBufferString value of undefined","suites":["SPLIT node"],"updatePoint":{"line":598,"column":55,"index":15868},"line":598,"code":"  it('should handle spltBufferString value of undefined', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"[52]\",\n      spltType: \"bin\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"parts\");\n          msg.parts.should.have.property(\"index\");\n\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"123\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should ceil count value when msg.payload type is Buffer","suites":["SPLIT node"],"updatePoint":{"line":630,"column":61,"index":16661},"line":630,"code":"  it('should ceil count value when msg.payload type is Buffer', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      var b = Buffer.from(\"123\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should set msg.parts.ch when node.spltType is str","suites":["SPLIT node"],"updatePoint":{"line":664,"column":55,"index":17532},"line":664,"code":"  it('should set msg.parts.ch when node.spltType is str', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"str\",\n      stream: false,\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      var b = Buffer.from(\"123\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["JOIN node"],"updatePoint":{"line":730,"column":22,"index":19016},"line":730,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"joinNode1\",\n      type: \"join\",\n      name: \"joinNode\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var joinNode1 = helper.getNode(\"joinNode1\");\n      joinNode1.should.have.property('name', 'joinNode');\n      joinNode1.should.have.property('count', 0);\n      joinNode1.should.have.property('timer', 0);\n      joinNode1.should.have.property('build', 'array');\n      done();\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of string back together automatically","suites":["JOIN node"],"updatePoint":{"line":745,"column":60,"index":19528},"line":745,"code":"  it('should join bits of string back together automatically', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"A,B,C,D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of string back together automatically with a buffer joiner","suites":["JOIN node"],"updatePoint":{"line":811,"column":81,"index":20897},"line":811,"code":"  it('should join bits of string back together automatically with a buffer joiner', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"A,B,C,D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of buffer back together automatically","suites":["JOIN node"],"updatePoint":{"line":878,"column":60,"index":22273},"line":878,"code":"  it('should join bits of buffer back together automatically', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.toString().should.equal(\"A-B-C-D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"D\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array after a count","suites":["JOIN node"],"updatePoint":{"line":945,"column":52,"index":23785},"line":945,"code":"  it('should join things into an array after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true); //msg.payload[2].a.should.equal(1);\n\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      });\n      n1.receive({\n        payload: true\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array ignoring msg.parts.index in manual mode","suites":["JOIN node"],"updatePoint":{"line":985,"column":78,"index":24723},"line":985,"code":"  it('should join things into an array ignoring msg.parts.index in manual mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true); //msg.payload[2].a.should.equal(1);\n\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 3\n        }\n      });\n      n1.receive({\n        payload: true,\n        parts: {\n          index: 0\n        }\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        parts: {\n          index: 9\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array after a count with a buffer join set","suites":["JOIN node"],"updatePoint":{"line":1034,"column":75,"index":25799},"line":1034,"code":"  it('should join things into an array after a count with a buffer join set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joinerType: \"bin\",\n      joiner: \"\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true); //msg.payload[2].a.should.equal(1);\n\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      });\n      n1.receive({\n        payload: true\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings into a buffer after a count","suites":["JOIN node"],"updatePoint":{"line":1075,"column":53,"index":26736},"line":1075,"code":"  it('should join strings into a buffer after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 2,\n      build: \"buffer\",\n      joinerType: \"bin\",\n      joiner: \"\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.length.should.equal(10);\n          msg.payload.toString().should.equal(\"helloworld\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n      n1.receive({\n        payload: \"world\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an object after a count","suites":["JOIN node"],"updatePoint":{"line":1110,"column":53,"index":27572},"line":1110,"code":"  it('should join things into an object after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 5,\n      build: \"object\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", \"2\");\n          msg.payload.should.have.property(\"c\", true);\n          msg.payload.should.have.property(\"d\");\n          msg.payload.d.should.have.property(\"e\", 7); // msg.payload.should.have.property(\"g\");\n          // msg.payload.g.should.have.property(\"f\",6);\n\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: \"2\",\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: true,\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          e: 5\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          e: 7\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          f: 6\n        },\n        topic: \"g\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should merge objects","suites":["JOIN node"],"updatePoint":{"line":1172,"column":26,"index":28973},"line":1172,"code":"  it('should merge objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 5,\n      build: \"merged\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          msg.payload.should.have.property(\"e\", 5);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: {\n          a: 9\n        },\n        topic: \"f\"\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 9\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          d: 4\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          e: 5\n        },\n        topic: \"e\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should merge full msg objects","suites":["JOIN node"],"updatePoint":{"line":1244,"column":35,"index":30443},"line":1244,"code":"  it('should merge full msg objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 6,\n      build: \"merged\",\n      mode: \"custom\",\n      propertyType: \"full\",\n      property: \"\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.have.property(\"payload\", 7);\n          msg.payload.should.have.property(\"aha\", 'c');\n          msg.payload.should.have.property(\"bar\", 'b');\n          msg.payload.should.have.property(\"bingo\", 'e');\n          msg.payload.should.have.property(\"foo\", 'd');\n          msg.payload.should.have.property(\"topic\", 'a');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"f\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 4,\n        bar: \"b\"\n      });\n      n1.receive({\n        payload: 5,\n        aha: \"c\"\n      });\n      n1.receive({\n        payload: 6,\n        foo: \"d\"\n      });\n      n1.receive({\n        payload: 7,\n        bingo: \"e\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should accumulate a merged object","suites":["JOIN node"],"updatePoint":{"line":1304,"column":39,"index":31817},"line":1304,"code":"  it('should accumulate a merged object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"merged\",\n      mode: \"custom\",\n      accumulate: true,\n      count: 3\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 3) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"a\", 3);\n            msg.payload.should.have.property(\"b\", 2);\n            msg.payload.should.have.property(\"c\", 1);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        }\n\n        c += 1;\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          a: 3\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"e\"\n      });\n      n1.receive({\n        payload: {\n          c: 1\n        },\n        topic: \"f\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be able to reset an accumulation","suites":["JOIN node"],"updatePoint":{"line":1374,"column":45,"index":33209},"line":1374,"code":"  it('should be able to reset an accumulation', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"merged\",\n      accumulate: true,\n      mode: \"custom\",\n      count: 3\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 1) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"a\", 1);\n            msg.payload.should.have.property(\"b\", 2);\n            msg.payload.should.have.property(\"c\", 3);\n            msg.payload.should.have.property(\"d\", 4);\n          } catch (e) {\n            done(e);\n          }\n        }\n\n        if (c === 2) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"e\", 2);\n            msg.payload.should.have.property(\"f\", 1);\n          } catch (e) {\n            done(e);\n          }\n        }\n\n        if (c === 3) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"g\", 2);\n            msg.payload.should.have.property(\"h\", 1);\n            msg.payload.should.have.property(\"i\", 3);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        }\n\n        c += 1;\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          d: 4\n        },\n        topic: \"d\",\n        complete: true\n      });\n      n1.receive({\n        payload: {\n          e: 2\n        },\n        topic: \"e\"\n      });\n      n1.receive({\n        payload: {\n          f: 1\n        },\n        topic: \"f\",\n        complete: true\n      });\n      n1.receive({\n        payload: {\n          g: 2\n        },\n        topic: \"g\"\n      });\n      n1.receive({\n        payload: {\n          h: 1\n        },\n        topic: \"h\"\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: {\n          g: 2\n        },\n        topic: \"g\"\n      });\n      n1.receive({\n        payload: {\n          h: 1\n        },\n        topic: \"h\"\n      });\n      n1.receive({\n        payload: {\n          i: 3\n        },\n        topic: \"i\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should accumulate a key/value object","suites":["JOIN node"],"updatePoint":{"line":1501,"column":42,"index":35796},"line":1501,"code":"  it('should accumulate a key/value object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"object\",\n      accumulate: true,\n      mode: \"custom\",\n      topic: \"bar\",\n      key: \"foo\",\n      count: 4\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          //msg.should.have.property(\"topic\",\"bar\");\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 2,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"c\"\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: 1,\n        foo: \"a\"\n      });\n      n1.receive({\n        payload: 2,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"c\"\n      });\n      n1.receive({\n        payload: 4,\n        foo: \"d\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings with a specifed character after a timeout","suites":["JOIN node"],"updatePoint":{"line":1562,"column":67,"index":37172},"line":1562,"code":"  it('should join strings with a specifed character after a timeout', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 0.05,\n      count: \"\",\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"a,b,c\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\"\n      });\n      n1.receive({\n        payload: \"b\"\n      });\n      n1.receive({\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should allow the timeout to be restarted","suites":["JOIN node"],"updatePoint":{"line":1599,"column":46,"index":37978},"line":1599,"code":"  it('should allow the timeout to be restarted', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 0.5,\n      count: \"\",\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"a,b,c\");\n          const timeTaken = (Date.now() - start) / 1000; // Node times out after 0.5s.\n          // It receives a restartTimeout after 0.4s.\n          // So time taken to timeout should be approx 0.9\n\n          timeTaken.should.be.approximately(0.9, 0.15);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      var start = Date.now();\n      n1.receive({\n        payload: \"a\"\n      });\n      setTimeout(function () {\n        n1.receive({\n          payload: \"b\",\n          restartTimeout: true\n        });\n        n1.receive({\n          payload: \"c\"\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings with a specifed character and complete when told to","suites":["JOIN node"],"updatePoint":{"line":1645,"column":77,"index":39191},"line":1645,"code":"  it('should join strings with a specifed character and complete when told to', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 5,\n      count: 0,\n      joiner: \"\\n\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"Hello\\nNodeRED\\nWorld\\n\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"Hello\"\n      });\n      n1.receive({\n        payload: \"NodeRED\"\n      });\n      n1.receive({\n        payload: \"World\"\n      });\n      n1.receive({\n        payload: '',\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join complete message objects into an array after a count","suites":["JOIN node"],"updatePoint":{"line":1686,"column":70,"index":40123},"line":1686,"code":"  it('should join complete message objects into an array after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"array\",\n      timeout: 0,\n      count: 3,\n      propertyType: \"full\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.be.an.Object();\n          msg.payload[0].should.have.property(\"payload\", \"a\");\n          msg.payload[1].should.be.an.Object();\n          msg.payload[1].should.have.property(\"payload\", \"b\");\n          msg.payload[2].should.be.an.Object();\n          msg.payload[2].should.have.property(\"payload\", \"c\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\"\n      });\n      n1.receive({\n        payload: \"b\"\n      });\n      n1.receive({\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things back into an array","suites":["JOIN node"],"updatePoint":{"line":1728,"column":49,"index":41221},"line":1728,"code":"  it('should join split things back into an array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          msg.payload[3].should.equal(4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 111\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things back into an object","suites":["JOIN node"],"updatePoint":{"line":1787,"column":50,"index":42482},"line":1787,"code":"  it('should join split things back into an object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222,\n          key: \"c\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222,\n          key: \"b\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222,\n          key: \"d\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222,\n          key: \"a\",\n          type: \"object\"\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1853,"column":55,"index":43928},"line":1853,"code":"  it('should join split things, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 0.250\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          (msg.payload[0] === undefined).should.be.true();\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          msg.payload[3].should.equal(4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 444\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 444\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 444\n        },\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should manually join things into an array, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1906,"column":72,"index":45140},"line":1906,"code":"  it('should manually join things into an array, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 1,\n      mode: \"custom\",\n      build: \"array\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload.length.should.equal(3);\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.receive({\n        payload: 3,\n        topic: \"C\"\n      });\n      n1.receive({\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should manually join things into an object, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1951,"column":73,"index":46210},"line":1951,"code":"  it('should manually join things into an object, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 1,\n      mode: \"custom\",\n      build: \"object\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Object();\n          Object.keys(msg.payload).length.should.equal(3);\n          msg.payload.A.should.equal(1);\n          msg.payload.B.should.equal(2);\n          msg.payload.C.should.equal(3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.receive({\n        payload: 3,\n        topic: \"C\"\n      });\n      n1.receive({\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split strings back into a word","suites":["JOIN node"],"updatePoint":{"line":1996,"column":48,"index":47267},"line":1996,"code":"  it('should join split strings back into a word', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"abcd\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\",\n        parts: {\n          type: 'string',\n          index: 0,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"d\",\n        parts: {\n          type: 'string',\n          index: 3,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"c\",\n        parts: {\n          type: 'string',\n          index: 2,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"b\",\n        parts: {\n          type: 'string',\n          index: 1,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should allow chained split-split-join-join sequences","suites":["JOIN node"],"updatePoint":{"line":2061,"column":58,"index":48617},"line":2061,"code":"  it('should allow chained split-split-join-join sequences', function (done) {\n    var flow = [{\n      id: \"s1\",\n      type: \"split\",\n      wires: [[\"s2\"]]\n    }, {\n      id: \"s2\",\n      type: \"split\",\n      wires: [[\"j1\"]]\n    }, {\n      id: \"j1\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"j2\"]]\n    }, {\n      id: \"j2\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var s1 = helper.getNode(\"s1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.eql([[1, 2, 3], \"a\\nb\\nc\", [7, 8, 9]]);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      s1.receive({\n        payload: [[1, 2, 3], \"a\\nb\\nc\", [7, 8, 9]]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages","suites":["JOIN node"],"updatePoint":{"line":2101,"column":28,"index":49500},"line":2101,"code":"  it('should reduce messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(10);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages - count only in last part","suites":["JOIN node"],"updatePoint":{"line":2163,"column":54,"index":50775},"line":2163,"code":"  it('should reduce messages - count only in last part', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(10);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (str)","suites":["JOIN node"],"updatePoint":{"line":2303,"column":50,"index":53729},"line":2303,"code":"  it('should reduce messages with init types (str)', function (done) {\n    checkInitTypesSimple('str', \"xyz\", done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (num)","suites":["JOIN node"],"updatePoint":{"line":2306,"column":50,"index":53852},"line":2306,"code":"  it('should reduce messages with init types (num)', function (done) {\n    checkInitTypesSimple('num', 10, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (bool)","suites":["JOIN node"],"updatePoint":{"line":2309,"column":51,"index":53973},"line":2309,"code":"  it('should reduce messages with init types (bool)', function (done) {\n    checkInitTypesSimple('bool', true, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (json)","suites":["JOIN node"],"updatePoint":{"line":2312,"column":51,"index":54097},"line":2312,"code":"  it('should reduce messages with init types (json)', function (done) {\n    var ival = '{\"x\":\"vx\", \"y\":\"vy\", \"z\":\"vz\"}';\n    var rval = JSON.parse(ival);\n    checkInitTypesComplex('json', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (bin)","suites":["JOIN node"],"updatePoint":{"line":2317,"column":50,"index":54309},"line":2317,"code":"  it('should reduce messages with init types (bin)', function (done) {\n    var ival = \"[1,2,3]\";\n    var rval = Buffer.from(JSON.parse(ival));\n    checkInitTypesComplex('bin', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (JSONata)","suites":["JOIN node"],"updatePoint":{"line":2322,"column":54,"index":54514},"line":2322,"code":"  it('should reduce messages with init types (JSONata)', function (done) {\n    var ival = \"1+2+3\";\n    var rval = 6;\n    checkInitTypesComplex('jsonata', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (env)","suites":["JOIN node"],"updatePoint":{"line":2327,"column":50,"index":54689},"line":2327,"code":"  it('should reduce messages with init types (env)', function (done) {\n    function init(node, cb) {\n      process.env.NR_XYZ = \"nr_xyz\";\n      cb();\n    }\n\n    function fin(err) {\n      delete process.env.NR_XYZ;\n      done(err);\n    }\n\n    checkInitTypes('env', \"NR_XYZ\", \"nr_xyz\", init, should.equal, fin);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (flow.name)","suites":["JOIN node"],"updatePoint":{"line":2340,"column":56,"index":55011},"line":2340,"code":"  it('should reduce messages with init types (flow.name)', function (done) {\n    function init(node, cb) {\n      var context = node.context();\n      context.flow.set(\"foo\", \"bar\");\n      cb();\n    }\n\n    checkInitTypes('flow', \"foo\", \"bar\", init, should.equal, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (global.name)","suites":["JOIN node"],"updatePoint":{"line":2349,"column":58,"index":55287},"line":2349,"code":"  it('should reduce messages with init types (global.name)', function (done) {\n    function init(node, cb) {\n      var context = node.context();\n      context.global.set(\"foo\", \"bar\");\n      cb();\n    }\n\n    checkInitTypes('global', \"foo\", \"bar\", init, should.equal, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages using $I","suites":["JOIN node"],"updatePoint":{"line":2358,"column":37,"index":55546},"line":2358,"code":"  it('should reduce messages using $I', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+$I\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(6);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with fixup","suites":["JOIN node"],"updatePoint":{"line":2420,"column":39,"index":56800},"line":2420,"code":"  it('should reduce messages with fixup', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"$A/$N\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(2);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 0,\n        parts: {\n          index: 4,\n          count: 5,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages (left)","suites":["JOIN node"],"updatePoint":{"line":2490,"column":35,"index":58187},"line":2490,"code":"  it('should reduce messages (left)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"'(' & $A & '+' & payload & ')'\",\n      reduceInit: \"0\",\n      reduceInitType: \"str\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"((((0+1)+2)+3)+4)\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: '3',\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '2',\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '4',\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '1',\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages (right)","suites":["JOIN node"],"updatePoint":{"line":2553,"column":36,"index":59534},"line":2553,"code":"  it('should reduce messages (right)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: true,\n      reduceExp: \"'(' & $A & '+' & payload & ')'\",\n      reduceInit: \"0\",\n      reduceInitType: \"str\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"((((0+4)+3)+2)+1)\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: '3',\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '2',\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '4',\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '1',\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with array result","suites":["JOIN node"],"updatePoint":{"line":2616,"column":46,"index":60890},"line":2616,"code":"  it('should reduce messages with array result', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$append($A,[payload])\",\n      reduceInit: \"[]\",\n      reduceInitType: \"json\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          var payload = msg.payload;\n          payload.length.should.equal(2);\n\n          if (count == 0) {\n            payload[0].should.equal(1);\n            payload[1].should.equal(2);\n          } else if (count == 1) {\n            payload[0].should.equal(3);\n            payload[1].should.equal(4);\n            done();\n          }\n\n          count++;\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 2,\n          id: 333\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 2,\n          id: 333\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages for reduce mode","suites":["JOIN node"],"updatePoint":{"line":2690,"column":61,"index":62526},"line":2690,"code":"  it('should handle too many pending messages for reduce mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"join\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"join\");\n        evt.should.have.property('msg', \"join.too-many\");\n        done();\n      }, TimeoutForErrorCase);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with flow context","suites":["JOIN node"],"updatePoint":{"line":2752,"column":46,"index":63953},"line":2752,"code":"  it('should reduce messages with flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload*$flowContext(\\\"two\\\"))\",\n      reduceInit: \"$flowContext(\\\"one\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$flowContext(\\\"three\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal((1 + 1 * 2 + 2 * 2 + 3 * 2 + 4 * 2) * 3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.context().flow.set(\"one\", 1);\n      n1.context().flow.set(\"two\", 2);\n      n1.context().flow.set(\"three\", 3);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with global context","suites":["JOIN node"],"updatePoint":{"line":2822,"column":48,"index":65524},"line":2822,"code":"  it('should reduce messages with global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload/$globalContext(\\\"two\\\"))\",\n      reduceInit: \"$globalContext(\\\"one\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$globalContext(\\\"three\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal((1 + 1 / 2 + 2 / 2 + 3 / 2 + 4 / 2) * 3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.context().global.set(\"one\", 1);\n      n1.context().global.set(\"two\", 2);\n      n1.context().global.set(\"three\", 3);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with persistable flow context","suites":["JOIN node"],"updatePoint":{"line":2892,"column":58,"index":67117},"line":2892,"code":"  it('should reduce messages with persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload*$flowContext(\\\"two\\\",\\\"memory\\\"))\",\n      reduceInit: \"$flowContext(\\\"one\\\",\\\"memory\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$flowContext(\\\"three\\\",\\\"memory\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n\n        try {\n          n2.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"payload\");\n              msg.payload.should.equal((1 + 1 * 2 + 2 * 2 + 3 * 2 + 4 * 2) * 3);\n              done();\n            } catch (e) {\n              done(e);\n            }\n          });\n          n1.context().flow.set([\"one\", \"two\", \"three\"], [1, 2, 3], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              n1.receive({\n                payload: 3,\n                parts: {\n                  index: 2,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 2,\n                parts: {\n                  index: 1,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 4,\n                parts: {\n                  index: 3,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 1,\n                parts: {\n                  index: 0,\n                  count: 4,\n                  id: 222\n                }\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with persistable global context","suites":["JOIN node"],"updatePoint":{"line":2971,"column":60,"index":69193},"line":2971,"code":"  it('should reduce messages with persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload/$globalContext(\\\"two\\\",\\\"memory\\\"))\",\n      reduceInit: \"$globalContext(\\\"one\\\",\\\"memory\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$globalContext(\\\"three\\\",\\\"memory\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.equal((1 + 1 / 2 + 2 / 2 + 3 / 2 + 4 / 2) * 3);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.context().global.set([\"one\", \"two\", \"three\"], [1, 2, 3], \"memory\", function (err) {\n          if (err) {\n            done(err);\n          } else {\n            n1.receive({\n              payload: 3,\n              parts: {\n                index: 2,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 2,\n              parts: {\n                index: 1,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 4,\n              parts: {\n                index: 3,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 1,\n              parts: {\n                index: 0,\n                count: 4,\n                id: 222\n              }\n            });\n          }\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata reduce expression - syntax error\"","suites":["JOIN node"],"updatePoint":{"line":3045,"column":69,"index":71122},"line":3045,"code":"  it('should handle invalid JSONata reduce expression - syntax error\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"invalid expr\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata reduce expression - runtime error\"","suites":["JOIN node"],"updatePoint":{"line":3081,"column":70,"index":72004},"line":3081,"code":"  it('should handle invalid JSONata reduce expression - runtime error\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$uknown()\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata fixup expression - syntax err\"","suites":["JOIN node"],"updatePoint":{"line":3117,"column":66,"index":72879},"line":3117,"code":"  it('should handle invalid JSONata fixup expression - syntax err\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"invalid expr\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata fixup expression - runtime err\"","suites":["JOIN node"],"updatePoint":{"line":3153,"column":67,"index":73753},"line":3153,"code":"  it('should handle invalid JSONata fixup expression - runtime err\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"$unknown()\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is array","suites":["JOIN node"],"updatePoint":{"line":3189,"column":52,"index":74610},"line":3189,"code":"  it('should concat payload when group.type is array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(\"ab\");\n          msg.payload[1].should.equal(\"cd\");\n          msg.payload[2].should.equal(\"ef\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"ab\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 3,\n          len: 2\n        }\n      });\n      n1.receive({\n        payload: \"cd\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 3,\n          len: 2\n        }\n      });\n      n1.receive({\n        payload: \"ef\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 2,\n          count: 3,\n          len: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is buffer and group.joinChar is undefined","suites":["JOIN node"],"updatePoint":{"line":3250,"column":85,"index":75970},"line":3250,"code":"  it('should concat payload when group.type is buffer and group.joinChar is undefined', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.toString().should.equal(\"ABC\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 0,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 1,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 2,\n          count: 3\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is string and group.joinChar is not string","suites":["JOIN node"],"updatePoint":{"line":3304,"column":86,"index":77211},"line":3304,"code":"  it('should concat payload when group.type is string and group.joinChar is not string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.toString().should.equal(\"A0B0C\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 0,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 1,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 2,\n          count: 3\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle msg.parts property when mode is auto and parts or id are missing","suites":["JOIN node"],"updatePoint":{"line":3360,"column":84,"index":78491},"line":3360,"code":"  it('should handle msg.parts property when mode is auto and parts or id are missing', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle join an array when mode is auto and duplicate indexed parts arrive","suites":["JOIN node"],"updatePoint":{"line":3402,"column":86,"index":79461},"line":3402,"code":"  it('should handle join an array when mode is auto and duplicate indexed parts arrive', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload[0].should.equal(\"C\");\n          msg.payload[1].should.equal(\"D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle join an array when using msg.parts and duplicate indexed parts arrive and being reset halfway","suites":["JOIN node"],"updatePoint":{"line":3470,"column":113,"index":80926},"line":3470,"code":"  it('should handle join an array when using msg.parts and duplicate indexed parts arrive and being reset halfway', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload[0].should.equal(\"D\");\n          msg.payload[1].should.equal(\"C\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (string)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3596,"column":56,"index":84091},"line":3596,"code":"    it('should call done() when message is sent (string)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: \"12345\"\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (array)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3607,"column":55,"index":84364},"line":3607,"code":"    it('should call done() when message is sent (array)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: [0, 1, 2, 3, 4]\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (object)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3618,"column":56,"index":84646},"line":3618,"code":"    it('should call done() when message is sent (object)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: {\n            a: 1,\n            b: 2\n          }\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (string, len)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3632,"column":77,"index":84982},"line":3632,"code":"    it('should call done() when consolidated message is emitted (string, len)', function (done) {\n      mapiDoneSplitTestHelper(done, 5, \"len\", true, [{\n        msg: {\n          seq: 0,\n          payload: \"12\"\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"34\"\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"5\"\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, len)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3659,"column":77,"index":85542},"line":3659,"code":"    it('should call done() when consolidated message is emitted (Buffer, len)', function (done) {\n      mapiDoneSplitTestHelper(done, 5, \"len\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, str)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3686,"column":77,"index":86141},"line":3686,"code":"    it('should call done() when consolidated message is emitted (Buffer, str)', function (done) {\n      mapiDoneSplitTestHelper(done, \"5\", \"str\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, bin)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3713,"column":77,"index":86742},"line":3713,"code":"    it('should call done() when consolidated message is emitted (Buffer, bin)', function (done) {\n      mapiDoneSplitTestHelper(done, \"[53]\", \"bin\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when all messages are joined","suites":["JOIN node","messaging API"],"updatePoint":{"line":3792,"column":55,"index":88947},"line":3792,"code":"    it('should call done() when all messages are joined', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"auto\",\n        timeout: 1\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"C\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when the node is reset","suites":["JOIN node","messaging API"],"updatePoint":{"line":3843,"column":49,"index":89941},"line":3843,"code":"    it('should call done() when the node is reset', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"auto\",\n        timeout: 1\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"dummy\",\n          reset: true,\n          parts: {\n            id: 1\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when timed out","suites":["JOIN node","messaging API"],"updatePoint":{"line":3891,"column":41,"index":90861},"line":3891,"code":"    it('should call done() when timed out', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"custom\",\n        joiner: \",\",\n        build: \"string\",\n        timeout: 0.5\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\"\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\"\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when all messages are reduced","suites":["JOIN node","messaging API"],"updatePoint":{"line":3915,"column":56,"index":91350},"line":3915,"code":"    it('should call done() when all messages are reduced', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"reduce\",\n        reduceRight: false,\n        reduceExp: \"$A+payload\",\n        reduceInit: \"0\",\n        reduceInitType: \"num\",\n        reduceFixup: undefined\n      }, [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            index: 2,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            index: 1,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 4,\n          parts: {\n            index: 0,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow","suites":["JOIN node","messaging API"],"updatePoint":{"line":3964,"column":56,"index":92335},"line":3964,"code":"    it('should call done() regardless of buffer overflow', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"reduce\",\n        reduceRight: false,\n        reduceExp: \"$A+payload\",\n        reduceInit: \"0\",\n        reduceInitType: \"num\",\n        reduceFixup: undefined\n      }, [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            index: 2,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 0,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            index: 1,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 200,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 4,\n          parts: {\n            index: 0,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 400,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 3,\n          payload: 1,\n          parts: {\n            index: 3,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 600,\n        avr: 600,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle msg.parts even if messages are out of order in auto mode if exactly one message has count set","suites":["JOIN node","messaging API"],"updatePoint":{"line":4027,"column":113,"index":93610},"line":4027,"code":"  it('should handle msg.parts even if messages are out of order in auto mode if exactly one message has count set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.payload.length.should.be.eql(5);\n        msg.payload.should.be.eql([0, 1, 2, 3, 4]);\n        done();\n      });\n      var msg = {};\n      msg.parts = {\n        id: RED.util.generateId()\n      };\n\n      for (var elem = 1; elem < 5; ++elem) {\n        var _msg = RED.util.cloneMessage(msg);\n\n        _msg.parts.index = elem;\n\n        if (elem == 4) {\n          _msg.parts.count = 5;\n        }\n\n        _msg.payload = elem;\n        n1.receive(_msg);\n      }\n\n      var _msg = RED.util.cloneMessage(msg);\n\n      delete _msg.parts.count;\n      _msg.parts.index = 0;\n      _msg.payload = 0;\n      n1.receive(_msg);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["SORT node"],"updatePoint":{"line":50,"column":22,"index":1472},"line":50,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      name: \"SortNode\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'SortNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":216,"column":57,"index":5695},"line":216,"code":"    it('should sort payload (elem, not number, ascending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":219,"column":58,"index":5833},"line":219,"code":"    it('should sort msg prop (elem, not number, ascending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (not number, ascending)","suites":["SORT node"],"updatePoint":{"line":222,"column":65,"index":5978},"line":222,"code":"    it('should sort message group/payload (not number, ascending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (not number, ascending)","suites":["SORT node"],"updatePoint":{"line":225,"column":62,"index":6120},"line":225,"code":"    it('should sort message group/prop (not number, ascending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, not number, descending)","suites":["SORT node"],"updatePoint":{"line":243,"column":58,"index":6555},"line":243,"code":"    it('should sort payload (elem, not number, descending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, not number, descending)","suites":["SORT node"],"updatePoint":{"line":246,"column":59,"index":6694},"line":246,"code":"    it('should sort msg prop (elem, not number, descending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (not number, descending)","suites":["SORT node"],"updatePoint":{"line":249,"column":66,"index":6840},"line":249,"code":"    it('should sort message group/payload (not number, descending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (not number, descending)","suites":["SORT node"],"updatePoint":{"line":252,"column":63,"index":6983},"line":252,"code":"    it('should sort message group/prop (not number, descending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, number, ascending)","suites":["SORT node"],"updatePoint":{"line":270,"column":53,"index":7411},"line":270,"code":"    it('should sort payload (elem, number, ascending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, number, ascending)","suites":["SORT node"],"updatePoint":{"line":273,"column":54,"index":7545},"line":273,"code":"    it('should sort msg prop (elem, number, ascending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (number, ascending)","suites":["SORT node"],"updatePoint":{"line":276,"column":61,"index":7686},"line":276,"code":"    it('should sort message group/payload (number, ascending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (number, ascending)","suites":["SORT node"],"updatePoint":{"line":279,"column":58,"index":7824},"line":279,"code":"    it('should sort message group/prop (number, ascending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, number, descending)","suites":["SORT node"],"updatePoint":{"line":297,"column":54,"index":8254},"line":297,"code":"    it('should sort payload (elem, number, descending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, number, descending)","suites":["SORT node"],"updatePoint":{"line":300,"column":55,"index":8389},"line":300,"code":"    it('should sort msg prop (elem, number, descending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (number, descending)","suites":["SORT node"],"updatePoint":{"line":303,"column":62,"index":8531},"line":303,"code":"    it('should sort message group/payload (number, descending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (number, descending)","suites":["SORT node"],"updatePoint":{"line":306,"column":59,"index":8670},"line":306,"code":"    it('should sort message group/prop (number, descending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":324,"column":56,"index":9110},"line":324,"code":"    it('should sort payload (exp, not number, ascending)', function (done) {\n      check_sort0C(flow, \"$substring($,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":327,"column":62,"index":9271},"line":327,"code":"    it('should sort message group (exp, not number, ascending)', function (done) {\n      check_sort1C(flow, \"$substring(payload,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":345,"column":63,"index":9744},"line":345,"code":"    it('should sort message group (exp, not number, descending)', function (done) {\n      check_sort0C(flow, \"$substring($,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":348,"column":57,"index":9900},"line":348,"code":"    it('should sort payload (exp, not number, descending)', function (done) {\n      check_sort1C(flow, \"$substring(payload,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload of objects","suites":["SORT node"],"updatePoint":{"line":375,"column":38,"index":10478},"line":375,"code":"    it('should sort payload of objects', function (done) {\n      check_sort0C(flow, \"val\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload by context (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":380,"column":65,"index":10639},"line":380,"code":"  it('should sort payload by context (exp, not number, ascending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"msg\",\n      msgKey: \"$flowContext($)\",\n      msgKeyType: \"jsonata\",\n      order: \"ascending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"second\", \"third\", \"first\", \"fourth\"];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context()[\"flow\"].set(\"first\", \"3\");\n      n1.context()[\"flow\"].set(\"second\", \"1\");\n      n1.context()[\"flow\"].set(\"third\", \"2\");\n      n1.context()[\"flow\"].set(\"fourth\", \"4\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"data\");\n        var data = msg[\"data\"];\n        data.length.should.equal(data_out.length);\n\n        for (var i = 0; i < data_out.length; i++) {\n          data[i].should.equal(data_out[i]);\n        }\n\n        done();\n      });\n      var msg = {};\n      msg[\"data\"] = data_in;\n      n1.receive(msg);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group by context (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":425,"column":71,"index":11903},"line":425,"code":"  it('should sort message group by context (exp, not number, ascending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"seq\",\n      seqKey: \"$globalContext(payload)\",\n      seqKeyType: \"jsonata\",\n      order: \"ascending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"second\", \"fourth\", \"third\", \"first\"];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n1.context()[\"global\"].set(\"first\", \"4\");\n      n1.context()[\"global\"].set(\"second\", \"1\");\n      n1.context()[\"global\"].set(\"third\", \"3\");\n      n1.context()[\"global\"].set(\"fourth\", \"2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.should.have.property(\"parts\");\n          msg.parts.should.have.property(\"count\", data_out.length);\n          var data = msg[\"payload\"];\n          var index = data_out.indexOf(data);\n          msg.parts.should.have.property(\"index\", index);\n          count++;\n\n          if (count === data_out.length) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      var len = data_in.length;\n\n      for (var i = 0; i < len; i++) {\n        var parts = {\n          id: \"X\",\n          index: i,\n          count: len\n        };\n        var msg = {\n          parts: parts\n        };\n        msg[\"payload\"] = data_in[i];\n        n1.receive(msg);\n      }\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload by persistable context (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":488,"column":78,"index":13638},"line":488,"code":"  it('should sort payload by persistable context (exp, not number, descending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"msg\",\n      msgKey: \"$globalContext($,\\\"memory\\\")\",\n      msgKeyType: \"jsonata\",\n      order: \"descending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"fourth\", \"first\", \"third\", \"second\"];\n    helper.load(sortNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context()[\"global\"].set([\"first\", \"second\", \"third\", \"fourth\"], [\"3\", \"1\", \"2\", \"4\"], \"memory\", function () {\n          n2.on(\"input\", function (msg) {\n            msg.should.have.property(\"data\");\n            var data = msg[\"data\"];\n            data.length.should.equal(data_out.length);\n\n            for (var i = 0; i < data_out.length; i++) {\n              data[i].should.equal(data_out[i]);\n            }\n\n            done();\n          });\n          var msg = {};\n          msg[\"data\"] = data_in;\n          n1.receive(msg);\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group by persistable context (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":533,"column":84,"index":14970},"line":533,"code":"  it('should sort message group by persistable context (exp, not number, descending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"seq\",\n      seqKey: \"$flowContext(payload,\\\"memory\\\")\",\n      seqKeyType: \"jsonata\",\n      order: \"descending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"first\", \"third\", \"fourth\", \"second\"];\n    helper.load(sortNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n1.context()[\"flow\"].set([\"first\", \"second\", \"third\", \"fourth\"], [\"4\", \"1\", \"3\", \"2\"], \"memory\", function () {\n          n2.on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\");\n            msg.should.have.property(\"parts\");\n            msg.parts.should.have.property(\"count\", data_out.length);\n            var data = msg[\"payload\"];\n            var index = data_out.indexOf(data);\n            msg.parts.should.have.property(\"index\", index);\n            count++;\n\n            if (count === data_out.length) {\n              done();\n            }\n          });\n          var len = data_in.length;\n\n          for (var i = 0; i < len; i++) {\n            var parts = {\n              id: \"X\",\n              index: i,\n              count: len\n            };\n            var msg = {\n              parts: parts\n            };\n            msg[\"payload\"] = data_in[i];\n            n1.receive(msg);\n          }\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should handle JSONata script error","suites":["SORT node"],"updatePoint":{"line":592,"column":40,"index":16677},"line":592,"code":"  it('should handle JSONata script error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"$unknown()\",\n      seqKeyType: \"jsonata\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"sort\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"sort\");\n        evt.should.have.property('msg', \"sort.invalid-exp\");\n        done();\n      }, 150);\n      var msg0 = {\n        payload: \"A\",\n        parts: {\n          id: \"X\",\n          index: 0,\n          count: 2\n        }\n      };\n      var msg1 = {\n        payload: \"B\",\n        parts: {\n          id: \"X\",\n          index: 1,\n          count: 2\n        }\n      };\n      n1.receive(msg0);\n      n1.receive(msg1);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["SORT node"],"updatePoint":{"line":639,"column":45,"index":17814},"line":639,"code":"  it('should handle too many pending messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"payload\",\n      seqKeyType: \"msg\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"sort\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"sort\");\n        evt.should.have.property('msg', \"sort.too-many\");\n        done();\n      }, 150);\n\n      for (var i = 0; i < 4; i++) {\n        var msg = {\n          payload: \"V\" + i,\n          parts: {\n            id: \"X\",\n            index: i,\n            count: 4\n          }\n        };\n        n1.receive(msg);\n      }\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should clear pending messages on close","suites":["SORT node"],"updatePoint":{"line":681,"column":44,"index":18897},"line":681,"code":"  it('should clear pending messages on close', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"payload\",\n      seqKeyType: \"msg\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var msg = {\n        payload: 0,\n        parts: {\n          id: \"X\",\n          index: 0,\n          count: 2\n        }\n      };\n      n1.receive(msg);\n      setTimeout(function () {\n        n1.close().then(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"sort\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"sort\");\n          evt.should.have.property('msg', \"sort.clear\");\n          done();\n        });\n      }, 150);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (payload)","suites":["SORT node","messaging API"],"updatePoint":{"line":779,"column":57,"index":21723},"line":779,"code":"    it('should call done() when message is sent (payload)', function (done) {\n      mapiDoneTestHelper(done, \"msg\", [{\n        msg: {\n          seq: 0,\n          payload: [1, 3, 2]\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (sequence)","suites":["SORT node","messaging API"],"updatePoint":{"line":790,"column":58,"index":21986},"line":790,"code":"    it('should call done() when message is sent (sequence)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            id: \"A\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (same group)","suites":["SORT node","messaging API"],"updatePoint":{"line":819,"column":69,"index":22577},"line":819,"code":"    it('should call done() regardless of buffer overflow (same group)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 1,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 3,\n          parts: {\n            id: \"A\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 2,\n          parts: {\n            id: \"A\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (different group)","suites":["SORT node","messaging API"],"updatePoint":{"line":861,"column":74,"index":23404},"line":861,"code":"    it('should call done() regardless of buffer overflow (different group)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 1,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 3,\n          parts: {\n            id: \"B\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 500,\n        avr: 1200,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 5,\n          parts: {\n            id: \"C\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 1000,\n        avr: 1500,\n        var: 100\n      }, {\n        msg: {\n          seq: 3,\n          payload: 2,\n          parts: {\n            id: \"B\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1200,\n        avr: 1200,\n        var: 100\n      }, {\n        msg: {\n          seq: 4,\n          payload: 4,\n          parts: {\n            id: \"C\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1500,\n        avr: 1500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with defaults","suites":["BATCH node"],"updatePoint":{"line":36,"column":36,"index":1206},"line":36,"code":"  it('should be loaded with defaults', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"batch\",\n      name: \"BatchNode\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(batchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'BatchNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with count","suites":["BATCH node","mode: count"],"updatePoint":{"line":175,"column":37,"index":4362},"line":175,"code":"    it('should create seq. with count', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 2,\n        overlap: 0,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3], [4, 5]];\n      check_count(flow, results, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with count and overlap","suites":["BATCH node","mode: count"],"updatePoint":{"line":194,"column":49,"index":4838},"line":194,"code":"    it('should create seq. with count and overlap', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 3,\n        overlap: 2,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1, 2], [1, 2, 3], [2, 3, 4], [3, 4, 5]];\n      check_count(flow, results, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: count"],"updatePoint":{"line":213,"column":47,"index":5332},"line":213,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 5,\n        overlap: 0,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n\n        for (var i = 0; i < 3; i++) {\n          n1.receive({\n            payload: i\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: count"],"updatePoint":{"line":251,"column":27,"index":6391},"line":251,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 2,\n        overlap: 0,\n        interval: 0,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var results = [[0, 1], [4, 5]];\n        check_data(n1, n2, results, done);\n        n1.receive({\n          payload: 0\n        });\n        n1.receive({\n          payload: 1\n        });\n        n1.receive({\n          payload: 2\n        });\n        n1.receive({\n          payload: 3,\n          reset: true\n        });\n        n1.receive({\n          payload: 4\n        });\n        n1.receive({\n          payload: 5\n        });\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval","suites":["BATCH node","mode: interval"],"updatePoint":{"line":295,"column":40,"index":7387},"line":295,"code":"    it('should create seq. with interval', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3]];\n      check_interval(flow, results, 450, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval (in float)","suites":["BATCH node","mode: interval"],"updatePoint":{"line":314,"column":51,"index":7867},"line":314,"code":"    it('should create seq. with interval (in float)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 0.5,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3]];\n      check_interval(flow, results, 225, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval & not send empty seq","suites":["BATCH node","mode: interval"],"updatePoint":{"line":333,"column":61,"index":8359},"line":333,"code":"    it('should create seq. with interval & not send empty seq', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [// 1300, 2600, 3900, 5200,\n      [0], [1], [2], [3]];\n      check_interval(flow, results, 1300, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval & send empty seq","suites":["BATCH node","mode: interval"],"updatePoint":{"line":353,"column":57,"index":8883},"line":353,"code":"    it('should create seq. with interval & send empty seq', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: true,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [// 1300, 2600, 3900, 5200,\n      [null], [0], [1], [2], [null], [3]];\n      check_interval(flow, results, 1300, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: interval"],"updatePoint":{"line":373,"column":47,"index":9412},"line":373,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n\n        for (var i = 0; i < 3; i++) {\n          n1.receive({\n            payload: i\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: interval"],"updatePoint":{"line":411,"column":27,"index":10473},"line":411,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var results = [[0, 1], [4, 5]];\n        check_data(n1, n2, results, done);\n        delayed_send(n1, 0, 3, 400, function () {\n          setTimeout(function () {\n            n1.receive({\n              payload: \"3\",\n              reset: true\n            });\n            delayed_send(n1, 4, 7, 400);\n          }, 10);\n        });\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat two seq. (series)","suites":["BATCH node","mode: concat"],"updatePoint":{"line":445,"column":39,"index":11373},"line":445,"code":"    it('should concat two seq. (series)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1]];\n      var inputs = [[\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat two seq. (mixed)","suites":["BATCH node","mode: concat"],"updatePoint":{"line":469,"column":38,"index":11994},"line":469,"code":"    it('should concat two seq. (mixed)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1]];\n      var inputs = [[\"TA\", 2, 0, 2], [\"TB\", 0, 0, 2], [\"TA\", 3, 1, 2], [\"TB\", 1, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat three seq.","suites":["BATCH node","mode: concat"],"updatePoint":{"line":493,"column":32,"index":12609},"line":493,"code":"    it('should concat three seq.', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }, {\n          topic: \"TC\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1, 4]];\n      var inputs = [[\"TC\", 4, 0, 1], [\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat same seq.","suites":["BATCH node","mode: concat"],"updatePoint":{"line":519,"column":31,"index":13278},"line":519,"code":"    it('should concat same seq.', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TA\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[9, 8, 9, 8]];\n      var inputs = [[\"TA\", 9, 0, 2], [\"TA\", 8, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: concat"],"updatePoint":{"line":543,"column":47,"index":13874},"line":543,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n        var C = 3;\n\n        for (var i = 0; i < C; i++) {\n          var parts_a = {\n            index: i,\n            count: C,\n            id: \"A\"\n          };\n          var parts_b = {\n            index: i,\n            count: C,\n            id: \"B\"\n          };\n          n1.receive({\n            payload: i,\n            topic: \"TA\",\n            parts: parts_a\n          });\n          n1.receive({\n            payload: i,\n            topic: \"TB\",\n            parts: parts_b\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: concat"],"updatePoint":{"line":603,"column":27,"index":15392},"line":603,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n\n      try {\n        helper.load(batchNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          var results = [[2, 3, 0, 1]];\n          check_data(n1, n2, results, done);\n          var inputs0 = [[\"TB\", 0, 0, 2], [\"TA\", 1, 0, 2]];\n\n          for (var data of inputs0) {\n            var msg = {\n              topic: data[0],\n              payload: data[1],\n              parts: {\n                id: data[0],\n                index: data[2],\n                count: data[3]\n              }\n            };\n            n1.receive(msg);\n          }\n\n          n1.receive({\n            payload: undefined,\n            reset: true\n          });\n          var inputs1 = [[\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n\n          for (var data of inputs1) {\n            var msg = {\n              topic: data[0],\n              payload: data[1],\n              parts: {\n                id: data[0],\n                index: data[2],\n                count: data[3]\n              }\n            };\n            n1.receive(msg);\n          }\n        });\n      } catch (e) {\n        done(e);\n      }\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":730,"column":61,"index":18891},"line":730,"code":"    it('should call done() when message is sent (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":747,"column":51,"index":19248},"line":747,"code":"    it('should call done() when reset (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 200,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 200,\n        avr: 200,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":765,"column":70,"index":19653},"line":765,"code":"    it('should call done() regardless of buffer overflow (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 10, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 100,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 2\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":789,"column":64,"index":20143},"line":789,"code":"    it('should call done() when message is sent (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 2000,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 500,\n        avr: 2000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":806,"column":54,"index":20514},"line":806,"code":"    it('should call done() when reset (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 200,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 200,\n        avr: 200,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":824,"column":73,"index":20925},"line":824,"code":"    it('should call done() regardless of buffer overflow (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 100,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 2\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":848,"column":62,"index":21415},"line":848,"code":"    it('should call done() when message is sent (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 1,\n          parts: {\n            id: \"TA\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":877,"column":52,"index":22023},"line":877,"code":"    it('should call done() when reset (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":901,"column":71,"index":22553},"line":901,"code":"    it('should call done() regardless of buffer overflow (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["file Nodes","file out Node"],"updatePoint":{"line":68,"column":24,"index":2086},"line":68,"code":"    it('should be loaded', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        try {\n          var fileNode1 = helper.getNode(\"fileNode1\");\n          fileNode1.should.have.property('name', 'fileNode');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":87,"column":30,"index":2599},"line":87,"code":"    it('should write to a file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest);\n            f.should.have.length(4);\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"test\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file using RED.settings.fileWorkingDirectory","suites":["file Nodes","file out Node"],"updatePoint":{"line":119,"column":70,"index":3528},"line":119,"code":"    it('should write to a file using RED.settings.fileWorkingDirectory', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": relativePathToFile,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        RED.settings.fileWorkingDirectory = resourcesDir;\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest);\n            f.should.have.length(4);\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"test\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write multi-byte string to a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":152,"column":48,"index":4501},"line":152,"code":"    it('should write multi-byte string to a file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.have.length(2);\n            f.should.equal(\"\");\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file and add newline","suites":["file Nodes","file out Node"],"updatePoint":{"line":185,"column":47,"index":5448},"line":185,"code":"    it('should append to a file and add newline', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        var data = [\"test2\", true, 999, [2]];\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n\n            if (count === 3) {\n              var f = fs.readFileSync(fileToTest).toString();\n\n              if (os.type() !== \"Windows_NT\") {\n                f.should.have.length(19);\n                f.should.equal(\"test2\\ntrue\\n999\\n[2]\\n\");\n              } else {\n                f.should.have.length(23);\n                f.should.equal(\"test2\\r\\ntrue\\r\\n999\\r\\n[2]\\r\\n\");\n              }\n\n              done();\n            }\n\n            count++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test2\"\n        }); // string\n\n        setTimeout(function () {\n          n1.receive({\n            payload: true\n          }); // boolean\n        }, 30);\n        setTimeout(function () {\n          n1.receive({\n            payload: 999\n          }); // number\n        }, 60);\n        setTimeout(function () {\n          n1.receive({\n            payload: [2]\n          }); // object (array)\n        }, 90);\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file after it has been deleted ","suites":["file Nodes","file out Node"],"updatePoint":{"line":253,"column":58,"index":7241},"line":253,"code":"    it('should append to a file after it has been deleted ', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var data = [\"one\", \"two\", \"three\", \"four\"];\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n\n            try {\n              if (count === 1) {\n                // Check they got appended as expected\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"onetwo\"); // Delete the file\n\n                fs.unlinkSync(fileToTest);\n                setTimeout(function () {\n                  // Send two more messages to the file\n                  n1.receive({\n                    payload: \"three\"\n                  });\n                  n1.receive({\n                    payload: \"four\"\n                  });\n                }, wait);\n              }\n\n              if (count === 3) {\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"threefour\");\n                fs.unlinkSync(fileToTest);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n\n            count++;\n          } catch (e) {\n            done(e);\n          }\n        }); // Send two messages to the file\n\n        n1.receive({\n          payload: \"one\"\n        });\n        n1.receive({\n          payload: \"two\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file after it has been recreated ","suites":["file Nodes","file out Node"],"updatePoint":{"line":323,"column":60,"index":9207},"line":323,"code":"    it('should append to a file after it has been recreated ', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var data = [\"one\", \"two\", \"three\", \"four\"];\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n\n            if (count == 1) {\n              // Check they got appended as expected\n              var f = fs.readFileSync(fileToTest).toString();\n              f.should.equal(\"onetwo\");\n\n              if (os.type() === \"Windows_NT\") {\n                var dummyFile = path.join(resourcesDir, \"50-file-test-dummy.txt\");\n                fs.rename(fileToTest, dummyFile, function () {\n                  recreateTest(n1, dummyFile);\n                });\n              } else {\n                recreateTest(n1, fileToTest);\n              }\n            }\n\n            if (count == 3) {\n              // Check the file was updated\n              try {\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"threefour\");\n                fs.unlinkSync(fileToTest);\n                done();\n              } catch (err) {\n                done(err);\n              }\n            }\n          } catch (err) {\n            done(err);\n          }\n\n          count++;\n        }); // Send two messages to the file\n\n        n1.receive({\n          payload: \"one\"\n        });\n        n1.receive({\n          payload: \"two\"\n        });\n      });\n\n      function recreateTest(n1, fileToDelete) {\n        // Delete the file\n        fs.unlinkSync(fileToDelete); // Recreate it\n\n        fs.writeFileSync(fileToTest, \"\"); // Send two more messages to the file\n\n        n1.receive({\n          payload: \"three\"\n        });\n        n1.receive({\n          payload: \"four\"\n        });\n      }\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.filename if filename not set in node","suites":["file Nodes","file out Node"],"updatePoint":{"line":406,"column":59,"index":11529},"line":406,"code":"    it('should use msg.filename if filename not set in node', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"fine\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n\n            if (os.type() !== \"Windows_NT\") {\n              f.should.have.length(5);\n              f.should.equal(\"fine\\n\");\n            } else {\n              f.should.have.length(6);\n              f.should.equal(\"fine\\r\\n\");\n            }\n\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"fine\",\n          filename: fileToTest\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use msg._user_specified_filename set in nodes typedInput","suites":["file Nodes","file out Node"],"updatePoint":{"line":446,"column":71,"index":12698},"line":446,"code":"    it('should use msg._user_specified_filename set in nodes typedInput', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        filename: \"_user_specified_filename\",\n        filenameType: \"msg\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"typedInput\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n\n            if (os.type() !== \"Windows_NT\") {\n              f.should.equal(\"typedInput\\n\");\n            } else {\n              f.should.equal(\"typedInput\\r\\n\");\n            }\n\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"typedInput\",\n          _user_specified_filename: fileToTest\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use env.TEST_FILE set in nodes typedInput","suites":["file Nodes","file out Node"],"updatePoint":{"line":486,"column":56,"index":13889},"line":486,"code":"    it('should use env.TEST_FILE set in nodes typedInput', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        filename: \"TEST_FILE\",\n        filenameType: \"env\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"envTest\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n\n            if (os.type() !== \"Windows_NT\") {\n              f.should.equal(\"envTest\\n\");\n            } else {\n              f.should.equal(\"envTest\\r\\n\");\n            }\n\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"envTest\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should be able to delete the file","suites":["file Nodes","file out Node"],"updatePoint":{"line":525,"column":41,"index":14990},"line":525,"code":"    it('should be able to delete the file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": \"delete\",\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\"); //done();\n          } catch (e) {\n            e.code.should.equal(\"ENOENT\");\n            done();\n          }\n        });\n        n1.receive({\n          payload: \"fine\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should warn if filename not set","suites":["file Nodes","file out Node"],"updatePoint":{"line":555,"column":39,"index":15842},"line":555,"code":"    it('should warn if filename not set', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        n1.emit(\"input\", {\n          payload: \"nofile\"\n        });\n        setTimeout(function () {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\"); //done();\n          } catch (e) {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.equal(\"file.errors.nofilename\");\n            done();\n          }\n        }, wait);\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"ignore a missing payload","suites":["file Nodes","file out Node"],"updatePoint":{"line":585,"column":32,"index":16816},"line":585,"code":"    it('ignore a missing payload', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\"); //done();\n          } catch (e) {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(0);\n            done();\n          }\n        }, wait);\n        n1.emit(\"input\", {\n          topic: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to write to a ro file","suites":["file Nodes","file out Node"],"updatePoint":{"line":614,"column":41,"index":17685},"line":614,"code":"    it('should fail to write to a ro file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'createWriteStream').callsFake(function (arg1, arg2) {\n        var ws = {};\n\n        ws.on = function (e, d) {\n          throw \"Stub error message\";\n        };\n\n        ws.write = function (e, d) {};\n\n        return ws;\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Stub error message\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.createWriteStream.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to append to a ro file","suites":["file Nodes","file out Node"],"updatePoint":{"line":658,"column":42,"index":18983},"line":658,"code":"    it('should fail to append to a ro file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'createWriteStream').callsFake(function (arg1, arg2) {\n        var ws = {};\n\n        ws.on = function (e, d) {\n          throw \"Stub error message\";\n        };\n\n        ws.write = function (e, d) {};\n\n        return ws;\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Stub error message\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.createWriteStream.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should cope with failing to delete a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":702,"column":49,"index":20289},"line":702,"code":"    it('should cope with failing to delete a file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'unlink').callsFake(function (arg, arg2) {\n        arg2(new Error(\"Stub error message\"));\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": \"delete\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.deletefail\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.unlink.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to create a new directory if not asked to do so (append)","suites":["file Nodes","file out Node"],"updatePoint":{"line":738,"column":76,"index":21488},"line":738,"code":"    it('should fail to create a new directory if not asked to do so (append)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\"); //var spy = sinon.stub(fs, 'appendFile').callsFake(function(arg,arg2,arg3,arg4){ arg4(new Error(\"Stub error message\")); });\n\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.appendfail\");\n            done();\n          } catch (e) {\n            done(e);\n          } //finally { fs.appendFile.restore(); }\n\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should try to create a new directory if asked to do so (append)","suites":["file Nodes","file out Node"],"updatePoint":{"line":772,"column":71,"index":22750},"line":772,"code":"    it('should try to create a new directory if asked to do so (append)', function (done) {\n      // fs.writeFileSync of afterEach failed on Windows.\n      if (os.type() === \"Windows_NT\") {\n        done();\n        return;\n      } // Stub file write so we can make writes fail\n\n\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      var spy = sinon.stub(fs, \"ensureDir\").callsFake(function (arg1, arg2, arg3, arg4) {\n        arg2(null);\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": false,\n        \"createDir\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(0);\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.ensureDir.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to create a new directory if not asked to do so (overwrite)","suites":["file Nodes","file out Node"],"updatePoint":{"line":814,"column":79,"index":24048},"line":814,"code":"    it('should fail to create a new directory if not asked to do so (overwrite)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\"); //var spy = sinon.stub(fs, 'appendFile').callsFake(function(arg,arg2,arg3,arg4){ arg4(new Error(\"Stub error message\")); });\n\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": false,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.writefail\");\n            done();\n          } catch (e) {\n            done(e);\n          } //finally { fs.appendFile.restore(); }\n\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should try to create a new directory if asked to do so (overwrite)","suites":["file Nodes","file out Node"],"updatePoint":{"line":848,"column":74,"index":25312},"line":848,"code":"    it('should try to create a new directory if asked to do so (overwrite)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      var spy = sinon.stub(fs, \"ensureDir\").callsFake(function (arg1, arg2, arg3, arg4) {\n        arg2(null);\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            }); //console.log(logEvents);\n\n            logEvents.should.have.length(0);\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.ensureDir.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to multiple files","suites":["file Nodes","file out Node"],"updatePoint":{"line":884,"column":38,"index":26434},"line":884,"code":"    it('should write to multiple files', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      var tmp_path = path.join(resourcesDir, \"tmp\");\n      var len = 1024 * 1024 * 10;\n      var file_count = 5;\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            count++;\n\n            if (count == file_count) {\n              for (var i = 0; i < file_count; i++) {\n                var name = path.join(tmp_path, String(i));\n                var f = fs.readFileSync(name);\n                f.should.have.length(len);\n                f[0].should.have.equal(i);\n              }\n\n              fs.removeSync(tmp_path);\n              done();\n            }\n          } catch (e) {\n            try {\n              fs.removeSync(tmp_path);\n            } catch (e1) {}\n\n            done(e);\n          }\n        });\n\n        for (var i = 0; i < file_count; i++) {\n          var data = Buffer.alloc ? Buffer.alloc(len) : new Buffer(len);\n          data.fill(i);\n          var name = path.join(tmp_path, String(i));\n          var msg = {\n            payload: data,\n            filename: name\n          };\n          n1.receive(msg);\n        }\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to multiple files if node is closed","suites":["file Nodes","file out Node"],"updatePoint":{"line":940,"column":56,"index":28026},"line":940,"code":"    it('should write to multiple files if node is closed', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      var tmp_path = path.join(resourcesDir, \"tmp\");\n      var len = 1024 * 1024 * 10;\n      var file_count = 5;\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            count++;\n\n            if (count == file_count) {\n              for (var i = 0; i < file_count; i++) {\n                var name = path.join(tmp_path, String(i));\n                var f = fs.readFileSync(name);\n                f.should.have.length(len);\n                f[0].should.have.equal(i);\n              }\n\n              fs.removeSync(tmp_path);\n              done();\n            }\n          } catch (e) {\n            try {\n              fs.removeSync(tmp_path);\n            } catch (e1) {}\n\n            done(e);\n          }\n        });\n\n        for (var i = 0; i < file_count; i++) {\n          var data = Buffer.alloc ? Buffer.alloc(len) : new Buffer(len);\n          data.fill(i);\n          var name = path.join(tmp_path, String(i));\n          var msg = {\n            payload: data,\n            filename: name\n          };\n          n1.receive(msg);\n        }\n\n        n1.close();\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"none\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1034,"column":53,"index":30686},"line":1034,"code":"      it('should write to a file with \"none\" encoding', function (done) {\n        checkWriteWithEncoding(\"none\", \"test\", done);\n      }); // Native","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1038,"column":53,"index":30835},"line":1038,"code":"      it('should write to a file with \"utf8\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf8\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"ucs2\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1041,"column":53,"index":30971},"line":1041,"code":"      it('should write to a file with \"ucs2\" encoding', function (done) {\n        checkWriteWithEncoding(\"ucs2\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf-16le\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1044,"column":57,"index":31111},"line":1044,"code":"      it('should write to a file with \"utf-16le\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf-16le\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"binary\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1047,"column":55,"index":31253},"line":1047,"code":"      it('should write to a file with \"binary\" encoding', function (done) {\n        checkWriteWithEncoding(\"binary\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"base64\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1050,"column":55,"index":31395},"line":1050,"code":"      it('should write to a file with \"base64\" encoding', function (done) {\n        checkWriteWithEncoding(\"base64\", \"5pel5pys6KqeCg==\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"hex\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1053,"column":52,"index":31546},"line":1053,"code":"      it('should write to a file with \"hex\" encoding', function (done) {\n        checkWriteWithEncoding(\"hex\", \"deadbeef\", done);\n      }); // Unicode","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf-16be\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1057,"column":57,"index":31703},"line":1057,"code":"      it('should write to a file with \"utf-16be\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf-16be\", \"\", done);\n      }); // Japanese","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Shift_JIS\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1061,"column":58,"index":31861},"line":1061,"code":"      it('should write to a file with \"Shift_JIS\" encoding', function (done) {\n        checkWriteWithEncoding(\"Shift_JIS\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows-31j\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1064,"column":60,"index":32009},"line":1064,"code":"      it('should write to a file with \"Windows-31j\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows-31j\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows932\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1067,"column":59,"index":32158},"line":1067,"code":"      it('should write to a file with \"Windows932\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows932\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-JP\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1070,"column":55,"index":32302},"line":1070,"code":"      it('should write to a file with \"EUC-JP\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-JP\", \"\", done);\n      }); // following encoding tests should be more specific","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GB2312\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1075,"column":55,"index":32512},"line":1075,"code":"      it('should write to a file with \"GB2312\" encoding', function (done) {\n        checkWriteWithEncoding(\"GB2312\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GBK\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1078,"column":52,"index":32651},"line":1078,"code":"      it('should write to a file with \"GBK\" encoding', function (done) {\n        checkWriteWithEncoding(\"GBK\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GB18030\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1081,"column":56,"index":32791},"line":1081,"code":"      it('should write to a file with \"GB18030\" encoding', function (done) {\n        checkWriteWithEncoding(\"GB18030\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows936\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1084,"column":59,"index":32938},"line":1084,"code":"      it('should write to a file with \"Windows936\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows936\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-CN\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1087,"column":55,"index":33084},"line":1087,"code":"      it('should write to a file with \"EUC-CN\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-CN\", \"test\", done);\n      }); // Korean","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"KS_C_5601\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1091,"column":58,"index":33240},"line":1091,"code":"      it('should write to a file with \"KS_C_5601\" encoding', function (done) {\n        checkWriteWithEncoding(\"KS_C_5601\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows949\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1094,"column":59,"index":33389},"line":1094,"code":"      it('should write to a file with \"Windows949\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows949\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-KR\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1097,"column":55,"index":33535},"line":1097,"code":"      it('should write to a file with \"EUC-KR\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-KR\", \"test\", done);\n      }); // Taiwan/Hong Kong","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Big5\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1101,"column":53,"index":33696},"line":1101,"code":"      it('should write to a file with \"Big5\" encoding', function (done) {\n        checkWriteWithEncoding(\"Big5\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Big5-HKSCS\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1104,"column":59,"index":33840},"line":1104,"code":"      it('should write to a file with \"Big5-HKSCS\" encoding', function (done) {\n        checkWriteWithEncoding(\"Big5-HKSCS\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows950\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1107,"column":59,"index":33990},"line":1107,"code":"      it('should write to a file with \"Windows950\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows950\", \"test\", done);\n      }); // Windows","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp874\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1111,"column":54,"index":34147},"line":1111,"code":"      it('should write to a file with \"cp874\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp874\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1250\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1114,"column":55,"index":34288},"line":1114,"code":"      it('should write to a file with \"cp1250\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1250\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1251\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1117,"column":55,"index":34430},"line":1117,"code":"      it('should write to a file with \"cp1251\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1251\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1252\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1120,"column":55,"index":34572},"line":1120,"code":"      it('should write to a file with \"cp1252\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1252\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1253\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1123,"column":55,"index":34714},"line":1123,"code":"      it('should write to a file with \"cp1253\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1253\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1254\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1126,"column":55,"index":34856},"line":1126,"code":"      it('should write to a file with \"cp1254\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1254\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1255\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1129,"column":55,"index":34998},"line":1129,"code":"      it('should write to a file with \"cp1255\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1255\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1256\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1132,"column":55,"index":35140},"line":1132,"code":"      it('should write to a file with \"cp1256\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1256\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1257\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1135,"column":55,"index":35282},"line":1135,"code":"      it('should write to a file with \"cp1257\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1257\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1258\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1138,"column":55,"index":35424},"line":1138,"code":"      it('should write to a file with \"cp1258\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1258\", \"test\", done);\n      }); // IBM","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp437\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1142,"column":54,"index":35573},"line":1142,"code":"      it('should write to a file with \"cp437\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp437\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp737\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1145,"column":54,"index":35713},"line":1145,"code":"      it('should write to a file with \"cp737\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp737\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp775\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1148,"column":54,"index":35853},"line":1148,"code":"      it('should write to a file with \"cp775\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp775\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp808\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1151,"column":54,"index":35993},"line":1151,"code":"      it('should write to a file with \"cp808\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp808\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp850\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1154,"column":54,"index":36133},"line":1154,"code":"      it('should write to a file with \"cp850\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp850\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp852\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1157,"column":54,"index":36273},"line":1157,"code":"      it('should write to a file with \"cp852\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp852\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp855\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1160,"column":54,"index":36413},"line":1160,"code":"      it('should write to a file with \"cp855\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp855\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp856\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1163,"column":54,"index":36553},"line":1163,"code":"      it('should write to a file with \"cp856\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp856\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp857\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1166,"column":54,"index":36693},"line":1166,"code":"      it('should write to a file with \"cp857\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp857\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp858\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1169,"column":54,"index":36833},"line":1169,"code":"      it('should write to a file with \"cp858\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp858\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp860\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1172,"column":54,"index":36973},"line":1172,"code":"      it('should write to a file with \"cp860\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp860\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp861\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1175,"column":54,"index":37113},"line":1175,"code":"      it('should write to a file with \"cp861\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp861\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp866\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1178,"column":54,"index":37253},"line":1178,"code":"      it('should write to a file with \"cp866\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp866\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp869\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1181,"column":54,"index":37393},"line":1181,"code":"      it('should write to a file with \"cp869\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp869\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp922\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1184,"column":54,"index":37533},"line":1184,"code":"      it('should write to a file with \"cp922\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp922\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1046\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1187,"column":55,"index":37674},"line":1187,"code":"      it('should write to a file with \"cp1046\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1046\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1124\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1190,"column":55,"index":37816},"line":1190,"code":"      it('should write to a file with \"cp1124\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1124\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1125\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1193,"column":55,"index":37958},"line":1193,"code":"      it('should write to a file with \"cp1125\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1125\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1129\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1196,"column":55,"index":38100},"line":1196,"code":"      it('should write to a file with \"cp1129\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1129\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1133\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1199,"column":55,"index":38242},"line":1199,"code":"      it('should write to a file with \"cp1133\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1133\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1161\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1202,"column":55,"index":38384},"line":1202,"code":"      it('should write to a file with \"cp1161\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1161\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1162\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1205,"column":55,"index":38526},"line":1205,"code":"      it('should write to a file with \"cp1162\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1162\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1163\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1208,"column":55,"index":38668},"line":1208,"code":"      it('should write to a file with \"cp1163\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1163\", \"test\", done);\n      }); // Mac","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccroatian\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1212,"column":60,"index":38823},"line":1212,"code":"      it('should write to a file with \"maccroatian\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccroatian\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccyrillic\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1215,"column":60,"index":38975},"line":1215,"code":"      it('should write to a file with \"maccyrillic\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccyrillic\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macgreek\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1218,"column":57,"index":39124},"line":1218,"code":"      it('should write to a file with \"macgreek\" encoding', function (done) {\n        checkWriteWithEncoding(\"macgreek\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maciceland\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1221,"column":59,"index":39272},"line":1221,"code":"      it('should write to a file with \"maciceland\" encoding', function (done) {\n        checkWriteWithEncoding(\"maciceland\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macroman\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1224,"column":57,"index":39420},"line":1224,"code":"      it('should write to a file with \"macroman\" encoding', function (done) {\n        checkWriteWithEncoding(\"macroman\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macromania\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1227,"column":59,"index":39568},"line":1227,"code":"      it('should write to a file with \"macromania\" encoding', function (done) {\n        checkWriteWithEncoding(\"macromania\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macthai\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1230,"column":56,"index":39715},"line":1230,"code":"      it('should write to a file with \"macthai\" encoding', function (done) {\n        checkWriteWithEncoding(\"macthai\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macturkish\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1233,"column":59,"index":39862},"line":1233,"code":"      it('should write to a file with \"macturkish\" encoding', function (done) {\n        checkWriteWithEncoding(\"macturkish\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macukraine\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1236,"column":59,"index":40012},"line":1236,"code":"      it('should write to a file with \"macukraine\" encoding', function (done) {\n        checkWriteWithEncoding(\"macukraine\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccenteuro\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1239,"column":60,"index":40163},"line":1239,"code":"      it('should write to a file with \"maccenteuro\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccenteuro\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macintosh\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1242,"column":58,"index":40313},"line":1242,"code":"      it('should write to a file with \"macintosh\" encoding', function (done) {\n        checkWriteWithEncoding(\"macintosh\", \"test\", done);\n      }); // KOI8","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-r\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1246,"column":55,"index":40467},"line":1246,"code":"      it('should write to a file with \"koi8-r\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-r\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-u\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1249,"column":55,"index":40609},"line":1249,"code":"      it('should write to a file with \"koi8-u\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-u\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-ru\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1252,"column":56,"index":40752},"line":1252,"code":"      it('should write to a file with \"koi8-ru\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-ru\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-t\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1255,"column":55,"index":40895},"line":1255,"code":"      it('should write to a file with \"koi8-t\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-t\", \"test\", done);\n      }); // Misc","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"armscii8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1259,"column":57,"index":41048},"line":1259,"code":"      it('should write to a file with \"armscii8\" encoding', function (done) {\n        checkWriteWithEncoding(\"armscii8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"rk1048\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1262,"column":55,"index":41192},"line":1262,"code":"      it('should write to a file with \"rk1048\" encoding', function (done) {\n        checkWriteWithEncoding(\"rk1048\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"tcvn\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1265,"column":53,"index":41332},"line":1265,"code":"      it('should write to a file with \"tcvn\" encoding', function (done) {\n        checkWriteWithEncoding(\"tcvn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"georgianacademy\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1268,"column":64,"index":41481},"line":1268,"code":"      it('should write to a file with \"georgianacademy\" encoding', function (done) {\n        checkWriteWithEncoding(\"georgianacademy\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"georgianps\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1271,"column":59,"index":41636},"line":1271,"code":"      it('should write to a file with \"georgianps\" encoding', function (done) {\n        checkWriteWithEncoding(\"georgianps\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"pt154\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1274,"column":54,"index":41781},"line":1274,"code":"      it('should write to a file with \"pt154\" encoding', function (done) {\n        checkWriteWithEncoding(\"pt154\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"viscii\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1277,"column":55,"index":41922},"line":1277,"code":"      it('should write to a file with \"viscii\" encoding', function (done) {\n        checkWriteWithEncoding(\"viscii\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"iso646cn\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1280,"column":57,"index":42066},"line":1280,"code":"      it('should write to a file with \"iso646cn\" encoding', function (done) {\n        checkWriteWithEncoding(\"iso646cn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"iso646jp\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1283,"column":57,"index":42212},"line":1283,"code":"      it('should write to a file with \"iso646jp\" encoding', function (done) {\n        checkWriteWithEncoding(\"iso646jp\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"hproman8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1286,"column":57,"index":42358},"line":1286,"code":"      it('should write to a file with \"hproman8\" encoding', function (done) {\n        checkWriteWithEncoding(\"hproman8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"tis620\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1289,"column":55,"index":42502},"line":1289,"code":"      it('should write to a file with \"tis620\" encoding', function (done) {\n        checkWriteWithEncoding(\"tis620\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["file Nodes","file in Node"],"updatePoint":{"line":1311,"column":24,"index":43329},"line":1311,"code":"    it('should be loaded', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"utf8\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        n1.should.have.property('name', 'fileInNode');\n        done();\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a buffer","suites":["file Nodes","file in Node"],"updatePoint":{"line":1325,"column":49,"index":43751},"line":1325,"code":"    it('should read in a file and output a buffer', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload');\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.should.have.length(40);\n          msg.payload.toString().should.equal('File message line 1\\nFile message line 2\\n');\n          done();\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a utf8 string","suites":["file Nodes","file in Node"],"updatePoint":{"line":1352,"column":54,"index":44587},"line":1352,"code":"    it('should read in a file and output a utf8 string', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file using fileWorkingDirectory to set cwd","suites":["file Nodes","file in Node"],"updatePoint":{"line":1383,"column":67,"index":45503},"line":1383,"code":"    it('should read in a file using fileWorkingDirectory to set cwd', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": relativePathToFile,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        RED.settings.fileWorkingDirectory = resourcesDir;\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file ending in cr and output a utf8 string","suites":["file Nodes","file in Node"],"updatePoint":{"line":1415,"column":67,"index":46485},"line":1415,"code":"    it('should read in a file ending in cr and output a utf8 string', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest2,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output split lines with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1446,"column":63,"index":47398},"line":1446,"code":"    it('should read in a file and output split lines with parts', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.should.have.property('topic');\n            msg.should.not.have.property('foo');\n            msg.should.not.have.property('bar');\n            msg.payload.should.be.a.String();\n            msg.should.have.property('parts');\n            msg.parts.should.have.property('index', c);\n            msg.parts.should.have.property('type', 'string');\n            msg.parts.should.have.property('ch', '\\n');\n\n            if (c === 0) {\n              msg.payload.should.equal(\"File message line 1\");\n            }\n\n            if (c === 1) {\n              msg.payload.should.equal(\"File message line 2\");\n            }\n\n            if (c === 2) {\n              msg.payload.should.equal(\"\");\n              done();\n            }\n\n            c++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\",\n          topic: \"A\",\n          foo: \"bar\",\n          bar: \"foo\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with empty line and output split lines with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1500,"column":79,"index":48954},"line":1500,"code":"    it('should read in a file with empty line and output split lines with parts', function (done) {\n      var data = [\"-\", \"\", \"-\", \"\"];\n      var line = data.join(\"\\n\");\n      fs.writeFileSync(fileToTest, line);\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(data[c]);\n            msg.should.have.property('parts');\n            var parts = msg.parts;\n            parts.should.have.property('index', c);\n            parts.should.have.property('type', 'string');\n            parts.should.have.property('ch', '\\n');\n            c++;\n\n            if (c === data.length) {\n              parts.should.have.property('count', data.length);\n              done();\n            } else {\n              parts.should.not.have.property('count');\n            }\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output split lines with parts and extra props","suites":["file Nodes","file in Node"],"updatePoint":{"line":1545,"column":79,"index":50331},"line":1545,"code":"    it('should read in a file and output split lines with parts and extra props', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        allProps: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          // console.log(msg)\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.should.have.property('topic');\n            msg.should.have.property('foo');\n            msg.should.have.property('bar');\n            msg.should.have.property('parts');\n            msg.parts.should.have.property('index', c);\n            msg.parts.should.have.property('type', 'string');\n            msg.parts.should.have.property('ch', '\\n');\n\n            if (c === 0) {\n              msg.payload.should.equal(\"File message line 1\");\n            }\n\n            if (c === 1) {\n              msg.payload.should.equal(\"File message line 2\");\n            }\n\n            if (c === 2) {\n              msg.payload.should.equal(\"\");\n              done();\n            }\n\n            c++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\",\n          topic: \"B\",\n          foo: \"bar\",\n          bar: \"foo\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a buffer with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1601,"column":60,"index":51914},"line":1601,"code":"    it('should read in a file and output a buffer with parts', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"stream\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload');\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.should.have.length(40);\n          msg.should.have.property('parts');\n          msg.parts.should.have.property('count', 1);\n          msg.parts.should.have.property('type', 'buffer');\n          msg.parts.should.have.property('ch', '');\n          done();\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should warn if no filename set","suites":["file Nodes","file in Node"],"updatePoint":{"line":1631,"column":38,"index":52854},"line":1631,"code":"    it('should warn if no filename set', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"format\": \"\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"file in\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.equal(\"file.errors.nofilename\");\n          done();\n        }, wait);\n        n1.receive({});\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should handle a file read error","suites":["file Nodes","file in Node"],"updatePoint":{"line":1652,"column":39,"index":53560},"line":1652,"code":"    it('should handle a file read error', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": \"badfile\",\n        \"format\": \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('payload');\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"code\", \"ENOENT\");\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file in\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Error\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"none\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1723,"column":52,"index":55685},"line":1723,"code":"      it('should read in a file with \"none\" encoding', function (done) {\n        checkReadWithEncoding(\"none\", \"\", done);\n      }); // Native","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1727,"column":52,"index":55830},"line":1727,"code":"      it('should read in a file with \"utf8\" encoding', function (done) {\n        checkReadWithEncoding(\"utf8\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"ucs2\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1730,"column":52,"index":55964},"line":1730,"code":"      it('should read in a file with \"ucs2\" encoding', function (done) {\n        checkReadWithEncoding(\"ucs2\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf-16le\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1733,"column":56,"index":56102},"line":1733,"code":"      it('should read in a file with \"utf-16le\" encoding', function (done) {\n        checkReadWithEncoding(\"utf-16le\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"binary\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1736,"column":54,"index":56242},"line":1736,"code":"      it('should read in a file with \"binary\" encoding', function (done) {\n        checkReadWithEncoding(\"binary\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"base64\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1739,"column":54,"index":56382},"line":1739,"code":"      it('should read in a file with \"base64\" encoding', function (done) {\n        checkReadWithEncoding(\"base64\", \"5pel5pys6KqeCg==\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"hex\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1742,"column":51,"index":56531},"line":1742,"code":"      it('should read in a file with \"hex\" encoding', function (done) {\n        checkReadWithEncoding(\"hex\", \"deadbeef\", done);\n      }); // Unicode","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf-16be\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1746,"column":56,"index":56686},"line":1746,"code":"      it('should read in a file with \"utf-16be\" encoding', function (done) {\n        checkReadWithEncoding(\"utf-16be\", \"\", done);\n      }); // Japanese","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Shift_JIS\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1750,"column":57,"index":56842},"line":1750,"code":"      it('should read in a file with \"Shift_JIS\" encoding', function (done) {\n        checkReadWithEncoding(\"Shift_JIS\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows-31j\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1753,"column":59,"index":56988},"line":1753,"code":"      it('should read in a file with \"Windows-31j\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows-31j\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows932\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1756,"column":58,"index":57135},"line":1756,"code":"      it('should read in a file with \"Windows932\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows932\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-JP\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1759,"column":54,"index":57277},"line":1759,"code":"      it('should read in a file with \"EUC-JP\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-JP\", \"\", done);\n      }); // following encoding tests should be more specific","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GB2312\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1764,"column":54,"index":57485},"line":1764,"code":"      it('should read in a file with \"GB2312\" encoding', function (done) {\n        checkReadWithEncoding(\"GB2312\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GBK\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1767,"column":51,"index":57622},"line":1767,"code":"      it('should read in a file with \"GBK\" encoding', function (done) {\n        checkReadWithEncoding(\"GBK\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GB18030\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1770,"column":55,"index":57760},"line":1770,"code":"      it('should read in a file with \"GB18030\" encoding', function (done) {\n        checkReadWithEncoding(\"GB18030\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows936\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1773,"column":58,"index":57905},"line":1773,"code":"      it('should read in a file with \"Windows936\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows936\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-CN\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1776,"column":54,"index":58049},"line":1776,"code":"      it('should read in a file with \"EUC-CN\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-CN\", \"test\", done);\n      }); // Korean","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"KS_C_5601\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1780,"column":57,"index":58203},"line":1780,"code":"      it('should read in a file with \"KS_C_5601\" encoding', function (done) {\n        checkReadWithEncoding(\"KS_C_5601\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows949\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1783,"column":58,"index":58350},"line":1783,"code":"      it('should read in a file with \"Windows949\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows949\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-KR\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1786,"column":54,"index":58494},"line":1786,"code":"      it('should read in a file with \"EUC-KR\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-KR\", \"test\", done);\n      }); // Taiwan/Hong Kong","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Big5\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1790,"column":52,"index":58653},"line":1790,"code":"      it('should read in a file with \"Big5\" encoding', function (done) {\n        checkReadWithEncoding(\"Big5\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Big5-HKSCS\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1793,"column":58,"index":58795},"line":1793,"code":"      it('should read in a file with \"Big5-HKSCS\" encoding', function (done) {\n        checkReadWithEncoding(\"Big5-HKSCS\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows950\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1796,"column":58,"index":58943},"line":1796,"code":"      it('should read in a file with \"Windows950\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows950\", \"test\", done);\n      }); // Windows","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp874\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1800,"column":53,"index":59098},"line":1800,"code":"      it('should read in a file with \"cp874\" encoding', function (done) {\n        checkReadWithEncoding(\"cp874\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1250\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1803,"column":54,"index":59237},"line":1803,"code":"      it('should read in a file with \"cp1250\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1250\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1251\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1806,"column":54,"index":59377},"line":1806,"code":"      it('should read in a file with \"cp1251\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1251\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1252\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1809,"column":54,"index":59517},"line":1809,"code":"      it('should read in a file with \"cp1252\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1252\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1253\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1812,"column":54,"index":59657},"line":1812,"code":"      it('should read in a file with \"cp1253\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1253\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1254\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1815,"column":54,"index":59797},"line":1815,"code":"      it('should read in a file with \"cp1254\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1254\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1255\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1818,"column":54,"index":59937},"line":1818,"code":"      it('should read in a file with \"cp1255\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1255\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1256\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1821,"column":54,"index":60077},"line":1821,"code":"      it('should read in a file with \"cp1256\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1256\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1257\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1824,"column":54,"index":60217},"line":1824,"code":"      it('should read in a file with \"cp1257\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1257\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1258\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1827,"column":54,"index":60357},"line":1827,"code":"      it('should read in a file with \"cp1258\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1258\", \"test\", done);\n      }); // IBM","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp437\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1831,"column":53,"index":60504},"line":1831,"code":"      it('should read in a file with \"cp437\" encoding', function (done) {\n        checkReadWithEncoding(\"cp437\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp737\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1834,"column":53,"index":60642},"line":1834,"code":"      it('should read in a file with \"cp737\" encoding', function (done) {\n        checkReadWithEncoding(\"cp737\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp775\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1837,"column":53,"index":60780},"line":1837,"code":"      it('should read in a file with \"cp775\" encoding', function (done) {\n        checkReadWithEncoding(\"cp775\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp808\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1840,"column":53,"index":60918},"line":1840,"code":"      it('should read in a file with \"cp808\" encoding', function (done) {\n        checkReadWithEncoding(\"cp808\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp850\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1843,"column":53,"index":61056},"line":1843,"code":"      it('should read in a file with \"cp850\" encoding', function (done) {\n        checkReadWithEncoding(\"cp850\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp852\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1846,"column":53,"index":61194},"line":1846,"code":"      it('should read in a file with \"cp852\" encoding', function (done) {\n        checkReadWithEncoding(\"cp852\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp855\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1849,"column":53,"index":61332},"line":1849,"code":"      it('should read in a file with \"cp855\" encoding', function (done) {\n        checkReadWithEncoding(\"cp855\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp856\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1852,"column":53,"index":61470},"line":1852,"code":"      it('should read in a file with \"cp856\" encoding', function (done) {\n        checkReadWithEncoding(\"cp856\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp857\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1855,"column":53,"index":61608},"line":1855,"code":"      it('should read in a file with \"cp857\" encoding', function (done) {\n        checkReadWithEncoding(\"cp857\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp858\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1858,"column":53,"index":61746},"line":1858,"code":"      it('should read in a file with \"cp858\" encoding', function (done) {\n        checkReadWithEncoding(\"cp858\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp860\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1861,"column":53,"index":61884},"line":1861,"code":"      it('should read in a file with \"cp860\" encoding', function (done) {\n        checkReadWithEncoding(\"cp860\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp861\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1864,"column":53,"index":62022},"line":1864,"code":"      it('should read in a file with \"cp861\" encoding', function (done) {\n        checkReadWithEncoding(\"cp861\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp866\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1867,"column":53,"index":62160},"line":1867,"code":"      it('should read in a file with \"cp866\" encoding', function (done) {\n        checkReadWithEncoding(\"cp866\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp869\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1870,"column":53,"index":62298},"line":1870,"code":"      it('should read in a file with \"cp869\" encoding', function (done) {\n        checkReadWithEncoding(\"cp869\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp922\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1873,"column":53,"index":62436},"line":1873,"code":"      it('should read in a file with \"cp922\" encoding', function (done) {\n        checkReadWithEncoding(\"cp922\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1046\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1876,"column":54,"index":62575},"line":1876,"code":"      it('should read in a file with \"cp1046\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1046\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1124\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1879,"column":54,"index":62715},"line":1879,"code":"      it('should read in a file with \"cp1124\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1124\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1125\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1882,"column":54,"index":62855},"line":1882,"code":"      it('should read in a file with \"cp1125\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1125\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1129\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1885,"column":54,"index":62995},"line":1885,"code":"      it('should read in a file with \"cp1129\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1129\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1133\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1888,"column":54,"index":63135},"line":1888,"code":"      it('should read in a file with \"cp1133\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1133\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1161\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1891,"column":54,"index":63275},"line":1891,"code":"      it('should read in a file with \"cp1161\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1161\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1162\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1894,"column":54,"index":63415},"line":1894,"code":"      it('should read in a file with \"cp1162\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1162\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1163\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1897,"column":54,"index":63555},"line":1897,"code":"      it('should read in a file with \"cp1163\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1163\", \"test\", done);\n      }); // Mac","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccroatian\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1901,"column":59,"index":63708},"line":1901,"code":"      it('should read in a file with \"maccroatian\" encoding', function (done) {\n        checkReadWithEncoding(\"maccroatian\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccyrillic\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1904,"column":59,"index":63858},"line":1904,"code":"      it('should read in a file with \"maccyrillic\" encoding', function (done) {\n        checkReadWithEncoding(\"maccyrillic\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macgreek\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1907,"column":56,"index":64005},"line":1907,"code":"      it('should read in a file with \"macgreek\" encoding', function (done) {\n        checkReadWithEncoding(\"macgreek\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maciceland\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1910,"column":58,"index":64151},"line":1910,"code":"      it('should read in a file with \"maciceland\" encoding', function (done) {\n        checkReadWithEncoding(\"maciceland\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macroman\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1913,"column":56,"index":64297},"line":1913,"code":"      it('should read in a file with \"macroman\" encoding', function (done) {\n        checkReadWithEncoding(\"macroman\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macromania\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1916,"column":58,"index":64443},"line":1916,"code":"      it('should read in a file with \"macromania\" encoding', function (done) {\n        checkReadWithEncoding(\"macromania\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macthai\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1919,"column":55,"index":64588},"line":1919,"code":"      it('should read in a file with \"macthai\" encoding', function (done) {\n        checkReadWithEncoding(\"macthai\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macturkish\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1922,"column":58,"index":64733},"line":1922,"code":"      it('should read in a file with \"macturkish\" encoding', function (done) {\n        checkReadWithEncoding(\"macturkish\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macukraine\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1925,"column":58,"index":64881},"line":1925,"code":"      it('should read in a file with \"macukraine\" encoding', function (done) {\n        checkReadWithEncoding(\"macukraine\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccenteuro\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1928,"column":59,"index":65030},"line":1928,"code":"      it('should read in a file with \"maccenteuro\" encoding', function (done) {\n        checkReadWithEncoding(\"maccenteuro\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macintosh\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1931,"column":57,"index":65178},"line":1931,"code":"      it('should read in a file with \"macintosh\" encoding', function (done) {\n        checkReadWithEncoding(\"macintosh\", \"test\", done);\n      }); // KOI8","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-r\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1935,"column":54,"index":65330},"line":1935,"code":"      it('should read in a file with \"koi8-r\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-r\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-u\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1938,"column":54,"index":65470},"line":1938,"code":"      it('should read in a file with \"koi8-u\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-u\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-ru\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1941,"column":55,"index":65611},"line":1941,"code":"      it('should read in a file with \"koi8-ru\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-ru\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-t\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1944,"column":54,"index":65752},"line":1944,"code":"      it('should read in a file with \"koi8-t\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-t\", \"test\", done);\n      }); // Misc","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"armscii8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1948,"column":56,"index":65903},"line":1948,"code":"      it('should read in a file with \"armscii8\" encoding', function (done) {\n        checkReadWithEncoding(\"armscii8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"rk1048\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1951,"column":54,"index":66045},"line":1951,"code":"      it('should read in a file with \"rk1048\" encoding', function (done) {\n        checkReadWithEncoding(\"rk1048\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"tcvn\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1954,"column":52,"index":66183},"line":1954,"code":"      it('should read in a file with \"tcvn\" encoding', function (done) {\n        checkReadWithEncoding(\"tcvn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"georgianacademy\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1957,"column":63,"index":66330},"line":1957,"code":"      it('should read in a file with \"georgianacademy\" encoding', function (done) {\n        checkReadWithEncoding(\"georgianacademy\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"georgianps\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1960,"column":58,"index":66483},"line":1960,"code":"      it('should read in a file with \"georgianps\" encoding', function (done) {\n        checkReadWithEncoding(\"georgianps\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"pt154\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1963,"column":53,"index":66626},"line":1963,"code":"      it('should read in a file with \"pt154\" encoding', function (done) {\n        checkReadWithEncoding(\"pt154\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"viscii\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1966,"column":54,"index":66765},"line":1966,"code":"      it('should read in a file with \"viscii\" encoding', function (done) {\n        checkReadWithEncoding(\"viscii\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"iso646cn\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1969,"column":56,"index":66907},"line":1969,"code":"      it('should read in a file with \"iso646cn\" encoding', function (done) {\n        checkReadWithEncoding(\"iso646cn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"iso646jp\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1972,"column":56,"index":67051},"line":1972,"code":"      it('should read in a file with \"iso646jp\" encoding', function (done) {\n        checkReadWithEncoding(\"iso646jp\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"hproman8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1975,"column":56,"index":67195},"line":1975,"code":"      it('should read in a file with \"hproman8\" encoding', function (done) {\n        checkReadWithEncoding(\"hproman8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"tis620\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1978,"column":54,"index":67337},"line":1978,"code":"      it('should read in a file with \"tis620\" encoding', function (done) {\n        checkReadWithEncoding(\"tis620\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should watch a file to be changed","suites":["watch Node"],"updatePoint":{"line":113,"column":39,"index":3175},"line":113,"code":"  it('should watch a file to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file',\n        'size': 5\n      }\n    };\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch multiple files to be changed","suites":["watch Node"],"updatePoint":{"line":139,"column":47,"index":3819},"line":139,"code":"  it('should watch multiple files to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    fs.writeFileSync(files.file1ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch + \",\" + files.file1ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 5\n\n      },\n      'file1.txt': {\n        'payload': files.file1ToWatch,\n        'topic': files.file1ToWatch,\n        'type': 'file' //,\n        // 'size': 3\n\n      }\n    };\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n      fs.appendFileSync(files.file1ToWatch, \"123\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch attribute of a file to be changed","suites":["watch Node"],"updatePoint":{"line":175,"column":52,"index":4755},"line":175,"code":"  it('should watch attribute of a file to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    fs.chmodSync(files.file0ToWatch, 0o444);\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 0\n\n      }\n    };\n    testWatch(flow, function () {\n      fs.chmodSync(files.file0ToWatch, 0o777);\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch a file in a directory to be changed","suites":["watch Node"],"updatePoint":{"line":203,"column":54,"index":5451},"line":203,"code":"  it('should watch a file in a directory to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.dirToWatch,\n      recursive: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 5\n\n      }\n    };\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch a sub directory in a directory to be changed","suites":["watch Node"],"updatePoint":{"line":230,"column":63,"index":6115},"line":230,"code":"  it('should watch a sub directory in a directory to be changed', function (done) {\n    var files = prepareDir();\n    fs.mkdirSync(files.subDirToWatch);\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.dirToWatch,\n      recursive: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file2.txt': {\n        payload: files.file2ToWatch,\n        type: 'file' //,\n        // size: 5\n\n      }\n    };\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file2ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should define subflow","suites":["subflow"],"updatePoint":{"line":34,"column":27,"index":1122},"line":34,"code":"  it('should define subflow', function (done) {\n    var flow = [{\n      id: \"t1\",\n      type: \"tab\"\n    }, {\n      id: \"n1\",\n      z: \"t1\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      done();\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should pass data to/from subflow","suites":["subflow"],"updatePoint":{"line":76,"column":38,"index":1864},"line":76,"code":"  it('should pass data to/from subflow', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = msg.payload+'bar'; return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"foobar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should pass data to/from nested subflow","suites":["subflow"],"updatePoint":{"line":139,"column":45,"index":3071},"line":139,"code":"  it('should pass data to/from nested subflow', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = msg.payload+'baz'; return msg;\",\n      wires: []\n    }, // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.payload=msg.payload+'bar'; return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"foobarbaz\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of subflow template","suites":["subflow"],"updatePoint":{"line":238,"column":47,"index":4903},"line":238,"code":"  it('should access env var of subflow template', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of subflow instance","suites":["subflow"],"updatePoint":{"line":311,"column":47,"index":6268},"line":311,"code":"  it('should access env var of subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access last env var with same name","suites":["subflow"],"updatePoint":{"line":384,"column":47,"index":7633},"line":384,"code":"  it('should access last env var with same name', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V0\"\n      }, {\n        name: \"X\",\n        type: \"str\",\n        value: \"VX\"\n      }, {\n        name: \"K\",\n        type: \"str\",\n        value: \"V1\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V1\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access typed value of env var","suites":["subflow"],"updatePoint":{"line":465,"column":42,"index":9137},"line":465,"code":"  it('should access typed value of env var', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"KN\",\n        type: \"num\",\n        value: \"100\"\n      }, {\n        name: \"KB\",\n        type: \"bool\",\n        value: \"true\"\n      }, {\n        name: \"KJ\",\n        type: \"json\",\n        value: \"[1,2,3]\"\n      }, {\n        name: \"Kb\",\n        type: \"bin\",\n        value: \"[65,65]\"\n      }, {\n        name: \"Ke\",\n        type: \"env\",\n        value: \"KS\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }],\n      env: [{\n        name: \"KS\",\n        type: \"str\",\n        value: \"STR\"\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.VE = env.get('Ke'); msg.VS = env.get('KS'); msg.VN = env.get('KN'); msg.VB = env.get('KB'); msg.VJ = env.get('KJ'); msg.Vb = env.get('Kb'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"VS\", \"STR\");\n          msg.should.have.property(\"VN\", 100);\n          msg.should.have.property(\"VB\", true);\n          msg.should.have.property(\"VJ\", [1, 2, 3]);\n          msg.should.have.property(\"Vb\");\n          should.ok(msg.Vb instanceof Buffer);\n          msg.should.have.property(\"VE\", \"STR\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should overwrite env var of subflow template by env var of subflow instance","suites":["subflow"],"updatePoint":{"line":564,"column":81,"index":11312},"line":564,"code":"  it('should overwrite env var of subflow template by env var of subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"TV\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of parent subflow template","suites":["subflow"],"updatePoint":{"line":642,"column":54,"index":12768},"line":642,"code":"  it('should access env var of parent subflow template', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    }, // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"V\", \"V\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of parent subflow instance","suites":["subflow"],"updatePoint":{"line":746,"column":54,"index":14634},"line":746,"code":"  it('should access env var of parent subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    }, // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"V\", \"V\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of tab","suites":["subflow"],"updatePoint":{"line":850,"column":34,"index":16480},"line":850,"code":"  it('should access env var of tab', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of group","suites":["subflow"],"updatePoint":{"line":924,"column":36,"index":17849},"line":924,"code":"  it('should access env var of group', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"g1\",\n      z: \"t0\",\n      type: \"group\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      g: \"g1\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of nested group","suites":["subflow"],"updatePoint":{"line":1003,"column":43,"index":19300},"line":1003,"code":"  it('should access env var of nested group', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"g1\",\n      z: \"t0\",\n      type: \"group\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"g2\",\n      z: \"t0\",\n      g: \"g1\",\n      type: \"group\",\n      env: []\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      g: \"g2\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access NR_NODE_PATH env var within subflow instance","suites":["subflow"],"updatePoint":{"line":1088,"column":64,"index":20862},"line":1088,"code":"  it('should access NR_NODE_PATH env var within subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    }, // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = env.get('NR_NODE_PATH'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"t0/n1/s1-n1\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"is checking if all .js files have a corresponding _spec.js test file.","suites":["_spec.js"],"updatePoint":{"line":79,"column":75,"index":2767},"line":79,"code":"  it('is checking if all .js files have a corresponding _spec.js test file.', function (done) {\n    walkDirectory(jsdir).then(function (errors) {\n      if (errors.length > 0) {\n        var error = new Error(\"Missing/empty _spec files:\\n\\t\" + errors.join(\"\\n\\t\"));\n        done(error);\n      } else {\n        done();\n      }\n    });\n  });","file":"unit/_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get global contexts","suites":["api/admin/context","get"],"updatePoint":{"line":86,"column":59,"index":2268},"line":86,"code":"    it('should call context.getValue to get global contexts', function (done) {\n      stub.returns(Promise.resolve(gContext));\n      request(app).get('/context/global').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'global');\n        stub.args[0][0].should.have.property('id', undefined);\n        stub.args[0][0].should.have.property('key', undefined);\n        stub.args[0][0].should.have.property('store', undefined);\n        var body = res.body;\n        body.should.eql(gContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get flow contexts","suites":["api/admin/context","get"],"updatePoint":{"line":103,"column":57,"index":2986},"line":103,"code":"    it('should call context.getValue to get flow contexts', function (done) {\n      stub.returns(Promise.resolve(fContext));\n      request(app).get('/context/flow/1234/').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'flow');\n        stub.args[0][0].should.have.property('id', '1234');\n        stub.args[0][0].should.have.property('key', undefined);\n        stub.args[0][0].should.have.property('store', undefined);\n        var body = res.body;\n        body.should.eql(fContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get a node context","suites":["api/admin/context","get"],"updatePoint":{"line":120,"column":58,"index":3704},"line":120,"code":"    it('should call context.getValue to get a node context', function (done) {\n      stub.returns(Promise.resolve(nContext));\n      request(app).get('/context/node/5678/foo?store=file').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'node');\n        stub.args[0][0].should.have.property('id', '5678');\n        stub.args[0][0].should.have.property('key', 'foo');\n        stub.args[0][0].should.have.property('store', 'file');\n        var body = res.body;\n        body.should.eql(nContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should handle error which context.getValue causes","suites":["api/admin/context","get"],"updatePoint":{"line":137,"column":57,"index":4428},"line":137,"code":"    it('should handle error which context.getValue causes', function (done) {\n      var stubbedResult = Promise.reject('error');\n      stubbedResult.catch(function () {});\n      stub.returns(stubbedResult);\n      request(app).get('/context/global').set('Accept', 'application/json').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('code', 'unexpected_error');\n        res.body.should.has.a.property('message', 'error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a global context","suites":["api/admin/context","delete"],"updatePoint":{"line":164,"column":61,"index":5215},"line":164,"code":"    it('should call context.delete to delete a global context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/global/abc?store=default').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'global');\n        stub.args[0][0].should.have.property('id', undefined);\n        stub.args[0][0].should.have.property('key', 'abc');\n        stub.args[0][0].should.have.property('store', 'default');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a flow context","suites":["api/admin/context","delete"],"updatePoint":{"line":179,"column":59,"index":5846},"line":179,"code":"    it('should call context.delete to delete a flow context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/flow/1234/abc?store=file').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'flow');\n        stub.args[0][0].should.have.property('id', '1234');\n        stub.args[0][0].should.have.property('key', 'abc');\n        stub.args[0][0].should.have.property('store', 'file');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a node context","suites":["api/admin/context","delete"],"updatePoint":{"line":194,"column":59,"index":6469},"line":194,"code":"    it('should call context.delete to delete a node context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/node/5678/foo?store=file').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'node');\n        stub.args[0][0].should.have.property('id', '5678');\n        stub.args[0][0].should.have.property('key', 'foo');\n        stub.args[0][0].should.have.property('store', 'file');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should handle error which context.delete causes","suites":["api/admin/context","delete"],"updatePoint":{"line":209,"column":55,"index":7088},"line":209,"code":"    it('should handle error which context.delete causes', function (done) {\n      var stubbedResult = Promise.reject('error');\n      stubbedResult.catch(function () {});\n      stub.returns(stubbedResult);\n      request(app).delete('/context/global/abc?store=default').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('code', 'unexpected_error');\n        res.body.should.has.a.property('message', 'error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"returns the diagnostics report when explicitly enabled","suites":["api/editor/diagnostics"],"updatePoint":{"line":23,"column":60,"index":581},"line":23,"code":"  it('returns the diagnostics report when explicitly enabled', function (done) {\n    const settings = {\n      diagnostics: {\n        ui: true,\n        enabled: true\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n\n            try {\n              resolve({\n                opts: opts,\n                a: 1,\n                b: 2\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(200).end(function (err, res) {\n      if (err || typeof res.error === \"object\") {\n        return done(err || res.error);\n      }\n\n      res.should.have.property(\"statusCode\", 200);\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"returns the diagnostics report when not explicitly enabled (implicitly enabled)","suites":["api/editor/diagnostics"],"updatePoint":{"line":62,"column":85,"index":1622},"line":62,"code":"  it('returns the diagnostics report when not explicitly enabled (implicitly enabled)', function (done) {\n    const settings = {\n      diagnostics: {\n        enabled: undefined\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n\n            try {\n              resolve({\n                opts: opts,\n                a: 3,\n                b: 4\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(200).end(function (err, res) {\n      if (err || typeof res.error === \"object\") {\n        return done(err || res.error);\n      }\n\n      res.should.have.property(\"statusCode\", 200);\n      res.body.should.have.property(\"a\", 3);\n      res.body.should.have.property(\"b\", 4);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"should error when setting is disabled","suites":["api/editor/diagnostics"],"updatePoint":{"line":100,"column":43,"index":2608},"line":100,"code":"  it('should error when setting is disabled', function (done) {\n    const settings = {\n      diagnostics: {\n        ui: true,\n        enabled: false\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n\n            try {\n              resolve({\n                opts: opts\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(403).end(function (err, res) {\n      if (!err && typeof res.error !== \"object\") {\n        return done(new Error(\"accessing diagnostics endpoint while disabled should raise error\"));\n      }\n\n      res.should.have.property(\"statusCode\", 403);\n      res.body.should.have.property(\"message\", \"diagnostics are disabled\");\n      res.body.should.have.property(\"code\", \"diagnostics.disabled\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"gets a known flow","suites":["api/admin/flow","get"],"updatePoint":{"line":64,"column":25,"index":1826},"line":64,"code":"    it('gets a known flow', function (done) {\n      request(app).get('/flow/123').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"404s an unknown flow","suites":["api/admin/flow","get"],"updatePoint":{"line":74,"column":28,"index":2128},"line":74,"code":"    it('404s an unknown flow', function (done) {\n      request(app).get('/flow/456').set('Accept', 'application/json').expect(404).end(done);\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"adds a new flow","suites":["api/admin/flow","add"],"updatePoint":{"line":100,"column":23,"index":2836},"line":100,"code":"    it('adds a new flow', function (done) {\n      request(app).post('/flow').set('Accept', 'application/json').send({\n        id: '123'\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","add"],"updatePoint":{"line":112,"column":27,"index":3168},"line":112,"code":"    it('400 an invalid flow', function (done) {\n      request(app).post('/flow').set('Accept', 'application/json').send({\n        id: 'error'\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"updates an existing flow","suites":["api/admin/flow","update"],"updatePoint":{"line":148,"column":32,"index":4149},"line":148,"code":"    it('updates an existing flow', function (done) {\n      request(app).put('/flow/123').set('Accept', 'application/json').send({\n        id: '123'\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('id', '123');\n        opts.should.have.property('id', '123');\n        opts.should.have.property('flow', {\n          id: '123'\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","update"],"updatePoint":{"line":164,"column":27,"index":4608},"line":164,"code":"    it('400 an invalid flow', function (done) {\n      request(app).put('/flow/456').set('Accept', 'application/json').send({\n        id: '456'\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"deletes an existing flow","suites":["api/admin/flow","delete"],"updatePoint":{"line":200,"column":32,"index":5585},"line":200,"code":"    it('deletes an existing flow', function (done) {\n      request(app).del('/flow/123').set('Accept', 'application/json').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        opts.should.have.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","delete"],"updatePoint":{"line":210,"column":27,"index":5881},"line":210,"code":"    it('400 an invalid flow', function (done) {\n      request(app).del('/flow/456').set('Accept', 'application/json').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - v1","suites":["api/admin/flows"],"updatePoint":{"line":40,"column":23,"index":1257},"line":40,"code":"  it('returns flow - v1', function (done) {\n    flows.init({\n      flows: {\n        getFlows: function () {\n          return Promise.resolve({\n            rev: \"123\",\n            flows: [1, 2, 3]\n          });\n        }\n      }\n    });\n    request(app).get('/flows').set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.lengthOf(3);\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - v2","suites":["api/admin/flows"],"updatePoint":{"line":64,"column":23,"index":1784},"line":64,"code":"  it('returns flow - v2', function (done) {\n    flows.init({\n      flows: {\n        getFlows: function () {\n          return Promise.resolve({\n            rev: \"123\",\n            flows: [1, 2, 3]\n          });\n        }\n      }\n    });\n    request(app).get('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'v2').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.a.property('rev', '123');\n        res.body.should.have.a.property('flows');\n        res.body.flows.should.have.lengthOf(3);\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - bad version","suites":["api/admin/flows"],"updatePoint":{"line":90,"column":32,"index":2465},"line":90,"code":"  it('returns flow - bad version', function (done) {\n    request(app).get('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'xxx').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.a.property('code', 'invalid_api_version');\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows - default - v1","suites":["api/admin/flows"],"updatePoint":{"line":104,"column":31,"index":2873},"line":104,"code":"  it('sets flows - default - v1', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      setFlows.calledOnce.should.be.true();\n      setFlows.lastCall.args[0].should.have.property('deploymentType', 'full');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows - non-default - v1","suites":["api/admin/flows"],"updatePoint":{"line":123,"column":35,"index":3395},"line":123,"code":"  it('sets flows - non-default - v1', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'nodes').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      setFlows.calledOnce.should.be.true();\n      setFlows.lastCall.args[0].should.have.property('deploymentType', 'nodes');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"set flows - rejects mismatched revision - v2","suites":["api/admin/flows"],"updatePoint":{"line":142,"column":50,"index":3974},"line":142,"code":"  it('set flows - rejects mismatched revision - v2', function (done) {\n    flows.init({\n      flows: {\n        setFlows: function () {\n          var err = new Error(\"mismatch\");\n          err.code = \"version_mismatch\";\n          err.status = 409;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'v2').send({\n      rev: 456,\n      flows: [4, 5, 6]\n    }).expect(409).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property(\"code\", \"version_mismatch\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flow - bad version","suites":["api/admin/flows"],"updatePoint":{"line":167,"column":29,"index":4650},"line":167,"code":"  it('sets flow - bad version', function (done) {\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'xxx').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.a.property('code', 'invalid_api_version');\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"reloads flows","suites":["api/admin/flows"],"updatePoint":{"line":181,"column":19,"index":5047},"line":181,"code":"  it('reloads flows', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'reload').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      setFlows.called.should.be.true();\n      setFlows.lastCall.args[0].should.not.have.property('flows');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flows run state","suites":["api/admin/flows"],"updatePoint":{"line":200,"column":29,"index":5588},"line":200,"code":"  it('returns flows run state', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        }\n      }\n    });\n    request(app).get('/flows/state').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'reload').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.a.property('started', true);\n        res.body.should.have.a.property('state', \"started\");\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows run state - stopped","suites":["api/admin/flows"],"updatePoint":{"line":229,"column":36,"index":6346},"line":229,"code":"  it('sets flows run state - stopped', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        },\n        setState: async function () {\n          return {\n            started: false,\n            state: \"stopped\"\n          };\n        }\n      }\n    });\n    request(app).post('/flows/state').set('Accept', 'application/json').send({\n      state: 'stop'\n    }).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        res.body.should.have.a.property('started', false);\n        res.body.should.have.a.property('state', \"stopped\");\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows run state - bad value","suites":["api/admin/flows"],"updatePoint":{"line":266,"column":38,"index":7248},"line":266,"code":"  it('sets flows run state - bad value', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n\n    const makeError = (error, errcode, statusCode) => {\n      const message = typeof error == \"object\" ? error.message : error;\n      const err = typeof error == \"object\" ? error : new Error(message || \"Unexpected Error\");\n      err.status = err.status || statusCode || 400;\n      err.code = err.code || errcode || \"unexpected_error\";\n      return err;\n    };\n\n    flows.init({\n      flows: {\n        setFlows: setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        },\n        setState: async function () {\n          var err = makeError(\"Cannot set runtime state. Invalid state\", \"invalid_run_state\", 400);\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/flows/state').set('Accept', 'application/json').send({\n      state: 'bad-state'\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property(\"code\", \"invalid_run_state\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"GET /flows","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":111,"column":18,"index":3854},"line":111,"code":"    it('GET /flows', function (done) {\n      request(app).get(\"/flows\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /flows","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":121,"column":19,"index":4121},"line":121,"code":"    it('POST /flows', function (done) {\n      request(app).post(\"/flows\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":131,"column":22,"index":4393},"line":131,"code":"    it('GET /flow/1234', function (done) {\n      request(app).get(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.read', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /flow","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":142,"column":18,"index":4726},"line":142,"code":"    it('POST /flow', function (done) {\n      request(app).post(\"/flow\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":152,"column":25,"index":5000},"line":152,"code":"    it('DELETE /flow/1234', function (done) {\n      request(app).del(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.write', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":163,"column":22,"index":5338},"line":163,"code":"    it('PUT /flow/1234', function (done) {\n      request(app).put(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('flows.write', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":174,"column":18,"index":5672},"line":174,"code":"    it('GET /nodes', function (done) {\n      request(app).get(\"/nodes\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /nodes","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":184,"column":19,"index":5939},"line":184,"code":"    it('POST /nodes', function (done) {\n      request(app).post(\"/nodes\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":194,"column":25,"index":6214},"line":194,"code":"    it('GET /nodes/module', function (done) {\n      request(app).get(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":205,"column":32,"index":6563},"line":205,"code":"    it('GET /nodes/@scope/module', function (done) {\n      request(app).get(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":216,"column":25,"index":6919},"line":216,"code":"    it('PUT /nodes/module', function (done) {\n      request(app).put(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":227,"column":32,"index":7269},"line":227,"code":"    it('PUT /nodes/@scope/module', function (done) {\n      request(app).put(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":238,"column":28,"index":7629},"line":238,"code":"    it('DELETE /nodes/module', function (done) {\n      request(app).del(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":249,"column":35,"index":7982},"line":249,"code":"    it('DELETE /nodes/@scope/module', function (done) {\n      request(app).del(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":260,"column":29,"index":8343},"line":260,"code":"    it('GET /nodes/module/set', function (done) {\n      request(app).get(\"/nodes/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":272,"column":36,"index":8759},"line":272,"code":"    it('GET /nodes/@scope/module/set', function (done) {\n      request(app).get(\"/nodes/@scope/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":284,"column":29,"index":9182},"line":284,"code":"    it('PUT /nodes/module/set', function (done) {\n      request(app).put(\"/nodes/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/@scope/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":296,"column":36,"index":9599},"line":296,"code":"    it('PUT /nodes/@scope/module/set', function (done) {\n      request(app).put(\"/nodes/@scope/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":308,"column":27,"index":10021},"line":308,"code":"    it('GET /nodes/messages', function (done) {\n      request(app).get(\"/nodes/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module/set/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":318,"column":38,"index":10316},"line":318,"code":"    it('GET /nodes/module/set/messages', function (done) {\n      request(app).get(\"/nodes/module/set/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module/set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module/set/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":329,"column":45,"index":10695},"line":329,"code":"    it('GET /nodes/@scope/module/set/messages', function (done) {\n      request(app).get(\"/nodes/@scope/module/set/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module/set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/global","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":340,"column":27,"index":11070},"line":340,"code":"    it('GET /context/global', function (done) {\n      request(app).get(\"/context/global\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/global/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":351,"column":44,"index":11441},"line":351,"code":"    it('GET /context/global/key?store=memory', function (done) {\n      request(app).get(\"/context/global/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":364,"column":30,"index":11941},"line":364,"code":"    it('GET /context/flow/1234', function (done) {\n      request(app).get(\"/context/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/flow/1234/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":376,"column":47,"index":12379},"line":376,"code":"    it('GET /context/flow/1234/key?store=memory', function (done) {\n      request(app).get(\"/context/flow/1234/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/node/5678","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":390,"column":30,"index":12943},"line":390,"code":"    it('GET /context/node/5678', function (done) {\n      request(app).get(\"/context/node/5678\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/node/5678/foo?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":402,"column":47,"index":13381},"line":402,"code":"    it('GET /context/node/5678/foo?store=memory', function (done) {\n      request(app).get(\"/context/node/5678/foo?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        lastRequest.params.should.have.property(0, 'foo');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/global/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":416,"column":47,"index":13962},"line":416,"code":"    it('DELETE /context/global/key?store=memory', function (done) {\n      request(app).del(\"/context/global/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/flow/1234/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":429,"column":50,"index":14483},"line":429,"code":"    it('DELETE /context/flow/1234/key?store=memory', function (done) {\n      request(app).del(\"/context/flow/1234/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/node/5678/foo?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":443,"column":50,"index":15068},"line":443,"code":"    it('DELETE /context/node/5678/foo?store=memory', function (done) {\n      request(app).del(\"/context/node/5678/foo?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        lastRequest.params.should.have.property(0, 'foo');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"returns node list","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":55,"column":25,"index":1984},"line":55,"code":"    it('returns node list', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeList: function () {\n            return Promise.resolve([1, 2, 3]);\n          }\n        }\n      });\n      request(app).get('/nodes').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.be.an.Array();\n        res.body.should.have.lengthOf(3);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node configs","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":74,"column":28,"index":2478},"line":74,"code":"    it('returns node configs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeConfigs: function () {\n            return Promise.resolve(\"<script></script>\");\n          }\n        },\n        i18n: {\n          determineLangFromHeaders: function () {}\n        }\n      });\n      request(app).get('/nodes').set('Accept', 'text/html').expect(200).expect(\"<script></script>\").end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node module info","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":94,"column":32,"index":3007},"line":94,"code":"    it('returns node module info', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleInfo: function (opts) {\n            return Promise.resolve({\n              \"node-red\": {\n                name: \"node-red\"\n              }\n            }[opts.module]);\n          }\n        }\n      });\n      request(app).get('/nodes/node-red').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"name\", \"node-red\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 for unknown module","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":116,"column":38,"index":3566},"line":116,"code":"    it('returns 404 for unknown module', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleInfo: function (opts) {\n            var errInstance = new Error(\"Not Found\");\n            errInstance.code = \"not_found\";\n            errInstance.status = 404;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).get('/nodes/node-blue').expect(404).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns individual node info","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":138,"column":36,"index":4160},"line":138,"code":"    it('returns individual node info', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeInfo: function (opts) {\n            return Promise.resolve({\n              \"node-red/123\": {\n                id: \"node-red/123\"\n              }\n            }[opts.id]);\n          }\n        }\n      });\n      request(app).get('/nodes/node-red/123').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"id\", \"node-red/123\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns individual node configs","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":160,"column":39,"index":4760},"line":160,"code":"    it('returns individual node configs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeConfig: function (opts) {\n            return Promise.resolve({\n              \"node-red/123\": \"<script></script>\"\n            }[opts.id]);\n          }\n        },\n        i18n: {\n          determineLangFromHeaders: function () {}\n        }\n      });\n      request(app).get('/nodes/node-red/123').set('Accept', 'text/html').expect(200).expect(\"<script></script>\").end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 for unknown node","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":182,"column":36,"index":5364},"line":182,"code":"    it('returns 404 for unknown node', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeInfo: function (opts) {\n            var errInstance = new Error(\"Not Found\");\n            errInstance.code = \"not_found\";\n            errInstance.status = 404;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).get('/nodes/node-red/456').set('Accept', 'application/json').expect(404).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"installs the module and returns module info","suites":["api/admin/nodes","install"],"updatePoint":{"line":206,"column":51,"index":6050},"line":206,"code":"    it('installs the module and returns module info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          addModule: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              name: \"foo\",\n              nodes: [{\n                id: \"123\"\n              }]\n            });\n          }\n        }\n      });\n      request(app).post('/nodes').send({\n        module: 'foo',\n        version: \"1.2.3\",\n        url: \"https://example/foo-1.2.3.tgz\"\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"name\", \"foo\");\n        res.body.should.have.property(\"nodes\");\n        res.body.nodes[0].should.have.property(\"id\", \"123\");\n        opts.should.have.property(\"module\", \"foo\");\n        opts.should.have.property(\"version\", \"1.2.3\");\n        opts.should.have.property(\"url\", \"https://example/foo-1.2.3.tgz\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns error","suites":["api/admin/nodes","install"],"updatePoint":{"line":240,"column":21,"index":7023},"line":240,"code":"    it('returns error', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          addModule: function (opts) {\n            var errInstance = new Error(\"Message\");\n            errInstance.code = \"random_error\";\n            errInstance.status = 400;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).post('/nodes').send({\n        module: 'foo',\n        version: \"1.2.3\",\n        url: \"https://example/foo-1.2.3.tgz\"\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.a.property('code', 'random_error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"uninstalls the module","suites":["api/admin/nodes","delete"],"updatePoint":{"line":269,"column":29,"index":7814},"line":269,"code":"    it('uninstalls the module', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          removeModule: function (_opts) {\n            opts = _opts;\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).del('/nodes/123').expect(204).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        opts.should.have.property(\"module\", \"123\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns error","suites":["api/admin/nodes","delete"],"updatePoint":{"line":289,"column":21,"index":8281},"line":289,"code":"    it('returns error', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          removeModule: function (opts) {\n            var errInstance = new Error(\"Message\");\n            errInstance.code = \"random_error\";\n            errInstance.status = 400;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).del('/nodes/123').expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.a.property('code', 'random_error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 400 for invalid request payload","suites":["api/admin/nodes","enable/disable node set"],"updatePoint":{"line":314,"column":47,"index":9003},"line":314,"code":"    it('returns 400 for invalid request payload', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          setNodeSetState: function (opts) {\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).put('/nodes/node-red/foo').send({}).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"code\", \"invalid_request\");\n        res.body.should.have.property(\"message\", \"Invalid request\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"sets node state and returns node info","suites":["api/admin/nodes","enable/disable node set"],"updatePoint":{"line":333,"column":45,"index":9555},"line":333,"code":"    it('sets node state and returns node info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          setNodeSetState: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              id: \"123\",\n              enabled: true\n            });\n          }\n        }\n      });\n      request(app).put('/nodes/node-red/foo').send({\n        enabled: true\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"id\", \"123\");\n        res.body.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"id\", \"node-red/foo\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 400 for invalid request payload","suites":["api/admin/nodes","enable/disable module"],"updatePoint":{"line":363,"column":47,"index":10387},"line":363,"code":"    it('returns 400 for invalid request payload', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          setModuleState: function (opts) {\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).put('/nodes/node-red').send({}).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"code\", \"invalid_request\");\n        res.body.should.have.property(\"message\", \"Invalid request\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"sets module state and returns module info","suites":["api/admin/nodes","enable/disable module"],"updatePoint":{"line":382,"column":49,"index":10938},"line":382,"code":"    it('sets module state and returns module info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          setModuleState: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              name: \"node-red\"\n            });\n          }\n        }\n      });\n      request(app).put('/nodes/node-red').send({\n        enabled: true\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"name\", \"node-red\");\n        opts.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"module\", \"node-red\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns icon list","suites":["api/admin/nodes","get icons"],"updatePoint":{"line":410,"column":25,"index":11660},"line":410,"code":"    it('returns icon list', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getIconList: function () {\n            return Promise.resolve({\n              module: [1, 2, 3]\n            });\n          }\n        }\n      });\n      request(app).get('/getIcons').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.have.property(\"module\");\n        res.body.module.should.be.an.Array();\n        res.body.module.should.have.lengthOf(3);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns message catalog","suites":["api/admin/nodes","get module messages"],"updatePoint":{"line":434,"column":31,"index":12281},"line":434,"code":"    it('returns message catalog', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleCatalog: function (opts) {\n            return Promise.resolve({\n              a: 123\n            });\n          }\n        }\n      });\n      request(app).get('/nodes/module/set/messages').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.eql({\n          a: 123\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns all node catalogs","suites":["api/admin/nodes","get module messages"],"updatePoint":{"line":456,"column":33,"index":12780},"line":456,"code":"    it('returns all node catalogs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleCatalogs: function (opts) {\n            return Promise.resolve({\n              a: 1\n            });\n          }\n        }\n      });\n      request(app).get('/nodes/messages').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n\n        res.body.should.eql({\n          a: 1\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns the list of plugins","suites":["api/editor/plugins"],"updatePoint":{"line":66,"column":33,"index":1524},"line":66,"code":"  it('returns the list of plugins', function (done) {\n    request(app).get(\"/plugins\").set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        JSON.stringify(res.body).should.eql(JSON.stringify(pluginList));\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the plugin configs","suites":["api/editor/plugins"],"updatePoint":{"line":80,"column":32,"index":1898},"line":80,"code":"  it('returns the plugin configs', function (done) {\n    request(app).get(\"/plugins\").set('Accept', 'text/html').expect(200).expect(pluginConfigs).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the plugin catalogs","suites":["api/editor/plugins"],"updatePoint":{"line":89,"column":33,"index":2152},"line":89,"code":"  it('returns the plugin catalogs', function (done) {\n    request(app).get(\"/plugins/messages\").set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        JSON.stringify(res.body).should.eql(JSON.stringify(pluginCatalogs));\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the runtime settings","suites":["api/editor/settings"],"updatePoint":{"line":49,"column":34,"index":1425},"line":49,"code":"  it('returns the runtime settings', function (done) {\n    info.init({}, {\n      settings: {\n        getRuntimeSettings: function (opts) {\n          return Promise.resolve({\n            a: 1,\n            b: 2,\n            editorTheme: {\n              existing: 789\n            }\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2);\n      res.body.should.have.property(\"editorTheme\", {\n        existing: 789,\n        test: 456\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the runtime settings - disableEditor true","suites":["api/editor/settings"],"updatePoint":{"line":77,"column":55,"index":2111},"line":77,"code":"  it('returns the runtime settings - disableEditor true', function (done) {\n    info.init({\n      disableEditor: true\n    }, {\n      settings: {\n        getRuntimeSettings: function (opts) {\n          return Promise.resolve({\n            a: 1,\n            b: 2\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2); // no editorTheme if disabledEditor true\n\n      res.body.should.not.have.property(\"editorTheme\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/settings_spec.js","skipped":false,"dir":"test"},{"name":"finds the known editor client","suites":["api/auth/clients"],"updatePoint":{"line":23,"column":35,"index":873},"line":23,"code":"  it('finds the known editor client', function (done) {\n    Clients.get(\"node-red-editor\").then(function (client) {\n      client.should.have.property(\"id\", \"node-red-editor\");\n      client.should.have.property(\"secret\", \"not_available\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"finds the known admin client","suites":["api/auth/clients"],"updatePoint":{"line":30,"column":34,"index":1138},"line":30,"code":"  it('finds the known admin client', function (done) {\n    Clients.get(\"node-red-admin\").then(function (client) {\n      client.should.have.property(\"id\", \"node-red-admin\");\n      client.should.have.property(\"secret\", \"not_available\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"returns null for unknown client","suites":["api/auth/clients"],"updatePoint":{"line":39,"column":37,"index":1451},"line":39,"code":"  it('returns null for unknown client', function (done) {\n    Clients.get(\"unknown-client\").then(function (client) {\n      should.not.exist(client);\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"leaves client_secret alone if not present","suites":["api/auth/index","ensureClientSecret"],"updatePoint":{"line":37,"column":49,"index":1286},"line":37,"code":"    it(\"leaves client_secret alone if not present\", function (done) {\n      var req = {\n        body: {\n          client_secret: \"test_value\"\n        }\n      };\n      auth.ensureClientSecret(req, null, function () {\n        req.body.should.have.a.property(\"client_secret\", \"test_value\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"applies a default client_secret if not present","suites":["api/auth/index","ensureClientSecret"],"updatePoint":{"line":48,"column":54,"index":1613},"line":48,"code":"    it(\"applies a default client_secret if not present\", function (done) {\n      var req = {\n        body: {}\n      };\n      auth.ensureClientSecret(req, null, function () {\n        req.body.should.have.a.property(\"client_secret\", \"not_available\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"revokes a token","suites":["api/auth/index","revoke"],"updatePoint":{"line":59,"column":23,"index":1906},"line":59,"code":"    it(\"revokes a token\", function (done) {\n      var revokeToken = sinon.stub(Tokens, \"revoke\").callsFake(function () {\n        return Promise.resolve();\n      });\n      var req = {\n        body: {\n          token: \"abcdef\"\n        }\n      };\n      var res = {\n        status: function (resp) {\n          revokeToken.restore();\n          resp.should.equal(200);\n          return {\n            end: done\n          };\n        }\n      };\n      auth.revoke(req, res);\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - credentials","suites":["api/auth/index","login"],"updatePoint":{"line":89,"column":43,"index":2688},"line":89,"code":"    it(\"returns login details - credentials\", function (done) {\n      auth.init({\n        adminAuth: {\n          type: \"credentials\"\n        }\n      }, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.have.a.property(\"type\", \"credentials\");\n          resp.should.have.a.property(\"prompts\");\n          resp.prompts.should.have.a.lengthOf(2);\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - none","suites":["api/auth/index","login"],"updatePoint":{"line":104,"column":36,"index":3103},"line":104,"code":"    it(\"returns login details - none\", function (done) {\n      auth.init({}, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.eql({});\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - strategy","suites":["api/auth/index","login"],"updatePoint":{"line":113,"column":40,"index":3323},"line":113,"code":"    it(\"returns login details - strategy\", function (done) {\n      auth.init({\n        adminAuth: {\n          type: \"strategy\",\n          strategy: {\n            label: \"test-strategy\",\n            icon: \"test-icon\"\n          }\n        }\n      }, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.have.a.property(\"type\", \"strategy\");\n          resp.should.have.a.property(\"prompts\");\n          resp.prompts.should.have.a.lengthOf(1);\n          resp.prompts[0].should.have.a.property(\"type\", \"button\");\n          resp.prompts[0].should.have.a.property(\"label\", \"test-strategy\");\n          resp.prompts[0].should.have.a.property(\"icon\", \"test-icon\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"no-ops if adminAuth not set","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":153,"column":35,"index":4540},"line":153,"code":"    it('no-ops if adminAuth not set', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {};\n      });\n      auth.init({});\n      var func = auth.needsPermission(\"foo\");\n      func({}, {}, function () {\n        passport.authenticate.called.should.be.false();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"skips auth if req.user undefined","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":164,"column":40,"index":4925},"line":164,"code":"    it('skips auth if req.user undefined', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return true;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: null\n      }, {}, function () {\n        try {\n          passport.authenticate.called.should.be.true();\n          Permissions.hasPermission.called.should.be.false();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"passes for valid user permission","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":189,"column":40,"index":5632},"line":189,"code":"    it('passes for valid user permission', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return true;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: true,\n        authInfo: {\n          scope: \"read\"\n        }\n      }, {}, function () {\n        try {\n          passport.authenticate.called.should.be.true();\n          Permissions.hasPermission.called.should.be.true();\n          Permissions.hasPermission.lastCall.args[0].should.eql(\"read\");\n          Permissions.hasPermission.lastCall.args[1].should.eql(\"foo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects for invalid user permission","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":219,"column":43,"index":6541},"line":219,"code":"    it('rejects for invalid user permission', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return false;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: true,\n        authInfo: {\n          scope: \"read\"\n        }\n      }, {\n        status: function (status) {\n          return {\n            end: function () {\n              try {\n                status.should.eql(401);\n                done();\n              } catch (err) {\n                done(err);\n              }\n            }\n          };\n        }\n      }, function () {\n        done(new Error(\"hasPermission unexpected passed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"a user with no permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":24,"column":34,"index":926},"line":24,"code":"    it('a user with no permissions', function () {\n      permissions.hasPermission([], \"*\").should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with global permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":27,"column":38,"index":1049},"line":27,"code":"    it('a user with global permissions', function () {\n      permissions.hasPermission(\"*\", \"read\").should.be.true();\n      permissions.hasPermission([\"*\"], \"write\").should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with read permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":31,"column":36,"index":1239},"line":31,"code":"    it('a user with read permissions', function () {\n      permissions.hasPermission([\"read\"], \"read\").should.be.true();\n      permissions.hasPermission([\"read\"], \"node.read\").should.be.true();\n      permissions.hasPermission([\"read\"], \"write\").should.be.false();\n      permissions.hasPermission([\"read\"], \"node.write\").should.be.false();\n      permissions.hasPermission([\"*.read\"], \"read\").should.be.true();\n      permissions.hasPermission([\"*.read\"], \"node.read\").should.be.true();\n      permissions.hasPermission([\"*.read\"], \"write\").should.be.false();\n      permissions.hasPermission([\"*.read\"], \"node.write\").should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with foo permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":41,"column":35,"index":1879},"line":41,"code":"    it('a user with foo permissions', function () {\n      permissions.hasPermission(\"foo\", \"foo\").should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"an array of permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":44,"column":31,"index":1999},"line":44,"code":"    it('an array of permissions', function () {\n      permissions.hasPermission([\"*\"], [\"foo.read\", \"foo.write\"]).should.be.true();\n      permissions.hasPermission(\"read\", [\"foo.read\", \"foo.write\"]).should.be.false();\n      permissions.hasPermission(\"read\", [\"foo.read\", \"bar.read\"]).should.be.true();\n      permissions.hasPermission([\"flows.read\"], [\"flows.read\"]).should.be.true();\n      permissions.hasPermission([\"flows.read\"], [\"flows.write\"]).should.be.false();\n      permissions.hasPermission([\"flows.read\", \"nodes.write\"], [\"flows.write\"]).should.be.false();\n      permissions.hasPermission([\"flows.read\", \"nodes.write\"], [\"nodes.write\"]).should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"permits an empty permission","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":53,"column":35,"index":2676},"line":53,"code":"    it('permits an empty permission', function () {\n      permissions.hasPermission(\"*\", \"\").should.be.true();\n      permissions.hasPermission(\"read\", [\"\"]).should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"Handles authentication failure","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":39,"column":38,"index":1376},"line":39,"code":"    it('Handles authentication failure', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve(null);\n      });\n      strategies.passwordTokenExchange({}, \"user\", \"password\", \"scope\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Handles scope overreach","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":53,"column":31,"index":1844},"line":53,"code":"    it('Handles scope overreach', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"read\"\n        });\n      });\n      strategies.passwordTokenExchange({}, \"user\", \"password\", \"*\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Creates new token on authentication success","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":70,"column":51,"index":2393},"line":70,"code":"    it('Creates new token on authentication success', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"*\"\n        });\n      });\n      var tokenDetails = {};\n      var tokenCreate = sinon.stub(Tokens, \"create\").callsFake(function (username, client, scope) {\n        tokenDetails.username = username;\n        tokenDetails.client = client;\n        tokenDetails.scope = scope;\n        return Promise.resolve({\n          accessToken: \"123456\"\n        });\n      });\n      strategies.passwordTokenExchange({\n        id: \"myclient\"\n      }, \"user\", \"password\", \"read\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.equal(\"123456\");\n          tokenDetails.should.have.property(\"username\", \"user\");\n          tokenDetails.should.have.property(\"client\", \"myclient\");\n          tokenDetails.should.have.property(\"scope\", \"read\");\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          tokenCreate.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Uses provided token on authentication success and token provided","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":103,"column":72,"index":3577},"line":103,"code":"    it('Uses provided token on authentication success and token provided', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"*\",\n          token: \"123456\"\n        });\n      });\n      strategies.passwordTokenExchange({\n        id: \"myclient\"\n      }, \"user\", \"password\", \"read\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.equal(\"123456\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if anon user enabled","suites":["api/auth/strategies","Anonymous Strategy"],"updatePoint":{"line":125,"column":37,"index":4227},"line":125,"code":"    it('Succeeds if anon user enabled', function (done) {\n      var userDefault = sinon.stub(Users, \"default\").callsFake(function () {\n        return Promise.resolve(\"anon\");\n      });\n      strategies.anonymousStrategy._success = strategies.anonymousStrategy.success;\n\n      strategies.anonymousStrategy.success = function (user) {\n        user.should.equal(\"anon\");\n        strategies.anonymousStrategy.success = strategies.anonymousStrategy._success;\n        delete strategies.anonymousStrategy._success;\n        done();\n      };\n\n      strategies.anonymousStrategy.authenticate({});\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fails if anon user not enabled","suites":["api/auth/strategies","Anonymous Strategy"],"updatePoint":{"line":140,"column":38,"index":4823},"line":140,"code":"    it('Fails if anon user not enabled', function (done) {\n      var userDefault = sinon.stub(Users, \"default\").callsFake(function () {\n        return Promise.resolve(null);\n      });\n      strategies.anonymousStrategy._fail = strategies.anonymousStrategy.fail;\n\n      strategies.anonymousStrategy.fail = function (err) {\n        err.should.equal(401);\n        strategies.anonymousStrategy.fail = strategies.anonymousStrategy._fail;\n        delete strategies.anonymousStrategy._fail;\n        done();\n      };\n\n      strategies.anonymousStrategy.authenticate({});\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if tokens user enabled custom header","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":160,"column":53,"index":5526},"line":160,"code":"    it('Succeeds if tokens user enabled custom header', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function (token) {\n        return Promise.resolve(\"tokens-\" + token);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"x-test-token\";\n      });\n      strategies.tokensStrategy._success = strategies.tokensStrategy.success;\n\n      strategies.tokensStrategy.success = function (user) {\n        user.should.equal(\"tokens-1234\");\n        strategies.tokensStrategy.success = strategies.tokensStrategy._success;\n        delete strategies.tokensStrategy._success;\n        done();\n      };\n\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"x-test-token\": \"1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if tokens user enabled default header","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":182,"column":54,"index":6338},"line":182,"code":"    it('Succeeds if tokens user enabled default header', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function (token) {\n        return Promise.resolve(\"tokens-\" + token);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"authorization\";\n      });\n      strategies.tokensStrategy._success = strategies.tokensStrategy.success;\n\n      strategies.tokensStrategy.success = function (user) {\n        user.should.equal(\"tokens-1234\");\n        strategies.tokensStrategy.success = strategies.tokensStrategy._success;\n        delete strategies.tokensStrategy._success;\n        done();\n      };\n\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"authorization\": \"Bearer 1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fails if tokens user not enabled","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":204,"column":40,"index":7145},"line":204,"code":"    it('Fails if tokens user not enabled', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function () {\n        return Promise.resolve(null);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"authorization\";\n      });\n      strategies.tokensStrategy._fail = strategies.tokensStrategy.fail;\n\n      strategies.tokensStrategy.fail = function (err) {\n        err.should.equal(401);\n        strategies.tokensStrategy.fail = strategies.tokensStrategy._fail;\n        delete strategies.tokensStrategy._fail;\n        done();\n      };\n\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"authorization\": \"Bearer 1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":232,"column":29,"index":8044},"line":232,"code":"    it('Rejects invalid token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve(null);\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user) {\n        try {\n          should.not.exist(err);\n          user.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Accepts valid token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":248,"column":27,"index":8497},"line":248,"code":"    it('Accepts valid token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve({\n          user: \"user\",\n          scope: \"scope\"\n        });\n      });\n      var getUser = sinon.stub(Users, \"get\").callsFake(function (username) {\n        return Promise.resolve(\"aUser\");\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user, opts) {\n        try {\n          should.not.exist(err);\n          user.should.equal(\"aUser\");\n          opts.should.have.a.property(\"scope\", \"scope\");\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n          getUser.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fail if no user for token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":272,"column":33,"index":9236},"line":272,"code":"    it('Fail if no user for token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve({\n          user: \"user\",\n          scope: \"scope\"\n        });\n      });\n      var getUser = sinon.stub(Users, \"get\").callsFake(function (username) {\n        return Promise.resolve(null);\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user, opts) {\n        try {\n          should.not.exist(err);\n          user.should.equal(false);\n          should.not.exist(opts);\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n          getUser.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Accepts valid client","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":298,"column":28,"index":10001},"line":298,"code":"    it('Accepts valid client', function (done) {\n      var testClient = {\n        id: \"node-red-editor\",\n        secret: \"not_available\"\n      };\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(testClient);\n      });\n      strategies.clientPasswordStrategy(testClient.id, testClient.secret, function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.eql(testClient);\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid client secret","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":318,"column":37,"index":10614},"line":318,"code":"    it('Rejects invalid client secret', function (done) {\n      var testClient = {\n        id: \"node-red-editor\",\n        secret: \"not_available\"\n      };\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(testClient);\n      });\n      strategies.clientPasswordStrategy(testClient.id, \"invalid_secret\", function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid client id","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":338,"column":33,"index":11217},"line":338,"code":"    it('Rejects invalid client id', function (done) {\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(null);\n      });\n      strategies.clientPasswordStrategy(\"invalid_id\", \"invalid_secret\", function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Blocks after 5 failures","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":355,"column":31,"index":11742},"line":355,"code":"    it('Blocks after 5 failures', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve(null);\n      });\n\n      for (var z = 0; z < 5; z++) {\n        strategies.passwordTokenExchange({}, \"user\", \"badpassword\", \"scope\", function (err, token) {});\n      }\n\n      strategies.passwordTokenExchange({}, \"user\", \"badpassword\", \"scope\", function (err, token) {\n        try {\n          err.toString().should.equal(\"Error: Too many login attempts. Wait 10 minutes and try again\");\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          userAuthentication.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"loads sessions","suites":["api/auth/tokens","#init"],"updatePoint":{"line":26,"column":22,"index":922},"line":26,"code":"    it('loads sessions', function (done) {\n      Tokens.init({}).then(done);\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":31,"column":29,"index":1053},"line":31,"code":"    it('returns a valid token', function (done) {\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": Date.now() + 1000\n            }\n          });\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            token.should.have.a.property(\"user\", \"fred\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns null for an invalid token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":52,"column":41,"index":1606},"line":52,"code":"    it('returns null for an invalid token', function (done) {\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({});\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            should.not.exist(token);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns null for an expired token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":68,"column":41,"index":2018},"line":68,"code":"    it('returns null for an expired token', function (done) {\n      var saveSessions = sinon.stub().returns(Promise.resolve());\n      var expiryTime = Date.now() + 50;\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": expiryTime\n            }\n          });\n        },\n        saveSessions: saveSessions\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            should.exist(token);\n            setTimeout(function () {\n              Tokens.get(\"1234\").then(function (token) {\n                try {\n                  should.not.exist(token);\n                  saveSessions.calledOnce.should.be.true();\n                  done();\n                } catch (err) {\n                  done(err);\n                }\n              });\n            }, 100);\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid api token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":102,"column":33,"index":3016},"line":102,"code":"    it('returns a valid api token', function (done) {\n      Tokens.init({\n        tokens: [{\n          token: \"1234\",\n          user: \"fred\"\n        }]\n      }, {\n        getSessions: function () {\n          return Promise.resolve({});\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            token.should.have.a.property(\"user\", \"fred\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"creates a token","suites":["api/auth/tokens","#create"],"updatePoint":{"line":125,"column":23,"index":3558},"line":125,"code":"    it('creates a token', function (done) {\n      var savedSession;\n      Tokens.init({\n        sessionExpiryTime: 10\n      }, {\n        getSessions: function () {\n          return Promise.resolve({});\n        },\n        saveSessions: function (sess) {\n          savedSession = sess;\n          return Promise.resolve();\n        }\n      });\n      var expectedExpiryTime = Date.now() + 10000;\n      Tokens.create(\"user\", \"client\", \"scope\").then(function (token) {\n        try {\n          should.exist(savedSession);\n          var sessionKeys = Object.keys(savedSession);\n          sessionKeys.should.have.lengthOf(1);\n          token.should.have.a.property('accessToken', sessionKeys[0]);\n          savedSession[sessionKeys[0]].should.have.a.property('user', 'user');\n          savedSession[sessionKeys[0]].should.have.a.property('client', 'client');\n          savedSession[sessionKeys[0]].should.have.a.property('scope', 'scope');\n          savedSession[sessionKeys[0]].should.have.a.property('expires');\n          savedSession[sessionKeys[0]].expires.should.be.within(expectedExpiryTime - 200, expectedExpiryTime + 200);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"revokes a token","suites":["api/auth/tokens","#revoke"],"updatePoint":{"line":158,"column":23,"index":4812},"line":158,"code":"    it('revokes a token', function (done) {\n      var savedSession;\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": Date.now() + 1000\n            }\n          });\n        },\n        saveSessions: function (sess) {\n          savedSession = sess;\n          return Promise.resolve();\n        }\n      }).then(function () {\n        Tokens.revoke(\"1234\").then(function () {\n          try {\n            savedSession.should.not.have.a.property(\"1234\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#get"],"updatePoint":{"line":41,"column":28,"index":1377},"line":41,"code":"      it('returns known user', function (done) {\n        Users.get(\"fred\").then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"fred\");\n            user.should.have.a.property(\"permissions\", \"*\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for unknown user","suites":["api/auth/users","Initalised with a credentials object, no anon","#get"],"updatePoint":{"line":53,"column":39,"index":1784},"line":53,"code":"      it('returns null for unknown user', function (done) {\n        Users.get(\"barney\").then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for default user","suites":["api/auth/users","Initalised with a credentials object, no anon","#default"],"updatePoint":{"line":65,"column":39,"index":2097},"line":65,"code":"      it('returns null for default user', function (done) {\n        Users.default().then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"authenticates a known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":77,"column":36,"index":2408},"line":77,"code":"      it('authenticates a known user', function (done) {\n        Users.authenticate('fred', 'password').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"fred\");\n            user.should.have.a.property(\"permissions\", \"*\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid password for a known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":89,"column":51,"index":2848},"line":89,"code":"      it('rejects invalid password for a known user', function (done) {\n        Users.authenticate('fred', 'wrong').then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":99,"column":30,"index":3121},"line":99,"code":"      it('rejects invalid user', function (done) {\n        Users.authenticate('barney', 'wrong').then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns default user","suites":["api/auth/users","Initalised with a credentials object including anon","#default"],"updatePoint":{"line":122,"column":30,"index":3695},"line":122,"code":"      it('returns default user', function (done) {\n        Users.default().then(function (user) {\n          try {\n            user.should.have.a.property('anonymous', true);\n            user.should.have.a.property('permissions', '*');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for tokenHeader","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":158,"column":38,"index":4734},"line":158,"code":"      it(\"returns null for tokenHeader\", function () {\n        should.not.exist(Users.tokenHeader());\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"delegates get user","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":161,"column":28,"index":4836},"line":161,"code":"      it('delegates get user', function (done) {\n        Users.get('dave').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"dave\");\n            user.should.have.a.property(\"permissions\", \"read\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"delegates authenticate user","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":173,"column":37,"index":5244},"line":173,"code":"      it('delegates authenticate user', function (done) {\n        Users.authenticate('pete', 'secret').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"pete\");\n            user.should.have.a.property(\"permissions\", \"write\");\n            user.should.not.have.a.property(\"password\");\n            authUsername.should.equal('pete');\n            authPassword.should.equal('secret');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"should fail to return user fred","suites":["api/auth/users","Initialised with bad settings to test else cases","#get"],"updatePoint":{"line":201,"column":41,"index":6147},"line":201,"code":"      it('should fail to return user fred', function (done) {\n        Users.get(\"fred\").then(function (userf) {\n          try {\n            should.not.exist(userf);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.default being a function","suites":["api/auth/users","Initialised with default set as function","#default"],"updatePoint":{"line":226,"column":46,"index":6753},"line":226,"code":"      it('handles api.default being a function', function (done) {\n        Users.should.have.property('default').which.is.a.Function();\n        Users.default().should.equal(\"Done\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.tokens being a function","suites":["api/auth/users","Initialised with tokens set as function","#tokens"],"updatePoint":{"line":246,"column":45,"index":7301},"line":246,"code":"      it('handles api.tokens being a function', function (done) {\n        Users.should.have.property('tokens').which.is.a.Function();\n        Users.tokens(\"1234\").should.equal(\"Done-1234\");\n        Users.tokenHeader().should.equal(\"authorization\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.tokens being a function and api.tokenHeader being a header name","suites":["api/auth/users","Initialised with tokens set as function and tokenHeader set as token header name","#tokens"],"updatePoint":{"line":268,"column":85,"index":8035},"line":268,"code":"      it('handles api.tokens being a function and api.tokenHeader being a header name', function (done) {\n        Users.should.have.property('tokens').which.is.a.Function();\n        Users.tokens(\"1234\").should.equal(\"Done-1234\");\n        Users.should.have.property('tokenHeader').which.is.a.Function();\n        Users.tokenHeader().should.equal(\"x-test-token\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"accepts connection","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":94,"column":26,"index":2654},"line":94,"code":"    it('accepts connection', function (done) {\n      var ws = new WebSocket(url);\n      connections.length.should.eql(0);\n      ws.on('open', function () {\n        try {\n          connections.length.should.eql(1);\n          ws.close();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"publishes message after subscription","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":107,"column":44,"index":2999},"line":107,"code":"    it('publishes message after subscription', function (done) {\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"topic1\"}');\n        connections.length.should.eql(1);\n        connections[0].send('topic1', 'foo');\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"topic1\",\"data\":\"foo\"}]');\n        ws.close();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"malformed messages are ignored","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":120,"column":38,"index":3425},"line":120,"code":"    it('malformed messages are ignored', function (done) {\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        ws.send('not json');\n        ws.send('[]');\n        ws.send('{\"subscribe\":\"topic3\"}');\n        connections[0].send('topic3', 'correct');\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"topic3\",\"data\":\"correct\"}]');\n        ws.close();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects websocket connections","suites":["api/editor/comms","disabled editor"],"updatePoint":{"line":164,"column":37,"index":4648},"line":164,"code":"    it('rejects websocket connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        done(new Error(\"Socket connection unexpectedly accepted\"));\n        ws.close();\n      });\n      ws.on('error', function () {\n        connections.length.should.eql(0);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: /adminPath"],"updatePoint":{"line":206,"column":27,"index":5838},"line":206,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: /adminPath/"],"updatePoint":{"line":248,"column":27,"index":7015},"line":248,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: adminPath"],"updatePoint":{"line":290,"column":27,"index":8188},"line":290,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"are sent","suites":["api/editor/comms","keep alives"],"updatePoint":{"line":332,"column":16,"index":9312},"line":332,"code":"    it('are sent', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      ws.on('message', function (data) {\n        var msg = JSON.parse(data)[0];\n        msg.should.have.property('topic', 'hb');\n        msg.should.have.property('data').be.a.Number();\n        count++;\n\n        if (count == 3) {\n          ws.close();\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"are not sent if other messages are sent","suites":["api/editor/comms","keep alives"],"updatePoint":{"line":347,"column":47,"index":9733},"line":347,"code":"    it('are not sent if other messages are sent', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        interval = setInterval(function () {\n          connections[0].send('foo', 'bar');\n        }, 50);\n      });\n      ws.on('message', function (data) {\n        var msg = JSON.parse(data)[0]; // It is possible a heartbeat message may arrive - so ignore them\n\n        if (msg.topic != \"hb\") {\n          msg.should.have.property('topic', 'foo');\n          msg.should.have.property('data', 'bar');\n          count++;\n\n          if (count == 5) {\n            clearInterval(interval);\n            ws.close();\n            done();\n          }\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"prevents connections that do not authenticate","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":469,"column":53,"index":13311},"line":469,"code":"    it('prevents connections that do not authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":480,"column":47,"index":13608},"line":480,"code":"    it('allows connections that do authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"1234\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n\n        if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(2);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate - header-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":507,"column":71,"index":14366},"line":507,"code":"    it('allows connections that do authenticate - header-provided-token', function (done) {\n      var ws = new WebSocket(url, {\n        headers: {\n          \"custom-header\": \"knock-knock\"\n        }\n      });\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        connections.should.have.length(1);\n        connections[0].send('foo', 'correct');\n      });\n      ws.on('message', function (msg) {\n        received++;\n\n        if (received == 1) {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(1);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate - user-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":536,"column":69,"index":15144},"line":536,"code":"    it('allows connections that do authenticate - user-provided-token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"abcde\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n\n        if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(2);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for non-existant token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":563,"column":50,"index":15882},"line":563,"code":"    it('rejects connections for non-existant token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"2345\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for invalid token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":573,"column":45,"index":16156},"line":573,"code":"    it('rejects connections for invalid token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"5678\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for invalid token - header-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":583,"column":69,"index":16454},"line":583,"code":"    it('rejects connections for invalid token - header-provided-token', function (done) {\n      var ws = new WebSocket(url, {\n        headers: {\n          \"custom-header\": \"bad token\"\n        }\n      });\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n      });\n      ws.on('error', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"expires websocket sessions","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":597,"column":34,"index":16800},"line":597,"code":"    it(\"expires websocket sessions\", function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"1234\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n\n        if (received == 3) {\n          msg.should.equal('{\"auth\":\"fail\"}');\n        } else if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          setTimeout(function () {\n            onSessionExpiryCallback({\n              accessToken: \"1234\"\n            });\n          }, 50);\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(3);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows anonymous connections that do not authenticate","suites":["api/editor/comms","authentication required, anonymous enabled"],"updatePoint":{"line":663,"column":61,"index":18630},"line":663,"code":"    it('allows anonymous connections that do not authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        setTimeout(function () {\n          connections[0].send('foo', 'correct');\n        }, 200);\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n        count++;\n        ws.close();\n      });\n      ws.on('close', function () {\n        try {\n          count.should.equal(1);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"returns stored credentials","suites":["api/editor/credentials"],"updatePoint":{"line":52,"column":32,"index":1600},"line":52,"code":"  it('returns stored credentials', function (done) {\n    request(app).get(\"/credentials/known-type/n1\").expect(\"Content-Type\", /json/).expect(200).end(function (err, res) {\n      if (err) {\n        done(err);\n      } else {\n        try {\n          res.body.should.have.a.property(\"user1\", \"abc\");\n          res.body.should.not.have.a.property(\"password1\");\n          res.body.should.have.a.property(\"has_password1\", true);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/credentials_spec.js","skipped":false,"dir":"test"},{"name":"returns any error","suites":["api/editor/credentials"],"updatePoint":{"line":68,"column":23,"index":2105},"line":68,"code":"  it('returns any error', function (done) {\n    request(app).get(\"/credentials/unknown-type/n2\").expect(\"Content-Type\", /json/).expect(400).end(function (err, res) {\n      if (err) {\n        done(err);\n      } else {\n        try {\n          res.body.should.have.property('code');\n          res.body.code.should.be.equal(\"test_code\");\n          res.body.should.have.property('message');\n          res.body.message.should.be.equal('message');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/credentials_spec.js","skipped":false,"dir":"test"},{"name":"disables the editor","suites":["api/editor/index","disabled the editor"],"updatePoint":{"line":47,"column":27,"index":1548},"line":47,"code":"    it(\"disables the editor\", function () {\n      var editorApp = editorApi.init({}, {\n        disableEditor: true\n      }, {});\n      should.not.exist(editorApp);\n      comms.init.called.should.be.false();\n      info.init.called.should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":97,"column":25,"index":3202},"line":97,"code":"    it('serves the editor', function (done) {\n      request(app).get(\"/\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        } // Index page should probably mention Node-RED somewhere\n\n\n        res.text.indexOf(\"Node-RED\").should.not.eql(-1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"serves icons","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":108,"column":20,"index":3516},"line":108,"code":"    it('serves icons', function (done) {\n      request(app).get(\"/red/images/icons/arrow-in.svg\").expect(200).expect(\"Content-Type\", /image\\/svg\\+xml/).end(function (err, res) {\n        done(err);\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"handles page not there","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":113,"column":30,"index":3741},"line":113,"code":"    it('handles page not there', function (done) {\n      request(app).get(\"/foo\").expect(404, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"warns if runtime not started","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":116,"column":36,"index":3856},"line":116,"code":"    it('warns if runtime not started', function (done) {\n      isStarted = false;\n      request(app).get(\"/\").expect(503).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.text.should.eql(\"Not started\");\n        errors.should.have.lengthOf(1);\n        errors[0].should.eql(\"Node-RED runtime not started\");\n        done();\n      });\n    }); // it.skip('GET /settings', function(done) {","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"returns an individual entry - flow type","suites":["api/editor/library"],"updatePoint":{"line":39,"column":45,"index":1292},"line":39,"code":"  it('returns an individual entry - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve('{\"a\":1,\"b\":2}');\n        }\n      }\n    });\n    request(app).get('/library/local/flows/abc').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a directory listing - flow type","suites":["api/editor/library"],"updatePoint":{"line":62,"column":45,"index":1954},"line":62,"code":"  it('returns a directory listing - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve({\n            \"a\": 1,\n            \"b\": 2\n          });\n        }\n      }\n    });\n    request(app).get('/library/local/flows/abc/def').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc/def');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an individual entry - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":88,"column":49,"index":2665},"line":88,"code":"  it('returns an individual entry - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve('{\"a\":1,\"b\":2}');\n        }\n      }\n    });\n    request(app).get('/library/local/non-flow/abc').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc');\n      res.text.should.eql('{\"a\":1,\"b\":2}');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a directory listing - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":110,"column":49,"index":3291},"line":110,"code":"  it('returns a directory listing - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve({\n            \"a\": 1,\n            \"b\": 2\n          });\n        }\n      }\n    });\n    request(app).get('/library/local/non-flow/abc/def').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc/def');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an error on individual get","suites":["api/editor/library"],"updatePoint":{"line":136,"column":40,"index":3999},"line":136,"code":"  it('returns an error on individual get', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          var err = new Error(\"message\");\n          err.code = \"random_error\";\n          err.status = 400;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).get('/library/local/flows/123').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', '123');\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"random_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"message\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an individual entry - flow type","suites":["api/editor/library"],"updatePoint":{"line":166,"column":43,"index":4910},"line":166,"code":"  it('saves an individual entry - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post('/library/local/flows/abc/def').expect(204).send({\n      a: 1,\n      b: 2,\n      c: 3\n    }).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc/def');\n      opts.should.have.property('meta', {});\n      opts.should.have.property('body', JSON.stringify({\n        a: 1,\n        b: 2,\n        c: 3\n      }));\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an individual entry - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":197,"column":47,"index":5682},"line":197,"code":"  it('saves an individual entry - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post('/library/local/non-flow/abc/def').expect(204).send({\n      a: 1,\n      b: 2,\n      text: \"123\"\n    }).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc/def');\n      opts.should.have.property('meta', {\n        a: 1,\n        b: 2\n      });\n      opts.should.have.property('body', \"123\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an error on individual save","suites":["api/editor/library"],"updatePoint":{"line":227,"column":41,"index":6434},"line":227,"code":"  it('returns an error on individual save', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          var err = new Error(\"message\");\n          err.code = \"random_error\";\n          err.status = 400;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/library/local/non-flow/abc/def').send({\n      a: 1,\n      b: 2,\n      text: \"123\"\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('path', 'abc/def');\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"random_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"message\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns with default language","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":88,"column":37,"index":2765},"line":88,"code":"    it('returns with default language', function (done) {\n      request(app).get(\"/locales/message-catalog\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.have.property('namespace', 'message-catalog');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"returns with selected language","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":98,"column":38,"index":3076},"line":98,"code":"    it('returns with selected language', function (done) {\n      request(app).get(\"/locales/message-catalog?lng=fr-FR\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.have.property('namespace', 'message-catalog');\n        res.body.should.have.property('lang', 'fr-FR');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"returns for locale defined only with primary tag ","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":109,"column":57,"index":3472},"line":109,"code":"    it('returns for locale defined only with primary tag ', function (done) {\n      var orig = i18n.i.getResourceBundle;\n\n      i18n.i.getResourceBundle = function (lang, ns) {\n        if (lang === \"ja-JP\") {\n          return undefined;\n        }\n\n        return orig(lang, ns);\n      };\n\n      request(app) // returns `ja` instead of `ja-JP`\n      .get(\"/locales/message-catalog?lng=ja-JP\").expect(200).end(function (err, res) {\n        i18n.i.getResourceBundle = orig;\n\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.have.property('namespace', 'message-catalog');\n        res.body.should.have.property('lang', 'ja');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["api/editor/projects"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/editor-api/lib/editor/projects_spec.js","skipped":true,"dir":"test"},{"name":"returns the user settings","suites":["api/editor/settings"],"updatePoint":{"line":56,"column":31,"index":1630},"line":56,"code":"  it('returns the user settings', function (done) {\n    info.init({\n      settings: {\n        getUserSettings: function (opts) {\n          if (opts.user !== \"fred\") {\n            return Promise.reject(new Error(\"Unknown user\"));\n          }\n\n          return Promise.resolve({\n            c: 3,\n            d: 4\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings/user\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.eql({\n        c: 3,\n        d: 4\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/settings_spec.js","skipped":false,"dir":"test"},{"name":"updates the user settings","suites":["api/editor/settings"],"updatePoint":{"line":83,"column":31,"index":2204},"line":83,"code":"  it('updates the user settings', function (done) {\n    var update;\n    info.init({\n      settings: {\n        updateUserSettings: function (opts) {\n          if (opts.user !== \"fred\") {\n            return Promise.reject(new Error(\"Unknown user\"));\n          }\n\n          update = opts.settings;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post(\"/settings/user\").send({\n      e: 4,\n      f: 5\n    }).expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      update.should.eql({\n        e: 4,\n        f: 5\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/settings_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return empty list","suites":["api/editor/sshkeys"],"updatePoint":{"line":58,"column":51,"index":1885},"line":58,"code":"  it('GET /settings/user/keys --- return empty list', function (done) {\n    mockRuntime.settings.getUserKeys.returns(Promise.resolve([]));\n    request(app).get(\"/settings/user/keys\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('keys');\n      res.body.keys.should.be.empty();\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return normal list","suites":["api/editor/sshkeys"],"updatePoint":{"line":70,"column":52,"index":2271},"line":70,"code":"  it('GET /settings/user/keys --- return normal list', function (done) {\n    var fileList = ['test_key01', 'test_key02'];\n    var retList = fileList.map(function (elem) {\n      return {\n        name: elem\n      };\n    });\n    mockRuntime.settings.getUserKeys.returns(Promise.resolve(retList));\n    request(app).get(\"/settings/user/keys\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('keys');\n\n      for (var item of retList) {\n        res.body.keys.should.containEql(item);\n      }\n\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":92,"column":46,"index":2857},"line":92,"code":"  it('GET /settings/user/keys --- return Error', function (done) {\n    var errInstance = new Error(\"Messages here.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKeys.returns(p);\n    request(app).get(\"/settings/user/keys\").expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(errInstance.code);\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return 404","suites":["api/editor/sshkeys"],"updatePoint":{"line":110,"column":60,"index":3513},"line":110,"code":"  it('GET /settings/user/keys/<key_file_name> --- return 404', function (done) {\n    var errInstance = new Error(\"Not Found.\");\n    errInstance.code = \"not_found\";\n    errInstance.status = 404;\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/NOT_REAL\").expect(404).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":125,"column":57,"index":3987},"line":125,"code":"  it('GET /settings/user/keys --- return Unexpected Error', function (done) {\n    var errInstance = new Error();\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKeys.returns(p);\n    request(app).get(\"/settings/user/keys\").expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.toString());\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return content","suites":["api/editor/sshkeys"],"updatePoint":{"line":142,"column":64,"index":4596},"line":142,"code":"  it('GET /settings/user/keys/<key_file_name> --- return content', function (done) {\n    var key_file_name = \"test_key\";\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    mockRuntime.settings.getUserKey.returns(Promise.resolve(fileContent));\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      mockRuntime.settings.getUserKey.called.should.be.true();\n      mockRuntime.settings.getUserKey.firstCall.args[0].should.eql({\n        user: undefined,\n        id: 'test_key'\n      });\n      res.body.should.be.deepEqual({\n        publickey: fileContent\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":162,"column":62,"index":5990},"line":162,"code":"  it('GET /settings/user/keys/<key_file_name> --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(errInstance.code);\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":181,"column":73,"index":6706},"line":181,"code":"  it('GET /settings/user/keys/<key_file_name> --- return Unexpected Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"Messages.....\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- success","suites":["api/editor/sshkeys"],"updatePoint":{"line":199,"column":42,"index":7353},"line":199,"code":"  it('POST /settings/user/keys --- success', function (done) {\n    var key_file_name = \"test_key\";\n    mockRuntime.settings.generateUserKey.returns(Promise.resolve(key_file_name));\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":212,"column":47,"index":7742},"line":212,"code":"  it('POST /settings/user/keys --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.generateUserKey.returns(p);\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"test_code\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- return Unexpected error","suites":["api/editor/sshkeys"],"updatePoint":{"line":233,"column":58,"index":8467},"line":233,"code":"  it('POST /settings/user/keys --- return Unexpected error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.generateUserKey.returns(p);\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"Messages.....\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- success","suites":["api/editor/sshkeys"],"updatePoint":{"line":253,"column":60,"index":9161},"line":253,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- success', function (done) {\n    var key_file_name = \"test_key\";\n    mockRuntime.settings.removeUserKey.returns(Promise.resolve(true));\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.be.deepEqual({});\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":265,"column":65,"index":9576},"line":265,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.removeUserKey.returns(p);\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"test_code\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":284,"column":76,"index":10296},"line":284,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- return Unexpected Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.removeUserKey.returns(p);\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal('Messages.....');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"applies the default theme","suites":["api/editor/theme"],"updatePoint":{"line":44,"column":31,"index":1235},"line":44,"code":"  it(\"applies the default theme\", async function () {\n    var result = theme.init({});\n    should.not.exist(result);\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"title\", \"Node-RED\");\n    context.page.should.have.a.property(\"favicon\", \"favicon.ico\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"red/images/node-red-icon-black.svg\");\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f0000\");\n    context.should.have.a.property(\"header\");\n    context.header.should.have.a.property(\"title\", \"Node-RED\");\n    context.header.should.have.a.property(\"image\", \"red/images/node-red.svg\");\n    context.should.have.a.property(\"asset\");\n    context.asset.should.have.a.property(\"red\", \"red/red.min.js\");\n    context.asset.should.have.a.property(\"main\", \"red/main.min.js\");\n    context.asset.should.have.a.property(\"vendorMonaco\", \"vendor/monaco/monaco-bootstrap.js\");\n    should.not.exist(theme.settings());\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"uses non-minified js files when in dev mode","suites":["api/editor/theme"],"updatePoint":{"line":63,"column":49,"index":2312},"line":63,"code":"  it(\"uses non-minified js files when in dev mode\", async function () {\n    const previousEnv = process.env.NODE_ENV;\n\n    try {\n      process.env.NODE_ENV = 'development';\n      theme.init({});\n      var context = await theme.context();\n      context.asset.should.have.a.property(\"red\", \"red/red.js\");\n      context.asset.should.have.a.property(\"main\", \"red/main.js\");\n    } finally {\n      process.env.NODE_ENV = previousEnv;\n    }\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"Does not add monaco bootstrap when ace selected","suites":["api/editor/theme"],"updatePoint":{"line":76,"column":53,"index":2756},"line":76,"code":"  it(\"Does not add monaco bootstrap when ace selected\", async function () {\n    theme.init({\n      editorTheme: {\n        codeEditor: {\n          lib: 'ace'\n        }\n      }\n    });\n    var context = await theme.context();\n    context.asset.should.have.a.property(\"vendorMonaco\", \"\");\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"picks up custom theme","suites":["api/editor/theme"],"updatePoint":{"line":87,"column":27,"index":3022},"line":87,"code":"  it(\"picks up custom theme\", async function () {\n    theme.init({\n      editorTheme: {\n        page: {\n          title: \"Test Page Title\",\n          favicon: \"/absolute/path/to/theme/favicon\",\n          tabicon: {\n            icon: \"/absolute/path/to/theme/tabicon\",\n            colour: \"#8f008f\"\n          },\n          css: [\"/absolute/path/to/custom/css/file.css\"],\n          scripts: \"/absolute/path/to/script.js\"\n        },\n        header: {\n          title: \"Test Header Title\",\n          url: \"http://nodered.org\",\n          image: \"/absolute/path/to/header/image\" // or null to remove image\n\n        },\n        deployButton: {\n          type: \"simple\",\n          label: \"Save\",\n          icon: \"/absolute/path/to/deploy/button/image\" // or null to remove image\n\n        },\n        menu: {\n          // Hide unwanted menu items by id. see editor/js/main.js:loadEditor for complete list\n          \"menu-item-import-library\": false,\n          \"menu-item-export-library\": false,\n          \"menu-item-keyboard-shortcuts\": false,\n          \"menu-item-help\": {\n            label: \"Alternative Help Link Text\",\n            url: \"http://example.com\"\n          }\n        },\n        userMenu: false,\n        // Hide the user-menu even if adminAuth is enabled\n        login: {\n          image: \"/absolute/path/to/login/page/big/image\" // a 256x256 image\n\n        },\n        palette: {\n          editable: true,\n          catalogues: ['https://catalogue.nodered.org/catalogue.json'],\n          theme: [{\n            category: \".*\",\n            type: \".*\",\n            color: \"#f0f\"\n          }]\n        },\n        projects: {\n          enabled: false\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"title\", \"Test Page Title\");\n    context.page.should.have.a.property(\"favicon\", \"theme/favicon/favicon\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"theme/tabicon/tabicon\");\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f008f\");\n    context.should.have.a.property(\"header\");\n    context.header.should.have.a.property(\"title\", \"Test Header Title\");\n    context.header.should.have.a.property(\"url\", \"http://nodered.org\");\n    context.header.should.have.a.property(\"image\", \"theme/header/image\");\n    context.page.should.have.a.property(\"css\");\n    context.page.css.should.have.lengthOf(1);\n    context.page.css[0].should.eql('theme/css/file.css');\n    context.page.should.have.a.property(\"scripts\");\n    context.page.scripts.should.have.lengthOf(1);\n    context.page.scripts[0].should.eql('theme/scripts/script.js');\n    context.should.have.a.property(\"login\");\n    context.login.should.have.a.property(\"image\", \"theme/login/image\");\n    var settings = theme.settings();\n    settings.should.have.a.property(\"deployButton\");\n    settings.deployButton.should.have.a.property(\"type\", \"simple\");\n    settings.deployButton.should.have.a.property(\"label\", \"Save\");\n    settings.deployButton.should.have.a.property(\"icon\", \"theme/deploy/image\");\n    settings.should.have.a.property(\"userMenu\");\n    settings.userMenu.should.be.eql(false);\n    settings.should.have.a.property(\"menu\");\n    settings.menu.should.have.a.property(\"menu-item-import-library\", false);\n    settings.menu.should.have.a.property(\"menu-item-export-library\", false);\n    settings.menu.should.have.a.property(\"menu-item-keyboard-shortcuts\", false);\n    settings.menu.should.have.a.property(\"menu-item-help\", {\n      label: \"Alternative Help Link Text\",\n      url: \"http://example.com\"\n    });\n    settings.should.have.a.property(\"palette\");\n    settings.palette.should.have.a.property(\"editable\", true);\n    settings.palette.should.have.a.property(\"catalogues\", ['https://catalogue.nodered.org/catalogue.json']);\n    settings.palette.should.have.a.property(\"theme\", [{\n      category: \".*\",\n      type: \".*\",\n      color: \"#f0f\"\n    }]);\n    settings.should.have.a.property(\"projects\");\n    settings.projects.should.have.a.property(\"enabled\", false);\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"picks up backwards compatible tabicon setting","suites":["api/editor/theme"],"updatePoint":{"line":188,"column":51,"index":7159},"line":188,"code":"  it(\"picks up backwards compatible tabicon setting\", async function () {\n    theme.init({\n      editorTheme: {\n        page: {\n          tabicon: \"/absolute/path/to/theme/tabicon\"\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"theme/tabicon/tabicon\"); // The colour property should remain as default in this case as the\n    // legacy format for defining tabicon doesn't allow specifying a colour\n\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f0000\");\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"test explicit userMenu set to true in theme setting","suites":["api/editor/theme"],"updatePoint":{"line":205,"column":57,"index":7829},"line":205,"code":"  it(\"test explicit userMenu set to true in theme setting\", function () {\n    theme.init({\n      editorTheme: {\n        userMenu: true\n      }\n    });\n    theme.app();\n    var settings = theme.settings();\n    settings.should.have.a.property(\"userMenu\");\n    settings.userMenu.should.be.eql(true);\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"includes list of plugin themes","suites":["api/editor/theme"],"updatePoint":{"line":216,"column":36,"index":8111},"line":216,"code":"  it(\"includes list of plugin themes\", function (done) {\n    theme.init({}, {\n      plugins: {\n        getPluginsByType: _ => [{\n          id: \"theme-plugin\"\n        }]\n      }\n    });\n    const app = theme.app();\n    request(app).get(\"/\").end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n\n      try {\n        const response = JSON.parse(res.text);\n        response.should.have.property(\"themes\");\n        response.themes.should.eql([\"theme-plugin\"]);\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"includes theme plugin settings","suites":["api/editor/theme"],"updatePoint":{"line":240,"column":36,"index":8670},"line":240,"code":"  it(\"includes theme plugin settings\", async function () {\n    theme.init({\n      editorTheme: {\n        theme: 'test-theme'\n      }\n    }, {\n      plugins: {\n        getPlugin: t => {\n          return {\n            'test-theme': {\n              path: '/abosolute/path/to/plugin',\n              css: [\"path/to/custom/css/file1.css\", \"/invalid/path/to/file2.css\", \"../another/invalid/path/file3.css\"],\n              scripts: [\"path/to/custom/js/file1.js\", \"/invalid/path/to/file2.js\", \"../another/invalid/path/file3.js\"]\n            }\n          }[t.id];\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"css\");\n    context.page.css.should.have.lengthOf(1);\n    context.page.css[0].should.eql('theme/css/file1.css');\n    context.page.should.have.a.property(\"scripts\");\n    context.page.scripts.should.have.lengthOf(1);\n    context.page.scripts[0].should.eql('theme/scripts/file1.js');\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"redirects if the path does not end in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":63,"column":53,"index":1928},"line":63,"code":"    it('redirects if the path does not end in a slash', function (done) {\n      request(app).get('/foo').expect(301, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"redirects if the path, with query string, does not end in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":66,"column":73,"index":2080},"line":66,"code":"    it('redirects if the path, with query string, does not end in a slash', function (done) {\n      request(app).get('/foo?abc=def').expect(301).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.header['location'].should.equal(\"/foo/?abc=def\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"does not redirect if the path ends in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":76,"column":53,"index":2385},"line":76,"code":"    it('does not redirect if the path ends in a slash', function (done) {\n      request(app).get('/foo/').expect(200, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the requested icon","suites":["api/editor/ui","icon handler"],"updatePoint":{"line":105,"column":34,"index":3107},"line":105,"code":"    it('returns the requested icon', function (done) {\n      var defaultIcon = fs.readFileSync(NR_TEST_UTILS.resolve(\"@node-red/editor-client/src/images/icons/arrow-in.svg\"));\n      request(app).get(\"/icons/module/icon.png\").expect(\"Content-Type\", /image\\/png/).expect(200).parse(binaryParser).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        Buffer.isBuffer(res.body).should.be.true();\n        compareBuffers(res.body, defaultIcon);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the default icon for invalid paths","suites":["api/editor/ui","icon handler"],"updatePoint":{"line":117,"column":50,"index":3634},"line":117,"code":"    it('returns the default icon for invalid paths', function (done) {\n      var defaultIcon = fs.readFileSync(NR_TEST_UTILS.resolve(\"@node-red/editor-client/src/images/icons/arrow-in.svg\"));\n      request(app).get(\"/icons/module/unreal.png\").expect(\"Content-Type\", /image\\/svg/).expect(200).parse(binaryParser).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        Buffer.isBuffer(res.body).should.be.true();\n        compareBuffers(res.body, defaultIcon);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the requested resource","suites":["api/editor/ui","module resource handler"],"updatePoint":{"line":135,"column":38,"index":4346},"line":135,"code":"    it('returns the requested resource', function (done) {\n      request(app).get(\"/resources/test-module/a/path/text.txt\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.text.should.eql('Some text data');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"404s invalid paths","suites":["api/editor/ui","module resource handler"],"updatePoint":{"line":145,"column":26,"index":4635},"line":145,"code":"    it('404s invalid paths', function (done) {\n      request(app).get(\"/resources/test-module/../a/path/text.txt\").expect(404).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor","suites":["api/editor/ui","editor ui handler"],"updatePoint":{"line":160,"column":25,"index":5018},"line":160,"code":"    it('serves the editor', function (done) {\n      request(app).get(\"/\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        } // Index page should probably mention Node-RED somewhere\n\n\n        res.text.indexOf(\"Node-RED\").should.not.eql(-1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor resources","suites":["api/editor/ui","editor ui resource handler"],"updatePoint":{"line":177,"column":35,"index":5504},"line":177,"code":"    it('serves the editor resources', function (done) {\n      request(app).get(\"/favicon.ico\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"does not setup admin api if httpAdminRoot is false","suites":["api/index"],"updatePoint":{"line":67,"column":56,"index":2025},"line":67,"code":"  it(\"does not setup admin api if httpAdminRoot is false\", function (done) {\n    api.init({\n      httpAdminRoot: false\n    }, {}, {}, {});\n    should.not.exist(api.httpAdmin);\n    done();\n  });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the editor","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":80,"column":26,"index":2363},"line":80,"code":"    it('exposes the editor', function (done) {\n      request(api.httpAdmin).get(\"/editor\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the admin api","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":83,"column":29,"index":2488},"line":83,"code":"    it('exposes the admin api', function (done) {\n      request(api.httpAdmin).get(\"/admin\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the auth api","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":86,"column":28,"index":2611},"line":86,"code":"    it('exposes the auth api', function (done) {\n      request(api.httpAdmin).get(\"/auth/login\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"does not expose the editor","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":98,"column":34,"index":2957},"line":98,"code":"    it('does not expose the editor', function (done) {\n      request(api.httpAdmin).get(\"/editor\").expect(404).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the admin api","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":101,"column":29,"index":3082},"line":101,"code":"    it('exposes the admin api', function (done) {\n      request(api.httpAdmin).get(\"/admin\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the auth api","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":104,"column":28,"index":3205},"line":104,"code":"    it('exposes the auth api', function (done) {\n      request(api.httpAdmin).get(\"/auth/login\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"ignores non-function values","suites":["api/index","initialises api with admin middleware"],"updatePoint":{"line":109,"column":35,"index":3412},"line":109,"code":"    it('ignores non-function values', function (done) {\n      api.init({\n        httpAdminRoot: true,\n        httpAdminMiddleware: undefined\n      }, {}, {}, {});\n\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'testMiddleware');\n\n      should(middlewareFound).be.empty();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"only accepts functions as middleware","suites":["api/index","initialises api with admin middleware"],"updatePoint":{"line":120,"column":44,"index":3758},"line":120,"code":"    it('only accepts functions as middleware', function (done) {\n      const testMiddleware = function (req, res, next) {\n        next();\n      };\n\n      api.init({\n        httpAdminRoot: true,\n        httpAdminMiddleware: testMiddleware\n      }, {}, {}, {});\n\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'testMiddleware');\n\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables an oauth/openID based authentication mechanism","suites":["api/index","initialises api with authentication enabled"],"updatePoint":{"line":137,"column":62,"index":4290},"line":137,"code":"    it('enables an oauth/openID based authentication mechanism', function (done) {\n      const stub = sinon.stub(apiAuth, 'genericStrategy').callsFake(function () {});\n      const adminAuth = {\n        type: 'strategy',\n        strategy: {}\n      };\n      api.init({\n        httpAdminRoot: true,\n        adminAuth\n      }, {}, {}, {});\n      should(stub.called).be.ok();\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables password protection","suites":["api/index","initialises api with authentication enabled"],"updatePoint":{"line":151,"column":35,"index":4678},"line":151,"code":"    it('enables password protection', function (done) {\n      const adminAuth = {\n        type: 'credentials'\n      };\n      api.init({\n        httpAdminRoot: true,\n        adminAuth\n      }, {}, {}, {}); // is the name (\"initialize\") of the passport middleware present\n\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'initialize');\n\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"uses default cors middleware when user settings absent","suites":["api/index","initialises api with custom cors config"],"updatePoint":{"line":171,"column":62,"index":5312},"line":171,"code":"    it('uses default cors middleware when user settings absent', function (done) {\n      api.init({\n        httpAdminRoot: true\n      }, {}, {}, {});\n\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'corsMiddleware');\n\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables custom cors middleware when settings present","suites":["api/index","initialises api with custom cors config"],"updatePoint":{"line":181,"column":60,"index":5636},"line":181,"code":"    it('enables custom cors middleware when settings present', function (done) {\n      api.init({\n        httpAdminRoot: true,\n        httpAdminCors\n      }, {}, {}, {});\n\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'corsMiddleware');\n\n      should(middlewareFound).be.length(2);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"cannot be started when editor is disabled","suites":["api/index","editor start"],"updatePoint":{"line":194,"column":49,"index":6019},"line":194,"code":"    it('cannot be started when editor is disabled', function (done) {\n      const stub = sinon.stub(apiEditor, 'start').callsFake(function () {\n        return Promise.resolve(true);\n      });\n      api.init({\n        httpAdminRoot: true,\n        disableEditor: true\n      }, {}, {}, {});\n      should(api.start()).resolvedWith(true);\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"can be started when editor enabled","suites":["api/index","editor start"],"updatePoint":{"line":206,"column":42,"index":6390},"line":206,"code":"    it('can be started when editor enabled', function (done) {\n      const stub = sinon.stub(apiEditor, 'start');\n      api.init({\n        httpAdminRoot: true,\n        disableEditor: false\n      }, {}, {}, {});\n      api.start();\n      should(stub.called).be.true();\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"logs an error for request entity too large","suites":["api/util","errorHandler"],"updatePoint":{"line":64,"column":50,"index":1969},"line":64,"code":"    it(\"logs an error for request entity too large\", function (done) {\n      request(app).get(\"/tooLarge\").expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.have.property(\"error\", \"unexpected_error\");\n        res.body.should.have.property(\"message\", \"Error: request entity too large\");\n        loggedError.should.have.property(\"message\", \"request entity too large\");\n        loggedEvent.should.have.property(\"event\", \"api.error\");\n        loggedEvent.should.have.property(\"error\", \"unexpected_error\");\n        loggedEvent.should.have.property(\"message\", \"Error: request entity too large\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"logs an error plus stack for other errors","suites":["api/util","errorHandler"],"updatePoint":{"line":79,"column":49,"index":2662},"line":79,"code":"    it(\"logs an error plus stack for other errors\", function (done) {\n      request(app).get(\"/stack\").expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n\n        res.body.should.have.property(\"error\", \"unexpected_error\");\n        res.body.should.have.property(\"message\", \"Error: stacktrace\");\n        /Error: stacktrace\\s*at.*util_spec.js/m.test(loggedError).should.be.true();\n        loggedEvent.should.have.property(\"event\", \"api.error\");\n        loggedEvent.should.have.property(\"error\", \"unexpected_error\");\n        loggedEvent.should.have.property(\"message\", \"Error: stacktrace\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns the default lang if non provided","suites":["api/util","determineLangFromHeaders"],"updatePoint":{"line":104,"column":48,"index":3590},"line":104,"code":"    it('returns the default lang if non provided', function () {\n      apiUtil.determineLangFromHeaders(null).should.eql(\"en-US\");\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns the first language accepted","suites":["api/util","determineLangFromHeaders"],"updatePoint":{"line":107,"column":43,"index":3724},"line":107,"code":"    it('returns the first language accepted', function () {\n      apiUtil.determineLangFromHeaders(['fr-FR', 'en-GB']).should.eql(\"fr-FR\");\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should return info on a node","suites":["deprecated"],"updatePoint":{"line":23,"column":34,"index":868},"line":23,"code":"  it('should return info on a node', function () {\n    deprecated.get(\"irc in\").should.eql({\n      module: \"node-red-node-irc\"\n    });\n  });","file":"unit/@node-red/registry/lib/deprecated_spec.js","skipped":false,"dir":"test"},{"name":"should return null for non-deprecated node","suites":["deprecated"],"updatePoint":{"line":28,"column":48,"index":1023},"line":28,"code":"  it('should return null for non-deprecated node', function () {\n    should.not.exist(deprecated.get(\"foo\"));\n  });","file":"unit/@node-red/registry/lib/deprecated_spec.js","skipped":false,"dir":"test"},{"name":"does nothing when no types are registered","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":78,"column":49,"index":2116},"line":78,"code":"    it(\"does nothing when no types are registered\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips install for modules already installed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":92,"column":51,"index":2491},"line":92,"code":"    it(\"skips install for modules already installed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await setupExternalModulesPackage({\n        \"foo\": \"1.2.3\",\n        \"bar\": \"2.3.4\"\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips install for built-in modules","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":111,"column":42,"index":3008},"line":111,"code":"    it(\"skips install for built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"fs\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"installs missing modules","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":126,"column":32,"index":3415},"line":126,"code":"    it(\"installs missing modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"calls pre/postInstall hooks","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":141,"column":35,"index":3825},"line":141,"code":"    it(\"calls pre/postInstall hooks\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        event.args = [\"a\"];\n        receivedPreEvent = event;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.true(); // exec.run.lastCall.args[1].should.eql([ 'install', 'a', 'foo' ]);\n\n      receivedPreEvent.should.have.property(\"module\", \"foo\");\n      receivedPreEvent.should.have.property(\"version\");\n      receivedPreEvent.should.have.property(\"dir\");\n      receivedPreEvent.should.eql(receivedPostEvent);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips npm install if preInstall returns false","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":169,"column":53,"index":4809},"line":169,"code":"    it(\"skips npm install if preInstall returns false\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        receivedPreEvent = event;\n        return false;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n      receivedPreEvent.should.have.property(\"module\", \"foo\");\n      receivedPreEvent.should.have.property(\"version\");\n      receivedPreEvent.should.have.property(\"dir\");\n      receivedPreEvent.should.eql(receivedPostEvent);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"installs missing modules from inside subflow module","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":196,"column":59,"index":5725},"line":196,"code":"    it(\"installs missing modules from inside subflow module\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      externalModules.registerSubflow(\"sf\", {\n        \"flow\": [{\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }]\n        }]\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"sf\"\n      }]);\n      exec.run.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - 404","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":216,"column":34,"index":6247},"line":216,"code":"    it(\"reports install fail - 404\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleNotFound\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleNotFound\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", 404);\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - target","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":242,"column":37,"index":7112},"line":242,"code":"    it(\"reports install fail - target\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleVersionNotFound\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleVersionNotFound\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", 404);\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - unexpected","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":268,"column":41,"index":7995},"line":268,"code":"    it(\"reports install fail - unexpected\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleFail\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleFail\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"unexpected_error\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - multiple","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":294,"column":39,"index":8869},"line":294,"code":"    it(\"reports install fail - multiple\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleNotFound\"\n          }, {\n            module: \"moduleFail\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(2); // Sort the array so we know the order to test for\n\n        err.sort(function (A, B) {\n          return A.module.module.localeCompare(B.module.module);\n        });\n        err[1].should.have.property(\"module\");\n        err[1].module.should.have.property(\"module\", \"moduleNotFound\");\n        err[1].should.have.property(\"error\");\n        err[1].error.should.have.property(\"code\", 404);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleFail\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"unexpected_error\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - install disabled","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":330,"column":47,"index":10188},"line":330,"code":"    it(\"reports install fail - install disabled\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            allowInstall: false\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        // Should not try to install\n        exec.run.called.should.be.false();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"foo\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"install_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - module disallowed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":362,"column":48,"index":11201},"line":362,"code":"    it(\"reports install fail - module disallowed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['foo']\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([// foo disallowed\n        // bar allowed\n        {\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }, {\n            module: \"bar\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.calledOnce.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"foo\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"install_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - built-in module disallowed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":397,"column":57,"index":12277},"line":397,"code":"    it(\"reports install fail - built-in module disallowed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n\n      try {\n        await externalModules.checkFlowDependencies([// foo disallowed\n        // bar allowed\n        {\n          type: \"function\",\n          libs: [{\n            module: \"fs\"\n          }, {\n            module: \"bar\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.calledOnce.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"fs\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"requires built-in modules","suites":["externalModules api","require"],"updatePoint":{"line":434,"column":33,"index":13373},"line":434,"code":"    it(\"requires built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n\n      const result = externalModules.require(\"fs\");\n\n      result.should.eql(require(\"fs\"));\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects unknown modules","suites":["externalModules api","require"],"updatePoint":{"line":445,"column":31,"index":13639},"line":445,"code":"    it(\"rejects unknown modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n\n      try {\n        externalModules.require(\"foo\");\n\n        throw new Error(\"require did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects disallowed modules","suites":["externalModules api","require"],"updatePoint":{"line":460,"column":34,"index":14024},"line":460,"code":"    it(\"rejects disallowed modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n\n      try {\n        externalModules.require(\"fs\");\n\n        throw new Error(\"require did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"import built-in modules","suites":["externalModules api","import"],"updatePoint":{"line":482,"column":31,"index":14552},"line":482,"code":"    it(\"import built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      const result = await externalModules.import(\"fs\"); // `result` won't have the `should` property\n\n      should.exist(result);\n      should.exist(result.existsSync);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects unknown modules","suites":["externalModules api","import"],"updatePoint":{"line":493,"column":31,"index":14894},"line":493,"code":"    it(\"rejects unknown modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n\n      try {\n        await externalModules.import(\"foo\");\n        throw new Error(\"import did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects disallowed modules","suites":["externalModules api","import"],"updatePoint":{"line":507,"column":34,"index":15282},"line":507,"code":"    it(\"rejects disallowed modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n\n      try {\n        await externalModules.import(\"fs\");\n        throw new Error(\"import did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"intialises components","suites":["red/registry/index","#init"],"updatePoint":{"line":42,"column":29,"index":1292},"line":42,"code":"    it('intialises components', function () {\n      stubs.push(sinon.stub(installer, \"init\"));\n      stubs.push(sinon.stub(loader, \"init\"));\n      stubs.push(sinon.stub(typeRegistry, \"init\"));\n      registry.init({\n        settings: {}\n      });\n      installer.init.called.should.be.true();\n      loader.init.called.should.be.true();\n      typeRegistry.init.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the module and returns its info","suites":["red/registry/index","#addModule"],"updatePoint":{"line":55,"column":45,"index":1745},"line":55,"code":"    it('loads the module and returns its info', function (done) {\n      stubs.push(sinon.stub(loader, \"addModule\").callsFake(function (module) {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function (module) {\n        return \"info\";\n      }));\n      registry.addModule(\"foo\").then(function (info) {\n        info.should.eql(\"info\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects if loader rejects","suites":["red/registry/index","#addModule"],"updatePoint":{"line":69,"column":33,"index":2219},"line":69,"code":"    it('rejects if loader rejects', function (done) {\n      stubs.push(sinon.stub(loader, \"addModule\").callsFake(function (module) {\n        return Promise.reject(\"error\");\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function (module) {\n        return \"info\";\n      }));\n      registry.addModule(\"foo\").then(function (info) {\n        done(new Error(\"unexpected resolve\"));\n      }).catch(function (err) {\n        err.should.eql(\"error\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables a node set","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":85,"column":26,"index":2766},"line":85,"code":"    it('enables a node set', function (done) {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getNodeInfo\").callsFake(function () {\n        return {\n          id: \"node-set\",\n          loaded: true\n        };\n      }));\n      registry.enableNode(\"node-set\").then(function (ns) {\n        typeRegistry.enableNodeSet.called.should.be.true();\n        ns.should.have.a.property('id', 'node-set');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects if node unknown","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":103,"column":31,"index":3372},"line":103,"code":"    it('rejects if node unknown', function () {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        throw new Error('failure');\n      }));\n      /*jshint immed: false */\n\n      (function () {\n        registry.enableNode(\"node-set\");\n      }).should.throw();\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"triggers a node load","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":113,"column":28,"index":3674},"line":113,"code":"    it('triggers a node load', function (done) {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      var calls = 0;\n      stubs.push(sinon.stub(typeRegistry, \"getNodeInfo\").callsFake(function () {\n        // loaded=false on first call, true on subsequent\n        return {\n          id: \"node-set\",\n          loaded: calls++ > 0\n        };\n      }));\n      stubs.push(sinon.stub(loader, \"loadNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getFullNodeInfo\"));\n      registry.enableNode(\"node-set\").then(function (ns) {\n        typeRegistry.enableNodeSet.called.should.be.true();\n        loader.loadNodeSet.called.should.be.true();\n        ns.should.have.a.property('id', 'node-set');\n        ns.should.have.a.property('loaded', true);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects module name that includes version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":93,"column":49,"index":2413},"line":93,"code":"    it(\"rejects module name that includes version\", function (done) {\n      installer.installModule(\"module@version\", null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects missing module name","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":99,"column":35,"index":2653},"line":99,"code":"    it(\"rejects missing module name\", function (done) {\n      installer.installModule(\"\", null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects null module name","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":105,"column":32,"index":2876},"line":105,"code":"    it(\"rejects null module name\", function (done) {\n      installer.installModule(null, null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid url","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":111,"column":27,"index":3096},"line":111,"code":"    it(\"rejects invalid url\", function (done) {\n      installer.installModule(\"module\", null, \"abc\").catch(function (err) {\n        err.code.should.be.eql('invalid_module_url');\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when npm returns a 404","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":117,"column":38,"index":3319},"line":117,"code":"    it(\"rejects when npm returns a 404\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" 404  this_wont_exist\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(\"this_wont_exist\").catch(function (err) {\n        err.should.have.property(\"code\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when npm does not find specified version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":131,"column":56,"index":3750},"line":131,"code":"    it(\"rejects when npm does not find specified version\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" version not found: this_wont_exist@0.1.2\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n        err.code.should.be.eql(404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested to existing version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":150,"column":57,"index":4338},"line":150,"code":"    it(\"rejects when update requested to existing version\", function (done) {\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          user: true,\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.1\").catch(function (err) {\n        err.code.should.be.eql('module_already_loaded');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested to existing version and url","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":162,"column":65,"index":4767},"line":162,"code":"    it(\"rejects when update requested to existing version and url\", function (done) {\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          user: true,\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.1\", \"https://example/foo-0.1.1.tgz\").catch(function (err) {\n        err.code.should.be.eql('module_already_loaded');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects with generic error","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":174,"column":34,"index":5198},"line":174,"code":"    it(\"rejects with generic error\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" kaboom!\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(\"this_wont_exist\").then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(err => {\n        // Expected result\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when module is found","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":190,"column":37,"index":5632},"line":190,"code":"    it(\"succeeds when module is found\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\").then(function (info) {\n        info.should.eql(nodeInfo); // commsMessages.should.have.length(1);\n        // commsMessages[0].topic.should.equal(\"node/added\");\n        // commsMessages[0].msg.should.eql(nodeInfo.nodes);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when non-existant path is provided","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":216,"column":50,"index":6429},"line":216,"code":"    it(\"rejects when non-existant path is provided\", function (done) {\n      this.timeout(20000);\n      var resourcesDir = path.resolve(path.join(__dirname, \"resources\", \"local\", \"TestNodeModule\", \"node_modules\", \"NonExistant\"));\n      installer.installModule(resourcesDir).then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(function (err) {\n        if (err.hasOwnProperty(\"code\")) {\n          err.code.should.eql(404);\n          done();\n        } else {\n          console.log(\"ERRROR::\" + err.toString() + \"::\");\n          err.toString().should.eql(\"Error: Install failed\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when path is valid node-red module","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":232,"column":51,"index":7082},"line":232,"code":"    it(\"succeeds when path is valid node-red module\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      var resourcesDir = path.resolve(path.join(__dirname, \"resources\", \"local\", \"TestNodeModule\", \"node_modules\", \"TestNodeModule\"));\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(resourcesDir).then(function (info) {\n        info.should.eql(nodeInfo);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when url is valid node-red module","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":256,"column":50,"index":7846},"line":256,"code":"    it(\"succeeds when url is valid node-red module\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", null, \"https://example/foo-0.1.1.tgz\").then(function (info) {\n        info.should.eql(nodeInfo);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"triggers preInstall and postInstall hooks","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":279,"column":49,"index":8518},"line":279,"code":"    it(\"triggers preInstall and postInstall hooks\", function (done) {\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        event.args = [\"a\"];\n        receivedPreEvent = event;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").then(function (info) {\n        exec.run.called.should.be.true();\n        exec.run.lastCall.args[1].should.eql(['install', 'a', 'this_wont_exist@1.2.3']);\n        info.should.eql(nodeInfo);\n        should.exist(receivedPreEvent);\n        receivedPreEvent.should.have.property(\"module\", \"this_wont_exist\");\n        receivedPreEvent.should.have.property(\"version\", \"1.2.3\");\n        receivedPreEvent.should.have.property(\"dir\");\n        receivedPreEvent.should.have.property(\"url\");\n        receivedPreEvent.should.have.property(\"isExisting\");\n        receivedPreEvent.should.have.property(\"isUpgrade\");\n        receivedPreEvent.should.eql(receivedPostEvent);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"fails install if preInstall hook fails","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":320,"column":46,"index":10019},"line":320,"code":"    it(\"fails install if preInstall hook fails\", function (done) {\n      let receivedEvent;\n      hooks.add(\"preInstall\", function (event) {\n        throw new Error(\"preInstall-error\");\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").catch(function (err) {\n        exec.run.called.should.be.false();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"skips invoking npm if preInstall returns false","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":336,"column":54,"index":10500},"line":336,"code":"    it(\"skips invoking npm if preInstall returns false\", function (done) {\n      let receivedEvent;\n      hooks.add(\"preInstall\", function (event) {\n        return false;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedEvent = event;\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").then(function () {\n        exec.run.called.should.be.false();\n        should.exist(receivedEvent);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rollsback install if postInstall hook fails","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":359,"column":51,"index":11213},"line":359,"code":"    it(\"rollsback install if postInstall hook fails\", function (done) {\n      hooks.add(\"postInstall\", function (event) {\n        throw new Error(\"fail\");\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").catch(function (err) {\n        exec.run.calledTwice.should.be.true();\n        exec.run.firstCall.args[1].includes(\"install\").should.be.true();\n        exec.run.secondCall.args[1].includes(\"remove\").should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with allowUpdate set to false","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":371,"column":69,"index":11764},"line":371,"code":"      it(\"rejects when update requested with allowUpdate set to false\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdate: false\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when update requested with module not on denyUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":390,"column":74,"index":12369},"line":390,"code":"      it(\"succeeds when update requested with module not on denyUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              denyUpdateList: ['this_wont_exist']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_is_allowed\", \"0.1.2\").then(function () {\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with module on denyUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":428,"column":69,"index":13522},"line":428,"code":"      it(\"rejects when update requested with module on denyUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              denyUpdateList: ['this_wont_exist']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when update requested with module on allowUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":467,"column":71,"index":14737},"line":467,"code":"      it(\"succeeds when update requested with module on allowUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdateList: ['this_is_allowed']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_is_allowed\", \"0.1.2\").then(function () {\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with module not on allowUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":505,"column":74,"index":15896},"line":505,"code":"      it(\"rejects when update requested with module not on allowUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdateList: ['this_is_allowed']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_wont_exist\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid module names","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":547,"column":36,"index":17137},"line":547,"code":"    it(\"rejects invalid module names\", function (done) {\n      var promises = [];\n      var rejectedCount = 0;\n      promises.push(installer.uninstallModule(\"this_wont_exist \").catch(() => {\n        rejectedCount++;\n      }));\n      promises.push(installer.uninstallModule(\"this_wont_exist;no_it_really_wont\").catch(() => {\n        rejectedCount++;\n      }));\n      Promise.all(promises).then(function () {\n        rejectedCount.should.eql(2);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects with generic error","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":561,"column":34,"index":17625},"line":561,"code":"    it(\"rejects with generic error\", function (done) {\n      var nodeInfo = [{\n        module: \"foo\",\n        types: [\"a\"]\n      }];\n      var removeModule = sinon.stub(registry, \"removeModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \"error\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.uninstallModule(\"this_wont_exist\").then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(err => {\n        // Expected result\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when module is found","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":584,"column":37,"index":18276},"line":584,"code":"    it(\"succeeds when module is found\", function (done) {\n      var nodeInfo = [{\n        module: \"foo\",\n        types: [\"a\"]\n      }];\n      var removeModule = sinon.stub(typeRegistry, \"removeModule\").callsFake(function (md) {\n        return nodeInfo;\n      });\n      var getModuleInfo = sinon.stub(registry, \"getModuleInfo\").callsFake(function (md) {\n        return {\n          nodes: []\n        };\n      });\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      sinon.stub(fs, \"statSync\").callsFake(function (fn) {\n        return {};\n      });\n      installer.uninstallModule(\"this_wont_exist\").then(function (info) {\n        info.should.eql(nodeInfo); // commsMessages.should.have.length(1);\n        // commsMessages[0].topic.should.equal(\"node/removed\");\n        // commsMessages[0].msg.should.eql(nodeInfo);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"returns null list when no modules have been registered","suites":["library api"],"updatePoint":{"line":27,"column":60,"index":940},"line":27,"code":"  it('returns null list when no modules have been registered', function () {\n    library.init();\n    should.not.exist(library.getExampleFlows());\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"returns null path when module is not known","suites":["library api"],"updatePoint":{"line":31,"column":48,"index":1080},"line":31,"code":"  it('returns null path when module is not known', function () {\n    library.init();\n    should.not.exist(library.getExampleFlowPath('foo', 'bar'));\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid example path","suites":["library api"],"updatePoint":{"line":35,"column":34,"index":1221},"line":35,"code":"  it('returns a valid example path', function (done) {\n    library.init();\n    library.addExamplesDir(\"test-module\", path.resolve(__dirname + '/resources/examples')).then(function () {\n      try {\n        var flows = library.getExampleFlows();\n        flows.should.deepEqual({\n          \"test-module\": {\n            \"f\": [\"one\"]\n          }\n        });\n        var examplePath = library.getExampleFlowPath('test-module', 'one');\n        examplePath.should.eql(path.resolve(__dirname + '/resources/examples/one.json'));\n        library.removeExamplesDir('test-module');\n\n        try {\n          should.not.exist(library.getExampleFlows());\n          should.not.exist(library.getExampleFlowPath('test-module', 'one'));\n          done();\n        } catch (err) {\n          done(err);\n        }\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"load empty set without settings available","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":49,"column":49,"index":1555},"line":49,"code":"    it(\"load empty set without settings available\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        return {};\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return false;\n          }\n        }\n      });\n      loader.load(true).then(function () {\n        localfilesystem.getNodeFiles.called.should.be.true();\n        localfilesystem.getNodeFiles.lastCall.args[0].should.be.true();\n        registry.saveNodeList.called.should.be.false();\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load empty set with settings available triggers registery save","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":75,"column":70,"index":2377},"line":75,"code":"    it(\"load empty set with settings available triggers registery save\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        return {};\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load(true).then(function () {\n        registry.saveNodeList.called.should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - single node single file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":101,"column":69,"index":3113},"line":101,"code":"    it(\"load core node files scanned by lfs - single node single file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"node-red/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true);\n        module.nodes.TestNode1.should.have.property(\"types\");\n        module.nodes.TestNode1.types.should.have.a.length(1);\n        module.nodes.TestNode1.types[0].should.eql('test-node-1');\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.config.should.not.eql(\"\");\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.help.should.have.property(\"en-US\");\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode1');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-1');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - ignore html if disableEditor true","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":170,"column":79,"index":5999},"line":170,"code":"    it(\"load core node files scanned by lfs - ignore html if disableEditor true\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          disableEditor: true,\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"node-red/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true); // With disableEditor true, the types property is not populated by the\n        // html file - but instead is populated as nodes register themselves.\n        // But for this test, we have stubbed out registerType, so we won't get any types\n        // module.nodes.TestNode1.should.have.property(\"types\");\n        // module.nodes.TestNode1.types.should.have.a.length(1);\n        // module.nodes.TestNode1.types[0].should.eql('test-node-1');\n        // With disableEditor set, config should be blank\n\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.config.should.eql(\"\"); // help should be an empty object\n\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.help.should.eql({});\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode1');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-1');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - multiple nodes single file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":245,"column":72,"index":9232},"line":245,"code":"    it(\"load core node files scanned by lfs - multiple nodes single file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"4.5.6\",\n          \"nodes\": {\n            \"MultipleNodes1\": {\n              \"file\": path.join(resourcesDir, \"MultipleNodes1\", \"MultipleNodes1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"MultipleNodes1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"4.5.6\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"id\", \"node-red/MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"module\", \"node-red\");\n        module.nodes.MultipleNodes1.should.have.property(\"name\", \"MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"file\");\n        module.nodes.MultipleNodes1.should.have.property(\"template\");\n        module.nodes.MultipleNodes1.should.have.property(\"enabled\", true);\n        module.nodes.MultipleNodes1.should.have.property(\"loaded\", true);\n        module.nodes.MultipleNodes1.should.have.property(\"types\");\n        module.nodes.MultipleNodes1.types.should.have.a.length(2);\n        module.nodes.MultipleNodes1.types[0].should.eql('test-node-multiple-1a');\n        module.nodes.MultipleNodes1.types[1].should.eql('test-node-multiple-1b');\n        module.nodes.MultipleNodes1.should.have.property(\"config\");\n        module.nodes.MultipleNodes1.should.have.property(\"help\");\n        module.nodes.MultipleNodes1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledTwice.should.be.true();\n        nodes.registerType.firstCall.args[0].should.eql('node-red/MultipleNodes1');\n        nodes.registerType.firstCall.args[1].should.eql('test-node-multiple-1a');\n        nodes.registerType.secondCall.args[0].should.eql('node-red/MultipleNodes1');\n        nodes.registerType.secondCall.args[1].should.eql('test-node-multiple-1b');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - node with promise","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":315,"column":63,"index":12355},"line":315,"code":"    it(\"load core node files scanned by lfs - node with promise\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"2.4.6\",\n          \"nodes\": {\n            \"TestNode2\": {\n              \"file\": path.join(resourcesDir, \"TestNode2\", \"TestNode2.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode2\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"2.4.6\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"id\", \"node-red/TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode2.should.have.property(\"name\", \"TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"file\");\n        module.nodes.TestNode2.should.have.property(\"template\");\n        module.nodes.TestNode2.should.have.property(\"enabled\", true);\n        module.nodes.TestNode2.should.have.property(\"loaded\", true);\n        module.nodes.TestNode2.should.have.property(\"types\");\n        module.nodes.TestNode2.types.should.have.a.length(1);\n        module.nodes.TestNode2.types[0].should.eql('test-node-2');\n        module.nodes.TestNode2.should.have.property(\"config\");\n        module.nodes.TestNode2.should.have.property(\"help\");\n        module.nodes.TestNode2.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.TestNode2.should.not.have.property('err');\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode2');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-2');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - node with rejecting promise","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":383,"column":73,"index":15174},"line":383,"code":"    it(\"load core node files scanned by lfs - node with rejecting promise\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode3\": {\n              \"file\": path.join(resourcesDir, \"TestNode3\", \"TestNode3.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"id\", \"node-red/TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode3.should.have.property(\"name\", \"TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"file\");\n        module.nodes.TestNode3.should.have.property(\"template\");\n        module.nodes.TestNode3.should.have.property(\"enabled\", true);\n        module.nodes.TestNode3.should.have.property(\"loaded\", false);\n        module.nodes.TestNode3.should.have.property(\"types\");\n        module.nodes.TestNode3.types.should.have.a.length(1);\n        module.nodes.TestNode3.types[0].should.eql('test-node-3');\n        module.nodes.TestNode3.should.have.property(\"config\");\n        module.nodes.TestNode3.should.have.property(\"help\");\n        module.nodes.TestNode3.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.TestNode3.should.have.property('err', 'fail');\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - missing file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":449,"column":58,"index":17831},"line":449,"code":"    it(\"load core node files scanned by lfs - missing file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"DoesNotExist\": {\n              \"file\": path.join(resourcesDir, \"doesnotexist\"),\n              \"module\": \"node-red\",\n              \"name\": \"DoesNotExist\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      })); // This module isn't already loaded\n\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"id\", \"node-red/DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"module\", \"node-red\");\n        module.nodes.DoesNotExist.should.have.property(\"name\", \"DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"file\");\n        module.nodes.DoesNotExist.should.have.property(\"template\");\n        module.nodes.DoesNotExist.should.have.property(\"enabled\", true);\n        module.nodes.DoesNotExist.should.have.property(\"loaded\", false);\n        module.nodes.DoesNotExist.should.have.property(\"types\");\n        module.nodes.DoesNotExist.types.should.have.a.length(0);\n        module.nodes.DoesNotExist.should.have.property(\"config\", \"\");\n        module.nodes.DoesNotExist.should.have.property(\"help\", {});\n        module.nodes.DoesNotExist.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.DoesNotExist.should.have.property('err');\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }); // it(\"load core node files scanned by lfs - missing html file\", function(done) {","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":570,"column":44,"index":23384},"line":570,"code":"    it(\"throws error if settings unavailable\", function () {\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return false;\n          }\n        }\n      });\n      /*jshint immed: false */\n\n      (function () {\n        loader.addModule(\"test-module\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns rejected error if module already loaded","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":589,"column":55,"index":23846},"line":589,"code":"    it(\"returns rejected error if module already loaded\", function (done) {\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"test-module\").catch(function (err) {\n        err.code.should.eql(\"module_already_loaded\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns rejected error if module not found","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":610,"column":50,"index":24415},"line":610,"code":"    it(\"returns rejected error if module not found\", function (done) {\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        throw new Error(\"failure\");\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"test-module\").catch(function (err) {\n        err.message.should.eql(\"failure\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads module by name","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":634,"column":28,"index":25087},"line":634,"code":"    it(\"loads module by name\", function (done) {\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        var result = {};\n        result[\"TestNodeModule\"] = {\n          \"name\": \"TestNodeModule\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNodeModule\", \"node_modules\", \"TestNodeModule\", \"TestNodeModule.js\"),\n              \"module\": \"TestNodeModule\",\n              \"name\": \"TestNode1\",\n              \"version\": \"1.2.3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return \"a node list\";\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"TestNodeModule\").then(function (result) {\n        result.should.eql(\"TestNodeModule\");\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"TestNodeModule\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"TestNodeModule/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"TestNodeModule\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true);\n        module.nodes.TestNode1.should.have.property(\"types\");\n        module.nodes.TestNode1.types.should.have.a.length(1);\n        module.nodes.TestNode1.types[0].should.eql('test-node-mod-1');\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"TestNodeModule\");\n        module.nodes.TestNode1.should.not.have.property('err');\n        nodes.registerType.calledOnce.should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"skips module that fails version check","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":705,"column":45,"index":28051},"line":705,"code":"    it(\"skips module that fails version check\", function (done) {\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        var result = {};\n        result[\"TestNodeModule\"] = {\n          \"name\": \"TestNodeModule\",\n          \"version\": \"1.2.3\",\n          \"redVersion\": \"999.0.0\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNodeModule\", \"node_modules\", \"TestNodeModule\", \"TestNodeModule.js\"),\n              \"module\": \"TestNodeModule\",\n              \"name\": \"TestNode1\",\n              \"version\": \"1.2.3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return \"a node list\";\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        log: {\n          \"_\": function () {},\n          warn: function () {}\n        },\n        nodes: nodes,\n        version: function () {\n          return \"0.12.0\";\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"TestNodeModule\").then(function (result) {\n        result.should.eql(\"TestNodeModule\");\n        registry.addModule.called.should.be.false();\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"registers a message catalog","suites":["red/nodes/registry/loader","#addModule"],"line":761,"code":"    it.skip('registers a message catalog');","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":true,"dir":"test"},{"name":"no-ops the load if node is not enabled","suites":["red/nodes/registry/loader","#loadNodeSet"],"updatePoint":{"line":764,"column":46,"index":29957},"line":764,"code":"    it(\"no-ops the load if node is not enabled\", function (done) {\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.loadNodeSet({\n        \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n        \"module\": \"node-red\",\n        \"name\": \"TestNode1\",\n        \"enabled\": false\n      }).then(function (node) {\n        node.enabled.should.be.false();\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"handles node that errors on require","suites":["red/nodes/registry/loader","#loadNodeSet"],"updatePoint":{"line":779,"column":43,"index":30465},"line":779,"code":"    it(\"handles node that errors on require\", function (done) {\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.loadNodeSet({\n        \"file\": path.join(resourcesDir, \"TestNode4\", \"TestNode4.js\"),\n        \"module\": \"node-red\",\n        \"name\": \"TestNode4\",\n        \"enabled\": true\n      }).then(function (node) {\n        node.enabled.should.be.true();\n        nodes.registerType.called.should.be.false();\n        node.should.have.property('err');\n        node.err.toString().should.eql(\"Error: fail to require (line:1)\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns preloaded help","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":798,"column":30,"index":31122},"line":798,"code":"    it(\"returns preloaded help\", function () {\n      loader.getNodeHelp({\n        help: {\n          en: \"foo\"\n        }\n      }, \"en\").should.eql(\"foo\");\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, caching result","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":805,"column":34,"index":31288},"line":805,"code":"    it(\"loads help, caching result\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        return 'bar';\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {\n          en: \"foo\"\n        }\n      };\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      node.help['fr'].should.eql(\"bar\");\n      fs.readFileSync.calledOnce.should.be.true();\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      fs.readFileSync.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, defaulting to en-US content","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":822,"column":47,"index":31960},"line":822,"code":"    it(\"loads help, defaulting to en-US content\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      node.help['en-US'] = 'foo';\n      loader.getNodeHelp(node, \"fr\").should.eql(\"foo\");\n      node.help['fr'].should.eql(\"foo\");\n      fs.readFileSync.calledOnce.should.be.true();\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"foo\");\n      fs.readFileSync.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, defaulting to en-US content for extra nodes","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":838,"column":63,"index":32669},"line":838,"code":"    it(\"loads help, defaulting to en-US content for extra nodes\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        if (path.indexOf(\"en-US\") >= 0) {\n          return 'bar';\n        }\n\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      delete node.help['en-US'];\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      node.help['fr'].should.eql(\"bar\");\n      fs.readFileSync.calledTwice.should.be.true();\n      fs.readFileSync.firstCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en-US/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      fs.readFileSync.calledTwice.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"fails to load en-US help content","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":859,"column":40,"index":33548},"line":859,"code":"    it(\"fails to load en-US help content\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      delete node.help['en-US'];\n      should.not.exist(loader.getNodeHelp(node, \"en-US\"));\n      should.not.exist(node.help['en-US']);\n      fs.readFileSync.calledTwice.should.be.true();\n      fs.readFileSync.firstCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en-US/file.html\"));\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en/file.html\"));\n      should.not.exist(loader.getNodeHelp(node, \"en-US\"));\n      fs.readFileSync.callCount.should.eql(4);\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"Finds all the node files in the resources tree","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":77,"column":54,"index":2869},"line":77,"code":"    it(\"Finds all the node files in the resources tree\", function (done) {\n      localfilesystem.init({\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      var nodes = nm.nodes;\n      checkNodes(nm.nodes, ['TestNode1', 'MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4'], ['TestNodeModule']);\n      i18n.registerMessageCatalog.called.should.be.true();\n      i18n.registerMessageCatalog.lastCall.args[0].should.eql('node-red');\n      i18n.registerMessageCatalog.lastCall.args[1].should.eql(path.resolve(path.join(resourcesDir, \"locales\")));\n      i18n.registerMessageCatalog.lastCall.args[2].should.eql('messages.json');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Includes node files from settings","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":94,"column":41,"index":3756},"line":94,"code":"    it(\"Includes node files from settings\", function (done) {\n      localfilesystem.init({\n        nodesIncludes: ['TestNode1.js'],\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode1'], ['MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4', 'TestNodeModule']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Excludes node files from settings","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":107,"column":41,"index":4329},"line":107,"code":"    it(\"Excludes node files from settings\", function (done) {\n      localfilesystem.init({\n        nodesExcludes: ['TestNode1.js'],\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4'], ['TestNode1', 'TestNodeModule']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in userDir/nodes","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":120,"column":36,"index":4897},"line":120,"code":"    it(\"Finds nodes in userDir/nodes\", function (done) {\n      localfilesystem.init({\n        userDir: userDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (string)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":132,"column":49,"index":5351},"line":132,"code":"    it(\"Finds nodes in settings.nodesDir (string)\", function (done) {\n      localfilesystem.init({\n        nodesDir: userDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (string,relative path)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":144,"column":63,"index":5820},"line":144,"code":"    it(\"Finds nodes in settings.nodesDir (string,relative path)\", function (done) {\n      var relativeUserDir = path.join(\"test\", \"unit\", \"@node-red\", \"registry\", \"lib\", \"resources\", \"userDir\");\n      localfilesystem.init({\n        nodesDir: relativeUserDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (array)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":157,"column":48,"index":6393},"line":157,"code":"    it(\"Finds nodes in settings.nodesDir (array)\", function (done) {\n      localfilesystem.init({\n        nodesDir: [userDir]\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes and icons only in nodesDir with files, icons and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":169,"column":92,"index":6893},"line":169,"code":"    it(\"Finds nodes and icons only in nodesDir with files, icons and valid node-red packages\", function (done) {\n      localfilesystem.init({\n        nodesDir: nodesDir1\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      nm.should.have.a.property(\"icons\");\n      checkNodes(nm.nodes, ['loose1', 'loose2'], []); //1 icon in nodesDir1/icons/  - should be found\n      //2 icons in nodesDir1/loose2/icons/  - should be found\n      //1 icons in nodesDir1/node-red-node-testnode/icons/  - should be found\n      //1 icons in nodesDir1/regular_module/icons/  - should NOT be found\n      //total icon sets 3, total icons 4\n\n      nm.icons.should.have.a.property(\"length\", 3);\n      nm.icons[0].should.have.a.property(\"path\");\n      nm.icons[0].should.have.a.property(\"icons\", ['loose1.svg']);\n      nm.icons[1].should.have.a.property(\"path\");\n      nm.icons[1].should.have.a.property(\"icons\", ['loose2.svg', 'loose2b.svg']);\n      nm.icons[2].should.have.a.property(\"path\");\n      nm.icons[2].should.have.a.property(\"icons\", ['test.svg']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Should not find node-red node in nodesDir with files, icons and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":194,"column":95,"index":8158},"line":194,"code":"    it(\"Should not find node-red node in nodesDir with files, icons and valid node-red packages\", function (done) {\n      // path contains a regular node module and a node-red node module\n      localfilesystem.init({\n        nodesDir: path.join(nodesDir1)\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      nm.nodes.should.have.a.property(\"loose1\");\n      nm.nodes.should.have.a.property(\"loose2\");\n      nm.nodes.should.not.have.a.property(\"regular_module\");\n      nm.nodes.should.not.have.a.property(\"node-red-node-testnode\");\n\n      for (let key of Object.keys(nm.nodes)) {\n        const n = nm.nodes[key];\n        n.file.indexOf(\"regular_module\").should.eql(-1, `found icons in a node-red module`);\n        n.file.indexOf(\"node-red-node-testnode\").should.eql(-1, `found icons in a node-red module`);\n      } //1 icon in nodesDir1/icons/  - should be found\n      //2 icons in nodesDir1/loose2/icons/  - should be found\n      //1 icons in nodesDir1/node-red-node-testnode/icons/  - should be found\n      //1 icons in nodesDir1/regular_module/icons/  - should NOT be found\n      //total icon sets 3, total icons 4\n\n\n      nm.should.have.a.property(\"icons\");\n      nm.icons.should.have.a.property(\"length\", 3);\n      let iconCount = 0;\n\n      for (let index = 0; index < nm.icons.length; index++) {\n        const iconDir = nm.icons[index];\n        iconCount += iconDir.icons.length;\n        iconDir.path.indexOf(\"node-red-node-testnode\").should.eql(-1, `should not find icons in a node-red module`);\n      }\n\n      should(iconCount).eql(4, \"Should find only 4 icons\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Should not find node-red node in nodesDir when regular package and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":233,"column":98,"index":9961},"line":233,"code":"    it(\"Should not find node-red node in nodesDir when regular package and valid node-red packages\", function (done) {\n      localfilesystem.init({\n        nodesDir: path.join(nodesDir1, \"regular_module\")\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\", {});\n      nm.should.have.a.property(\"icons\");\n      nm.icons.should.have.a.property(\"length\", 1); //should find 1 icons folder\n\n      nm.icons[0].should.have.a.property(\"icons\", ['test.svg']); //should find 1 icon in regular package\n\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes module path","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":249,"column":31,"index":10609},"line":249,"code":"    it(\"Finds nodes module path\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeList = localfilesystem.getNodeFiles();\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red']; // The `node-red` module is loaded differently to those scanned for\n      // It doesn't get the `path` property set. Maybe it should.\n\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, [], ['TestNode1']);\n      nm = nodeList['TestNodeModule'];\n      nm.should.have.a.property('path');\n      nm.should.have.a.property('name', 'TestNodeModule');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNodeMod1', 'TestNodeMod2'], [], 'TestNodeModule');\n      nm = nodeList['VersionMismatchModule'];\n      nm.should.have.a.property('path');\n      nm.should.have.a.property('name', 'VersionMismatchModule');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['VersionMismatchMod1', 'VersionMismatchMod2'], [], 'VersionMismatchModule');\n      i18n.registerMessageCatalog.called.should.be.true();\n      i18n.registerMessageCatalog.lastCall.args[0].should.eql('node-red');\n      i18n.registerMessageCatalog.lastCall.args[1].should.eql(path.resolve(path.join(moduleDir, \"locales\")));\n      i18n.registerMessageCatalog.lastCall.args[2].should.eql('messages.json');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"finds locales directory","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"line":278,"code":"    it.skip(\"finds locales directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"finds icon path directory","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"line":279,"code":"    it.skip(\"finds icon path directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"scans icon files in the resources tree","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":280,"column":46,"index":12180},"line":280,"code":"    it(\"scans icon files in the resources tree\", function (done) {\n      var count = 0;\n      localfilesystem.init({\n        coreNodesDir: resourcesDir\n      });\n      var list = localfilesystem.getNodeFiles(true);\n      list.should.have.property(\"node-red\");\n      list[\"node-red\"].should.have.property(\"icons\");\n      list[\"node-red\"].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].should.have.property(\"path\", path.join(__dirname, \"resources/local/NestedDirectoryNode/NestedNode/icons\"));\n      list[\"node-red\"].icons[0].should.have.property(\"icons\");\n      list[\"node-red\"].icons[0].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].icons[0].should.eql(\"arrow-in.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"scans icons dir in library","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":295,"column":34,"index":12889},"line":295,"code":"    it(\"scans icons dir in library\", function (done) {\n      var count = 0;\n      localfilesystem.init({\n        userDir: userDir\n      });\n      var list = localfilesystem.getNodeFiles(true);\n      list.should.have.property(\"node-red\");\n      list[\"node-red\"].should.have.property(\"icons\");\n      list[\"node-red\"].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].should.have.property(\"path\", path.join(__dirname, \"resources/userDir/lib/icons\"));\n      list[\"node-red\"].icons[0].should.have.property(\"icons\");\n      list[\"node-red\"].icons[0].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].icons[0].should.eql(\"test_icon.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"gets a nodes module files","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":312,"column":33,"index":13613},"line":312,"code":"    it(\"gets a nodes module files\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeModule = localfilesystem.getModuleFiles('TestNodeModule');\n      nodeModule.should.have.a.property('TestNodeModule');\n      nodeModule['TestNodeModule'].should.have.a.property('name', 'TestNodeModule');\n      nodeModule['TestNodeModule'].should.have.a.property('version', '0.0.1');\n      nodeModule['TestNodeModule'].should.have.a.property('nodes');\n      nodeModule['TestNodeModule'].should.have.a.property('path');\n      checkNodes(nodeModule['TestNodeModule'].nodes, ['TestNodeMod1', 'TestNodeMod2'], [], 'TestNodeModule');\n      nodeModule = localfilesystem.getModuleFiles('VersionMismatchModule');\n      nodeModule.should.have.a.property('VersionMismatchModule');\n      nodeModule['VersionMismatchModule'].should.have.a.property('redVersion', '100.0.0');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds only 1 node-red node in nodesDir amongst legacy nodes and regular nodes","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":329,"column":85,"index":14608},"line":329,"code":"    it(\"Finds only 1 node-red node in nodesDir amongst legacy nodes and regular nodes\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir1, \"node-red-node-testnode\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 1);\n      loaded.indexOf('node-red-node-testnode').should.greaterThan(-1, \"Should load node-red-node-testnode\");\n      nodeModule['node-red-node-testnode'].should.have.a.property('name', 'node-red-node-testnode');\n      nodeModule['node-red-node-testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['node-red-node-testnode'].should.have.a.property('nodes');\n      nodeModule['node-red-node-testnode'].should.have.a.property('path');\n      nodeModule['node-red-node-testnode'].should.have.a.property('user', false);\n      checkNodes(nodeModule['node-red-node-testnode'].nodes, ['testnode'], [], 'node-red-node-testnode');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds a node-red node in nodesDir with a sub dir containing valid node-red package","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":346,"column":90,"index":15660},"line":346,"code":"    it(\"Finds a node-red node in nodesDir with a sub dir containing valid node-red package\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir1, \"node-red-node-testnode\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      nodeModule['node-red-node-testnode'].should.have.a.property('name', 'node-red-node-testnode');\n      nodeModule['node-red-node-testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['node-red-node-testnode'].should.have.a.property('nodes');\n      nodeModule['node-red-node-testnode'].should.have.a.property('path');\n      nodeModule['node-red-node-testnode'].should.have.a.property('user', false);\n      checkNodes(nodeModule['node-red-node-testnode'].nodes, ['testnode'], [], 'node-red-node-testnode');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds 2 node-red modules and 1 plugin in nodesDir (in root of dir)","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":361,"column":74,"index":16537},"line":361,"code":"    it(\"Finds 2 node-red modules and 1 plugin in nodesDir (in root of dir)\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [nodesDir2]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 3);\n      loaded.indexOf('@test/testnode').should.greaterThan(-1, \"Should load @test/testnode\");\n      loaded.indexOf('testnode2').should.greaterThan(-1, \"Should load testnode2\");\n      loaded.indexOf('test-theme2').should.greaterThan(-1, \"Should load test-theme2\");\n      nodeModule['@test/testnode'].should.have.a.property('name', '@test/testnode');\n      nodeModule['@test/testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['@test/testnode'].should.have.a.property('nodes');\n      nodeModule['@test/testnode'].should.have.a.property('path');\n      nodeModule['@test/testnode'].should.have.a.property('user', false);\n      nodeModule['testnode2'].should.have.a.property('name', 'testnode2');\n      nodeModule['testnode2'].should.have.a.property('version', '1.0.0');\n      nodeModule['testnode2'].should.have.a.property('nodes');\n      nodeModule['testnode2'].should.have.a.property('path');\n      nodeModule['testnode2'].should.have.a.property('user', false);\n      nodeModule['test-theme2'].should.have.a.property('name', 'test-theme2');\n      nodeModule['test-theme2'].should.have.a.property('version', '0.0.1');\n      nodeModule['test-theme2'].should.have.a.property('nodes', {});\n      nodeModule['test-theme2'].should.have.a.property('path');\n      nodeModule['test-theme2'].should.have.a.property('user', false);\n      nodeModule['test-theme2'].should.have.a.property('plugins');\n      nodeModule['test-theme2'].plugins.should.have.a.property('test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('name', 'test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('module', 'test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('version', '0.0.1');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('file');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('local', false);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds 2 node-red modules and 1 plugin in nodesDir pointing to a node_modules dir","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":396,"column":88,"index":18885},"line":396,"code":"    it(\"Finds 2 node-red modules and 1 plugin in nodesDir pointing to a node_modules dir\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir3, \"node_modules\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 3);\n      loaded.indexOf('@test/testnode').should.greaterThan(-1, \"Should load @test/testnode\");\n      loaded.indexOf('@test/test-theme3').should.greaterThan(-1, \"Should load test-theme3\");\n      loaded.indexOf('testnode3').should.greaterThan(-1, \"Should load testnode3\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if a node isn't found","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":409,"column":45,"index":19515},"line":409,"code":"    it(\"throws an error if a node isn't found\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      /*jshint immed: false */\n\n      (function () {\n        localfilesystem.getModuleFiles('WontExistModule');\n      }).should.throw();\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"finds locales directory","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"line":421,"code":"    it.skip(\"finds locales directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"finds icon path directory","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"line":422,"code":"    it.skip(\"finds icon path directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"scans icon files with a module file","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":423,"column":43,"index":19913},"line":423,"code":"    it(\"scans icon files with a module file\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeModule = localfilesystem.getModuleFiles('TestNodeModule');\n      nodeModule.should.have.property(\"TestNodeModule\");\n      nodeModule.TestNodeModule.should.have.property('icons');\n      nodeModule.TestNodeModule.icons.should.have.length(1);\n      nodeModule.TestNodeModule.icons[0].should.have.property(\"path\");\n      nodeModule.TestNodeModule.icons[0].should.have.property(\"icons\");\n      nodeModule.TestNodeModule.icons[0].icons[0].should.eql(\"arrow-in.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"registers a plugin","suites":["red/nodes/registry/plugins","registerPlugin"],"updatePoint":{"line":56,"column":26,"index":1489},"line":56,"code":"    it(\"registers a plugin\", function () {\n      let pluginDef = {};\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      receivedEvents.length.should.eql(1);\n      receivedEvents[0].should.eql(\"a-plugin\");\n      should.exist(modules['test-module'].plugins['test-set'].plugins[0]);\n      modules['test-module'].plugins['test-set'].plugins[0].should.equal(pluginDef);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"calls a plugins onadd function","suites":["red/nodes/registry/plugins","registerPlugin"],"updatePoint":{"line":64,"column":38,"index":1906},"line":64,"code":"    it(\"calls a plugins onadd function\", function () {\n      let pluginDef = {\n        onadd: sinon.stub()\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      pluginDef.onadd.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered plugin","suites":["red/nodes/registry/plugins","getPlugin"],"updatePoint":{"line":73,"column":35,"index":2195},"line":73,"code":"    it(\"returns a registered plugin\", function () {\n      let pluginDef = {};\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      pluginDef.should.equal(plugins.getPlugin(\"a-plugin\"));\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a plugins of a given type","suites":["red/nodes/registry/plugins","getPluginsByType"],"updatePoint":{"line":80,"column":41,"index":2476},"line":80,"code":"    it(\"returns a plugins of a given type\", function () {\n      let pluginDef = {\n        type: \"foo\"\n      };\n      let pluginDef2 = {\n        type: \"bar\"\n      };\n      let pluginDef3 = {\n        type: \"foo\"\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin2\", pluginDef2);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin3\", pluginDef3);\n      let fooPlugins = plugins.getPluginsByType(\"foo\");\n      let barPlugins = plugins.getPluginsByType(\"bar\");\n      let noPlugins = plugins.getPluginsByType(\"none\");\n      noPlugins.should.be.of.length(0);\n      fooPlugins.should.be.of.length(2);\n      fooPlugins.should.containEql(pluginDef);\n      fooPlugins.should.containEql(pluginDef3);\n      barPlugins.should.be.of.length(1);\n      barPlugins.should.containEql(pluginDef2);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets all plugin configs","suites":["red/nodes/registry/plugins","getPluginConfigs"],"updatePoint":{"line":105,"column":31,"index":3412},"line":105,"code":"    it(\"gets all plugin configs\", function () {\n      let configs = plugins.getPluginConfigs(\"en-US\");\n      configs.should.eql(`\n<!-- --- [red-plugin:test-module/test-set] --- -->\ntest-module-config`);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a plugins of a given type","suites":["red/nodes/registry/plugins","getPluginList"],"updatePoint":{"line":113,"column":41,"index":3681},"line":113,"code":"    it(\"returns a plugins of a given type\", function () {\n      let pluginDef = {\n        type: \"foo\"\n      };\n      let pluginDef2 = {\n        type: \"bar\"\n      };\n      let pluginDef3 = {\n        type: \"foo\"\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin2\", pluginDef2);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin3\", pluginDef3);\n      let pluginList = plugins.getPluginList();\n      JSON.stringify(pluginList).should.eql(JSON.stringify([{\n        \"id\": \"test-module/test-set\",\n        \"enabled\": true,\n        \"local\": false,\n        \"user\": false,\n        \"plugins\": [{\n          \"type\": \"foo\",\n          \"id\": \"a-plugin\",\n          \"module\": \"test-module\"\n        }, {\n          \"type\": \"bar\",\n          \"id\": \"a-plugin2\",\n          \"module\": \"test-module\"\n        }, {\n          \"type\": \"foo\",\n          \"id\": \"a-plugin3\",\n          \"module\": \"test-module\"\n        }]\n      }, {\n        \"id\": \"test-module/test-disabled-set\",\n        \"enabled\": false,\n        \"local\": false,\n        \"user\": false,\n        \"plugins\": []\n      }]));\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"exports plugin settings - default false","suites":["red/nodes/registry/plugins","exportPluginSettings"],"updatePoint":{"line":155,"column":47,"index":4911},"line":155,"code":"    it(\"exports plugin settings - default false\", function () {\n      plugins.init({\n        \"a-plugin\": {\n          a: 123,\n          b: 234,\n          c: 345\n        }\n      });\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", {\n        settings: {\n          a: {\n            exportable: true\n          },\n          b: {\n            exportable: false\n          },\n          d: {\n            exportable: true,\n            value: 456\n          }\n        }\n      });\n      var exportedSet = {};\n      plugins.exportPluginSettings(exportedSet);\n      exportedSet.should.have.property(\"a-plugin\"); // a is exportable\n\n      exportedSet[\"a-plugin\"].should.have.property(\"a\", 123); // b is explicitly not exportable\n\n      exportedSet[\"a-plugin\"].should.not.have.property(\"b\"); // c isn't listed and default false\n\n      exportedSet[\"a-plugin\"].should.not.have.property(\"c\"); // d has a default value\n\n      exportedSet[\"a-plugin\"].should.have.property(\"d\", 456);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"exports plugin settings - default true","suites":["red/nodes/registry/plugins","exportPluginSettings"],"updatePoint":{"line":189,"column":46,"index":5893},"line":189,"code":"    it(\"exports plugin settings - default true\", function () {\n      plugins.init({\n        \"a-plugin\": {\n          a: 123,\n          b: 234,\n          c: 345\n        }\n      });\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", {\n        settings: {\n          '*': {\n            exportable: true\n          },\n          a: {\n            exportable: true\n          },\n          b: {\n            exportable: false\n          },\n          d: {\n            exportable: true,\n            value: 456\n          }\n        }\n      });\n      var exportedSet = {};\n      plugins.exportPluginSettings(exportedSet);\n      exportedSet.should.have.property(\"a-plugin\"); // a is exportable\n\n      exportedSet[\"a-plugin\"].should.have.property(\"a\", 123); // b is explicitly not exportable\n\n      exportedSet[\"a-plugin\"].should.not.have.property(\"b\"); // c isn't listed, but default true\n\n      exportedSet[\"a-plugin\"].should.have.property(\"c\"); // d has a default value\n\n      exportedSet[\"a-plugin\"].should.have.property(\"d\", 456);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"loads initial config","suites":["red/nodes/registry/registry","#init/load"],"updatePoint":{"line":105,"column":28,"index":2640},"line":105,"code":"    it('loads initial config', function (done) {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.load();\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"migrates legacy format","suites":["red/nodes/registry/registry","#init/load"],"updatePoint":{"line":112,"column":30,"index":2924},"line":112,"code":"    it('migrates legacy format', function (done) {\n      var legacySettings = {\n        available: function () {\n          return true;\n        },\n        set: sinon.stub().returns(Promise.resolve()),\n        get: function () {\n          return {\n            \"123\": {\n              \"name\": \"72-sentiment.js\",\n              \"types\": [\"sentiment\"],\n              \"enabled\": true\n            },\n            \"456\": {\n              \"name\": \"20-inject.js\",\n              \"types\": [\"inject\"],\n              \"enabled\": true\n            },\n            \"789\": {\n              \"name\": \"testModule:a-module.js\",\n              \"types\": [\"example\"],\n              \"enabled\": true,\n              \"module\": \"testModule\"\n            }\n          };\n        }\n      };\n      var expected = JSON.parse('{\"node-red\":{\"name\":\"node-red\",\"nodes\":{\"sentiment\":{\"name\":\"sentiment\",\"types\":[\"sentiment\"],\"enabled\":true,\"module\":\"node-red\"},\"inject\":{\"name\":\"inject\",\"types\":[\"inject\"],\"enabled\":true,\"module\":\"node-red\"}}},\"testModule\":{\"name\":\"testModule\",\"nodes\":{\"a-module.js\":{\"name\":\"a-module.js\",\"types\":[\"example\"],\"enabled\":true,\"module\":\"testModule\"}}}}');\n      typeRegistry.init(legacySettings, null);\n      typeRegistry.load();\n      legacySettings.set.calledOnce.should.be.true();\n      legacySettings.set.args[0][1].should.eql(expected);\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"adds a node set for an unknown module","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":148,"column":45,"index":4337},"line":148,"code":"    it('adds a node set for an unknown module', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var moduleList = typeRegistry.getModuleList();\n      moduleList.should.have.a.property(\"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"name\", \"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"version\", \"0.0.1\");\n      moduleList[\"test-module\"].should.have.a.property(\"nodes\");\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      moduleList[\"test-module\"].nodes[\"test-name\"].should.eql({\n        config: 'configA',\n        id: 'test-module/test-name',\n        module: 'test-module',\n        name: 'test-name',\n        enabled: true,\n        loaded: false,\n        types: ['test-a', 'test-b']\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"adds a node set to an existing module","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":170,"column":45,"index":5376},"line":170,"code":"    it('adds a node set to an existing module', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var moduleList = typeRegistry.getModuleList();\n      Object.keys(moduleList).should.have.a.lengthOf(1);\n      moduleList.should.have.a.property(\"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"name\", \"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"version\", \"0.0.1\");\n      moduleList[\"test-module\"].should.have.a.property(\"nodes\");\n      Object.keys(moduleList[\"test-module\"].nodes).should.have.a.lengthOf(1);\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      typeRegistry.addNodeSet(\"test-module/test-name-2\", testNodeSet2);\n      typeRegistry.getNodeList().should.have.lengthOf(2);\n      moduleList = typeRegistry.getModuleList();\n      Object.keys(moduleList).should.have.a.lengthOf(1);\n      Object.keys(moduleList[\"test-module\"].nodes).should.have.a.lengthOf(2);\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name-2\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"doesnt add node set types if node set has an error","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":192,"column":58,"index":6751},"line":192,"code":"    it('doesnt add node set types if node set has an error', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getTypeId(\"test-a\").should.eql(\"test-module/test-name\");\n      should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n      typeRegistry.addNodeSet(\"test-module/test-name-2\", testNodeSet2WithError, \"0.0.1\");\n      should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"doesnt add node set if type already exists","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":202,"column":50,"index":7337},"line":202,"code":"    it('doesnt add node set if type already exists', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      should.not.exist(typeRegistry.getTypeId(\"test-e\"));\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      should.exist(typeRegistry.getTypeId(\"test-a\"));\n      typeRegistry.addNodeSet(testNodeSet3.id, testNodeSet3, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(2); // testNodeSet3 registers a duplicate test-a and unique test-e\n      // as test-a is a duplicate, test-e should not get registered\n\n      should.not.exist(typeRegistry.getTypeId(\"test-e\"));\n      var testNodeSet3Result = typeRegistry.getNodeList()[1];\n      should.exist(testNodeSet3Result.err);\n      testNodeSet3Result.err.code.should.equal(\"type_already_registered\");\n      testNodeSet3Result.err.details.type.should.equal(\"test-a\");\n      testNodeSet3Result.err.details.moduleA.should.equal(\"test-module\");\n      testNodeSet3Result.err.details.moduleB.should.equal(\"test-module-2\"); //\n      // typeRegistry.addNodeSet(\"test-module/test-name-2\",testNodeSet2WithError, \"0.0.1\");\n      //\n      // should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/registry","#enableNodeSet"],"updatePoint":{"line":227,"column":44,"index":8735},"line":227,"code":"    it('throws error if settings unavailable', function () {\n      typeRegistry.init(settings, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.enableNodeSet(\"test-module/test-name\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error if module unknown","suites":["red/nodes/registry/registry","#enableNodeSet"],"updatePoint":{"line":235,"column":38,"index":9000},"line":235,"code":"    it('throws error if module unknown', function () {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.enableNodeSet(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised id: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"enables the node","suites":["red/nodes/registry/registry","#enableNodeSet"],"line":243,"code":"    it.skip('enables the node', function () {});","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/registry","#disableNodeSet"],"updatePoint":{"line":246,"column":44,"index":9411},"line":246,"code":"    it('throws error if settings unavailable', function () {\n      typeRegistry.init(settings, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.disableNodeSet(\"test-module/test-name\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error if module unknown","suites":["red/nodes/registry/registry","#disableNodeSet"],"updatePoint":{"line":254,"column":38,"index":9677},"line":254,"code":"    it('throws error if module unknown', function () {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.disableNodeSet(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised id: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"disables the node","suites":["red/nodes/registry/registry","#disableNodeSet"],"line":262,"code":"    it.skip('disables the node', function () {});","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"returns nothing for an unregistered type config","suites":["red/nodes/registry/registry","#getNodeConfig"],"updatePoint":{"line":265,"column":55,"index":10100},"line":265,"code":"    it('returns nothing for an unregistered type config', function (done) {\n      typeRegistry.init(settings, null);\n      var config = typeRegistry.getNodeConfig(\"imaginary-shark\");\n      (config === null).should.be.true();\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"rejects when settings unavailable","suites":["red/nodes/registry/registry","#saveNodeList"],"updatePoint":{"line":273,"column":41,"index":10381},"line":273,"code":"    it('rejects when settings unavailable', function (done) {\n      typeRegistry.init(stubSettings({}, false, {}), null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            module: \"test-module\",\n            name: \"test-name\",\n            types: []\n          }\n        }\n      });\n      typeRegistry.saveNodeList().catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"saves the list","suites":["red/nodes/registry/registry","#saveNodeList"],"updatePoint":{"line":290,"column":22,"index":10823},"line":290,"code":"    it('saves the list', function (done) {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": testNodeSet1,\n          \"test-name-2\": testNodeSet2WithError\n        }\n      });\n      typeRegistry.saveNodeList().then(function () {\n        s.set.called.should.be.true();\n        s.set.lastCall.args[0].should.eql('nodes');\n        var nodes = s.set.lastCall.args[1];\n        nodes.should.have.property('test-module');\n\n        for (var n in nodes['test-module'].nodes) {\n          if (nodes['test-module'].nodes.hasOwnProperty(n)) {\n            var nn = nodes['test-module'].nodes[n];\n            nn.should.not.have.property('err');\n            nn.should.not.have.property('id');\n          }\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown module","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":322,"column":39,"index":11823},"line":322,"code":"    it('throws error for unknown module', function () {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.removeModule(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised module: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unavaiable settings","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":331,"column":44,"index":12146},"line":331,"code":"    it('throws error for unavaiable settings', function () {\n      var s = stubSettings({}, false, {});\n      typeRegistry.init(s, null);\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.removeModule(\"test-module/unknown\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"removes a known module","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":340,"column":30,"index":12436},"line":340,"code":"    it('removes a known module', function () {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": testNodeSet1\n        }\n      });\n      var moduleList = typeRegistry.getModuleList();\n      moduleList.should.have.a.property(\"test-module\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var info = typeRegistry.removeModule('test-module');\n      moduleList = typeRegistry.getModuleList();\n      moduleList.should.not.have.a.property(\"test-module\");\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node config","suites":["red/nodes/registry/registry","#get[All]NodeConfigs"],"updatePoint":{"line":360,"column":27,"index":13171},"line":360,"code":"    it('returns node config', function () {\n      typeRegistry.init(settings, {\n        getNodeHelp: function (config) {\n          return \"HE\" + config.name + \"LP\";\n        }\n      });\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"]\n          },\n          \"test-name-2\": {\n            id: \"test-module/test-name-2\",\n            module: \"test-module\",\n            name: \"test-name-2\",\n            enabled: true,\n            loaded: false,\n            config: \"configB\",\n            types: [\"test-c\", \"test-d\"]\n          }\n        }\n      });\n      typeRegistry.getNodeConfig(\"test-module/test-name\").should.eql('<!-- --- [red-module:test-module/test-name] --- -->\\nconfigAHEtest-nameLP');\n      typeRegistry.getNodeConfig(\"test-module/test-name-2\").should.eql('<!-- --- [red-module:test-module/test-name-2] --- -->\\nconfigBHEtest-name-2LP');\n      typeRegistry.getAllNodeConfigs().should.eql('\\n<!-- --- [red-module:test-module/test-name] --- -->\\nconfigAHEtest-nameLP\\n<!-- --- [red-module:test-module/test-name-2] --- -->\\nconfigBHEtest-name-2LP');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns module info","suites":["red/nodes/registry/registry","#getModuleInfo"],"updatePoint":{"line":396,"column":27,"index":14590},"line":396,"code":"    it('returns module info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var moduleInfo = typeRegistry.getModuleInfo(\"test-module\");\n      moduleInfo.should.have.a.property('name', 'test-module');\n      moduleInfo.should.have.a.property('version', '0.0.1');\n      moduleInfo.should.have.a.property('nodes');\n      moduleInfo.nodes.should.have.a.lengthOf(1);\n      moduleInfo.nodes[0].should.have.a.property('id', 'test-module/test-name');\n      moduleInfo.nodes[0].should.not.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["red/nodes/registry/registry","#getNodeInfo"],"updatePoint":{"line":424,"column":25,"index":15577},"line":424,"code":"    it('returns node info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var nodeSetInfo = typeRegistry.getNodeInfo(\"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('id', \"test-module/test-name\");\n      nodeSetInfo.should.not.have.a.property('config');\n      nodeSetInfo.should.not.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["red/nodes/registry/registry","#getFullNodeInfo"],"updatePoint":{"line":449,"column":25,"index":16392},"line":449,"code":"    it('returns node info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var nodeSetInfo = typeRegistry.getFullNodeInfo(\"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('id', \"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('config');\n      nodeSetInfo.should.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"cleans the module list","suites":["red/nodes/registry/registry","#cleanModuleList"],"line":474,"code":"    it.skip(\"cleans the module list\");","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"returns a filtered list","suites":["red/nodes/registry/registry","#getNodeList"],"updatePoint":{"line":477,"column":31,"index":17295},"line":477,"code":"    it(\"returns a filtered list\", function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          },\n          \"test-name-2\": {\n            id: \"test-module/test-name-2\",\n            module: \"test-module\",\n            name: \"test-name-2\",\n            enabled: true,\n            loaded: false,\n            config: \"configB\",\n            types: [\"test-c\", \"test-d\"],\n            file: \"def\"\n          }\n        }\n      });\n      var filterCallCount = 0;\n      var filteredList = typeRegistry.getNodeList(function (n) {\n        filterCallCount++;\n        return n.name === 'test-name-2';\n      });\n      filterCallCount.should.eql(2);\n      filteredList.should.have.a.lengthOf(1);\n      filteredList[0].should.have.a.property('id', \"test-module/test-name-2\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"registers a node constructor","suites":["red/nodes/registry/registry","#registerNodeConstructor"],"updatePoint":{"line":525,"column":36,"index":18737},"line":525,"code":"    it('registers a node constructor', function () {\n      typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      events.emit.calledOnce.should.be.true();\n      events.emit.lastCall.args[0].should.eql('type-registered');\n      events.emit.lastCall.args[1].should.eql('node-type');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error on duplicate node registration","suites":["red/nodes/registry/registry","#registerNodeConstructor"],"updatePoint":{"line":531,"column":51,"index":19076},"line":531,"code":"    it('throws error on duplicate node registration', function () {\n      typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      events.emit.calledOnce.should.be.true();\n      events.emit.lastCall.args[0].should.eql('type-registered');\n      events.emit.lastCall.args[1].should.eql('node-type');\n      /*jshint immed: false */\n\n      (function () {\n        typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      }).should.throw(\"node-type already registered\");\n      events.emit.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns the null when getting an unknown icon","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":545,"column":53,"index":19715},"line":545,"code":"    it('returns the null when getting an unknown icon', function () {\n      var iconPath = typeRegistry.getNodeIconPath('random-module', 'youwonthaveme.png');\n      should.not.exist(iconPath);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered icon","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":549,"column":33,"index":19896},"line":549,"code":"    it('returns a registered icon', function () {\n      var testIcon = path.resolve(__dirname + '/resources/userDir/lib/icons/');\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        },\n        icons: [{\n          path: testIcon,\n          icons: ['test_icon.png']\n        }]\n      });\n      var iconPath = typeRegistry.getNodeIconPath('test-module', 'test_icon.png');\n      iconPath.should.eql(path.resolve(testIcon + \"/test_icon.png\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns null when getting an unknown module","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":575,"column":51,"index":20752},"line":575,"code":"    it('returns null when getting an unknown module', function () {\n      var debugIcon = path.resolve(__dirname + '/../../../public/icons/debug.png');\n      var iconPath = typeRegistry.getNodeIconPath('unknown-module', 'debug.png');\n      should.not.exist(iconPath);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns empty icon list when no modules are registered","suites":["red/nodes/registry/registry","#getNodeIcons"],"updatePoint":{"line":582,"column":62,"index":21087},"line":582,"code":"    it('returns empty icon list when no modules are registered', function () {\n      var iconList = typeRegistry.getNodeIcons();\n      iconList.should.eql({});\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns an icon list of registered node module","suites":["red/nodes/registry/registry","#getNodeIcons"],"updatePoint":{"line":586,"column":54,"index":21247},"line":586,"code":"    it('returns an icon list of registered node module', function () {\n      var testIcon = path.resolve(__dirname + '/resources/userDir/lib/icons/');\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        },\n        icons: [{\n          path: testIcon,\n          icons: ['test_icon.png']\n        }]\n      });\n      var iconList = typeRegistry.getNodeIcons();\n      iconList.should.eql({\n        \"test-module\": [\"test_icon.png\"]\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns valid resource path","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":638,"column":35,"index":22703},"line":638,"code":"    it('Returns valid resource path', function () {\n      const result = typeRegistry.getModuleResource(\"test-module\", \"one.json\");\n      should.exist(result);\n      result.should.eql(path.join(__dirname, \"resources\", \"examples\", \"one.json\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns null for path that tries to break out","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":643,"column":53,"index":22973},"line":643,"code":"    it('Returns null for path that tries to break out', function () {\n      // Note - this path exists, but we don't allow .. in the resolved path to\n      // avoid breaking out of the resources dir\n      const result = typeRegistry.getModuleResource(\"test-module\", \"../../index_spec.js\");\n      should.not.exist(result);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns null for path that does not exist","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":649,"column":49,"index":23299},"line":649,"code":"    it('Returns null for path that does not exist', function () {\n      const result = typeRegistry.getModuleResource(\"test-module\", \"two.json\");\n      should.not.exist(result);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS","suites":["red/nodes/registry/subflow"],"line":2,"code":"  it.skip(\"NEEDS TESTS\");","file":"unit/@node-red/registry/lib/subflow_spec.js","skipped":true,"dir":"test"},{"name":"builds node-specific view of runtime api","suites":["red/nodes/registry/util","createNodeApi"],"updatePoint":{"line":46,"column":48,"index":1599},"line":46,"code":"    it(\"builds node-specific view of runtime api\", function () {\n      registryUtil.init(runtime);\n      var result = registryUtil.createNodeApi({\n        id: \"my-node\",\n        namespace: \"my-namespace\"\n      }); // Need a better strategy here.\n      // For now, validate the node-custom functions\n\n      var message = result._(\"message\"); // This should prepend the node's namespace to the message\n\n\n      message.should.eql(['my-namespace:message']);\n\n      var nodeConstructor = () => {};\n\n      var nodeOpts = {};\n      result.nodes.registerType(\"type\", nodeConstructor, nodeOpts);\n      registerType.called.should.be.true();\n      registerType.lastCall.args[0].should.eql(\"my-node\");\n      registerType.lastCall.args[1].should.eql(\"type\");\n      registerType.lastCall.args[2].should.eql(nodeConstructor);\n      registerType.lastCall.args[3].should.eql(nodeOpts);\n      var subflowDef = {};\n      result.nodes.registerSubflow(subflowDef);\n      registerSubflow.called.should.be.true();\n      registerSubflow.lastCall.args[0].should.eql(\"my-node\");\n      registerSubflow.lastCall.args[1].should.eql(subflowDef);\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"allows module with no allow/deny list provided","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":80,"column":54,"index":2996},"line":80,"code":"    it(\"allows module with no allow/deny list provided\", function () {\n      checkList(\"abc\", \"1.2.3\", [], []).should.be.true();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"defaults allow to * when only deny list is provided","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":83,"column":59,"index":3138},"line":83,"code":"    it(\"defaults allow to * when only deny list is provided\", function () {\n      checkList(\"abc\", \"1.2.3\", [\"*\"], [\"def\"]).should.be.true();\n      checkList(\"def\", \"1.2.3\", [\"*\"], [\"def\"]).should.be.false();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"uses most specific matching rule","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":87,"column":40,"index":3336},"line":87,"code":"    it(\"uses most specific matching rule\", function () {\n      checkList(\"abc\", \"1.2.3\", [\"ab*\"], [\"a*\"]).should.be.true();\n      checkList(\"def\", \"1.2.3\", [\"d*\"], [\"de*\"]).should.be.false();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"checks version string using semver rules","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":91,"column":48,"index":3544},"line":91,"code":"    it(\"checks version string using semver rules\", function () {\n      // Deny\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.2\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.4\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@>1.2.3\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@>=1.2.3\"], [\"abc\"]).should.be.false();\n      checkList(\"node-red-contrib-foo\", \"1.2.3\", [\"*\"], [\"*contrib*\"]).should.be.false(); // Allow\n\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.3\"], [\"*\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc@<1.2.4\"], [\"*\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc\"], [\"abc@>1.2.3\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc\"], [\"abc@<1.2.3||>1.2.3\"]).should.be.true();\n      checkList(\"node-red-contrib-foo\", \"1.2.3\", [\"*contrib*\"], [\"*\"]).should.be.true();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"runtime events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":62,"column":22,"index":1831},"line":62,"code":"    it('runtime events', function () {\n      eventHandlers.should.have.property('runtime-event');\n      eventHandlers['runtime-event']({\n        id: \"my-event\",\n        payload: \"my-payload\"\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"notification/my-event\");\n      messages[0].should.have.property(\"data\", \"my-payload\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"status events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":72,"column":21,"index":2213},"line":72,"code":"    it('status events', function () {\n      eventHandlers.should.have.property('node-status');\n      eventHandlers['node-status']({\n        id: \"my-event\",\n        status: {\n          text: \"my-status\",\n          badProperty: \"should be filtered\"\n        }\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"status/my-event\");\n      messages[0].should.have.property(\"data\");\n      messages[0].data.should.have.property(\"text\", \"my-status\");\n      messages[0].data.should.not.have.property(\"badProperty\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"comms events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":87,"column":20,"index":2771},"line":87,"code":"    it('comms events', function () {\n      eventHandlers.should.have.property('runtime-event');\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"my-topic\");\n      messages[0].should.have.property(\"data\", \"my-payload\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"adds new connections","suites":["runtime-api/comms","manages connections"],"updatePoint":{"line":142,"column":28,"index":4202},"line":142,"code":"    it('adds new connections', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection1\n      }).then(function () {\n        eventHandlers['comms']({\n          topic: \"my-topic\",\n          data: \"my-payload\"\n        });\n        messages.should.have.length(1);\n        comms.addConnection({\n          client: clientConnection2\n        }).then(function () {\n          eventHandlers['comms']({\n            topic: \"my-topic\",\n            data: \"my-payload\"\n          });\n          messages.should.have.length(3);\n          done();\n        }).catch(done);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"removes connections","suites":["runtime-api/comms","manages connections"],"updatePoint":{"line":168,"column":27,"index":4925},"line":168,"code":"    it('removes connections', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection1\n      }).then(function () {\n        comms.addConnection({\n          client: clientConnection2\n        }).then(function () {\n          eventHandlers['comms']({\n            topic: \"my-topic\",\n            data: \"my-payload\"\n          });\n          messages.should.have.length(2);\n          comms.removeConnection({\n            client: clientConnection1\n          }).then(function () {\n            eventHandlers['comms']({\n              topic: \"my-topic\",\n              data: \"my-payload\"\n            });\n            messages.should.have.length(3);\n            done();\n          });\n        }).catch(done);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"subscribe triggers retained messages","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":239,"column":44,"index":6752},"line":239,"code":"    it('subscribe triggers retained messages', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-event\",\n        data: \"my-payload\",\n        retain: true\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"retains non-blank status message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":260,"column":40,"index":7417},"line":260,"code":"    it('retains non-blank status message', function (done) {\n      eventHandlers['node-status']({\n        id: \"node1234\",\n        status: {\n          text: \"hello\"\n        }\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"status/node1234\");\n          messages[0].should.have.property(\"data\", {\n            text: \"hello\",\n            fill: undefined,\n            shape: undefined\n          });\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not retain blank status message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":286,"column":44,"index":8185},"line":286,"code":"    it('does not retain blank status message', function (done) {\n      eventHandlers['node-status']({\n        id: \"node1234\",\n        status: {}\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(0);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not send blank status if first status","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":304,"column":50,"index":8702},"line":304,"code":"    it('does not send blank status if first status', function (done) {\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          eventHandlers['node-status']({\n            id: \"node5678\",\n            status: {}\n          });\n          messages.should.have.length(0);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"sends blank status if replacing retained","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":322,"column":48,"index":9233},"line":322,"code":"    it('sends blank status if replacing retained', function (done) {\n      eventHandlers['node-status']({\n        id: \"node5678\",\n        status: {\n          text: \"hello\"\n        }\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(1);\n          eventHandlers['node-status']({\n            id: \"node5678\",\n            status: {}\n          });\n          messages.should.have.length(2);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not retain initial status blank message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":347,"column":52,"index":9933},"line":347,"code":"    it('does not retain initial status blank message', function (done) {\n      eventHandlers['node-status']({\n        id: \"my-event\",\n        status: {}\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"retained messages get cleared","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":367,"column":37,"index":10568},"line":367,"code":"    it('retained messages get cleared', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-event\",\n        data: \"my-payload\",\n        retain: true\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\"); // Now we have a retained message, clear it\n\n          eventHandlers['comms']({\n            topic: \"my-event\",\n            data: \"my-payload-cleared\"\n          });\n          messages.should.have.length(2);\n          messages[1].should.have.property(\"topic\", \"my-event\");\n          messages[1].should.have.property(\"data\", \"my-payload-cleared\"); // Now add a second client and subscribe - no message should arrive\n\n          return comms.addConnection({\n            client: clientConnection2\n          }).then(function () {\n            return comms.subscribe({\n              client: clientConnection2,\n              topic: \"my-event\"\n            }).then(function () {\n              messages.should.have.length(2);\n              done();\n            });\n          });\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"gets global value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":129,"column":42,"index":3108},"line":129,"code":"    it('gets global value of default store', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '111');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets global value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":141,"column":44,"index":3477},"line":141,"code":"    it('gets global value of specified store', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '222');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets flow value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":152,"column":40,"index":3816},"line":152,"code":"    it('gets flow value of default store', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '333');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets flow value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":164,"column":42,"index":4179},"line":164,"code":"    it('gets flow value of specified store', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '444');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets node value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":175,"column":40,"index":4514},"line":175,"code":"    it('gets node value of default store', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '555');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets node value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":187,"column":42,"index":4877},"line":187,"code":"    it('gets node value of specified store', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '666');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":198,"column":30,"index":5202},"line":198,"code":"    it('404s for unknown store', function (done) {\n      context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: 'unknown',\n        key: 'abc'\n      }).then(function (result) {\n        done(\"getValue for unknown store should not resolve\");\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all global value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":212,"column":40,"index":5648},"line":212,"code":"    it('gets all global value properties', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: undefined //\n\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '111',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '222',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all flow value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":237,"column":38,"index":6195},"line":237,"code":"    it('gets all flow value properties', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: undefined //\n\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '333',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '444',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all node value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":262,"column":38,"index":6738},"line":262,"code":"    it('gets all node value properties', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: undefined //\n\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '555',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '666',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets empty object when specified context doesn't exist","suites":["runtime-api/context","getValue"],"updatePoint":{"line":287,"column":63,"index":7306},"line":287,"code":"    it('gets empty object when specified context doesn\\'t exist', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'non-existent',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.be.an.Object();\n        result.should.be.empty();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes global value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":300,"column":45,"index":7658},"line":300,"code":"    it('deletes global value of default store', function () {\n      return context.delete({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        globalContext.should.eql({\n          default: {},\n          file: {\n            abc: 222\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes global value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":316,"column":47,"index":8035},"line":316,"code":"    it('deletes global value of specified store', function () {\n      return context.delete({\n        scope: 'global',\n        id: undefined,\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        globalContext.should.eql({\n          default: {\n            abc: 111\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes flow value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":331,"column":43,"index":8382},"line":331,"code":"    it('deletes flow value of default store', function () {\n      return context.delete({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        flowContext.should.eql({\n          default: {},\n          file: {\n            abc: 444\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes flow value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":347,"column":45,"index":8751},"line":347,"code":"    it('deletes flow value of specified store', function () {\n      return context.delete({\n        scope: 'flow',\n        id: 'flow1',\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        flowContext.should.eql({\n          default: {\n            abc: 333\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes node value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":362,"column":43,"index":9092},"line":362,"code":"    it('deletes node value of default store', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        nodeContext.should.eql({\n          default: {},\n          file: {\n            abc: 666\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes node value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":378,"column":45,"index":9461},"line":378,"code":"    it('deletes node value of specified store', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'known',\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        nodeContext.should.eql({\n          default: {\n            abc: 555\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"does nothing when specified context doesn't exist","suites":["runtime-api/context","delete"],"updatePoint":{"line":393,"column":58,"index":9817},"line":393,"code":"    it('does nothing when specified context doesn\\'t exist', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'non-existent',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        should.not.exist(result);\n        nodeContext.should.eql({\n          default: {\n            abc: 555\n          },\n          file: {\n            abc: 666\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown store","suites":["runtime-api/context","delete"],"updatePoint":{"line":411,"column":30,"index":10224},"line":411,"code":"    it('404s for unknown store', function (done) {\n      context.delete({\n        scope: 'global',\n        id: undefined,\n        store: 'unknown',\n        key: 'abc'\n      }).then(function () {\n        done(\"delete for unknown store should not resolve\");\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"returns basic user settings","suites":["runtime-api/diagnostics","get"],"updatePoint":{"line":94,"column":35,"index":2681},"line":94,"code":"    it(\"returns basic user settings\", function () {\n      return diagnostics.get({\n        scope: \"fake_scope\"\n      }).then(result => {\n        should(result).be.type(\"object\"); //result.xxxxx\n\n        Object.keys(result);\n        const reportPropCount = Object.keys(result).length;\n        reportPropCount.should.eql(7); //ensure no more than 7 keys are present in the report (avoid leakage of extra info)\n\n        result.should.have.property(\"report\", \"diagnostics\");\n        result.should.have.property(\"scope\", \"fake_scope\");\n        result.should.have.property(\"time\").type(\"object\");\n        result.should.have.property(\"intl\").type(\"object\");\n        result.should.have.property(\"nodejs\").type(\"object\");\n        result.should.have.property(\"os\").type(\"object\");\n        result.should.have.property(\"runtime\").type(\"object\"); //result.runtime.xxxxx\n\n        const runtimeCount = Object.keys(result.runtime).length;\n        runtimeCount.should.eql(5); //ensure 5 keys are present in runtime \n\n        result.runtime.should.have.property('isStarted', true);\n        result.runtime.should.have.property('flows');\n        result.runtime.should.have.property('modules').type(\"object\");\n        result.runtime.should.have.property('settings').type(\"object\");\n        result.runtime.should.have.property('version', '7.7.7'); //result.runtime.modules.xxxxx\n\n        const moduleCount = Object.keys(result.runtime.modules).length;\n        moduleCount.should.eql(2); //ensure no more than the 2 modules specified are present\n\n        result.runtime.modules.should.have.property('node-red', '9.9.9');\n        result.runtime.modules.should.have.property('node-red-node-inject', '8.8.8'); //result.runtime.settings.xxxxx\n\n        const settingsCount = Object.keys(result.runtime.settings).length;\n        settingsCount.should.eql(27); //ensure no more than the 21 settings listed below are present in the settings object\n\n        result.runtime.settings.should.have.property('available', true);\n        result.runtime.settings.should.have.property('apiMaxLength', \"UNSET\"); //deliberately disabled to ensure UNSET is returned\n\n        result.runtime.settings.should.have.property('debugMaxLength', 1111);\n        result.runtime.settings.should.have.property('disableEditor', false);\n        result.runtime.settings.should.have.property('editorTheme', {});\n        result.runtime.settings.should.have.property('flowFile', \"flows.json\");\n        result.runtime.settings.should.have.property('mqttReconnectTime', 321);\n        result.runtime.settings.should.have.property('serialReconnectTime', 432);\n        result.runtime.settings.should.have.property('socketReconnectTime', 2222);\n        result.runtime.settings.should.have.property('socketTimeout', 3333);\n        result.runtime.settings.should.have.property('tcpMsgQueueSize', 4444);\n        result.runtime.settings.should.have.property('inboundWebSocketTimeout', 5555);\n        result.runtime.settings.should.have.property('runtimeState', {\n          enabled: true,\n          ui: false\n        });\n        result.runtime.settings.should.have.property(\"adminAuth\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property(\"httpAdminCors\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property('httpAdminRoot', \"/admin/root/\");\n        result.runtime.settings.should.have.property(\"httpNodeAuth\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property(\"httpNodeCors\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property('httpNodeRoot', \"/node/root/\");\n        result.runtime.settings.should.have.property(\"httpStatic\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property('httpStaticRoot', \"/static/root/\");\n        result.runtime.settings.should.have.property(\"httpStaticCors\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property(\"uiHost\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property(\"uiPort\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property(\"userDir\", \"SET\"); //should be sanitised to \"SET\"\n\n        result.runtime.settings.should.have.property('contextStorage').type(\"object\");\n        result.runtime.settings.should.have.property('nodesDir', \"SET\"); //result.runtime.settings.contextStorage.xxxxx\n\n        const contextCount = Object.keys(result.runtime.settings.contextStorage).length;\n        contextCount.should.eql(3); //ensure no more than the 3 settings listed below are present in the contextStorage object\n\n        result.runtime.settings.contextStorage.should.have.property('default', {\n          module: \"memory\"\n        });\n        result.runtime.settings.contextStorage.should.have.property('file', {\n          module: \"localfilesystem\"\n        });\n        result.runtime.settings.contextStorage.should.have.property('secured', {\n          module: \"secure_store\"\n        }); //only module should be present, other fields are dropped for security\n      });\n    });","file":"unit/@node-red/runtime/lib/api/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"returns the current flow configuration","suites":["runtime-api/flows","getFlows"],"updatePoint":{"line":39,"column":46,"index":1172},"line":39,"code":"    it(\"returns the current flow configuration\", function (done) {\n      flows.init({\n        log: mockLog(),\n        flows: {\n          getFlows: function () {\n            return [1, 2, 3];\n          }\n        }\n      });\n      flows.getFlows({}).then(function (result) {\n        result.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"defaults to full deploy","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":95,"column":31,"index":2576},"line":95,"code":"    it(\"defaults to full deploy\", function (done) {\n      flows.setFlows({\n        flows: {\n          flows: [4, 5, 6]\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"full\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"includes credentials when part of the request","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":110,"column":53,"index":3024},"line":110,"code":"    it(\"includes credentials when part of the request\", function (done) {\n      flows.setFlows({\n        flows: {\n          flows: [4, 5, 6],\n          credentials: {\n            $: \"creds\"\n          }\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[1].should.eql({\n          $: \"creds\"\n        });\n        setFlows.lastCall.args[2].should.eql(\"full\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"passes through other deploy types","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":131,"column":41,"index":3601},"line":131,"code":"    it(\"passes through other deploy types\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6]\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"nodes\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"triggers a flow reload","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":147,"column":30,"index":4060},"line":147,"code":"    it(\"triggers a flow reload\", function (done) {\n      flows.setFlows({\n        deploymentType: \"reload\"\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newLoadRev\"\n        });\n        setFlows.called.should.be.false();\n        loadFlows.called.should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"allows update when revision matches","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":159,"column":43,"index":4414},"line":159,"code":"    it(\"allows update when revision matches\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6],\n          rev: \"currentRev\"\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"nodes\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects update when revision does not match","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":176,"column":51,"index":4923},"line":176,"code":"    it(\"rejects update when revision does not match\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6],\n          rev: \"notTheCurrentRev\"\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject rev mismatch\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'version_mismatch');\n        err.should.have.property('status', 409);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when reload fails","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":191,"column":33,"index":5401},"line":191,"code":"    it(\"rejects when reload fails\", function (done) {\n      reloadError = true;\n      flows.setFlows({\n        deploymentType: \"reload\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update fails","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":202,"column":33,"index":5758},"line":202,"code":"    it(\"rejects when update fails\", function (done) {\n      flows.setFlows({\n        deploymentType: \"full\",\n        flows: {\n          flows: [\"error\", 5, 6]\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"adds a flow","suites":["runtime-api/flows","addFlow"],"updatePoint":{"line":237,"column":19,"index":6633},"line":237,"code":"    it(\"adds a flow\", function (done) {\n      flows.addFlow({\n        flow: {\n          a: \"123\"\n        }\n      }).then(function (id) {\n        addFlow.called.should.be.true();\n        addFlow.lastCall.args[0].should.eql({\n          a: \"123\"\n        });\n        id.should.eql(\"newId\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when add fails","suites":["runtime-api/flows","addFlow"],"updatePoint":{"line":251,"column":30,"index":6977},"line":251,"code":"    it(\"rejects when add fails\", function (done) {\n      flows.addFlow({\n        flow: \"error\"\n      }).then(function (id) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets a flow","suites":["runtime-api/flows","getFlow"],"updatePoint":{"line":279,"column":19,"index":7629},"line":279,"code":"    it(\"gets a flow\", function (done) {\n      flows.getFlow({\n        id: \"123\"\n      }).then(function (flow) {\n        flow.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","getFlow"],"updatePoint":{"line":287,"column":35,"index":7839},"line":287,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.getFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"updates a flow","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":328,"column":22,"index":9000},"line":328,"code":"    it(\"updates a flow\", function (done) {\n      flows.updateFlow({\n        id: \"123\",\n        flow: [1, 2, 3]\n      }).then(function (id) {\n        id.should.eql(\"123\");\n        updateFlow.called.should.be.true();\n        updateFlow.lastCall.args[0].should.eql(\"123\");\n        updateFlow.lastCall.args[1].should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":340,"column":35,"index":9388},"line":340,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.updateFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update fails","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":351,"column":33,"index":9761},"line":351,"code":"    it(\"rejects when update fails\", function (done) {\n      flows.updateFlow({\n        id: \"error\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"deletes a flow","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":392,"column":22,"index":10919},"line":392,"code":"    it(\"deletes a flow\", function (done) {\n      flows.deleteFlow({\n        id: \"123\"\n      }).then(function () {\n        removeFlow.called.should.be.true();\n        removeFlow.lastCall.args[0].should.eql(\"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":401,"column":35,"index":11191},"line":401,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.deleteFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when delete fails","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":412,"column":33,"index":11564},"line":412,"code":"    it(\"rejects when delete fails\", function (done) {\n      flows.deleteFlow({\n        id: \"error\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns an empty object for an unknown node","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":463,"column":51,"index":12953},"line":463,"code":"    it(\"returns an empty object for an unknown node\", function (done) {\n      flows.getNodeCredentials({\n        id: \"unknown\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({});\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered credentials for a known node with password","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":472,"column":68,"index":13230},"line":472,"code":"    it(\"gets the filtered credentials for a known node with password\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({\n          username: \"abc\",\n          has_password: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered credentials for a known node without password","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":484,"column":71,"index":13573},"line":484,"code":"    it(\"gets the filtered credentials for a known node without password\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known2\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({\n          username: \"abc\",\n          has_password: false\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the empty credentials for a known node without a registered definition","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":496,"column":83,"index":13930},"line":496,"code":"    it(\"gets the empty credentials for a known node without a registered definition\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known2\",\n        type: \"unknown-type\"\n      }).then(function (result) {\n        result.should.eql({});\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets flows run state","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":566,"column":28,"index":15679},"line":566,"code":"    it(\"gets flows run state\", async function () {\n      flows.init(runtime);\n      const state = await flows.getState({});\n      state.should.have.property(\"state\", \"start\");\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"permits getting flows run state when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":571,"column":61,"index":15896},"line":571,"code":"    it(\"permits getting flows run state when setting disabled\", async function () {\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n      const state = await flows.getState({});\n      state.should.have.property(\"state\", \"start\");\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"start flows","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":577,"column":19,"index":16124},"line":577,"code":"    it(\"start flows\", async function () {\n      flows.init(runtime);\n      const state = await flows.setState({\n        state: \"start\"\n      });\n      state.should.have.property(\"state\", \"start\");\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.be.true();\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"stop flows","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":586,"column":18,"index":16415},"line":586,"code":"    it(\"stop flows\", async function () {\n      flows.init(runtime);\n      const state = await flows.setState({\n        state: \"stop\"\n      });\n      state.should.have.property(\"state\", \"stop\");\n      stopFlows.called.should.be.true();\n      startFlows.called.should.not.be.true();\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects starting flows when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":595,"column":52,"index":16738},"line":595,"code":"    it(\"rejects starting flows when setting disabled\", async function () {\n      let err;\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n\n      try {\n        await flows.setState({\n          state: \"start\"\n        });\n      } catch (error) {\n        err = error;\n      }\n\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"not_allowed\");\n      should(err).have.property(\"status\", 405);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects stopping flows when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":613,"column":52,"index":17246},"line":613,"code":"    it(\"rejects stopping flows when setting disabled\", async function () {\n      let err;\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n\n      try {\n        await flows.setState({\n          state: \"stop\"\n        });\n      } catch (error) {\n        err = error;\n      }\n\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"not_allowed\");\n      should(err).have.property(\"status\", 405);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects setting invalid flows run state","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":631,"column":47,"index":17748},"line":631,"code":"    it(\"rejects setting invalid flows run state\", async function () {\n      let err;\n      flows.init(runtime);\n\n      try {\n        await flows.setState({\n          state: \"bad-state\"\n        });\n      } catch (error) {\n        err = error;\n      }\n\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"invalid_run_state\");\n      should(err).have.property(\"status\", 400);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"isStarted","suites":["runtime-api/index"],"updatePoint":{"line":35,"column":15,"index":1295},"line":35,"code":"  it('isStarted', function (done) {\n    index.init({\n      isStarted: () => true\n    });\n    index.isStarted({}).then(function (started) {\n      started.should.be.true();\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/api/index_spec.js","skipped":false,"dir":"test"},{"name":"isStarted","suites":["runtime-api/index"],"updatePoint":{"line":44,"column":15,"index":1506},"line":44,"code":"  it('isStarted', function (done) {\n    index.init({\n      version: () => \"1.2.3.4\"\n    });\n    index.version({}).then(function (version) {\n      version.should.eql(\"1.2.3.4\");\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/api/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a known entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":70,"column":29,"index":2206},"line":70,"code":"    it(\"returns a known entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"known\",\n        path: \"/abc\"\n      }).then(function (result) {\n        result.should.eql(\"known\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a forbidden entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":80,"column":33,"index":2471},"line":80,"code":"    it(\"rejects a forbidden entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"forbidden\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"forbidden\");\n        err.should.have.property(\"status\", 403);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects an unknown entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":93,"column":32,"index":2882},"line":93,"code":"    it(\"rejects an unknown entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"not_found\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        err.should.have.property(\"status\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a blank (unknown) entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":106,"column":39,"index":3300},"line":106,"code":"    it(\"rejects a blank (unknown) entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"blank\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        err.should.have.property(\"status\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects unexpected error","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":119,"column":32,"index":3707},"line":119,"code":"    it(\"rejects unexpected error\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"error\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"status\", 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":165,"column":22,"index":4972},"line":165,"code":"    it(\"saves an entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"known\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        opts.should.have.property(\"type\", \"known\");\n        opts.should.have.property(\"path\", \"/abc\");\n        opts.should.have.property(\"meta\", {\n          a: 1\n        });\n        opts.should.have.property(\"body\", \"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a forbidden entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":184,"column":33,"index":5483},"line":184,"code":"    it(\"rejects a forbidden entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"forbidden\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"forbidden\");\n        err.should.have.property(\"status\", 403);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects an unknown entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":201,"column":32,"index":5952},"line":201,"code":"    it(\"rejects an unknown entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"not_found\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"status\", 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["runtime-api/nodes","getNodeInfo"],"updatePoint":{"line":55,"column":25,"index":1486},"line":55,"code":"    it(\"returns node info\", function (done) {\n      nodes.getNodeInfo({\n        id: \"known\"\n      }).then(function (result) {\n        result.should.eql({\n          id: \"known\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getNodeInfo"],"updatePoint":{"line":65,"column":37,"index":1732},"line":65,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getNodeInfo({\n        id: \"unknown\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node list","suites":["runtime-api/nodes","getNodeList"],"updatePoint":{"line":88,"column":25,"index":2342},"line":88,"code":"    it(\"returns node list\", function (done) {\n      nodes.getNodeList({}).then(function (result) {\n        result.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node config","suites":["runtime-api/nodes","getNodeConfig"],"updatePoint":{"line":110,"column":27,"index":2879},"line":110,"code":"    it(\"returns node config\", function (done) {\n      nodes.getNodeConfig({\n        id: \"known\",\n        lang: 'lang'\n      }).then(function (result) {\n        result.should.eql(\"knownlang\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getNodeConfig"],"updatePoint":{"line":119,"column":37,"index":3127},"line":119,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getNodeConfig({\n        id: \"unknown\",\n        lang: 'lang'\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns all node configs","suites":["runtime-api/nodes","getNodeConfigs"],"updatePoint":{"line":143,"column":32,"index":3773},"line":143,"code":"    it(\"returns all node configs\", function (done) {\n      nodes.getNodeConfigs({\n        lang: 'lang'\n      }).then(function (result) {\n        result.should.eql(\"lang\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["runtime-api/nodes","getModuleInfo"],"updatePoint":{"line":169,"column":25,"index":4370},"line":169,"code":"    it(\"returns node info\", function (done) {\n      nodes.getModuleInfo({\n        module: \"known\"\n      }).then(function (result) {\n        result.should.eql({\n          module: \"known\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getModuleInfo"],"updatePoint":{"line":179,"column":37,"index":4626},"line":179,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getModuleInfo({\n        module: \"unknown\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin list","suites":["runtime-api/plugins","getPluginList"],"updatePoint":{"line":32,"column":28,"index":687},"line":32,"code":"    it(\"gets the plugin list\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginList: function () {\n            return pluginList;\n          }\n        }\n      });\n      return plugins.getPluginList({}).then(function (result) {\n        result.should.eql(pluginList);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin configs","suites":["runtime-api/plugins","getPluginConfigs"],"updatePoint":{"line":47,"column":31,"index":1073},"line":47,"code":"    it(\"gets the plugin configs\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginConfigs: function () {\n            return pluginConfigs;\n          }\n        }\n      });\n      return plugins.getPluginConfigs({}).then(function (result) {\n        result.should.eql(pluginConfigs);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin catalogs","suites":["runtime-api/plugins","getPluginCatalogs"],"updatePoint":{"line":62,"column":32,"index":1473},"line":62,"code":"    it(\"gets the plugin catalogs\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginList: function () {\n            return pluginList;\n          }\n        },\n        i18n: {\n          i: {\n            changeLanguage: function (lang, done) {\n              done && done();\n            },\n            getResourceBundle: function (lang, id) {\n              return {\n                lang,\n                id\n              };\n            }\n          }\n        }\n      });\n      return plugins.getPluginCatalogs({\n        lang: \"en-US\"\n      }).then(function (result) {\n        JSON.stringify(result).should.eql(JSON.stringify({\n          one: {\n            lang: \"en-US\",\n            id: \"one\"\n          }\n        }));\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"resolves true if projects available","suites":["runtime-api/settings","available"],"updatePoint":{"line":39,"column":43,"index":1179},"line":39,"code":"    it(\"resolves true if projects available\", function (done) {\n      projects.init({\n        storage: {\n          projects: {}\n        }\n      });\n      projects.available().then(function (result) {\n        result.should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"resolves false if projects unavailable","suites":["runtime-api/settings","available"],"updatePoint":{"line":50,"column":46,"index":1461},"line":50,"code":"    it(\"resolves false if projects unavailable\", function (done) {\n      projects.init({\n        storage: {}\n      });\n      projects.available().then(function (result) {\n        result.should.be.false();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"lists the projects, without an active project","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":91,"column":53,"index":2503},"line":91,"code":"    it(\"lists the projects, without an active project\", function (done) {\n      projects.listProjects({\n        user: \"noActive\"\n      }).then(function (result) {\n        result.should.have.property('projects', [1, 2, 3]);\n        result.should.not.have.property('active');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"lists the projects, with an active project","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":100,"column":50,"index":2820},"line":100,"code":"    it(\"lists the projects, with an active project\", function (done) {\n      projects.listProjects({\n        user: \"foo\"\n      }).then(function (result) {\n        result.should.have.property('projects', [1, 2, 3]);\n        result.should.have.property('active', 'aProject');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":109,"column":35,"index":3125},"line":109,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.listProjects({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"create project","suites":["runtime-api/settings","createProject"],"updatePoint":{"line":143,"column":22,"index":4076},"line":143,"code":"    it(\"create project\", function (done) {\n      projects.createProject({\n        user: \"known\",\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          a: 1\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","createProject"],"updatePoint":{"line":156,"column":35,"index":4365},"line":156,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.createProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"intialise project","suites":["runtime-api/settings","initialiseProject"],"updatePoint":{"line":193,"column":25,"index":5381},"line":193,"code":"    it(\"intialise project\", function (done) {\n      projects.initialiseProject({\n        user: \"known\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          id: 123,\n          project: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","initialiseProject"],"updatePoint":{"line":210,"column":35,"index":5745},"line":210,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.initialiseProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"returns active project","suites":["runtime-api/settings","getActiveProject"],"updatePoint":{"line":244,"column":30,"index":6699},"line":244,"code":"    it(\"returns active project\", function (done) {\n      projects.getActiveProject({\n        user: \"known\"\n      }).then(function (result) {\n        result.should.eql(\"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getActiveProject"],"updatePoint":{"line":252,"column":35,"index":6925},"line":252,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getActiveProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"sets project if current project is unset","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":294,"column":48,"index":8141},"line":294,"code":"    it(\"sets project if current project is unset\", function (done) {\n      activeProject = null;\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"sets project if current project is different","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":307,"column":52,"index":8478},"line":307,"code":"    it(\"sets project if current project is different\", function (done) {\n      activeProject = {\n        name: 456\n      };\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"no-ops if current project is same","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":322,"column":41,"index":8827},"line":322,"code":"    it(\"no-ops if current project is same\", function (done) {\n      activeProject = {\n        name: 123\n      };\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        (result === undefined).should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":334,"column":35,"index":9136},"line":334,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.setActiveProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"returns project","suites":["runtime-api/settings","getProject"],"updatePoint":{"line":371,"column":23,"index":10127},"line":371,"code":"    it(\"returns project\", function (done) {\n      projects.getProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getProject"],"updatePoint":{"line":383,"column":35,"index":10413},"line":383,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"updates project","suites":["runtime-api/settings","updateProject"],"updatePoint":{"line":421,"column":23,"index":11438},"line":421,"code":"    it(\"updates project\", function (done) {\n      projects.updateProject({\n        user: \"known\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          project: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","updateProject"],"updatePoint":{"line":439,"column":35,"index":11823},"line":439,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.updateProject({\n        user: \"error\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"deletes project","suites":["runtime-api/settings","deleteProject"],"updatePoint":{"line":480,"column":23,"index":12879},"line":480,"code":"    it(\"deletes project\", function (done) {\n      projects.deleteProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","deleteProject"],"updatePoint":{"line":492,"column":35,"index":13168},"line":492,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.deleteProject({\n        user: \"error\",\n        id: 123\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets status","suites":["runtime-api/settings","getStatus"],"updatePoint":{"line":531,"column":19,"index":14199},"line":531,"code":"    it(\"gets status\", function (done) {\n      projects.getStatus({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getStatus"],"updatePoint":{"line":549,"column":35,"index":14578},"line":549,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getStatus({\n        user: \"error\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets branches","suites":["runtime-api/settings","getBranches"],"updatePoint":{"line":591,"column":21,"index":15656},"line":591,"code":"    it(\"gets branches\", function (done) {\n      projects.getBranches({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getBranches"],"updatePoint":{"line":609,"column":35,"index":16037},"line":609,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getBranches({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets branch status","suites":["runtime-api/settings","getBranchStatus"],"updatePoint":{"line":651,"column":26,"index":17129},"line":651,"code":"    it(\"gets branch status\", function (done) {\n      projects.getBranchStatus({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getBranchStatus"],"updatePoint":{"line":669,"column":35,"index":17514},"line":669,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getBranchStatus({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","setBranch"],"updatePoint":{"line":712,"column":15,"index":18619},"line":712,"code":"    it(\"commits\", function (done) {\n      projects.setBranch({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        create: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          },\n          create: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","setBranch"],"updatePoint":{"line":732,"column":35,"index":19044},"line":732,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.setBranch({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        create: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","deleteBranch"],"updatePoint":{"line":776,"column":15,"index":20180},"line":776,"code":"    it(\"commits\", function (done) {\n      projects.deleteBranch({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        force: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          },\n          force: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","deleteBranch"],"updatePoint":{"line":796,"column":35,"index":20606},"line":796,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.deleteBranch({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        force: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","commit"],"updatePoint":{"line":839,"column":15,"index":21693},"line":839,"code":"    it(\"commits\", function (done) {\n      projects.commit({\n        user: \"known\",\n        id: 123,\n        message: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          message: {\n            message: {\n              a: 1\n            }\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","commit"],"updatePoint":{"line":859,"column":35,"index":22110},"line":859,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.commit({\n        user: \"error\",\n        id: 123,\n        message: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commit","suites":["runtime-api/settings","getCommit"],"updatePoint":{"line":901,"column":19,"index":23173},"line":901,"code":"    it(\"gets commit\", function (done) {\n      projects.getCommit({\n        user: \"known\",\n        id: 123,\n        sha: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          sha: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getCommit"],"updatePoint":{"line":919,"column":35,"index":23546},"line":919,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getCommit({\n        user: \"error\",\n        id: 123,\n        sha: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commits with default limit/before","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":961,"column":46,"index":24645},"line":961,"code":"    it(\"gets commits with default limit/before\", function (done) {\n      projects.getCommits({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          options: {\n            limit: 20,\n            before: undefined\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commits with provided limit/before","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":977,"column":47,"index":25030},"line":977,"code":"    it(\"gets commits with provided limit/before\", function (done) {\n      projects.getCommits({\n        user: \"known\",\n        id: 123,\n        limit: 10,\n        before: 456\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          options: {\n            limit: 10,\n            before: 456\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":995,"column":35,"index":25437},"line":995,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getCommits({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"aborts merge","suites":["runtime-api/settings","abortMerge"],"updatePoint":{"line":1032,"column":20,"index":26419},"line":1032,"code":"    it(\"aborts merge\", function (done) {\n      projects.abortMerge({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","abortMerge"],"updatePoint":{"line":1044,"column":35,"index":26705},"line":1044,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.abortMerge({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"resolves merge","suites":["runtime-api/settings","resolveMerge"],"updatePoint":{"line":1083,"column":22,"index":27761},"line":1083,"code":"    it(\"resolves merge\", function (done) {\n      projects.resolveMerge({\n        user: \"known\",\n        id: 123,\n        path: \"/abc\",\n        resolution: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: \"/abc\",\n          resolution: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","resolveMerge"],"updatePoint":{"line":1103,"column":35,"index":28197},"line":1103,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.resolveMerge({\n        user: \"error\",\n        id: 123,\n        path: \"/abc\",\n        resolution: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets files","suites":["runtime-api/settings","getFiles"],"updatePoint":{"line":1145,"column":18,"index":29262},"line":1145,"code":"    it(\"gets files\", function (done) {\n      projects.getFiles({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFiles"],"updatePoint":{"line":1157,"column":35,"index":29546},"line":1157,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFiles({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets file","suites":["runtime-api/settings","getFile"],"updatePoint":{"line":1196,"column":17,"index":30573},"line":1196,"code":"    it(\"gets file\", function (done) {\n      projects.getFile({\n        user: \"known\",\n        id: 123,\n        path: \"/abc\",\n        tree: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: \"/abc\",\n          tree: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFile"],"updatePoint":{"line":1216,"column":35,"index":30992},"line":1216,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFile({\n        user: \"error\",\n        id: 123,\n        path: \"/abc\",\n        tree: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"stages a file","suites":["runtime-api/settings","stageFile"],"updatePoint":{"line":1259,"column":21,"index":32079},"line":1259,"code":"    it(\"stages a file\", function (done) {\n      projects.stageFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","stageFile"],"updatePoint":{"line":1277,"column":35,"index":32454},"line":1277,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.stageFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"unstages a file","suites":["runtime-api/settings","unstageFile"],"updatePoint":{"line":1319,"column":23,"index":33527},"line":1319,"code":"    it(\"unstages a file\", function (done) {\n      projects.unstageFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","unstageFile"],"updatePoint":{"line":1337,"column":35,"index":33904},"line":1337,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.unstageFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"reverts a file","suites":["runtime-api/settings","revertFile"],"updatePoint":{"line":1379,"column":22,"index":34976},"line":1379,"code":"    it(\"reverts a file\", function (done) {\n      projects.revertFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","revertFile"],"updatePoint":{"line":1397,"column":35,"index":35352},"line":1397,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.revertFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets file diff","suites":["runtime-api/settings","getFileDiff"],"updatePoint":{"line":1440,"column":22,"index":36453},"line":1440,"code":"    it(\"gets file diff\", function (done) {\n      projects.getFileDiff({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        },\n        type: \"abc\"\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          },\n          type: \"abc\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFileDiff"],"updatePoint":{"line":1460,"column":35,"index":36874},"line":1460,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFileDiff({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        },\n        type: \"abc\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets remotes","suites":["runtime-api/settings","getRemotes"],"updatePoint":{"line":1502,"column":20,"index":37937},"line":1502,"code":"    it(\"gets remotes\", function (done) {\n      projects.getRemotes({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getRemotes"],"updatePoint":{"line":1514,"column":35,"index":38223},"line":1514,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getRemotes({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"adds a remote","suites":["runtime-api/settings","addRemote"],"updatePoint":{"line":1552,"column":21,"index":39236},"line":1552,"code":"    it(\"adds a remote\", function (done) {\n      projects.addRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","addRemote"],"updatePoint":{"line":1570,"column":35,"index":39615},"line":1570,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.addRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"removes a remote","suites":["runtime-api/settings","removeRemote"],"updatePoint":{"line":1612,"column":24,"index":40697},"line":1612,"code":"    it(\"removes a remote\", function (done) {\n      projects.removeRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","removeRemote"],"updatePoint":{"line":1630,"column":35,"index":41079},"line":1630,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.removeRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"updates a remote","suites":["runtime-api/settings","updateRemote"],"updatePoint":{"line":1673,"column":24,"index":42192},"line":1673,"code":"    it(\"updates a remote\", function (done) {\n      projects.updateRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          name: \"abc\",\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          name: \"abc\",\n          remote: {\n            name: \"abc\",\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","updateRemote"],"updatePoint":{"line":1694,"column":35,"index":42645},"line":1694,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.updateRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          name: \"abc\",\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"pulls","suites":["runtime-api/settings","pull"],"updatePoint":{"line":1739,"column":13,"index":43822},"line":1739,"code":"    it(\"pulls\", function (done) {\n      projects.pull({\n        user: \"known\",\n        id: 123,\n        remote: \"abc\",\n        track: false,\n        allowUnrelatedHistories: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: \"abc\",\n          track: false,\n          allowUnrelatedHistories: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","pull"],"updatePoint":{"line":1757,"column":35,"index":44276},"line":1757,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.pull({\n        user: \"error\",\n        id: 123,\n        remote: \"abc\",\n        track: false,\n        allowUnrelatedHistories: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"pulls","suites":["runtime-api/settings","push"],"updatePoint":{"line":1800,"column":13,"index":45396},"line":1800,"code":"    it(\"pulls\", function (done) {\n      projects.push({\n        user: \"known\",\n        id: 123,\n        remote: \"abc\",\n        track: false\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: \"abc\",\n          track: false\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","push"],"updatePoint":{"line":1816,"column":35,"index":45770},"line":1816,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.push({\n        user: \"error\",\n        id: 123,\n        remote: \"abc\",\n        track: false\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error'); // err.should.have.property('status',400);\n\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets the runtime settings","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":41,"column":33,"index":1209},"line":41,"code":"    it(\"gets the runtime settings\", function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => [\"lib1\"]\n        },\n        storage: {}\n      });\n      return settings.getRuntimeSettings({}).then(result => {\n        result.should.have.property(\"httpNodeRoot\", \"testHttpNodeRoot\");\n        result.should.have.property(\"version\", \"testVersion\");\n        result.should.have.property(\"paletteCategories\", [\"red\", \"blue\", \"green\"]);\n        result.should.have.property(\"libraries\", [\"lib1\"]);\n        result.should.have.property(\"testNodeSetting\", \"helloWorld\");\n        result.should.have.property(\"testPluginSettings\", \"helloPluginWorld\");\n        result.should.not.have.property(\"foo\", 123);\n        result.should.have.property(\"flowEncryptionType\", \"test-key-type\");\n        result.should.not.have.property(\"user\");\n        result.should.have.property(\"externalModules\");\n        result.externalModules.should.eql({\n          palette: {\n            allowInstall: false,\n            allowUpload: false\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered user settings","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":91,"column":39,"index":2986},"line":91,"code":"    it(\"gets the filtered user settings\", function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {}\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"user\");\n        result.user.should.have.property(\"username\", \"nick\");\n        result.user.should.have.property(\"permissions\", \"*\");\n        result.user.should.have.property(\"image\", \"http://example.com\");\n        result.user.should.have.property(\"anonymous\", false);\n        result.user.should.not.have.property(\"private\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered settings when editor disabled ","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":141,"column":56,"index":4536},"line":141,"code":"    it(\"gets the filtered settings when editor disabled \", function () {\n      settings.init({\n        settings: {\n          disableEditor: true,\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            getActiveProject: () => 'test-active-project',\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"user\");\n        result.user.should.have.property(\"username\", \"nick\");\n        result.user.should.have.property(\"permissions\", \"*\");\n        result.user.should.have.property(\"image\", \"http://example.com\");\n        result.user.should.have.property(\"anonymous\", false);\n        result.user.should.not.have.property(\"private\"); // Filtered out when disableEditor is true\n\n        result.should.not.have.property(\"paletteCategories\", [\"red\", \"blue\", \"green\"]);\n        result.should.not.have.property(\"testNodeSetting\", \"helloWorld\");\n        result.should.not.have.property(\"foo\", 123);\n        result.should.not.have.property(\"flowEncryptionType\", \"test-key-type\");\n        result.should.not.have.property(\"project\");\n        result.should.not.have.property(\"git\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"includes project settings if projects available","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":211,"column":55,"index":6933},"line":211,"code":"    it('includes project settings if projects available', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            getActiveProject: () => 'test-active-project',\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"project\", \"test-active-project\");\n        result.should.not.have.property(\"files\");\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"includes existing files details if projects enabled but no active project and files exist","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":274,"column":97,"index":8832},"line":274,"code":"    it('includes existing files details if projects enabled but no active project and files exist', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            flowFileExists: () => true,\n            getActiveProject: () => false,\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n        result.should.not.have.property(\"project\");\n        result.should.have.property(\"files\");\n        result.files.should.have.property(\"flow\", 'test-flow-file');\n        result.files.should.have.property(\"credentials\", 'test-creds-file');\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"does not include file details if projects enabled but no active project and files do not exist","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":344,"column":102,"index":11009},"line":344,"code":"    it('does not include file details if projects enabled but no active project and files do not exist', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            flowFileExists: () => false,\n            getActiveProject: () => false,\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.not.have.property(\"project\");\n        result.should.not.have.property(\"files\");\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns default user settings","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":417,"column":37,"index":13047},"line":417,"code":"    it(\"returns default user settings\", function () {\n      return settings.getUserSettings({}).then(result => {\n        result.should.eql(\"_\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns default user settings for anonymous","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":422,"column":51,"index":13224},"line":422,"code":"    it(\"returns default user settings for anonymous\", function () {\n      return settings.getUserSettings({\n        user: {\n          anonymous: true\n        }\n      }).then(result => {\n        result.should.eql(\"_\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns user settings","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":431,"column":29,"index":13438},"line":431,"code":"    it(\"returns user settings\", function () {\n      return settings.getUserSettings({\n        user: {\n          username: 'nick'\n        }\n      }).then(result => {\n        result.should.eql(\"nick\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets default user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":473,"column":34,"index":14514},"line":473,"code":"    it('sets default user settings', function () {\n      return settings.updateUserSettings({\n        settings: {\n          abc: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"merges user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":482,"column":28,"index":14741},"line":482,"code":"    it('merges user settings', function () {\n      return settings.updateUserSettings({\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(123);\n\n        userSettings._.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets default user settings for anonymous user","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":493,"column":53,"index":15038},"line":493,"code":"    it('sets default user settings for anonymous user', function () {\n      return settings.updateUserSettings({\n        user: {\n          anonymous: true\n        },\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(123);\n\n        userSettings._.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets named user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":507,"column":32,"index":15367},"line":507,"code":"    it('sets named user settings', function () {\n      return settings.updateUserSettings({\n        user: {\n          username: 'nick'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings.nick.abc.should.eql(456);\n        userSettings.nick.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":520,"column":35,"index":15705},"line":520,"code":"    it('rejects with suitable error', function (done) {\n      settings.updateUserSettings({\n        user: {\n          username: 'error'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error - thrown","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":535,"column":44,"index":16106},"line":535,"code":"    it('rejects with suitable error - thrown', function (done) {\n      settings.updateUserSettings({\n        user: {\n          username: 'throw'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default users keys","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":571,"column":38,"index":17014},"line":571,"code":"    it('returns the default users keys', function () {\n      return settings.getUserKeys({}).then(result => {\n        result.should.eql(['__default']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default users keys for anonymous","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":576,"column":52,"index":17198},"line":576,"code":"    it('returns the default users keys for anonymous', function () {\n      return settings.getUserKeys({\n        user: {\n          anonymous: true\n        }\n      }).then(result => {\n        result.should.eql(['__default']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the users keys","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":585,"column":30,"index":17419},"line":585,"code":"    it('returns the users keys', function () {\n      return settings.getUserKeys({\n        user: {\n          username: 'nick'\n        }\n      }).then(result => {\n        result.should.eql(['nick']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":594,"column":35,"index":17641},"line":594,"code":"    it('rejects with suitable error', function (done) {\n      settings.getUserKeys({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default user key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":632,"column":36,"index":18648},"line":632,"code":"    it('returns the default user key', function () {\n      return settings.getUserKey({\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default user key - anonymous","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":642,"column":48,"index":18907},"line":642,"code":"    it('returns the default user key - anonymous', function () {\n      return settings.getUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the user key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":655,"column":28,"index":19199},"line":655,"code":"    it('returns the user key', function () {\n      return settings.getUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"nick\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":668,"column":28,"index":19487},"line":668,"code":"    it('404s for unknown key', function (done) {\n      settings.getUserKey({\n        user: {\n          username: '404'\n        },\n        id: 'keyid'\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 404);\n        err.should.have.property('code', 'not_found');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":682,"column":35,"index":19895},"line":682,"code":"    it('rejects with suitable error', function (done) {\n      settings.getUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the default user","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":718,"column":38,"index":20836},"line":718,"code":"    it('generates for the default user', function () {\n      return settings.generateUserKey({\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            id: 'keyid'\n          },\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the default user - anonymous","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":731,"column":50,"index":21171},"line":731,"code":"    it('generates for the default user - anonymous', function () {\n      return settings.generateUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            user: {\n              anonymous: true\n            },\n            id: 'keyid'\n          },\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the user","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":750,"column":30,"index":21604},"line":750,"code":"    it('generates for the user', function () {\n      return settings.generateUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            user: {\n              username: 'nick'\n            },\n            id: 'keyid'\n          },\n          username: \"nick\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":769,"column":35,"index":22039},"line":769,"code":"    it('rejects with suitable error', function (done) {\n      settings.generateUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes for the default user","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":809,"column":36,"index":23085},"line":809,"code":"    it('removes for the default user', function () {\n      return settings.removeUserKey({\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"__default\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes for the default user key - anonymous","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":817,"column":52,"index":23344},"line":817,"code":"    it('removes for the default user key - anonymous', function () {\n      return settings.removeUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"__default\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the user key","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":828,"column":28,"index":23632},"line":828,"code":"    it('returns the user key', function () {\n      return settings.removeUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"nick\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":839,"column":35,"index":23923},"line":839,"code":"    it('rejects with suitable error', function (done) {\n      settings.removeUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"called with an empty flow","suites":["Flow","#constructor"],"updatePoint":{"line":212,"column":33,"index":5973},"line":212,"code":"    it('called with an empty flow', function () {\n      var config = flowUtils.parseConfig([]);\n      var flow = Flow.create({}, config);\n      var nodeCount = 0;\n      Object.keys(flow.getActiveNodes()).length.should.equal(0);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates an initial configuration and stops it","suites":["Flow","#start"],"updatePoint":{"line":220,"column":58,"index":6275},"line":220,"code":"    it(\"instantiates an initial configuration and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('2').should.have.a.property('id', '2');\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4');\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"2\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].on(\"input\", function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"2\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          try {\n            currentNodes.should.not.have.a.property(\"1\");\n            currentNodes.should.not.have.a.property(\"2\");\n            currentNodes.should.not.have.a.property(\"3\");\n            currentNodes.should.not.have.a.property(\"4\");\n            stoppedNodes.should.have.a.property(\"1\");\n            stoppedNodes.should.have.a.property(\"2\");\n            stoppedNodes.should.have.a.property(\"3\");\n            stoppedNodes.should.have.a.property(\"4\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates config nodes in the right order","suites":["Flow","#start"],"updatePoint":{"line":292,"column":52,"index":8614},"line":292,"code":"    it(\"instantiates config nodes in the right order\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"5\"\n      }, // This node depends on #5\n      {\n        id: \"5\",\n        z: \"t1\",\n        type: \"test\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(5);\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes.should.have.a.property(\"5\");\n      currentNodes[\"1\"].should.have.a.property(\"_index\", 2);\n      currentNodes[\"2\"].should.have.a.property(\"_index\", 3);\n      currentNodes[\"3\"].should.have.a.property(\"_index\", 4);\n      currentNodes[\"4\"].should.have.a.property(\"_index\", 1);\n      currentNodes[\"5\"].should.have.a.property(\"_index\", 0);\n      flow.stop().then(function () {\n        currentNodes.should.not.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        currentNodes.should.not.have.a.property(\"4\");\n        currentNodes.should.not.have.a.property(\"5\");\n        stoppedNodes.should.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        stoppedNodes.should.have.a.property(\"4\");\n        stoppedNodes.should.have.a.property(\"5\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"detects dependency loops in config nodes","suites":["Flow","#start"],"updatePoint":{"line":358,"column":48,"index":10646},"line":358,"code":"    it(\"detects dependency loops in config nodes\", function () {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"node1\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"node2\"\n      }, // This node depends on #5\n      {\n        id: \"node2\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"node1\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      /*jshint immed: false */\n\n      (function () {\n        flow.start();\n      }).should.throw(\"Circular config node dependency detected: node1\");\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"rewires nodes specified by diff","suites":["Flow","#start"],"updatePoint":{"line":381,"column":39,"index":11231},"line":381,"code":"    it(\"rewires nodes specified by diff\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      createCount.should.equal(0);\n      flow.start(); //TODO: use update to pass in new wiring and verify the change\n\n      createCount.should.equal(3);\n      flow.start({\n        rewired: [\"2\"]\n      });\n      createCount.should.equal(3);\n      rewiredNodes.should.have.a.property(\"2\");\n      done();\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates a node with environment variable property values","suites":["Flow","#start"],"updatePoint":{"line":422,"column":69,"index":12192},"line":422,"code":"    it(\"instantiates a node with environment variable property values\", function (done) {\n      after(function () {\n        delete process.env.NODE_RED_TEST_VALUE;\n      });\n      process.env.NODE_RED_TEST_VALUE = \"a-value\";\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE)\",\n        wires: []\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: {\n          a: \"$(NODE_RED_TEST_VALUE)\"\n        },\n        wires: []\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \" $(NODE_RED_TEST_VALUE)\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE) \",\n        wires: []\n      }, {\n        id: \"5\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE_NONE)\",\n        wires: []\n      }, {\n        id: \"6\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: [\"$(NODE_RED_TEST_VALUE)\"],\n        wires: []\n      }]);\n      var flow = Flow.create({\n        getSetting: v => process.env[v]\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].foo.should.equal(\"a-value\");\n      activeNodes[\"2\"].foo.a.should.equal(\"a-value\");\n      activeNodes[\"3\"].foo.should.equal(\" $(NODE_RED_TEST_VALUE)\");\n      activeNodes[\"4\"].foo.should.equal(\"$(NODE_RED_TEST_VALUE) \");\n      activeNodes[\"5\"].foo.should.equal(\"$(NODE_RED_TEST_VALUE_NONE)\");\n      activeNodes[\"6\"].foo[0].should.equal(\"a-value\");\n      flow.stop().then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"ignores disabled nodes","suites":["Flow","#start"],"updatePoint":{"line":496,"column":30,"index":14045},"line":496,"code":"    it(\"ignores disabled nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        d: true,\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }, {\n        id: \"5\",\n        z: \"t1\",\n        type: \"test\",\n        d: true,\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(3);\n      flow.getNode('1').should.have.a.property('id', '1');\n      should.not.exist(flow.getNode('2'));\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4');\n      should.not.exist(flow.getNode('5'));\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.not.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1); // Message doesn't reach 3 as 2 is disabled\n\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n        flow.stop().then(function () {\n          try {\n            currentNodes.should.not.have.a.property(\"1\");\n            currentNodes.should.not.have.a.property(\"2\");\n            currentNodes.should.not.have.a.property(\"3\");\n            currentNodes.should.not.have.a.property(\"4\");\n            stoppedNodes.should.have.a.property(\"1\");\n            stoppedNodes.should.not.have.a.property(\"2\");\n            stoppedNodes.should.have.a.property(\"3\");\n            stoppedNodes.should.have.a.property(\"4\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops all nodes","suites":["Flow","#stop"],"updatePoint":{"line":577,"column":23,"index":16452},"line":577,"code":"    it(\"stops all nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"asyncTest\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop().then(function () {\n        currentNodes.should.not.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        stoppedNodes.should.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops specified nodes","suites":["Flow","#stop"],"updatePoint":{"line":621,"column":29,"index":17626},"line":621,"code":"    it(\"stops specified nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop([\"2\"]).then(function () {\n        currentNodes.should.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.have.a.property(\"3\");\n        stoppedNodes.should.not.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.not.have.a.property(\"3\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops config nodes last","suites":["Flow","#stop"],"updatePoint":{"line":665,"column":31,"index":18790},"line":665,"code":"    it(\"stops config nodes last\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"c1\",\n        z: \"t1\",\n        type: \"test\"\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"c2\",\n        z: \"t1\",\n        type: \"test\"\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"c3\",\n        z: \"t1\",\n        type: \"test\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"c1\");\n      currentNodes.should.have.a.property(\"c2\");\n      currentNodes.should.have.a.property(\"c3\");\n      stoppedOrder.should.have.a.length(0);\n      flow.stop().then(function () {\n        stoppedOrder.should.eql(['1', '2', '3', 'c1', 'c2', 'c3']);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"Times out a node that fails to close","suites":["Flow","#stop"],"updatePoint":{"line":720,"column":44,"index":20122},"line":720,"code":"    it(\"Times out a node that fails to close\", function (done) {\n      Flow.init({\n        settings: {\n          nodeCloseTimeout: 50\n        },\n        log: {\n          log: sinon.stub(),\n          debug: sinon.stub(),\n          trace: sinon.stub(),\n          warn: sinon.stub(),\n          info: sinon.stub(),\n          metric: sinon.stub(),\n          _: function () {\n            return \"abc\";\n          }\n        }\n      });\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testAsync\",\n        closeDelay: 80,\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop().then(function () {\n        currentNodes.should.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        stoppedNodes.should.not.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        setTimeout(function () {\n          currentNodes.should.not.have.a.property(\"1\");\n          stoppedNodes.should.have.a.property(\"1\");\n          done();\n        }, 40);\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"gets a node known to the flow","suites":["Flow","#getNode"],"updatePoint":{"line":787,"column":37,"index":21881},"line":787,"code":"    it(\"gets a node known to the flow\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes to parent if node not known locally","suites":["Flow","#getNode"],"updatePoint":{"line":829,"column":50,"index":22804},"line":829,"code":"    it(\"passes to parent if node not known locally\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({\n        getNode: id => {\n          return {\n            id: id\n          };\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('parentNode').should.have.a.property('id', 'parentNode');\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"does not pass to parent if cancelBubble set","suites":["Flow","#getNode"],"updatePoint":{"line":878,"column":51,"index":23898},"line":878,"code":"    it(\"does not pass to parent if cancelBubble set\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({\n        getNode: id => {\n          return {\n            id: id\n          };\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      should.not.exist(flow.getNode('parentNode', true));\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the adjacent status node","suites":["Flow","#handleStatus"],"updatePoint":{"line":929,"column":57,"index":25027},"line":929,"code":"    it(\"passes a status event to the adjacent status node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(5);\n      flow.handleStatus(config.flows[\"t1\"].nodes[\"1\"], {\n        text: \"my-status\",\n        random: \"otherProperty\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"random\", \"otherProperty\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the adjacent scoped status node ","suites":["Flow","#handleStatus"],"updatePoint":{"line":1004,"column":65,"index":27452},"line":1004,"code":"    it(\"passes a status event to the adjacent scoped status node \", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"2\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"1\"],\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(5);\n      flow.handleStatus(config.flows[\"t1\"].nodes[\"1\"], {\n        text: \"my-status\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the adjacent catch node","suites":["Flow","#handleError"],"updatePoint":{"line":1074,"column":56,"index":29377},"line":1074,"code":"    it(\"passes an error event to the adjacent catch node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(6);\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\"); // Node sn3 has uncaught:true - so should not get called\n\n        currentNodes[\"sn3\"].should.have.a.property(\"handled\", 0);\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the adjacent scoped catch node ","suites":["Flow","#handleError"],"updatePoint":{"line":1157,"column":64,"index":31946},"line":1157,"code":"    it(\"passes an error event to the adjacent scoped catch node \", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"2\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"1\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }, {\n        id: \"sn4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(7);\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\"); // Node sn3/4 have uncaught:true - so should not get called\n\n        currentNodes[\"sn3\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn4\"].should.have.a.property(\"handled\", 0); // Inject error that sn1/2 will ignore - so should get picked up by sn3\n\n        flow.handleError(config.flows[\"t1\"].nodes[\"3\"], \"my-error-2\", {\n          a: \"foo-2\"\n        });\n        setTimeout(function () {\n          currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n          currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"sn3\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"sn4\"].should.have.a.property(\"handled\", 1);\n          statusMessage = currentNodes[\"sn3\"].messages[0];\n          statusMessage.should.have.a.property(\"error\");\n          statusMessage.error.should.have.a.property(\"message\", \"my-error-2\");\n          statusMessage.error.should.have.a.property(\"source\");\n          statusMessage.error.source.should.have.a.property(\"id\", \"3\");\n          statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n          flow.stop().then(function () {\n            done();\n          });\n        }, 50);\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"moves any existing error object sideways","suites":["Flow","#handleError"],"updatePoint":{"line":1260,"column":48,"index":35201},"line":1260,"code":"    it(\"moves any existing error object sideways\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\",\n        error: \"existing\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"_error\", \"existing\");\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"prevents an error looping more than 10 times","suites":["Flow","#handleError"],"updatePoint":{"line":1318,"column":52,"index":36865},"line":1318,"code":"    it(\"prevents an error looping more than 10 times\", function () {});","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a complete event to the adjacent Complete node","suites":["Flow","#handleComplete"],"updatePoint":{"line":1321,"column":61,"index":36996},"line":1321,"code":"    it(\"passes a complete event to the adjacent Complete node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testDone\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testDone\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"cn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"complete\",\n        scope: [\"1\", \"3\"],\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4);\n      var msg = {\n        payload: \"hello world\"\n      };\n      var n1 = currentNodes[\"1\"].receive(msg);\n      setTimeout(function () {\n        currentNodes[\"cn\"].should.have.a.property(\"handled\", 2);\n        currentNodes[\"cn\"].messages[0].should.have.a.property(\"handled\", 1);\n        currentNodes[\"cn\"].messages[1].should.have.a.property(\"handled\", 2);\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - no cloning","suites":["Flow","#send"],"updatePoint":{"line":1377,"column":36,"index":38376},"line":1377,"code":"    it(\"sends a message - no cloning\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      var messageReceived = false;\n\n      n2.receive = function (msg) {\n        messageReceived = true;\n\n        try {\n          msg.should.be.exactly(message);\n          shutdownTest();\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: false\n      }]);\n      messageReceived.should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - cloning","suites":["Flow","#send"],"updatePoint":{"line":1440,"column":33,"index":39741},"line":1440,"code":"    it(\"sends a message - cloning\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n\n      n2.receive = function (msg) {\n        try {\n          // Message should be cloned\n          msg.should.be.eql(message);\n          msg.should.not.be.exactly(message);\n          shutdownTest();\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: true\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends multiple messages","suites":["Flow","#send"],"updatePoint":{"line":1501,"column":31,"index":41074},"line":1501,"code":"    it(\"sends multiple messages\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      var messageCount = 0;\n\n      n2.receive = function (msg) {\n        try {\n          msg.should.be.exactly(messages[messageCount++]);\n\n          if (messageCount === 2) {\n            shutdownTest();\n          }\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n\n      var messages = [{\n        payload: \"hello\"\n      }, {\n        payload: \"world\"\n      }];\n      flow.send([{\n        msg: messages[0],\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        }\n      }, {\n        msg: messages[1],\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        }\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - triggers hooks","suites":["Flow","#send"],"updatePoint":{"line":1575,"column":40,"index":42629},"line":1575,"code":"    it(\"sends a message - triggers hooks\", function (done) {\n      var hookErrors = [];\n      var messageReceived = false;\n      var hooksCalled = [];\n      hooks.add(\"onSend\", function (sendEvents) {\n        hooksCalled.push(\"onSend\");\n\n        try {\n          messageReceived.should.be.false();\n          sendEvents.should.have.length(1);\n          sendEvents[0].msg.should.be.exactly(message);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"preRoute\", function (sendEvent) {\n        hooksCalled.push(\"preRoute\");\n\n        try {\n          messageReceived.should.be.false();\n          sendEvent.msg.should.be.exactly(message);\n          should.not.exist(sendEvent.destination.node);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"preDeliver\", function (sendEvent) {\n        hooksCalled.push(\"preDeliver\");\n\n        try {\n          messageReceived.should.be.false(); // Cloning should have happened\n\n          sendEvent.msg.should.not.be.exactly(message); // Destinatino node populated\n\n          should.exist(sendEvent.destination.node);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"postDeliver\", function (sendEvent) {\n        hooksCalled.push(\"postDeliver\");\n\n        try {\n          messageReceived.should.be.false();\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n\n      n2.receive = function (msg) {\n        messageReceived = true;\n\n        try {\n          msg.should.be.eql(message);\n          msg.should.not.be.exactly(message);\n          hooksCalled.should.eql([\"onSend\", \"preRoute\", \"preDeliver\", \"postDeliver\"]);\n\n          if (hookErrors.length > 0) {\n            shutdownTest(hookErrors[0]);\n          } else {\n            shutdownTest();\n          }\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: true\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"onSend","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1789,"column":16,"index":48133},"line":1789,"code":"      it(\"onSend\", function (done) {\n        testHook(\"onSend\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preRoute","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1792,"column":18,"index":48223},"line":1792,"code":"      it(\"preRoute\", function (done) {\n        testHook(\"preRoute\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preDeliver","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1795,"column":20,"index":48317},"line":1795,"code":"      it(\"preDeliver\", function (done) {\n        testHook(\"preDeliver\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"postDeliver","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1798,"column":21,"index":48414},"line":1798,"code":"      it(\"postDeliver\", function (done) {\n        testHook(\"postDeliver\", true, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"onSend","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1906,"column":16,"index":51195},"line":1906,"code":"      it(\"onSend\", function (done) {\n        testHook(\"onSend\", done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preRoute","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1909,"column":18,"index":51278},"line":1909,"code":"      it(\"preRoute\", function (done) {\n        testHook(\"preRoute\", done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preDeliver","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1912,"column":20,"index":51365},"line":1912,"code":"      it(\"preDeliver\", function (done) {\n        testHook(\"preDeliver\", done);\n      }); // postDeliver happens after delivery is scheduled so cannot stop it","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"can instantiate a node with environment variable property values of group and tab","suites":["Flow","#env"],"updatePoint":{"line":1919,"column":89,"index":51716},"line":1919,"code":"    it(\"can instantiate a node with environment variable property values of group and tab\", function (done) {\n      try {\n        after(function () {\n          delete process.env.V0;\n          delete process.env.V1;\n        });\n        process.env.V0 = \"gv0\";\n        process.env.V1 = \"gv1\";\n        var config = flowUtils.parseConfig([{\n          id: \"t1\",\n          type: \"tab\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v0\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g1\",\n          type: \"group\",\n          z: \"t1\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v1\",\n            type: \"str\"\n          }, {\n            \"name\": \"V1\",\n            value: \"v2\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g2\",\n          type: \"group\",\n          z: \"t1\",\n          g: \"g1\",\n          env: [{\n            \"name\": \"V1\",\n            value: \"v3\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"1\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"$(V0)\",\n          wires: []\n        }, {\n          id: \"2\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"$(V0)\",\n          wires: []\n        }, {\n          id: \"3\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }, {\n          id: \"4\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g2\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }, {\n          id: \"5\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }]);\n        var flow = Flow.create({\n          getSetting: v => process.env[v]\n        }, config, config.flows[\"t1\"]);\n        flow.start();\n        var activeNodes = flow.getActiveNodes();\n        activeNodes[\"1\"].foo.should.equal(\"v0\");\n        activeNodes[\"2\"].foo.should.equal(\"v1\");\n        activeNodes[\"3\"].foo.should.equal(\"v2\");\n        activeNodes[\"4\"].foo.should.equal(\"v3\");\n        activeNodes[\"5\"].foo.should.equal(\"gv1\");\n        flow.stop().then(function () {\n          done();\n        });\n      } catch (e) {\n        console.log(e.stack);\n        done(e);\n      }\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"can access environment variable property using $parent","suites":["Flow","#env"],"updatePoint":{"line":2020,"column":62,"index":54070},"line":2020,"code":"    it(\"can access environment variable property using $parent\", function (done) {\n      try {\n        after(function () {\n          delete process.env.V0;\n          delete process.env.V1;\n        });\n        process.env.V0 = \"gv0\";\n        process.env.V1 = \"gv1\";\n        var config = flowUtils.parseConfig([{\n          id: \"t1\",\n          type: \"tab\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v0\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g1\",\n          type: \"group\",\n          z: \"t1\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v1\",\n            type: \"str\"\n          }, {\n            \"name\": \"V1\",\n            value: \"v2\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g2\",\n          type: \"group\",\n          z: \"t1\",\n          g: \"g1\",\n          env: [{\n            \"name\": \"V1\",\n            value: \"v3\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"1\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"${$parent.V0}\",\n          wires: []\n        }, {\n          id: \"2\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"${$parent.V0}\",\n          wires: []\n        }, {\n          id: \"3\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }, {\n          id: \"4\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g2\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }, {\n          id: \"5\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }]);\n        var flow = Flow.create({\n          getSetting: v => process.env[v]\n        }, config, config.flows[\"t1\"]);\n        flow.start();\n        var activeNodes = flow.getActiveNodes();\n        activeNodes[\"1\"].foo.should.equal(\"gv0\");\n        activeNodes[\"2\"].foo.should.equal(\"v0\");\n        activeNodes[\"3\"].foo.should.equal(\"gv1\");\n        activeNodes[\"4\"].foo.should.equal(\"v2\");\n        activeNodes[\"5\"].foo.should.equal(\"gv1\");\n        flow.stop().then(function () {\n          done();\n        });\n      } catch (e) {\n        console.log(e.stack);\n        done(e);\n      }\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sets the full flow","suites":["flows/index","#setFlows"],"updatePoint":{"line":135,"column":26,"index":4013},"line":135,"code":"    it('sets the full flow', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        credentialsClean.called.should.be.true();\n        storage.hasOwnProperty('conf').should.be.true();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the full flow for type load","suites":["flows/index","#setFlows"],"updatePoint":{"line":159,"column":41,"index":4625},"line":159,"code":"    it('loads the full flow for type load', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var loadStorage = {\n        saveFlows: function (conf) {\n          loadStorage.conf = conf;\n          return Promise.resolve(456);\n        },\n        getFlows: function () {\n          return Promise.resolve({\n            flows: originalConfig,\n            rev: 123\n          });\n        }\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: loadStorage\n      });\n      flows.setFlows(originalConfig, \"load\").then(function () {\n        credentialsClean.called.should.be.false(); // 'load' type does not trigger a save\n\n        loadStorage.hasOwnProperty('conf').should.be.false();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"extracts credentials from the full flow","suites":["flows/index","#setFlows"],"updatePoint":{"line":196,"column":47,"index":5605},"line":196,"code":"    it('extracts credentials from the full flow', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [],\n        credentials: {\n          \"a\": 1\n        }\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        credentialsClean.called.should.be.true();\n        storage.hasOwnProperty('conf').should.be.true();\n        var cleanedFlows = flows.getFlows();\n        storage.conf.flows.should.eql(cleanedFlows.flows);\n        cleanedFlows.flows.should.not.eql(originalConfig);\n        cleanedFlows.flows[0].credentials = {\n          \"a\": 1\n        };\n        cleanedFlows.flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"sets the full flow including credentials","suites":["flows/index","#setFlows"],"updatePoint":{"line":229,"column":48,"index":6508},"line":229,"code":"    it('sets the full flow including credentials', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var credentials = {\n        \"t1-1\": {\n          \"a\": 1\n        }\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig, credentials).then(function () {\n        credentialsClean.called.should.be.true();\n        credentialsAdd.called.should.be.true();\n        credentialsAdd.lastCall.args[0].should.eql(\"t1-1\");\n        credentialsAdd.lastCall.args[1].should.eql({\n          \"a\": 1\n        });\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updates existing flows with partial deployment - nodes","suites":["flows/index","#setFlows"],"updatePoint":{"line":262,"column":62,"index":7367},"line":262,"code":"    it('updates existing flows with partial deployment - nodes', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var newConfig = clone(originalConfig);\n      newConfig.push({\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      });\n      newConfig.push({\n        id: \"t2\",\n        type: \"tab\"\n      });\n      newConfig.push({\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      });\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      events.once('flows:started', function () {\n        flows.setFlows(newConfig, \"nodes\").then(function () {\n          flows.getFlows().flows.should.eql(newConfig);\n          flowCreate.flows['t1'].update.called.should.be.true();\n          flowCreate.flows['t2'].start.called.should.be.true();\n          flowCreate.flows['_GLOBAL_'].update.called.should.be.true();\n          done();\n        });\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updates existing flows with partial deployment - flows","suites":["flows/index","#setFlows"],"updatePoint":{"line":320,"column":62,"index":8758},"line":320,"code":"    it('updates existing flows with partial deployment - flows', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var newConfig = clone(originalConfig);\n      newConfig.push({\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      });\n      newConfig.push({\n        id: \"t2\",\n        type: \"tab\"\n      });\n      newConfig.push({\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      });\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      events.once('flows:started', function () {\n        flows.setFlows(newConfig, \"nodes\").then(function () {\n          flows.getFlows().flows.should.eql(newConfig);\n          flowCreate.flows['t1'].update.called.should.be.true();\n          flowCreate.flows['t2'].start.called.should.be.true();\n          flowCreate.flows['_GLOBAL_'].update.called.should.be.true();\n          flows.stopFlows().then(done);\n        });\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"returns error if it cannot decrypt credentials","suites":["flows/index","#setFlows"],"updatePoint":{"line":378,"column":54,"index":10163},"line":378,"code":"    it('returns error if it cannot decrypt credentials', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var credentials = {\n        \"$\": \"fail\"\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig, credentials).then(function () {\n        done(\"Unexpected success when credentials couldn't be decrypted\");\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the flow config","suites":["flows/index","#load"],"updatePoint":{"line":406,"column":29,"index":10812},"line":406,"code":"    it('loads the flow config', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        credentialsLoad.called.should.be.true(); // 'load' type does not trigger a save\n\n        storage.hasOwnProperty('conf').should.be.false();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"starts the loaded config","suites":["flows/index","#startFlows"],"updatePoint":{"line":440,"column":32,"index":11610},"line":440,"code":"    it('starts the loaded config', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      events.once('flows:started', function () {\n        Object.keys(flowCreate.flows).should.eql(['_GLOBAL_', 't1']);\n        done();\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"does not start if nodes missing","suites":["flows/index","#startFlows"],"updatePoint":{"line":472,"column":39,"index":12327},"line":472,"code":"    it('does not start if nodes missing', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(() => {\n        try {\n          flowCreate.called.should.be.false();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"starts when missing nodes registered","suites":["flows/index","#startFlows"],"updatePoint":{"line":514,"column":44,"index":13181},"line":514,"code":"    it('starts when missing nodes registered', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }, {\n        id: \"t1-3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing2\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(() => {\n        flowCreate.called.should.be.false();\n        events.emit(\"type-registered\", \"missing\");\n        setTimeout(function () {\n          flowCreate.called.should.be.false();\n          events.emit(\"type-registered\", \"missing2\");\n          setTimeout(function () {\n            flowCreate.called.should.be.true();\n            done();\n          }, 10);\n        }, 10);\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"does not start if external modules missing","suites":["flows/index","#startFlows"],"updatePoint":{"line":567,"column":50,"index":14396},"line":567,"code":"    it('does not start if external modules missing', function (done) {\n      var originalConfig = [{\n        id: \"node-with-missing-modules\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      var receivedEvent = null;\n\n      var handleEvent = function (payload) {\n        receivedEvent = payload;\n      };\n\n      events.on(\"runtime-event\", handleEvent); //{id:\"runtime-state\",payload:{error:\"missing-modules\", type:\"warning\",text:\"notification.warnings.missing-modules\",modules:missingModules},retain:true});\"\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(flows.startFlows).then(() => {\n        events.removeListener(\"runtime-event\", handleEvent);\n\n        try {\n          flowCreate.called.should.be.false();\n          receivedEvent.should.have.property('id', 'runtime-state');\n          receivedEvent.should.have.property('payload', {\n            state: 'stop',\n            error: 'missing-modules',\n            type: 'warning',\n            text: 'notification.warnings.missing-modules',\n            modules: []\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"iterates the flow nodes","suites":["flows/index","#eachNode"],"updatePoint":{"line":621,"column":31,"index":15887},"line":621,"code":"    it('iterates the flow nodes', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        var c = 0;\n        flows.eachNode(function (node) {\n          c++;\n        });\n        c.should.equal(2);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"returns cleanly if type not is use","suites":["flows/index","#checkTypeInUse"],"updatePoint":{"line":780,"column":42,"index":21487},"line":780,"code":"    it('returns cleanly if type not is use', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        flows.checkTypeInUse(\"unused-module\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error if type is in use","suites":["flows/index","#checkTypeInUse"],"updatePoint":{"line":802,"column":38,"index":21977},"line":802,"code":"    it('throws error if type is in use', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        /*jshint immed: false */\n        try {\n          flows.checkTypeInUse(\"used-module\");\n          done(\"type_in_use error not thrown\");\n        } catch (err) {\n          err.code.should.eql(\"type_in_use\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects duplicate node id","suites":["flows/index","#addFlow"],"updatePoint":{"line":832,"column":33,"index":22682},"line":832,"code":"    it(\"rejects duplicate node id\", function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.addFlow({\n          label: 'new flow',\n          nodes: [{\n            id: \"t1-1\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }]\n        }).then(function () {\n          done(new Error('failed to reject duplicate node id'));\n        }).catch(function (err) {\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"addFlow","suites":["flows/index","#addFlow"],"updatePoint":{"line":874,"column":15,"index":23571},"line":874,"code":"    it(\"addFlow\", function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n\n      storage.setFlows = function () {\n        return Promise.resolve();\n      };\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(function () {\n        flows.addFlow({\n          label: 'new flow',\n          nodes: [{\n            id: \"t2-1\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }, {\n            id: \"t2-2\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }, {\n            id: \"t2-3\",\n            z: \"t1\",\n            type: \"test\"\n          }]\n        }).then(function (id) {\n          flows.getFlows().flows.should.have.lengthOf(6);\n          var createdFlows = Object.keys(flowCreate.flows);\n          createdFlows.should.have.lengthOf(3);\n          createdFlows[2].should.eql(id);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updateFlow","suites":["flows/index","#updateFlow"],"line":939,"code":"    it.skip(\"updateFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"removeFlow","suites":["flows/index","#removeFlow"],"line":942,"code":"    it.skip(\"removeFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"disableFlow","suites":["flows/index","#disableFlow"],"line":945,"code":"    it.skip(\"disableFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"enableFlow","suites":["flows/index","#enableFlow"],"line":948,"code":"    it.skip(\"enableFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"instantiates a subflow and stops it","suites":["Subflow","#start"],"updatePoint":{"line":320,"column":43,"index":8636},"line":320,"code":"    it(\"instantiates a subflow and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\", \"4\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }, {\n          \"wires\": [{\n            \"id\": \"sf1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        foo: \"sf1-cn\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sf1-cn\",\n        type: \"test\",\n        \"z\": \"sf1\"\n      }]);\n      var flow = Flow.create({\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4); // var sfInstanceId = Object.keys(activeNodes)[5];\n      // var sfInstanceId2 = Object.keys(activeNodes)[6];\n\n      var sfConfigId = Object.keys(activeNodes)[4];\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('2').should.have.a.property('id', '2');\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4'); // flow.getNode(sfInstanceId).should.have.a.property('id',sfInstanceId);\n      // flow.getNode(sfInstanceId2).should.have.a.property('id',sfInstanceId2);\n      // flow.getNode(sfConfigId).should.have.a.property('id',sfConfigId);\n      // flow.getNode(sfInstanceId2).should.have.a.property('foo',sfConfigId);\n\n      Object.keys(currentNodes).should.have.length(6);\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.not.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\"); // currentNodes.should.have.a.property(sfInstanceId);\n      // currentNodes.should.have.a.property(sfInstanceId2);\n      // currentNodes.should.have.a.property(sfConfigId);\n\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"4\"].should.have.a.property(\"handled\", 0); // currentNodes[sfInstanceId].should.have.a.property(\"handled\",0);\n      // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",0);\n\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1); // currentNodes[sfInstanceId].should.have.a.property(\"handled\",1);\n        // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",1);\n\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"4\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          Object.keys(currentNodes).should.have.length(0);\n          Object.keys(stoppedNodes).should.have.length(6); // currentNodes.should.not.have.a.property(\"1\");\n          // currentNodes.should.not.have.a.property(\"3\");\n          // currentNodes.should.not.have.a.property(\"4\");\n          // // currentNodes.should.not.have.a.property(sfInstanceId);\n          // // currentNodes.should.not.have.a.property(sfInstanceId2);\n          // // currentNodes.should.not.have.a.property(sfConfigId);\n          // stoppedNodes.should.have.a.property(\"1\");\n          // stoppedNodes.should.have.a.property(\"3\");\n          // stoppedNodes.should.have.a.property(\"4\");\n          // // stoppedNodes.should.have.a.property(sfInstanceId);\n          // // stoppedNodes.should.have.a.property(sfInstanceId2);\n          // // stoppedNodes.should.have.a.property(sfConfigId);\n\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates a subflow inside a subflow and stops it","suites":["Subflow","#start"],"updatePoint":{"line":456,"column":60,"index":13220},"line":456,"code":"    it(\"instantiates a subflow inside a subflow and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\", \"4\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 1\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf2\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          wires: []\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"subflow:sf2\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          Object.keys(currentNodes).should.have.length(0);\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"rewires a subflow node on update/start","suites":["Subflow","#start"],"updatePoint":{"line":552,"column":46,"index":15335},"line":552,"code":"    it(\"rewires a subflow node on update/start\", function (done) {\n      var rawConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test1\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"test2\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }];\n      var config = flowUtils.parseConfig(clone(rawConfig));\n      rawConfig[2].wires = [[\"4\"]];\n      var newConfig = flowUtils.parseConfig(rawConfig);\n      var diff = flowUtils.diffConfigs(config, newConfig);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4); // var sfInstanceId = Object.keys(activeNodes)[4];\n      // var sfInstanceId2 = Object.keys(activeNodes)[5];\n\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"4\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1); // currentNodes[sfInstanceId].should.have.a.property(\"handled\",1);\n        // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",1);\n\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"4\"].should.have.a.property(\"handled\", 0);\n        flow.update(newConfig, newConfig.flows[\"t1\"]);\n        flow.start(diff);\n        currentNodes[\"1\"].receive({\n          payload: \"test2\"\n        });\n        setTimeout(function () {\n          currentNodes[\"1\"].should.have.a.property(\"handled\", 2); // currentNodes[sfInstanceId].should.have.a.property(\"handled\",2);\n          // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",2);\n\n          currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"4\"].should.have.a.property(\"handled\", 1);\n          flow.stop().then(function () {\n            done();\n          });\n        }, 150);\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"stops subflow instance nodes","suites":["Subflow","#stop"],"updatePoint":{"line":659,"column":36,"index":18375},"line":659,"code":"    it(\"stops subflow instance nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(3);\n      Object.keys(stoppedNodes).should.have.length(0);\n      flow.stop([\"2\"]).then(function () {\n        Object.keys(currentNodes).should.have.length(2);\n        Object.keys(stoppedNodes).should.have.length(1);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the subflow's parent tab status node - all scope","suites":["Subflow","#handleStatus"],"updatePoint":{"line":723,"column":81,"index":19886},"line":723,"code":"    it(\"passes a status event to the subflow's parent tab status node - all scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"testStatus\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"test-status-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the subflow's parent tab status node - targetted scope","suites":["Subflow","#handleStatus"],"updatePoint":{"line":802,"column":87,"index":21901},"line":802,"code":"    it(\"passes a status event to the subflow's parent tab status node - targetted scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"2\"],\n        wires: []\n      }]);\n      var parentFlowStatusCalled = false;\n      var flow = Flow.create({\n        handleStatus: () => {\n          parentFlowStatusCalled = true;\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        parentFlowStatusCalled.should.be.false();\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"testStatus\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"test-status-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.payload as string","suites":["Subflow","status node"],"updatePoint":{"line":889,"column":102,"index":24161},"line":889,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.payload as string\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test-payload\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test-payload\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.payload as status obj","suites":["Subflow","status node"],"updatePoint":{"line":974,"column":106,"index":26259},"line":974,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.payload as status obj\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: {\n          text: \"payload-obj\"\n        }\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"payload-obj\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.status","suites":["Subflow","status node"],"updatePoint":{"line":1061,"column":91,"index":28368},"line":1061,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.status\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        status: {\n          text: \"status-obj\"\n        }\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"status-obj\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"does not emit a regular status event if it contains a subflow-status node","suites":["Subflow","status node"],"updatePoint":{"line":1148,"column":81,"index":30464},"line":1148,"code":"    it(\"does not emit a regular status event if it contains a subflow-status node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: []\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test-payload\"\n      });\n      currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n      flow.stop().then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the subflow's parent tab catch node - all scope","suites":["Subflow","#handleError"],"updatePoint":{"line":1224,"column":80,"index":32079},"line":1224,"code":"    it(\"passes an error event to the subflow's parent tab catch node - all scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        name: \"test-error-node\",\n        type: \"testError\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"test error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"testError\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"test-error-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the subflow's parent tab catch node - targetted scope","suites":["Subflow","#handleError"],"updatePoint":{"line":1303,"column":86,"index":34085},"line":1303,"code":"    it(\"passes an error event to the subflow's parent tab catch node - targetted scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        name: \"test-error-node\",\n        type: \"testError\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"2\"],\n        wires: []\n      }]);\n      var parentFlowErrorCalled = false;\n      var flow = Flow.create({\n        handleError: () => {\n          parentFlowErrorCalled = true;\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        parentFlowErrorCalled.should.be.false();\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"test error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"testError\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"test-error-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access process env var","suites":["Subflow","#env var"],"updatePoint":{"line":1409,"column":34,"index":36621},"line":1409,"code":"    it(\"can access process env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testEnv\",\n        z: \"sf1\",\n        foo: \"sf1-cn\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      process.env[\"__KEY__\"] = \"__VAL__\";\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL__\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access subflow env var","suites":["Subflow","#env var"],"updatePoint":{"line":1487,"column":34,"index":38277},"line":1487,"code":"    it(\"can access subflow env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var testenv_node = null;\n\n      for (var n in currentNodes) {\n        var node = currentNodes[n];\n\n        if (node.type === \"testEnv\") {\n          testenv_node = node;\n          break;\n        }\n      }\n\n      process.env[\"__KEY__\"] = \"__VAL0__\";\n      setEnv(testenv_node, \"__KEY__\", \"__VAL1__\");\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL1__\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access nested subflow env var","suites":["Subflow","#env var"],"updatePoint":{"line":1577,"column":41,"index":40203},"line":1577,"code":"    it(\"can access nested subflow env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 1\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf2\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf2-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf2-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"subflow:sf2\",\n        z: \"sf1\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }, {\n        id: \"sf2-1\",\n        type: \"test\",\n        z: \"sf2\",\n        foo: \"sf2.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf2-2\"]]\n      }, {\n        id: \"sf2-2\",\n        type: \"testEnv\",\n        z: \"sf2\",\n        foo: \"sf2.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var node_sf1_1 = null;\n      var node_sf2_1 = null;\n      var testenv_node = null;\n\n      for (var n in currentNodes) {\n        var node = currentNodes[n];\n\n        if (node.foo === \"sf1.1\") {\n          node_sf1_1 = node;\n        }\n\n        if (node.foo === \"sf2.1\") {\n          node_sf2_1 = node;\n        }\n      }\n\n      process.env[\"__KEY__\"] = \"__VAL0__\";\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL0__\");\n        setEnv(node_sf1_1, \"__KEY__\", \"__VAL1__\");\n        currentNodes[\"1\"].receive({\n          payload: \"test\"\n        });\n        setTimeout(function () {\n          currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL1__\");\n          setEnv(node_sf2_1, \"__KEY__\", \"__VAL2__\");\n          currentNodes[\"1\"].receive({\n            payload: \"test\"\n          });\n          setTimeout(function () {\n            currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL2__\");\n            flow.stop().then(function () {\n              done();\n            });\n          }, 150);\n        }, 150);\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access name of subflow as env var","suites":["Subflow","#env var"],"updatePoint":{"line":1716,"column":45,"index":43289},"line":1716,"code":"    it(\"can access name of subflow as env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        name: \"SFN\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testNameEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"SFN\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access id of subflow as env var","suites":["Subflow","#env var"],"updatePoint":{"line":1794,"column":43,"index":44932},"line":1794,"code":"    it(\"can access id of subflow as env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        name: \"SFN\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testIDEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"2\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"handles ENV substitutions in an object - $()","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":51,"column":52,"index":1584},"line":51,"code":"    it('handles ENV substitutions in an object - $()', function () {\n      var foo = {\n        a: \"$(foo1)\",\n        b: \"$(foo2)\",\n        c: {\n          d: \"$(foo3)\"\n        }\n      };\n\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: p => process.env[p]\n          });\n        }\n      }\n\n      foo.should.eql({\n        a: 'bar1',\n        b: 'bar2',\n        c: {\n          d: 'bar3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles ENV substitutions in an object - ${}","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":76,"column":52,"index":2083},"line":76,"code":"    it('handles ENV substitutions in an object - ${}', function () {\n      var foo = {\n        a: \"${foo1}\",\n        b: \"${foo2}\",\n        c: {\n          d: \"${foo3}\"\n        }\n      };\n\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: p => process.env[p]\n          });\n        }\n      }\n\n      foo.should.eql({\n        a: 'bar1',\n        b: 'bar2',\n        c: {\n          d: 'bar3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"gets ENV from parent flow","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":101,"column":33,"index":2563},"line":101,"code":"    it('gets ENV from parent flow', function () {\n      var foo = {\n        a: \"$(unknown)\",\n        b: \"$(foo2)\",\n        c: {\n          d: \"$(foo3)\"\n        }\n      };\n\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: name => name[0] === 'f' ? name.toUpperCase() : undefined\n          });\n        }\n      }\n\n      foo.should.eql({\n        a: '$(unknown)',\n        b: 'FOO2',\n        c: {\n          d: 'FOO3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns a known env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":134,"column":31,"index":3261},"line":134,"code":"    it('returns a known env var', function () {\n      flowUtil.init({\n        settings: {}\n      });\n      flowUtil.getEnvVar(\"foo1\").should.equal(\"bar1\");\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns undefined for an unknown env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":140,"column":48,"index":3442},"line":140,"code":"    it('returns undefined for an unknown env var', function () {\n      flowUtil.init({\n        settings: {}\n      });\n      (flowUtil.getEnvVar(\"foo2\") === undefined).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns undefined for an excluded env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":146,"column":49,"index":3636},"line":146,"code":"    it('returns undefined for an excluded env var', function () {\n      flowUtil.init({\n        settings: {\n          envVarExcludes: ['foo1']\n        }\n      });\n      (flowUtil.getEnvVar(\"foo1\") === undefined).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles a null old node","suites":["flows/util","#diffNodes"],"updatePoint":{"line":156,"column":31,"index":3901},"line":156,"code":"    it('handles a null old node', function () {\n      flowUtil.diffNodes(null, {}).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores x/y changes","suites":["flows/util","#diffNodes"],"updatePoint":{"line":159,"column":27,"index":4006},"line":159,"code":"    it('ignores x/y changes', function () {\n      flowUtil.diffNodes({\n        x: 10,\n        y: 10\n      }, {\n        x: 20,\n        y: 10\n      }).should.be.false();\n      flowUtil.diffNodes({\n        x: 10,\n        y: 10\n      }, {\n        x: 10,\n        y: 20\n      }).should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores wiring changes","suites":["flows/util","#diffNodes"],"updatePoint":{"line":175,"column":30,"index":4309},"line":175,"code":"    it('ignores wiring changes', function () {\n      flowUtil.diffNodes({\n        wires: []\n      }, {\n        wires: [1, 2, 3]\n      }).should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - string","suites":["flows/util","#diffNodes"],"updatePoint":{"line":182,"column":47,"index":4490},"line":182,"code":"    it('spots existing property change - string', function () {\n      flowUtil.diffNodes({\n        a: \"foo\"\n      }, {\n        a: \"bar\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - number","suites":["flows/util","#diffNodes"],"updatePoint":{"line":189,"column":47,"index":4661},"line":189,"code":"    it('spots existing property change - number', function () {\n      flowUtil.diffNodes({\n        a: 0\n      }, {\n        a: 1\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - boolean","suites":["flows/util","#diffNodes"],"updatePoint":{"line":196,"column":48,"index":4825},"line":196,"code":"    it('spots existing property change - boolean', function () {\n      flowUtil.diffNodes({\n        a: true\n      }, {\n        a: false\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - truthy","suites":["flows/util","#diffNodes"],"updatePoint":{"line":203,"column":47,"index":4995},"line":203,"code":"    it('spots existing property change - truthy', function () {\n      flowUtil.diffNodes({\n        a: true\n      }, {\n        a: 1\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - falsey","suites":["flows/util","#diffNodes"],"updatePoint":{"line":210,"column":47,"index":5161},"line":210,"code":"    it('spots existing property change - falsey', function () {\n      flowUtil.diffNodes({\n        a: false\n      }, {\n        a: 0\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - array","suites":["flows/util","#diffNodes"],"updatePoint":{"line":217,"column":46,"index":5327},"line":217,"code":"    it('spots existing property change - array', function () {\n      flowUtil.diffNodes({\n        a: [0, 1, 2]\n      }, {\n        a: [0, 2, 3]\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - object","suites":["flows/util","#diffNodes"],"updatePoint":{"line":224,"column":47,"index":5506},"line":224,"code":"    it('spots existing property change - object', function () {\n      flowUtil.diffNodes({\n        a: {\n          a: [0, 1, 2]\n        }\n      }, {\n        a: {\n          a: [0, 2, 3]\n        }\n      }).should.be.true();\n      flowUtil.diffNodes({\n        a: {\n          a: [0, 1, 2]\n        }\n      }, {\n        a: {\n          b: [0, 1, 2]\n        }\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots added property","suites":["flows/util","#diffNodes"],"updatePoint":{"line":244,"column":28,"index":5873},"line":244,"code":"    it('spots added property', function () {\n      flowUtil.diffNodes({\n        a: \"foo\"\n      }, {\n        a: \"foo\",\n        b: \"bar\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots removed property","suites":["flows/util","#diffNodes"],"updatePoint":{"line":252,"column":30,"index":6045},"line":252,"code":"    it('spots removed property', function () {\n      flowUtil.diffNodes({\n        a: \"foo\",\n        b: \"bar\"\n      }, {\n        a: \"foo\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a single-tab flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":262,"column":32,"index":6266},"line":262,"code":"    it('parses a single-tab flow', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a single-tab flow with global config node","suites":["flows/util","#parseConfig"],"updatePoint":{"line":315,"column":56,"index":7486},"line":315,"code":"    it('parses a single-tab flow with global config node', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"cn\",\n        wires: []\n      }, {\n        id: \"cn\",\n        type: \"test\"\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"foo\": \"cn\",\n            \"wires\": []\n          },\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\"\n          },\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\",\n            \"_users\": [\"t1-1\"]\n          }\n        },\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"foo\": \"cn\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a multi-tab flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":384,"column":31,"index":9008},"line":384,"code":"    it('parses a multi-tab flow', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t2\",\n        type: \"tab\"\n      }, {\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"t2\": {\n            \"id\": \"t2\",\n            \"type\": \"tab\"\n          },\n          \"t2-1\": {\n            \"id\": \"t2-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t2\",\n            \"type\": \"test\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          },\n          \"t2\": {\n            \"id\": \"t2\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t2-1\": {\n                \"id\": \"t2-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t2\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a subflow flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":475,"column":29,"index":11006},"line":475,"code":"    it('parses a subflow flow', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        x: 10,\n        y: 10,\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"subflow:sf1\",\n            \"wires\": []\n          },\n          \"sf1\": {\n            \"id\": \"sf1\",\n            \"type\": \"subflow\"\n          },\n          \"sf1-1\": {\n            \"id\": \"sf1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"sf1\",\n            \"type\": \"test\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {\n          \"sf1\": {\n            \"id\": \"sf1\",\n            \"type\": \"subflow\",\n            \"configs\": {},\n            \"nodes\": {\n              \"sf1-1\": {\n                \"id\": \"sf1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"sf1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            },\n            \"instances\": [{\n              \"id\": \"t1-1\",\n              \"x\": 10,\n              \"y\": 10,\n              \"z\": \"t1\",\n              \"type\": \"subflow:sf1\",\n              \"wires\": [],\n              \"subflow\": \"sf1\"\n            }]\n          }\n        },\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"subflow:sf1\",\n                \"wires\": [],\n                \"subflow\": \"sf1\"\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow with a missing type","suites":["flows/util","#parseConfig"],"updatePoint":{"line":576,"column":41,"index":13314},"line":576,"code":"    it('parses a flow with a missing type', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"sf1\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      parsedConfig.missingTypes.should.eql(['missing']);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"sf1\",\n            \"wires\": []\n          },\n          \"t1-2\": {\n            \"id\": \"t1-2\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"missing\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"sf1\",\n                \"wires\": []\n              },\n              't1-2': {\n                id: 't1-2',\n                x: 10,\n                y: 10,\n                z: 't1',\n                type: 'missing',\n                wires: []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": [\"missing\"]\n      };\n      redUtil.compareObjects(parsedConfig, expectedConfig).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow with a missing flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":653,"column":41,"index":15111},"line":653,"code":"    it('parses a flow with a missing flow', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"cn\",\n        wires: []\n      }, {\n        id: \"cn\",\n        type: \"test\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"foo\": \"cn\",\n            \"wires\": []\n          },\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\",\n            \"_users\": [\"t1-1\"]\n          }\n        },\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"foo\": \"cn\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow including a group","suites":["flows/util","#parseConfig"],"updatePoint":{"line":715,"column":39,"index":16511},"line":715,"code":"    it('parses a flow including a group', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"g1\",\n        type: \"group\",\n        z: \"t1\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"g1\": {\n            \"id\": \"g1\",\n            \"type\": \"group\",\n            \"z\": \"t1\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {\n          \"g1\": {\n            \"id\": \"g1\",\n            \"type\": \"group\",\n            \"z\": \"t1\"\n          }\n        },\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles an identical configuration","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":785,"column":42,"index":18052},"line":785,"code":"    it('handles an identical configuration', function () {\n      var config = [{\n        id: \"123\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var originalConfig = flowUtil.parseConfig(clone(config));\n      var changedConfig = flowUtil.parseConfig(clone(config));\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed properties, including downstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":802,"column":77,"index":18760},"line":802,"code":"    it('identifies nodes with changed properties, including downstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[1]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[0].foo = \"b\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"1\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"2\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed properties, including upstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":831,"column":75,"index":19687},"line":831,"code":"    it('identifies nodes with changed properties, including upstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].bar = \"c\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"2\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed credentials, including downstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":860,"column":78,"index":20619},"line":860,"code":"    it('identifies nodes with changed credentials, including downstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[0].credentials = {};\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"1\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"2\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":888,"column":44,"index":21506},"line":888,"code":"    it('identifies nodes with changed wiring', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires[0][0] = \"3\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring - second connection added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":917,"column":70,"index":22450},"line":917,"code":"    it('identifies nodes with changed wiring - second connection added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires[0].push(\"1\");\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring - node connected","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":946,"column":61,"index":23381},"line":946,"code":"    it('identifies nodes with changed wiring - node connected', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires.push(\"3\");\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies new nodes","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":975,"column":28,"index":24283},"line":975,"code":"    it('identifies new nodes', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.push({\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.eql([\"2\"]);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies deleted nodes","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1004,"column":32,"index":25168},"line":1004,"code":"    it('identifies deleted nodes', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.splice(1, 1);\n      newConfig[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.eql([\"2\"]);\n      diffResult.rewired.should.eql([\"1\"]);\n      diffResult.linked.sort().should.eql([\"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies config nodes changes, node->config","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1034,"column":53,"index":26114},"line":1034,"code":"    it('identifies config nodes changes, node->config', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"configNode\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"configNode\",\n        type: \"testConfig\"\n      }];\n      var newConfig = clone(config);\n      newConfig[3].foo = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql([\"1\", \"configNode\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"2\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies config nodes changes, node->config->config","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1066,"column":61,"index":27142},"line":1066,"code":"    it('identifies config nodes changes, node->config->config', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"configNode1\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"configNode1\",\n        foo: \"configNode2\",\n        type: \"testConfig\"\n      }, {\n        id: \"configNode2\",\n        type: \"testConfig\"\n      }];\n      var newConfig = clone(config);\n      newConfig[4].foo = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql([\"1\", \"configNode1\", \"configNode2\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"2\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal property change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1102,"column":73,"index":28293},"line":1102,"code":"    it('marks a parent subflow as changed for an internal property change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        type: \"subflow:sf1\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[4].foo = \"b\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', '4', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal wiring change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1141,"column":71,"index":29444},"line":1141,"code":"    it('marks a parent subflow as changed for an internal wiring change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[4].wires = [[\"sf1-2\"]];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal node add","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1180,"column":66,"index":30592},"line":1180,"code":"    it('marks a parent subflow as changed for an internal node add', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.push({\n        id: \"sf1-3\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal node delete","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1224,"column":69,"index":31815},"line":1224,"code":"    it('marks a parent subflow as changed for an internal node delete', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.splice(5, 1);\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(1);\n      diffResult.removed.sort().should.eql(['sf1-2']);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - input removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1264,"column":95,"index":33037},"line":1264,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - input removed', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].in[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - input added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1314,"column":93,"index":34413},"line":1314,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - input added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].in[0].wires.push({\n        \"id\": \"sf1-2\"\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - output added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1366,"column":94,"index":35823},"line":1366,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - output added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].out[0].wires.push({\n        \"id\": \"sf1-2\",\n        \"port\": 0\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - output removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1419,"column":96,"index":37255},"line":1419,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - output removed', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].out[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for a global config node change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1469,"column":73,"index":38612},"line":1469,"code":"    it('marks a parent subflow as changed for a global config node change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        prop: \"configNode\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"configNode\",\n        a: \"foo\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[6].a = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', \"configNode\", 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow instance change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1514,"column":81,"index":39902},"line":1514,"code":"    it('marks a parent subflow as changed for an internal subflow instance change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf2\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"subflow:sf2\",\n        wires: []\n      }, {\n        id: \"sf2-1\",\n        z: \"sf2\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf2-2\",\n        z: \"sf2\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[8].a = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1', 'sf2']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores tab changes that are immaterial","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1566,"column":47,"index":41269},"line":1566,"code":"    it('ignores tab changes that are immaterial', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].label = \"barney\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a deleted tab as removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1589,"column":38,"index":42044},"line":1589,"code":"    it('marks a deleted tab as removed', function () {\n      var config = [{\n        id: \"f1\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"n1\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"f1\"\n      }, {\n        id: \"f2\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"n2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"f2\"\n      }];\n      var newConfig = clone(config);\n      newConfig = newConfig.slice(0, 2);\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.sort().should.eql(['f2', 'n2']);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks all nodes as added when tab state changes disabled to enabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1622,"column":75,"index":43054},"line":1622,"code":"    it('marks all nodes as added when tab state changes disabled to enabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: true,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].disabled = false;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(2);\n      diffResult.added.sort().should.eql([\"1\", \"2\"]);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks all nodes as removed when tab state changes enabled to disabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1650,"column":77,"index":43995},"line":1650,"code":"    it('marks all nodes as removed when tab state changes enabled to disabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: false,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].disabled = true;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(2);\n      diffResult.removed.sort().should.eql([\"1\", \"2\"]);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a node as removed when its state changes enabled to disabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1678,"column":74,"index":44935},"line":1678,"code":"    it('marks a node as removed when its state changes enabled to disabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: false,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[1].d = true;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(2);\n      diffResult.changed.sort().should.eql([\"1\", \"2\"]);\n      diffResult.removed.should.have.length(1);\n      diffResult.removed.sort().should.eql([\"2\"]);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"initialises components","suites":["runtime","init"],"updatePoint":{"line":92,"column":30,"index":2922},"line":92,"code":"    it(\"initialises components\", function () {\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\"\n      });\n      settings.init.called.should.be.true();\n      redNodes.init.called.should.be.true();\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"returns version","suites":["runtime","init"],"updatePoint":{"line":100,"column":23,"index":3146},"line":100,"code":"    it(\"returns version\", function () {\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\"\n      });\n      return runtime.version().then(version => {\n        /^\\d+\\.\\d+\\.\\d+(-.*)?$/.test(version).should.be.true();\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports errored/missing modules","suites":["runtime","start"],"updatePoint":{"line":149,"column":39,"index":4873},"line":149,"code":"    it(\"reports errored/missing modules\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        }, // error\n        {\n          module: \"module\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeA\", \"typeB\"]\n        } // missing\n        ].filter(cb);\n      });\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      }); // sinon.stub(console,\"log\");\n\n      runtime.start().then(function () {\n        // console.log.restore();\n        try {\n          storageInit.calledOnce.should.be.true();\n          redNodesInit.calledOnce.should.be.true();\n          redNodesLoad.calledOnce.should.be.true();\n          redNodesLoadFlows.calledOnce.should.be.true();\n          log.warn.calledWithMatch(\"Failed to register 1 node type\");\n          log.warn.calledWithMatch(\"Missing node modules\");\n          log.warn.calledWithMatch(\" - module: typeA, typeB\");\n          redNodesCleanModuleList.calledOnce.should.be.true();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"initiates load of missing modules","suites":["runtime","start"],"updatePoint":{"line":190,"column":41,"index":6175},"line":190,"code":"    it(\"initiates load of missing modules\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        }, // error\n        {\n          err: \"errored\",\n          name: \"errName\"\n        }, // error\n        {\n          module: \"module\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeA\", \"typeB\"]\n        }, // missing\n        {\n          module: \"node-red\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeC\", \"typeD\"]\n        } // missing\n        ].filter(cb);\n      });\n      var serverInstallModule = sinon.stub(redNodes, \"installModule\").callsFake(function (name) {\n        return Promise.resolve({\n          nodes: []\n        });\n      });\n      runtime.init({\n        testSettings: true,\n        autoInstallModules: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      });\n      sinon.stub(console, \"log\");\n      runtime.start().then(function () {\n        console.log.restore();\n\n        try {\n          log.warn.calledWithMatch(\"Failed to register 2 node types\");\n          log.warn.calledWithMatch(\"Missing node modules\");\n          log.warn.calledWithMatch(\" - module: typeA, typeB\");\n          log.warn.calledWithMatch(\" - node-red: typeC, typeD\");\n          redNodesCleanModuleList.calledOnce.should.be.false();\n          serverInstallModule.calledOnce.should.be.true();\n          serverInstallModule.calledWithMatch(\"module\");\n          done();\n        } catch (err) {\n          done(err);\n        } finally {\n          serverInstallModule.restore();\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports errored modules when verbose is enabled","suites":["runtime","start"],"updatePoint":{"line":249,"column":55,"index":7961},"line":249,"code":"    it(\"reports errored modules when verbose is enabled\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        } // error\n        ].filter(cb);\n      });\n      runtime.init({\n        testSettings: true,\n        verbose: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      });\n      sinon.stub(console, \"log\");\n      runtime.start().then(function () {\n        console.log.restore();\n\n        try {\n          log.warn.neverCalledWithMatch(\"Failed to register 1 node type\");\n          log.warn.calledWithMatch(\"[errName] errored\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports runtime metrics","suites":["runtime","start"],"updatePoint":{"line":280,"column":31,"index":8795},"line":280,"code":"    it(\"reports runtime metrics\", function (done) {\n      var stopFlows = sinon.stub(redNodes, \"stopFlows\").callsFake(function () {\n        return Promise.resolve();\n      });\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function () {\n        return [];\n      });\n      unmockUtil();\n      mockUtil(true);\n      runtime.init({\n        testSettings: true,\n        runtimeMetricInterval: 200,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      }, {}, undefined); // sinon.stub(console,\"log\");\n\n      runtime.start().then(function () {\n        // console.log.restore();\n        setTimeout(function () {\n          try {\n            log.log.args.should.have.lengthOf(3);\n            log.log.args[0][0].should.have.property(\"event\", \"runtime.memory.rss\");\n            log.log.args[1][0].should.have.property(\"event\", \"runtime.memory.heapTotal\");\n            log.log.args[2][0].should.have.property(\"event\", \"runtime.memory.heapUsed\");\n            done();\n          } catch (err) {\n            done(err);\n          } finally {\n            runtime.stop();\n            stopFlows.restore();\n          }\n        }, 300);\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"stops components","suites":["runtime","start"],"updatePoint":{"line":319,"column":22,"index":10049},"line":319,"code":"  it(\"stops components\", function (done) {\n    var stopFlows = sinon.stub(redNodes, \"stopFlows\").callsFake(function () {\n      return Promise.resolve();\n    });\n    var closeContextsPlugin = sinon.stub(redNodes, \"closeContextsPlugin\").callsFake(function () {\n      return Promise.resolve();\n    });\n    runtime.stop().then(function () {\n      stopFlows.called.should.be.true();\n      closeContextsPlugin.called.should.be.true();\n      stopFlows.restore();\n      closeContextsPlugin.restore();\n      done();\n    }).catch(function (err) {\n      stopFlows.restore();\n      closeContextsPlugin.restore();\n      return done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":91,"column":36,"index":2648},"line":91,"code":"    it('returns a flow example entry', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/abc\").then(function (result) {\n        result.should.eql(\"Example flow result\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - top level","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":97,"column":50,"index":2899},"line":97,"code":"    it('returns a flow example listing - top level', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"\").then(function (result) {\n        result.should.eql(['test-module', '@scope/test-module']);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - in module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":103,"column":50,"index":3151},"line":103,"code":"    it('returns a flow example listing - in module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module\").then(function (result) {\n        result.should.eql([{\n          fn: 'abc'\n        }]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - in scoped module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":111,"column":57,"index":3417},"line":111,"code":"    it('returns a flow example listing - in scoped module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"@scope/test-module\").then(function (result) {\n        result.should.eql([{\n          fn: 'abc'\n        }, {\n          fn: 'throw'\n        }]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry from scoped module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":121,"column":55,"index":3723},"line":121,"code":"    it('returns a flow example entry from scoped module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"@scope/test-module/abc\").then(function (result) {\n        result.should.eql(\"Example scope flow result\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for unknown flow example entry","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":127,"column":55,"index":3992},"line":127,"code":"    it('returns an error for unknown flow example entry', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"unknown/abc\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for file load error - async","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":135,"column":52,"index":4310},"line":135,"code":"    it('returns an error for file load error - async', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/unknown\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for file load error - sync","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":142,"column":51,"index":4580},"line":142,"code":"    it('returns an error for file load error - sync', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/throw\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns the default and examples libraries","suites":["runtime/library","getLibraries"],"updatePoint":{"line":83,"column":50,"index":2534},"line":83,"code":"    it('returns the default and examples libraries', function () {\n      const libs = library.getLibraries();\n      libs.should.have.length(2);\n      libs[0].should.have.property('id', 'local');\n      libs[0].should.have.property('label', 'editor:library.types.local');\n      libs[0].should.have.property(\"user\", false);\n      libs[0].should.have.property('icon', 'font-awesome/fa-hdd-o');\n      libs[1].should.have.property('id', 'examples');\n      libs[1].should.have.property('label', 'editor:library.types.examples');\n      libs[1].should.have.property(\"user\", false);\n      libs[1].should.have.property('icon', 'font-awesome/fa-life-ring');\n      libs[1].should.have.property('readOnly', true);\n      libs[1].should.have.property('types', ['flows']);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns the libraries from settings","suites":["runtime/library","getLibraries"],"updatePoint":{"line":97,"column":43,"index":3291},"line":97,"code":"    it('returns the libraries from settings', function () {\n      library.init({\n        plugins: {\n          getPlugin: id => {\n            return {\n              id: \"test-library-plugin\",\n              type: \"node-red-library-source\",\n              class: function () {}\n            };\n          }\n        },\n        settings: {\n          editorTheme: {\n            library: {\n              sources: [{\n                id: \"test-plugin-id\",\n                type: \"test-library-plugin\"\n              }]\n            }\n          }\n        }\n      });\n      let libs = library.getLibraries();\n      libs.should.have.length(2);\n      events.emit(\"registry:plugin-added\", \"test-library-plugin\");\n      libs = library.getLibraries();\n      libs.should.have.length(3);\n      libs[2].should.have.property('id', 'test-plugin-id');\n      libs[2].should.have.property(\"user\", false);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unregistered type","suites":["runtime/library","getEntry"],"updatePoint":{"line":132,"column":42,"index":4273},"line":132,"code":"    it('throws error for unregistered type', function () {\n      should(() => {\n        library.getEntry(\"local\", \"unknown\", \"/abc\");\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown library","suites":["runtime/library","getEntry"],"updatePoint":{"line":137,"column":40,"index":4431},"line":137,"code":"    it('throws error for unknown library', function () {\n      should(() => {\n        library.getEntry(\"unknown\", \"unknown\", \"/abc\");\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered non-flow entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":142,"column":43,"index":4594},"line":142,"code":"    it('returns a registered non-flow entry', function (done) {\n      library.register(\"test-module\", \"test-type\");\n      library.getEntry(\"local\", \"test-type\", \"/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"local\");\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":151,"column":28,"index":4987},"line":151,"code":"    it('returns a flow entry', function (done) {\n      library.getEntry(\"local\", \"flows\", \"/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"local\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":158,"column":36,"index":5274},"line":158,"code":"    it('returns a flow example entry', function (done) {\n      library.getEntry(\"examples\", \"flows\", \"/test-module/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"_examples_\");\n        result.should.have.property(\"path\", \"/test-module/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown library","suites":["runtime/library","saveEntry"],"updatePoint":{"line":170,"column":40,"index":5698},"line":170,"code":"    it('throws error for unknown library', function () {\n      should(() => {\n        library.saveEntry(\"unknown\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unregistered type","suites":["runtime/library","saveEntry"],"updatePoint":{"line":179,"column":42,"index":5929},"line":179,"code":"    it('throws error for unregistered type', function () {\n      should(() => {\n        library.saveEntry(\"local\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for save to readonly library","suites":["runtime/library","saveEntry"],"updatePoint":{"line":188,"column":49,"index":6165},"line":188,"code":"    it('throws error for save to readonly library', function () {\n      should(() => {\n        library.saveEntry(\"_examples_\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"saves a flow entry","suites":["runtime/library","saveEntry"],"updatePoint":{"line":197,"column":26,"index":6383},"line":197,"code":"    it('saves a flow entry', function (done) {\n      library.saveEntry('local', 'flows', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"saves a non-flow entry","suites":["runtime/library","saveEntry"],"updatePoint":{"line":210,"column":30,"index":6747},"line":210,"code":"    it('saves a non-flow entry', function (done) {\n      library.register(\"test-module\", \"test-type\");\n      library.saveEntry('local', 'test-type', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"meta\", {\n          id: \"meta\"\n        });\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered non-flow entry","suites":["runtime/library/local","getEntry"],"updatePoint":{"line":51,"column":43,"index":1450},"line":51,"code":"    it('returns a registered non-flow entry', function (done) {\n      localLibrary.getEntry(\"test-type\", \"/abc\").then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow entry","suites":["runtime/library/local","getEntry"],"updatePoint":{"line":58,"column":28,"index":1730},"line":58,"code":"    it('returns a flow entry', function (done) {\n      localLibrary.getEntry(\"flows\", \"/abc\").then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"saves a flow entry","suites":["runtime/library/local","saveEntry"],"updatePoint":{"line":81,"column":26,"index":2318},"line":81,"code":"    it('saves a flow entry', function (done) {\n      localLibrary.saveEntry('flows', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"saves a non-flow entry","suites":["runtime/library/local","saveEntry"],"updatePoint":{"line":94,"column":30,"index":2678},"line":94,"code":"    it('saves a non-flow entry', function (done) {\n      localLibrary.saveEntry('test-type', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"meta\", {\n          id: \"meta\"\n        });\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"stores local property","suites":["context","local memory"],"updatePoint":{"line":40,"column":29,"index":1196},"line":40,"code":"    it('stores local property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.get(\"foo\"));\n      context1.set(\"foo\", \"test\");\n      context1.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores local property - creates parent properties","suites":["context","local memory"],"updatePoint":{"line":47,"column":57,"index":1511},"line":47,"code":"    it('stores local property - creates parent properties', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      context1.set(\"foo.bar\", \"test\");\n      context1.get(\"foo\").should.eql({\n        bar: \"test\"\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes local property","suites":["context","local memory"],"updatePoint":{"line":55,"column":30,"index":1779},"line":55,"code":"    it('deletes local property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      context1.set(\"foo.abc.bar1\", \"test1\");\n      context1.set(\"foo.abc.bar2\", \"test2\");\n      context1.get(\"foo.abc\").should.eql({\n        bar1: \"test1\",\n        bar2: \"test2\"\n      });\n      context1.set(\"foo.abc.bar1\", undefined);\n      context1.get(\"foo.abc\").should.eql({\n        bar2: \"test2\"\n      });\n      context1.set(\"foo.abc\", undefined);\n      should.not.exist(context1.get(\"foo.abc\"));\n      context1.set(\"foo\", undefined);\n      should.not.exist(context1.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores flow property","suites":["context","local memory"],"updatePoint":{"line":73,"column":28,"index":2421},"line":73,"code":"    it('stores flow property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores global property","suites":["context","local memory"],"updatePoint":{"line":80,"column":30,"index":2724},"line":80,"code":"    it('stores global property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.global.get(\"foo\"));\n      context1.global.set(\"foo\", \"test\");\n      context1.global.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"keeps local context local","suites":["context","local memory"],"updatePoint":{"line":87,"column":33,"index":3036},"line":87,"code":"    it('keeps local context local', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowA\");\n      should.not.exist(context1.get(\"foo\"));\n      should.not.exist(context2.get(\"foo\"));\n      context1.set(\"foo\", \"test\");\n      context1.get(\"foo\").should.equal(\"test\");\n      should.not.exist(context2.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"flow context accessible to all flow nodes","suites":["context","local memory"],"updatePoint":{"line":97,"column":49,"index":3481},"line":97,"code":"    it('flow context accessible to all flow nodes', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowA\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      should.not.exist(context2.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n      context2.flow.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"flow context not shared to nodes on other flows","suites":["context","local memory"],"updatePoint":{"line":107,"column":55,"index":3960},"line":107,"code":"    it('flow context not shared to nodes on other flows', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var flowContextB = Context.getFlowContext(\"flowB\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowB\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      should.not.exist(context2.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n      should.not.exist(context2.flow.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"global context shared to all nodes","suites":["context","local memory"],"updatePoint":{"line":118,"column":42,"index":4482},"line":118,"code":"    it('global context shared to all nodes', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var flowContextB = Context.getFlowContext(\"flowB\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowB\");\n      should.not.exist(context1.global.get(\"foo\"));\n      should.not.exist(context2.global.get(\"foo\"));\n      context1.global.set(\"foo\", \"test\");\n      context1.global.get(\"foo\").should.equal(\"test\");\n      context2.global.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"context.flow/global are not enumerable","suites":["context","local memory"],"updatePoint":{"line":129,"column":46,"index":5021},"line":129,"code":"    it('context.flow/global are not enumerable', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      Object.keys(context1).length.should.equal(0);\n      Object.keys(context1.flow).length.should.equal(0);\n      Object.keys(context1.global).length.should.equal(0);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"context.flow/global cannot be deleted","suites":["context","local memory"],"updatePoint":{"line":136,"column":45,"index":5365},"line":136,"code":"    it('context.flow/global cannot be deleted', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      delete context1.flow;\n      should.exist(context1.flow);\n      delete context1.global;\n      should.exist(context1.global);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes context","suites":["context","local memory"],"updatePoint":{"line":144,"column":23,"index":5649},"line":144,"code":"    it('deletes context', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      should.not.exist(context.get(\"foo\"));\n      context.set(\"foo\", \"abc\");\n      context.get(\"foo\").should.equal(\"abc\");\n      return Context.delete(\"1\", \"flowA\").then(function () {\n        context = Context.get(\"1\", \"flowA\");\n        should.not.exist(context.get(\"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes global context","suites":["context","local memory"],"updatePoint":{"line":155,"column":30,"index":6094},"line":155,"code":"    it('deletes global context', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      return Context.load().then(function () {\n        var globalContextA = Context.get(\"global\");\n        globalContextA.get('foo').should.eql('bar');\n        globalContextA.set(\"another\", \"value\");\n        return Context.delete(\"global\").then(function () {\n          var globalContextB = Context.get(\"global\");\n          globalContextB.get('foo').should.eql('bar');\n          should.not.exist(globalContextB.get(\"another\"));\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"enumerates context keys - sync","suites":["context","local memory"],"updatePoint":{"line":172,"column":38,"index":6701},"line":172,"code":"    it('enumerates context keys - sync', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      var keys = context.keys();\n      keys.should.be.an.Array();\n      keys.should.be.empty();\n      context.set(\"foo\", \"bar\");\n      keys = context.keys();\n      keys.should.have.length(1);\n      keys[0].should.equal(\"foo\");\n      context.set(\"abc.def\", \"bar\");\n      keys = context.keys();\n      keys.should.have.length(2);\n      keys[1].should.equal(\"abc\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"enumerates context keys - async","suites":["context","local memory"],"updatePoint":{"line":187,"column":39,"index":7232},"line":187,"code":"    it('enumerates context keys - async', function (done) {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      var keys = context.keys(function (err, keys) {\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"foo\", \"bar\");\n        keys = context.keys(function (err, keys) {\n          keys.should.have.length(1);\n          keys[0].should.equal(\"foo\");\n          context.set(\"abc.def\", \"bar\");\n          keys = context.keys(function (err, keys) {\n            keys.should.have.length(2);\n            keys[1].should.equal(\"abc\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate only context keys when GlobalContext was given - sync","suites":["context","local memory"],"updatePoint":{"line":206,"column":78,"index":7958},"line":206,"code":"    it('should enumerate only context keys when GlobalContext was given - sync', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        context.global.set(\"foo2\", \"bar2\");\n        var keys = context.global.keys();\n        keys.should.have.length(2);\n        keys[0].should.equal(\"foo\");\n        keys[1].should.equal(\"foo2\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate only context keys when GlobalContext was given - async","suites":["context","local memory"],"updatePoint":{"line":222,"column":79,"index":8513},"line":222,"code":"    it('should enumerate only context keys when GlobalContext was given - async', function (done) {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        context.global.set(\"foo2\", \"bar2\");\n        context.global.keys(function (err, keys) {\n          keys.should.have.length(2);\n          keys[0].should.equal(\"foo\");\n          keys[1].should.equal(\"foo2\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"returns functionGlobalContext value if store value undefined","suites":["context","local memory"],"updatePoint":{"line":240,"column":68,"index":9118},"line":240,"code":"    it('returns functionGlobalContext value if store value undefined', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      return Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        var v = context.global.get('foo');\n        v.should.equal('bar');\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"returns functionGlobalContext sub-value if store value undefined","suites":["context","local memory"],"updatePoint":{"line":253,"column":72,"index":9550},"line":253,"code":"    it('returns functionGlobalContext sub-value if store value undefined', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: {\n            bar: 123\n          }\n        }\n      });\n      return Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        var v = context.global.get('foo.bar');\n        should.equal(v, 123);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent without key","suites":["context","local memory","$parent"],"updatePoint":{"line":269,"column":54,"index":10034},"line":269,"code":"      it('should get undefined for $parent without key', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.get(\"$parent\");\n        should.equal(parent, undefined);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent of root","suites":["context","local memory","$parent"],"updatePoint":{"line":277,"column":50,"index":10427},"line":277,"code":"      it('should get undefined for $parent of root', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.flow.get(\"$parent.$parent.K\");\n        should.equal(parent, undefined);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent of root - callback","suites":["context","local memory","$parent"],"updatePoint":{"line":285,"column":61,"index":10846},"line":285,"code":"      it('should get undefined for $parent of root - callback', function (done) {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        context1.flow.get(\"$parent.$parent.K\", function (err, result) {\n          try {\n            should.equal(err, undefined);\n            should.equal(result, undefined);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get value in $parent","suites":["context","local memory","$parent"],"updatePoint":{"line":300,"column":37,"index":11411},"line":300,"code":"      it('should get value in $parent', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        flowContextA.set(\"K\", \"v\");\n        var v = context1.flow.get(\"$parent.K\");\n        should.equal(v, \"v\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should set value in $parent","suites":["context","local memory","$parent"],"updatePoint":{"line":309,"column":37,"index":11818},"line":309,"code":"      it('should set value in $parent', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        context1.flow.set(\"$parent.K\", \"v\");\n        var v = flowContextA.get(\"K\");\n        should.equal(v, \"v\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not contain $parent in keys","suites":["context","local memory","$parent"],"updatePoint":{"line":318,"column":44,"index":12232},"line":318,"code":"      it('should not contain $parent in keys', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.get(\"$parent\");\n        flowContextA.set(\"K0\", \"v0\");\n        context1.set(\"K1\", \"v1\");\n        var keys = context1.keys();\n        keys.should.have.length(1);\n        keys[0].should.equal(\"K1\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"clears all context","suites":["context","local memory","clear"],"updatePoint":{"line":332,"column":28,"index":12786},"line":332,"code":"      it('clears all context', function () {\n        Context.init({\n          functionGlobalContext: {\n            foo: \"bar\"\n          }\n        });\n        return Context.load().then(function () {\n          var globalContextA = Context.get(\"global\");\n          globalContextA.get('foo').should.eql('bar');\n          globalContextA.set(\"another\", \"value\");\n          var flowContextA = Context.getFlowContext(\"flowA\");\n          flowContextA.set(\"foo\", \"abc\");\n          flowContextA.get(\"foo\").should.equal(\"abc\");\n          return Context.clear().then(function () {\n            var globalContextB = Context.getFlowContext(\"global\");\n            globalContextB.get('foo').should.eql('bar');\n            should.not.exist(globalContextB.get(\"another\"));\n            flowContextA = Context.getFlowContext(\"flowA\");\n            should.not.exist(flowContextA.get(\"foo\"));\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call open()","suites":["context","external context storage","load modules"],"updatePoint":{"line":439,"column":28,"index":16158},"line":439,"code":"      it('should call open()', function () {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          stubOpen.called.should.be.true();\n          stubOpen2.called.should.be.true();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should load memory module","suites":["context","external context storage","load modules"],"updatePoint":{"line":448,"column":35,"index":16446},"line":448,"code":"      it('should load memory module', function () {\n        Context.init({\n          contextStorage: {\n            memory: {\n              module: \"memory\"\n            }\n          }\n        });\n        return Context.load();\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should load localfilesystem module","suites":["context","external context storage","load modules"],"updatePoint":{"line":458,"column":44,"index":16690},"line":458,"code":"      it('should load localfilesystem module', function () {\n        Context.init({\n          contextStorage: {\n            file: {\n              module: \"localfilesystem\",\n              config: {\n                dir: resourcesDir\n              }\n            }\n          }\n        });\n        return Context.load();\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should ignore reserved storage name `_`","suites":["context","external context storage","load modules"],"updatePoint":{"line":471,"column":49,"index":17021},"line":471,"code":"      it('should ignore reserved storage name `_`', function (done) {\n        Context.init({\n          contextStorage: {\n            _: {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {};\n\n          context.set(\"foo\", \"bar\", \"_\", cb);\n          context.get(\"foo\", \"_\", cb);\n          context.keys(\"_\", cb);\n          stubSet.called.should.be.false();\n          stubGet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid store name","suites":["context","external context storage","load modules"],"updatePoint":{"line":494,"column":51,"index":17724},"line":494,"code":"      it('should fail when using invalid store name', function (done) {\n        Context.init({\n          contextStorage: {\n            'Invalid name': {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid sign character","suites":["context","external context storage","load modules"],"updatePoint":{"line":508,"column":55,"index":18108},"line":508,"code":"      it('should fail when using invalid sign character', function (done) {\n        Context.init({\n          contextStorage: {\n            'abc-123': {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid default context","suites":["context","external context storage","load modules"],"updatePoint":{"line":522,"column":56,"index":18488},"line":522,"code":"      it('should fail when using invalid default context', function (done) {\n        Context.init({\n          contextStorage: {\n            default: \"noexist\"\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail for the storage with no module","suites":["context","external context storage","load modules"],"updatePoint":{"line":534,"column":52,"index":18823},"line":534,"code":"      it('should fail for the storage with no module', function (done) {\n        Context.init({\n          contextStorage: {\n            test: {}\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail to load non-existent module","suites":["context","external context storage","load modules"],"updatePoint":{"line":546,"column":49,"index":19145},"line":546,"code":"      it('should fail to load non-existent module', function (done) {\n        Context.init({\n          contextStorage: {\n            file: {\n              module: \"nonexistent\"\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail to load invalid module","suites":["context","external context storage","load modules"],"updatePoint":{"line":560,"column":44,"index":19511},"line":560,"code":"      it('should fail to load invalid module', function (done) {\n        Context.init({\n          contextStorage: {\n            test: {\n              module: function (config) {\n                throw new Error(\"invalid plugin was loaded.\");\n              }\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call close()","suites":["context","external context storage","close modules"],"updatePoint":{"line":578,"column":29,"index":19999},"line":578,"code":"      it('should call close()', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          return Context.close().then(function () {\n            stubClose.called.should.be.true();\n            stubClose2.called.should.be.true();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store local property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":592,"column":65,"index":20477},"line":592,"code":"      it('should store local property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n\n        var cb = function () {\n          done(\"An error occurred\");\n        };\n\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"test\", cb);\n          context.get(\"foo\", \"test\", cb);\n          context.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store flow property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":613,"column":64,"index":21265},"line":613,"code":"      it('should store flow property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.flow.set(\"foo\", \"bar\", \"test\", cb);\n          context.flow.get(\"foo\", \"test\", cb);\n          context.flow.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store global property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":634,"column":66,"index":22070},"line":634,"code":"      it('should store global property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.global.set(\"foo\", \"bar\", \"test\", cb);\n          context.global.get(\"foo\", \"test\", cb);\n          context.global.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"global\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"global\", \"foo\").should.be.true();\n          stubKeys.calledWith(\"global\").should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store data to the default context when non-existent context storage was specified","suites":["context","external context storage","store context"],"updatePoint":{"line":655,"column":98,"index":22908},"line":655,"code":"      it('should store data to the default context when non-existent context storage was specified', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.set(\"foo\", \"bar\", \"nonexist\", cb);\n          context.get(\"foo\", \"nonexist\", cb);\n          context.keys(\"nonexist\", cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use the default context","suites":["context","external context storage","store context"],"updatePoint":{"line":679,"column":40,"index":23833},"line":679,"code":"      it('should use the default context', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.set(\"foo\", \"bar\", \"default\", cb);\n          context.get(\"foo\", \"default\", cb);\n          context.keys(\"default\", cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use the alias of default context","suites":["context","external context storage","store context"],"updatePoint":{"line":703,"column":49,"index":24764},"line":703,"code":"      it('should use the alias of default context', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.set(\"foo\", \"alias\", cb);\n          context.get(\"foo\", cb);\n          context.keys(cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"alias\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should allow the store name to be provide in the key","suites":["context","external context storage","store context"],"updatePoint":{"line":727,"column":62,"index":25679},"line":727,"code":"      it('should allow the store name to be provide in the key', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.set(\"#:(test)::foo\", \"bar\");\n          context.get(\"#:(test)::foo\");\n          stubGet2.called.should.be.false();\n          stubSet2.called.should.be.false();\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"bar\", undefined).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use default as the alias of other context","suites":["context","external context storage","store context"],"updatePoint":{"line":748,"column":58,"index":26462},"line":748,"code":"      it('should use default as the alias of other context', function (done) {\n        Context.init({\n          contextStorage: contextAlias\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.set(\"foo\", \"alias\", cb);\n          context.get(\"foo\", cb);\n          context.keys(cb);\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"alias\", cb).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error using undefined storage for local context","suites":["context","external context storage","store context"],"updatePoint":{"line":769,"column":77,"index":27247},"line":769,"code":"      it('should not throw an error using undefined storage for local context', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.get(\"local\", \"nonexist\", cb);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error using undefined storage for flow context","suites":["context","external context storage","store context"],"updatePoint":{"line":785,"column":72,"index":27755},"line":785,"code":"      it('should throw an error using undefined storage for flow context', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n\n          context.flow.get(\"flow\", \"nonexist\", cb);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return functionGlobalContext value as a default - synchronous","suites":["context","external context storage","store context"],"updatePoint":{"line":801,"column":78,"index":28273},"line":801,"code":"      it('should return functionGlobalContext value as a default - synchronous', function (done) {\n        var fGC = {\n          \"foo\": 456\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\"); // Get foo - should be value from fGC\n\n          var v = context.global.get(\"foo\");\n          v.should.equal(456); // Update foo - should not touch fGC object\n\n          context.global.set(\"foo\", \"new value\");\n          fGC.foo.should.equal(456); // Get foo - should be the updated value\n\n          v = context.global.get(\"foo\");\n          v.should.equal(\"new value\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return functionGlobalContext value as a default - async","suites":["context","external context storage","store context"],"updatePoint":{"line":824,"column":72,"index":29104},"line":824,"code":"      it('should return functionGlobalContext value as a default - async', function (done) {\n        var fGC = {\n          \"foo\": 456\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\"); // Get foo - should be value from fGC\n\n          context.global.get(\"foo\", function (err, v) {\n            if (err) {\n              done(err);\n            } else {\n              v.should.equal(456); // Update foo - should not touch fGC object\n\n              context.global.set(\"foo\", \"new value\", function (err) {\n                if (err) {\n                  done(err);\n                } else {\n                  fGC.foo.should.equal(456); // Get foo - should be the updated value\n\n                  context.global.get(\"foo\", function (err, v) {\n                    if (err) {\n                      done(err);\n                    } else {\n                      v.should.equal(\"new value\");\n                      done();\n                    }\n                  });\n                }\n              });\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return multiple values if key is an array","suites":["context","external context storage","store context"],"updatePoint":{"line":862,"column":58,"index":30362},"line":862,"code":"      it('should return multiple values if key is an array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo1\", \"bar1\", \"memory\");\n          context.set(\"foo2\", \"bar2\", \"memory\");\n          context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err) {\n              done(err);\n            } else {\n              foo1.should.be.equal(\"bar1\");\n              foo2.should.be.equal(\"bar2\");\n              should.not.exist(foo3);\n              done();\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return multiple functionGlobalContext values if key is an array","suites":["context","external context storage","store context"],"updatePoint":{"line":885,"column":80,"index":31203},"line":885,"code":"      it('should return multiple functionGlobalContext values if key is an array', function (done) {\n        var fGC = {\n          \"foo1\": 456,\n          \"foo2\": {\n            \"bar\": 789\n          }\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.global.get([\"foo1\", \"foo2.bar\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err) {\n              done(err);\n            } else {\n              should.equal(foo1, 456);\n              should.equal(foo2, 789);\n              should.not.exist(foo3);\n              done();\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an error if an error occurs in getting multiple store values","suites":["context","external context storage","store context"],"updatePoint":{"line":913,"column":84,"index":32098},"line":913,"code":"      it('should return an error if an error occurs in getting multiple store values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubGet.onFirstCall().callsArgWith(2, \"error2\", \"bar1\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.global.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err === \"error2\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return a first error if some errors occur in getting multiple store values","suites":["context","external context storage","store context"],"updatePoint":{"line":932,"column":91,"index":32828},"line":932,"code":"      it('should return a first error if some errors occur in getting multiple store values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubGet.onFirstCall().callsArgWith(2, \"error1\");\n        stubGet.onSecondCall().callsArgWith(2, null, \"bar2\");\n        stubGet.onThirdCall().callsArgWith(2, \"error3\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err === \"error1\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store multiple properties if key and value are arrays","suites":["context","external context storage","store context"],"updatePoint":{"line":953,"column":70,"index":33641},"line":953,"code":"      it('should store multiple properties if key and value are arrays', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                if (err) {\n                  done(err);\n                } else {\n                  foo1.should.be.equal(\"bar1\");\n                  foo2.should.be.equal(\"bar2\");\n                  foo3.should.be.equal(\"bar3\");\n                  done();\n                }\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should deletes multiple properties","suites":["context","external context storage","store context"],"updatePoint":{"line":978,"column":44,"index":34537},"line":978,"code":"      it('should deletes multiple properties', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                if (err) {\n                  done(err);\n                } else {\n                  foo1.should.be.equal(\"bar1\");\n                  foo2.should.be.equal(\"bar2\");\n                  foo3.should.be.equal(\"bar3\");\n                  context.set([\"foo1\", \"foo2\", \"foo3\"], new Array(3), \"memory\", function (err) {\n                    if (err) {\n                      done(err);\n                    } else {\n                      context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                        if (err) {\n                          done(err);\n                        } else {\n                          should.not.exist(foo1);\n                          should.not.exist(foo2);\n                          should.not.exist(foo3);\n                          done();\n                        }\n                      });\n                    }\n                  });\n                }\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use null for missing values if the value array is shorter than the key array","suites":["context","external context storage","store context"],"updatePoint":{"line":1018,"column":93,"index":36136},"line":1018,"code":"      it('should use null for missing values if the value array is shorter than the key array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    foo2.should.be.equal(\"bar2\");\n                    should(foo3).be.null();\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use null for missing values if the value is not array","suites":["context","external context storage","store context"],"updatePoint":{"line":1047,"column":70,"index":37235},"line":1047,"code":"      it('should use null for missing values if the value is not array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], \"bar1\", \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    should(foo2).be.null();\n                    should(foo3).be.null();\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should ignore the extra values if the value array is longer than the key array","suites":["context","external context storage","store context"],"updatePoint":{"line":1076,"column":88,"index":38336},"line":1076,"code":"      it('should ignore the extra values if the value array is longer than the key array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\", \"ignored\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    foo2.should.be.equal(\"bar2\");\n                    foo3.should.be.equal(\"bar3\");\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an error if an error occurs in storing multiple values","suites":["context","external context storage","store context"],"updatePoint":{"line":1105,"column":78,"index":39468},"line":1105,"code":"      it('should return an error if an error occurs in storing multiple values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubSet.onFirstCall().callsArgWith(3, \"error2\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err === \"error2\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.get is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1124,"column":76,"index":40176},"line":1124,"code":"      it('should throw an error if callback of context.get is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"foo\", \"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.get is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1137,"column":79,"index":40668},"line":1137,"code":"      it('should not throw an error if callback of context.get is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"foo\", \"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.set is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1148,"column":76,"index":41084},"line":1148,"code":"      it('should throw an error if callback of context.set is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.set is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1161,"column":79,"index":41583},"line":1161,"code":"      it('should not throw an error if callback of context.set is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.keys is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1172,"column":77,"index":42007},"line":1172,"code":"      it('should throw an error if callback of context.keys is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.keys(\"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.keys is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1185,"column":80,"index":42494},"line":1185,"code":"      it('should not throw an error if callback of context.keys is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.keys(\"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1196,"column":69,"index":42897},"line":1196,"code":"      it('should throw an error in context.get if key is empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1208,"column":66,"index":43291},"line":1208,"code":"      it('should throw an error in context.get if key is an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get({});\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1220,"column":65,"index":43684},"line":1220,"code":"      it('should throw an error in context.get if key is a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains an empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1232,"column":84,"index":44095},"line":1232,"code":"      it('should throw an error in context.get if key array contains an empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", \"\", \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1244,"column":78,"index":44517},"line":1244,"code":"      it('should throw an error in context.get if key array contains an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", {}, \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1256,"column":77,"index":44938},"line":1256,"code":"      it('should throw an error in context.get if key array contains a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", 1, \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1268,"column":69,"index":45350},"line":1268,"code":"      it('should throw an error in context.set if key is empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"\", 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1280,"column":66,"index":45747},"line":1280,"code":"      it('should throw an error in context.set if key is an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set({}, 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1292,"column":65,"index":46143},"line":1292,"code":"      it('should throw an error in context.set if key is a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(1, 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains an empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1304,"column":84,"index":46557},"line":1304,"code":"      it('should throw an error in context.set if key array contains an empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", \"\", \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1316,"column":78,"index":46982},"line":1316,"code":"      it('should throw an error in context.set if key array contains an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", {}, \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1328,"column":77,"index":47406},"line":1328,"code":"      it('should throw an error in context.set if key array contains a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", 1, \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should have an err set in callback for invalid key in context.get","suites":["context","external context storage","store context"],"updatePoint":{"line":1340,"column":75,"index":47827},"line":1340,"code":"      it('should have an err set in callback for invalid key in context.get', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"\", function (err) {\n            if (err) {\n              done();\n            } else {\n              done(\"should throw an error.\");\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should have an err set in callback for invalid key in context.set","suites":["context","external context storage","store context"],"updatePoint":{"line":1355,"column":75,"index":48307},"line":1355,"code":"      it('should have an err set in callback for invalid key in context.set', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"\", \"value\", function (err) {\n            if (err) {\n              done();\n            } else {\n              done(\"should throw an error.\");\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should list context storages","suites":["context","external context storage","listStores"],"updatePoint":{"line":1372,"column":38,"index":48808},"line":1372,"code":"      it('should list context storages', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var list = Context.listStores();\n          list.default.should.equal(\"default\");\n          list.stores.should.eql([\"default\", \"test\"]);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should list context storages without default storage","suites":["context","external context storage","listStores"],"updatePoint":{"line":1383,"column":62,"index":49214},"line":1383,"code":"      it('should list context storages without default storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var list = Context.listStores();\n          list.default.should.equal(\"test\");\n          list.stores.should.eql([\"test\"]);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not call delete() when external context storage is used","suites":["context","external context storage","delete context"],"updatePoint":{"line":1396,"column":72,"index":49662},"line":1396,"code":"      it('should not call delete() when external context storage is used', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          Context.get(\"flowA\");\n          return Context.delete(\"flowA\").then(function () {\n            stubDelete.called.should.be.false();\n            stubDelete2.called.should.be.false();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call clean()","suites":["context","external context storage","clean context"],"updatePoint":{"line":1411,"column":29,"index":50148},"line":1411,"code":"      it('should call clean()', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          return Context.clean({\n            allNodes: {}\n          }).then(function () {\n            stubClean.calledWithExactly([]).should.be.true();\n            stubClean2.calledWithExactly([]).should.be.true();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":48,"column":29,"index":1542},"line":48,"code":"    it('should store property', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        if (err) {\n          return done(err);\n        }\n\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n          if (err) {\n            return done(err);\n          }\n\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            if (err) {\n              return done(err);\n            }\n\n            value.should.be.equal(\"test\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property - creates parent properties","suites":["localfilesystem","#get/set"],"updatePoint":{"line":71,"column":57,"index":2133},"line":71,"code":"    it('should store property - creates parent properties', function (done) {\n      context.set(\"nodeX\", \"foo.bar\", \"test\", function (err) {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          value.should.be.eql({\n            bar: \"test\"\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store local scope property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":81,"column":41,"index":2436},"line":81,"code":"    it('should store local scope property', function (done) {\n      context.set(\"abc:def\", \"foo.bar\", \"test\", function (err) {\n        context.get(\"abc:def\", \"foo\", function (err, value) {\n          value.should.be.eql({\n            bar: \"test\"\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":91,"column":30,"index":2732},"line":91,"code":"    it('should delete property', function (done) {\n      context.set(\"nodeX\", \"foo.abc.bar1\", \"test1\", function (err) {\n        context.set(\"nodeX\", \"foo.abc.bar2\", \"test2\", function (err) {\n          context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n            value.should.be.eql({\n              bar1: \"test1\",\n              bar2: \"test2\"\n            });\n            context.set(\"nodeX\", \"foo.abc.bar1\", undefined, function (err) {\n              context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n                value.should.be.eql({\n                  bar2: \"test2\"\n                });\n                context.set(\"nodeX\", \"foo.abc\", undefined, function (err) {\n                  context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n                    should.not.exist(value);\n                    context.set(\"nodeX\", \"foo\", undefined, function (err) {\n                      context.get(\"nodeX\", \"foo\", function (err, value) {\n                        should.not.exist(value);\n                        done();\n                      });\n                    });\n                  });\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not shared context with other scope","suites":["localfilesystem","#get/set"],"updatePoint":{"line":121,"column":50,"index":3949},"line":121,"code":"    it('should not shared context with other scope', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.get(\"nodeY\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"testX\", function (err) {\n            context.set(\"nodeY\", \"foo\", \"testY\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.equal(\"testX\");\n                context.get(\"nodeY\", \"foo\", function (err, value) {\n                  value.should.be.equal(\"testY\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store string","suites":["localfilesystem","#get/set"],"updatePoint":{"line":140,"column":27,"index":4669},"line":140,"code":"    it('should store string', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.String();\n            value.should.be.equal(\"bar\");\n            context.set(\"nodeX\", \"foo\", \"1\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.String();\n                value.should.be.equal(\"1\");\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store number","suites":["localfilesystem","#get/set"],"updatePoint":{"line":158,"column":27,"index":5326},"line":158,"code":"    it('should store number', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", 1, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Number();\n            value.should.be.equal(1);\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store null","suites":["localfilesystem","#get/set"],"updatePoint":{"line":170,"column":25,"index":5721},"line":170,"code":"    it('should store null', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", null, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            should(value).be.null();\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store boolean","suites":["localfilesystem","#get/set"],"updatePoint":{"line":181,"column":28,"index":6083},"line":181,"code":"    it('should store boolean', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", true, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Boolean().and.true();\n            context.set(\"nodeX\", \"foo\", false, function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.Boolean().and.false();\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store object","suites":["localfilesystem","#get/set"],"updatePoint":{"line":197,"column":27,"index":6680},"line":197,"code":"    it('should store object', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", {\n          obj: \"bar\"\n        }, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Object();\n            value.should.eql({\n              obj: \"bar\"\n            });\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array","suites":["localfilesystem","#get/set"],"updatePoint":{"line":213,"column":26,"index":7141},"line":213,"code":"    it('should store array', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [\"a\", \"b\", \"c\"], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.eql([\"a\", \"b\", \"c\"]);\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.String();\n              value.should.equal(\"b\");\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array of arrays","suites":["localfilesystem","#get/set"],"updatePoint":{"line":229,"column":36,"index":7733},"line":229,"code":"    it('should store array of arrays', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [[\"a\", \"b\", \"c\"], [1, 2, 3, 4], [true, false]], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.have.length(3);\n            value[0].should.have.length(3);\n            value[1].should.have.length(4);\n            value[2].should.have.length(2);\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.Array();\n              value.should.have.length(4);\n              value.should.be.eql([1, 2, 3, 4]);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array of objects","suites":["localfilesystem","#get/set"],"updatePoint":{"line":249,"column":37,"index":8535},"line":249,"code":"    it('should store array of objects', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [{\n          obj: \"bar1\"\n        }, {\n          obj: \"bar2\"\n        }, {\n          obj: \"bar3\"\n        }], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.have.length(3);\n            value[0].should.be.Object();\n            value[1].should.be.Object();\n            value[2].should.be.Object();\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.Object();\n              value.should.be.eql({\n                obj: \"bar2\"\n              });\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values","suites":["localfilesystem","#get/set"],"updatePoint":{"line":276,"column":38,"index":9379},"line":276,"code":"    it('should set/get multiple values', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\"]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values - get unknown","suites":["localfilesystem","#get/set"],"updatePoint":{"line":284,"column":52,"index":9749},"line":284,"code":"    it('should set/get multiple values - get unknown', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\", \"unknown\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\", undefined]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values - single value providd","suites":["localfilesystem","#get/set"],"updatePoint":{"line":292,"column":61,"index":10150},"line":292,"code":"    it('should set/get multiple values - single value providd', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], \"test1\", function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", null]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys - get","suites":["localfilesystem","#get/set"],"updatePoint":{"line":300,"column":69,"index":10514},"line":300,"code":"    it('should throw error if bad key included in multiple keys - get', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \".foo\", \"three\"], function (err) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys - set","suites":["localfilesystem","#get/set"],"updatePoint":{"line":308,"column":69,"index":10851},"line":308,"code":"    it('should throw error if bad key included in multiple keys - set', function (done) {\n      context.set(\"nodeX\", [\"one\", \".foo\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        should.exist(err); // Check 'one' didn't get set as a result\n\n        context.get(\"nodeX\", \"one\", function (err, one) {\n          should.not.exist(one);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when getting a value with invalid key","suites":["localfilesystem","#get/set"],"updatePoint":{"line":318,"column":67,"index":11247},"line":318,"code":"    it('should throw an error when getting a value with invalid key', function (done) {\n      context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n        context.get(\"nodeX\", \" \", function (err, value) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when setting a value with invalid key","suites":["localfilesystem","#get/set"],"updatePoint":{"line":326,"column":67,"index":11528},"line":326,"code":"    it('should throw an error when setting a value with invalid key', function (done) {\n      context.set(\"nodeX\", \" \", \"bar\", function (err) {\n        should.exist(err);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of get() is not a function","suites":["localfilesystem","#get/set"],"updatePoint":{"line":332,"column":70,"index":11736},"line":332,"code":"    it('should throw an error when callback of get() is not a function', function (done) {\n      try {\n        context.get(\"nodeX\", \"foo\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of get() is not specified","suites":["localfilesystem","#get/set"],"updatePoint":{"line":340,"column":69,"index":11981},"line":340,"code":"    it('should throw an error when callback of get() is not specified', function (done) {\n      try {\n        context.get(\"nodeX\", \"foo\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of set() is not a function","suites":["localfilesystem","#get/set"],"updatePoint":{"line":348,"column":70,"index":12215},"line":348,"code":"    it('should throw an error when callback of set() is not a function', function (done) {\n      try {\n        context.set(\"nodeX\", \"foo\", \"bar\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error when callback of set() is not specified","suites":["localfilesystem","#get/set"],"updatePoint":{"line":356,"column":73,"index":12471},"line":356,"code":"    it('should not throw an error when callback of set() is not specified', function (done) {\n      try {\n        context.set(\"nodeX\", \" \", \"bar\");\n        done();\n      } catch (err) {\n        done(\"should not throw an error.\");\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty context file","suites":["localfilesystem","#get/set"],"updatePoint":{"line":364,"column":40,"index":12684},"line":364,"code":"    it('should handle empty context file', function (done) {\n      fs.outputFile(path.join(resourcesDir, defaultContextBase, \"nodeX\", \"flow.json\"), \"\", function () {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n            context.get(\"nodeX\", \"foo\", function (err, value) {\n              value.should.be.equal(\"test\");\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when reading corrupt context file","suites":["localfilesystem","#get/set"],"updatePoint":{"line":377,"column":63,"index":13222},"line":377,"code":"    it('should throw an error when reading corrupt context file', function (done) {\n      fs.outputFile(path.join(resourcesDir, defaultContextBase, \"nodeX\", \"flow.json\"), \"{abc\", function () {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["localfilesystem","#keys"],"updatePoint":{"line":402,"column":37,"index":13937},"line":402,"code":"    it('should enumerate context keys', function (done) {\n      context.keys(\"nodeX\", function (err, value) {\n        value.should.be.an.Array();\n        value.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n          context.keys(\"nodeX\", function (err, value) {\n            value.should.have.length(1);\n            value[0].should.equal(\"foo\");\n            context.set(\"nodeX\", \"abc.def\", \"bar\", function (err) {\n              context.keys(\"nodeX\", function (err, value) {\n                value.should.have.length(2);\n                value[1].should.equal(\"abc\");\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in each scopes","suites":["localfilesystem","#keys"],"updatePoint":{"line":421,"column":52,"index":14651},"line":421,"code":"    it('should enumerate context keys in each scopes', function (done) {\n      context.keys(\"nodeX\", function (err, value) {\n        value.should.be.an.Array();\n        value.should.be.empty();\n        context.keys(\"nodeY\", function (err, value) {\n          value.should.be.an.Array();\n          value.should.be.empty();\n          context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n            context.set(\"nodeY\", \"hoge\", \"piyo\", function (err) {\n              context.keys(\"nodeX\", function (err, value) {\n                value.should.have.length(1);\n                value[0].should.equal(\"foo\");\n                context.keys(\"nodeY\", function (err, value) {\n                  value.should.have.length(1);\n                  value[0].should.equal(\"hoge\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of keys() is not a function","suites":["localfilesystem","#keys"],"updatePoint":{"line":444,"column":71,"index":15552},"line":444,"code":"    it('should throw an error when callback of keys() is not a function', function (done) {\n      try {\n        context.keys(\"nodeX\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of keys() is not specified","suites":["localfilesystem","#keys"],"updatePoint":{"line":452,"column":70,"index":15792},"line":452,"code":"    it('should throw an error when callback of keys() is not specified', function (done) {\n      try {\n        context.keys(\"nodeX\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete context","suites":["localfilesystem","#delete"],"updatePoint":{"line":477,"column":29,"index":16392},"line":477,"code":"    it('should delete context', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.get(\"nodeY\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"testX\", function (err) {\n            context.set(\"nodeY\", \"foo\", \"testY\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.equal(\"testX\");\n                context.get(\"nodeY\", \"foo\", function (err, value) {\n                  value.should.be.equal(\"testY\");\n                  context.delete(\"nodeX\").then(function () {\n                    context.get(\"nodeX\", \"foo\", function (err, value) {\n                      should.not.exist(value);\n                      context.get(\"nodeY\", \"foo\", function (err, value) {\n                        value.should.be.equal(\"testY\");\n                        done();\n                      });\n                    });\n                  }).catch(done);\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context","suites":["localfilesystem","#clean"],"updatePoint":{"line":548,"column":40,"index":18560},"line":548,"code":"    it('should clean unnecessary context', function (done) {\n      contextSet(\"global\", \"foo\", \"testGlobal\").then(function () {\n        return contextSet(\"nodeX:flow1\", \"foo\", \"testX\");\n      }).then(function () {\n        return contextSet(\"nodeY:flow2\", \"foo\", \"testY\");\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testY\");\n      }).then(function () {\n        return context.clean([]);\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"global\", \"foo\");\n      }).then(function (value) {\n        value.should.eql(\"testGlobal\");\n      }).then(done).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not clean active context","suites":["localfilesystem","#clean"],"updatePoint":{"line":577,"column":39,"index":19665},"line":577,"code":"    it('should not clean active context', function (done) {\n      contextSet(\"global\", \"foo\", \"testGlobal\").then(function () {\n        return contextSet(\"nodeX:flow1\", \"foo\", \"testX\");\n      }).then(function () {\n        return contextSet(\"nodeY:flow2\", \"foo\", \"testY\");\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testY\");\n      }).then(function () {\n        return context.clean([\"flow1\", \"nodeX\"]);\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"global\", \"foo\");\n      }).then(function (value) {\n        value.should.eql(\"testGlobal\");\n      }).then(done).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should load contexts into the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":623,"column":43,"index":21223},"line":623,"code":"    it('should load contexts into the cache', function () {\n      var globalData = {\n        key: \"global\"\n      };\n      var flowData = {\n        key: \"flow\"\n      };\n      var nodeData = {\n        key: \"node\"\n      };\n      return Promise.all([fs.outputFile(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"), JSON.stringify(globalData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flow\", \"flow.json\"), JSON.stringify(flowData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flow\", \"node.json\"), JSON.stringify(nodeData, null, 4), \"utf8\")]).then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true\n        });\n        return context.open();\n      }).then(function () {\n        return Promise.all([fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")), fs.remove(path.join(resourcesDir, defaultContextBase, \"flow\", \"flow.json\")), fs.remove(path.join(resourcesDir, defaultContextBase, \"flow\", \"node.json\"))]);\n      }).then(function () {\n        context.get(\"global\", \"key\").should.be.equal(\"global\");\n        context.get(\"flow\", \"key\").should.be.equal(\"flow\");\n        context.get(\"node:flow\", \"key\").should.be.equal(\"node\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property to the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":647,"column":42,"index":22524},"line":647,"code":"    it('should store property to the cache', function () {\n      context = LocalFileSystem({\n        dir: resourcesDir,\n        cache: true,\n        flushInterval: 1\n      });\n      return context.open().then(function () {\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo\", \"bar\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              fs.readJson(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")).then(function (data) {\n                // File should not exist as flush hasn't happened\n                reject(\"File global/global.json should not exist\");\n              }).catch(function (err) {\n                setTimeout(function () {\n                  fs.readJson(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")).then(function (data) {\n                    data.should.eql({\n                      foo: 'bar'\n                    });\n                    resolve();\n                  }).catch(function (err) {\n                    reject(err);\n                  });\n                }, 1100);\n              });\n            }\n          });\n        });\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        context.get(\"global\", \"foo\").should.be.equal(\"bar\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":683,"column":50,"index":23942},"line":683,"code":"    it('should enumerate context keys in the cache', function () {\n      var globalData = {\n        foo: \"bar\"\n      };\n      return fs.outputFile(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"), JSON.stringify(globalData, null, 4), \"utf8\").then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true,\n          flushInterval: 2\n        });\n        return context.open();\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        var keys = context.keys(\"global\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo2\", \"bar2\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve();\n            }\n          });\n        });\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        var keys = context.keys(\"global\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"foo2\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete context in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":717,"column":42,"index":25185},"line":717,"code":"    it('should delete context in the cache', function () {\n      context = LocalFileSystem({\n        dir: resourcesDir,\n        cache: true,\n        flushInterval: 2\n      });\n      return context.open().then(function () {\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo\", \"bar\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve();\n            }\n          });\n        });\n      }).then(function () {\n        context.get(\"global\", \"foo\").should.be.equal(\"bar\");\n        return context.delete(\"global\");\n      }).then(function () {\n        should.not.exist(context.get(\"global\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":740,"column":53,"index":25906},"line":740,"code":"    it('should clean unnecessary context in the cache', function () {\n      var flowAData = {\n        key: \"flowA\"\n      };\n      var flowBData = {\n        key: \"flowB\"\n      };\n      return Promise.all([fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flowA\", \"flow.json\"), JSON.stringify(flowAData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flowB\", \"flow.json\"), JSON.stringify(flowBData, null, 4), \"utf8\")]).then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true,\n          flushInterval: 2\n        });\n        return context.open();\n      }).then(function () {\n        context.get(\"flowA\", \"key\").should.be.equal(\"flowA\");\n        context.get(\"flowB\", \"key\").should.be.equal(\"flowB\");\n        return context.clean([\"flowA\"]);\n      }).then(function () {\n        context.get(\"flowA\", \"key\").should.be.equal(\"flowA\");\n        should.not.exist(context.get(\"flowB\", \"key\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should change a base directory","suites":["localfilesystem","Configuration"],"updatePoint":{"line":780,"column":38,"index":27300},"line":780,"code":"    it('should change a base directory', function (done) {\n      var differentBaseContext = LocalFileSystem({\n        base: \"contexts2\",\n        dir: resourcesDir,\n        cache: false\n      });\n      differentBaseContext.open().then(function () {\n        differentBaseContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n          differentBaseContext.get(\"node2\", \"foo2\", function (err, value) {\n            value.should.be.equal(\"bar2\");\n            context.get(\"node2\", \"foo2\", function (err, value) {\n              should.not.exist(value);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use userDir","suites":["localfilesystem","Configuration"],"updatePoint":{"line":798,"column":26,"index":27916},"line":798,"code":"    it('should use userDir', function (done) {\n      var userDirContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false,\n        settings: {\n          userDir: resourcesDir\n        }\n      });\n      userDirContext.open().then(function () {\n        userDirContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n          userDirContext.get(\"node2\", \"foo2\", function (err, value) {\n            value.should.be.equal(\"bar2\");\n            context.get(\"node2\", \"foo2\", function (err, value) {\n              should.not.exist(value);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use NODE_RED_HOME","suites":["localfilesystem","Configuration"],"updatePoint":{"line":818,"column":32,"index":28550},"line":818,"code":"    it('should use NODE_RED_HOME', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      process.env.NODE_RED_HOME = resourcesDir;\n      fs.ensureDirSync(resourcesDir);\n      fs.writeFileSync(path.join(resourcesDir, \".config.json\"), \"\");\n      var nrHomeContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false\n      });\n\n      try {\n        nrHomeContext.open().then(function () {\n          nrHomeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n            nrHomeContext.get(\"node2\", \"foo2\", function (err, value) {\n              value.should.be.equal(\"bar2\");\n              context.get(\"node2\", \"foo2\", function (err, value) {\n                should.not.exist(value);\n                done();\n              });\n            });\n          });\n        });\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use HOME_PATH","suites":["localfilesystem","Configuration"],"updatePoint":{"line":844,"column":28,"index":29419},"line":844,"code":"    it('should use HOME_PATH', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      var oldHOMEPATH = process.env.HOMEPATH;\n      process.env.NODE_RED_HOME = resourcesDir;\n      process.env.HOMEPATH = resourcesDir;\n      var homePath = path.join(resourcesDir, \".node-red\");\n      fs.outputFile(path.join(homePath, \".config.json\"), \"\", function () {\n        var homeContext = LocalFileSystem({\n          base: \"contexts2\",\n          cache: false\n        });\n\n        try {\n          homeContext.open().then(function () {\n            homeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n              homeContext.get(\"node2\", \"foo2\", function (err, value) {\n                value.should.be.equal(\"bar2\");\n                context.get(\"node2\", \"foo2\", function (err, value) {\n                  should.not.exist(value);\n                  done();\n                });\n              });\n            });\n          });\n        } finally {\n          process.env.NODE_RED_HOME = oldNRH;\n          process.env.HOMEPATH = oldHOMEPATH;\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use HOME_PATH","suites":["localfilesystem","Configuration"],"updatePoint":{"line":874,"column":28,"index":30490},"line":874,"code":"    it('should use HOME_PATH', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      var oldHOMEPATH = process.env.HOMEPATH;\n      var oldHOME = process.env.HOME;\n      process.env.NODE_RED_HOME = resourcesDir;\n      process.env.HOMEPATH = resourcesDir;\n      process.env.HOME = resourcesDir;\n      var homeContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false\n      });\n\n      try {\n        homeContext.open().then(function () {\n          homeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n            homeContext.get(\"node2\", \"foo2\", function (err, value) {\n              value.should.be.equal(\"bar2\");\n              context.get(\"node2\", \"foo2\", function (err, value) {\n                should.not.exist(value);\n                done();\n              });\n            });\n          });\n        });\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOMEPATH = oldHOMEPATH;\n        process.env.HOME = oldHOME;\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["memory","#get/set","sync"],"updatePoint":{"line":35,"column":31,"index":1154},"line":35,"code":"      it('should store property', function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        context.set(\"nodeX\", \"foo\", \"test\");\n        context.get(\"nodeX\", \"foo\").should.equal(\"test\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should store property - creates parent properties","suites":["memory","#get/set","sync"],"updatePoint":{"line":40,"column":59,"index":1398},"line":40,"code":"      it('should store property - creates parent properties', function () {\n        context.set(\"nodeX\", \"foo.bar\", \"test\");\n        context.get(\"nodeX\", \"foo\").should.eql({\n          bar: \"test\"\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should delete property","suites":["memory","#get/set","sync"],"updatePoint":{"line":46,"column":32,"index":1589},"line":46,"code":"      it('should delete property', function () {\n        context.set(\"nodeX\", \"foo.abc.bar1\", \"test1\");\n        context.set(\"nodeX\", \"foo.abc.bar2\", \"test2\");\n        context.get(\"nodeX\", \"foo.abc\").should.eql({\n          bar1: \"test1\",\n          bar2: \"test2\"\n        });\n        context.set(\"nodeX\", \"foo.abc.bar1\", undefined);\n        context.get(\"nodeX\", \"foo.abc\").should.eql({\n          bar2: \"test2\"\n        });\n        context.set(\"nodeX\", \"foo.abc\", undefined);\n        should.not.exist(context.get(\"nodeX\", \"foo.abc\"));\n        context.set(\"nodeX\", \"foo\", undefined);\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not shared context with other scope","suites":["memory","#get/set","sync"],"updatePoint":{"line":62,"column":52,"index":2252},"line":62,"code":"      it('should not shared context with other scope', function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n        context.set(\"nodeX\", \"foo\", \"testX\");\n        context.set(\"nodeY\", \"foo\", \"testY\");\n        context.get(\"nodeX\", \"foo\").should.equal(\"testX\");\n        context.get(\"nodeY\", \"foo\").should.equal(\"testY\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw the error if the error occurs","suites":["memory","#get/set","sync"],"updatePoint":{"line":70,"column":52,"index":2651},"line":70,"code":"      it('should throw the error if the error occurs', function () {\n        try {\n          context.set(\"nodeX\", \".foo\", \"test\");\n          should.fail(\"Error was not thrown\");\n        } catch (err) {\n          should.exist(err);\n\n          try {\n            context.get(\"nodeX\", \".foo\");\n            should.fail(\"Error was not thrown\");\n          } catch (err) {\n            should.exist(err);\n          }\n        }\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - all known","suites":["memory","#get/set","sync"],"updatePoint":{"line":85,"column":48,"index":3075},"line":85,"code":"      it('should get multiple values - all known', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        var values = context.get(\"nodeX\", [\"one\", \"two\", \"four\"]);\n        values.should.eql([\"test1\", \"test2\", \"test4\"]);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - include unknown","suites":["memory","#get/set","sync"],"updatePoint":{"line":93,"column":54,"index":3466},"line":93,"code":"      it('should get multiple values - include unknown', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        var values = context.get(\"nodeX\", [\"one\", \"unknown.with.multiple.levels\"]);\n        values.should.eql([\"test1\", undefined]);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys","suites":["memory","#get/set","sync"],"updatePoint":{"line":101,"column":65,"index":3878},"line":101,"code":"      it('should throw error if bad key included in multiple keys', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n\n        try {\n          var values = context.get(\"nodeX\", [\"one\", \".foo\", \"three\"]);\n          should.fail(\"Error was not thrown\");\n        } catch (err) {\n          should.exist(err);\n        }\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["memory","#get/set","async"],"updatePoint":{"line":116,"column":31,"index":4363},"line":116,"code":"      it('should store property', function (done) {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n            context.get(\"nodeX\", \"foo\", function (err, value) {\n              value.should.equal(\"test\");\n              done();\n            });\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should pass the error to callback if the error occurs","suites":["memory","#get/set","async"],"updatePoint":{"line":127,"column":63,"index":4785},"line":127,"code":"      it('should pass the error to callback if the error occurs', function (done) {\n        context.set(\"nodeX\", \".foo\", \"test\", function (err, value) {\n          should.exist(err);\n          context.get(\"nodeX\", \".foo\", function (err) {\n            should.exist(err);\n            done();\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - all known","suites":["memory","#get/set","async"],"updatePoint":{"line":136,"column":48,"index":5095},"line":136,"code":"      it('should get multiple values - all known', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \"two\", \"four\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\", \"test4\"]);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - include unknown","suites":["memory","#get/set","async"],"updatePoint":{"line":146,"column":54,"index":5565},"line":146,"code":"      it('should get multiple values - include unknown', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \"unknown\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", undefined]);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys","suites":["memory","#get/set","async"],"updatePoint":{"line":156,"column":65,"index":6035},"line":156,"code":"      it('should throw error if bad key included in multiple keys', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \".foo\", \"three\"], function (err) {\n          should.exist(err);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":170,"column":39,"index":6506},"line":170,"code":"      it('should enumerate context keys', function () {\n        var keys = context.keys(\"nodeX\");\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\");\n        keys = context.keys(\"nodeX\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        context.set(\"nodeX\", \"abc.def\", \"bar\");\n        keys = context.keys(\"nodeX\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"abc\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in each scopes","suites":["memory","#keys","sync"],"updatePoint":{"line":183,"column":54,"index":7010},"line":183,"code":"      it('should enumerate context keys in each scopes', function () {\n        var keysX = context.keys(\"nodeX\");\n        keysX.should.be.an.Array();\n        keysX.should.be.empty();\n        var keysY = context.keys(\"nodeY\");\n        keysY.should.be.an.Array();\n        keysY.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\");\n        context.set(\"nodeY\", \"hoge\", \"piyo\");\n        keysX = context.keys(\"nodeX\");\n        keysX.should.have.length(1);\n        keysX[0].should.equal(\"foo\");\n        keysY = context.keys(\"nodeY\");\n        keysY.should.have.length(1);\n        keysY[0].should.equal(\"hoge\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate global context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":199,"column":46,"index":7626},"line":199,"code":"      it('should enumerate global context keys', function () {\n        var keys = context.keys(\"global\");\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"global\", \"foo\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        context.set(\"global\", \"abc.def\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"abc\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not return specific keys as global context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":212,"column":64,"index":8145},"line":212,"code":"      it('should not return specific keys as global context keys', function () {\n        var keys = context.keys(\"global\");\n        context.set(\"global\", \"set\", \"bar\");\n        context.set(\"global\", \"get\", \"bar\");\n        context.set(\"global\", \"keys\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(0);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["memory","#keys","async"],"updatePoint":{"line":222,"column":39,"index":8509},"line":222,"code":"      it('should enumerate context keys', function (done) {\n        context.keys(\"nodeX\", function (err, keys) {\n          keys.should.be.an.Array();\n          keys.should.be.empty();\n          context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n            context.keys(\"nodeX\", function (err, keys) {\n              keys.should.have.length(1);\n              keys[0].should.equal(\"foo\");\n              context.set(\"nodeX\", \"abc.def\", \"bar\", function (err) {\n                context.keys(\"nodeX\", function (err, keys) {\n                  keys.should.have.length(2);\n                  keys[1].should.equal(\"abc\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should delete context","suites":["memory","#delete"],"updatePoint":{"line":244,"column":29,"index":9277},"line":244,"code":"    it('should delete context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.delete(\"nodeX\").then(function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context","suites":["memory","#clean"],"updatePoint":{"line":258,"column":40,"index":9855},"line":258,"code":"    it('should clean unnecessary context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.clean([]).then(function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not clean active context","suites":["memory","#clean"],"updatePoint":{"line":270,"column":39,"index":10389},"line":270,"code":"    it('should not clean active context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.clean([\"nodeX\"]).then(function () {\n        should.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not clean global context","suites":["memory","#clean"],"updatePoint":{"line":282,"column":39,"index":10926},"line":282,"code":"    it('should not clean global context', function () {\n      context.set(\"global\", \"foo\", \"abc\");\n      context.get(\"global\", \"foo\").should.equal(\"abc\");\n      return context.clean([\"global\"]).then(function () {\n        should.exist(context.get(\"global\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"loads provided credentials","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":39,"column":32,"index":1231},"line":39,"code":"  it('loads provided credentials', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.get(\"a\").should.have.property('b', 1);\n      credentials.get(\"a\").should.have.property('c', 2);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"adds a new credential","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":54,"column":27,"index":1601},"line":54,"code":"  it('adds a new credential', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.dirty().should.be.false();\n      should.not.exist(credentials.get(\"b\"));\n      return credentials.add(\"b\", {\n        \"foo\": \"bar\"\n      }).then(function () {\n        credentials.get(\"b\").should.have.property(\"foo\", \"bar\");\n        credentials.dirty().should.be.true();\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"deletes an existing credential","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":75,"column":36,"index":2163},"line":75,"code":"  it('deletes an existing credential', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.dirty().should.be.false();\n      credentials.delete(\"a\");\n      should.not.exist(credentials.get(\"a\"));\n      credentials.dirty().should.be.true();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"exports the credentials, clearing dirty flag","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":92,"column":50,"index":2608},"line":92,"code":"  it('exports the credentials, clearing dirty flag', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    var creds = {\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    };\n    return credentials.load(creds).then(function () {\n      return credentials.add(\"b\", {\n        \"foo\": \"bar\"\n      });\n    }).then(function () {\n      credentials.dirty().should.be.true();\n      return credentials.export().then(function (exported) {\n        exported.should.eql(creds);\n        credentials.dirty().should.be.false();\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"removes credentials of unknown nodes","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":116,"column":44,"index":3230},"line":116,"code":"    it(\"removes credentials of unknown nodes\", function () {\n      credentials.init({\n        log: log,\n        settings: encryptionDisabledSettings,\n        nodes: {\n          getType: () => function () {}\n        }\n      });\n      var creds = {\n        \"a\": {\n          \"b\": 1,\n          \"c\": 2\n        },\n        \"b\": {\n          \"d\": 3\n        }\n      };\n      return credentials.load(creds).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"a\"));\n        should.exist(credentials.get(\"b\"));\n        return credentials.clean([{\n          id: \"b\"\n        }]).then(function () {\n          credentials.dirty().should.be.true();\n          should.not.exist(credentials.get(\"a\"));\n          should.exist(credentials.get(\"b\"));\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extracts credentials of known nodes","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":146,"column":43,"index":4038},"line":146,"code":"    it(\"extracts credentials of known nodes\", function () {\n      credentials.init({\n        log: log,\n        settings: encryptionDisabledSettings,\n        nodes: {\n          getType: () => function () {}\n        }\n      });\n      credentials.register(\"testNode\", {\n        \"b\": \"text\",\n        \"c\": \"password\"\n      });\n      var creds = {\n        \"a\": {\n          \"b\": 1,\n          \"c\": 2\n        }\n      };\n      var newConfig = [{\n        id: \"a\",\n        type: \"testNode\",\n        credentials: {\n          \"b\": \"newBValue\",\n          \"c\": \"newCValue\"\n        }\n      }];\n      return credentials.load(creds).then(function () {\n        credentials.dirty().should.be.false();\n        return credentials.clean(newConfig).then(function () {\n          credentials.dirty().should.be.true();\n          credentials.get(\"a\").should.have.property('b', \"newBValue\");\n          credentials.get(\"a\").should.have.property('c', \"newCValue\");\n          should.not.exist(newConfig[0].credentials);\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"warns if a node has no credential definition","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":183,"column":50,"index":5068},"line":183,"code":"  it('warns if a node has no credential definition', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    return credentials.load({}).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\",\n        credentials: {\n          user1: \"newUser\",\n          password1: \"newPassword\"\n        }\n      };\n      sinon.spy(log, \"warn\");\n      credentials.extract(node);\n      log.warn.called.should.be.true();\n      should.not.exist(node.credentials);\n      log.warn.restore();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extract credential updates in the provided node","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":207,"column":53,"index":5692},"line":207,"code":"  it('extract credential updates in the provided node', function (done) {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    var defintion = {\n      user1: {\n        type: \"text\"\n      },\n      password1: {\n        type: \"password\"\n      },\n      user2: {\n        type: \"text\"\n      },\n      password2: {\n        type: \"password\"\n      },\n      user3: {\n        type: \"text\"\n      },\n      password3: {\n        type: \"password\"\n      }\n    };\n    credentials.register(\"test\", defintion);\n    var def = credentials.getDefinition(\"test\");\n    defintion.should.eql(def);\n    credentials.load({\n      \"node\": {\n        user1: \"abc\",\n        password1: \"123\",\n        user2: \"def\",\n        password2: \"456\",\n        user3: \"ghi\",\n        password3: \"789\"\n      }\n    }).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\",\n        credentials: {\n          // user1 unchanged\n          password1: \"__PWRD__\",\n          user2: \"\",\n          password2: \"   \",\n          user3: \"newUser\",\n          password3: \"newPassword\"\n        }\n      };\n      credentials.dirty().should.be.false();\n      credentials.extract(node);\n      node.should.not.have.a.property(\"credentials\");\n      credentials.dirty().should.be.true();\n      var newCreds = credentials.get(\"node\");\n      newCreds.should.have.a.property(\"user1\", \"abc\");\n      newCreds.should.have.a.property(\"password1\", \"123\");\n      newCreds.should.not.have.a.property(\"user2\");\n      newCreds.should.not.have.a.property(\"password2\");\n      newCreds.should.have.a.property(\"user3\", \"newUser\");\n      newCreds.should.have.a.property(\"password3\", \"newPassword\");\n      done();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extract ignores node without credentials","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":274,"column":46,"index":7449},"line":274,"code":"  it('extract ignores node without credentials', function (done) {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    credentials.load({\n      \"node\": {\n        user1: \"abc\",\n        password1: \"123\"\n      }\n    }).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\"\n      };\n      credentials.dirty().should.be.false();\n      credentials.extract(node);\n      credentials.dirty().should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates to encrypted and generates default key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":319,"column":55,"index":8511},"line":319,"code":"    it('migrates to encrypted and generates default key', function (done) {\n      settings = {};\n      credentials.init(runtime);\n      credentials.load({\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      }).then(function () {\n        settings.should.have.a.property(\"_credentialSecret\");\n\n        settings._credentialSecret.should.have.a.length(64);\n\n        credentials.dirty().should.be.true();\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses default key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":345,"column":24,"index":9318},"line":345,"code":"    it('uses default key', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        should.exist(credentials.get(\"node\"));\n        credentials.dirty().should.be.false();\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses user key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":375,"column":21,"index":10506},"line":375,"code":"    it('uses user key', function (done) {\n      settings = {\n        credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"node\"));\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses user key - when settings are otherwise unavailable","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":405,"column":63,"index":11735},"line":405,"code":"    it('uses user key - when settings are otherwise unavailable', function (done) {\n      var runtime = {\n        log: log,\n        settings: {\n          get: function (key) {\n            if (key === 'credentialSecret') {\n              return \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\";\n            }\n\n            throw new Error();\n          },\n          set: function (key, value) {\n            throw new Error();\n          }\n        }\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        should.exist(credentials.get(\"node\"));\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to user key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":446,"column":45,"index":13165},"line":446,"code":"    it('migrates from default key to user key', function () {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: \"aaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbcccccccccccccddddddddddddeeeee\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      return credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        return credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          return credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"abc\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"123\");\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to user key - unencrypted original","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":473,"column":68,"index":14461},"line":473,"code":"    it('migrates from default key to user key - unencrypted original', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: \"aaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbcccccccccccccddddddddddddeeeee\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var unencryptedFlows = {\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      };\n      credentials.init(runtime);\n      credentials.load(unencryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\"); // reset everything - but with _credentialSecret still set\n\n          credentials.init(runtime); // load the freshly encrypted version\n\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"abc\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"123\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to unencrypted","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":504,"column":48,"index":15723},"line":504,"code":"    it('migrates from default key to unencrypted', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: false\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.not.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\");\n          result.should.eql({\n            \"node\": {\n              user1: \"abc\",\n              password1: \"123\"\n            }\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad default key - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":530,"column":52,"index":16675},"line":530,"code":"    it('handles bad default key - resets credentials', function (done) {\n      settings = {\n        _credentialSecret: \"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        // credentials.dirty().should.be.true();\n        // should.not.exist(credentials.get(\"node\"));\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad user key - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":548,"column":49,"index":17393},"line":548,"code":"    it('handles bad user key - resets credentials', function (done) {\n      settings = {\n        credentialSecret: \"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        // credentials.dirty().should.be.true();\n        // should.not.exist(credentials.get(\"node\"));\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad credentials object - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":566,"column":59,"index":18120},"line":566,"code":"    it('handles bad credentials object - resets credentials', function (done) {\n      settings = {\n        credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      var cryptedFlows = {\n        \"BADKEY\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles unavailable settings - leaves creds unencrypted","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":582,"column":63,"index":18753},"line":582,"code":"    it('handles unavailable settings - leaves creds unencrypted', function (done) {\n      var runtime = {\n        log: log,\n        settings: {\n          get: function (key) {\n            throw new Error();\n          },\n          set: function (key, value) {\n            throw new Error();\n          }\n        },\n        nodes: {\n          getType: () => function () {}\n        }\n      }; // {\"node\":{user1:\"abc\",password1:\"123\"}}\n\n      credentials.init(runtime);\n      credentials.load({\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      }).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.not.have.a.property(\"$\");\n          result.should.have.a.property(\"node\");\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"nodes are initialised with credentials","suites":["red/nodes/index"],"updatePoint":{"line":106,"column":44,"index":2607},"line":106,"code":"  it('nodes are initialised with credentials', function (done) {\n    index.init(runtime);\n    index.registerType('test-node-set', 'test', TestNode);\n    index.loadFlows().then(function () {\n      var testnode = new TestNode({\n        id: 'tab1',\n        type: 'test',\n        name: 'barney'\n      });\n      testnode.credentials.should.have.property('b', 1);\n      testnode.credentials.should.have.property('c', \"2\");\n      testnode.credentials.should.have.property('d', \"bar\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"flows should be initialised","suites":["red/nodes/index"],"updatePoint":{"line":123,"column":33,"index":3149},"line":123,"code":"  it('flows should be initialised', function (done) {\n    index.init(runtime);\n    index.loadFlows().then(function () {\n      // console.log(testFlows);\n      // console.log(index.getFlows());\n      should.deepEqual(testFlows, index.getFlows().flows);\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"called without node-set name","suites":["red/nodes/index","registerType","logs deprecated usage"],"updatePoint":{"line":142,"column":38,"index":3734},"line":142,"code":"      it(\"called without node-set name\", function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: sinon.spy()\n          },\n          events: new EventEmitter()\n        };\n        index.init(runtime);\n        index.registerType(\n        /*'test-node-set',*/\n        'test', TestNode, {});\n        runtime.log.warn.called.should.be.true();\n        registry.registerType.called.should.be.true();\n        registry.registerType.firstCall.args[0].should.eql('');\n        registry.registerType.firstCall.args[1].should.eql('test');\n        registry.registerType.firstCall.args[2].should.eql(TestNode);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"extends a constructor with the Node constructor","suites":["red/nodes/index","registerType","extends constructor with Node constructor"],"updatePoint":{"line":185,"column":57,"index":5099},"line":185,"code":"      it('extends a constructor with the Node constructor', function () {\n        TestNodeConstructor.prototype.should.not.be.an.instanceOf(Node);\n        index.registerType('node-set', 'node-type', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"does not override a constructor prototype","suites":["red/nodes/index","registerType","extends constructor with Node constructor"],"updatePoint":{"line":190,"column":51,"index":5393},"line":190,"code":"      it('does not override a constructor prototype', function () {\n        function Foo() {}\n\n        ;\n        inherits(TestNodeConstructor, Foo);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n        TestNodeConstructor.prototype.should.not.be.an.instanceOf(Node);\n        index.registerType('node-set', 'node-type', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n        index.registerType('node-set', 'node-type2', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"definition defined","suites":["red/nodes/index","registerType","register credentials definition"],"updatePoint":{"line":263,"column":28,"index":7963},"line":263,"code":"      it('definition defined', function () {\n        index.registerType('test-node-set', 'test', TestNode, {\n          credentials: {\n            foo: {\n              type: \"test\"\n            }\n          }\n        });\n        var testnode = new TestNode({\n          id: 'tab1',\n          type: 'test',\n          name: 'barney',\n          '_alias': 'tab1'\n        });\n        index.getCredentialDefinition(\"test\").should.have.property('foo');\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"registers valid settings","suites":["red/nodes/index","registerType","register settings definition"],"updatePoint":{"line":287,"column":34,"index":8656},"line":287,"code":"      it('registers valid settings', function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: function () {}\n          },\n          events: new EventEmitter()\n        };\n        runtime.settings.registerNodeSettings = sinon.spy();\n        index.init(runtime);\n        index.registerType('test-node-set', 'test', TestNode, {\n          settings: {\n            testOne: {}\n          }\n        });\n        runtime.settings.registerNodeSettings.called.should.be.true();\n        runtime.settings.registerNodeSettings.firstCall.args[0].should.eql('test');\n        runtime.settings.registerNodeSettings.firstCall.args[1].should.eql({\n          testOne: {}\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"logs invalid settings","suites":["red/nodes/index","registerType","register settings definition"],"updatePoint":{"line":310,"column":31,"index":9432},"line":310,"code":"      it('logs invalid settings', function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: sinon.spy()\n          },\n          events: new EventEmitter()\n        };\n\n        runtime.settings.registerNodeSettings = function () {\n          throw new Error(\"pass\");\n        };\n\n        index.init(runtime);\n        index.registerType('test-node-set', 'test', TestNode, {\n          settings: {\n            testOne: {}\n          }\n        });\n        runtime.log.warn.called.should.be.true();\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"allows an unused node type to be disabled","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":361,"column":49,"index":10833},"line":361,"code":"    it('allows an unused node type to be disabled', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        return index.disableNode(\"5678\").then(function (info) {\n          registry.disableNode.calledOnce.should.be.true();\n          registry.disableNode.calledWith(\"5678\").should.be.true();\n          info.should.eql(randomNodeInfo);\n          done();\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents disabling a node type that is in use","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":375,"column":53,"index":11372},"line":375,"code":"    it('prevents disabling a node type that is in use', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.disabledNode(\"test\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents disabling a node type that is unknown","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":388,"column":54,"index":11784},"line":388,"code":"    it('prevents disabling a node type that is unknown', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.disableNode(\"doesnotexist\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents removing a module that is in use","suites":["red/nodes/index","allows modules to be removed from the registry"],"updatePoint":{"line":446,"column":49,"index":13408},"line":446,"code":"    it('prevents removing a module that is in use', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.removeModule(\"node-red\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents removing a module that is unknown","suites":["red/nodes/index","allows modules to be removed from the registry"],"updatePoint":{"line":459,"column":50,"index":13820},"line":459,"code":"    it('prevents removing a module that is unknown', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.removeModule(\"doesnotexist\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id and a type","suites":["Node","#constructor"],"updatePoint":{"line":32,"column":39,"index":1119},"line":32,"code":"    it('is called with an id and a type', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.not.have.property('name');\n      n.wires.should.be.empty();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id, a type and a name","suites":["Node","#constructor"],"updatePoint":{"line":42,"column":47,"index":1431},"line":42,"code":"    it('is called with an id, a type and a name', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        name: 'barney'\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.have.property('name', 'barney');\n      n.wires.should.be.empty();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id, a type and some wires","suites":["Node","#constructor"],"updatePoint":{"line":53,"column":51,"index":1777},"line":53,"code":"    it('is called with an id, a type and some wires', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        wires: ['123', '456']\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.not.have.property('name');\n      n.wires.should.have.length(2);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits close event when closed","suites":["Node","#close"],"updatePoint":{"line":66,"column":37,"index":2155},"line":66,"code":"    it('emits close event when closed', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('close', function () {\n        done();\n      });\n      n.close();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns a promise when provided a callback with a done parameter","suites":["Node","#close"],"updatePoint":{"line":76,"column":72,"index":2410},"line":76,"code":"    it('returns a promise when provided a callback with a done parameter', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('close', function (done) {\n        setTimeout(function () {\n          done();\n        }, 50);\n      });\n      var p = n.close();\n      should.exist(p);\n      p.then(function () {\n        testdone();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"accepts a callback with \"removed\" and \"done\" parameters","suites":["Node","#close"],"updatePoint":{"line":92,"column":63,"index":2803},"line":92,"code":"    it('accepts a callback with \"removed\" and \"done\" parameters', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var receivedRemoved;\n      n.on('close', function (removed, done) {\n        receivedRemoved = removed;\n        setTimeout(function () {\n          done();\n        }, 50);\n      });\n      var p = n.close(true);\n      should.exist(p);\n      receivedRemoved.should.be.true();\n      p.then(function () {\n        testdone();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"allows multiple close handlers to be registered","suites":["Node","#close"],"updatePoint":{"line":111,"column":55,"index":3303},"line":111,"code":"    it('allows multiple close handlers to be registered', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var callbacksClosed = 0;\n      n.on('close', function (done) {\n        setTimeout(function () {\n          callbacksClosed++;\n          done();\n        }, 50);\n      });\n      n.on('close', function (done) {\n        setTimeout(function () {\n          callbacksClosed++;\n          done();\n        }, 75);\n      });\n      n.on('close', function () {\n        callbacksClosed++;\n      });\n      var p = n.close();\n      should.exist(p);\n      p.then(function () {\n        callbacksClosed.should.eql(3);\n        testdone();\n      }).catch(function (e) {\n        testdone(e);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits input event when called","suites":["Node","#receive"],"updatePoint":{"line":143,"column":37,"index":4078},"line":143,"code":"    it('emits input event when called', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        should.deepEqual(msg, message);\n        done();\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"writes metric info with undefined msg","suites":["Node","#receive"],"updatePoint":{"line":157,"column":45,"index":4420},"line":157,"code":"    it('writes metric info with undefined msg', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('input', function (msg) {\n        (typeof msg).should.not.be.equal(\"undefined\");\n        (typeof msg._msgid).should.not.be.equal(\"undefined\");\n        done();\n      });\n      n.receive();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"writes metric info with null msg","suites":["Node","#receive"],"updatePoint":{"line":169,"column":40,"index":4765},"line":169,"code":"    it('writes metric info with null msg', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('input', function (msg) {\n        (typeof msg).should.not.be.equal(\"undefined\");\n        (typeof msg._msgid).should.not.be.equal(\"undefined\");\n        done();\n      });\n      n.receive(null);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"handles thrown errors","suites":["Node","#receive"],"updatePoint":{"line":181,"column":29,"index":5103},"line":181,"code":"    it('handles thrown errors', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      sinon.stub(n, \"error\").callsFake(function (err, msg) {});\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        throw new Error(\"test error\");\n      });\n      n.receive(message);\n      setTimeout(function () {\n        n.error.called.should.be.true();\n        n.error.firstCall.args[1].should.equal(message);\n        done();\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"calls parent flow handleComplete when callback provided","suites":["Node","#receive"],"updatePoint":{"line":200,"column":63,"index":5669},"line":200,"code":"    it('calls parent flow handleComplete when callback provided', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            try {\n              msg.should.deepEqual(message);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          }\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone();\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers onComplete hook when done callback provided","suites":["Node","#receive"],"updatePoint":{"line":223,"column":60,"index":6251},"line":223,"code":"    it('triggers onComplete hook when done callback provided', function (done) {\n      var handleCompleteCalled = false;\n      var hookCalled = false;\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            handleCompleteCalled = true;\n          }\n        }\n      });\n      var hookError;\n      hooks.add(\"onComplete\", function (completeEvent) {\n        hookCalled = true;\n\n        try {\n          handleCompleteCalled.should.be.false(\"onComplete should be called before handleComplete\");\n          should.not.exist(completeEvent.error);\n          completeEvent.msg.should.deepEqual(message);\n          completeEvent.node.id.should.eql(\"123\");\n          completeEvent.node.node.should.equal(n);\n        } catch (err) {\n          hookError = err;\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone();\n      });\n      n.receive(message);\n      setTimeout(function () {\n        if (hookError) {\n          done(hookError);\n          return;\n        }\n\n        try {\n          hookCalled.should.be.true(\"onComplete hook should be called\");\n          handleCompleteCalled.should.be.true(\"handleComplete should be called\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers onComplete hook when done callback provided - with error","suites":["Node","#receive"],"updatePoint":{"line":271,"column":73,"index":7667},"line":271,"code":"    it('triggers onComplete hook when done callback provided - with error', function (done) {\n      var handleCompleteCalled = false;\n      var hookCalled = false;\n      var errorReported = false;\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            handleCompleteCalled = true;\n          }\n        }\n      });\n      var hookError;\n      hooks.add(\"onComplete\", function (completeEvent) {\n        hookCalled = true;\n\n        try {\n          handleCompleteCalled.should.be.false(\"onComplete should be called before handleComplete\");\n          should.exist(completeEvent.error);\n          completeEvent.error.toString().should.equal(\"Error: test error\");\n          completeEvent.msg.should.deepEqual(message);\n          completeEvent.node.id.should.eql(\"123\");\n          completeEvent.node.node.should.equal(n);\n        } catch (err) {\n          hookError = err;\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone(new Error(\"test error\"));\n      });\n\n      n.error = function (err, msg) {\n        errorReported = true;\n      };\n\n      n.receive(message);\n      setTimeout(function () {\n        if (hookError) {\n          done(hookError);\n          return;\n        }\n\n        try {\n          hookCalled.should.be.true(\"onComplete hook should be called\");\n          handleCompleteCalled.should.be.false(\"handleComplete should not be called\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"logs error if callback provides error","suites":["Node","#receive"],"updatePoint":{"line":326,"column":45,"index":9267},"line":326,"code":"    it('logs error if callback provides error', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      sinon.stub(n, \"error\").callsFake(function (err, msg) {});\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone(new Error(\"test error\"));\n        setTimeout(function () {\n          try {\n            n.error.called.should.be.true();\n            n.error.firstCall.args[0].toString().should.equal(\"Error: test error\");\n            n.error.firstCall.args[1].should.equal(message);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers hooks when receiving a message","suites":["Node","#receive"],"updatePoint":{"line":350,"column":47,"index":10018},"line":350,"code":"    it(\"triggers hooks when receiving a message\", function (done) {\n      var hookErrors = [];\n      var messageReceived = false;\n      var hooksCalled = [];\n      hooks.add(\"onReceive\", function (receiveEvent) {\n        hooksCalled.push(\"onReceive\");\n\n        try {\n          messageReceived.should.be.false(\"Message should not have been received before onReceive\");\n          receiveEvent.msg.should.be.exactly(message);\n          receiveEvent.destination.id.should.equal(\"123\");\n          receiveEvent.destination.node.should.equal(n);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"postReceive\", function (receiveEvent) {\n        hooksCalled.push(\"postReceive\");\n\n        try {\n          messageReceived.should.be.true(\"Message should have been received before postReceive\");\n          receiveEvent.msg.should.be.exactly(message);\n          receiveEvent.destination.id.should.equal(\"123\");\n          receiveEvent.destination.node.should.equal(n);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        messageReceived = true;\n\n        try {\n          should.strictEqual(this, n);\n          hooksCalled.should.eql([\"onReceive\"]);\n          should.deepEqual(msg, message);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      n.receive(message);\n      setTimeout(function () {\n        hooks.clear();\n\n        if (hookErrors.length > 0) {\n          done(hookErrors[0]);\n        } else {\n          done();\n        }\n      }, 10);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"onReceive","suites":["Node","#receive","errors thrown by hooks are reported"],"updatePoint":{"line":455,"column":19,"index":13110},"line":455,"code":"      it(\"onReceive\", function (done) {\n        testHook(\"onReceive\", false, done);\n      });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"postReceive","suites":["Node","#receive","errors thrown by hooks are reported"],"updatePoint":{"line":458,"column":21,"index":13206},"line":458,"code":"      it(\"postReceive\", function (done) {\n        testHook(\"postReceive\", true, done);\n      });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"onReceive","suites":["Node","hooks can halt receive"],"updatePoint":{"line":505,"column":17,"index":14353},"line":505,"code":"    it(\"onReceive\", function (done) {\n      testHook(\"onReceive\", false, done);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits a single message","suites":["Node","#send"],"updatePoint":{"line":510,"column":30,"index":14494},"line":510,"code":"    it('emits a single message', function (done) {\n      var flow = {\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(1);\n            sendEvents[0].msg.should.equal(message);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n1.send(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits a message with callback provided send","suites":["Node","#send"],"updatePoint":{"line":542,"column":51,"index":15300},"line":542,"code":"    it('emits a message with callback provided send', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        handleComplete: (node, msg) => {},\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(1);\n            sendEvents[0].msg.should.equal(message);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n1.on('input', function (msg, nodeSend, nodeDone) {\n        nodeSend(msg);\n        nodeDone();\n      });\n      n1.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits multiple messages on a single output","suites":["Node","#send"],"updatePoint":{"line":583,"column":50,"index":16424},"line":583,"code":"    it('emits multiple messages on a single output', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(2);\n            sendEvents[0].msg.should.equal(messages[0]);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            sendEvents[1].msg.should.equal(messages[1]);\n            sendEvents[1].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[1].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[1].cloneMessage.should.be.true();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var messages = [{\n        payload: \"hello world\"\n      }, {\n        payload: \"hello world again\"\n      }];\n      n1.send([messages]);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits messages to multiple outputs","suites":["Node","#send"],"updatePoint":{"line":632,"column":42,"index":17808},"line":632,"code":"    it('emits messages to multiple outputs', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(3);\n            sendEvents[0].msg.should.equal(messages[0]);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            should.exist(sendEvents[0].msg._msgid);\n            sendEvents[1].msg.should.equal(messages[2]);\n            sendEvents[1].destination.should.eql({\n              id: \"n4\",\n              node: undefined\n            });\n            sendEvents[1].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 2\n            });\n            sendEvents[1].cloneMessage.should.be.true();\n            should.exist(sendEvents[1].msg._msgid);\n            sendEvents[2].msg.should.equal(messages[2]);\n            sendEvents[2].destination.should.eql({\n              id: \"n5\",\n              node: undefined\n            });\n            sendEvents[2].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 2\n            });\n            sendEvents[2].cloneMessage.should.be.true();\n            should.exist(sendEvents[2].msg._msgid);\n\n            sendEvents[0].msg._msgid.should.eql(sendEvents[1].msg._msgid);\n\n            sendEvents[1].msg._msgid.should.eql(sendEvents[2].msg._msgid);\n\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2'], ['n3'], ['n4', 'n5']]\n      });\n      var n2 = new RedNode({\n        _flow: flow,\n        id: 'n2',\n        type: 'abc'\n      });\n      var n3 = new RedNode({\n        _flow: flow,\n        id: 'n3',\n        type: 'abc'\n      });\n      var n4 = new RedNode({\n        _flow: flow,\n        id: 'n4',\n        type: 'abc'\n      });\n      var n5 = new RedNode({\n        _flow: flow,\n        id: 'n5',\n        type: 'abc'\n      });\n      var messages = [{\n        payload: \"hello world\"\n      }, null, {\n        payload: \"hello world again\"\n      }];\n      var rcvdCount = 0;\n      n1.send(messages);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits no messages","suites":["Node","#send"],"updatePoint":{"line":721,"column":25,"index":20294},"line":721,"code":"    it('emits no messages', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        getNode: id => {\n          return {\n            'n1': n1,\n            'n2': n2\n          }[id];\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var n2 = new RedNode({\n        _flow: flow,\n        id: 'n2',\n        type: 'abc'\n      });\n      n2.on('input', function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      });\n      setTimeout(function () {\n        done();\n      }, 200);\n      n1.send();\n    }); // it('emits messages without cloning req or res', function(done) {","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a log message","suites":["Node","#log"],"updatePoint":{"line":831,"column":30,"index":24381},"line":831,"code":"    it('produces a log message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.log(\"a log message\");\n      should.deepEqual({\n        level: Log.INFO,\n        id: n.id,\n        type: n.type,\n        msg: \"a log message\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a log message with a name","suites":["Node","#log"],"updatePoint":{"line":853,"column":42,"index":24870},"line":853,"code":"    it('produces a log message with a name', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        name: \"barney\",\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.log(\"a log message\");\n      should.deepEqual({\n        level: Log.INFO,\n        id: n.id,\n        name: \"barney\",\n        type: n.type,\n        msg: \"a log message\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a warning message","suites":["Node","#warn"],"updatePoint":{"line":879,"column":34,"index":25439},"line":879,"code":"    it('produces a warning message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.warn(\"a warning\");\n      should.deepEqual({\n        level: Log.WARN,\n        id: n.id,\n        type: n.type,\n        msg: \"a warning\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"handles a null error message","suites":["Node","#error"],"updatePoint":{"line":903,"column":36,"index":25956},"line":903,"code":"    it('handles a null error message', function (done) {\n      var flow = {\n        handleError: sinon.stub(),\n        log: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc',\n        z: '789'\n      });\n      var message = {\n        a: 1\n      };\n      n.error(null, message);\n      flow.handleError.called.should.be.true();\n      flow.handleError.args[0][0].should.eql(n);\n      flow.handleError.args[0][1].should.eql(\"\");\n      flow.handleError.args[0][2].should.eql(message);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces an error message","suites":["Node","#error"],"updatePoint":{"line":924,"column":33,"index":26513},"line":924,"code":"    it('produces an error message', function (done) {\n      var flow = {\n        handleError: sinon.stub(),\n        log: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc',\n        z: '789'\n      });\n      var message = {\n        a: 2\n      };\n      n.error(\"This is an error\", message);\n      flow.handleError.called.should.be.true();\n      flow.handleError.args[0][0].should.eql(n);\n      flow.handleError.args[0][1].should.eql(\"This is an error\");\n      flow.handleError.args[0][2].should.eql(message);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a metric message","suites":["Node","#metric"],"updatePoint":{"line":947,"column":33,"index":27142},"line":947,"code":"    it('produces a metric message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      n.metric(\"test.metric\", msg, \"15mb\");\n      should.deepEqual({\n        value: \"15mb\",\n        level: Log.METRIC,\n        nodeid: n.id,\n        event: \"node.abc.test.metric\",\n        msgid: \"987654321\"\n      }, loginfo);\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns metric value if eventname undefined","suites":["Node","#metric"],"updatePoint":{"line":973,"column":51,"index":27798},"line":973,"code":"    it('returns metric value if eventname undefined', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      var m = n.metric(undefined, msg, \"15mb\");\n      m.should.be.a.Boolean();\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns not defined if eventname defined","suites":["Node","#metric"],"updatePoint":{"line":991,"column":48,"index":28262},"line":991,"code":"    it('returns not defined if eventname defined', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      var m = n.metric(\"info\", msg, \"15mb\");\n      should(m).be.undefined;\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status","suites":["Node","#status"],"updatePoint":{"line":1011,"column":24,"index":28740},"line":1011,"code":"    it('publishes status', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      var status = {\n        fill: \"green\",\n        shape: \"dot\",\n        text: \"connected\"\n      };\n      n.status(status);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql(status);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain string","suites":["Node","#status"],"updatePoint":{"line":1031,"column":41,"index":29264},"line":1031,"code":"    it('publishes status for plain string', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(\"text status\");\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"text status\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain boolean","suites":["Node","#status"],"updatePoint":{"line":1048,"column":42,"index":29726},"line":1048,"code":"    it('publishes status for plain boolean', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(false);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"false\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain number","suites":["Node","#status"],"updatePoint":{"line":1065,"column":41,"index":30173},"line":1065,"code":"    it('publishes status for plain number', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(123);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"123\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"delegates all functions to registry module","suites":["runtime/plugins"],"line":10,"code":"  it.skip(\"delegates all functions to registry module\", function () {// There's no easy way to test this as we can't stub the registry functions","file":"unit/@node-red/runtime/lib/plugins_spec.js","skipped":true,"dir":"test"},{"name":"wraps the user settings as read-only properties","suites":["runtime/settings"],"updatePoint":{"line":26,"column":53,"index":939},"line":26,"code":"  it('wraps the user settings as read-only properties', function () {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n    settings.a.should.equal(123);\n    settings.b.should.equal(\"test\");\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(3);\n    settings.get(\"a\").should.equal(123);\n    settings.get(\"b\").should.equal(\"test\");\n    settings.get(\"c\").should.be.an.Array();\n    settings.get(\"c\").should.have.lengthOf(3);\n    /*jshint immed: false */\n\n    (function () {\n      settings.a = 456;\n    }).should.throw();\n    settings.c.push(5);\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(4);\n    /*jshint immed: false */\n\n    (function () {\n      settings.set(\"a\", 456);\n    }).should.throw();\n    /*jshint immed: false */\n\n    (function () {\n      settings.set(\"a\", 456);\n    }).should.throw();\n    /*jshint immed: false */\n\n    (function () {\n      settings.get(\"unknown\");\n    }).should.throw();\n    /*jshint immed: false */\n\n    (function () {\n      settings.set(\"unknown\", 456);\n    }).should.throw();\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"loads global settings from storage","suites":["runtime/settings"],"updatePoint":{"line":71,"column":40,"index":2097},"line":71,"code":"  it('loads global settings from storage', function (done) {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    var savedSettings = null;\n    var saveCount = 0;\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          globalA: 789\n        });\n      },\n      saveSettings: function (settings) {\n        saveCount++;\n        savedSettings = settings;\n        return Promise.resolve();\n      }\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n    /*jshint immed: false */\n\n    (function () {\n      settings.get(\"unknown\");\n    }).should.throw();\n    settings.load(storage).then(function () {\n      settings.available().should.be.true();\n      settings.get(\"globalA\").should.equal(789);\n      settings.set(\"globalA\", \"abc\").then(function () {\n        savedSettings.globalA.should.equal(\"abc\");\n        saveCount.should.equal(1);\n        settings.set(\"globalA\", \"abc\").then(function () {\n          savedSettings.globalA.should.equal(\"abc\"); // setting to existing value should not trigger save\n\n          saveCount.should.equal(1);\n          done();\n        });\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes persistent settings when reset","suites":["runtime/settings"],"updatePoint":{"line":115,"column":44,"index":3338},"line":115,"code":"  it('removes persistent settings when reset', function () {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n    settings.should.have.property(\"a\", 123);\n    settings.should.have.property(\"b\", \"test\");\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(3);\n    settings.reset();\n    settings.should.not.have.property(\"a\");\n    settings.should.not.have.property(\"d\");\n    settings.should.not.have.property(\"c\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"registers node settings and exports them","suites":["runtime/settings"],"updatePoint":{"line":132,"column":46,"index":3890},"line":132,"code":"  it('registers node settings and exports them', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      },\n      injectSize: {\n        value: \"100\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mqtt\", {\n      mqttColor: {\n        value: \"purple\",\n        exportable: false\n      },\n      mqttSize: {\n        value: \"50\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"http request\", {\n      httpRequest1: {\n        value: \"a1\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"  http--request<> \", {\n      httpRequest2: {\n        value: \"a2\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"_http_request_\", {\n      httpRequest3: {\n        value: \"a3\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mQtT\", {\n      mQtTColor: {\n        value: \"purple\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"abc123\", {\n      abc123: {\n        value: \"def456\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"noValue\", {\n      noValueHasValue: {\n        value: \"123\",\n        exportable: true\n      },\n      noValueNoValue: {\n        exportable: true\n      }\n    });\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.have.property(\"injectSize\", \"100\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"mqttSize\", \"50\");\n    safeSettings.should.have.property(\"httpRequest1\", \"a1\");\n    safeSettings.should.have.property(\"httpRequest2\", \"a2\");\n    safeSettings.should.have.property(\"httpRequest3\", \"a3\");\n    safeSettings.should.have.property(\"mQtTColor\", \"purple\");\n    safeSettings.should.have.property(\"abc123\", \"def456\");\n    safeSettings.should.have.property(\"noValueHasValue\", \"123\");\n    safeSettings.should.not.have.property(\"noValueNoValue\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"prohibits registering the property whose name do not start with type name","suites":["runtime/settings"],"updatePoint":{"line":208,"column":79,"index":6065},"line":208,"code":"  it('prohibits registering the property whose name do not start with type name', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    (function () {\n      settings.registerNodeSettings(\"inject\", {\n        color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"_a_b_1_\", {\n        ab1Color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"AB2\", {\n        AB2Color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"abcDef\", {\n        abcColor: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.not.have.property(\"color\");\n    safeSettings.should.not.have.property(\"ab1Color\", \"blue\");\n    safeSettings.should.not.have.property(\"AB2Color\");\n    safeSettings.should.not.have.property(\"abcColor\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"overwrites node settings with user settings","suites":["runtime/settings"],"updatePoint":{"line":250,"column":49,"index":7215},"line":250,"code":"  it('overwrites node settings with user settings', function () {\n    var userSettings = {\n      injectColor: \"green\",\n      mqttColor: \"yellow\",\n      abColor: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"ab\", {\n      abColor: {\n        value: \"red\",\n        exportable: false\n      }\n    });\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"green\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.not.have.property(\"abColor\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"disables/enables node settings","suites":["runtime/settings"],"updatePoint":{"line":275,"column":36,"index":7919},"line":275,"code":"  it('disables/enables node settings', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    var safeSettings = {};\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mqtt\", {\n      mqttColor: {\n        value: \"purple\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"http request\", {\n      httpRequestColor: {\n        value: \"yellow\",\n        exportable: true\n      }\n    });\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.have.property(\"mqttColor\", \"purple\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n    safeSettings = {};\n    var types = [\"inject\", \"mqtt\"];\n    settings.disableNodeSettings(types);\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.not.have.property(\"injectColor\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n    safeSettings = {};\n    types = [\"inject\"];\n    settings.enableNodeSettings(types);\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"delete global setting","suites":["runtime/settings"],"updatePoint":{"line":316,"column":27,"index":9348},"line":316,"code":"  it('delete global setting', function () {\n    // read-only\n    var localSettings = {\n      a: 1\n    }; // read-write\n\n    var globalSettings = {\n      b: 2\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve(globalSettings);\n      },\n      saveSettings: function () {\n        return Promise.resolve();\n      }\n    };\n    settings.init(localSettings);\n    return settings.load(storage).then(function () {\n      settings.get('a').should.eql(1);\n      settings.get('b').should.eql(2);\n      return settings.delete('b');\n    }).then(function () {\n      should.not.exist(settings.get('b'));\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"refused to delete local setting","suites":["runtime/settings"],"updatePoint":{"line":342,"column":37,"index":9999},"line":342,"code":"  it('refused to delete local setting', function (done) {\n    // read-only\n    var localSettings = {\n      a: 1\n    }; // read-write\n\n    var globalSettings = {\n      b: 2\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve(globalSettings);\n      }\n    };\n    settings.init(localSettings);\n    settings.load(storage).then(function () {\n      settings.get('a').should.eql(1);\n      settings.get('b').should.eql(2);\n\n      try {\n        settings.delete('a');\n        return done(\"Did not throw error\");\n      } catch (err) {// expected\n      }\n\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"get user settings","suites":["runtime/settings"],"updatePoint":{"line":370,"column":23,"index":10607},"line":370,"code":"  it('get user settings', function () {\n    var userSettings = {\n      admin: {\n        a: 1\n      }\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          a: 1,\n          users: userSettings\n        });\n      }\n    };\n    settings.init(userSettings);\n    return settings.load(storage).then(function () {\n      var result = settings.getUserSettings('admin');\n      result.should.eql(userSettings.admin); // Check it has been cloned\n\n      result.should.not.equal(userSettings.admin);\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"set user settings","suites":["runtime/settings"],"updatePoint":{"line":392,"column":23,"index":11153},"line":392,"code":"  it('set user settings', function () {\n    var userSettings = {\n      admin: {\n        a: 1\n      }\n    };\n    var savedSettings;\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          c: 3,\n          users: userSettings\n        });\n      },\n      saveSettings: function (s) {\n        savedSettings = s;\n        return Promise.resolve();\n      }\n    };\n    settings.init(userSettings);\n    return settings.load(storage).then(function () {\n      return settings.setUserSettings('admin', {\n        b: 2\n      });\n    }).then(function () {\n      savedSettings.should.have.property(\"c\", 3);\n      savedSettings.should.have.property('users');\n      savedSettings.users.should.eql({\n        admin: {\n          b: 2\n        }\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects the promise when settings suggest loading a bad module","suites":["red/storage/index"],"updatePoint":{"line":25,"column":68,"index":934},"line":25,"code":"  it('rejects the promise when settings suggest loading a bad module', function (done) {\n    var wrongModule = {\n      settings: {\n        storageModule: \"thisaintloading\"\n      }\n    };\n    storage.init(wrongModule).then(function () {\n      var one = 1;\n      var zero = 0;\n\n      try {\n        zero.should.equal(one, \"The initialization promise should never get resolved\");\n      } catch (err) {\n        done(err);\n      }\n    }).catch(function (e) {\n      done(); //successfully rejected promise\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"non-string storage module","suites":["red/storage/index"],"updatePoint":{"line":44,"column":31,"index":1410},"line":44,"code":"  it('non-string storage module', function (done) {\n    var initSetsMeToTrue = false;\n    var moduleWithBooleanSettingInit = {\n      init: function () {\n        initSetsMeToTrue = true;\n      }\n    };\n    var setsBooleanModule = {\n      settings: {\n        storageModule: moduleWithBooleanSettingInit\n      }\n    };\n    storage.init(setsBooleanModule);\n    initSetsMeToTrue.should.be.true();\n    done();\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"respects storage interface","suites":["red/storage/index"],"updatePoint":{"line":60,"column":32,"index":1821},"line":60,"code":"  it('respects storage interface', function (done) {\n    var calledFlagGetFlows = false;\n    var calledFlagGetCredentials = false;\n    var calledFlagGetAllFlows = false;\n    var calledInit = false;\n    var calledFlagGetSettings = false;\n    var calledFlagGetSessions = false;\n    var interfaceCheckerModule = {\n      init: function (settings) {\n        settings.should.be.an.Object();\n        calledInit = true;\n      },\n      getFlows: function () {\n        calledFlagGetFlows = true;\n        return Promise.resolve([]);\n      },\n      saveFlows: function (flows) {\n        flows.should.be.an.Array();\n        flows.should.have.lengthOf(0);\n        return Promise.resolve(\"\");\n      },\n      getCredentials: function () {\n        calledFlagGetCredentials = true;\n        return Promise.resolve({});\n      },\n      saveCredentials: function (credentials) {\n        credentials.should.be.true();\n      },\n      getSettings: function () {\n        calledFlagGetSettings = true;\n      },\n      saveSettings: function (settings) {\n        settings.should.be.true();\n      },\n      getSessions: function () {\n        calledFlagGetSessions = true;\n      },\n      saveSessions: function (sessions) {\n        sessions.should.be.true();\n      },\n      getAllFlows: function () {\n        calledFlagGetAllFlows = true;\n      },\n      getFlow: function (fn) {\n        fn.should.equal(\"name\");\n      },\n      saveFlow: function (fn, data) {\n        fn.should.equal(\"name\");\n        data.should.be.true();\n      },\n      getLibraryEntry: function (type, path) {\n        type.should.be.true();\n        path.should.equal(\"name\");\n      },\n      saveLibraryEntry: function (type, path, meta, body) {\n        type.should.be.true();\n        path.should.equal(\"name\");\n        meta.should.be.true();\n        body.should.be.true();\n      }\n    };\n    var moduleToLoad = {\n      settings: {\n        storageModule: interfaceCheckerModule\n      }\n    };\n    var promises = [];\n    storage.init(moduleToLoad);\n    promises.push(storage.getFlows());\n    promises.push(storage.saveFlows({\n      flows: [],\n      credentials: {}\n    }));\n    storage.getSettings();\n    storage.saveSettings(true);\n    storage.getSessions();\n    storage.saveSessions(true);\n    storage.getAllFlows();\n    storage.getFlow(\"name\");\n    storage.saveFlow(\"name\", true);\n    storage.getLibraryEntry(true, \"name\");\n    storage.saveLibraryEntry(true, \"name\", true, true);\n    Promise.all(promises).then(function () {\n      try {\n        calledInit.should.be.true();\n        calledFlagGetFlows.should.be.true();\n        calledFlagGetCredentials.should.be.true();\n        calledFlagGetAllFlows.should.be.true();\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"getAllFlows","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":194,"column":19,"index":5694},"line":194,"code":"    it('getAllFlows', function (done) {\n      storage.getAllFlows().then(function (res) {\n        try {\n          res.should.eql({\n            d: {\n              a: {\n                f: ['test2']\n              }\n            },\n            f: ['test']\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"getFlow","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":211,"column":15,"index":6046},"line":211,"code":"    it('getFlow', function (done) {\n      storage.getFlow(paff.join(\"a\", \"test2.json\")).then(function (res) {\n        try {\n          res.should.eql(\"test content\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"saveFlow","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":221,"column":16,"index":6304},"line":221,"code":"    it('saveFlow', function (done) {\n      storage.saveFlow(paff.join(\"a\", \"test2.json\"), \"new content\").then(function (res) {\n        try {\n          savePath.should.eql(paff.join(\"a\", \"test2.json\"));\n          saveContent.should.eql(\"new content\");\n          saveMeta.should.eql({});\n          saveType.should.eql(\"flows\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing getSettings","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":246,"column":36,"index":7036},"line":246,"code":"    it('defaults missing getSettings', function (done) {\n      storage.getSettings().then(function (settings) {\n        should.not.exist(settings);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing saveSettings","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":252,"column":37,"index":7219},"line":252,"code":"    it('defaults missing saveSettings', function (done) {\n      storage.saveSettings({}).then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing getSessions","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":257,"column":36,"index":7360},"line":257,"code":"    it('defaults missing getSessions', function (done) {\n      storage.getSessions().then(function (settings) {\n        should.not.exist(settings);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing saveSessions","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":263,"column":37,"index":7543},"line":263,"code":"    it('defaults missing saveSessions', function (done) {\n      storage.saveSessions({}).then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"should initialise the user directory","suites":["storage/localfilesystem"],"updatePoint":{"line":57,"column":42,"index":1617},"line":57,"code":"  it('should initialise the user directory', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(path.join(userDir, \"lib\")).should.be.true();\n      fs.existsSync(path.join(userDir, \"lib\", 'flows')).should.be.true();\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to NRH if .config.json presents","suites":["storage/localfilesystem"],"updatePoint":{"line":71,"column":56,"index":2048},"line":71,"code":"  it('should set userDir to NRH if .config.json presents', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    fs.mkdirSync(process.env.NODE_RED_HOME);\n    fs.writeFileSync(path.join(process.env.NODE_RED_HOME, \".config.json\"), \"{}\", \"utf8\");\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.NODE_RED_HOME, \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.NODE_RED_HOME, \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(process.env.NODE_RED_HOME);\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to HOMEPATH/.node-red if .config.json presents","suites":["storage/localfilesystem"],"updatePoint":{"line":96,"column":71,"index":2968},"line":96,"code":"  it('should set userDir to HOMEPATH/.node-red if .config.json presents', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    fs.mkdirSync(process.env.HOMEPATH);\n    fs.mkdirSync(path.join(process.env.HOMEPATH, \".node-red\"));\n    fs.writeFileSync(path.join(process.env.HOMEPATH, \".node-red\", \".config.json\"), \"{}\", \"utf8\");\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.HOMEPATH, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.HOMEPATH, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.HOMEPATH, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.NODE_HOMEPATH = oldHOMEPATH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to HOME/.node-red","suites":["storage/localfilesystem"],"updatePoint":{"line":125,"column":42,"index":4113},"line":125,"code":"  it('should set userDir to HOME/.node-red', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOME = process.env.HOME;\n    process.env.HOME = path.join(userDir, \"HOME\");\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    fs.mkdirSync(process.env.HOME);\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.HOME, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.HOME, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.HOME, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOME = oldHOME;\n        process.env.HOMEPATH = oldHOMEPATH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to USERPROFILE/.node-red","suites":["storage/localfilesystem"],"updatePoint":{"line":155,"column":49,"index":5205},"line":155,"code":"  it('should set userDir to USERPROFILE/.node-red', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOME = process.env.HOME;\n    process.env.HOME = \"\";\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    var oldUSERPROFILE = process.env.USERPROFILE;\n    process.env.USERPROFILE = path.join(userDir, \"USERPROFILE\");\n    fs.mkdirSync(process.env.USERPROFILE);\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.USERPROFILE, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.USERPROFILE, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.USERPROFILE, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOME = oldHOME;\n        process.env.HOMEPATH = oldHOMEPATH;\n        process.env.USERPROFILE = oldUSERPROFILE;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing flow file","suites":["storage/localfilesystem"],"updatePoint":{"line":188,"column":37,"index":6454},"line":188,"code":"  it('should handle missing flow file', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      fs.existsSync(flowFilePath).should.be.false();\n      localfilesystem.getFlows().then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty flow file, no backup","suites":["storage/localfilesystem"],"updatePoint":{"line":208,"column":46,"index":7062},"line":208,"code":"  it('should handle empty flow file, no backup', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.closeSync(fs.openSync(flowFilePath, 'w'));\n      fs.existsSync(flowFilePath).should.be.true();\n      localfilesystem.getFlows().then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty flow file, restores backup","suites":["storage/localfilesystem"],"updatePoint":{"line":230,"column":52,"index":7806},"line":230,"code":"  it('should handle empty flow file, restores backup', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.closeSync(fs.openSync(flowFilePath, 'w'));\n      fs.existsSync(flowFilePath).should.be.true();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      fs.writeFileSync(flowFileBackupPath, JSON.stringify(testFlow));\n      fs.existsSync(flowFileBackupPath).should.be.true();\n      setTimeout(function () {\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }, 50);\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should save flows to the default file","suites":["storage/localfilesystem"],"updatePoint":{"line":257,"column":43,"index":8791},"line":257,"code":"  it('should save flows to the default file', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.existsSync(flowFilePath).should.be.false();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFilePath).should.be.true();\n        fs.existsSync(flowFileBackupPath).should.be.false();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should save flows to the specified file","suites":["storage/localfilesystem"],"updatePoint":{"line":285,"column":45,"index":9791},"line":285,"code":"  it('should save flows to the specified file', function (done) {\n    var defaultFlowFile = 'flows_' + require('os').hostname() + '.json';\n    var defaultFlowFilePath = path.join(userDir, defaultFlowFile);\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(defaultFlowFilePath).should.be.false();\n      fs.existsSync(flowFilePath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(defaultFlowFilePath).should.be.false();\n        fs.existsSync(flowFilePath).should.be.true();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should format the flows file when flowFilePretty specified","suites":["storage/localfilesystem"],"updatePoint":{"line":315,"column":64,"index":10865},"line":315,"code":"  it('should format the flows file when flowFilePretty specified', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      flowFilePretty: true,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      localfilesystem.saveFlows(testFlow).then(function () {\n        var content = fs.readFileSync(flowFilePath, \"utf8\");\n        content.split(\"\\n\").length.should.be.above(1);\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should fsync the flows file","suites":["storage/localfilesystem"],"updatePoint":{"line":342,"column":33,"index":11683},"line":342,"code":"  it('should fsync the flows file', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      editorTheme: {\n        projects: {\n          enabled: false\n        }\n      },\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      sinon.spy(fs, \"fsync\");\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.fsync.callCount.should.be.greaterThan(0);\n        fs.fsync.restore();\n        done();\n      }).catch(function (err) {\n        fs.fsync.restore();\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should log fsync errors and continue","suites":["storage/localfilesystem"],"updatePoint":{"line":370,"column":42,"index":12424},"line":370,"code":"  it('should log fsync errors and continue', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      sinon.stub(fs, \"fsync\").callsFake(function (fd, cb) {\n        cb(new Error());\n      });\n      sinon.spy(log, \"warn\");\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.fsync.callCount.should.be.greaterThan(0);\n        log.warn.restore();\n        fs.fsync.callCount.should.be.greaterThan(0);\n        fs.fsync.restore();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should backup the flows file","suites":["storage/localfilesystem"],"updatePoint":{"line":397,"column":34,"index":13220},"line":397,"code":"  it('should backup the flows file', function (done) {\n    var defaultFlowFile = 'flows_' + require('os').hostname() + '.json';\n    var defaultFlowFilePath = path.join(userDir, defaultFlowFile);\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(defaultFlowFilePath).should.be.false();\n      fs.existsSync(flowFilePath).should.be.false();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFileBackupPath).should.be.false();\n        fs.existsSync(defaultFlowFilePath).should.be.false();\n        fs.existsSync(flowFilePath).should.be.true();\n        var content = fs.readFileSync(flowFilePath, 'utf8');\n        var testFlow2 = [{\n          \"type\": \"tab\",\n          \"id\": \"bc5672ad.2741d8\",\n          \"label\": \"Sheet 2\"\n        }];\n        localfilesystem.saveFlows(testFlow2).then(function () {\n          fs.existsSync(flowFileBackupPath).should.be.true();\n          fs.existsSync(defaultFlowFilePath).should.be.false();\n          fs.existsSync(flowFilePath).should.be.true();\n          var backupContent = fs.readFileSync(flowFileBackupPath, 'utf8');\n          content.should.equal(backupContent);\n          var content2 = fs.readFileSync(flowFilePath, 'utf8');\n          content2.should.not.equal(backupContent);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":442,"column":39,"index":15042},"line":442,"code":"  it('should handle missing credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      localfilesystem.getCredentials().then(function (creds) {\n        creds.should.eql({});\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":464,"column":31,"index":15686},"line":464,"code":"  it('should handle credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        localfilesystem.getCredentials().then(function (creds) {\n          creds.should.eql(credentials);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should backup existing credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":496,"column":40,"index":16629},"line":496,"code":"  it('should backup existing credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    var credFileBackup = path.join(userDir, \".test_cred.json.backup\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.writeFileSync(credFile, \"{}\", \"utf8\");\n      fs.existsSync(credFile).should.be.true();\n      fs.existsSync(credFileBackup).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        fs.existsSync(credFileBackup).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should format the creds file when flowFilePretty specified","suites":["storage/localfilesystem"],"updatePoint":{"line":527,"column":64,"index":17650},"line":527,"code":"  it('should format the creds file when flowFilePretty specified', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      flowFilePretty: true,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        var content = fs.readFileSync(credFile, \"utf8\");\n        content.split(\"\\n\").length.should.be.above(1);\n        localfilesystem.getCredentials().then(function (creds) {\n          creds.should.eql(credentials);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow file in random unc path and non-existent subfolder","suites":["storage/localfilesystem"],"updatePoint":{"line":562,"column":75,"index":18768},"line":562,"code":"  it('should handle flow file in random unc path and non-existent subfolder', function (done) {\n    // only test on win32\n    if (process.platform !== 'win32') {\n      console.log('skipped test as not win32');\n      done();\n      return;\n    } // get a real windows path\n\n\n    var flowFile = path.win32.resolve(userDir + '/some/random/path');\n    var rootdir = path.win32.resolve(userDir + '/some'); // make it into a local UNC path\n\n    flowFile = flowFile.replace('C:\\\\', '\\\\\\\\localhost\\\\c$\\\\');\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFile\n    }, mockRuntime).then(function () {\n      fs.existsSync(flowFile).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFile).should.be.true();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow); // cleanup\n\n          fs.removeSync(rootdir);\n          done();\n        }).catch(function (err) {\n          // cleanup\n          fs.removeSync(rootdir);\n          done(err);\n        });\n      }).catch(function (err) {\n        // cleanup\n        fs.removeSync(rootdir);\n        done(err);\n      });\n    }).catch(function (err) {\n      // cleanup\n      fs.removeSync(rootdir);\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an empty list of library objects","suites":["storage/localfilesystem/library"],"updatePoint":{"line":36,"column":52,"index":1233},"line":36,"code":"  it('should return an empty list of library objects', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', '').then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return an empty list of library objects (path=/)","suites":["storage/localfilesystem/library"],"updatePoint":{"line":50,"column":61,"index":1649},"line":50,"code":"  it('should return an empty list of library objects (path=/)', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', '/').then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a non-existent library object","suites":["storage/localfilesystem/library"],"updatePoint":{"line":64,"column":62,"index":2067},"line":64,"code":"  it('should return an error for a non-existent library object', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', 'A/B').then(function (flows) {\n        should.fail(null, null, \"non-existent flow\");\n      }).catch(function (err) {\n        should.exist(err);\n        done();\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a directory listing of library objects","suites":["storage/localfilesystem/library"],"updatePoint":{"line":103,"column":58,"index":3374},"line":103,"code":"  it('should return a directory listing of library objects', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary();\n      localfilesystemLibrary.getLibraryEntry('object', '').then(function (flows) {\n        flows.should.eql(['A', 'B', 'D', {\n          abc: 'def',\n          fn: 'file1.js'\n        }]);\n        localfilesystemLibrary.getLibraryEntry('object', 'B').then(function (flows) {\n          flows.should.eql(['C', {\n            ghi: 'jkl',\n            fn: 'file2.js'\n          }, {\n            fn: 'flow.json'\n          }]);\n          localfilesystemLibrary.getLibraryEntry('object', 'B/C').then(function (flows) {\n            flows.should.eql([]);\n            localfilesystemLibrary.getLibraryEntry('object', 'D').then(function (flows) {\n              flows.should.eql([{\n                mno: '',\n                fn: 'file3.js'\n              }]);\n              done();\n            }).catch(function (err) {\n              done(err);\n            });\n          }).catch(function (err) {\n            done(err);\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should load a flow library object with .json unspecified","suites":["storage/localfilesystem/library"],"updatePoint":{"line":144,"column":62,"index":4677},"line":144,"code":"  it('should load a flow library object with .json unspecified', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B/flow').then(function (flows) {\n        flows.should.eql(\"Hi\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a library object","suites":["storage/localfilesystem/library"],"updatePoint":{"line":157,"column":36,"index":5064},"line":157,"code":"  it('should return a library object', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary();\n      localfilesystemLibrary.getLibraryEntry('object', 'B/file2.js').then(function (body) {\n        body.should.eql(\"// not a metaline \\n\\n Hi\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library function","suites":["storage/localfilesystem/library"],"updatePoint":{"line":172,"column":50,"index":5531},"line":172,"code":"  it('should return a newly saved library function', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"functions\");\n      localfilesystemLibrary.getLibraryEntry('functions', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          ghi: 'jkl',\n          fn: 'file2.js'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file3.js\");\n        localfilesystemLibrary.saveLibraryEntry('functions', ft, {\n          mno: 'pqr'\n        }, \"// another non meta line\\n\\n Hi There\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('functions', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file3.js'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('functions', ft).then(function (body) {\n                body.should.eql(\"// another non meta line\\n\\n Hi There\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library flow","suites":["storage/localfilesystem/library"],"updatePoint":{"line":212,"column":46,"index":6928},"line":212,"code":"  it('should return a newly saved library flow', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          fn: 'flow.json'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file3\");\n        localfilesystemLibrary.saveLibraryEntry('flows', ft, {\n          mno: 'pqr'\n        }, \"Hi\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('flows', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file3.json'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('flows', ft + \".json\").then(function (body) {\n                body.should.eql(\"Hi\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library flow (multi-byte character)","suites":["storage/localfilesystem/library"],"updatePoint":{"line":251,"column":69,"index":8246},"line":251,"code":"  it('should return a newly saved library flow (multi-byte character)', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          fn: 'flow.json'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file4\");\n        localfilesystemLibrary.saveLibraryEntry('flows', ft, {\n          mno: 'pqr'\n        }, \"\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('flows', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file4.json'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('flows', ft + \".json\").then(function (body) {\n                body.should.eql(\"\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"generates package.json for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":30,"column":42,"index":1049},"line":30,"code":"  it('generates package.json for a project', function () {\n    var generated = defaultFileSet[\"package.json\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\",\n      files: {\n        flow: \"MY FLOW FILE\",\n        credentials: \"MY CREDENTIALS FILE\"\n      }\n    }, runtime);\n    var parsed = JSON.parse(generated);\n    parsed.should.have.property('name', \"A TEST NAME\");\n    parsed.should.have.property('description', \"A TEST SUMMARY\");\n    parsed.should.have.property('node-red');\n    parsed['node-red'].should.have.property('settings');\n    parsed['node-red'].settings.should.have.property('flowFile', \"MY FLOW FILE\");\n    parsed['node-red'].settings.should.have.property('credentialsFile', \"MY CREDENTIALS FILE\");\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"generates README.md for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":47,"column":39,"index":1779},"line":47,"code":"  it('generates README.md for a project', function () {\n    var generated = defaultFileSet[\"README.md\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\"\n    }, runtime);\n    generated.should.match(/A TEST NAME/);\n    generated.should.match(/A TEST SUMMARY/);\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"generates .gitignore for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":55,"column":40,"index":2057},"line":55,"code":"  it('generates .gitignore for a project', function () {\n    var generated = defaultFileSet[\".gitignore\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\"\n    }, runtime);\n    generated.length.should.be.greaterThan(0);\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"sets/clears auth details for a given project/remote/user","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":31,"column":62,"index":1095},"line":31,"code":"  it('sets/clears auth details for a given project/remote/user', function () {\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    authCache.set(\"project\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    var result = authCache.get(\"project\", \"remote1\", \"user1\");\n    result.should.have.property(\"foo1\", \"bar1\");\n    result = authCache.get(\"project\", \"remote1\", \"user2\");\n    result.should.have.property(\"foo2\", \"bar2\");\n    authCache.clear(\"project\", \"remote1\", \"user1\");\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"clears auth details for all users on a given project/remote","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":48,"column":65,"index":1879},"line":48,"code":"  it('clears auth details for all users on a given project/remote', function () {\n    authCache.set(\"project\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    authCache.set(\"project\", \"remote2\", \"user1\", {\n      foo3: \"bar3\"\n    });\n    should.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project\", \"remote2\", \"user1\"));\n    authCache.clear(\"project\", \"remote1\");\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project\", \"remote2\", \"user1\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"clears auth details for all remotes/users on a given project","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":66,"column":66,"index":2637},"line":66,"code":"  it('clears auth details for all remotes/users on a given project', function () {\n    authCache.set(\"project1\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project1\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    authCache.set(\"project2\", \"remote2\", \"user1\", {\n      foo3: \"bar3\"\n    });\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project2\", \"remote2\", \"user1\"));\n    authCache.clear(\"project2\");\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user2\"));\n    should.not.exist(authCache.get(\"project2\", \"remote2\", \"user1\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"listens for user/pass prompts and returns provided auth","suites":["localfilesystem/projects/git/authServer"],"updatePoint":{"line":53,"column":61,"index":1617},"line":53,"code":"  it(\"listens for user/pass prompts and returns provided auth\", function (done) {\n    authServer.ResponseServer({\n      username: \"TEST_USER\",\n      password: \"TEST_PASS\"\n    }).then(function (rs) {\n      sendPrompt(rs.path, \"Username\").then(function (response) {\n        response.should.eql(\"TEST_USER\");\n        return sendPrompt(rs.path, \"Password\");\n      }).then(function (response) {\n        response.should.eql(\"TEST_PASS\");\n      }).then(() => {\n        rs.close();\n        done();\n      }).catch(function (err) {\n        rs.close();\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authServer_spec.js","skipped":false,"dir":"test"},{"name":"listens for ssh prompts and returns provided auth","suites":["localfilesystem/projects/git/authServer"],"updatePoint":{"line":72,"column":55,"index":2196},"line":72,"code":"  it(\"listens for ssh prompts and returns provided auth\", function (done) {\n    authServer.ResponseSSHServer({\n      passphrase: \"TEST_PASSPHRASE\"\n    }).then(function (rs) {\n      sendPrompt(rs.path, \"The\").then(function (response) {\n        // TODO:\n        response.should.eql(\"yes\");\n        return sendPrompt(rs.path, \"Enter\");\n      }).then(function (response) {\n        response.should.eql(\"TEST_PASSPHRASE\");\n      }).then(() => {\n        rs.close();\n        done();\n      }).catch(function (err) {\n        rs.close();\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authServer_spec.js","skipped":false,"dir":"test"},{"name":"connects to port and sends passphrase","suites":["localfilesystem/projects/git/authWriter"],"updatePoint":{"line":50,"column":43,"index":1518},"line":50,"code":"  it(\"connects to port and sends passphrase\", function (done) {\n    var receivedData = \"\";\n    var server = net.createServer(function (connection) {\n      connection.setEncoding('utf8');\n      connection.on('data', function (data) {\n        receivedData += data;\n        var m = data.indexOf(\"\\n\");\n\n        if (m !== -1) {\n          connection.end();\n        }\n      });\n    });\n    var listenPath = getListenPath();\n    server.listen(listenPath, function (ready) {\n      child_process.exec('\"' + process.execPath + '\" \"' + authWriter + '\" \"' + listenPath + '\" TEST_PHRASE_FOO', {\n        cwd: __dirname\n      }, (error, stdout, stderr) => {\n        server.close();\n\n        try {\n          should.not.exist(error);\n          receivedData.should.eql(\"TEST_PHRASE_FOO\\n\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n    server.on('close', function () {\n      // console.log(\"Closing response server\");\n      fs.removeSync(listenPath);\n    });\n    server.on('error', function (err) {\n      console.log(\"ResponseServer unexpectedError:\", err.toString());\n      server.close();\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authWriter_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/git/index"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/index_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/index"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/index_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/Project"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/Project_spec.js","skipped":true,"dir":"test"},{"name":"should create sshkey directory when sshkey initializes","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":53,"column":60,"index":1597},"line":53,"code":"  it('should create sshkey directory when sshkey initializes', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      var ret = fs.existsSync(sshkeyDirPath);\n      ret.should.be.true();\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey empty list if there is no sshkey file","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":63,"column":61,"index":1959},"line":63,"code":"  it('should get sshkey empty list if there is no sshkey file', function (done) {\n    var username = 'test';\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(0);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":76,"column":28,"index":2362},"line":76,"code":"  it('should get sshkey list', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not get sshkey file if there is only private key","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":103,"column":61,"index":3315},"line":103,"code":"  it('should not get sshkey file if there is only private key', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    var onlyPrivateKeyFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      for (var filename of onlyPrivateKeyFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      }\n\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n\n        for (var filename of onlyPrivateKeyFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not get sshkey file if there is only public key","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":141,"column":60,"index":4643},"line":141,"code":"  it('should not get sshkey file if there is only public key', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    var directoryList = ['test-key03', '.test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      for (var filename of directoryList) {\n        fs.ensureDirSync(path.join(sshkeyDirPath, filename));\n      }\n\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n\n        for (var directoryname of directoryList) {\n          retObj.should.not.containEql({\n            name: directoryname\n          });\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list that does not have directory","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":179,"column":57,"index":5911},"line":179,"code":"  it('should get sshkey list that does not have directory', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var otherUsername = 'other';\n    var filenameList = ['test-key01', 'test-key02'];\n    var otherUserFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      for (var filename of otherUserFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n\n        for (var filename of otherUserFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list that have keys of specified user","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":219,"column":61,"index":7368},"line":219,"code":"  it('should get sshkey list that have keys of specified user', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var otherUsername = 'other';\n    var filenameList = ['test-key01', 'test-key02'];\n    var otherUserFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      for (var filename of otherUserFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n\n        for (var filename of otherUserFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with empty data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":259,"column":49,"index":8813},"line":259,"code":"  it('should generate sshkey file with empty data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      name: 'test-key01'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with only comment data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":279,"column":56,"index":9585},"line":279,"code":"  it('should generate sshkey file with only comment data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with password data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":300,"column":52,"index":10385},"line":300,"code":"  it('should generate sshkey file with password data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'testtest'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":322,"column":48,"index":11209},"line":322,"code":"  it('should generate sshkey file with size data', function (done) {\n    this.timeout(20000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      size: 4096\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with password & size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":344,"column":59,"index":12034},"line":344,"code":"  it('should generate sshkey file with password & size data', function (done) {\n    this.timeout(20000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'testtest',\n      size: 4096\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not generate sshkey file with illegal size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":367,"column":60,"index":12888},"line":367,"code":"  it('should not generate sshkey file with illegal size data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      size: 1023\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        done(new Error('Does NOT throw error!'));\n      }).catch(function (err) {\n        try {\n          err.should.have.property('code', 'key_length_too_short');\n          done();\n        } catch (error) {\n          done(error);\n        }\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not generate sshkey file with illegal password","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":391,"column":59,"index":13638},"line":391,"code":"  it('should not generate sshkey file with illegal password', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'aa'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        done(new Error('Does NOT throw error!'));\n      }).catch(function (err) {\n        try {\n          err.should.have.property('code', 'key_passphrase_too_short');\n          done();\n        } catch (error) {\n          done(error);\n        }\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey file content","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":415,"column":36,"index":14373},"line":415,"code":"  it('should get sshkey file content', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filename = 'test-key01';\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), fileContent, \"utf8\");\n      sshkeys.getSSHKey(username, filename).then(function (retObj) {\n        retObj.should.be.equal(fileContent);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should delete sshkey files","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":433,"column":32,"index":15818},"line":433,"code":"  it('should delete sshkey files', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filename = 'test-key01';\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), fileContent, \"utf8\");\n      sshkeys.deleteSSHKey(username, filename).then(function () {\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + filename)).should.be.false();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + filename + '.pub')).should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"invokes sshkeygen","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":34,"column":23,"index":1138},"line":34,"code":"  it(\"invokes sshkeygen\", function (done) {\n    var command;\n    var args;\n    var opts;\n    sinon.stub(child_process, \"spawn\").callsFake(function (_command, _args, _opts) {\n      _command = command;\n      _args = args;\n      _opts = opts;\n      var e = new EventEmitter();\n      e.stdout = new EventEmitter();\n      e.stderr = new EventEmitter();\n      setTimeout(function () {\n        e.stdout.emit(\"data\", \"result\");\n        e.emit(\"close\", 0);\n      }, 50);\n      return e;\n    });\n    keygen.generateKey({\n      size: 1024,\n      location: 'location',\n      comment: 'comment',\n      password: 'password'\n    }).then(function (output) {\n      output.should.equal(\"result\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"reports passphrase too short","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":63,"column":34,"index":1903},"line":63,"code":"  it(\"reports passphrase too short\", function (done) {\n    var command;\n    var args;\n    var opts;\n\n    try {\n      keygen.generateKey({\n        size: 1024,\n        location: 'location',\n        comment: 'comment',\n        password: '123'\n      }).then(function (output) {\n        done(new Error(\"Error not thrown\"));\n      }).catch(function (err) {\n        done(new Error(\"Error not thrown\"));\n      });\n    } catch (err) {\n      err.should.have.property(\"code\", \"key_passphrase_too_short\");\n      done();\n    }\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"reports key length too short","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":84,"column":34,"index":2423},"line":84,"code":"  it(\"reports key length too short\", function (done) {\n    var command;\n    var args;\n    var opts;\n\n    try {\n      keygen.generateKey({\n        size: 123,\n        location: 'location',\n        comment: 'comment',\n        password: 'password'\n      }).then(function (output) {\n        done(new Error(\"Error not thrown\"));\n      }).catch(function (err) {\n        done(new Error(\"Error not thrown\"));\n      });\n    } catch (err) {\n      err.should.have.property(\"code\", \"key_length_too_short\");\n      done();\n    }\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"should handle non-existent sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":36,"column":41,"index":1225},"line":36,"code":"  it('should handle non-existent sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.false();\n    localfilesystemSessions.getSessions().then(function (sessions) {\n      sessions.should.eql({});\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle corrupt sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":49,"column":36,"index":1635},"line":49,"code":"  it('should handle corrupt sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    fs.writeFileSync(sessionsFile, \"[This is not json\", \"utf8\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.true();\n    localfilesystemSessions.getSessions().then(function (sessions) {\n      sessions.should.eql({});\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":63,"column":28,"index":2101},"line":63,"code":"  it('should handle sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.false();\n    var sessions = {\n      \"abc\": {\n        \"type\": \"creds\"\n      }\n    };\n    localfilesystemSessions.saveSessions(sessions).then(function () {\n      fs.existsSync(sessionsFile).should.be.true();\n      localfilesystemSessions.getSessions().then(function (_sessions) {\n        _sessions.should.eql(sessions);\n\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle non-existent settings","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":36,"column":41,"index":1231},"line":36,"code":"  it('should handle non-existent settings', function (done) {\n    var settingsFile = path.join(userDir, \".config.json\");\n    localfilesystemSettings.init({\n      userDir: userDir\n    }).then(function () {\n      fs.existsSync(settingsFile).should.be.false();\n      return localfilesystemSettings.getSettings();\n    }).then(function (settings) {\n      settings.should.eql({});\n      done();\n    }).catch(err => {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should migrate single config.json to multiple files","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":50,"column":57,"index":1689},"line":50,"code":"  it('should migrate single config.json to multiple files', function (done) {\n    var settingsFile = path.join(userDir, \".config.json\");\n    fs.writeFileSync(settingsFile, JSON.stringify({\n      nodes: {\n        a: 1\n      },\n      _credentialSecret: \"foo\",\n      users: {\n        b: 2\n      },\n      projects: {\n        c: 3\n      }\n    }), \"utf8\");\n\n    async function checkFile(sectionName, expectedContents) {\n      const file = path.join(userDir, \".config.\" + sectionName + \".json\");\n      fs.existsSync(file).should.be.true();\n      var contents = await fs.readFile(file, 'utf8');\n      var data = JSON.parse(contents);\n      data.should.eql(expectedContents);\n    }\n\n    localfilesystemSettings.init({\n      userDir: userDir\n    }).then(async function () {\n      // (For now) leave the old settings file in place\n      fs.existsSync(settingsFile).should.be.true();\n      await checkFile(\"nodes\", {\n        a: 1\n      });\n      await checkFile(\"users\", {\n        b: 2\n      });\n      await checkFile(\"projects\", {\n        c: 3\n      });\n      await checkFile(\"runtime\", {\n        _credentialSecret: \"foo\"\n      });\n      done();\n    }).catch(err => {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should load separate settings file","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":95,"column":40,"index":2860},"line":95,"code":"  it('should load separate settings file', async function () {\n    await fs.writeFile(path.join(userDir, \".config.nodes.json\"), JSON.stringify({\n      a: 1\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.users.json\"), JSON.stringify({\n      b: 2\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.projects.json\"), JSON.stringify({\n      c: 3\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.runtime.json\"), JSON.stringify({\n      _credentialSecret: \"foo\"\n    }), \"utf8\");\n    return localfilesystemSettings.init({\n      userDir: userDir\n    }).then(localfilesystemSettings.getSettings).then(settings => {\n      settings.should.eql({\n        nodes: {\n          a: 1\n        },\n        _credentialSecret: \"foo\",\n        users: {\n          b: 2\n        },\n        projects: {\n          c: 3\n        }\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should write only the files that need writing","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":125,"column":51,"index":3749},"line":125,"code":"  it('should write only the files that need writing', async function () {\n    await fs.writeFile(path.join(userDir, \".config.nodes.json\"), JSON.stringify({\n      a: 1\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.users.json\"), JSON.stringify({\n      b: 2\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.projects.json\"), JSON.stringify({\n      c: 3\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.runtime.json\"), JSON.stringify({\n      _credentialSecret: \"foo\"\n    }), \"utf8\");\n    const fsStatNodes = await fs.stat(path.join(userDir, \".config.nodes.json\"));\n    const fsStatUsers = await fs.stat(path.join(userDir, \".config.users.json\"));\n    const fsStatProjects = await fs.stat(path.join(userDir, \".config.projects.json\"));\n    const fsStatRuntime = await fs.stat(path.join(userDir, \".config.runtime.json\"));\n    return localfilesystemSettings.init({\n      userDir: userDir\n    }).then(function () {\n      return new Promise(res => {\n        setTimeout(function () {\n          res();\n        }, 10);\n      });\n    }).then(() => {\n      return localfilesystemSettings.saveSettings({\n        nodes: {\n          d: 4\n        },\n        _credentialSecret: \"bar\",\n        users: {\n          b: 2\n        },\n        projects: {\n          c: 3\n        }\n      });\n    }).then(async function () {\n      const newFsStatNodes = await fs.stat(path.join(userDir, \".config.nodes.json\"));\n      const newFsStatUsers = await fs.stat(path.join(userDir, \".config.users.json\"));\n      const newFsStatProjects = await fs.stat(path.join(userDir, \".config.projects.json\"));\n      const newFsStatRuntime = await fs.stat(path.join(userDir, \".config.runtime.json\")); // Not changed\n\n      newFsStatUsers.mtimeMs.should.eql(fsStatUsers.mtimeMs);\n      newFsStatProjects.mtimeMs.should.eql(fsStatProjects.mtimeMs); // Changed\n\n      newFsStatNodes.mtimeMs.should.not.eql(fsStatNodes.mtimeMs);\n      newFsStatRuntime.mtimeMs.should.not.eql(fsStatRuntime.mtimeMs);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns parsed JSON","suites":["storage/localfilesystem/util","parseJSON"],"updatePoint":{"line":24,"column":27,"index":925},"line":24,"code":"    it('returns parsed JSON', function () {\n      var result = util.parseJSON('{\"a\":123}');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores BOM character","suites":["storage/localfilesystem/util","parseJSON"],"updatePoint":{"line":30,"column":29,"index":1078},"line":30,"code":"    it('ignores BOM character', function () {\n      var result = util.parseJSON('\\uFEFF{\"a\":123}');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/util_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["node-red/red"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/util/index_spec.js","skipped":true,"dir":"test"},{"name":"can be required without errors","suites":["@node-red/util/events"],"updatePoint":{"line":21,"column":36,"index":800},"line":21,"code":"  it('can be required without errors', function () {\n    NR_TEST_UTILS.require(\"@node-red/util/lib/events\");\n  });","file":"unit/@node-red/util/lib/events_spec.js","skipped":false,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util/events"],"line":24,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/events_spec.js","skipped":true,"dir":"test"},{"name":"runs command and resolves on success - no emit","suites":["runtime/exec"],"updatePoint":{"line":62,"column":52,"index":1804},"line":62,"code":"  it(\"runs command and resolves on success - no emit\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function (result) {\n      command.should.eql(mockProcess._args.command);\n      args.should.eql(mockProcess._args.args);\n      opts.should.eql(mockProcess._args.options);\n      logEvents.length.should.eql(0);\n      result.code.should.eql(0);\n      result.stdout.should.eql(\"123\");\n      result.stderr.should.eql(\"abc\");\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 0);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and resolves on success - emit","suites":["runtime/exec"],"updatePoint":{"line":86,"column":49,"index":2647},"line":86,"code":"  it(\"runs command and resolves on success - emit\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts, true).then(function (result) {\n      logEvents.length.should.eql(8);\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 0);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and rejects on error - close","suites":["runtime/exec"],"updatePoint":{"line":104,"column":47,"index":3233},"line":104,"code":"  it(\"runs command and rejects on error - close\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function () {\n      done(\"Command should have rejected\");\n    }).catch(function (result) {\n      result;\n      result.code.should.eql(123);\n      result.stdout.should.eql(\"123\");\n      result.stderr.should.eql(\"abc\");\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 123);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and rejects on error - error","suites":["runtime/exec"],"updatePoint":{"line":127,"column":47,"index":3975},"line":127,"code":"  it(\"runs command and rejects on error - error\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function () {\n      done(\"Command should have rejected\");\n    }).catch(function (result) {\n      result;\n      result.code.should.eql(456);\n      result.stdout.should.eql(\"\");\n      result.stderr.should.eql(\"test-error\");\n      done();\n    }).catch(done);\n    mockProcess.emit('error', \"test-error\");\n    mockProcess.emit('close', 456);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to be registered","suites":["util/hooks"],"updatePoint":{"line":11,"column":36,"index":275},"line":11,"code":"  it(\"allows a hook to be registered\", function (done) {\n    let calledWith = null;\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend\", function (payload) {\n      calledWith = payload;\n    });\n    hooks.has(\"onSend\").should.be.true();\n    let data = {\n      a: 1\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      calledWith.should.equal(data);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid hook id","suites":["util/hooks"],"updatePoint":{"line":26,"column":29,"index":664},"line":26,"code":"  it(\"rejects invalid hook id\", function (done) {\n    try {\n      hooks.add(\"foo\", function (payload) {});\n      done(new Error(\"Invalid hook accepted\"));\n    } catch (err) {\n      done();\n    }\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"calls hooks in the order they were registered","suites":["util/hooks"],"updatePoint":{"line":34,"column":51,"index":887},"line":34,"code":"  it(\"calls hooks in the order they were registered\", function (done) {\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"does not allow multiple hooks with same id.label","suites":["util/hooks"],"updatePoint":{"line":49,"column":54,"index":1285},"line":49,"code":"  it(\"does not allow multiple hooks with same id.label\", function () {\n    hooks.has(\"onSend.one\").should.be.false();\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend.one\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.has(\"onSend.one\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    (function () {\n      hooks.add(\"onSend.one\", function (payload) {\n        payload.order.push(\"B\");\n      });\n    }).should.throw();\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"removes labelled hook","suites":["util/hooks"],"updatePoint":{"line":63,"column":27,"index":1737},"line":63,"code":"  it(\"removes labelled hook\", function (done) {\n    hooks.has(\"onSend.A\").should.be.false();\n    hooks.has(\"onSend.B\").should.be.false();\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.has(\"onSend.A\").should.be.true();\n    hooks.has(\"onSend.B\").should.be.false();\n    hooks.has(\"onSend\").should.be.true();\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    hooks.has(\"onSend.A\").should.be.true();\n    hooks.has(\"onSend.B\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    hooks.remove(\"onSend.A\");\n    hooks.has(\"onSend.A\").should.be.false();\n    hooks.has(\"onSend.B\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        data.order.should.eql([\"B\"]);\n        hooks.remove(\"onSend.B\");\n        hooks.has(\"onSend.A\").should.be.false();\n        hooks.has(\"onSend.B\").should.be.false();\n        hooks.has(\"onSend\").should.be.false();\n        done(err);\n      } catch (err2) {\n        done(err2);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"cannot remove unlabelled hook","suites":["util/hooks"],"updatePoint":{"line":99,"column":35,"index":2916},"line":99,"code":"  it(\"cannot remove unlabelled hook\", function () {\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    (function () {\n      hooks.remove(\"onSend\");\n    }).should.throw();\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"removes all hooks with same label","suites":["util/hooks"],"updatePoint":{"line":107,"column":39,"index":3134},"line":107,"code":"  it(\"removes all hooks with same label\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    hooks.add(\"preRoute.A\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"preRoute.B\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      hooks.trigger(\"preRoute\", data, err => {\n        data.order.should.eql([\"A\", \"B\", \"C\", \"D\"]);\n        data.order = [];\n        hooks.remove(\"*.A\");\n        hooks.trigger(\"onSend\", data, err => {\n          data.order.should.eql([\"B\"]);\n          hooks.trigger(\"preRoute\", data, err => {\n            data.order.should.eql([\"B\", \"D\"]);\n          });\n          done(err);\n        });\n      });\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to remove itself whilst being called","suites":["util/hooks"],"updatePoint":{"line":139,"column":56,"index":4093},"line":139,"code":"  it(\"allows a hook to remove itself whilst being called\", function (done) {\n    let data = {\n      order: []\n    };\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      hooks.remove(\"*.B\");\n    });\n    hooks.add(\"onSend.C\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"onSend.D\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        should.not.exist(err);\n        data.order.should.eql([\"A\", \"C\", \"D\"]);\n        done();\n      } catch (e) {\n        done(e);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to remove itself and others whilst being called","suites":["util/hooks"],"updatePoint":{"line":165,"column":67,"index":4770},"line":165,"code":"  it(\"allows a hook to remove itself and others whilst being called\", function (done) {\n    let data = {\n      order: []\n    };\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      hooks.remove(\"*.B\");\n      hooks.remove(\"*.C\");\n    });\n    hooks.add(\"onSend.C\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"onSend.D\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        should.not.exist(err);\n        data.order.should.eql([\"A\", \"D\"]);\n        done();\n      } catch (e) {\n        done(e);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"halts execution on return false","suites":["util/hooks"],"updatePoint":{"line":192,"column":37,"index":5439},"line":192,"code":"  it(\"halts execution on return false\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n      return false;\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      err.should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"halts execution on thrown error","suites":["util/hooks"],"updatePoint":{"line":209,"column":37,"index":5865},"line":209,"code":"  it(\"halts execution on thrown error\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n      throw new Error(\"error\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function","suites":["util/hooks"],"updatePoint":{"line":227,"column":39,"index":6334},"line":227,"code":"  it(\"handler can use callback function\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done();\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - halt execution","suites":["util/hooks"],"updatePoint":{"line":245,"column":56,"index":6807},"line":245,"code":"  it(\"handler can use callback function - halt execution\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done(false);\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      err.should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - halt on error","suites":["util/hooks"],"updatePoint":{"line":264,"column":55,"index":7305},"line":264,"code":"  it(\"handler can use callback function - halt on error\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        done(new Error(\"test error\"));\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function","suites":["util/hooks"],"updatePoint":{"line":283,"column":34,"index":7793},"line":283,"code":"  it(\"handler be an async function\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise(resolve => {\n        setTimeout(function () {\n          payload.order.push(\"A\");\n          resolve();\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function - halt execution","suites":["util/hooks"],"updatePoint":{"line":303,"column":51,"index":8320},"line":303,"code":"  it(\"handler be an async function - halt execution\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise(resolve => {\n        setTimeout(function () {\n          payload.order.push(\"A\");\n          resolve(false);\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function - halt on error","suites":["util/hooks"],"updatePoint":{"line":323,"column":50,"index":8846},"line":323,"code":"  it(\"handler be an async function - halt on error\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise((resolve, reject) => {\n        setTimeout(function () {\n          reject(new Error(\"test error\"));\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - promise API","suites":["util/hooks"],"updatePoint":{"line":344,"column":53,"index":9419},"line":344,"code":"  it(\"handler can use callback function - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done();\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can halt execution - promise API","suites":["util/hooks"],"updatePoint":{"line":362,"column":46,"index":9895},"line":362,"code":"  it(\"handler can halt execution - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done(false);\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      data.order.should.eql([\"A\"]);\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can halt execution on error - promise API","suites":["util/hooks"],"updatePoint":{"line":380,"column":55,"index":10380},"line":380,"code":"  it(\"handler can halt execution on error - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      throw new Error(\"error\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      done(\"hooks.trigger resolved unexpectedly\");\n    }).catch(err => {\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util/i18n"],"line":21,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/i18n_spec.js","skipped":true,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util"],"line":17,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/index_spec.js","skipped":true,"dir":"test"},{"name":"it can raise an error","suites":["@node-red/util/log"],"updatePoint":{"line":42,"column":27,"index":1218},"line":42,"code":"  it('it can raise an error', function () {\n    var ret = log.error(\"This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a trace","suites":["@node-red/util/log"],"updatePoint":{"line":46,"column":26,"index":1384},"line":46,"code":"  it('it can raise a trace', function () {\n    var ret = log.trace(\"This is a trace\");\n    sinon.assert.calledWithMatch(util.log, \"[trace] This is a trace\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a debug","suites":["@node-red/util/log"],"updatePoint":{"line":50,"column":26,"index":1548},"line":50,"code":"  it('it can raise a debug', function () {\n    var ret = log.debug(\"This is a debug\");\n    sinon.assert.calledWithMatch(util.log, \"[debug] This is a debug\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a info","suites":["@node-red/util/log"],"updatePoint":{"line":54,"column":25,"index":1711},"line":54,"code":"  it('it can raise a info', function () {\n    var ret = log.info(\"This is an info\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a warn","suites":["@node-red/util/log"],"updatePoint":{"line":58,"column":25,"index":1872},"line":58,"code":"  it('it can raise a warn', function () {\n    var ret = log.warn(\"This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a metric","suites":["@node-red/util/log"],"updatePoint":{"line":62,"column":27,"index":2033},"line":62,"code":"  it('it can raise a metric', function () {\n    var metrics = {};\n    metrics.level = log.METRIC;\n    metrics.nodeid = \"testid\";\n    metrics.event = \"node.test.testevent\";\n    metrics.msgid = \"12345\";\n    metrics.value = \"the metric payload\";\n    var ret = log.log(metrics);\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[metric] \").should.equal(0);\n    var body = JSON.parse(util.log.firstCall.args[0].substring(9));\n    body.should.have.a.property(\"nodeid\", \"testid\");\n    body.should.have.a.property(\"event\", \"node.test.testevent\");\n    body.should.have.a.property(\"msgid\", \"12345\");\n    body.should.have.a.property(\"value\", \"the metric payload\");\n    body.should.have.a.property(\"timestamp\");\n    body.should.have.a.property(\"level\", log.METRIC);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it checks metrics are enabled","suites":["@node-red/util/log"],"updatePoint":{"line":80,"column":35,"index":2834},"line":80,"code":"  it('it checks metrics are enabled', function () {\n    log.metric().should.equal(true);\n    var sett = {\n      logging: {\n        console: {\n          level: 'info',\n          metrics: false\n        }\n      }\n    };\n    log.init(sett);\n    log.metric().should.equal(false);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it logs node type and name if provided","suites":["@node-red/util/log"],"updatePoint":{"line":93,"column":44,"index":3124},"line":93,"code":"  it('it logs node type and name if provided', function () {\n    log.log({\n      level: log.INFO,\n      type: \"nodeType\",\n      msg: \"test\",\n      name: \"nodeName\",\n      id: \"nodeId\"\n    });\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[nodeType:nodeName]\").should.not.equal(-1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it logs node type and id if no name provided","suites":["@node-red/util/log"],"updatePoint":{"line":104,"column":50,"index":3454},"line":104,"code":"  it('it logs node type and id if no name provided', function () {\n    log.log({\n      level: log.INFO,\n      type: \"nodeType\",\n      msg: \"test\",\n      id: \"nodeId\"\n    });\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[nodeType:nodeId]\").should.not.equal(-1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"ignores lower level messages and metrics","suites":["@node-red/util/log"],"updatePoint":{"line":114,"column":46,"index":3754},"line":114,"code":"  it('ignores lower level messages and metrics', function () {\n    var settings = {\n      logging: {\n        console: {\n          level: 'warn',\n          metrics: false\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"ignores lower level messages but accepts metrics","suites":["@node-red/util/log"],"updatePoint":{"line":140,"column":54,"index":4656},"line":140,"code":"  it('ignores lower level messages but accepts metrics', function () {\n    var settings = {\n      logging: {\n        console: {\n          level: 'log',\n          metrics: true\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.calledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"default settings set to INFO and metrics off","suites":["@node-red/util/log"],"updatePoint":{"line":166,"column":50,"index":5542},"line":166,"code":"  it('default settings set to INFO and metrics off', function () {\n    log.init({\n      logging: {}\n    });\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"no logger used if custom logger handler does not exist","suites":["@node-red/util/log"],"updatePoint":{"line":186,"column":60,"index":6330},"line":186,"code":"  it('no logger used if custom logger handler does not exist', function () {\n    var settings = {\n      logging: {\n        customLogger: {\n          level: 'trace',\n          metrics: true\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.neverCalledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"add a custom log handler directly","suites":["@node-red/util/log"],"updatePoint":{"line":212,"column":39,"index":7232},"line":212,"code":"  it('add a custom log handler directly', function () {\n    var settings = {};\n    log.init(settings);\n    var logEvents = [];\n    var loggerOne = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 1,\n          msg: msg\n        });\n      }\n    };\n    var loggerTwo = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 2,\n          msg: msg\n        });\n      }\n    };\n    log.addHandler(loggerOne);\n    log.addHandler(loggerTwo);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(6);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(6);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"remove a custom log handler directly","suites":["@node-red/util/log"],"updatePoint":{"line":250,"column":42,"index":8171},"line":250,"code":"  it('remove a custom log handler directly', function () {\n    var settings = {};\n    log.init(settings);\n    var logEvents = [];\n    var loggerOne = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 1,\n          msg: msg\n        });\n      }\n    };\n    var loggerTwo = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 2,\n          msg: msg\n        });\n      }\n    };\n    log.addHandler(loggerOne);\n    log.addHandler(loggerTwo);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(1);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n    log.removeHandler(loggerTwo);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(2);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n    log.removeHandler(loggerOne);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(2);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can log without exception","suites":["@node-red/util/log"],"updatePoint":{"line":296,"column":34,"index":9434},"line":296,"code":"  it('it can log without exception', function () {\n    var msg = {\n      msg: {\n        mystrangeobj: \"hello\"\n      }\n    };\n\n    msg.msg.toString = function () {\n      throw new Error('Exception in toString - should have been caught');\n    };\n\n    msg.msg.constructor = {\n      name: \"strangeobj\"\n    };\n    var ret = log.info(msg.msg);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can log an object but use .message","suites":["@node-red/util/log"],"updatePoint":{"line":312,"column":43,"index":9787},"line":312,"code":"  it('it can log an object but use .message', function () {\n    var msg = {\n      msg: {\n        message: \"my special message\",\n        mystrangeobj: \"hello\"\n      }\n    };\n    var ret = log.info(msg.msg);\n    sinon.assert.calledWithMatch(util.log, \"my special message\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"generates an id","suites":["@node-red/util/util","generateId"],"updatePoint":{"line":24,"column":23,"index":882},"line":24,"code":"    it('generates an id', function () {\n      var id = util.generateId();\n      var id2 = util.generateId();\n      id.should.not.eql(id2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"numbers","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":31,"column":15,"index":1070},"line":31,"code":"    it('numbers', function () {\n      util.compareObjects(0, 0).should.equal(true);\n      util.compareObjects(0, 1).should.equal(false);\n      util.compareObjects(1000, 1001).should.equal(false);\n      util.compareObjects(1000, 1000).should.equal(true);\n      util.compareObjects(0, \"0\").should.equal(false);\n      util.compareObjects(1, \"1\").should.equal(false);\n      util.compareObjects(0, null).should.equal(false);\n      util.compareObjects(0, undefined).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"strings","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":41,"column":15,"index":1559},"line":41,"code":"    it('strings', function () {\n      util.compareObjects(\"\", \"\").should.equal(true);\n      util.compareObjects(\"a\", \"a\").should.equal(true);\n      util.compareObjects(\"\", null).should.equal(false);\n      util.compareObjects(\"\", undefined).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"arrays","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":47,"column":14,"index":1827},"line":47,"code":"    it('arrays', function () {\n      util.compareObjects([\"a\"], [\"a\"]).should.equal(true);\n      util.compareObjects([\"a\"], [\"a\", \"b\"]).should.equal(false);\n      util.compareObjects([\"a\", \"b\"], [\"b\"]).should.equal(false);\n      util.compareObjects([\"a\"], \"a\").should.equal(false);\n      util.compareObjects([[1], [\"a\"]], [[1], [\"a\"]]).should.equal(true);\n      util.compareObjects([[1], [\"a\"]], [[\"a\"], [1]]).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"objects","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":55,"column":15,"index":2267},"line":55,"code":"    it('objects', function () {\n      util.compareObjects({\n        \"a\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(false);\n      util.compareObjects({\n        \"a\": 1,\n        \"b\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(true);\n      util.compareObjects({\n        \"b\": 1,\n        \"a\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffer","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":77,"column":14,"index":2681},"line":77,"code":"    it('Buffer', function () {\n      util.compareObjects(Buffer.from(\"hello\"), Buffer.from(\"hello\")).should.equal(true);\n      util.compareObjects(Buffer.from(\"hello\"), Buffer.from(\"hello \")).should.equal(false);\n      util.compareObjects(Buffer.from(\"hello\"), \"hello\").should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"strings are preserved","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":84,"column":29,"index":3042},"line":84,"code":"    it('strings are preserved', function () {\n      util.ensureString('string').should.equal('string');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffer is converted","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":87,"column":27,"index":3152},"line":87,"code":"    it('Buffer is converted', function () {\n      var s = util.ensureString(Buffer.from('foo'));\n      s.should.equal('foo');\n      (typeof s).should.equal('string');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Object is converted to JSON","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":92,"column":35,"index":3335},"line":92,"code":"    it('Object is converted to JSON', function () {\n      var s = util.ensureString({\n        foo: \"bar\"\n      });\n      (typeof s).should.equal('string');\n      should.deepEqual(JSON.parse(s), {\n        foo: \"bar\"\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"stringifies other things","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":101,"column":32,"index":3565},"line":101,"code":"    it('stringifies other things', function () {\n      var s = util.ensureString(123);\n      (typeof s).should.equal('string');\n      s.should.equal('123');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffers are preserved","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":108,"column":29,"index":3774},"line":108,"code":"    it('Buffers are preserved', function () {\n      var b = Buffer.from('');\n      util.ensureBuffer(b).should.equal(b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"string is converted","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":112,"column":27,"index":3901},"line":112,"code":"    it('string is converted', function () {\n      var b = util.ensureBuffer('foo');\n      var expected = Buffer.from('foo');\n\n      for (var i = 0; i < expected.length; i++) {\n        b[i].should.equal(expected[i]);\n      }\n\n      Buffer.isBuffer(b).should.equal(true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Object is converted to JSON","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":122,"column":35,"index":4187},"line":122,"code":"    it('Object is converted to JSON', function () {\n      var obj = {\n        foo: \"bar\"\n      };\n      var b = util.ensureBuffer(obj);\n      Buffer.isBuffer(b).should.equal(true);\n      should.deepEqual(JSON.parse(b), obj);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"stringifies other things","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":130,"column":32,"index":4417},"line":130,"code":"    it('stringifies other things', function () {\n      var b = util.ensureBuffer(123);\n      Buffer.isBuffer(b).should.equal(true);\n      var expected = Buffer.from('123');\n\n      for (var i = 0; i < expected.length; i++) {\n        b[i].should.equal(expected[i]);\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"clones a simple message","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":141,"column":31,"index":4743},"line":141,"code":"    it('clones a simple message', function () {\n      var msg = {\n        string: \"hi\",\n        array: [1, 2, 3],\n        object: {\n          a: 1,\n          subobject: {\n            b: 2\n          }\n        }\n      };\n      var cloned = util.cloneMessage(msg);\n      cloned.should.eql(msg);\n      cloned.should.not.equal(msg);\n      cloned.array.should.not.equal(msg.string);\n      cloned.object.should.not.equal(msg.object);\n      cloned.object.subobject.should.not.equal(msg.object.subobject);\n      cloned.should.not.have.property(\"req\");\n      cloned.should.not.have.property(\"res\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not clone http req/res properties","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":161,"column":46,"index":5355},"line":161,"code":"    it('does not clone http req/res properties', function () {\n      var msg = {\n        req: {\n          a: 1\n        },\n        res: {\n          b: 2\n        }\n      };\n      var cloned = util.cloneMessage(msg);\n      cloned.should.eql(msg);\n      cloned.should.not.equal(msg);\n      cloned.req.should.equal(msg.req);\n      cloned.res.should.equal(msg.res);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles undefined values without throwing an error","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":176,"column":58,"index":5735},"line":176,"code":"    it('handles undefined values without throwing an error', function () {\n      var result = util.cloneMessage(undefined);\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"gets a property beginning with \"msg.\"","suites":["@node-red/util/util","getObjectProperty"],"updatePoint":{"line":182,"column":45,"index":5938},"line":182,"code":"    it('gets a property beginning with \"msg.\"', function () {\n      // getMessageProperty strips off `msg.` prefixes.\n      // getObjectProperty does not\n      var obj = {\n        msg: {\n          a: \"foo\"\n        },\n        a: \"bar\"\n      };\n      var v = util.getObjectProperty(obj, \"msg.a\");\n      v.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a simple property","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":196,"column":35,"index":6311},"line":196,"code":"    it('retrieves a simple property', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\"\n      }, \"msg.a\");\n      v.should.eql(\"foo\");\n      var v2 = util.getMessageProperty({\n        a: \"foo\"\n      }, \"a\");\n      v2.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a nested property","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":206,"column":35,"index":6575},"line":206,"code":"    it('retrieves a nested property', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\",\n        b: {\n          foo: 1,\n          bar: 2\n        }\n      }, \"msg.b[msg.a]\");\n      v.should.eql(1);\n      var v2 = util.getMessageProperty({\n        a: \"bar\",\n        b: {\n          foo: 1,\n          bar: 2\n        }\n      }, \"b[msg.a]\");\n      v2.should.eql(2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should return undefined if property does not exist","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":224,"column":58,"index":6986},"line":224,"code":"    it('should return undefined if property does not exist', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\"\n      }, \"msg.b\");\n      should.not.exist(v);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if property parent does not exist","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":230,"column":60,"index":7174},"line":230,"code":"    it('should throw error if property parent does not exist', function () {\n      /*jshint immed: false */\n      (function () {\n        util.getMessageProperty({\n          a: \"foo\"\n        }, \"msg.a.b.c\");\n      }).should.throw();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a property with array syntax","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":238,"column":46,"index":7400},"line":238,"code":"    it('retrieves a property with array syntax', function () {\n      var v = util.getMessageProperty({\n        a: [\"foo\", \"bar\"]\n      }, \"msg.a[0]\");\n      v.should.eql(\"foo\");\n      var v2 = util.getMessageProperty({\n        a: [null, {\n          b: \"foo\"\n        }]\n      }, \"a[1].b\");\n      v2.should.eql(\"foo\");\n      var v3 = util.getMessageProperty({\n        a: [[[\"foo\"]]]\n      }, \"a[0][0][0]\");\n      v3.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"set a property beginning with \"msg.\"","suites":["@node-red/util/util","setObjectProperty"],"updatePoint":{"line":256,"column":44,"index":7891},"line":256,"code":"    it('set a property beginning with \"msg.\"', function () {\n      // setMessageProperty strips off `msg.` prefixes.\n      // setObjectProperty does not\n      var obj = {};\n      var result = util.setObjectProperty(obj, \"msg.a\", \"bar\");\n      result.should.be.true();\n      obj.should.have.property(\"msg\");\n      obj.msg.should.have.property(\"a\", \"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":267,"column":23,"index":8286},"line":267,"code":"    it('sets a property', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a\", \"bar\");\n      result.should.be.true();\n      msg.a.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a deep level property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":275,"column":34,"index":8516},"line":275,"code":"    it('sets a deep level property', function () {\n      var msg = {\n        a: {\n          b: {\n            c: \"foo\"\n          }\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\");\n      result.should.be.true();\n      msg.a.b.c.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing parent properties by default","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":287,"column":52,"index":8826},"line":287,"code":"    it('creates missing parent properties by default', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\");\n      result.should.be.true();\n      msg.a.b.c.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":295,"column":49,"index":9076},"line":295,"code":"    it('does not create missing parent properties', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of array","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":303,"column":58,"index":9341},"line":303,"code":"    it('does not create missing parent properties of array', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[1].c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of string","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":311,"column":59,"index":9610},"line":311,"code":"    it('does not create missing parent properties of string', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing string property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":319,"column":57,"index":9877},"line":319,"code":"    it('does not set property of existing string property', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing number property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":327,"column":57,"index":10142},"line":327,"code":"    it('does not set property of existing number property', function () {\n      var msg = {\n        a: 123\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of number","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":335,"column":59,"index":10407},"line":335,"code":"    it('does not create missing parent properties of number', function () {\n      var msg = {\n        a: 123\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing boolean property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":343,"column":58,"index":10673},"line":343,"code":"    it('does not set property of existing boolean property', function () {\n      var msg = {\n        a: true\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of boolean","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":351,"column":60,"index":10940},"line":351,"code":"    it('does not create missing parent properties of boolean', function () {\n      var msg = {\n        a: true\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"deletes property if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":359,"column":46,"index":11195},"line":359,"code":"    it('deletes property if value is undefined', function () {\n      var msg = {\n        a: {\n          b: {\n            c: \"foo\"\n          }\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", undefined);\n      result.should.be.true();\n      should.not.exist(msg.a.b.c);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":371,"column":71,"index":11528},"line":371,"code":"    it('does not create missing parent properties if value is undefined', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", undefined);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a property with array syntax","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":379,"column":41,"index":11773},"line":379,"code":"    it('sets a property with array syntax', function () {\n      var msg = {\n        a: {\n          b: [\"foo\", {\n            c: [\"\", \"\"]\n          }]\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[1].c[1]\", \"bar\");\n      result.should.be.true();\n      msg.a.b[1].c[1].should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - final property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":391,"column":55,"index":12110},"line":391,"code":"    it('creates missing array elements - final property', function () {\n      var msg = {\n        a: []\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[2]\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a[2].should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - mid property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":400,"column":53,"index":12397},"line":400,"code":"    it('creates missing array elements - mid property', function () {\n      var msg = {};\n      var result = util.setMessageProperty(msg, \"msg.a[2].b\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a[2].b.should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - multi-arrays","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":407,"column":53,"index":12667},"line":407,"code":"    it('creates missing array elements - multi-arrays', function () {\n      var msg = {};\n      var result = util.setMessageProperty(msg, \"msg.a[2][2]\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a.should.be.instanceOf(Array);\n      msg.a[2].should.have.length(3);\n      msg.a[2].should.be.instanceOf(Array);\n      msg.a[2][2].should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing array elements - mid property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":417,"column":61,"index":13070},"line":417,"code":"    it('does not create missing array elements - mid property', function () {\n      var msg = {\n        a: []\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[1][1]\", \"bar\", false);\n      result.should.be.false();\n      msg.a.should.empty();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing array elements - final property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":425,"column":63,"index":13337},"line":425,"code":"    it('does not create missing array elements - final property', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[2]\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b); // check it has not been misinterpreted\n\n      msg.a.should.not.have.property(\"b[2]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"deletes property inside array if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":435,"column":59,"index":13691},"line":435,"code":"    it('deletes property inside array if value is undefined', function () {\n      var msg = {\n        a: [1, 2, 3]\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[1]\", undefined);\n      result.should.be.true();\n      msg.a.should.have.length(2);\n      msg.a[0].should.eql(1);\n      msg.a[1].should.eql(3);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles nested message property references","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":445,"column":50,"index":14012},"line":445,"code":"    it('handles nested message property references', function () {\n      var obj = {\n        a: \"foo\",\n        b: {}\n      };\n      var result = util.setObjectProperty(obj, \"b[msg.a]\", \"bar\");\n      result.should.be.true();\n      obj.b.should.have.property(\"foo\", \"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles nested message property references","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":454,"column":50,"index":14292},"line":454,"code":"    it('handles nested message property references', function () {\n      var obj = {\n        a: \"foo\",\n        b: {\n          \"foo\": [0, 0, 0]\n        }\n      };\n      var result = util.setObjectProperty(obj, \"b[msg.a][2]\", \"bar\");\n      result.should.be.true();\n      obj.b.foo.should.eql([0, 0, \"bar\"]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns string","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":467,"column":22,"index":14633},"line":467,"code":"    it('returns string', function () {\n      var result = util.evaluateNodeProperty('hello', 'str');\n      result.should.eql('hello');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns number","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":471,"column":22,"index":14776},"line":471,"code":"    it('returns number', function () {\n      var result = util.evaluateNodeProperty('0123', 'num');\n      result.should.eql(123);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns evaluated json","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":475,"column":30,"index":14922},"line":475,"code":"    it('returns evaluated json', function () {\n      var result = util.evaluateNodeProperty('{\"a\":123}', 'json');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns regex","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":481,"column":21,"index":15086},"line":481,"code":"    it('returns regex', function () {\n      var result = util.evaluateNodeProperty('^abc$', 're');\n      result.toString().should.eql(\"/^abc$/\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns boolean","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":485,"column":23,"index":15242},"line":485,"code":"    it('returns boolean', function () {\n      var result = util.evaluateNodeProperty('true', 'bool');\n      result.should.be.true();\n      result = util.evaluateNodeProperty('TrUe', 'bool');\n      result.should.be.true();\n      result = util.evaluateNodeProperty('false', 'bool');\n      result.should.be.false();\n      result = util.evaluateNodeProperty('', 'bool');\n      result.should.be.false();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns date","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":495,"column":20,"index":15646},"line":495,"code":"    it('returns date', function () {\n      var result = util.evaluateNodeProperty('', 'date');\n      (Date.now() - result).should.be.approximately(0, 50);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns bin","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":499,"column":19,"index":15808},"line":499,"code":"    it('returns bin', function () {\n      var result = util.evaluateNodeProperty('[1, 2]', 'bin');\n      result[0].should.eql(1);\n      result[1].should.eql(2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if buffer data is not array or string","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":504,"column":61,"index":16019},"line":504,"code":"    it('throws an error if buffer data is not array or string', function (done) {\n      try {\n        var result = util.evaluateNodeProperty('12', 'bin');\n        done(\"should throw an error\");\n      } catch (err) {\n        if (err.code === \"INVALID_BUFFER_DATA\") {\n          done();\n        } else {\n          done(\"should throw an error\");\n        }\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns msg property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":516,"column":28,"index":16354},"line":516,"code":"    it('returns msg property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'msg', {}, {\n        foo: {\n          bar: \"123\"\n        }\n      });\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if callback is not defined","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":524,"column":50,"index":16586},"line":524,"code":"    it('throws an error if callback is not defined', function (done) {\n      try {\n        util.evaluateNodeProperty(' ', 'msg', {}, {\n          foo: {\n            bar: \"123\"\n          }\n        });\n        done(\"should throw an error\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns flow property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":536,"column":29,"index":16857},"line":536,"code":"    it('returns flow property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'flow', {\n        context: function () {\n          return {\n            flow: {\n              get: function (k) {\n                if (k === 'foo.bar') {\n                  return '123';\n                } else {\n                  return null;\n                }\n              }\n            }\n          };\n        }\n      }, {});\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns global property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":554,"column":31,"index":17327},"line":554,"code":"    it('returns global property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'global', {\n        context: function () {\n          return {\n            global: {\n              get: function (k) {\n                if (k === 'foo.bar') {\n                  return '123';\n                } else {\n                  return null;\n                }\n              }\n            }\n          };\n        }\n      }, {});\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns jsonata result","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":572,"column":30,"index":17800},"line":572,"code":"    it('returns jsonata result', function () {\n      var result = util.evaluateNodeProperty('$abs(-1)', 'jsonata', {}, {});\n      result.should.eql(1);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns null","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":576,"column":20,"index":17950},"line":576,"code":"    it('returns null', function () {\n      var result = util.evaluateNodeProperty(null, 'null');\n      (result === null).should.be.true();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - NR_TEST_A","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":589,"column":53,"index":18417},"line":589,"code":"      it('returns an environment variable - NR_TEST_A', function () {\n        var result = util.evaluateNodeProperty('NR_TEST_A', 'env');\n        result.should.eql('foo');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - ${NR_TEST_A}","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":593,"column":56,"index":18602},"line":593,"code":"      it('returns an environment variable - ${NR_TEST_A}', function () {\n        var result = util.evaluateNodeProperty('${NR_TEST_A}', 'env');\n        result.should.eql('foo');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - ${NR_TEST_A","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":597,"column":55,"index":18789},"line":597,"code":"      it('returns an environment variable - ${NR_TEST_A', function () {\n        var result = util.evaluateNodeProperty('${NR_TEST_A', 'env');\n        result.should.eql('');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - foo${NR_TEST_A}bar","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":601,"column":62,"index":18979},"line":601,"code":"      it('returns an environment variable - foo${NR_TEST_A}bar', function () {\n        var result = util.evaluateNodeProperty('123${NR_TEST_A}456', 'env');\n        result.should.eql('123foo456');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - foo${NR_TEST_B}bar","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":605,"column":62,"index":19185},"line":605,"code":"      it('returns an environment variable - foo${NR_TEST_B}bar', function () {\n        var result = util.evaluateNodeProperty('123${NR_TEST_B}456', 'env');\n        result.should.eql('123${NR_TEST_A}456');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":640,"column":18,"index":20245},"line":640,"code":"    it('pass a.b.c', function () {\n      testABC('a.b.c', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"b\"][\"c\"]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":643,"column":24,"index":20335},"line":643,"code":"    it('pass a[\"b\"][\"c\"]', function () {\n      testABC('a[\"b\"][\"c\"]', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":646,"column":21,"index":20428},"line":646,"code":"    it('pass a[\"b\"].c', function () {\n      testABC('a[\"b\"].c', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['b'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":649,"column":21,"index":20518},"line":649,"code":"    it(\"pass a['b'].c\", function () {\n      testABC(\"a['b'].c\", ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[0].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":652,"column":19,"index":20606},"line":652,"code":"    it(\"pass a[0].c\", function () {\n      testABC(\"a[0].c\", ['a', 0, 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.0.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":655,"column":18,"index":20689},"line":655,"code":"    it(\"pass a.0.c\", function () {\n      testABC(\"a.0.c\", ['a', 0, 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['a.b[0]'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":658,"column":26,"index":20779},"line":658,"code":"    it(\"pass a['a.b[0]'].c\", function () {\n      testABC(\"a['a.b[0]'].c\", ['a', 'a.b[0]', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[0][0][0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":661,"column":23,"index":20881},"line":661,"code":"    it(\"pass a[0][0][0]\", function () {\n      testABC(\"a[0][0][0]\", ['a', 0, 0, 0]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass '1.2.3.4'","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":664,"column":22,"index":20973},"line":664,"code":"    it(\"pass '1.2.3.4'\", function () {\n      testABC(\"'1.2.3.4'\", ['1.2.3.4']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass 'a.b'[1]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":667,"column":21,"index":21060},"line":667,"code":"    it(\"pass 'a.b'[1]\", function () {\n      testABC(\"'a.b'[1]\", ['a.b', 1]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass 'a.b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":670,"column":20,"index":21144},"line":670,"code":"    it(\"pass 'a.b'.c\", function () {\n      testABC(\"'a.b'.c\", ['a.b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":673,"column":21,"index":21230},"line":673,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg[msg.b]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":676,"column":26,"index":21329},"line":676,"code":"    it(\"pass a[msg[msg.b]]\", function () {\n      testABC(\"a[msg[msg.b]]\", [\"a\", [\"msg\", [\"msg\", \"b\"]]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":679,"column":21,"index":21437},"line":679,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":682,"column":21,"index":21531},"line":682,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg['b]\"[']]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":685,"column":28,"index":21632},"line":685,"code":"    it(\"pass a[msg['b]\\\"[']]\", function () {\n      testABC(\"a[msg['b]\\\"[']]\", [\"a\", [\"msg\", \"b]\\\"[\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg['b][']]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":688,"column":26,"index":21742},"line":688,"code":"    it(\"pass a[msg['b][']]\", function () {\n      testABC(\"a[msg['b][']]\", [\"a\", [\"msg\", \"b][\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass b[msg.a][2]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":691,"column":24,"index":21846},"line":691,"code":"    it(\"pass b[msg.a][2]\", function () {\n      testABC(\"b[msg.a][2]\", [\"b\", [\"msg\", \"a\"], 2]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass b[msg.a][2] (with message)","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":694,"column":39,"index":21964},"line":694,"code":"    it(\"pass b[msg.a][2] (with message)\", function () {\n      testABCWithMessage(\"b[msg.a][2]\", {\n        a: \"foo\"\n      }, [\"b\", \"foo\", 2]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.$b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":699,"column":19,"index":22094},"line":699,"code":"    it('pass a.$b.c', function () {\n      testABC('a.$b.c', ['a', '$b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"$b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":702,"column":22,"index":22184},"line":702,"code":"    it('pass a[\"$b\"].c', function () {\n      testABC('a[\"$b\"].c', ['a', '$b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a._b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":705,"column":19,"index":22274},"line":705,"code":"    it('pass a._b.c', function () {\n      testABC('a._b.c', ['a', '_b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"_b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":708,"column":22,"index":22364},"line":708,"code":"    it('pass a[\"_b\"].c', function () {\n      testABC('a[\"_b\"].c', ['a', '_b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['a.b[0]'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":711,"column":26,"index":22461},"line":711,"code":"    it(\"pass a['a.b[0]'].c\", function () {\n      testToString(\"a['a.b[0]'].c\", null, 'a[\"a.b[0]\"][\"c\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":714,"column":18,"index":22567},"line":714,"code":"    it(\"pass a.b.c\", function () {\n      testToString(\"a.b.c\", null, 'a[\"b\"][\"c\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.c][0][\"fred\"]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":717,"column":32,"index":22674},"line":717,"code":"    it('pass a[msg.c][0][\"fred\"]', function () {\n      testToString('a[msg.c][0][\"fred\"]', {\n        c: \"123\"\n      }, 'a[\"123\"][0][\"fred\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a'b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":722,"column":19,"index":22812},"line":722,"code":"    it(\"fail a'b'.c\", function () {\n      testInvalid(\"a'b'.c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":725,"column":20,"index":22886},"line":725,"code":"    it(\"fail a['b'.c\", function () {\n      testInvalid(\"a['b'.c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":728,"column":16,"index":22957},"line":728,"code":"    it(\"fail a[]\", function () {\n      testInvalid(\"a[]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":731,"column":15,"index":23023},"line":731,"code":"    it(\"fail a]\", function () {\n      testInvalid(\"a]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":734,"column":15,"index":23088},"line":734,"code":"    it(\"fail a[\", function () {\n      testInvalid(\"a[\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0d]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":737,"column":18,"index":23156},"line":737,"code":"    it(\"fail a[0d]\", function () {\n      testInvalid(\"a[0d]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":740,"column":16,"index":23225},"line":740,"code":"    it(\"fail a['\", function () {\n      testInvalid(\"a['\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":743,"column":17,"index":23293},"line":743,"code":"    it(\"fail a[']\", function () {\n      testInvalid(\"a[']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":746,"column":18,"index":23363},"line":746,"code":"    it(\"fail a[0']\", function () {\n      testInvalid(\"a[0']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a.[0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":749,"column":18,"index":23434},"line":749,"code":"    it(\"fail a.[0]\", function () {\n      testInvalid(\"a.[0]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail [0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":752,"column":16,"index":23503},"line":752,"code":"    it(\"fail [0]\", function () {\n      testInvalid(\"[0]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":755,"column":16,"index":23570},"line":755,"code":"    it(\"fail a[0\", function () {\n      testInvalid(\"a[0\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a.","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":758,"column":15,"index":23636},"line":758,"code":"    it(\"fail a.\", function () {\n      testInvalid(\"a.\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail .a","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":761,"column":15,"index":23701},"line":761,"code":"    it(\"fail .a\", function () {\n      testInvalid(\".a\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a. b","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":764,"column":17,"index":23768},"line":764,"code":"    it(\"fail a. b\", function () {\n      testInvalid(\"a. b\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail  a.b","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":767,"column":17,"index":23837},"line":767,"code":"    it(\"fail  a.b\", function () {\n      testInvalid(\" a.b\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0].[1]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":770,"column":21,"index":23910},"line":770,"code":"    it(\"fail a[0].[1]\", function () {\n      testInvalid(\"a[0].[1]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":773,"column":18,"index":23984},"line":773,"code":"    it(\"fail a['']\", function () {\n      testInvalid(\"a['']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail 'a.b'c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":776,"column":19,"index":24056},"line":776,"code":"    it(\"fail 'a.b'c\", function () {\n      testInvalid(\"'a.b'c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail <blank>","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":779,"column":20,"index":24130},"line":779,"code":"    it(\"fail <blank>\", function () {\n      testInvalid(\"\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":782,"column":17,"index":24195},"line":782,"code":"    it(\"fail a[b]\", function () {\n      testInvalid(\"a[b]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg.]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":785,"column":20,"index":24267},"line":785,"code":"    it(\"fail a[msg.]\", function () {\n      testInvalid(\"a[msg.]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg[]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":788,"column":20,"index":24342},"line":788,"code":"    it(\"fail a[msg[]\", function () {\n      testInvalid(\"a[msg[]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg.[]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":791,"column":22,"index":24419},"line":791,"code":"    it(\"fail a[msg.[]]\", function () {\n      testInvalid(\"a[msg.[]]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg['af]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":794,"column":24,"index":24500},"line":794,"code":"    it(\"fail a[msg['af]]\", function () {\n      testInvalid(\"a[msg['af]]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail b[msg.undefined][2] (with message)","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":797,"column":47,"index":24606},"line":797,"code":"    it(\"fail b[msg.undefined][2] (with message)\", function () {\n      testInvalid(\"b[msg.undefined][2]\", {});\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass blank","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":807,"column":18,"index":24889},"line":807,"code":"    it('pass blank', function () {\n      normalise(\"\", \"\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass ab1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":810,"column":16,"index":24955},"line":810,"code":"    it('pass ab1', function () {\n      normalise(\"ab1\", \"ab1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass AB1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":813,"column":16,"index":25027},"line":813,"code":"    it('pass AB1', function () {\n      normalise(\"AB1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a b 1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":816,"column":18,"index":25101},"line":816,"code":"    it('pass a b 1', function () {\n      normalise(\"a b 1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a-b-1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":819,"column":18,"index":25177},"line":819,"code":"    it('pass a-b-1', function () {\n      normalise(\"a-b-1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass  ab1 ","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":822,"column":18,"index":25253},"line":822,"code":"    it('pass  ab1 ', function () {\n      normalise(\" ab1 \", \"ab1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass _a_b_1_","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":825,"column":20,"index":25331},"line":825,"code":"    it('pass _a_b_1_', function () {\n      normalise(\"_a_b_1_\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass http request","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":828,"column":25,"index":25416},"line":828,"code":"    it('pass http request', function () {\n      normalise(\"http request\", \"httpRequest\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass HttpRequest","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":831,"column":24,"index":25513},"line":831,"code":"    it('pass HttpRequest', function () {\n      normalise(\"HttpRequest\", \"httpRequest\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"prepares an expression","suites":["@node-red/util/util","prepareJSONataExpression"],"updatePoint":{"line":836,"column":30,"index":25674},"line":836,"code":"    it('prepares an expression', function () {\n      var result = util.prepareJSONataExpression('payload', {});\n      result.should.have.property('evaluate');\n      result.should.have.property('assign');\n      result.should.have.property('_legacyMode', false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"prepares a legacyMode expression","suites":["@node-red/util/util","prepareJSONataExpression"],"updatePoint":{"line":842,"column":40,"index":25953},"line":842,"code":"    it('prepares a legacyMode expression', function () {\n      var result = util.prepareJSONataExpression('msg.payload', {});\n      result.should.have.property('evaluate');\n      result.should.have.property('assign');\n      result.should.have.property('_legacyMode', true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"evaluates an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":850,"column":31,"index":26286},"line":850,"code":"    it('evaluates an expression', function () {\n      var expr = util.prepareJSONataExpression('payload', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"hello\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"evaluates a legacyMode expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":857,"column":41,"index":26542},"line":857,"code":"    it('evaluates a legacyMode expression', function () {\n      var expr = util.prepareJSONataExpression('msg.payload', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"hello\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses flow context from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":864,"column":48,"index":26809},"line":864,"code":"    it('accesses flow context from an expression', function () {\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses undefined environment variable from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":883,"column":66,"index":27346},"line":883,"code":"    it('accesses undefined environment variable from an expression', function () {\n      var expr = util.prepareJSONataExpression('$env(\"UTIL_ENV\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses environment variable from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":888,"column":56,"index":27589},"line":888,"code":"    it('accesses environment variable from an expression', function () {\n      process.env.UTIL_ENV = 'foo';\n      var expr = util.prepareJSONataExpression('$env(\"UTIL_ENV\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('foo');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses moment from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":894,"column":42,"index":27857},"line":894,"code":"    it('accesses moment from an expression', function () {\n      var expr = util.prepareJSONataExpression('$moment(\"2020-05-27\", \"YYYY-MM-DD\").add(7, \"days\").add(1, \"months\").format(\"YYYY-MM-DD\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('2020-07-03');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses moment-timezone from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":899,"column":51,"index":28177},"line":899,"code":"    it('accesses moment-timezone from an expression', function () {\n      var expr = util.prepareJSONataExpression('$moment(\"2013-11-18 11:55Z\").tz(\"Asia/Taipei\").format()', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('2013-11-18T19:55:00+08:00');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles non-existant flow context variable","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":904,"column":50,"index":28478},"line":904,"code":"    it('handles non-existant flow context variable', function () {\n      var expr = util.prepareJSONataExpression('$flowContext(\"nonExistant\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles non-existant global context variable","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":923,"column":52,"index":29009},"line":923,"code":"    it('handles non-existant global context variable', function () {\n      var expr = util.prepareJSONataExpression('$globalContext(\"nonExistant\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles async flow context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":942,"column":41,"index":29533},"line":942,"code":"    it('handles async flow context access', function (done) {\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key, store, callback) {\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles async global context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":970,"column":43,"index":30287},"line":970,"code":"    it('handles async global context access', function (done) {\n      var expr = util.prepareJSONataExpression('$globalContext(\"foo\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key, store, callback) {\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles persistable store in flow context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":998,"column":56,"index":31058},"line":998,"code":"    it('handles persistable store in flow context access', function (done) {\n      var storeName;\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\", \"flowStoreName\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key, store, callback) {\n                storeName = store;\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          storeName.should.equal(\"flowStoreName\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles persistable store in global context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":1029,"column":58,"index":31951},"line":1029,"code":"    it('handles persistable store in global context access', function (done) {\n      var storeName;\n      var expr = util.prepareJSONataExpression('$globalContext(\"foo\", \"globalStoreName\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key, store, callback) {\n                storeName = store;\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          storeName.should.equal(\"globalStoreName\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"callbacks with error when invalid expression was specified","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":1060,"column":66,"index":32860},"line":1060,"code":"    it('callbacks with error when invalid expression was specified', function (done) {\n      var expr = util.prepareJSONataExpression('$abc(1)', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        should.exist(err);\n        done();\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Error with message","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1071,"column":34,"index":33202},"line":1071,"code":"    it('encodes Error with message', function () {\n      var err = new Error(\"encode error\");\n      err.name = 'encodeError';\n      var msg = {\n        msg: err\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"error\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.name.should.eql('encodeError');\n      resultJson.message.should.eql('encode error');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Error without message","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1083,"column":37,"index":33616},"line":1083,"code":"    it('encodes Error without message', function () {\n      var err = new Error();\n      err.name = 'encodeError';\n\n      err.toString = function () {\n        return 'error message';\n      };\n\n      var msg = {\n        msg: err\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"error\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.name.should.eql('encodeError');\n      resultJson.message.should.eql('error message');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Buffer","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1100,"column":22,"index":34080},"line":1100,"code":"    it('encodes Buffer', function () {\n      var msg = {\n        msg: Buffer.from(\"abc\")\n      };\n      var result = util.encodeObject(msg, {\n        maxLength: 4\n      });\n      result.format.should.eql(\"buffer[3]\");\n      result.msg[0].should.eql('6');\n      result.msg[1].should.eql('1');\n      result.msg[2].should.eql('6');\n      result.msg[3].should.eql('2');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes function","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1113,"column":24,"index":34456},"line":1113,"code":"    it('encodes function', function () {\n      var msg = {\n        msg: function () {}\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"function\");\n      result.msg.should.eql('[function]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes boolean","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1121,"column":23,"index":34689},"line":1121,"code":"    it('encodes boolean', function () {\n      var msg = {\n        msg: true\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"boolean\");\n      result.msg.should.eql('true');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes number","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1129,"column":22,"index":34904},"line":1129,"code":"    it('encodes number', function () {\n      var msg = {\n        msg: 123\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"number\");\n      result.msg.should.eql('123');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes 0","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1137,"column":17,"index":35111},"line":1137,"code":"    it('encodes 0', function () {\n      var msg = {\n        msg: 0\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"number\");\n      result.msg.should.eql('0');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes null","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1145,"column":20,"index":35317},"line":1145,"code":"    it('encodes null', function () {\n      var msg = {\n        msg: null\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"null\");\n      result.msg.should.eql('(undefined)');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes undefined","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1153,"column":25,"index":35539},"line":1153,"code":"    it('encodes undefined', function () {\n      var msg = {\n        msg: undefined\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"undefined\");\n      result.msg.should.eql('(undefined)');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes string","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1161,"column":22,"index":35768},"line":1161,"code":"    it('encodes string', function () {\n      var msg = {\n        msg: '1234567890'\n      };\n      var result = util.encodeObject(msg, {\n        maxLength: 6\n      });\n      result.format.should.eql(\"string[10]\");\n      result.msg.should.eql('123456...');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Map","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1171,"column":19,"index":36028},"line":1171,"code":"    it('encodes Map', function () {\n      const m = new Map();\n      m.set(\"a\", 1);\n      m.set(\"b\", 2);\n      var msg = {\n        msg: m\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"map\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.should.have.property(\"__enc__\", true);\n      resultJson.should.have.property(\"type\", \"map\");\n      resultJson.should.have.property(\"data\", {\n        \"a\": 1,\n        \"b\": 2\n      });\n      resultJson.should.have.property(\"length\", 2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Set","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1189,"column":19,"index":36563},"line":1189,"code":"    it('encodes Set', function () {\n      const m = new Set();\n      m.add(\"a\");\n      m.add(\"b\");\n      var msg = {\n        msg: m\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"set[2]\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.should.have.property(\"__enc__\", true);\n      resultJson.should.have.property(\"type\", \"set\");\n      resultJson.should.have.property(\"data\", [\"a\", \"b\"]);\n      resultJson.should.have.property(\"length\", 2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1205,"column":16,"index":37106},"line":1205,"code":"      it('object', function () {\n        var msg = {\n          msg: {\n            \"foo\": \"bar\"\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.foo.should.eql('bar');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object whose name includes error","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1216,"column":42,"index":37440},"line":1216,"code":"      it('object whose name includes error', function () {\n        function MyErrorObj() {\n          this.name = 'my error obj';\n          this.message = 'my error message';\n        }\n\n        ;\n        var msg = {\n          msg: new MyErrorObj()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"MyErrorObj\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.name.should.eql('my error obj');\n        resultJson.message.should.eql('my error message');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with undefined property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1232,"column":40,"index":37959},"line":1232,"code":"      it('object with undefined property', function () {\n        var msg = {\n          msg: {\n            a: 1,\n            b: undefined,\n            c: 3\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"a\", 1);\n        resultJson.should.have.property(\"c\", 3);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"__enc__\", true);\n        resultJson.b.should.have.property(\"type\", \"undefined\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with no prototype builtins","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1249,"column":43,"index":38556},"line":1249,"code":"      it('object with no prototype builtins', function () {\n        const payload = new Object(null);\n        payload.c = 3;\n        var msg = {\n          msg: {\n            b: payload\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"c\", 3);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with overriden hasOwnProperty","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1263,"column":46,"index":39012},"line":1263,"code":"      it('object with overriden hasOwnProperty', function () {\n        var msg = {\n          msg: {\n            b: {\n              hasOwnProperty: null\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"hasOwnProperty\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with Map property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1277,"column":34,"index":39444},"line":1277,"code":"      it('object with Map property', function () {\n        const m = new Map();\n        m.set(\"a\", 1);\n        m.set(\"b\", 2);\n        var msg = {\n          msg: {\n            \"aMap\": m\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"aMap\");\n        resultJson.aMap.should.have.property(\"__enc__\", true);\n        resultJson.aMap.should.have.property(\"type\", \"map\");\n        resultJson.aMap.should.have.property(\"data\", {\n          \"a\": 1,\n          \"b\": 2\n        });\n        resultJson.aMap.should.have.property(\"length\", 2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with Set property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1298,"column":34,"index":40134},"line":1298,"code":"      it('object with Set property', function () {\n        const m = new Set();\n        m.add(\"a\");\n        m.add(\"b\");\n        var msg = {\n          msg: {\n            \"aSet\": m\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"aSet\");\n        resultJson.aSet.should.have.property(\"__enc__\", true);\n        resultJson.aSet.should.have.property(\"type\", \"set\");\n        resultJson.aSet.should.have.property(\"data\", [\"a\", \"b\"]);\n        resultJson.aSet.should.have.property(\"length\", 2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of IncomingMessage","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1316,"column":40,"index":40788},"line":1316,"code":"      it('constructor of IncomingMessage', function () {\n        function IncomingMessage() {}\n\n        ;\n        var msg = {\n          msg: new IncomingMessage()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.empty();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"_req key in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1328,"column":25,"index":41130},"line":1328,"code":"      it('_req key in msg', function () {\n        function Socket() {}\n\n        ;\n        var msg = {\n          msg: {\n            \"_req\": 123\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson._req.__enc__.should.eql(true);\n\n        resultJson._req.type.should.eql('internal');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"_res key in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1345,"column":25,"index":41549},"line":1345,"code":"      it('_res key in msg', function () {\n        function Socket() {}\n\n        ;\n        var msg = {\n          msg: {\n            \"_res\": 123\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson._res.__enc__.should.eql(true);\n\n        resultJson._res.type.should.eql('internal');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of error","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1362,"column":24,"index":41967},"line":1362,"code":"      it('array of error', function () {\n        var msg = {\n          msg: [new Error(\"encode error\")]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[1]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql('Error: encode error');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"long array in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1371,"column":27,"index":42292},"line":1371,"code":"      it('long array in msg', function () {\n        var msg = {\n          msg: {\n            array: [1, 2, 3, 4]\n          }\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson.array.__enc__.should.eql(true);\n\n        resultJson.array.data[0].should.eql(1);\n        resultJson.array.data[1].should.eql(2);\n        resultJson.array.length.should.eql(4);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of string","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1389,"column":25,"index":42806},"line":1389,"code":"      it('array of string', function () {\n        var msg = {\n          msg: [\"abcde\", \"12345\"]\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 3\n        });\n        result.format.should.eql(\"array[2]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql('abc...');\n        resultJson[1].should.eql('123...');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array containing undefined","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1401,"column":36,"index":43198},"line":1401,"code":"      it('array containing undefined', function () {\n        var msg = {\n          msg: [1, undefined, 3]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql(1);\n        resultJson[2].should.eql(3);\n\n        resultJson[1].__enc__.should.be.true();\n\n        resultJson[1].type.should.eql(\"undefined\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of function","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1415,"column":27,"index":43632},"line":1415,"code":"      it('array of function', function () {\n        var msg = {\n          msg: [function () {}]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[1]\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson[0].__enc__.should.eql(true);\n\n        resultJson[0].type.should.eql('function');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of number","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1427,"column":25,"index":43988},"line":1427,"code":"      it('array of number', function () {\n        var msg = {\n          msg: [1, 2, 3]\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson.__enc__.should.eql(true);\n\n        resultJson.data[0].should.eql(1);\n        resultJson.data[1].should.eql(2);\n        resultJson.data.length.should.eql(2);\n        resultJson.length.should.eql(3);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of special number","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1444,"column":33,"index":44498},"line":1444,"code":"      it('array of special number', function () {\n        var msg = {\n          msg: [NaN, Infinity, -Infinity]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson[0].__enc__.should.eql(true);\n\n        resultJson[0].type.should.eql('number');\n        resultJson[0].data.should.eql('NaN');\n        resultJson[1].data.should.eql('Infinity');\n        resultJson[2].data.should.eql('-Infinity');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of Buffer in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1459,"column":38,"index":45024},"line":1459,"code":"      it('constructor of Buffer in msg', function () {\n        var msg = {\n          msg: {\n            buffer: Buffer.from([1, 2, 3, 4])\n          }\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n\n        resultJson.buffer.__enc__.should.eql(true);\n\n        resultJson.buffer.length.should.eql(4);\n        resultJson.buffer.data[0].should.eql(1);\n        resultJson.buffer.data[1].should.eql(2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of ServerResponse","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1477,"column":39,"index":45570},"line":1477,"code":"      it('constructor of ServerResponse', function () {\n        function ServerResponse() {}\n\n        ;\n        var msg = {\n          msg: new ServerResponse()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.eql('[internal]');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of Socket in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1489,"column":38,"index":45933},"line":1489,"code":"      it('constructor of Socket in msg', function () {\n        function Socket() {}\n\n        ;\n        var msg = {\n          msg: {\n            socket: new Socket()\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.socket.should.eql('[internal]');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object which fails to serialise","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1503,"column":41,"index":46324},"line":1503,"code":"      it('object which fails to serialise', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw 'this exception should have been caught';\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var success = result.msg.indexOf('cantserialise') > 0;\n        success &= result.msg.indexOf('this exception should have been caught') > 0;\n        success &= result.msg.indexOf('canserialise') > 0;\n        success.should.eql(1);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object which fails to serialise - different error type","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1528,"column":64,"index":47250},"line":1528,"code":"      it('object which fails to serialise - different error type', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw new Error('this exception should have been caught');\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var success = result.msg.indexOf('cantserialise') > 0;\n        success &= result.msg.indexOf('this exception should have been caught') > 0;\n        success &= result.msg.indexOf('canserialise') > 0;\n        success.should.eql(1);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"very large object which fails to serialise should be truncated","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1553,"column":72,"index":48195},"line":1553,"code":"      it('very large object which fails to serialise should be truncated', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              big: \"\",\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw new Error('this exception should have been caught');\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n\n        for (var i = 0; i < 1000; i++) {\n          msg.msg.obj.big += 'some more string ';\n        }\n\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var resultJson = JSON.parse(result.msg);\n        var success = resultJson.message.length <= 1000;\n        success.should.eql(true);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"test bad toString","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1583,"column":27,"index":49123},"line":1583,"code":"      it('test bad toString', function (done) {\n        var msg = {\n          msg: {\n            mystrangeobj: \"hello\"\n          }\n        };\n\n        msg.msg.toString = function () {\n          throw new Error('Exception in toString - should have been caught');\n        };\n\n        msg.msg.constructor = {\n          name: \"strangeobj\"\n        };\n        var result = util.encodeObject(msg);\n        var success = result.msg.indexOf('[Type not printable]') >= 0;\n        success.should.eql(true);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"test bad object constructor","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1602,"column":37,"index":49655},"line":1602,"code":"      it('test bad object constructor', function (done) {\n        var msg = {\n          msg: {\n            mystrangeobj: \"hello\",\n            constructor: {\n              get name() {\n                throw new Error('Exception in constructor name');\n              }\n\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"reports version","suites":["red/red","externals"],"updatePoint":{"line":61,"column":23,"index":2110},"line":61,"code":"    it('reports version', function () {\n      /\\d+\\.\\d+\\.\\d+(-git)?/.test(RED.version()).should.be.true();\n    });","file":"unit/node-red/lib/red_spec.js","skipped":false,"dir":"test"},{"name":"access server externals","suites":["red/red","externals"],"line":64,"code":"    it.skip('access server externals', function () {// TODO: unstubable accessors - need to make this testable","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"only initialises api component if httpAdmin enabled","suites":["red/red","externals"],"line":70,"code":"    it.skip('only initialises api component if httpAdmin enabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"stubs httpAdmin if httpAdmin disabled","suites":["red/red","externals"],"line":71,"code":"    it.skip('stubs httpAdmin if httpAdmin disabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"stubs httpNode if httpNode disabled","suites":["red/red","externals"],"line":72,"code":"    it.skip('stubs httpNode if httpNode disabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["node-red/red"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/node-red/red_spec.js","skipped":true,"dir":"test"}]}