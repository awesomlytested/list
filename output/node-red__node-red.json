{"repo":"node-red/node-red","url":"https://github.com/node-red/node-red","branch":"master","configs":[{"package":"node-red","lang":"js","dir":"test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"inject value of environment variable ","suites":["inject node"],"updatePoint":{"line":93,"column":43,"index":2776},"line":93,"code":"  it('inject value of environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"NR_TEST\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"foo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      process.env.NR_TEST = 'foo';\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of node as environment variable ","suites":["inject node"],"updatePoint":{"line":122,"column":50,"index":3500},"line":122,"code":"  it('inject name of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"NAME\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of node as environment variable ","suites":["inject node"],"updatePoint":{"line":150,"column":48,"index":4163},"line":150,"code":"  it('inject id of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject path of node as environment variable ","suites":["inject node"],"updatePoint":{"line":178,"column":50,"index":4824},"line":178,"code":"  it('inject path of node as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_NODE_PATH\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow/n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":206,"column":50,"index":5492},"line":206,"code":"  it('inject name of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_FLOW_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      label: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"FLOW\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":238,"column":48,"index":6221},"line":238,"code":"  it('inject id of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_FLOW_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      name: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of group as environment variable ","suites":["inject node"],"updatePoint":{"line":270,"column":51,"index":6950},"line":270,"code":"  it('inject name of group as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_GROUP_NAME\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"GROUP\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of group as environment variable ","suites":["inject node"],"updatePoint":{"line":303,"column":49,"index":7697},"line":303,"code":"  it('inject id of group as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"NR_GROUP_ID\",\n      payloadType: \"env\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"g0\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":336,"column":66,"index":8456},"line":336,"code":"  it('inject name of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"NAME\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":364,"column":64,"index":9138},"line":364,"code":"  it('inject id of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject path of node as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":392,"column":66,"index":9818},"line":392,"code":"  it('inject path of node as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_NODE_PATH}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow/n1\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of flow as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":420,"column":66,"index":10505},"line":420,"code":"  it('inject name of flow as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_FLOW_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      label: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"FLOW\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of flow as environment variable ","suites":["inject node"],"updatePoint":{"line":452,"column":48,"index":11237},"line":452,"code":"  it('inject id of flow as environment variable ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_FLOW_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"flow\",\n      type: \"tab\",\n      name: \"FLOW\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"flow\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject name of group as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":484,"column":67,"index":11985},"line":484,"code":"  it('inject name of group as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_GROUP_NAME}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"GROUP\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"inject id of group as environment variable by substitution ","suites":["inject node"],"updatePoint":{"line":517,"column":65,"index":12751},"line":517,"code":"  it('inject id of group as environment variable by substitution ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      name: \"NAME\",\n      topnic: \"t1\",\n      payload: \"${NR_GROUP_ID}\",\n      payloadType: \"str\",\n      wires: [[\"n2\"]],\n      z: \"flow\",\n      g: \"g0\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"g0\",\n      type: \"group\",\n      name: \"GROUP\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"g0\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of flow context property","suites":["inject node"],"updatePoint":{"line":550,"column":45,"index":13492},"line":550,"code":"  it('sets the value of flow context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"flowValue\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"changeMe\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.context().flow.set(\"flowValue\", \"changeMe\");\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable flow context property","suites":["inject node"],"updatePoint":{"line":579,"column":57,"index":14250},"line":579,"code":"  it('sets the value of persistable flow context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory0)::flowValue\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\", \"t1\");\n            msg.should.have.property(\"payload\", \"changeMe\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.context().flow.set(\"flowValue\", \"changeMe\", \"memory0\", function (err) {\n          n1.receive({});\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable flow context property","suites":["inject node"],"updatePoint":{"line":611,"column":61,"index":15134},"line":611,"code":"  it('sets the value of two persistable flow context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n            count++;\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().flow;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of global context property","suites":["inject node"],"updatePoint":{"line":667,"column":47,"index":16657},"line":667,"code":"  it('sets the value of global context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"globalValue\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"changeMe\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.context().global.set(\"globalValue\", \"changeMe\");\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable global context property","suites":["inject node"],"updatePoint":{"line":695,"column":59,"index":17408},"line":695,"code":"  it('sets the value of persistable global context property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\", \"t1\");\n            msg.should.have.property(\"payload\", \"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n1.context().global;\n        global.set(\"val\", \"foo\", \"memory1\", function (err) {\n          n1.receive({});\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable global context property","suites":["inject node"],"updatePoint":{"line":729,"column":63,"index":18322},"line":729,"code":"  it('sets the value of two persistable global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n            count++;\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().global;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable flow & global context property","suites":["inject node"],"updatePoint":{"line":785,"column":66,"index":19870},"line":785,"code":"  it('sets the value of persistable flow & global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"flow\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n            count++;\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n0.context();\n        var flow = context.flow;\n        var global = context.global;\n        flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of two persistable global context property","suites":["inject node"],"updatePoint":{"line":843,"column":63,"index":21475},"line":843,"code":"  it('sets the value of two persistable global context property', function (done) {\n    var flow = [{\n      id: \"n0\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t0\",\n      payload: \"#:(memory0)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n1\",\n      z: \"flow\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"#:(memory1)::val\",\n      payloadType: \"global\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"flow\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      initContext(function () {\n        var n0 = helper.getNode(\"n0\");\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"topic\");\n            if (msg.topic === \"t0\") {\n              msg.should.have.property(\"payload\", \"foo\");\n            } else if (msg.topic === \"t1\") {\n              msg.should.have.property(\"payload\", \"bar\");\n            } else {\n              done(new Error(\"unexpected message\"));\n            }\n            count++;\n            if (count === 2) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n0.context().global;\n        global.set(\"val\", \"foo\", \"memory0\", function (err) {\n          global.set(\"val\", \"bar\", \"memory1\", function (err) {\n            n0.receive({});\n            n1.receive({});\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with default delay property","suites":["inject node"],"updatePoint":{"line":899,"column":52,"index":23009},"line":899,"code":"  it('should inject once with default delay property', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('onceDelay', 100);\n      done();\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with default delay","suites":["inject node"],"updatePoint":{"line":917,"column":43,"index":23429},"line":917,"code":"  it('should inject once with default delay', function (done) {\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 't1');\n          msg.should.have.property('payload');\n          should(msg.payload).be.lessThan(timestamp.getTime());\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with 500 msec. delay","suites":["inject node"],"updatePoint":{"line":945,"column":45,"index":24171},"line":945,"code":"  it('should inject once with 500 msec. delay', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      onceDelay: 0.5,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('onceDelay', 500);\n      done();\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with delay of two seconds","suites":["inject node"],"updatePoint":{"line":964,"column":50,"index":24620},"line":964,"code":"  it('should inject once with delay of two seconds', function (done) {\n    this.timeout(2700); // have to wait for the inject with delay of two seconds\n\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      once: true,\n      onceDelay: 2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't1');\n        should(msg.payload).be.greaterThan(timestamp.getTime());\n        done();\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject repeatedly","suites":["inject node"],"updatePoint":{"line":990,"column":30,"index":25330},"line":990,"code":"  it('should inject repeatedly', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      payload: \"payload\",\n      topic: \"t2\",\n      repeat: 0.2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't2');\n        msg.should.have.property('payload', 'payload');\n        count += 1;\n        if (count > 2) {\n          helper.clearFlows().then(function () {\n            done();\n          });\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject once with delay of two seconds and repeatedly","suites":["inject node"],"updatePoint":{"line":1016,"column":65,"index":26002},"line":1016,"code":"  it('should inject once with delay of two seconds and repeatedly', function (done) {\n    var timestamp = new Date();\n    timestamp.setSeconds(timestamp.getSeconds() + 1);\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      topic: \"t1\",\n      payload: \"\",\n      payloadType: \"date\",\n      repeat: 0.2,\n      once: true,\n      onceDelay: 1.2,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }], function () {\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't1');\n        should(msg.payload).be.greaterThan(timestamp.getTime());\n        count += 1;\n        if (count > 2) {\n          helper.clearFlows().then(function () {\n            done();\n          });\n        }\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject with cron","suites":["inject node"],"updatePoint":{"line":1047,"column":29,"index":26793},"line":1047,"code":"  it('should inject with cron', function (done) {\n    helper.load(injectNode, [{\n      id: \"n1\",\n      type: \"inject\",\n      payloadType: \"date\",\n      topic: \"t3\",\n      crontab: \"* * * * * *\",\n      wires: [[\"n3\"]]\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }], function () {\n      var n3 = helper.getNode(\"n3\");\n      n3.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 't3');\n        msg.should.have.property('payload').be.a.Number();\n        helper.clearFlows().then(function () {\n          done();\n        });\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject multiple properties ","suites":["inject node"],"updatePoint":{"line":1069,"column":40,"index":27373},"line":1069,"code":"  it('should inject multiple properties ', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"topic\",\n        v: \"t1\",\n        vt: \"str\"\n      }, {\n        p: \"payload\",\n        v: \"foo\",\n        vt: \"str\"\n      }, {\n        p: \"x\",\n        v: 10,\n        \"vt\": \"num\"\n      }, {\n        p: \"y\",\n        v: \"x+2\",\n        \"vt\": \"jsonata\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.have.property(\"payload\", \"foo\");\n          msg.should.have.property(\"x\", 10);\n          msg.should.have.property(\"y\", 12);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject custom properties in message","suites":["inject node"],"updatePoint":{"line":1113,"column":48,"index":28360},"line":1113,"code":"  it('should inject custom properties in message', function (done) {\n    //n1: inject node with  { topic:\"static\", payload:\"static\", bool1:true, str1:\"1\" }\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"payload\",\n        v: \"static\",\n        vt: \"str\"\n      }, {\n        p: \"topic\",\n        v: \"static\",\n        vt: \"str\"\n      }, {\n        p: \"bool1\",\n        v: \"true\",\n        vt: \"bool\"\n      }, {\n        p: \"str1\",\n        v: \"1\",\n        vt: \"str\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.not.have.property(\"payload\"); //payload removed\n          msg.should.have.property(\"topic\", \"t_override\"); //changed value to t_override\n          msg.should.have.property(\"str1\", 1); //changed type from str to num\n          msg.should.have.property(\"num1\", 1); //new prop\n          msg.should.have.property(\"bool1\", false); //changed value to false\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        __user_inject_props__: [{\n          p: \"topic\",\n          v: \"t_override\",\n          vt: \"str\"\n        },\n        //change value to t_override\n        {\n          p: \"str1\",\n          v: \"1\",\n          vt: \"num\"\n        },\n        //change type\n        {\n          p: \"num1\",\n          v: \"1\",\n          vt: \"num\"\n        },\n        //new prop\n        {\n          p: \"bool1\",\n          v: \"false\",\n          vt: \"bool\"\n        } //change value to false\n        ]\n      });\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject multiple properties using legacy props if needed","suites":["inject node"],"updatePoint":{"line":1185,"column":68,"index":30118},"line":1185,"code":"  it('should inject multiple properties using legacy props if needed', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      payload: \"123\",\n      payloadType: \"num\",\n      topic: \"foo\",\n      props: [{\n        p: \"topic\",\n        vt: \"str\"\n      }, {\n        p: \"payload\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"foo\");\n          msg.should.have.property(\"payload\", 123);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should report invalid JSONata expression","suites":["inject node"],"updatePoint":{"line":1219,"column":46,"index":30895},"line":1219,"code":"  it('should report invalid JSONata expression', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"inject\",\n      props: [{\n        p: \"topic\",\n        v: \"t1\",\n        vt: \"str\"\n      }, {\n        p: \"payload\",\n        v: \"@\",\n        vt: \"jsonata\"\n      }],\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(injectNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"topic\", \"t1\");\n          msg.should.not.have.property(\"payload\");\n          count++;\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.on(\"call:error\", function (err) {\n        count++;\n        if (count == 2) {\n          done();\n        }\n      });\n      n1.receive({});\n    });\n  });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject message","suites":["inject node","post"],"updatePoint":{"line":1264,"column":29,"index":31880},"line":1264,"code":"    it('should inject message', function (done) {\n      helper.load(injectNode, [{\n        id: \"n1\",\n        type: \"inject\",\n        payloadType: \"str\",\n        topic: \"t4\",\n        payload: \"hello\",\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }], function () {\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 't4');\n          msg.should.have.property('payload', 'hello');\n          helper.clearFlows().then(function () {\n            done();\n          });\n        });\n        try {\n          helper.request().post('/inject/n1').expect(200).end(function (err) {\n            if (err) {\n              console.log(err);\n              return helper.clearFlows().then(function () {\n                done(err);\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should inject custom properties in posted message","suites":["inject node","post"],"updatePoint":{"line":1298,"column":57,"index":32843},"line":1298,"code":"    it('should inject custom properties in posted message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"inject\",\n        payloadType: \"str\",\n        topic: \"t4\",\n        payload: \"hello\",\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(injectNode, flow, function () {\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          msg.should.not.have.property(\"payload\"); //payload removed\n          msg.should.have.property(\"topic\", \"t_override\"); //changed value to t_override\n          msg.should.have.property(\"str1\", \"1\"); //injected prop\n          msg.should.have.property(\"num1\", 1); //injected prop\n          msg.should.have.property(\"bool1\", true); //injected prop\n          msg.should.have.property(\"jsonata1\", \"AB\"); //injected prop\n\n          helper.clearFlows().then(function () {\n            done();\n          });\n        });\n        try {\n          helper.request().post('/inject/n1').send({\n            __user_inject_props__: [{\n              p: \"topic\",\n              v: \"t_override\",\n              vt: \"str\"\n            },\n            //change value to t_override\n            {\n              p: \"str1\",\n              v: \"1\",\n              vt: \"str\"\n            },\n            //new prop\n            {\n              p: \"num1\",\n              v: \"1\",\n              vt: \"num\"\n            },\n            //new prop\n            {\n              p: \"bool1\",\n              v: \"true\",\n              vt: \"bool\"\n            },\n            //new prop\n            {\n              p: \"jsonata1\",\n              v: '\"A\" & \"B\"',\n              vt: \"jsonata\"\n            } //new prop\n            ]\n          }).expect(200).end(function (err) {\n            if (err) {\n              console.log(err);\n              return helper.clearFlows().then(function () {\n                done(err);\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should fail for invalid node","suites":["inject node","post"],"updatePoint":{"line":1369,"column":36,"index":34834},"line":1369,"code":"    it('should fail for invalid node', function (done) {\n      helper.request().post('/inject/invalid').expect(404).end(done);\n    });","file":"nodes/core/common/20-inject_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["debug node"],"updatePoint":{"line":36,"column":22,"index":1172},"line":36,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\",\n      complete: \"false\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'Debug');\n      n1.should.have.property('complete', \"payload\");\n      done();\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish on input","suites":["debug node"],"updatePoint":{"line":50,"column":29,"index":1544},"line":50,"code":"  it('should publish on input', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            name: \"Debug\",\n            msg: \"test\",\n            path: \"global\",\n            format: \"string[4]\",\n            property: \"payload\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish to console","suites":["debug node"],"updatePoint":{"line":77,"column":31,"index":2193},"line":77,"code":"  it('should publish to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var count = 0;\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"test\",\n            property: \"payload\",\n            format: \"string[4]\",\n            path: \"global\"\n          }\n        }]);\n        count++;\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: 'n1',\n            type: 'debug',\n            msg: 'test',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message","suites":["debug node"],"updatePoint":{"line":125,"column":37,"index":3452},"line":125,"code":"  it('should publish complete message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"payload\":\"test\"}',\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message to console","suites":["debug node"],"updatePoint":{"line":150,"column":48,"index":4072},"line":150,"code":"  it('should publish complete message to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"true\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"payload\":\"test\"}',\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: '\\n{ payload: \\'test\\' }',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish other property","suites":["debug node"],"updatePoint":{"line":196,"column":35,"index":5312},"line":196,"code":"  it('should publish other property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"foo\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\",\n          foo: \"bar\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"bar\",\n            property: \"foo\",\n            format: \"string[3]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish multi-level properties","suites":["debug node"],"updatePoint":{"line":223,"column":43,"index":5965},"line":223,"code":"  it('should publish multi-level properties', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      complete: \"foo.bar\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\",\n          foo: {\n            bar: \"bar\"\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"bar\",\n            property: \"foo.bar\",\n            format: \"string[3]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an Error","suites":["debug node"],"updatePoint":{"line":252,"column":29,"index":6643},"line":252,"code":"  it('should publish an Error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: new Error(\"oops\")\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"name\":\"Error\",\"message\":\"oops\"}',\n            property: \"payload\",\n            format: \"error\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a boolean","suites":["debug node"],"updatePoint":{"line":277,"column":30,"index":7279},"line":277,"code":"  it('should publish a boolean', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: true\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: 'true',\n            property: \"payload\",\n            format: \"boolean\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a number","suites":["debug node"],"updatePoint":{"line":302,"column":29,"index":7874},"line":302,"code":"  it('should publish a number', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: 7\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"7\",\n            property: \"payload\",\n            format: \"number\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a NaN","suites":["debug node"],"updatePoint":{"line":328,"column":26,"index":8482},"line":328,"code":"  it('should publish a NaN', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Number.NaN\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"NaN\",\n            property: \"payload\",\n            format: \"number\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish with no payload","suites":["debug node"],"updatePoint":{"line":354,"column":36,"index":9111},"line":354,"code":"  it('should publish with no payload', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {});\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '(undefined)',\n            property: \"payload\",\n            format: \"undefined\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a null","suites":["debug node"],"updatePoint":{"line":377,"column":27,"index":9680},"line":377,"code":"  it('should publish a null', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '(undefined)',\n            property: \"payload\",\n            format: \"null\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object","suites":["debug node"],"updatePoint":{"line":402,"column":30,"index":10280},"line":402,"code":"  it('should publish an object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo'\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with no-prototype-builtins","suites":["debug node"],"updatePoint":{"line":429,"column":57,"index":10945},"line":429,"code":"  it('should publish an object with no-prototype-builtins', function (done) {\n    const flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const payload = Object.create(null);\n      payload.type = 'foo';\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: payload\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with overriden hasOwnProperty","suites":["debug node"],"updatePoint":{"line":456,"column":60,"index":11658},"line":456,"code":"  it('should publish an object with overriden hasOwnProperty', function (done) {\n    const flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo',\n            hasOwnProperty: null\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\",\"hasOwnProperty\":null}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an array","suites":["debug node"],"updatePoint":{"line":484,"column":29,"index":12355},"line":484,"code":"  it('should publish an array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: [0, 1, 2, 3]\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '[0,1,2,3]',\n            format: \"array[4]\",\n            property: \"payload\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object with circular references","suites":["debug node"],"updatePoint":{"line":509,"column":55,"index":12990},"line":509,"code":"  it('should publish an object with circular references', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        var o = {\n          name: 'bar'\n        };\n        o.o = o;\n        n1.emit(\"input\", {\n          payload: o\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"name\":\"bar\",\"o\":\"[Circular ~]\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish an object to console","suites":["debug node"],"updatePoint":{"line":538,"column":41,"index":13690},"line":538,"code":"  it('should publish an object to console', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            type: 'foo'\n          }\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"type\":\"foo\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: '\\n{ type: \\'foo\\' }',\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish a string after a newline to console if the string contains \\n","suites":["debug node"],"updatePoint":{"line":586,"column":83,"index":15010},"line":586,"code":"  it('should publish a string after a newline to console if the string contains \\\\n', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      console: \"true\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\\ntest\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"test\\ntest\",\n            property: \"payload\",\n            format: \"string[9]\",\n            path: \"global\"\n          }\n        }]);\n      }, function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"debug\";\n          });\n          logEvents.should.have.length(1);\n          var tstmp = logEvents[0][0].timestamp;\n          logEvents[0][0].should.eql({\n            level: helper.log().INFO,\n            id: \"n1\",\n            type: \"debug\",\n            msg: \"\\ntest\\ntest\",\n            timestamp: tstmp,\n            path: \"global\"\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish complete message with edit","suites":["debug node"],"updatePoint":{"line":632,"column":47,"index":16261},"line":632,"code":"  it('should publish complete message with edit', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      name: \"Debug\",\n      complete: \"true\",\n      targetType: \"jsonata\",\n      complete: '\"<\" & payload & \">\"'\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"test\"\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            name: \"Debug\",\n            msg: \"<test>\",\n            format: \"string[6]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a long message","suites":["debug node"],"updatePoint":{"line":661,"column":36,"index":16976},"line":661,"code":"  it('should truncate a long message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Array(1002).join(\"X\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: Array(1001).join(\"X\") + '...',\n            property: \"payload\",\n            format: \"string[1001]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a long string in the object","suites":["debug node"],"updatePoint":{"line":687,"column":49,"index":17655},"line":687,"code":"  it('should truncate a long string in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Array(1002).join(\"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '{\"foo\":\"' + Array(1001).join(\"X\") + '...\"}',\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large array","suites":["debug node"],"updatePoint":{"line":715,"column":35,"index":18360},"line":715,"code":"  it('should truncate a large array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Array(1001).fill(\"X\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              __enc__: true,\n              type: \"array\",\n              data: Array(1000).fill(\"X\"),\n              length: 1001\n            }),\n            property: \"payload\",\n            format: \"array[1001]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large array in the object","suites":["debug node"],"updatePoint":{"line":746,"column":49,"index":19168},"line":746,"code":"  it('should truncate a large array in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Array(1001).fill(\"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a.should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              foo: {\n                __enc__: true,\n                type: \"array\",\n                data: Array(1000).fill(\"X\"),\n                length: 1001\n              }\n            }),\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large buffer","suites":["debug node"],"updatePoint":{"line":781,"column":36,"index":20034},"line":781,"code":"  it('should truncate a large buffer', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Buffer.alloc(501, \"\\\"\")\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a[0].should.eql({\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: Array(1001).join(\"2\"),\n            property: \"payload\",\n            format: \"buffer[501]\",\n            path: \"global\"\n          }\n        });\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should truncate a large buffer in the object","suites":["debug node"],"updatePoint":{"line":807,"column":50,"index":20708},"line":807,"code":"  it('should truncate a large buffer in the object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: {\n            foo: Buffer.alloc(1001, \"X\")\n          }\n        });\n      }, function (msg) {\n        var a = JSON.parse(msg);\n        a[0].should.eql({\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: JSON.stringify({\n              foo: {\n                type: \"Buffer\",\n                data: Array(1000).fill(88),\n                __enc__: true,\n                length: 1001\n              }\n            }),\n            property: \"payload\",\n            format: \"Object\",\n            path: \"global\"\n          }\n        });\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should convert Buffer to hex","suites":["debug node"],"updatePoint":{"line":842,"column":34,"index":21575},"line":842,"code":"  it('should convert Buffer to hex', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\"\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: Buffer.from('HELLO', 'utf8')\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: '48454c4c4f',\n            property: \"payload\",\n            format: \"buffer[5]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should publish when active","suites":["debug node"],"updatePoint":{"line":867,"column":32,"index":22205},"line":867,"code":"  it('should publish when active', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      active: false\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function () {\n        n1.emit(\"input\", {\n          payload: \"message 1\"\n        });\n        helper.request().post('/debug/n1/enable').expect(200).end(function (err) {\n          if (err) {\n            return done(err);\n          }\n          n1.emit(\"input\", {\n            payload: \"message 2\"\n          });\n        });\n      }, function (msg) {\n        JSON.parse(msg).should.eql([{\n          topic: \"debug\",\n          data: {\n            id: \"n1\",\n            msg: \"message 2\",\n            property: \"payload\",\n            format: \"string[9]\",\n            path: \"global\"\n          }\n        }]);\n      }, done);\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should not publish when inactive","suites":["debug node"],"updatePoint":{"line":901,"column":38,"index":23078},"line":901,"code":"  it('should not publish when inactive', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"debug\",\n      active: true\n    }];\n    helper.load(debugNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      websocket_test(function (close) {\n        helper.request().post('/debug/n1/disable').expect(201).end(function (err) {\n          if (err) {\n            close();\n            return done(err);\n          }\n          n1.emit(\"input\", {\n            payload: \"message\"\n          });\n          setTimeout(function () {\n            close();\n            done();\n          }, 200);\n        });\n      }, function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      }, function () {});\n    });\n  });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 404 on invalid state","suites":["debug node","post"],"updatePoint":{"line":929,"column":42,"index":23850},"line":929,"code":"    it('should return 404 on invalid state', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/n1/foobar').expect(404).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 404 on invalid node","suites":["debug node","post"],"updatePoint":{"line":939,"column":41,"index":24144},"line":939,"code":"    it('should return 404 on invalid node', function (done) {\n      helper.request().post('/debug/n99/enable').expect(404).end(done);\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return 400 for invalid bulk disable","suites":["debug node","post"],"updatePoint":{"line":942,"column":50,"index":24295},"line":942,"code":"    it('should return 400 for invalid bulk disable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/disable').send({}).set('Content-type', 'application/json').expect(400).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return success for bulk disable","suites":["debug node","post"],"updatePoint":{"line":952,"column":46,"index":24641},"line":952,"code":"    it('should return success for bulk disable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\",\n        active: true\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().post('/debug/disable').send({\n          nodes: ['n1']\n        }).set('Content-type', 'application/json').expect(201).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should return the view.html","suites":["debug node","get"],"updatePoint":{"line":966,"column":35,"index":25047},"line":966,"code":"    it('should return the view.html', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"debug\"\n      }];\n      helper.load(debugNode, flow, function () {\n        helper.request().get('/debug/view/view.html').expect(200).end(done);\n      });\n    });","file":"nodes/core/common/21-debug_spec.js","skipped":false,"dir":"test"},{"name":"should output a message when called","suites":["catch Node"],"updatePoint":{"line":24,"column":41,"index":944},"line":24,"code":"  it('should output a message when called', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"catch\",\n      name: \"catch\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(catchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.should.have.property('name', 'catch');\n      n2.on(\"input\", function (msg) {\n        msg.should.be.a.Error();\n        msg.toString().should.equal(\"Error: big error\");\n        done();\n      });\n      var err = new Error(\"big error\");\n      n1.emit(\"input\", err);\n    });\n  });","file":"nodes/core/common/25-catch_spec.js","skipped":false,"dir":"test"},{"name":"should output a message when called","suites":["status Node"],"updatePoint":{"line":24,"column":41,"index":946},"line":24,"code":"  it('should output a message when called', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"status\",\n      name: \"status\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(catchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.should.have.property('name', 'status');\n      n2.on(\"input\", function (msg) {\n        msg.text.should.equal(\"Oh dear\");\n        msg.should.have.property('source');\n        msg.source.should.have.property('id', \"12345\");\n        msg.source.should.have.property('type', \"testnode\");\n        msg.source.should.have.property('name', \"fred\");\n        done();\n      });\n      var mst = {\n        text: \"Oh dear\",\n        source: {\n          id: \"12345\",\n          type: \"testnode\",\n          name: \"fred\"\n        }\n      };\n      n1.emit(\"input\", mst);\n    });\n  });","file":"nodes/core/common/25-status_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded (link in)","suites":["link Node"],"updatePoint":{"line":31,"column":32,"index":1086},"line":31,"code":"  it('should be loaded (link in)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link in\",\n      name: \"link-in\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'link-in');\n      done();\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded (link out)","suites":["link Node"],"updatePoint":{"line":43,"column":33,"index":1388},"line":43,"code":"  it('should be loaded (link out)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'link-out');\n      done();\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked","suites":["link Node"],"updatePoint":{"line":55,"column":22,"index":1682},"line":55,"code":"  it('should be linked', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\",\n      links: [\"n2\"]\n    }, {\n      id: \"n2\",\n      type: \"link in\",\n      name: \"link-in\",\n      wires: [[\"n3\"]]\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n3 = helper.getNode(\"n3\");\n      n3.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked to multiple nodes","suites":["link Node"],"updatePoint":{"line":86,"column":40,"index":2371},"line":86,"code":"  it('should be linked to multiple nodes', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out\",\n      links: [\"n2\", \"n3\"]\n    }, {\n      id: \"n2\",\n      type: \"link in\",\n      name: \"link-in0\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n3\",\n      type: \"link in\",\n      name: \"link-in1\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n4\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n4 = helper.getNode(\"n4\");\n      var count = 0;\n      n4.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          count++;\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be linked from multiple nodes","suites":["link Node"],"updatePoint":{"line":126,"column":42,"index":3245},"line":126,"code":"  it('should be linked from multiple nodes', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"link out\",\n      name: \"link-out0\",\n      links: [\"n3\"]\n    }, {\n      id: \"n2\",\n      type: \"link out\",\n      name: \"link-out1\",\n      links: [\"n3\"]\n    }, {\n      id: \"n3\",\n      type: \"link in\",\n      name: \"link-in\",\n      wires: [[\"n4\"]]\n    }, {\n      id: \"n4\",\n      type: \"helper\"\n    }];\n    helper.load(linkNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n4 = helper.getNode(\"n4\");\n      var count = 0;\n      n4.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('payload', 'hello');\n          count++;\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n      n2.receive({\n        payload: \"hello\"\n      });\n    });\n  });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should call static link-in node and get response","suites":["link Node","link-call node"],"updatePoint":{"line":171,"column":56,"index":4261},"line":171,"code":"    it('should call static link-in node and get response', function (done) {\n      var flow = [{\n        id: \"link-in-1\",\n        type: \"link in\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        type: \"link call\",\n        links: [\"link-in-1\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var func = helper.getNode(\"func\");\n        func.on(\"input\", function (msg, send, done) {\n          msg.payload = \"123\";\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '123');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"hello\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should call link-in node by name and get response","suites":["link Node","link-call node"],"updatePoint":{"line":215,"column":57,"index":5382},"line":215,"code":"    it('should call link-in node by name and get response', function (done) {\n      this.timeout(500);\n      var payload = Date.now();\n      var flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"tab-flow-2\",\n        type: \"tab\",\n        label: \"Flow 2\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-2\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var func = helper.getNode(\"func\");\n        func.on(\"input\", function (msg, send, done) {\n          msg.payload += msg.payload;\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.eql(payload + payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: payload,\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should timeout waiting for link return","suites":["link Node","link-call node"],"updatePoint":{"line":318,"column":46,"index":9238},"line":318,"code":"    it('should timeout waiting for link return', function (done) {\n      this.timeout(1000);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"\"\n      },\n      //not return mode, cause link-call timeout\n      {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"static\",\n        \"timeout\": \"0.5\",\n        links: [\"link-in-1\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCallNode = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, done) {\n          msg.payload += msg.payload;\n          send(msg);\n          done();\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\", \"timeout\");\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCallNode.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should raise error due to multiple targets on same tab","suites":["link Node","link-call node"],"updatePoint":{"line":388,"column":62,"index":11166},"line":388,"code":"    it('should raise error due to multiple targets on same tab', function (done) {\n      this.timeout(55500);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCall = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, _done) {\n          done(new Error(\"Function should not be called\"));\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\");\n            msg.error.message.should.match(/.*Multiple link-in nodes.*/);\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCall.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should raise error due to multiple targets on different tabs","suites":["link Node","link-call node"],"updatePoint":{"line":460,"column":68,"index":13199},"line":460,"code":"    it('should raise error due to multiple targets on different tabs', function (done) {\n      this.timeout(500);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"tab-flow-2\",\n        type: \"tab\",\n        label: \"Flow 2\"\n      }, {\n        id: \"tab-flow-3\",\n        type: \"tab\",\n        label: \"Flow 3\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-2\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-3\",\n        type: \"link in\",\n        name: \"double payload\",\n        wires: [[\"func\"]]\n      }, {\n        id: \"func\",\n        z: \"tab-flow-1\",\n        type: \"helper\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"catch-all\",\n        z: \"tab-flow-1\",\n        type: \"catch\",\n        scope: [\"link-call\"],\n        uncaught: true,\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        const funcNode = helper.getNode(\"func\");\n        const linkCall = helper.getNode(\"link-call\");\n        const helperNode = helper.getNode(\"n4\");\n        funcNode.on(\"input\", function (msg, send, _done) {\n          done(new Error(\"Function should not be called\"));\n        });\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"double payload\");\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"message\");\n            msg.error.message.should.match(/.*Multiple link-in nodes.*/);\n            msg.error.should.have.property(\"source\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        linkCall.receive({\n          payload: \"hello\",\n          target: \"double payload\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should not raise error after deploying a name change to a duplicate link-in node","suites":["link Node","link-call node"],"updatePoint":{"line":540,"column":88,"index":15414},"line":540,"code":"    it('should not raise error after deploying a name change to a duplicate link-in node', async function () {\n      this.timeout(400);\n      const flow = [{\n        id: \"tab-flow-1\",\n        type: \"tab\",\n        label: \"Flow 1\"\n      }, {\n        id: \"link-in-1\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"duplicate\",\n        wires: [[\"link-out-1\"]]\n      }, {\n        id: \"link-in-2\",\n        z: \"tab-flow-1\",\n        type: \"link in\",\n        name: \"duplicate\",\n        wires: [[\"link-out-1\"]]\n      },\n      //duplicate name\n      {\n        id: \"link-out-1\",\n        z: \"tab-flow-1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, {\n        id: \"link-call\",\n        z: \"tab-flow-1\",\n        type: \"link call\",\n        linkType: \"dynamic\",\n        links: [],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        z: \"tab-flow-1\",\n        type: \"helper\"\n      }];\n      await helper.load(linkNode, flow);\n      const linkIn2before = helper.getNode(\"link-in-2\");\n      linkIn2before.should.have.property(\"name\", \"duplicate\"); // check link-in-2 has been deployed with the duplicate name\n\n      //modify the flow and deploy change\n      const newConfig = clone(flow);\n      newConfig[2].name = \"add\"; // change nodes name\n      await helper.setFlows(newConfig, \"nodes\"); // deploy \"nodes\" only\n\n      const helperNode = helper.getNode(\"n4\");\n      const linkCall2 = helper.getNode(\"link-call\");\n      const linkIn2after = helper.getNode(\"link-in-2\");\n      linkIn2after.should.have.property(\"name\", \"add\"); // check link-in-2 no longer has a duplicate name\n\n      //poke { payload: \"hello\", target: \"add\" } into the link-call node and \n      //ensure that a message arrives via the link-in node named \"add\"\n      await new Promise((resolve, reject) => {\n        helperNode.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"target\", \"add\");\n            msg.should.not.have.property(\"error\");\n            resolve();\n          } catch (err) {\n            reject(err);\n          }\n        });\n        linkCall2.receive({\n          payload: \"hello\",\n          target: \"add\"\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should allow nested link-call flows","suites":["link Node","link-call node"],"updatePoint":{"line":609,"column":43,"index":17541},"line":609,"code":"    it('should allow nested link-call flows', function (done) {\n      this.timeout(500);\n      var flow = [/** Multiply by 2 link flow **/\n      {\n        id: \"li1\",\n        type: \"link in\",\n        wires: [[\"m2\"]]\n      }, {\n        id: \"m2\",\n        type: \"helper\",\n        wires: [[\"lo1\"]]\n      }, {\n        id: \"lo1\",\n        type: \"link out\",\n        mode: \"return\"\n      }, /** Multiply by 3 link flow **/\n      {\n        id: \"li2\",\n        type: \"link in\",\n        wires: [[\"m3\"]]\n      }, {\n        id: \"m3\",\n        type: \"helper\",\n        wires: [[\"lo2\"]]\n      }, {\n        id: \"lo2\",\n        type: \"link out\",\n        mode: \"return\"\n      }, /** Multiply by 6 link flow **/\n      {\n        id: \"li3\",\n        type: \"link in\",\n        wires: [[\"link-call-1\"]]\n      }, {\n        id: \"link-call-1\",\n        type: \"link call\",\n        links: [\"li1\"],\n        wires: [[\"link-call-2\"]]\n      }, {\n        id: \"link-call-2\",\n        type: \"link call\",\n        links: [\"li2\"],\n        wires: [[\"lo3\"]]\n      }, {\n        id: \"lo3\",\n        type: \"link out\",\n        mode: \"return\"\n      }, /** Test Flow Entry **/\n      {\n        id: \"link-call\",\n        type: \"link call\",\n        links: [\"li3\"],\n        wires: [[\"n4\"]]\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(linkNode, flow, function () {\n        var m2 = helper.getNode(\"m2\");\n        m2.on(\"input\", function (msg, send, done) {\n          msg.payload *= 2;\n          send(msg);\n          done();\n        });\n        var m3 = helper.getNode(\"m3\");\n        m3.on(\"input\", function (msg, send, done) {\n          msg.payload *= 3;\n          send(msg);\n          done();\n        });\n        var n1 = helper.getNode(\"link-call\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 24);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 4\n        });\n      });\n    });","file":"nodes/core/common/60-link_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["comment Node"],"updatePoint":{"line":24,"column":22,"index":931},"line":24,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"comment\",\n      name: \"comment\"\n    }];\n    helper.load(commentNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'comment');\n      done();\n    });\n  });","file":"nodes/core/common/90-comment_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["unknown Node"],"updatePoint":{"line":24,"column":22,"index":927},"line":24,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"unknown\",\n      name: \"unknown\"\n    }];\n    helper.load(unknown, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'unknown');\n      done();\n    });\n  });","file":"nodes/core/common/98-unknown_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message using send()","suites":["function node"],"updatePoint":{"line":53,"column":47,"index":1631},"line":53,"code":"  it('should send returned message using send()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should do something with the catch node","suites":["function node"],"updatePoint":{"line":77,"column":45,"index":2240},"line":77,"code":"  it('should do something with the catch node', function (done) {\n    var flow = [{\n      \"id\": \"funcNode\",\n      \"type\": \"function\",\n      \"wires\": [[\"goodNode\"]],\n      \"func\": \"node.error('This is an error', msg);\"\n    }, {\n      \"id\": \"goodNode\",\n      \"type\": \"helper\"\n    }, {\n      \"id\": \"badNode\",\n      \"type\": \"helper\"\n    }, {\n      \"id\": \"catchNode\",\n      \"type\": \"catch\",\n      \"scope\": null,\n      \"uncaught\": false,\n      \"wires\": [[\"badNode\"]]\n    }];\n    var catchNodeModule = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/25-catch.js\");\n    helper.load([catchNodeModule, functionNode], flow, function () {\n      var funcNode = helper.getNode(\"funcNode\");\n      var catchNode = helper.getNode(\"catchNode\");\n      var goodNode = helper.getNode(\"goodNode\");\n      var badNode = helper.getNode(\"badNode\");\n      badNode.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('error');\n        msg.error.should.have.property('message', \"This is an error\");\n        msg.error.should.have.property('source');\n        msg.error.source.should.have.property('id', \"funcNode\");\n        done();\n      });\n      funcNode.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["function node"],"updatePoint":{"line":117,"column":22,"index":3548},"line":117,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      name: \"function\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'function');\n      done();\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message","suites":["function node"],"updatePoint":{"line":129,"column":34,"index":3858},"line":129,"code":"  it('should send returned message', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send returned message using send()","suites":["function node"],"updatePoint":{"line":153,"column":47,"index":4465},"line":153,"code":"  it('should send returned message using send()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount","suites":["function node"],"updatePoint":{"line":177,"column":71,"index":5100},"line":177,"code":"  it('should allow accessing node.id and node.name and node.outputCount', function (done) {\n    var flow = [{\n      id: \"n1\",\n      name: \"test-function\",\n      outputs: 2,\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [{ topic: node.name, payload:node.id, outputCount: node.outputCount }];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          // Use this form of assert as `msg` is created inside\n          // the sandbox and doesn't get all the should.js monkey patching\n          should.equal(msg.payload, n1.id);\n          should.equal(msg.topic, n1.name);\n          should.equal(msg.outputCount, n1.outputs);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone single message sent using send()","suites":["function node"],"updatePoint":{"line":238,"column":51,"index":6785},"line":238,"code":"  it('should clone single message sent using send()', function (done) {\n    testSendCloning(\"msg\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should not clone single message sent using send(,false)","suites":["function node"],"updatePoint":{"line":241,"column":61,"index":6907},"line":241,"code":"  it('should not clone single message sent using send(,false)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.send(msg,false); msg.payload = 'changed';\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'changed');\n        done();\n      });\n      var origMessage = {\n        payload: \"foo\",\n        topic: \"bar\"\n      };\n      n1.receive(origMessage);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 1","suites":["function node"],"updatePoint":{"line":266,"column":60,"index":7603},"line":266,"code":"  it('should clone first message sent using send() - array 1', function (done) {\n    testSendCloning(\"[msg]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 2","suites":["function node"],"updatePoint":{"line":269,"column":60,"index":7726},"line":269,"code":"  it('should clone first message sent using send() - array 2', function (done) {\n    testSendCloning(\"[[msg],[null]]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 3","suites":["function node"],"updatePoint":{"line":272,"column":60,"index":7858},"line":272,"code":"  it('should clone first message sent using send() - array 3', function (done) {\n    testSendCloning(\"[null,msg]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should clone first message sent using send() - array 3","suites":["function node"],"updatePoint":{"line":275,"column":60,"index":7986},"line":275,"code":"  it('should clone first message sent using send() - array 3', function (done) {\n    testSendCloning(\"[null,[msg]]\", done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should pass through _topic","suites":["function node"],"updatePoint":{"line":278,"column":32,"index":8088},"line":278,"code":"  it('should pass through _topic', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('_topic', 'baz');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        _topic: \"baz\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send to multiple outputs","suites":["function node"],"updatePoint":{"line":304,"column":37,"index":8759},"line":304,"code":"  it('should send to multiple outputs', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"], [\"n3\"]],\n      func: \"return [{payload: '1'},{payload: '2'}];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        should(msg).have.property('payload', '1');\n        count++;\n        if (count == 2) {\n          done();\n        }\n      });\n      n3.on(\"input\", function (msg) {\n        should(msg).have.property('payload', '2');\n        count++;\n        if (count == 2) {\n          done();\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should send to multiple messages","suites":["function node"],"updatePoint":{"line":342,"column":38,"index":9671},"line":342,"code":"  it('should send to multiple messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [[{payload: 1},{payload: 2}]];\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        count++;\n        try {\n          should(msg).have.property('payload', count);\n          should(msg).have.property('_msgid', 1234);\n          if (count == 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        _msgid: 1234\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow input to be discarded by returning null","suites":["function node"],"updatePoint":{"line":375,"column":58,"index":10494},"line":375,"code":"  it('should allow input to be discarded by returning null', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return null\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, 20);\n      n2.on(\"input\", function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle null amongst valid messages","suites":["function node"],"updatePoint":{"line":400,"column":47,"index":11099},"line":400,"code":"  it('should handle null amongst valid messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"return [[msg,null,msg],null]\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var n2MsgCount = 0;\n      var n3MsgCount = 0;\n      n2.on(\"input\", function (msg) {\n        n2MsgCount++;\n      });\n      n3.on(\"input\", function (msg) {\n        n3MsgCount++;\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        n2MsgCount.should.equal(2);\n        n3MsgCount.should.equal(0);\n        done();\n      }, 20);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in global context","suites":["function node"],"updatePoint":{"line":436,"column":39,"index":11957},"line":436,"code":"  it('should get keys in global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - string","suites":["function node"],"updatePoint":{"line":498,"column":59,"index":13748},"line":498,"code":"  it('should drop and log non-object message types - string', function (done) {\n    testNonObjectMessage('return \"foo\"', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - buffer","suites":["function node"],"updatePoint":{"line":501,"column":59,"index":13882},"line":501,"code":"  it('should drop and log non-object message types - buffer', function (done) {\n    testNonObjectMessage('return Buffer.from(\"hello\")', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - array","suites":["function node"],"updatePoint":{"line":504,"column":58,"index":14030},"line":504,"code":"  it('should drop and log non-object message types - array', function (done) {\n    testNonObjectMessage('return [[[1,2,3]]]', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - boolean","suites":["function node"],"updatePoint":{"line":507,"column":60,"index":14171},"line":507,"code":"  it('should drop and log non-object message types - boolean', function (done) {\n    testNonObjectMessage('return true', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should drop and log non-object message types - number","suites":["function node"],"updatePoint":{"line":510,"column":59,"index":14304},"line":510,"code":"  it('should drop and log non-object message types - number', function (done) {\n    testNonObjectMessage('return 123', done);\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle and log script error","suites":["function node"],"updatePoint":{"line":513,"column":40,"index":14417},"line":513,"code":"  it('should handle and log script error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"var a = 1;\\nretunr\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          helper.log().called.should.be.true();\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"function\";\n          });\n          logEvents.should.have.length(1);\n          var msg = logEvents[0][0];\n          msg.should.have.property('level', helper.log().ERROR);\n          msg.should.have.property('id', 'n1');\n          msg.should.have.property('type', 'function');\n          msg.should.have.property('msg', 'ReferenceError: retunr is not defined (line 2, col 1)');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 50);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle node.on()","suites":["function node"],"updatePoint":{"line":545,"column":29,"index":15421},"line":545,"code":"  it('should handle node.on()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"node.on('close',function(){ node.log('closed')});\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        n1.close().then(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().INFO);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', 'closed');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      }, 100);\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set node context","suites":["function node"],"updatePoint":{"line":579,"column":29,"index":16489},"line":579,"code":"  it('should set node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n1.context().get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":604,"column":56,"index":17183},"line":604,"code":"  it('should set persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":637,"column":60,"index":18107},"line":637,"code":"  it('should set two persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1');context.set('count','1','memory2');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (single call, w/o callback)","suites":["function node"],"updatePoint":{"line":673,"column":73,"index":19215},"line":673,"code":"  it('should set two persistable node context (single call, w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set(['count1','count2'],['0','1'],'memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count1\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count2\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable node context (w callback)","suites":["function node"],"updatePoint":{"line":709,"column":54,"index":20289},"line":709,"code":"  it('should set persistable node context (w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (w callback)","suites":["function node"],"updatePoint":{"line":742,"column":58,"index":21236},"line":742,"code":"  it('should set two persistable node context (w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0','memory1', function (err) { context.set('count', '1', 'memory2', function (err) { node.send(msg); }); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"0\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable node context (single call, w callback)","suites":["function node"],"updatePoint":{"line":778,"column":71,"index":22390},"line":778,"code":"  it('should set two persistable node context (single call, w callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set(['count1','count2'],['0','1'],'memory1', function(err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count1\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n1.context().get(\"count2\", \"memory1\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set default persistable node context","suites":["function node"],"updatePoint":{"line":814,"column":49,"index":23483},"line":814,"code":"  it('should set default persistable node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n1.context().get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get node context","suites":["function node"],"updatePoint":{"line":847,"column":29,"index":24366},"line":847,"code":"  it('should get node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":891,"column":56,"index":25699},"line":891,"code":"  it('should get persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable node context (w/ callback)","suites":["function node"],"updatePoint":{"line":918,"column":55,"index":26470},"line":918,"code":"  it('should get persistable node context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.get('count','memory1',function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in node context","suites":["function node"],"updatePoint":{"line":945,"column":37,"index":27257},"line":945,"code":"  it('should get keys in node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable node context (w/o callback)","suites":["function node"],"updatePoint":{"line":970,"column":64,"index":27950},"line":970,"code":"  it('should get keys in persistable node context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys('memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable node context (w/ callback)","suites":["function node"],"updatePoint":{"line":1001,"column":63,"index":28807},"line":1001,"code":"  it('should get keys in persistable node context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.keys('memory1', function(err, keys) { msg.payload=keys; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in default persistable node context","suites":["function node"],"updatePoint":{"line":1032,"column":57,"index":29694},"line":1032,"code":"  it('should get keys in default persistable node context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().set(\"count\", \"0\", \"memory1\");\n        n1.context().set(\"number\", \"1\", \"memory2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set flow context","suites":["function node"],"updatePoint":{"line":1064,"column":29,"index":30560},"line":1064,"code":"  it('should set flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n2.context().flow.get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1091,"column":56,"index":31292},"line":1091,"code":"  it('should set persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1126,"column":60,"index":32254},"line":1126,"code":"  it('should set two persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1');flow.set('count','1','memory2');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n2.context().flow.get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1164,"column":55,"index":33384},"line":1164,"code":"  it('should set persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set two persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1199,"column":59,"index":34370},"line":1199,"code":"  it('should set two persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.set('count','0','memory1', function (err) { flow.set('count','1','memory2', function (err) { node.send(msg); }); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().flow.get(\"count\", \"memory1\", function (err, val1) {\n              val1.should.equal(\"0\");\n              n2.context().flow.get(\"count\", \"memory2\", function (err, val2) {\n                val2.should.equal(\"1\");\n                done();\n              });\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get flow context","suites":["function node"],"updatePoint":{"line":1237,"column":29,"index":35520},"line":1237,"code":"  it('should get flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1264,"column":56,"index":36243},"line":1264,"code":"  it('should get persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1293,"column":55,"index":37052},"line":1293,"code":"  it('should get persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.get('count','memory1', function(err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get flow context","suites":["function node"],"updatePoint":{"line":1322,"column":29,"index":37869},"line":1322,"code":"  it('should get flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.flow.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in flow context","suites":["function node"],"updatePoint":{"line":1349,"column":37,"index":38581},"line":1349,"code":"  it('should get keys in flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.keys();return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', ['count']);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable flow context (w/o callback)","suites":["function node"],"updatePoint":{"line":1376,"column":64,"index":39312},"line":1376,"code":"  it('should get keys in persistable flow context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=flow.keys('memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get keys in persistable flow context (w/ callback)","suites":["function node"],"updatePoint":{"line":1409,"column":63,"index":40207},"line":1409,"code":"  it('should get keys in persistable flow context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"flow.keys('memory1', function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', ['count']);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set global context","suites":["function node"],"updatePoint":{"line":1442,"column":31,"index":41105},"line":1442,"code":"  it('should set global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        n2.context().global.get(\"count\").should.equal(\"0\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1467,"column":58,"index":41807},"line":1467,"code":"  it('should set persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().global.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should set persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1500,"column":57,"index":42734},"line":1500,"code":"  it('should set persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.set('count','0','memory1', function (err) { node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'foo');\n            n2.context().global.get(\"count\", \"memory1\", function (err, val) {\n              val.should.equal(\"0\");\n              done();\n            });\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get global context","suites":["function node"],"updatePoint":{"line":1533,"column":31,"index":43660},"line":1533,"code":"  it('should get global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1558,"column":58,"index":44353},"line":1558,"code":"  it('should get persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('count', 'memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    initContext(function () {\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", 'memory1');\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1585,"column":57,"index":45133},"line":1585,"code":"  it('should get persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"global.get('count', 'memory1', function (err, val) { msg.payload=val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    initContext(function () {\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", 'memory1');\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', '0');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get global context","suites":["function node"],"updatePoint":{"line":1612,"column":31,"index":45922},"line":1612,"code":"  it('should get global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.global.get('count');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"count\", \"0\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', '0');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/o callback)","suites":["function node"],"updatePoint":{"line":1637,"column":58,"index":46623},"line":1637,"code":"  it('should get persistable global context (w/o callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.global.get('count','memory1');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '0');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should get persistable global context (w/ callback)","suites":["function node"],"updatePoint":{"line":1668,"column":57,"index":47489},"line":1668,"code":"  it('should get persistable global context (w/ callback)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"context.global.get('count','memory1', function (err, val) { msg.payload = val; node.send(msg); });\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().global.set(\"count\", \"0\", \"memory1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '0');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on get persistable context","suites":["function node"],"updatePoint":{"line":1699,"column":52,"index":48387},"line":1699,"code":"  it('should handle error on get persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.get('count','memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on set persistable context","suites":["function node"],"updatePoint":{"line":1724,"column":52,"index":49073},"line":1724,"code":"  it('should handle error on set persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.set('count','0','memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle error on get keys in persistable context","suites":["function node"],"updatePoint":{"line":1748,"column":60,"index":49715},"line":1748,"code":"  it('should handle error on get keys in persistable context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      z: \"flowA\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=context.keys('memory1','callback');return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flowA\"\n    }];\n    helper.load(functionNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context().flow.set(\"count\", \"0\", \"memory1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        checkCallbackError('n1', done);\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle setTimeout()","suites":["function node"],"updatePoint":{"line":1773,"column":32,"index":50374},"line":1773,"code":"  it('should handle setTimeout()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"setTimeout(function(){node.send(msg);},700);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        var endTime = process.hrtime(startTime);\n        var nanoTime = endTime[0] * 1000000000 + endTime[1];\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        if (600000000 < nanoTime && nanoTime < 800000000) {\n          done();\n        } else {\n          try {\n            should.fail(null, null, \"Delayed time was not between 900 and 1100 ms\");\n          } catch (err) {\n            done(err);\n          }\n        }\n      });\n      var startTime = process.hrtime();\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle setInterval()","suites":["function node"],"updatePoint":{"line":1808,"column":33,"index":51401},"line":1808,"code":"  it('should handle setInterval()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"setInterval(function(){node.send(msg);},100);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        count++;\n        if (count > 2) {\n          done();\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should handle clearInterval()","suites":["function node"],"updatePoint":{"line":1836,"column":35,"index":52105},"line":1836,"code":"  it('should handle clearInterval()', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"var id=setInterval(null,100);setTimeout(function(){clearInterval(id);node.send(msg);},500);\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id","suites":["function node"],"updatePoint":{"line":1860,"column":36,"index":52781},"line":1860,"code":"  it('should allow accessing node.id', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = node.id; return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', n1.id);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.name","suites":["function node"],"updatePoint":{"line":1883,"column":38,"index":53352},"line":1883,"code":"  it('should allow accessing node.name', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = node.name; return msg;\",\n      \"name\": \"name of node\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', n1.name);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should use the same Date object from outside the sandbox","suites":["function node"],"updatePoint":{"line":1907,"column":62,"index":53981},"line":1907,"code":"  it('should use the same Date object from outside the sandbox', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload=global.get('typeTest')(new Date());return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"typeTest\", function (d) {\n        return d instanceof Date;\n      });\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', true);\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing env vars","suites":["function node"],"updatePoint":{"line":1933,"column":37,"index":54675},"line":1933,"code":"  it('should allow accessing env vars', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = env.get('_TEST_FOO_'); return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      delete process.env._TEST_FOO_;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (count === 0) {\n            msg.should.have.property('payload', undefined);\n            process.env._TEST_FOO_ = \"hello\";\n            count++;\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          } else {\n            msg.should.have.property('payload', \"hello\");\n            delete process.env._TEST_FOO_;\n            done();\n          }\n        } catch (err) {\n          delete process.env._TEST_FOO_;\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should execute initialization","suites":["function node"],"updatePoint":{"line":1974,"column":35,"index":55763},"line":1974,"code":"  it('should execute initialization', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = global.get('X'); return msg;\",\n      initialize: \"global.set('X','bar');\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"bar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should wait completion of initialization","suites":["function node"],"updatePoint":{"line":1997,"column":46,"index":56372},"line":1997,"code":"  it('should wait completion of initialization', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"function\",\n      wires: [[\"n2\"]],\n      func: \"msg.payload = global.get('X'); return msg;\",\n      initialize: \"global.set('X', '-'); return new Promise((resolve, reject) => setTimeout(() => { global.set('X','bar'); resolve(); }, 500));\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"bar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should execute","suites":["function node","finalize function"],"updatePoint":{"line":2021,"column":22,"index":57105},"line":2021,"code":"    it('should execute', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [],\n        func: \"return msg;\",\n        finalize: \"global.set('X','bar');\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var ctx = n1.context().global;\n        helper.unload().then(function () {\n          ctx.get('X').should.equal(\"bar\");\n          done();\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount","suites":["function node","finalize function"],"updatePoint":{"line":2038,"column":73,"index":57629},"line":2038,"code":"    it('should allow accessing node.id and node.name and node.outputCount', function (done) {\n      var flow = [{\n        id: \"n1\",\n        name: \"test-function\",\n        outputs: 2,\n        type: \"function\",\n        wires: [[\"n2\"]],\n        finalize: \"global.set('finalize-data', { topic: node.name, payload:node.id, outputCount: node.outputCount});\",\n        func: \"return msg;\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var ctx = n1.context().global;\n        helper.unload().then(function () {\n          const finalizeData = ctx.get('finalize-data');\n          should.equal(finalizeData.payload, n1.id);\n          should.equal(finalizeData.topic, n1.name);\n          should.equal(finalizeData.outputCount, n1.outputs);\n          done();\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if using OS module with functionExternalModules set to false","suites":["function node","externalModules"],"updatePoint":{"line":2065,"column":80,"index":58610},"line":2065,"code":"    it('should fail if using OS module with functionExternalModules set to false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"os\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      RED.settings.functionExternalModules = false;\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        should.not.exist(n1);\n        done();\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if using OS module without it listed in libs","suites":["function node","externalModules"],"updatePoint":{"line":2086,"column":64,"index":59205},"line":2086,"code":"    it('should fail if using OS module without it listed in libs', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var messageReceived = false;\n        n2.on(\"input\", function (msg) {\n          messageReceived = true;\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            messageReceived.should.be.false();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should require the OS module","suites":["function node","externalModules"],"updatePoint":{"line":2117,"column":36,"index":60036},"line":2117,"code":"    it('should require the OS module', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"os\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', require('os').type());\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should fail if module variable name clashes with sandbox builtin","suites":["function node","externalModules"],"updatePoint":{"line":2149,"column":72,"index":60936},"line":2149,"code":"    it('should fail if module variable name clashes with sandbox builtin', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"msg.payload = os.type(); return msg;\",\n        \"libs\": [{\n          var: \"flow\",\n          module: \"os\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        should.not.exist(n1);\n        done();\n      }).catch(err => done(err));\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Info Message","suites":["function node","Logger"],"updatePoint":{"line":2204,"column":34,"index":62548},"line":2204,"code":"    it('should log an Info Message', function (done) {\n      testLog(\"\", \"node.log('test');\", \"INFO\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Debug Message","suites":["function node","Logger"],"updatePoint":{"line":2207,"column":34,"index":62665},"line":2207,"code":"    it('should log a Debug Message', function (done) {\n      testLog(\"\", \"node.debug('test');\", \"DEBUG\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Trace Message","suites":["function node","Logger"],"updatePoint":{"line":2210,"column":34,"index":62785},"line":2210,"code":"    it('should log a Trace Message', function (done) {\n      testLog(\"\", \"node.trace('test');\", \"TRACE\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Warning Message","suites":["function node","Logger"],"updatePoint":{"line":2213,"column":36,"index":62907},"line":2213,"code":"    it('should log a Warning Message', function (done) {\n      testLog(\"\", \"node.warn('test');\", \"WARN\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Error Message","suites":["function node","Logger"],"updatePoint":{"line":2216,"column":35,"index":63026},"line":2216,"code":"    it('should log an Error Message', function (done) {\n      testLog(\"\", \"node.error('test');\", \"ERROR\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Info Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2219,"column":47,"index":63159},"line":2219,"code":"    it('should log an Info Message - initialise', function (done) {\n      testLog(\"node.log('test');\", \"\", \"INFO\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Debug Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2222,"column":47,"index":63289},"line":2222,"code":"    it('should log a Debug Message - initialise', function (done) {\n      testLog(\"node.debug('test');\", \"\", \"DEBUG\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Trace Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2225,"column":47,"index":63422},"line":2225,"code":"    it('should log a Trace Message - initialise', function (done) {\n      testLog(\"node.trace('test');\", \"\", \"TRACE\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log a Warning Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2228,"column":49,"index":63557},"line":2228,"code":"    it('should log a Warning Message - initialise', function (done) {\n      testLog(\"node.warn('test');\", \"\", \"WARN\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should log an Error Message - initialise","suites":["function node","Logger"],"updatePoint":{"line":2231,"column":48,"index":63689},"line":2231,"code":"    it('should log an Error Message - initialise', function (done) {\n      testLog(\"node.error('test');\", \"\", \"ERROR\", done);\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown string","suites":["function node","Logger"],"updatePoint":{"line":2234,"column":34,"index":63809},"line":2234,"code":"    it('should catch thrown string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw \\\"small mistake\\\";\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', 'small mistake');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown number","suites":["function node","Logger"],"updatePoint":{"line":2266,"column":34,"index":64846},"line":2266,"code":"    it('should catch thrown number', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw 99;\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', '99');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should catch thrown object (bad practice)","suites":["function node","Logger"],"updatePoint":{"line":2298,"column":49,"index":65872},"line":2298,"code":"    it('should catch thrown object (bad practice)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        func: \"throw {a:1};\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            helper.log().called.should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"function\";\n            });\n            logEvents.should.have.length(1);\n            var msg = logEvents[0][0];\n            msg.should.have.property('level', helper.log().ERROR);\n            msg.should.have.property('id', 'n1');\n            msg.should.have.property('type', 'function');\n            msg.should.have.property('msg', '{\"a\":1}');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should delay handling messages until init completes","suites":["function node","init function"],"updatePoint":{"line":2332,"column":59,"index":66964},"line":2332,"code":"    it('should delay handling messages until init completes', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"function\",\n        wires: [[\"n2\"]],\n        initialize: `\n                return new Promise((resolve,reject) => {\n                    setTimeout(resolve,200)\n                })`,\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var receivedMsgs = [];\n        n2.on(\"input\", function (msg) {\n          msg.delta = Date.now() - msg.payload;\n          receivedMsgs.push(msg);\n          if (receivedMsgs.length === 5) {\n            var errors = receivedMsgs.filter(msg => msg.delta < 200);\n            if (errors.length > 0) {\n              done(new Error(`Message received before init completed - was ${msg.delta} expected >300`));\n            } else {\n              done();\n            }\n          }\n        });\n        for (var i = 0; i < 5; i++) {\n          n1.receive({\n            payload: Date.now(),\n            topic: \"msg\" + i\n          });\n        }\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should allow accessing node.id and node.name and node.outputCount and sending message","suites":["function node","init function"],"updatePoint":{"line":2370,"column":93,"index":68186},"line":2370,"code":"    it('should allow accessing node.id and node.name and node.outputCount and sending message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        name: \"test-function\",\n        outputs: 1,\n        type: \"function\",\n        wires: [[\"n2\"]],\n        initialize: \"setTimeout(function() { node.send({ topic: node.name, payload:node.id, outputCount: node.outputCount})},10)\",\n        func: \"\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(functionNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            // Use this form of assert as `msg` is created inside\n            // the sandbox and doesn't get all the should.js monkey patching\n            should.equal(msg.payload, n1.id);\n            should.equal(msg.topic, n1.name);\n            should.equal(msg.outputCount, n1.outputs);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"nodes/core/function/10-function_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with some defaults","suites":["switch Node"],"updatePoint":{"line":53,"column":41,"index":1689},"line":53,"code":"  it('should be loaded with some defaults', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"name\": \"switchNode\"\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      switchNode1.should.have.property('name', 'switchNode');\n      switchNode1.should.have.property('checkall', \"true\");\n      switchNode1.should.have.property('rules', []);\n      done();\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload equals given value","suites":["switch Node"],"updatePoint":{"line":247,"column":48,"index":8182},"line":247,"code":"  it('should check if payload equals given value', function (done) {\n    genericSwitchTest(\"eq\", \"Hello\", true, true, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't equal to desired string","suites":["switch Node"],"updatePoint":{"line":250,"column":77,"index":8351},"line":250,"code":"  it('should return nothing when the payload doesn\\'t equal to desired string', function (done) {\n    genericSwitchTest(\"eq\", \"Hello\", true, false, \"Hello!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload NOT equals given value","suites":["switch Node"],"updatePoint":{"line":253,"column":52,"index":8497},"line":253,"code":"  it('should check if payload NOT equals given value', function (done) {\n    genericSwitchTest(\"neq\", \"Hello\", true, true, \"HEllO\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload does equal to desired string","suites":["switch Node"],"updatePoint":{"line":256,"column":73,"index":8663},"line":256,"code":"  it('should return nothing when the payload does equal to desired string', function (done) {\n    genericSwitchTest(\"neq\", \"Hello\", true, false, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload equals given numeric value","suites":["switch Node"],"updatePoint":{"line":259,"column":56,"index":8813},"line":259,"code":"  it('should check if payload equals given numeric value', function (done) {\n    genericSwitchTest(\"eq\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't equal to desired numeric value","suites":["switch Node"],"updatePoint":{"line":262,"column":84,"index":8977},"line":262,"code":"  it('should return nothing when the payload doesn\\'t equal to desired numeric value', function (done) {\n    genericSwitchTest(\"eq\", 2, true, false, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload NOT equals given numeric value","suites":["switch Node"],"updatePoint":{"line":265,"column":60,"index":9118},"line":265,"code":"  it('should check if payload NOT equals given numeric value', function (done) {\n    genericSwitchTest(\"neq\", 55667744, true, true, -1234, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload does equal to desired numeric value","suites":["switch Node"],"updatePoint":{"line":268,"column":80,"index":9290},"line":268,"code":"  it('should return nothing when the payload does equal to desired numeric value', function (done) {\n    genericSwitchTest(\"neq\", 10, true, false, 10, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is less than given value","suites":["switch Node"],"updatePoint":{"line":271,"column":54,"index":9428},"line":271,"code":"  it('should check if payload is less than given value', function (done) {\n    genericSwitchTest(\"lt\", 3, true, true, 2, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not less than desired string","suites":["switch Node"],"updatePoint":{"line":274,"column":76,"index":9584},"line":274,"code":"  it('should return nothing when the payload is not less than desired string', function (done) {\n    genericSwitchTest(\"lt\", 3, true, false, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload less than equals given value","suites":["switch Node"],"updatePoint":{"line":277,"column":58,"index":9723},"line":277,"code":"  it('should check if payload less than equals given value', function (done) {\n    genericSwitchTest(\"lte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than given value","suites":["switch Node"],"updatePoint":{"line":280,"column":57,"index":9861},"line":280,"code":"  it('should check if payload is greater than given value', function (done) {\n    genericSwitchTest(\"gt\", 3, true, true, 6, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not greater than desired string","suites":["switch Node"],"updatePoint":{"line":283,"column":79,"index":10020},"line":283,"code":"  it('should return nothing when the payload is not greater than desired string', function (done) {\n    genericSwitchTest(\"gt\", 3, true, false, -1, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than/equals given value","suites":["switch Node"],"updatePoint":{"line":286,"column":64,"index":10166},"line":286,"code":"  it('should check if payload is greater than/equals given value', function (done) {\n    genericSwitchTest(\"gte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload is not greater than desired string","suites":["switch Node"],"updatePoint":{"line":289,"column":79,"index":10326},"line":289,"code":"  it('should return nothing when the payload is not greater than desired string', function (done) {\n    genericSwitchTest(\"gt\", 3, true, false, -1, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is greater than/equals given value","suites":["switch Node"],"updatePoint":{"line":292,"column":64,"index":10472},"line":292,"code":"  it('should check if payload is greater than/equals given value', function (done) {\n    genericSwitchTest(\"gte\", 3, true, true, 3, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match if a payload has a required property","suites":["switch Node"],"updatePoint":{"line":295,"column":55,"index":10608},"line":295,"code":"  it('should match if a payload has a required property', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, true, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if a payload does not have a required property","suites":["switch Node"],"updatePoint":{"line":300,"column":69,"index":10778},"line":300,"code":"  it('should not match if a payload does not have a required property', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, {\n      b: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the key is not a string","suites":["switch Node"],"updatePoint":{"line":305,"column":49,"index":10929},"line":305,"code":"  it('should not match if the key is not a string', function (done) {\n    genericSwitchTest(\"hask\", 1, true, false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the parent object does not exist - null","suites":["switch Node"],"updatePoint":{"line":310,"column":65,"index":11094},"line":310,"code":"  it('should not match if the parent object does not exist - null', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match if the parent object does not exist - undefined","suites":["switch Node"],"updatePoint":{"line":313,"column":70,"index":11252},"line":313,"code":"  it('should not match if the parent object does not exist - undefined', function (done) {\n    genericSwitchTest(\"hask\", \"a\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given values","suites":["switch Node"],"updatePoint":{"line":316,"column":53,"index":11398},"line":316,"code":"  it('should check if payload is between given values', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"3\", \"5\", true, true, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given values in \"wrong\" order","suites":["switch Node"],"updatePoint":{"line":319,"column":70,"index":11558},"line":319,"code":"  it('should check if payload is between given values in \"wrong\" order', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"5\", \"3\", true, true, 4, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is between given string values","suites":["switch Node"],"updatePoint":{"line":322,"column":60,"index":11708},"line":322,"code":"  it('should check if payload is between given string values', function (done) {\n    twoFieldSwitchTest(\"btwn\", \"c\", \"e\", true, true, \"d\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not between given values","suites":["switch Node"],"updatePoint":{"line":325,"column":57,"index":11857},"line":325,"code":"  it('should check if payload is not between given values', function (done) {\n    twoFieldSwitchTest(\"btwn\", 3, 5, true, false, 12, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload contains given value","suites":["switch Node"],"updatePoint":{"line":328,"column":50,"index":11995},"line":328,"code":"  it('should check if payload contains given value', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, true, \"Hello World!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't contain desired string","suites":["switch Node"],"updatePoint":{"line":331,"column":76,"index":12172},"line":331,"code":"  it('should return nothing when the payload doesn\\'t contain desired string', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, false, \"This is not a greeting!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match regex","suites":["switch Node"],"updatePoint":{"line":334,"column":24,"index":12309},"line":334,"code":"  it('should match regex', function (done) {\n    genericSwitchTest(\"regex\", \"[abc]+\", true, true, \"abbabac\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type string ","suites":["switch Node"],"updatePoint":{"line":337,"column":48,"index":12455},"line":337,"code":"  it('should check if payload if of type string ', function (done) {\n    genericSwitchTest(\"istype\", \"string\", true, true, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number ","suites":["switch Node"],"updatePoint":{"line":340,"column":48,"index":12600},"line":340,"code":"  it('should check if payload if of type number ', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 999, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number 0","suites":["switch Node"],"updatePoint":{"line":343,"column":49,"index":12742},"line":343,"code":"  it('should check if payload if of type number 0', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number NaN","suites":["switch Node"],"updatePoint":{"line":346,"column":51,"index":12884},"line":346,"code":"  it('should check if payload if of type number NaN', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, false, parseInt(\"banana\"), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type number Infinity","suites":["switch Node"],"updatePoint":{"line":349,"column":56,"index":13049},"line":349,"code":"  it('should check if payload if of type number Infinity', function (done) {\n    genericSwitchTest(\"istype\", \"number\", true, true, 1 / 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type boolean true","suites":["switch Node"],"updatePoint":{"line":352,"column":53,"index":13197},"line":352,"code":"  it('should check if payload if of type boolean true', function (done) {\n    genericSwitchTest(\"istype\", \"boolean\", true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type boolean false","suites":["switch Node"],"updatePoint":{"line":355,"column":54,"index":13346},"line":355,"code":"  it('should check if payload if of type boolean false', function (done) {\n    genericSwitchTest(\"istype\", \"boolean\", true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type array ","suites":["switch Node"],"updatePoint":{"line":358,"column":47,"index":13488},"line":358,"code":"  it('should check if payload if of type array ', function (done) {\n    genericSwitchTest(\"istype\", \"array\", true, true, [1, 2, 3, \"a\", \"b\"], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type buffer ","suites":["switch Node"],"updatePoint":{"line":361,"column":48,"index":13644},"line":361,"code":"  it('should check if payload if of type buffer ', function (done) {\n    genericSwitchTest(\"istype\", \"buffer\", true, true, Buffer.from(\"Hello\"), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type object ","suites":["switch Node"],"updatePoint":{"line":364,"column":48,"index":13802},"line":364,"code":"  it('should check if payload if of type object ', function (done) {\n    genericSwitchTest(\"istype\", \"object\", true, true, {\n      a: 1,\n      b: \"b\",\n      c: true\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type JSON string ","suites":["switch Node"],"updatePoint":{"line":371,"column":53,"index":13992},"line":371,"code":"  it('should check if payload if of type JSON string ', function (done) {\n    genericSwitchTest(\"istype\", \"json\", true, true, JSON.stringify({\n      a: 1,\n      b: \"b\",\n      c: true\n    }), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type JSON string (and fail if not) ","suites":["switch Node"],"updatePoint":{"line":378,"column":71,"index":14214},"line":378,"code":"  it('should check if payload if of type JSON string (and fail if not) ', function (done) {\n    genericSwitchTest(\"istype\", \"json\", true, false, \"Hello\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type null","suites":["switch Node"],"updatePoint":{"line":381,"column":45,"index":14355},"line":381,"code":"  it('should check if payload if of type null', function (done) {\n    genericSwitchTest(\"istype\", \"null\", true, true, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload if of type undefined","suites":["switch Node"],"updatePoint":{"line":384,"column":50,"index":14497},"line":384,"code":"  it('should check if payload if of type undefined', function (done) {\n    genericSwitchTest(\"istype\", \"undefined\", true, true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow context","suites":["switch Node"],"updatePoint":{"line":387,"column":32,"index":14631},"line":387,"code":"  it('should handle flow context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"foo\",\n      \"propertyType\": \"flow\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"bar\",\n        \"vt\": \"flow\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.context().flow.set(\"foo\", \"flowValue\");\n      switchNode1.context().flow.set(\"bar\", \"flowValue\");\n      switchNode1.receive({\n        payload: \"value\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable flow context","suites":["switch Node"],"updatePoint":{"line":425,"column":44,"index":15634},"line":425,"code":"  it('should handle persistable flow context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"#:(memory1)::foo\",\n      \"propertyType\": \"flow\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"#:(memory1)::bar\",\n        \"vt\": \"flow\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"value\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        switchNode1.context().flow.set(\"foo\", \"flowValue\", \"memory1\", function (err) {\n          switchNode1.context().flow.set(\"bar\", \"flowValue\", \"memory1\", function (err) {\n            switchNode1.receive({\n              payload: \"value\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle global context","suites":["switch Node"],"updatePoint":{"line":467,"column":34,"index":16819},"line":467,"code":"  it('should handle global context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"foo\",\n      \"propertyType\": \"global\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"bar\",\n        \"vt\": \"global\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.context().global.set(\"foo\", \"globalValue\");\n      switchNode1.context().global.set(\"bar\", \"globalValue\");\n      switchNode1.receive({\n        payload: \"value\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable global context","suites":["switch Node"],"updatePoint":{"line":504,"column":46,"index":17817},"line":504,"code":"  it('should handle persistable global context', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"property\": \"#:(memory1)::foo\",\n      \"propertyType\": \"global\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"#:(memory1)::bar\",\n        \"vt\": \"global\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": \"1\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      \"id\": \"helperNode1\",\n      \"type\": \"helper\",\n      \"wires\": []\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        switchNode1.context().global.set(\"foo\", \"globalValue\", \"memory1\", function (err) {\n          switchNode1.context().global.set(\"bar\", \"globalValue\", \"memory1\", function (err) {\n            switchNode1.receive({\n              payload: \"foo\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare value - matches","suites":["switch Node"],"updatePoint":{"line":545,"column":69,"index":19026},"line":545,"code":"  it('should use a nested message property to compare value - matches', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"bar\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, true, {\n      topic: \"foo\",\n      payload: {\n        \"foo\": \"bar\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare value - no match","suites":["switch Node"],"updatePoint":{"line":570,"column":70,"index":19593},"line":570,"code":"  it('should use a nested message property to compare value - no match', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"bar\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, false, {\n      topic: \"foo\",\n      payload: {\n        \"foo\": \"none\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare nested message property - matches","suites":["switch Node"],"updatePoint":{"line":595,"column":87,"index":20179},"line":595,"code":"  it('should use a nested message property to compare nested message property - matches', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"payload[msg.topic2]\",\n        vt: \"msg\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, true, {\n      topic: \"foo\",\n      topic2: \"foo2\",\n      payload: {\n        \"foo\": \"bar\",\n        \"foo2\": \"bar\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should use a nested message property to compare nested message property - no match","suites":["switch Node"],"updatePoint":{"line":623,"column":88,"index":20844},"line":623,"code":"  it('should use a nested message property to compare nested message property - no match', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload[msg.topic]\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"payload[msg.topic2]\",\n        vt: \"msg\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowMessageSwitchTest(flow, false, {\n      topic: \"foo\",\n      topic2: \"foo2\",\n      payload: {\n        \"foo\": \"bar\",\n        \"foo2\": \"none\"\n      }\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should match regex with ignore-case flag set true","suites":["switch Node"],"updatePoint":{"line":651,"column":55,"index":21478},"line":651,"code":"  it('should match regex with ignore-case flag set true', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\",\n        \"case\": true\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match regex with ignore-case flag unset","suites":["switch Node"],"updatePoint":{"line":672,"column":56,"index":21986},"line":672,"code":"  it('should not match regex with ignore-case flag unset', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, false, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not match regex with ignore-case flag set false","suites":["switch Node"],"updatePoint":{"line":692,"column":60,"index":22477},"line":692,"code":"  it('should not match regex with ignore-case flag set false', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"regex\",\n        \"v\": \"onetwothree\",\n        case: false\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, false, \"oneTWOthree\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't match regex","suites":["switch Node"],"updatePoint":{"line":713,"column":65,"index":22994},"line":713,"code":"  it('should return nothing when the payload doesn\\'t match regex', function (done) {\n    genericSwitchTest(\"regex\", \"\\\\d+\", true, false, \"This is not a digit\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should return nothing when the payload doesn't contain desired string","suites":["switch Node"],"updatePoint":{"line":716,"column":76,"index":23179},"line":716,"code":"  it('should return nothing when the payload doesn\\'t contain desired string', function (done) {\n    genericSwitchTest(\"cont\", \"Hello\", true, false, \"This is not a greeting!\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is true","suites":["switch Node"],"updatePoint":{"line":719,"column":35,"index":23327},"line":719,"code":"  it('should check if input is true', function (done) {\n    singularSwitchTest(true, true, true, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends nothing when input is false and checking for true","suites":["switch Node"],"updatePoint":{"line":722,"column":61,"index":23469},"line":722,"code":"  it('sends nothing when input is false and checking for true', function (done) {\n    singularSwitchTest(true, true, false, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed false","suites":["switch Node"],"updatePoint":{"line":725,"column":43,"index":23595},"line":725,"code":"  it('should check if input is indeed false', function (done) {\n    singularSwitchTest(false, true, true, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends nothing when input is false and checking for true","suites":["switch Node"],"updatePoint":{"line":728,"column":61,"index":23739},"line":728,"code":"  it('sends nothing when input is false and checking for true', function (done) {\n    singularSwitchTest(false, true, false, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (string)","suites":["switch Node"],"updatePoint":{"line":731,"column":47,"index":23869},"line":731,"code":"  it('should check if payload is empty (string)', function (done) {\n    singularSwitchTest(\"empty\", true, true, \"\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (array)","suites":["switch Node"],"updatePoint":{"line":734,"column":46,"index":23997},"line":734,"code":"  it('should check if payload is empty (array)', function (done) {\n    singularSwitchTest(\"empty\", true, true, [], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (buffer)","suites":["switch Node"],"updatePoint":{"line":737,"column":47,"index":24126},"line":737,"code":"  it('should check if payload is empty (buffer)', function (done) {\n    singularSwitchTest(\"empty\", true, true, Buffer.alloc(0), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (object)","suites":["switch Node"],"updatePoint":{"line":740,"column":47,"index":24268},"line":740,"code":"  it('should check if payload is empty (object)', function (done) {\n    singularSwitchTest(\"empty\", true, true, {}, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty string)","suites":["switch Node"],"updatePoint":{"line":743,"column":57,"index":24407},"line":743,"code":"  it('should check if payload is empty (non-empty string)', function (done) {\n    singularSwitchTest(\"empty\", true, false, \"1\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty array)","suites":["switch Node"],"updatePoint":{"line":746,"column":56,"index":24547},"line":746,"code":"  it('should check if payload is empty (non-empty array)', function (done) {\n    singularSwitchTest(\"empty\", true, false, [1], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty buffer)","suites":["switch Node"],"updatePoint":{"line":749,"column":57,"index":24688},"line":749,"code":"  it('should check if payload is empty (non-empty buffer)', function (done) {\n    singularSwitchTest(\"empty\", true, false, Buffer.alloc(1), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (non-empty object)","suites":["switch Node"],"updatePoint":{"line":752,"column":57,"index":24841},"line":752,"code":"  it('should check if payload is empty (non-empty object)', function (done) {\n    singularSwitchTest(\"empty\", true, false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (null)","suites":["switch Node"],"updatePoint":{"line":757,"column":45,"index":24985},"line":757,"code":"  it('should check if payload is empty (null)', function (done) {\n    singularSwitchTest(\"empty\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (undefined)","suites":["switch Node"],"updatePoint":{"line":760,"column":50,"index":25120},"line":760,"code":"  it('should check if payload is empty (undefined)', function (done) {\n    singularSwitchTest(\"empty\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is empty (0)","suites":["switch Node"],"updatePoint":{"line":763,"column":42,"index":25252},"line":763,"code":"  it('should check if payload is empty (0)', function (done) {\n    singularSwitchTest(\"empty\", true, false, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (string)","suites":["switch Node"],"updatePoint":{"line":766,"column":51,"index":25385},"line":766,"code":"  it('should check if payload is not empty (string)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, \"\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (array)","suites":["switch Node"],"updatePoint":{"line":769,"column":50,"index":25519},"line":769,"code":"  it('should check if payload is not empty (array)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, [], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (buffer)","suites":["switch Node"],"updatePoint":{"line":772,"column":51,"index":25654},"line":772,"code":"  it('should check if payload is not empty (buffer)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, Buffer.alloc(0), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (object)","suites":["switch Node"],"updatePoint":{"line":775,"column":51,"index":25802},"line":775,"code":"  it('should check if payload is not empty (object)', function (done) {\n    singularSwitchTest(\"nempty\", true, !true, {}, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty string)","suites":["switch Node"],"updatePoint":{"line":778,"column":61,"index":25947},"line":778,"code":"  it('should check if payload is not empty (non-empty string)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, \"1\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty array)","suites":["switch Node"],"updatePoint":{"line":781,"column":60,"index":26093},"line":781,"code":"  it('should check if payload is not empty (non-empty array)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, [1], done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty buffer)","suites":["switch Node"],"updatePoint":{"line":784,"column":61,"index":26240},"line":784,"code":"  it('should check if payload is not empty (non-empty buffer)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, Buffer.alloc(1), done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (non-empty object)","suites":["switch Node"],"updatePoint":{"line":787,"column":61,"index":26399},"line":787,"code":"  it('should check if payload is not empty (non-empty object)', function (done) {\n    singularSwitchTest(\"nempty\", true, !false, {\n      a: 1\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (null)","suites":["switch Node"],"updatePoint":{"line":792,"column":49,"index":26549},"line":792,"code":"  it('should check if payload is not empty (null)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, null, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (undefined)","suites":["switch Node"],"updatePoint":{"line":795,"column":54,"index":26689},"line":795,"code":"  it('should check if payload is not empty (undefined)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if payload is not empty (0)","suites":["switch Node"],"updatePoint":{"line":798,"column":46,"index":26826},"line":798,"code":"  it('should check if payload is not empty (0)', function (done) {\n    singularSwitchTest(\"nempty\", true, false, 0, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check input against a previous value","suites":["switch Node"],"updatePoint":{"line":801,"column":49,"index":26958},"line":801,"code":"  it('should check input against a previous value', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": \"\",\n        \"vt\": \"prev\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          try {\n            if (c === 0) {\n              msg.payload.should.equal(1);\n            }\n            if (c === 1) {\n              msg.payload.should.equal(2);\n              done();\n            }\n            c += 1;\n          } catch (err) {\n            done(err);\n          }\n        } else {\n          done();\n        }\n      });\n      switchNode1.receive({\n        payload: 1\n      });\n      switchNode1.receive({\n        payload: 0\n      });\n      switchNode1.receive({\n        payload: -2\n      });\n      switchNode1.receive({\n        payload: 2\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check input against a previous value (2nd option)","suites":["switch Node"],"updatePoint":{"line":856,"column":62,"index":28227},"line":856,"code":"  it('should check input against a previous value (2nd option)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"10\",\n        \"vt\": \"num\",\n        \"v2\": \"\",\n        \"v2t\": \"prev\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          try {\n            if (c === 0) {\n              msg.payload.should.equal(20);\n            }\n            if (c === 1) {\n              msg.payload.should.equal(25);\n              done();\n            }\n            c += 1;\n          } catch (err) {\n            done(err);\n          }\n        } else {\n          //done();\n        }\n      });\n      switchNode1.receive({\n        payload: 0\n      });\n      switchNode1.receive({\n        payload: 20\n      }); // between 10 and 0\n      switchNode1.receive({\n        payload: 30\n      }); // between 10 and 20\n      switchNode1.receive({\n        payload: 20\n      }); // between 10 and 30  yes\n      switchNode1.receive({\n        payload: 30\n      }); // between 10 and 20  no\n      switchNode1.receive({\n        payload: 25\n      }); // between 10 and 30  yes\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed null","suites":["switch Node"],"updatePoint":{"line":920,"column":42,"index":29761},"line":920,"code":"  it('should check if input is indeed null', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"null\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload === null) {\n          done();\n        } else {\n          console.log(\"msg is \", msg);\n        }\n      });\n      switchNode1.receive({\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed undefined","suites":["switch Node"],"updatePoint":{"line":952,"column":47,"index":30553},"line":952,"code":"  it('should check if input is indeed undefined', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"null\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload === undefined) {\n          done();\n        } else {\n          console.log(\"msg is \", msg);\n        }\n      });\n      switchNode1.receive({\n        payload: undefined\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should treat non-existant msg property conditional as undefined","suites":["switch Node"],"updatePoint":{"line":984,"column":69,"index":31377},"line":984,"code":"  it('should treat non-existant msg property conditional as undefined', function (done) {\n    var flow = [{\n      \"id\": \"switchNode1\",\n      \"type\": \"switch\",\n      \"z\": \"feee1df.c3263e\",\n      \"name\": \"\",\n      \"property\": \"payload\",\n      \"propertyType\": \"msg\",\n      \"rules\": [{\n        \"t\": \"eq\",\n        \"v\": \"this.does.not.exist\",\n        \"vt\": \"msg\"\n      }],\n      \"checkall\": \"true\",\n      \"outputs\": 1,\n      \"x\": 190,\n      \"y\": 440,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var received = [];\n      helperNode1.on(\"input\", function (msg) {\n        received.push(msg);\n      });\n      // First message should be dropped as payload is not undefined\n      switchNode1.receive({\n        topic: \"messageOne\",\n        payload: \"\"\n      });\n      // Second message should pass through as payload is undefined\n      switchNode1.receive({\n        topic: \"messageTwo\",\n        payload: undefined\n      });\n      setTimeout(function () {\n        try {\n          received.should.have.lengthOf(1);\n          received[0].should.have.a.property(\"topic\", \"messageTwo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 500);\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check if input is indeed not null","suites":["switch Node"],"updatePoint":{"line":1035,"column":46,"index":32758},"line":1035,"code":"  it('should check if input is indeed not null', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"nnull\"\n      }],\n      checkall: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        if (msg.payload) {\n          done();\n        } else {\n          try {\n            msg.payload.should.equal(\"Anything here\");\n          } catch (err) {\n            done(err);\n          }\n        }\n      });\n      switchNode1.receive({\n        payload: \"Anything here\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"sends a message when the \"else/otherwise\" statement is selected","suites":["switch Node"],"updatePoint":{"line":1071,"column":69,"index":33669},"line":1071,"code":"  it('sends a message when the \"else/otherwise\" statement is selected', function (done) {\n    singularSwitchTest(\"else\", true, true, 123456, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"handles more than one switch statement","suites":["switch Node"],"updatePoint":{"line":1074,"column":44,"index":33798},"line":1074,"code":"  it('handles more than one switch statement', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"Hello\"\n      }, {\n        \"t\": \"cont\",\n        \"v\": \"ello\"\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      outputs: 3,\n      wires: [[\"helperNode1\"], [\"helperNode2\"], [\"helperNode3\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode3\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var helperNode2 = helper.getNode(\"helperNode2\");\n      var helperNode3 = helper.getNode(\"helperNode3\");\n      var nodeHitCount = 0;\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          nodeHitCount++;\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          nodeHitCount++;\n          if (nodeHitCount == 2) {\n            done();\n          } else {\n            try {\n              should.fail(null, null, \"Both statements should be triggered!\");\n            } catch (err) {\n              done(err);\n            }\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode3.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"Hello\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"stops after first statement","suites":["switch Node"],"updatePoint":{"line":1148,"column":33,"index":35688},"line":1148,"code":"  it('stops after first statement', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"Hello\"\n      }, {\n        \"t\": \"cont\",\n        \"v\": \"ello\"\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: \"false\",\n      outputs: 3,\n      wires: [[\"helperNode1\"], [\"helperNode2\"], [\"helperNode3\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"helperNode3\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var helperNode2 = helper.getNode(\"helperNode2\");\n      var helperNode3 = helper.getNode(\"helperNode3\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.equal(\"Hello\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode2.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      helperNode3.on(\"input\", function (msg) {\n        try {\n          should.fail(null, null, \"The otherwise/else statement should not be triggered here!\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"Hello\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle JSONata expression","suites":["switch Node"],"updatePoint":{"line":1211,"column":38,"index":37326},"line":1211,"code":"  it('should handle JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs(payload)\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$sqrt(16)\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$sqrt(36)\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, -5, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow and global contexts with JSONata expression","suites":["switch Node"],"updatePoint":{"line":1235,"column":68,"index":37925},"line":1235,"code":"  it('should handle flow and global contexts with JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs($flowContext(\\\"payload\\\"))\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$flowContext(\\\"vt\\\")\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$globalContext(\\\"v2t\\\")\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]],\n      z: \"flow\"\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: [],\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(switchNode, flow, function () {\n      var switchNode1 = helper.getNode(\"switchNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      switchNode1.context().flow.set(\"payload\", -5);\n      switchNode1.context().flow.set(\"vt\", 4);\n      switchNode1.context().global.set(\"v2t\", 6);\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.payload, \"pass\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      switchNode1.receive({\n        payload: \"pass\"\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle persistable flow and global contexts with JSONata expression","suites":["switch Node"],"updatePoint":{"line":1281,"column":80,"index":39177},"line":1281,"code":"  it('should handle persistable flow and global contexts with JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$abs($flowContext(\\\"payload\\\",\\\"memory1\\\"))\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$flowContext(\\\"vt\\\",\\\"memory1\\\")\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$globalContext(\\\"v2t\\\",\\\"memory1\\\")\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]],\n      z: \"flow\"\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: [],\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(switchNode, flow, function () {\n      initContext(function () {\n        var switchNode1 = helper.getNode(\"switchNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        switchNode1.context().flow.set([\"payload\", \"vt\"], [-7, 6], \"memory1\", function () {\n          switchNode1.context().global.set(\"v2t\", 8, \"memory1\", function () {\n            helperNode1.on(\"input\", function (msg) {\n              try {\n                should.equal(msg.payload, \"pass\");\n                done();\n              } catch (err) {\n                done(err);\n              }\n            });\n            switchNode1.receive({\n              payload: \"pass\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle env var expression","suites":["switch Node"],"updatePoint":{"line":1330,"column":38,"index":40581},"line":1330,"code":"  it('should handle env var expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"VAR\",\n      propertyType: \"env\",\n      rules: [{\n        \"t\": \"eq\",\n        \"v\": \"VAL\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    process.env.VAR = \"VAL\";\n    customFlowSwitchTest(flow, true, \"OK\", done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1352,"column":54,"index":41097},"line":1352,"code":"  it('should take head of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": 3\n      }],\n      checkall: false,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1373,"column":51,"index":41620},"line":1373,"code":"  it('should take head of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": 3\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (w. context)","suites":["switch Node"],"updatePoint":{"line":1394,"column":55,"index":42145},"line":1394,"code":"  it('should take head of message sequence (w. context)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": \"count\",\n        vt: \"global\"\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, function (node) {\n      node.context().global.set(\"count\", 3);\n    }, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take head of message sequence (w. JSONata)","suites":["switch Node"],"updatePoint":{"line":1418,"column":55,"index":42757},"line":1418,"code":"  it('should take head of message sequence (w. JSONata)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"head\",\n        \"v\": \"1+4/2\",\n        vt: \"jsonata\"\n      }],\n      checkall: false,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [0, 1, 2], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take tail of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1440,"column":54,"index":43310},"line":1440,"code":"  it('should take tail of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 3\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [2, 3, 4], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take tail of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1461,"column":51,"index":43832},"line":1461,"code":"  it('should take tail of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 3\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [2, 3, 4], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take slice of message sequence (no repair)","suites":["switch Node"],"updatePoint":{"line":1482,"column":55,"index":44356},"line":1482,"code":"  it('should take slice of message sequence (no repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"index\",\n        \"v\": 1,\n        \"v2\": 3\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 2, 3], false, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should take slice of message sequence (repair)","suites":["switch Node"],"updatePoint":{"line":1504,"column":52,"index":44897},"line":1504,"code":"  it('should take slice of message sequence (repair)', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"index\",\n        \"v\": 1,\n        \"v2\": 3\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 2, 3], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should check JSONata expression is true","suites":["switch Node"],"updatePoint":{"line":1526,"column":45,"index":45429},"line":1526,"code":"  it('should check JSONata expression is true', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"payload%2 = 1\",\n        \"vt\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSwitchTest(flow, true, 9, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use $I in JSONata expression","suites":["switch Node"],"updatePoint":{"line":1547,"column":52,"index":45932},"line":1547,"code":"  it('should be able to use $I in JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"$I % 2 = 1\",\n        vt: \"jsonata\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [1, 3], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use $N in JSONata expression","suites":["switch Node"],"updatePoint":{"line":1569,"column":52,"index":46491},"line":1569,"code":"  it('should be able to use $N in JSONata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"jsonata_exp\",\n        \"v\": \"payload >= $N-2\",\n        vt: \"jsonata\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    customFlowSequenceSwitchTest(flow, [0, 1, 2, 3, 4], [3, 4], true, undefined, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should not repair message sequence for each port","suites":["switch Node"],"updatePoint":{"line":1675,"column":54,"index":49583},"line":1675,"code":"  it('should not repair message sequence for each port', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": 0\n      }, {\n        \"t\": \"lt\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    }, {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    }];\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2],\n        vf: function (x) {\n          return x > 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, -1],\n        vf: function (x) {\n          return x < 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [0],\n        vf: function (x) {\n          return x == 0;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, false, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should repair message sequence for each port","suites":["switch Node"],"updatePoint":{"line":1733,"column":50,"index":50697},"line":1733,"code":"  it('should repair message sequence for each port', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gt\",\n        \"v\": 0\n      }, {\n        \"t\": \"lt\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    },\n    // >0\n    {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    },\n    // <0\n    {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    } // ==0\n    ];\n\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2],\n        vf: function (x) {\n          return x > 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, -1],\n        vf: function (x) {\n          return x < 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [0],\n        vf: function (x) {\n          return x == 0;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should repair message sequence for each port (overlap)","suites":["switch Node"],"updatePoint":{"line":1797,"column":60,"index":51860},"line":1797,"code":"  it('should repair message sequence for each port (overlap)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"gte\",\n        \"v\": 0\n      }, {\n        \"t\": \"lte\",\n        \"v\": 0\n      }, {\n        \"t\": \"else\"\n      }],\n      checkall: true,\n      repair: true,\n      outputs: 3,\n      wires: [[\"n2\"], [\"n3\"], [\"n4\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    },\n    // >=0\n    {\n      id: \"n3\",\n      type: \"helper\",\n      wires: []\n    },\n    // <=0\n    {\n      id: \"n4\",\n      type: \"helper\",\n      wires: []\n    } // none\n    ];\n\n    var data = [1, -2, 2, 0, -1];\n    var outs = {\n      \"n2\": {\n        port: 0,\n        vals: [1, 2, 0],\n        vf: function (x) {\n          return x >= 0;\n        }\n      },\n      \"n3\": {\n        port: 1,\n        vals: [-2, 0, -1],\n        vf: function (x) {\n          return x <= 0;\n        }\n      },\n      \"n4\": {\n        port: 2,\n        vals: [],\n        vf: function (x) {\n          return false;\n        }\n      }\n    };\n    customFlowSequenceMultiSwitchTest(flow, data, outs, true, done);\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["switch Node"],"updatePoint":{"line":1861,"column":45,"index":53019},"line":1861,"code":"  it('should handle too many pending messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [{\n        \"t\": \"tail\",\n        \"v\": 2\n      }],\n      checkall: true,\n      repair: false,\n      outputs: 3,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"switch\");\n        evt.should.have.property('msg', \"switch.errors.too-many\");\n        done();\n      }, 150);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid jsonata expression","suites":["switch Node"],"updatePoint":{"line":1927,"column":46,"index":54479},"line":1927,"code":"  it('should handle invalid jsonata expression', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"$invalidExpression(payload)\",\n      propertyType: \"jsonata\",\n      rules: [{\n        \"t\": \"btwn\",\n        \"v\": \"$sqrt(16)\",\n        \"vt\": \"jsonata\",\n        \"v2\": \"$sqrt(36)\",\n        \"v2t\": \"jsonata\"\n      }],\n      checkall: true,\n      outputs: 1,\n      wires: [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"switchNode1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"switchNode1\");\n        evt.should.have.property('type', \"switch\");\n        done();\n      }, 150);\n      n1.receive({\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty rule","suites":["switch Node"],"updatePoint":{"line":1965,"column":30,"index":55480},"line":1965,"code":"  it('should handle empty rule', function (done) {\n    var flow = [{\n      id: \"switchNode1\",\n      type: \"switch\",\n      name: \"switchNode\",\n      property: \"payload\",\n      rules: [],\n      checkall: true,\n      outputs: 0,\n      wires: []\n    }];\n    helper.load(switchNode, flow, function () {\n      var n1 = helper.getNode(\"switchNode1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"switch\";\n        });\n        if (logEvents.length === 0) {\n          done();\n        }\n      }, 150);\n      n1.receive({\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/10-switch_spec.js","skipped":false,"dir":"test"},{"name":"should load node with defaults","suites":["change Node"],"updatePoint":{"line":52,"column":36,"index":1598},"line":52,"code":"  it('should load node with defaults', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\"\n    }];\n    helper.load(changeNode, flow, function () {\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        fromt: 'str',\n        pt: 'msg',\n        tot: 'str',\n        t: undefined,\n        p: ''\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load defaults if set to replace","suites":["change Node"],"updatePoint":{"line":70,"column":44,"index":2061},"line":70,"code":"  it('should load defaults if set to replace', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\",\n      action: \"replace\"\n    }];\n    helper.load(changeNode, flow, function () {\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        fromt: 'str',\n        p: '',\n        pt: 'msg',\n        t: 'set',\n        to: '',\n        tot: 'str'\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load defaults if set to change","suites":["change Node"],"updatePoint":{"line":90,"column":43,"index":2560},"line":90,"code":"  it('should load defaults if set to change', function (done) {\n    var flow = [{\n      id: \"c1\",\n      type: \"change\",\n      name: \"change1\",\n      action: \"change\"\n    }];\n    helper.load(changeNode, flow, function () {\n      //console.log(helper.getNode(\"c1\"));\n      helper.getNode(\"c1\").should.have.property(\"name\", \"change1\");\n      helper.getNode(\"c1\").should.have.property(\"rules\", [{\n        from: '',\n        fromRE: /(?:)/g,\n        fromt: 'str',\n        p: '',\n        pt: 'msg',\n        re: undefined,\n        t: 'change',\n        to: '',\n        tot: 'str'\n      }]);\n      done();\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should no-op if there are no rules","suites":["change Node"],"updatePoint":{"line":114,"column":40,"index":3167},"line":114,"code":"  it('should no-op if there are no rules', function (done) {\n    var flow = [{\n      \"id\": \"changeNode1\",\n      \"type\": \"change\",\n      \"rules\": [],\n      \"action\": \"\",\n      \"property\": \"\",\n      \"from\": \"\",\n      \"to\": \"\",\n      \"reg\": false,\n      \"name\": \"changeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(changeNode, flow, function () {\n      var changeNode1 = helper.getNode(\"changeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.should.eql(sentMsg);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var sentMsg = {\n        payload: \"leaveMeAlong\"\n      };\n      changeNode1.receive(sentMsg);\n    });\n  });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of the message property","suites":["change Node","#set"],"updatePoint":{"line":149,"column":46,"index":4042},"line":149,"code":"    it('sets the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"changed\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"changed\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of global context property","suites":["change Node","#set"],"updatePoint":{"line":181,"column":49,"index":4930},"line":181,"code":"    it('sets the value of global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"globalValue\",\n          \"pt\": \"global\",\n          \"to\": \"changed\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            changeNode1.context().global.get(\"globalValue\").should.equal(\"changed\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"changeMe\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of persistable global context property","suites":["change Node","#set"],"updatePoint":{"line":216,"column":61,"index":5958},"line":216,"code":"    it('sets the value of persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"#:(memory1)::globalValue\",\n          \"pt\": \"global\",\n          \"to\": \"changed\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              changeNode1.context().global.get(\"globalValue\", \"memory1\", function (err, val) {\n                val.should.equal(\"changed\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"changeMe\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value and type of the message property","suites":["change Node","#set"],"updatePoint":{"line":256,"column":55,"index":7187},"line":256,"code":"    it('sets the value and type of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"12345\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(12345);\n            var t = typeof msg.payload;\n            t.should.equal(\"number\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of an already set multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":293,"column":69,"index":8213},"line":293,"code":"    it('sets the value of an already set multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"bar\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          foo: {\n            bar: \"foo\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of an empty multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":327,"column":63,"index":9129},"line":327,"code":"    it('sets the value of an empty multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"bar\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({});\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property to another message property","suites":["change Node","#set"],"updatePoint":{"line":357,"column":72,"index":9993},"line":357,"code":"    it('sets the value of a message property to another message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo\",\n        \"from\": \"\",\n        \"to\": \"msg.fred\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        var rule = helper.getNode(\"changeNode1\").rules[0];\n        rule.t.should.eql('set');\n        rule.tot.should.eql('msg');\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          fred: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a multi-level message property to another multi-level message property","suites":["change Node","#set"],"updatePoint":{"line":392,"column":96,"index":11038},"line":392,"code":"    it('sets the value of a multi-level message property to another multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"msg.fred.red\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          fred: {\n            red: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"doesn't set the value of a message property when the 'to' message property does not exist","suites":["change Node","#set"],"updatePoint":{"line":426,"column":100,"index":12001},"line":426,"code":"    it('doesn\\'t set the value of a message property when the \\'to\\' message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"msg.fred.red\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.foo);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({});\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"overrides the value of a message property when the 'to' message property does not exist","suites":["change Node","#set"],"updatePoint":{"line":456,"column":97,"index":12893},"line":456,"code":"    it('overrides the value of a message property when the \\'to\\' message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.foo\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the message property to null when the 'to' message property equals null","suites":["change Node","#set"],"updatePoint":{"line":488,"column":86,"index":13809},"line":488,"code":"    it('sets the message property to null when the \\'to\\' message property equals null', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.foo\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            (msg.payload === null).should.be.true();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello\",\n          foo: null\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"does not set other properties using = inside to property","suites":["change Node","#set"],"updatePoint":{"line":521,"column":64,"index":14734},"line":521,"code":"    it('does not set other properties using = inside to property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"msg.otherProp=10\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            should.not.exist(msg.payload);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"splits dot delimited properties into objects","suites":["change Node","#set"],"updatePoint":{"line":553,"column":52,"index":15628},"line":553,"code":"    it('splits dot delimited properties into objects', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"replace\",\n        \"property\": \"pay.load\",\n        \"from\": \"\",\n        \"to\": \"10\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.pay.load.should.equal(\"10\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          pay: {\n            load: \"changeMe\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to flow context property","suites":["change Node","#set"],"updatePoint":{"line":587,"column":50,"index":16537},"line":587,"code":"    it('changes the value to flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"flowValue\",\n          \"tot\": \"flow\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"flowValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to persistable flow context property","suites":["change Node","#set"],"updatePoint":{"line":622,"column":62,"index":17527},"line":622,"code":"    it('changes the value to persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"#:(memory1)::flowValue\",\n          \"tot\": \"flow\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"Hello World!\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"flowValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to global context property","suites":["change Node","#set"],"updatePoint":{"line":660,"column":52,"index":18641},"line":660,"code":"    it('changes the value to global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"globalValue\",\n          \"tot\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to persistable global context property","suites":["change Node","#set"],"updatePoint":{"line":694,"column":64,"index":19620},"line":694,"code":"    it('changes the value to persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"#:(memory1)::globalValue\",\n          \"tot\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"Hello World!\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a number","suites":["change Node","#set"],"updatePoint":{"line":731,"column":37,"index":20706},"line":731,"code":"    it('changes the value to a number', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"123\",\n          \"tot\": \"num\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(123);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a boolean value","suites":["change Node","#set"],"updatePoint":{"line":764,"column":44,"index":21570},"line":764,"code":"    it('changes the value to a boolean value', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"true\",\n          \"tot\": \"bool\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(true);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a js object","suites":["change Node","#set"],"updatePoint":{"line":797,"column":40,"index":22433},"line":797,"code":"    it('changes the value to a js object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": '{\"a\":123}',\n          \"tot\": \"json\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql({\n              a: 123\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value to a buffer object","suites":["change Node","#set"],"updatePoint":{"line":832,"column":44,"index":23337},"line":832,"code":"    it('changes the value to a buffer object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"[72,101,108,108,111,32,87,111,114,108,100]\",\n          \"tot\": \"bin\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            var buff = Buffer.from(\"Hello World\");\n            msg.payload.should.eql(buff);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of the message property to the current timestamp","suites":["change Node","#set"],"updatePoint":{"line":866,"column":71,"index":24319},"line":866,"code":"    it('sets the value of the message property to the current timestamp', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"ts\",\n          \"pt\": \"msg\",\n          \"to\": \"\",\n          \"tot\": \"date\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            (Date.now() - msg.ts).should.be.approximately(0, 50);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: Date.now()\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property","suites":["change Node","#set","env var"],"updatePoint":{"line":907,"column":43,"index":25421},"line":907,"code":"      it('sets the value using env property', function (done) {\n        var flow = [{\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"foo\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from tab","suites":["change Node","#set","env var"],"updatePoint":{"line":942,"column":52,"index":26421},"line":942,"code":"      it('sets the value using env property from tab', function (done) {\n        var flow = [{\n          \"id\": \"tab1\",\n          \"type\": \"tab\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"z\": \"tab1\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from group","suites":["change Node","#set","env var"],"updatePoint":{"line":986,"column":54,"index":27628},"line":986,"code":"      it('sets the value using env property from group', function (done) {\n        var flow = [{\n          \"id\": \"group1\",\n          \"type\": \"group\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"g\": \"group1\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value using env property from nested group","suites":["change Node","#set","env var"],"updatePoint":{"line":1030,"column":61,"index":28848},"line":1030,"code":"      it('sets the value using env property from nested group', function (done) {\n        var flow = [{\n          \"id\": \"group1\",\n          \"type\": \"group\",\n          \"env\": [{\n            \"name\": \"NR_TEST_A\",\n            \"value\": \"bar\",\n            \"type\": \"str\"\n          }]\n        }, {\n          \"id\": \"group2\",\n          \"type\": \"group\",\n          \"g\": \"group1\",\n          \"env\": []\n        }, {\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          \"g\": \"group2\",\n          rules: [{\n            \"t\": \"set\",\n            \"p\": \"payload\",\n            \"pt\": \"msg\",\n            \"to\": \"NR_TEST_A\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"123\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1080,"column":39,"index":30165},"line":1080,"code":"    it('changes the value using jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$length(payload)\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(12);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid jsonata expression","suites":["change Node","#set","env var"],"updatePoint":{"line":1113,"column":42,"index":31055},"line":1113,"code":"    it('reports invalid jsonata expression', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$invalid(payload)\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          done(\"Invalid jsonata expression passed message through\");\n        });\n        changeNode1.on(\"call:error\", function (err) {\n          // Expect error to be called\n          done();\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using flow context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1145,"column":57,"index":32016},"line":1145,"code":"    it('changes the value using flow context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$flowContext(\\\"foo\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        changeNode1.context().flow.set(\"foo\", \"bar\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using global context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1184,"column":59,"index":33082},"line":1184,"code":"    it('changes the value using global context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$globalContext(\\\"foo\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        changeNode1.context().global.set(\"foo\", \"bar\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable flow context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1223,"column":69,"index":34162},"line":1223,"code":"    it('changes the value using persistable flow context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$flowContext(\\\"foo\\\",\\\"memory1\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"foo\", \"bar\", \"memory1\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              changeNode1.context().flow.set(\"foo\", \"error!\");\n              changeNode1.receive({\n                payload: \"Hello World!\"\n              });\n            }\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable global context with jsonata","suites":["change Node","#set","env var"],"updatePoint":{"line":1270,"column":71,"index":35525},"line":1270,"code":"    it('changes the value using persistable global context with jsonata', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"to\": \"$globalContext(\\\"foo\\\",\\\"memory1\\\")\",\n          \"tot\": \"jsonata\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }, {\n        \"id\": \"flow\",\n        \"type\": \"tab\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.eql(\"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"foo\", \"bar\", \"memory1\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              changeNode1.context().global.set(\"foo\", \"error!\");\n              changeNode1.receive({\n                payload: \"Hello World!\"\n              });\n            }\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property","suites":["change Node","#set","env var"],"updatePoint":{"line":1317,"column":68,"index":36891},"line":1317,"code":"    it('sets the value of a message property using a nested property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"\",\n          lookup: {\n            a: 1,\n            b: 2\n          },\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a nested message property using a message property","suites":["change Node","#set","env var"],"updatePoint":{"line":1361,"column":76,"index":38012},"line":1361,"code":"    it('sets the value of a nested message property using a message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"lookup[msg.topic]\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.lookup.b.should.equal(\"newValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var msg = {\n          payload: \"newValue\",\n          lookup: {\n            a: 1,\n            b: 2\n          },\n          topic: \"b\"\n        };\n        changeNode1.receive(msg);\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property in flow context","suites":["change Node","#set","env var"],"updatePoint":{"line":1406,"column":84,"index":39182},"line":1406,"code":"    it('sets the value of a message property using a nested property in flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"flow\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a message property using a nested property in flow context","suites":["change Node","#set","env var"],"updatePoint":{"line":1451,"column":84,"index":40357},"line":1451,"code":"    it('sets the value of a message property using a nested property in flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"lookup[msg.topic]\",\n          \"tot\": \"flow\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sets the value of a nested flow context property using a message property","suites":["change Node","#set","env var"],"updatePoint":{"line":1496,"column":81,"index":41529},"line":1496,"code":"    it('sets the value of a nested flow context property using a message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"name\": \"\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"lookup[msg.topic]\",\n          \"pt\": \"flow\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"action\": \"\",\n        \"property\": \"\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.eql(\"newValue\");\n            changeNode1.context().flow.get(\"lookup.b\").should.eql(\"newValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"lookup\", {\n          a: 1,\n          b: 2\n        });\n        changeNode1.receive({\n          payload: \"newValue\",\n          topic: \"b\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deep copies the property if selected","suites":["change Node","#set","env var"],"updatePoint":{"line":1542,"column":44,"index":42760},"line":1542,"code":"    it('deep copies the property if selected', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"set\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"source\",\n          \"tot\": \"msg\",\n          \"dc\": true\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            // Check payload has been set to a clone of original object\n            // - the JSON should match\n            JSON.stringify(msg.payload).should.equal(JSON.stringify(originalObject));\n            // - but they must be different objects\n            msg.payload.should.not.equal(originalObject);\n\n            // Modify nested property of original object\n            originalObject.a.c = 3;\n            // Check that modification hasn't happened on cloned prop\n            msg.payload.a.should.not.have.property('c');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        var originalObject = {\n          a: {\n            b: 2\n          }\n        };\n        changeNode1.receive({\n          source: originalObject\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the message property","suites":["change Node","#change"],"updatePoint":{"line":1593,"column":49,"index":44305},"line":1593,"code":"    it('changes the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the message property for partial match","suites":["change Node","#change"],"updatePoint":{"line":1625,"column":90,"index":45249},"line":1625,"code":"    it('changes the value and doesnt change type of the message property for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Change456Me\");\n            var t = typeof msg.payload;\n            t.should.equal(\"string\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Change123Me\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the message property if a complete match","suites":["change Node","#change"],"updatePoint":{"line":1664,"column":78,"index":46347},"line":1664,"code":"    it('changes the value and type of the message property if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(456);\n            var t = typeof msg.payload;\n            t.should.equal(\"number\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"123\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of a multi-level message property","suites":["change Node","#change"],"updatePoint":{"line":1703,"column":59,"index":47408},"line":1703,"code":"    it('changes the value of a multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo.bar\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.foo.bar.should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          foo: {\n            bar: \"Hello World!\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if the changed message property does not exist","suites":["change Node","#change"],"updatePoint":{"line":1737,"column":78,"index":48367},"line":1737,"code":"    it('sends unaltered message if the changed message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if a changed multi-level message property does not exist","suites":["change Node","#change"],"updatePoint":{"line":1769,"column":88,"index":49303},"line":1769,"code":"    it('sends unaltered message if a changed multi-level message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"foo.bar\",\n        \"from\": \"Hello\",\n        \"to\": \"Goodbye\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the message property based on a regex","suites":["change Node","#change"],"updatePoint":{"line":1801,"column":66,"index":50221},"line":1801,"code":"    it('changes the value of the message property based on a regex', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"\\\\d+\",\n        \"to\": \"NUMBER\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Replace all numbers NUMBER and NUMBER\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Replace all numbers 12 and 14\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"supports regex groups","suites":["change Node","#change"],"updatePoint":{"line":1833,"column":29,"index":51141},"line":1833,"code":"    it('supports regex groups', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"(Hello)\",\n        \"to\": \"$1-$1-$1\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello-Hello-Hello World\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid regex","suites":["change Node","#change"],"updatePoint":{"line":1865,"column":29,"index":52034},"line":1865,"code":"    it('reports invalid regex', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"change\",\n        \"property\": \"payload\",\n        \"from\": \"\\\\+**+\",\n        \"to\": \"NUMBER\",\n        \"reg\": true,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"change\";\n        });\n        logEvents.should.have.length(1);\n        var msg = logEvents[0][0];\n        msg.should.have.property('level', helper.log().ERROR);\n        msg.should.have.property('id', 'changeNode1');\n        done();\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"supports regex groups - new rule format","suites":["change Node","#change"],"updatePoint":{"line":1892,"column":47,"index":52860},"line":1892,"code":"    it('supports regex groups - new rule format', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"(Hello)\",\n          \"to\": \"$1-$1-$1\",\n          \"fromt\": \"re\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"Hello-Hello-Hello World\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"Hello World\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value - new rule format","suites":["change Node","#change"],"updatePoint":{"line":1927,"column":43,"index":53820},"line":1927,"code":"    it('changes the value - new rule format', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"ABC\",\n          \"to\": \"123\",\n          \"fromt\": \"str\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using msg property","suites":["change Node","#change"],"updatePoint":{"line":1962,"column":44,"index":54757},"line":1962,"code":"    it('changes the value using msg property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"msg\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"abcABCabc\",\n          topic: \"ABC\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using flow context property","suites":["change Node","#change"],"updatePoint":{"line":1998,"column":53,"index":55729},"line":1998,"code":"    it('changes the value using flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"flow\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"topic\", \"ABC\");\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable flow context property","suites":["change Node","#change"],"updatePoint":{"line":2035,"column":65,"index":56767},"line":2035,"code":"    it('changes the value using persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"123\",\n          \"fromt\": \"flow\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abc123abc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"topic\", \"ABC\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"abcABCabc\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using global context property","suites":["change Node","#change"],"updatePoint":{"line":2075,"column":55,"index":57929},"line":2075,"code":"    it('changes the value using global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"123\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc123abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"topic\", \"ABC\");\n        changeNode1.receive({\n          payload: \"abcABCabc\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using persistable global context property","suites":["change Node","#change"],"updatePoint":{"line":2111,"column":67,"index":58952},"line":2111,"code":"    it('changes the value using persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"123\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abc123abc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"topic\", \"ABC\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"abcABCabc\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the number using global context property","suites":["change Node","#change"],"updatePoint":{"line":2150,"column":56,"index":60098},"line":2150,"code":"    it('changes the number using global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"topic\",\n          \"to\": \"ABC\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"ABC\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"topic\", 123);\n        changeNode1.receive({\n          payload: 123\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the number using persistable global context property","suites":["change Node","#change"],"updatePoint":{"line":2186,"column":68,"index":61106},"line":2186,"code":"    it('changes the number using persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"#:(memory1)::topic\",\n          \"to\": \"ABC\",\n          \"fromt\": \"global\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"ABC\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"topic\", 123, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: 123\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - string payload","suites":["change Node","#change"],"updatePoint":{"line":2225,"column":55,"index":62235},"line":2225,"code":"    it('changes the value using number - string payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"123\",\n          \"to\": \"456\",\n          \"fromt\": \"num\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"456\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"123\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number payload","suites":["change Node","#change"],"updatePoint":{"line":2260,"column":55,"index":63171},"line":2260,"code":"    it('changes the value using number - number payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"123\",\n          \"to\": \"abc\",\n          \"fromt\": \"num\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: 123\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - string payload","suites":["change Node","#change"],"updatePoint":{"line":2295,"column":56,"index":64106},"line":2295,"code":"    it('changes the value using boolean - string payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"true\",\n          \"to\": \"xxx\",\n          \"fromt\": \"bool\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"xxx\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"true\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean payload","suites":["change Node","#change"],"updatePoint":{"line":2330,"column":57,"index":65047},"line":2330,"code":"    it('changes the value using boolean - boolean payload', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"true\",\n          \"to\": \"xxx\",\n          \"fromt\": \"bool\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"xxx\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: true\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the global context","suites":["change Node","#change"],"updatePoint":{"line":2365,"column":47,"index":65976},"line":2365,"code":"    it('changes the value of the global context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"global\",\n          \"from\": \"Hello\",\n          \"fromt\": \"str\",\n          \"to\": \"Goodbye\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().global.get(\"payload\").should.equal(\"Goodbye World!\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"payload\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value of the persistable global context","suites":["change Node","#change"],"updatePoint":{"line":2405,"column":59,"index":67121},"line":2405,"code":"    it('changes the value of the persistable global context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"global\",\n          \"from\": \"Hello\",\n          \"fromt\": \"str\",\n          \"to\": \"Goodbye\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().global.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"Goodbye World!\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"payload\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the flow context for partial match","suites":["change Node","#change"],"updatePoint":{"line":2450,"column":86,"index":68500},"line":2450,"code":"    it('changes the value and doesnt change type of the flow context for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"Change456Me\");\n            helperNode1.context().flow.get(\"payload\").should.be.a.String();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", \"Change123Me\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and doesnt change type of the persistable flow context for partial match","suites":["change Node","#change"],"updatePoint":{"line":2491,"column":98,"index":69744},"line":2491,"code":"    it('changes the value and doesnt change type of the persistable flow context for partial match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"Change456Me\");\n                val.should.be.a.String();\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", \"Change123Me\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the flow context if a complete match","suites":["change Node","#change"],"updatePoint":{"line":2537,"column":74,"index":71137},"line":2537,"code":"    it('changes the value and type of the flow context if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(456);\n            helperNode1.context().flow.get(\"payload\").should.be.a.Number();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", \"123\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value and type of the persistable flow context if a complete match","suites":["change Node","#change"],"updatePoint":{"line":2578,"column":86,"index":72351},"line":2578,"code":"    it('changes the value and type of the persistable flow context if a complete match', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"str\",\n          \"to\": \"456\",\n          \"tot\": \"num\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.be.a.Number();\n                val.should.equal(456);\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", \"123\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number flow context","suites":["change Node","#change"],"updatePoint":{"line":2624,"column":60,"index":73712},"line":2624,"code":"    it('changes the value using number - number flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"num\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", 123);\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using number - number persistable flow context","suites":["change Node","#change"],"updatePoint":{"line":2664,"column":72,"index":74836},"line":2664,"code":"    it('changes the value using number - number persistable flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"123\",\n          \"fromt\": \"num\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"abc\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", 123, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean flow context","suites":["change Node","#change"],"updatePoint":{"line":2709,"column":62,"index":76157},"line":2709,"code":"    it('changes the value using boolean - boolean flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"pt\": \"flow\",\n          \"from\": \"true\",\n          \"fromt\": \"bool\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            helperNode1.context().flow.get(\"payload\").should.equal(\"abc\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().flow.set(\"payload\", true);\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using boolean - boolean persistable flow context","suites":["change Node","#change"],"updatePoint":{"line":2749,"column":74,"index":77286},"line":2749,"code":"    it('changes the value using boolean - boolean persistable flow context', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"#:(memory1)::payload\",\n          \"pt\": \"flow\",\n          \"from\": \"true\",\n          \"fromt\": \"bool\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]],\n        \"z\": \"flow\"\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: [],\n        \"z\": \"flow\"\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              helperNode1.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n                val.should.equal(\"abc\");\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().flow.set(\"payload\", true, \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"reports invalid fromValue","suites":["change Node","#change"],"updatePoint":{"line":2794,"column":33,"index":78581},"line":2794,"code":"    it('reports invalid fromValue', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"change\",\n          \"p\": \"payload\",\n          \"from\": \"null\",\n          \"fromt\": \"msg\",\n          \"to\": \"abc\",\n          \"tot\": \"str\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"change\";\n          });\n          logEvents.should.have.length(1);\n          var msg = logEvents[0][0];\n          msg.should.have.property('level', helper.log().ERROR);\n          msg.should.have.property('id', 'changeNode1');\n          done();\n        }, 25);\n        changeNode1.receive({\n          payload: \"\",\n          null: null\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"changes the value using env property","suites":["change Node","#change","env var"],"updatePoint":{"line":2838,"column":46,"index":79851},"line":2838,"code":"      it('changes the value using env property', function (done) {\n        var flow = [{\n          \"id\": \"changeNode1\",\n          \"type\": \"change\",\n          rules: [{\n            \"t\": \"change\",\n            \"p\": \"payload\",\n            \"from\": \"topic\",\n            \"to\": \"NR_TEST_A\",\n            \"fromt\": \"msg\",\n            \"tot\": \"env\"\n          }],\n          \"name\": \"changeNode\",\n          \"wires\": [[\"helperNode1\"]]\n        }, {\n          id: \"helperNode1\",\n          type: \"helper\",\n          wires: []\n        }];\n        helper.load(changeNode, flow, function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.payload.should.equal(\"abcfooabc\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.receive({\n            payload: \"abcABCabc\",\n            topic: \"ABC\"\n          });\n        });\n      });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of the message property","suites":["change Node","#delete"],"updatePoint":{"line":2877,"column":49,"index":80945},"line":2877,"code":"    it('deletes the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"payload\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"This won't get through!\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of global context property","suites":["change Node","#delete"],"updatePoint":{"line":2909,"column":52,"index":81847},"line":2909,"code":"    it('deletes the value of global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"delete\",\n          \"p\": \"globalValue\",\n          \"pt\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            changeNode1.context().global.should.not.have.property(\"globalValue\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.context().global.set(\"globalValue\", \"Hello World!\");\n        changeNode1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of persistable global context property","suites":["change Node","#delete"],"updatePoint":{"line":2942,"column":64,"index":82831},"line":2942,"code":"    it('deletes the value of persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        rules: [{\n          \"t\": \"delete\",\n          \"p\": \"#:(memory1)::globalValue\",\n          \"pt\": \"global\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              changeNode1.context().global.get(\"globalValue\", \"memory1\", function (err, val) {\n                should.equal(undefined);\n                done();\n              });\n            } catch (err) {\n              done(err);\n            }\n          });\n          changeNode1.context().global.set(\"globalValue\", \"Hello World!\", \"memory1\", function (err) {\n            changeNode1.receive({\n              payload: \"\"\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"deletes the value of a multi-level message property","suites":["change Node","#delete"],"updatePoint":{"line":2980,"column":59,"index":84016},"line":2980,"code":"    it('deletes the value of a multi-level message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo.bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"This won't get through!\",\n          foo: {\n            bar: \"This will be deleted!\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if the deleted message property does not exist","suites":["change Node","#delete"],"updatePoint":{"line":3015,"column":78,"index":85015},"line":3015,"code":"    it('sends unaltered message if the deleted message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo');\n            msg.payload.should.equal('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"payload\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"sends unaltered message if a deleted multi-level message property does not exist","suites":["change Node","#delete"],"updatePoint":{"line":3048,"column":88,"index":85978},"line":3048,"code":"    it('sends unaltered message if a deleted multi-level message property does not exist', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"action\": \"delete\",\n        \"property\": \"foo.bar\",\n        \"from\": \"\",\n        \"to\": \"\",\n        \"reg\": false,\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('foo.bar');\n            msg.payload.should.equal('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"payload\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of the message property","suites":["change Node","#move"],"updatePoint":{"line":3083,"column":47,"index":86948},"line":3083,"code":"    it('moves the value of the message property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"topic\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('topic');\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"You've got to move it move it.\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          topic: \"You've got to move it move it.\",\n          payload: {\n            foo: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object","suites":["change Node","#move"],"updatePoint":{"line":3122,"column":52,"index":88064},"line":3122,"code":"    it('moves the value of a message property object', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"topic\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('topic');\n            msg.should.have.property('payload');\n            msg.payload.should.have.property('foo');\n            msg.payload.foo.should.have.property('bar');\n            msg.payload.foo.bar.should.equal(1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          topic: {\n            foo: {\n              bar: 1\n            }\n          },\n          payload: \"String\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object to itself","suites":["change Node","#move"],"updatePoint":{"line":3165,"column":62,"index":89284},"line":3165,"code":"    it('moves the value of a message property object to itself', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message property object to a sub-property","suites":["change Node","#move"],"updatePoint":{"line":3200,"column":70,"index":90260},"line":3200,"code":"    it('moves the value of a message property object to a sub-property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload\",\n          \"pt\": \"msg\",\n          \"to\": \"payload.foo\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.have.property('foo');\n            msg.payload.foo.should.equal(\"bar\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"moves the value of a message sub-property object to a property","suites":["change Node","#move"],"updatePoint":{"line":3236,"column":70,"index":91297},"line":3236,"code":"    it('moves the value of a message sub-property object to a property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"rules\": [{\n          \"t\": \"move\",\n          \"p\": \"payload.foo\",\n          \"pt\": \"msg\",\n          \"to\": \"payload\",\n          \"tot\": \"msg\"\n        }],\n        \"name\": \"changeNode\",\n        \"wires\": [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(\"bar\");\n            (typeof msg.payload).should.equal(\"string\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: {\n            foo: \"bar\"\n          }\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"handles multiple rules","suites":["change Node","- multiple rules"],"updatePoint":{"line":3276,"column":30,"index":92376},"line":3276,"code":"    it('handles multiple rules', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          t: \"set\",\n          p: \"payload\",\n          to: \"newValue\"\n        }, {\n          t: \"change\",\n          p: \"changeProperty\",\n          from: \"this\",\n          to: \"that\"\n        }, {\n          t: \"delete\",\n          p: \"deleteProperty\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"newValue\");\n            msg.changeProperty.should.equal(\"change that value\");\n            should.not.exist(msg.deleteProperty);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\",\n          changeProperty: \"change this value\",\n          deleteProperty: \"delete this value\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"applies multiple rules in order","suites":["change Node","- multiple rules"],"updatePoint":{"line":3319,"column":39,"index":93585},"line":3319,"code":"    it('applies multiple rules in order', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          t: \"set\",\n          p: \"payload\",\n          to: \"a this (hi)\"\n        }, {\n          t: \"change\",\n          p: \"payload\",\n          from: \"this\",\n          to: \"that\"\n        }, {\n          t: \"change\",\n          p: \"payload\",\n          from: \"\\\\(.*\\\\)\",\n          to: \"[new]\",\n          re: true\n        }]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        var changeNode1 = helper.getNode(\"changeNode1\");\n        var helperNode1 = helper.getNode(\"helperNode1\");\n        helperNode1.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.equal(\"a that [new]\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        changeNode1.receive({\n          payload: \"changeMe\"\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access two persistable flow context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3361,"column":56,"index":94665},"line":3361,"code":"    it('can access two persistable flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"flow\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"flow\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var flow = changeNode1.context().flow;\n          flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n            flow.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access two persistable global context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3408,"column":58,"index":96034},"line":3408,"code":"    it('can access two persistable global context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"global\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"global\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var global = changeNode1.context().global;\n          global.set(\"val\", \"foo\", \"memory0\", function (err) {\n            global.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"can access persistable global & flow context property","suites":["change Node","- multiple rules"],"updatePoint":{"line":3455,"column":61,"index":97418},"line":3455,"code":"    it('can access persistable global & flow context property', function (done) {\n      var flow = [{\n        \"id\": \"changeNode1\",\n        \"z\": \"t1\",\n        \"type\": \"change\",\n        \"wires\": [[\"helperNode1\"]],\n        rules: [{\n          \"t\": \"set\",\n          \"p\": \"val0\",\n          \"to\": \"#:(memory0)::val\",\n          \"tot\": \"flow\"\n        }, {\n          \"t\": \"set\",\n          \"p\": \"val1\",\n          \"to\": \"#:(memory1)::val\",\n          \"tot\": \"global\"\n        }]\n      }, {\n        id: \"helperNode1\",\n        \"z\": \"t1\",\n        type: \"helper\",\n        wires: []\n      }];\n      helper.load(changeNode, flow, function () {\n        initContext(function () {\n          var changeNode1 = helper.getNode(\"changeNode1\");\n          var helperNode1 = helper.getNode(\"helperNode1\");\n          helperNode1.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"val0\", \"foo\");\n              msg.should.have.property(\"val1\", \"bar\");\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          var context = changeNode1.context();\n          var flow = context.flow;\n          var global = context.global;\n          flow.set(\"val\", \"foo\", \"memory0\", function (err) {\n            global.set(\"val\", \"bar\", \"memory1\", function (err) {\n              changeNode1.receive({\n                payload: \"\"\n              });\n            });\n          });\n        });\n      });\n    });","file":"nodes/core/function/15-change_spec.js","skipped":false,"dir":"test"},{"name":"should load some defaults","suites":["range Node"],"updatePoint":{"line":28,"column":31,"index":1036},"line":28,"code":"  it('should load some defaults', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"name\": \"rangeNode\"\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      rangeNode1.should.have.property('name', 'rangeNode');\n      rangeNode1.should.have.property('round', false);\n      done();\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"ranges numbers up tenfold","suites":["range Node"],"updatePoint":{"line":87,"column":31,"index":2852},"line":87,"code":"  it('ranges numbers up tenfold', function (done) {\n    genericRangeTest(\"scale\", 0, 100, 0, 1000, false, 50, 500, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"ranges numbers down such as centimetres to metres","suites":["range Node"],"updatePoint":{"line":90,"column":55,"index":3004},"line":90,"code":"  it('ranges numbers down such as centimetres to metres', function (done) {\n    genericRangeTest(\"scale\", 0, 100, 0, 1, false, 55, 0.55, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers down say for degree/rotation reading 1/2","suites":["range Node"],"updatePoint":{"line":93,"column":60,"index":3159},"line":93,"code":"  it('wraps numbers down say for degree/rotation reading 1/2', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 15, 180, done); // 1/2 around wrap => \"one and a half turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 1/3","suites":["range Node"],"updatePoint":{"line":97,"column":62,"index":3360},"line":97,"code":"  it('wraps numbers around say for degree/rotation reading 1/3', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 13.3333, 120, done); // 1/3 around wrap => \"one and a third turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 1/4","suites":["range Node"],"updatePoint":{"line":101,"column":62,"index":3567},"line":101,"code":"  it('wraps numbers around say for degree/rotation reading 1/4', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, 12.5, 90, done); // 1/4 around wrap => \"one and a quarter turns\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers down say for degree/rotation reading 1/4","suites":["range Node"],"updatePoint":{"line":105,"column":60,"index":3770},"line":105,"code":"  it('wraps numbers down say for degree/rotation reading 1/4', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, -12.5, 270, done); // 1/4 backwards wrap => \"one and a quarter turns backwards\"\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"wraps numbers around say for degree/rotation reading 0","suites":["range Node"],"updatePoint":{"line":109,"column":60,"index":3988},"line":109,"code":"  it('wraps numbers around say for degree/rotation reading 0', function (done) {\n    genericRangeTest(\"roll\", 0, 10, 0, 360, true, -10, 0, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"clamps numbers within a range - over max","suites":["range Node"],"updatePoint":{"line":112,"column":46,"index":4126},"line":112,"code":"  it('clamps numbers within a range - over max', function (done) {\n    genericRangeTest(\"clamp\", 0, 10, 0, 1000, false, 111, 1000, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"clamps numbers within a range - below min","suites":["range Node"],"updatePoint":{"line":115,"column":47,"index":4271},"line":115,"code":"  it('clamps numbers within a range - below min', function (done) {\n    genericRangeTest(\"clamp\", 0, 10, 0, 1000, false, -1, 0, done);\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"just passes on msg if payload not present","suites":["range Node"],"updatePoint":{"line":118,"column":47,"index":4412},"line":118,"code":"  it('just passes on msg if payload not present', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"minin\": 0,\n      \"maxin\": 100,\n      \"minout\": 0,\n      \"maxout\": 100,\n      \"action\": \"scale\",\n      \"round\": true,\n      \"name\": \"rangeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      helperNode1.on(\"input\", function (msg) {\n        try {\n          msg.should.not.have.property('payload');\n          msg.topic.should.equal(\"pass on\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      rangeNode1.receive({\n        topic: \"pass on\"\n      });\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"reports if input is not a number","suites":["range Node"],"updatePoint":{"line":152,"column":38,"index":5273},"line":152,"code":"  it('reports if input is not a number', function (done) {\n    var flow = [{\n      \"id\": \"rangeNode1\",\n      \"type\": \"range\",\n      \"minin\": 0,\n      \"maxin\": 0,\n      \"minout\": 0,\n      \"maxout\": 0,\n      \"action\": \"scale\",\n      \"round\": true,\n      \"name\": \"rangeNode\",\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(rangeNode, flow, function () {\n      var rangeNode1 = helper.getNode(\"rangeNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      rangeNode1.on(\"call:log\", function (args) {\n        var log = args.args[0];\n        if (log.indexOf(\"notnumber\") > -1) {\n          rangeNode1.log.restore();\n          done();\n        } else {\n          try {\n            should.fail(null, null, \"Non-number inputs should be reported!\");\n          } catch (err) {\n            rangeNode1.log.restore();\n            done(err);\n          }\n        }\n      });\n      rangeNode1.receive({\n        payload: \"NOT A NUMBER\"\n      });\n    });\n  });","file":"nodes/core/function/16-range_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload using node-configured template","suites":["template node"],"updatePoint":{"line":59,"column":58,"index":1754},"line":59,"code":"  it('should modify payload using node-configured template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          msg.should.have.property('template', 'this should be ignored as the node has its own template {{payload}}');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"this should be ignored as the node has its own template {{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify the configured property using msg.template","suites":["template node"],"updatePoint":{"line":90,"column":62,"index":2703},"line":90,"code":"  it('should modify the configured property using msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"randomProperty\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        msg.should.have.property('template', 'payload={{payload}}');\n        msg.should.have.property('randomProperty', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"payload={{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should be able to overwrite msg.template using the template from msg.template","suites":["template node"],"updatePoint":{"line":118,"column":83,"index":3547},"line":118,"code":"  it('should be able to overwrite msg.template using the template from msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'topic=bar');\n        msg.should.have.property('template', 'topic={{topic}}');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"topic={{topic}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from msg.template","suites":["template node"],"updatePoint":{"line":145,"column":45,"index":4277},"line":145,"code":"  it('should modify payload from msg.template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var received = [];\n      n2.on(\"input\", function (msg) {\n        try {\n          received.push(msg);\n          if (received.length === 3) {\n            received[0].should.have.property('topic', 'bar');\n            received[0].should.have.property('payload', 'topic=bar');\n            received[0].should.have.property('template', 'topic={{topic}}');\n            received[1].should.have.property('topic', 'another bar');\n            received[1].should.have.property('payload', 'topic=another bar');\n            received[1].should.have.property('template', 'topic={{topic}}');\n            received[2].should.have.property('topic', 'bar');\n            received[2].should.have.property('payload', 'payload=foo');\n            received[2].should.have.property('template', 'payload={{payload}}');\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"topic={{topic}}\"\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"another bar\",\n        template: \"topic={{topic}}\"\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\",\n        template: \"payload={{payload}}\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from env variable","suites":["template node","env var"],"updatePoint":{"line":203,"column":47,"index":6064},"line":203,"code":"    it('should modify payload from env variable', function (done) {\n      var flow = [{\n        id: \"n1\",\n        z: \"t1\",\n        type: \"template\",\n        field: \"payload\",\n        template: \"payload={{env.TEST}}\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        z: \"t1\",\n        type: \"helper\"\n      }];\n      helper.load(templateNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', 'payload=xyzzy');\n          done();\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from flow context","suites":["template node","env var"],"updatePoint":{"line":230,"column":45,"index":6752},"line":230,"code":"  it('should modify payload from flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().flow.set(\"value\", \"foo\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable flow context","suites":["template node","env var"],"updatePoint":{"line":258,"column":57,"index":7491},"line":258,"code":"  it('should modify payload from persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle nested context tags - property not set","suites":["template node","env var"],"updatePoint":{"line":289,"column":58,"index":8353},"line":289,"code":"  it('should handle nested context tags - property not set', function (done) {\n    // This comes from the Coursera Node-RED course and is a good example of\n    // multiple conditional tags\n    var template = `{{#flow.time}}time={{flow.time}}{{/flow.time}}{{^flow.time}}!time{{/flow.time}}{{#flow.random}}random={{flow.random}}randomtime={{flow.randomtime}}{{/flow.random}}{{^flow.random}}!random{{/flow.random}}`;\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: template,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', '!time!random');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle nested context tags - property set","suites":["template node","env var"],"updatePoint":{"line":325,"column":54,"index":9511},"line":325,"code":"  it('should handle nested context tags - property set', function (done) {\n    // This comes from the Coursera Node-RED course and is a good example of\n    // multiple conditional tags\n    var template = `{{#flow.time}}time={{flow.time}}{{/flow.time}}{{^flow.time}}!time{{/flow.time}}{{#flow.random}}random={{flow.random}}randomtime={{flow.randomtime}}{{/flow.random}}{{^flow.random}}!random{{/flow.random}}`;\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: template,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload', 'time=123random=456randomtime=789');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.context().flow.set([\"time\", \"random\", \"randomtime\"], [\"123\", \"456\", \"789\"], function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from two persistable flow context","suites":["template node","env var"],"updatePoint":{"line":363,"column":61,"index":10820},"line":363,"code":"  it('should modify payload from two persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}/{{flow[memory2].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().flow.set(\"value\", \"bar\", \"memory2\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from global context","suites":["template node","env var"],"updatePoint":{"line":396,"column":47,"index":11797},"line":396,"code":"  it('should modify payload from global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context().global.set(\"value\", \"foo\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable global context","suites":["template node","env var"],"updatePoint":{"line":424,"column":59,"index":12542},"line":424,"code":"  it('should modify payload from persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo');\n          done();\n        });\n        n1.context().global.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.receive({\n            payload: \"foo\",\n            topic: \"bar\"\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from two persistable global context","suites":["template node","env var"],"updatePoint":{"line":455,"column":63,"index":13413},"line":455,"code":"  it('should modify payload from two persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{global[memory1].value}}/{{global[memory2].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().global.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().global.set(\"value\", \"bar\", \"memory2\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload from persistable flow & global context","suites":["template node","env var"],"updatePoint":{"line":488,"column":66,"index":14417},"line":488,"code":"  it('should modify payload from persistable flow & global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow[memory1].value}}/{{global[memory1].value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'payload=foo/bar');\n          done();\n        });\n        n1.context().flow.set(\"value\", \"foo\", \"memory1\", function (err) {\n          n1.context().global.set(\"value\", \"bar\", \"memory1\", function (err) {\n            n1.receive({\n              payload: \"foo\",\n              topic: \"bar\"\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing node context","suites":["template node","env var"],"updatePoint":{"line":521,"column":40,"index":15391},"line":521,"code":"  it('should handle missing node context', function (done) {\n    // this is artificial test because in flow there is missing z property (probably never happen in real usage)\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{flow.value}},{{global.value}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=,');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle escape characters in Mustache format and JSON output mode","suites":["template node","env var"],"updatePoint":{"line":547,"column":77,"index":16203},"line":547,"code":"  it('should handle escape characters in Mustache format and JSON output mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      syntax: \"mustache\",\n      template: \"{\\\"data\\\":\\\"{{payload}}\\\"}\",\n      output: \"json\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.payload.should.have.property('data', 'line\\t1\\nline\\\\2\\r\\nline\\b3\\f');\n        done();\n      });\n      n1.receive({\n        payload: \"line\\t1\\nline\\\\2\\r\\nline\\b3\\f\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify payload in plain text mode","suites":["template node","env var"],"updatePoint":{"line":572,"column":46,"index":16885},"line":572,"code":"  it('should modify payload in plain text mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      syntax: \"plain\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload={{payload}}');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify flow context","suites":["template node","env var"],"updatePoint":{"line":598,"column":32,"index":17552},"line":598,"code":"  it('should modify flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      fieldType: \"flow\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        // mesage is intact\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        // result is in flow context\n        n2.context().flow.get(\"payload\").should.equal(\"payload=foo\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify persistable flow context","suites":["template node","env var"],"updatePoint":{"line":629,"column":44,"index":18382},"line":629,"code":"  it('should modify persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"#:(memory1)::payload\",\n      fieldType: \"flow\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // mesage is intact\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'foo');\n          // result is in flow context\n          n2.context().flow.get(\"payload\", \"memory1\", function (err, val) {\n            val.should.equal(\"payload=foo\");\n            done();\n          });\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify global context","suites":["template node","env var"],"updatePoint":{"line":664,"column":34,"index":19350},"line":664,"code":"  it('should modify global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"payload\",\n      fieldType: \"global\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        // mesage is intact\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'foo');\n        // result is in global context\n        n2.context().global.get(\"payload\").should.equal(\"payload=foo\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should modify persistable global context","suites":["template node","env var"],"updatePoint":{"line":695,"column":46,"index":20188},"line":695,"code":"  it('should modify persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      z: \"t1\",\n      type: \"template\",\n      field: \"#:(memory1)::payload\",\n      fieldType: \"global\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // mesage is intact\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('payload', 'foo');\n          // result is in global context\n          n2.context().global.get(\"payload\", \"memory1\", function (err, val) {\n            val.should.equal(\"payload=foo\");\n            done();\n          });\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle if the field isn't set","suites":["template node","env var"],"updatePoint":{"line":730,"column":43,"index":21171},"line":730,"code":"  it('should handle if the field isn\\'t set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      template: \"payload={{payload}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.have.property('payload', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: \"foo\",\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle deeper objects","suites":["template node","env var"],"updatePoint":{"line":754,"column":34,"index":21785},"line":754,"code":"  it('should handle deeper objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"topic.foo.bar\",\n      template: \"payload={{payload.doh.rei.me}}\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic');\n        msg.topic.should.have.property('foo');\n        msg.topic.foo.should.have.a.property('bar', 'payload=foo');\n        done();\n      });\n      n1.receive({\n        payload: {\n          doh: {\n            rei: {\n              me: \"foo\"\n            }\n          }\n        }\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should handle block contexts objects","suites":["template node","env var"],"updatePoint":{"line":785,"column":42,"index":22566},"line":785,"code":"  it('should handle block contexts objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      template: \"A{{#payload.A}}{{payload.A}}{{.}}{{/payload.A}}B\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('payload', 'AabcabcB');\n        done();\n      });\n      n1.receive({\n        payload: {\n          A: \"abc\"\n        }\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should raise error if passed bad template","suites":["template node","env var"],"updatePoint":{"line":809,"column":47,"index":23172},"line":809,"code":"  it('should raise error if passed bad template', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"template\",\n      field: \"payload\",\n      template: \"payload={{payload\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(templateNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"template\";\n        });\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"Unclosed tag at \");\n        done();\n      }, 25);\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/core/function/80-template_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["delay Node"],"updatePoint":{"line":36,"column":22,"index":1309},"line":36,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"day\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 86400000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set rate to hour","suites":["delay Node"],"updatePoint":{"line":60,"column":40,"index":1995},"line":60,"code":"  it('should be able to set rate to hour', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"hour\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 3600000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set rate to minute","suites":["delay Node"],"updatePoint":{"line":84,"column":42,"index":2683},"line":84,"code":"  it('should be able to set rate to minute', function (done) {\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"nbRateUnits\": \"1\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": \"5\",\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": \"1\",\n      \"rateUnits\": \"minute\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[]]\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      delayNode1.should.have.property('name', 'delayNode');\n      delayNode1.should.have.property('rate', 60000);\n      done();\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in seconds","suites":["delay Node"],"updatePoint":{"line":207,"column":35,"index":6806},"line":207,"code":"  it('delays the message in seconds', function (done) {\n    genericDelayTest(0.5, \"seconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":210,"column":40,"index":6917},"line":210,"code":"  it('delays the message in milliseconds', function (done) {\n    genericDelayTest(500, \"milliseconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in minutes","suites":["delay Node"],"updatePoint":{"line":213,"column":35,"index":7028},"line":213,"code":"  it('delays the message in minutes', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.00833, \"minutes\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in hours","suites":["delay Node"],"updatePoint":{"line":217,"column":33,"index":7168},"line":217,"code":"  it('delays the message in hours', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.0001388, \"hours\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in days","suites":["delay Node"],"updatePoint":{"line":221,"column":32,"index":7307},"line":221,"code":"  it('delays the message in days', function (done) {\n    // this is also 0.5 seconds\n    genericDelayTest(0.000005787, \"days\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per second","suites":["delay Node"],"updatePoint":{"line":296,"column":45,"index":9974},"line":296,"code":"  it('limits the message rate to 1 per second', function (done) {\n    genericRateLimitSECONDSTest(1, 1, 1500, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per 2 seconds","suites":["delay Node"],"updatePoint":{"line":299,"column":48,"index":10106},"line":299,"code":"  it('limits the message rate to 1 per 2 seconds', function (done) {\n    this.timeout(6000);\n    genericRateLimitSECONDSTest(1, 2, 3000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per seconds, 2 seconds","suites":["delay Node"],"updatePoint":{"line":303,"column":57,"index":10271},"line":303,"code":"  it('limits the message rate to 2 per seconds, 2 seconds', function (done) {\n    this.timeout(6000);\n    genericRateLimitSECONDSTest(2, 1, 2100, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate using msg.rate","suites":["delay Node"],"updatePoint":{"line":307,"column":44,"index":10423},"line":307,"code":"  it('limits the message rate using msg.rate', function (done) {\n    RED.settings.nodeMessageBufferMaxLength = 3;\n    genericRateLimitSECONDSTest(1, 1, 1500, 2000, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per second, 4 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":423,"column":67,"index":14514},"line":423,"code":"  it('limits the message rate to 1 per second, 4 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(1, 1, 4000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 1 per 2 seconds, 4 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":427,"column":70,"index":14689},"line":427,"code":"  it('limits the message rate to 1 per 2 seconds, 4 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(1, 2, 4500, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per second, 5 seconds, with drop","suites":["delay Node"],"updatePoint":{"line":431,"column":67,"index":14861},"line":431,"code":"  it('limits the message rate to 2 per second, 5 seconds, with drop', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(2, 1, 5000, null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate to 2 per second, 5 seconds, with drop, 2nd output","suites":["delay Node"],"updatePoint":{"line":435,"column":79,"index":15045},"line":435,"code":"  it('limits the message rate to 2 per second, 5 seconds, with drop, 2nd output', function (done) {\n    this.timeout(6000);\n    dropRateLimitSECONDSTest(2, 1, 5000, null, true, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"limits the message rate with drop using msg.rate","suites":["delay Node"],"updatePoint":{"line":439,"column":54,"index":15210},"line":439,"code":"  it('limits the message rate with drop using msg.rate', function (done) {\n    this.timeout(6000);\n    RED.settings.nodeMessageBufferMaxLength = 3;\n    dropRateLimitSECONDSTest(2, 1, 5000, 1000, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay set by msg.delay the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":541,"column":65,"index":19578},"line":541,"code":"  it('variable delay set by msg.delay the message in milliseconds', function (done) {\n    variableDelayTest(\"200\", \"300\", \"milliseconds\", 250, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is the default if msg.delay not specified","suites":["delay Node"],"updatePoint":{"line":544,"column":62,"index":19731},"line":544,"code":"  it('variable delay is the default if msg.delay not specified', function (done) {\n    variableDelayTest(\"450\", \"550\", \"milliseconds\", null, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is zero if msg.delay is zero","suites":["delay Node"],"updatePoint":{"line":547,"column":49,"index":19872},"line":547,"code":"  it('variable delay is zero if msg.delay is zero', function (done) {\n    variableDelayTest(\"0\", \"20\", \"milliseconds\", 0, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"variable delay is zero if msg.delay is negative","suites":["delay Node"],"updatePoint":{"line":550,"column":53,"index":20011},"line":550,"code":"  it('variable delay is zero if msg.delay is negative', function (done) {\n    variableDelayTest(\"0\", \"20\", \"milliseconds\", -250, done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in seconds","suites":["delay Node"],"updatePoint":{"line":627,"column":44,"index":23251},"line":627,"code":"  it('randomly delays the message in seconds', function (done) {\n    randomDelayTest(0.4, 0.8, \"seconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in milliseconds","suites":["delay Node"],"updatePoint":{"line":630,"column":49,"index":23375},"line":630,"code":"  it('randomly delays the message in milliseconds', function (done) {\n    randomDelayTest(\"400\", \"800\", \"milliseconds\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"randomly delays the message in minutes","suites":["delay Node"],"updatePoint":{"line":633,"column":44,"index":23503},"line":633,"code":"  it('randomly delays the message in minutes', function (done) {\n    randomDelayTest(0.0066, 0.0133, \"minutes\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in hours","suites":["delay Node"],"updatePoint":{"line":636,"column":33,"index":23617},"line":636,"code":"  it('delays the message in hours', function (done) {\n    randomDelayTest(0.000111111, 0.000222222, \"hours\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"delays the message in days","suites":["delay Node"],"updatePoint":{"line":639,"column":32,"index":23738},"line":639,"code":"  it('delays the message in days', function (done) {\n    randomDelayTest(0.0000046296, 0.0000092593, \"days\", done);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"handles delay queue","suites":["delay Node"],"updatePoint":{"line":642,"column":25,"index":23853},"line":642,"code":"  it('handles delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      id: \"delayNode1\",\n      type: \"delay\",\n      \"name\": \"delayNode\",\n      \"nbRateUnits\": \"1\",\n      \"pauseType\": \"queue\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 4,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"_none_\") {\n            msg.payload.should.equal(2);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else if (msg.topic === \"A\") {\n            msg.payload.should.equal(4);\n            (Date.now() - t).should.be.approximately(750, 200);\n          } else {\n            msg.topic.should.equal(\"B\");\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(1000, 200);\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      setTimeout(function () {\n        // send test messages\n        delayNode1.receive({\n          payload: 1\n        }); // send something with blank topic\n        delayNode1.receive({\n          payload: 1,\n          topic: \"A\"\n        }); // and something with a fixed topic\n        delayNode1.receive({\n          payload: 1,\n          topic: \"B\"\n        }); // and something else with a fixed topic (3rd tick)\n        delayNode1.receive({\n          payload: 2,\n          topic: \"A\"\n        }); // these should replace them in queue\n        delayNode1.receive({\n          payload: 3,\n          topic: \"A\"\n        }); //  ditto\n        delayNode1.receive({\n          payload: 2\n        }); // so only this should get out on first tick\n        delayNode1.receive({\n          payload: 4,\n          topic: \"A\"\n        }); // and this one on second tick\n      }, 275); // wait one tick beofre starting.. (to test no messages in queue path.)\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"handles timed queue","suites":["delay Node"],"updatePoint":{"line":720,"column":25,"index":26222},"line":720,"code":"  it('handles timed queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"timed\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"_none_\") {\n            msg.payload.should.equal(2);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else if (msg.topic === \"A\") {\n            msg.payload.should.equal(4);\n            (Date.now() - t).should.be.approximately(500, 200);\n          } else {\n            msg.topic.should.equal(\"B\");\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(500, 200);\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1\n      }); // send something with blank topic\n      delayNode1.receive({\n        payload: 1,\n        topic: \"A\"\n      }); // and something with a fixed topic\n      delayNode1.receive({\n        payload: 1,\n        topic: \"B\"\n      }); // and something else with a fixed topic\n      delayNode1.receive({\n        payload: 2,\n        topic: \"A\"\n      }); // these should replace them in queue\n      delayNode1.receive({\n        payload: 3,\n        topic: \"A\"\n      }); //  ditto\n      delayNode1.receive({\n        payload: 2\n      }); // so all should go on first tick\n      delayNode1.receive({\n        payload: 4,\n        topic: \"A\"\n      }); //  and nothing on second\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can flush delay queue","suites":["delay Node"],"updatePoint":{"line":796,"column":27,"index":28372},"line":796,"code":"  it('can flush delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else {\n            if (msg.topic === \"bar\") {\n              msg.payload.should.equal(1);\n              (Date.now() - t).should.be.approximately(0, 100);\n              c = c + 1;\n            }\n          }\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part flush delay queue","suites":["delay Node"],"updatePoint":{"line":882,"column":32,"index":30673},"line":882,"code":"  it('can part flush delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else if (msg.topic === \"bar\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(200, 100);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(400, 100);\n            c = c + 1;\n          }\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 2\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can reset delay queue","suites":["delay Node"],"updatePoint":{"line":979,"column":27,"index":33123},"line":979,"code":"  it('can reset delay queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"delay\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        c = c + 1;\n      });\n      setTimeout(function () {\n        if (c === 0) {\n          done();\n        }\n      }, 700);\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          reset: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can flush rate limit queue","suites":["delay Node"],"updatePoint":{"line":1051,"column":32,"index":34947},"line":1051,"code":"  it('can flush rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else {\n            if (msg.topic === \"bar\") {\n              msg.payload.should.equal(1);\n              (Date.now() - t).should.be.approximately(0, 100);\n              c = c + 1;\n            }\n          }\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part flush rate limit queue","suites":["delay Node"],"updatePoint":{"line":1137,"column":37,"index":37252},"line":1137,"code":"  it('can part flush rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          } else if (msg.topic === \"bar\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(200, 100);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(400, 100);\n            c = c + 1;\n          }\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"foo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 2\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can part push to front of rate limit queue","suites":["delay Node"],"updatePoint":{"line":1234,"column":48,"index":39722},"line":1234,"code":"  it('can part push to front of rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 1,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"aoo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(2, 50);\n            c = c + 1;\n          } else if (msg.topic === \"eoo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(4, 50);\n            c = c + 1;\n          } else if (msg.topic === \"coo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(202, 50);\n            c = c + 1;\n          } else if (msg.topic === \"boo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(406, 50);\n            c = c + 1;\n          } else if (msg.topic === \"doo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(4, 50);\n            c = c + 1;\n          }\n          if (c === 5) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"aoo\"\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"boo\"\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"coo\",\n          toFront: true\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"doo\",\n          toFront: true,\n          flush: 1\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"eoo\",\n          toFront: true\n        });\n      });\n      setImmediate(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      });\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 1\n        });\n      }, 200);\n      setTimeout(function () {\n        delayNode1.receive({\n          flush: 4\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"can reset rate limit queue","suites":["delay Node"],"updatePoint":{"line":1343,"column":32,"index":42606},"line":1343,"code":"  it('can reset rate limit queue', function (done) {\n    this.timeout(2000);\n    var flow = [{\n      \"id\": \"delayNode1\",\n      \"type\": \"delay\",\n      \"name\": \"delayNode\",\n      \"pauseType\": \"rate\",\n      \"timeout\": 1,\n      \"timeoutUnits\": \"seconds\",\n      \"rate\": 2,\n      \"rateUnits\": \"second\",\n      \"randomFirst\": \"1\",\n      \"randomLast\": \"5\",\n      \"randomUnits\": \"seconds\",\n      \"drop\": false,\n      \"wires\": [[\"helperNode1\"]]\n    }, {\n      id: \"helperNode1\",\n      type: \"helper\",\n      wires: []\n    }];\n    helper.load(delayNode, flow, function () {\n      var delayNode1 = helper.getNode(\"delayNode1\");\n      var helperNode1 = helper.getNode(\"helperNode1\");\n      var t = Date.now();\n      var c = 0;\n      helperNode1.on(\"input\", function (msg) {\n        msg.should.have.a.property('payload');\n        msg.should.have.a.property('topic');\n        try {\n          if (msg.topic === \"foo\") {\n            msg.payload.should.equal(1);\n            (Date.now() - t).should.be.approximately(0, 100);\n            c = c + 1;\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      setTimeout(function () {\n        if (c === 1) {\n          done();\n        }\n      }, 700);\n\n      // send test messages\n      delayNode1.receive({\n        payload: 1,\n        topic: \"foo\"\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          payload: 1,\n          topic: \"bar\"\n        });\n      }); // send something with blank topic\n      setImmediate(function () {\n        delayNode1.receive({\n          reset: true\n        });\n      }); // reset the queue\n    });\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delay)","suites":["delay Node"],"updatePoint":{"line":1475,"column":61,"index":46285},"line":1475,"code":"  it('calls done when queued message is emitted (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1484,"column":62,"index":46504},"line":1484,"code":"  it('calls done when queued message is emitted (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is emitted (type: delay)","suites":["delay Node"],"updatePoint":{"line":1494,"column":61,"index":46744},"line":1494,"code":"  it('calls done when queued message is emitted (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: delay)","suites":["delay Node"],"updatePoint":{"line":1503,"column":61,"index":46963},"line":1503,"code":"  it('calls done when queued message is cleared (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1519,"column":62,"index":47283},"line":1519,"code":"  it('calls done when queued message is cleared (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is cleared (type: random)","suites":["delay Node"],"updatePoint":{"line":1536,"column":62,"index":47625},"line":1536,"code":"  it('calls done when queued message is cleared (type: random)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: delay)","suites":["delay Node"],"updatePoint":{"line":1552,"column":61,"index":47945},"line":1552,"code":"  it('calls done when queued message is flushed (type: delay)', function (done) {\n    mapiDoneTestHelper(done, \"delay\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: delayv)","suites":["delay Node"],"updatePoint":{"line":1568,"column":62,"index":48265},"line":1568,"code":"  it('calls done when queued message is flushed (type: delayv)', function (done) {\n    mapiDoneTestHelper(done, \"delayv\", false, [{\n      msg: {\n        payload: 1,\n        delay: 1000\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued message is flushed (type: random)","suites":["delay Node"],"updatePoint":{"line":1585,"column":62,"index":48607},"line":1585,"code":"  it('calls done when queued message is flushed (type: random)', function (done) {\n    mapiDoneTestHelper(done, \"random\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 100,\n      var: 100\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 100,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is emitted (drop: false)","suites":["delay Node"],"updatePoint":{"line":1601,"column":60,"index":48926},"line":1601,"code":"  it('calls done when rated message is emitted (drop: false)', function (done) {\n    mapiDoneTestHelper(done, \"rate\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 1000,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is emitted (drop: true)","suites":["delay Node"],"updatePoint":{"line":1616,"column":59,"index":49220},"line":1616,"code":"  it('calls done when rated message is emitted (drop: true)', function (done) {\n    mapiDoneTestHelper(done, \"rate\", true, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 0,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when rated message is flushed","suites":["delay Node"],"updatePoint":{"line":1631,"column":46,"index":49497},"line":1631,"code":"  it('calls done when rated message is flushed', function (done) {\n    mapiDoneTestHelper(done, \"rate\", false, [{\n      msg: {\n        payload: 1\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 2\n      },\n      avr: 0,\n      var: 100\n    }, {\n      msg: {\n        payload: 3,\n        flush: true\n      },\n      avr: 0,\n      var: 100\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued messages are sent (queue)","suites":["delay Node"],"updatePoint":{"line":1653,"column":54,"index":49883},"line":1653,"code":"  it('calls done when queued messages are sent (queue)', function (done) {\n    this.timeout(3000);\n    mapiDoneTestHelper(done, \"queue\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"A\"\n      },\n      avr: 1000,\n      var: 700\n    }, {\n      msg: {\n        payload: 2,\n        topic: \"B\"\n      },\n      avr: 2000,\n      var: 700\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queued messages are sent (timed)","suites":["delay Node"],"updatePoint":{"line":1671,"column":54,"index":50240},"line":1671,"code":"  it('calls done when queued messages are sent (timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 500,\n      var: 700\n    }, {\n      msg: {\n        payload: 2,\n        topic: \"b\"\n      },\n      avr: 500,\n      var: 700\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queue is reset (queue/timed)","suites":["delay Node"],"updatePoint":{"line":1688,"column":50,"index":50567},"line":1688,"code":"  it('calls done when queue is reset (queue/timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 0,\n      var: 500\n    }, {\n      msg: {\n        payload: 2,\n        reset: true\n      },\n      avr: 0,\n      var: 500\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"calls done when queue is flushed (queue/timed)","suites":["delay Node"],"updatePoint":{"line":1705,"column":52,"index":50893},"line":1705,"code":"  it('calls done when queue is flushed (queue/timed)', function (done) {\n    mapiDoneTestHelper(done, \"timed\", false, [{\n      msg: {\n        payload: 1,\n        topic: \"a\"\n      },\n      avr: 0,\n      var: 500\n    }, {\n      msg: {\n        payload: 2,\n        flush: true\n      },\n      avr: 0,\n      var: 500\n    }]);\n  });","file":"nodes/core/function/89-delay_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with correct defaults","suites":["trigger node"],"updatePoint":{"line":56,"column":44,"index":1730},"line":56,"code":"  it(\"should be loaded with correct defaults\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'triggerNode');\n      n1.should.have.property('op1', '1');\n      n1.should.have.property('op2', '0');\n      n1.should.have.property('op1type', 'str');\n      n1.should.have.property('op2type', 'str');\n      n1.should.have.property('extend', \"false\");\n      n1.should.have.property('units', 'ms');\n      n1.should.have.property('duration', 250);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in seconds","suites":["trigger node"],"updatePoint":{"line":76,"column":44,"index":2409},"line":76,"code":"  it(\"should be able to set delay in seconds\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"s\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 1000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in minutes","suites":["trigger node"],"updatePoint":{"line":91,"column":44,"index":2794},"line":91,"code":"  it(\"should be able to set delay in minutes\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"min\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 60000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set delay in hours","suites":["trigger node"],"updatePoint":{"line":106,"column":42,"index":3180},"line":106,"code":"  it(\"should be able to set delay in hours\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      units: \"hr\",\n      duration: \"1\",\n      \"wires\": [[]]\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('duration', 3600000);\n      done();\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should output 1 then 0 when triggered (default)","suites":["trigger node"],"updatePoint":{"line":213,"column":53,"index":6151},"line":213,"code":"  it('should output 1 then 0 when triggered (default)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"20\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", '1');\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", '0');\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should ignore any other inputs while triggered if extend is false","suites":["trigger node"],"updatePoint":{"line":246,"column":71,"index":6967},"line":246,"code":"  it('should ignore any other inputs while triggered if extend is false', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var errored = false;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", '1');\n          } else {\n            msg.should.have.a.property(\"payload\", '0');\n          }\n          c += 1;\n        } catch (err) {\n          errored = true;\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (!errored) {\n          try {\n            c.should.equal(2);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      }, 100);\n      n1.emit(\"input\", {\n        payload: null\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 10);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 30);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should ignore msg.delay if overrideDelay not set","suites":["trigger node"],"updatePoint":{"line":300,"column":54,"index":8221},"line":300,"code":"  it('should ignore msg.delay if overrideDelay not set', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var firstTime;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          firstTime = Date.now();\n        } else if (c === 1) {\n          try {\n            var delta = Date.now() - firstTime;\n            delta.should.be.greaterThan(30);\n            delta.should.be.lessThan(100);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n        c++;\n      });\n      n1.emit(\"input\", {\n        payload: null,\n        delay: 300\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.delay if overrideDelay is set","suites":["trigger node"],"updatePoint":{"line":337,"column":50,"index":9123},"line":337,"code":"  it('should use msg.delay if overrideDelay is set', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      overrideDelay: true,\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var firstTime;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          firstTime = Date.now();\n        } else if (c === 1) {\n          try {\n            var delta = Date.now() - firstTime;\n            delta.should.be.greaterThan(270);\n            delta.should.be.lessThan(380);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n        c++;\n      });\n      n1.emit(\"input\", {\n        payload: null,\n        delay: 300\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle true and false as strings and delay of 0","suites":["trigger node"],"updatePoint":{"line":375,"column":60,"index":10063},"line":375,"code":"  it('should handle true and false as strings and delay of 0', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      op2type: \"val\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", true);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", false);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics as one if not asked to handle","suites":["trigger node"],"updatePoint":{"line":412,"column":65,"index":10959},"line":412,"code":"  it('should handle multiple topics as one if not asked to handle', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"all\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics individually if asked to do so","suites":["trigger node"],"updatePoint":{"line":461,"column":66,"index":12148},"line":461,"code":"  it('should handle multiple topics individually if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"C\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple topics individually, and extend one, if asked to do so","suites":["trigger node"],"updatePoint":{"line":522,"column":83,"index":13916},"line":522,"code":"  it('should handle multiple topics individually, and extend one, if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      extend: \"true\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"C\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"topic\", \"B\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        topic: \"C\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"B\"\n        });\n      }, 20);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle multiple other properties individually if asked to do so","suites":["trigger node"],"updatePoint":{"line":590,"column":76,"index":15826},"line":590,"code":"  it('should handle multiple other properties individually if asked to do so', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      bytopic: \"topic\",\n      topic: \"foo\",\n      op1: \"1\",\n      op2: \"0\",\n      op1type: \"num\",\n      op2type: \"num\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"A\");\n          } else if (c === 2) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"B\");\n          } else if (c === 3) {\n            msg.should.have.a.property(\"payload\", 1);\n            msg.should.have.a.property(\"foo\", \"C\");\n          } else if (c === 4) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"A\");\n          } else if (c === 5) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"B\");\n          } else if (c === 6) {\n            msg.should.have.a.property(\"payload\", 0);\n            msg.should.have.a.property(\"foo\", \"C\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 1,\n        foo: \"A\"\n      });\n      n1.emit(\"input\", {\n        payload: 2,\n        foo: \"B\"\n      });\n      n1.emit(\"input\", {\n        payload: 3,\n        foo: \"C\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from flow and global context variables","suites":["trigger node"],"updatePoint":{"line":652,"column":76,"index":17589},"line":652,"code":"  it('should be able to return things from flow and global context variables', function (done) {\n    var spy = sinon.stub(RED.util, 'evaluateNodeProperty').callsFake(function (arg1, arg2, arg3, arg4, arg5) {\n      if (arg5) {\n        arg5(null, arg1);\n      } else {\n        return arg1;\n      }\n    });\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1: \"foo\",\n      op1type: \"flow\",\n      op2: \"bar\",\n      op2type: \"global\",\n      duration: \"20\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"foo\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"bar\");\n            RED.util.evaluateNodeProperty.restore();\n            done();\n          }\n        } catch (err) {\n          RED.util.evaluateNodeProperty.restore();\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from persistable flow and global context variables","suites":["trigger node"],"updatePoint":{"line":698,"column":88,"index":18821},"line":698,"code":"  it('should be able to return things from persistable flow and global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      \"op1\": \"#:(memory1)::foo\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory1)::bar\",\n      \"op2type\": \"global\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"z\": \"flow\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (c === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n              c += 1;\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n1.context();\n        var flow = context.flow;\n        var global = context.global;\n        flow.set(\"foo\", \"foo\", \"memory1\", function (err) {\n          global.set(\"bar\", \"bar\", \"memory1\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable global context variables","suites":["trigger node"],"updatePoint":{"line":745,"column":88,"index":20149},"line":745,"code":"  it('should be able to return things from multiple persistable global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"global\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"global\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n            count++;\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var global = n1.context().global;\n        global.set(\"val\", \"foo\", \"memory1\", function (err) {\n          global.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable flow context variables","suites":["trigger node"],"updatePoint":{"line":791,"column":86,"index":21438},"line":791,"code":"  it('should be able to return things from multiple persistable flow context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"flow\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n            count++;\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var flow = n1.context().flow;\n        flow.set(\"val\", \"foo\", \"memory1\", function (err) {\n          flow.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return things from multiple persistable flow & global context variables","suites":["trigger node"],"updatePoint":{"line":837,"column":95,"index":22724},"line":837,"code":"  it('should be able to return things from multiple persistable flow & global context variables', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"z\": \"flow\",\n      \"type\": \"trigger\",\n      \"duration\": \"20\",\n      \"wires\": [[\"n2\"]],\n      \"op1\": \"#:(memory1)::val\",\n      \"op1type\": \"flow\",\n      \"op2\": \"#:(memory2)::val\",\n      \"op2type\": \"global\"\n    }, {\n      \"id\": \"n2\",\n      \"type\": \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            if (count === 0) {\n              msg.should.have.a.property(\"payload\", \"foo\");\n            } else {\n              msg.should.have.a.property(\"payload\", \"bar\");\n            }\n            count++;\n            if (count === 1) {\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        var context = n1.context();\n        var flow = context.flow;\n        var global = context.flow;\n        flow.set(\"val\", \"foo\", \"memory1\", function (err) {\n          global.set(\"val\", \"bar\", \"memory2\", function (err) {\n            n1.emit(\"input\", {\n              payload: null\n            });\n          });\n        });\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to not output anything on first trigger","suites":["trigger node"],"updatePoint":{"line":885,"column":60,"index":24045},"line":885,"code":"  it('should be able to not output anything on first trigger', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"nul\",\n      op1: \"true\",\n      op2: \"false\",\n      op2type: \"val\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", false);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to not output anything on second edge","suites":["trigger node"],"updatePoint":{"line":916,"column":58,"index":24780},"line":916,"code":"  it('should be able to not output anything on second edge', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op2type: \"nul\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      duration: \"30\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        c.should.equal(1); // should only have had one output.\n        done();\n      }, 90);\n      n1.emit(\"input\", {\n        payload: null\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to reset correctly having not output anything on second edge","suites":["trigger node"],"updatePoint":{"line":952,"column":81,"index":25678},"line":952,"code":"  it('should be able to reset correctly having not output anything on second edge', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op2type: \"nul\",\n      op1: \"true\",\n      op1type: \"val\",\n      op2: \"false\",\n      duration: \"100\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      var errors = [];\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"topic\", \"pass\");\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } catch (err) {\n          errors.push(err);\n        }\n      });\n      setTimeout(function () {\n        if (errors.length > 0) {\n          done(errors[0]);\n        } else {\n          c.should.equal(2);\n          done();\n        }\n      }, 350);\n      n1.emit(\"input\", {\n        payload: 1,\n        topic: \"pass\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"should-block\"\n        });\n      }, 50);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 3,\n          topic: \"pass\"\n        });\n      }, 200);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: 2,\n          topic: \"should-block\"\n        });\n      }, 250);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay","suites":["trigger node"],"updatePoint":{"line":1013,"column":40,"index":27105},"line":1013,"code":"  it('should be able to extend the delay', function (done) {\n    this.timeout(5000); // add extra time for flake\n    var spy = sinon.stub(RED.util, 'evaluateNodeProperty').callsFake(function (arg1, arg2, arg3, arg4, arg5) {\n      if (arg5) {\n        arg5(null, arg1);\n      } else {\n        return arg1;\n      }\n    });\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"flow\",\n      op1: \"foo\",\n      op2: \"bar\",\n      op2type: \"global\",\n      duration: \"100\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"foo\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"bar\");\n            //console.log(Date.now() - ss);\n            (Date.now() - ss).should.be.greaterThan(149);\n            spy.restore();\n            done();\n          }\n        } catch (err) {\n          spy.restore();\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: null\n        });\n      }, 50);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay (but with no 2nd output)","suites":["trigger node"],"updatePoint":{"line":1069,"column":65,"index":28577},"line":1069,"code":"  it('should be able to extend the delay (but with no 2nd output)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"pay\",\n      op2type: \"nul\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"200\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Hello\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            (Date.now() - ss).should.be.greaterThan(300);\n            done();\n          }\n        } catch (err) {\n          console.log(err);\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Error\"\n        });\n      }, 50);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Error\"\n        });\n      }, 100);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\"\n        });\n      }, 330);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to extend the delay and output the most recent payload","suites":["trigger node"],"updatePoint":{"line":1125,"column":75,"index":29962},"line":1125,"code":"  it('should be able to extend the delay and output the most recent payload', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"true\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"60\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property(\"payload\", \"World\");\n          (Date.now() - ss).should.be.greaterThan(120);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye\"\n        });\n      }, 40);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\"\n        });\n      }, 80);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able output the 2nd payload","suites":["trigger node"],"updatePoint":{"line":1170,"column":43,"index":31034},"line":1170,"code":"  it('should be able output the 2nd payload', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"false\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Goodbye\");\n            msg.should.have.a.property(\"topic\", \"test2\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            msg.should.have.a.property(\"topic\", \"test3\");\n            (Date.now() - ss).should.be.greaterThan(70);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var ss = Date.now();\n      n1.emit(\"input\", {\n        payload: \"Hello\",\n        topic: \"test1\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"World\",\n          topic: \"test3\"\n        });\n      }, 80);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able output the 2nd payload and handle multiple topics","suites":["trigger node"],"updatePoint":{"line":1225,"column":70,"index":32469},"line":1225,"code":"  it('should be able output the 2nd payload and handle multiple topics', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      extend: \"false\",\n      op1type: \"nul\",\n      op2type: \"payl\",\n      op1: \"false\",\n      op2: \"true\",\n      duration: \"80\",\n      bytopic: \"topic\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Goodbye1\");\n            msg.should.have.a.property(\"topic\", \"test1\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"Goodbye2\");\n            msg.should.have.a.property(\"topic\", \"test2\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"Hello1\",\n        topic: \"test1\"\n      });\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Hello2\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye2\",\n          topic: \"test2\"\n        });\n      }, 20);\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          payload: \"Goodbye1\",\n          topic: \"test1\"\n        });\n      }, 20);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to apply mustache templates to payloads","suites":["trigger node"],"updatePoint":{"line":1285,"column":60,"index":33981},"line":1285,"code":"  it('should be able to apply mustache templates to payloads', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"{{payload}}\",\n      op2: \"{{topic}}\",\n      duration: \"50\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"Hello\");\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"Hello\",\n        topic: \"World\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to send 2nd message to a 2nd output","suites":["trigger node"],"updatePoint":{"line":1323,"column":56,"index":34911},"line":1323,"code":"  it('should be able to send 2nd message to a 2nd output', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"hello\",\n      op2: \"world\",\n      duration: \"50\",\n      outputs: 2,\n      wires: [[\"n2\"], [\"n3\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }, {\n      id: \"n3\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var n3 = helper.getNode(\"n3\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", \"hello\");\n            msg.should.have.a.property(\"topic\", \"test\");\n            c += 1;\n          } else {\n            done(err);\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n3.on(\"input\", function (msg) {\n        try {\n          if (c === 1) {\n            msg.should.have.a.property(\"payload\", \"world\");\n            msg.should.have.a.property(\"topic\", \"test\");\n            done();\n          } else {\n            done(err);\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"go\",\n        topic: \"test\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle string null as null","suites":["trigger node"],"updatePoint":{"line":1379,"column":39,"index":36252},"line":1379,"code":"  it('should handle string null as null', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"pay\",\n      op1: \"null\",\n      op2: \"null\",\n      duration: \"40\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", null);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", \"World\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"World\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should handle string null as null on op2","suites":["trigger node"],"updatePoint":{"line":1416,"column":46,"index":37133},"line":1416,"code":"  it('should handle string null as null on op2', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      op1type: \"val\",\n      op2type: \"val\",\n      op1: \"null\",\n      op2: \"null\",\n      duration: \"40\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          if (c === 0) {\n            msg.should.have.a.property(\"payload\", null);\n            c += 1;\n          } else {\n            msg.should.have.a.property(\"payload\", null);\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"null\"\n      });\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout","suites":["trigger node"],"updatePoint":{"line":1453,"column":63,"index":38027},"line":1453,"code":"  it('should be able to set infinite timeout, and clear timeout', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      duration: \"0\",\n      extend: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        reset: true\n      }); // clear the blockage\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by message","suites":["trigger node"],"updatePoint":{"line":1502,"column":74,"index":39193},"line":1502,"code":"  it('should be able to set infinite timeout, and clear timeout by message', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"boo\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // don't clear the blockage\n      n1.emit(\"input\", {\n        payload: \"boo\"\n      }); // clear the blockage\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 50);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by boolean true","suites":["trigger node"],"updatePoint":{"line":1553,"column":79,"index":40451},"line":1553,"code":"  it('should be able to set infinite timeout, and clear timeout by boolean true', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"true\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: false\n      }); // don't clear the blockage\n      n1.emit(\"input\", {\n        payload: true\n      }); // clear the blockage\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set infinite timeout, and clear timeout by boolean false","suites":["trigger node"],"updatePoint":{"line":1605,"column":80,"index":41711},"line":1605,"code":"  it('should be able to set infinite timeout, and clear timeout by boolean false', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"false\",\n      duration: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          c += 1;\n          msg.should.have.a.property(\"payload\", \"1\");\n        } catch (err) {\n          done(err);\n        }\n      });\n      setTimeout(function () {\n        if (c === 2) {\n          done();\n        } else {\n          done(new Error(\"Too many messages received\"));\n        }\n      }, 20);\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: null\n      }); // blocked\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // don't clear the blockage\n      n1.emit(\"input\", {\n        payload: false\n      }); // clear the blockage\n      n1.emit(\"input\", {\n        payload: null\n      }); // trigger\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be able to set a repeat, and clear loop by reset","suites":["trigger node"],"updatePoint":{"line":1657,"column":61,"index":42954},"line":1657,"code":"  it('should be able to set a repeat, and clear loop by reset', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"trigger\",\n      \"name\": \"triggerNode\",\n      reset: \"boo\",\n      op1: \"\",\n      op1type: \"pay\",\n      duration: -25,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(triggerNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c += 1;\n        try {\n          msg.should.have.property('payload', 'foo');\n          msg.payload = \"bar\"; // try to provoke pass by reference error\n        } catch (err) {\n          done(err);\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // trigger\n      n1.emit(\"input\", {\n        payload: \"foo\"\n      }); // trigger\n      setTimeout(function () {\n        n1.emit(\"input\", {\n          reset: true\n        }); // reset\n      }, 90);\n      setTimeout(function () {\n        c.should.within(2, 5); // should send foo between 2 and 5 times.\n        done();\n      }, 180);\n    });\n  });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when first message has been processed","suites":["trigger node","messaging API"],"updatePoint":{"line":1749,"column":64,"index":45771},"line":1749,"code":"    it('should call done() when first message has been processed', function (done) {\n      // not when second and more messages are emitted.\n      mapiDoneTriggerTestHelper(done, {\n        units: \"s\",\n        duration: \"1\"\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\"\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when it receives reset message","suites":["trigger node","messaging API"],"updatePoint":{"line":1764,"column":57,"index":46136},"line":1764,"code":"    it('should call done() when it receives reset message', function (done) {\n      mapiDoneTriggerTestHelper(done, {\n        units: \"s\",\n        duration: \"1\"\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          reset: true\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/function/89-trigger_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with any defaults","suites":["exec node"],"updatePoint":{"line":32,"column":40,"index":1181},"line":32,"code":"  it('should be loaded with any defaults', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"exec\",\n      name: \"exec1\"\n    }];\n    helper.load(execNode, flow, function () {\n      try {\n        var n1 = helper.getNode(\"n1\");\n        n1.should.have.property(\"name\", \"exec1\");\n        n1.should.have.property(\"cmd\", \"\");\n        n1.should.have.property(\"append\", \"\");\n        n1.should.have.property(\"addpay\", \"payload\");\n        n1.should.have.property(\"timer\", 0);\n        n1.should.have.property(\"oldrc\", \"false\");\n        n1.should.have.property(\"execOpt\");\n        n1.execOpt.should.have.property(\"encoding\", 'binary');\n        n1.execOpt.should.have.property(\"maxBuffer\", 10000000);\n        n1.execOpt.should.have.property(\"windowsHide\", false);\n        n1.should.have.property(\"spawnOpt\");\n        n1.spawnOpt.should.have.property(\"windowsHide\", false);\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command","suites":["exec node","calling exec"],"updatePoint":{"line":60,"column":36,"index":2171},"line":60,"code":"    it('should exec a simple command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n        var completeTest = function () {\n          received = received + 1;\n          if (received < 3) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 0);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command with appended value from message","suites":["exec node","calling exec"],"updatePoint":{"line":135,"column":69,"index":4486},"line":135,"code":"    it('should exec a simple command with appended value from message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"]],\n        command: \"echo\",\n        addpay: \"topic\",\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"bar more\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          topic: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should exec a simple command with extra parameters","suites":["exec node","calling exec"],"updatePoint":{"line":167,"column":58,"index":5331},"line":167,"code":"    it('should exec a simple command with extra parameters', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: \"payload\",\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n        var completeTest = function () {\n          received++;\n          if (received < 2) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo and more\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO AND MORE\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to return a binary buffer","suites":["exec node","calling exec"],"updatePoint":{"line":236,"column":48,"index":7417},"line":236,"code":"    it('should be able to return a binary buffer', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: true,\n        append: \"more\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3(\"error\", Buffer.from([0x01, 0x02, 0x03, 0x88]), Buffer.from([0x01, 0x02, 0x03, 0x88]));\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          //console.log(\"n2\",msg);\n          try {\n            msg.should.have.property(\"payload\");\n            Buffer.isBuffer(msg.payload).should.be.true();\n            msg.payload.length.should.equal(4);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to timeout a long running command","suites":["exec node","calling exec"],"updatePoint":{"line":281,"column":56,"index":8799},"line":281,"code":"    it('should be able to timeout a long running command', function (done) {\n      var flow;\n      if (osType === \"Windows_NT\") {\n        // Although Windows timeout command is equivalent to sleep, this cannot be used because it promptly outputs a message.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"0.3\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"0.3\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command","suites":["exec node","calling exec"],"updatePoint":{"line":342,"column":53,"index":10445},"line":342,"code":"    it('should be able to kill a long running command', function (done) {\n      var flow;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", null);\n            msg.rc.should.have.property(\"signal\", \"SIGTERM\");\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command - SIGINT","suites":["exec node","calling exec"],"updatePoint":{"line":416,"column":62,"index":12367},"line":416,"code":"    it('should be able to kill a long running command - SIGINT', function (done) {\n      var flow;\n      var sig = \"SIGINT\";\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", null);\n            msg.rc.should.have.property(\"signal\", \"SIGINT\");\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", sig);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"SIGINT\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return the rc for a failing command","suites":["exec node","calling exec"],"updatePoint":{"line":491,"column":50,"index":14302},"line":491,"code":"    it('should return the rc for a failing command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"error\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        //console.log(arg1);\n        // arg3(error,stdout,stderr);\n        arg3({\n          code: 1\n        }, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n        var completeTest = function () {\n          received++;\n          if (received < 3) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"error\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 1);\n            msg.rc.should.have.property(\"message\", undefined);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ERROR\");\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object","suites":["exec node","calling exec"],"updatePoint":{"line":568,"column":57,"index":16616},"line":568,"code":"    it('should preserve existing properties on msg object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"echo\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3(null, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n        var completeTest = function () {\n          received = received + 1;\n          if (received < 3) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"echo\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ECHO\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", \"bar\");\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\",\n          foo: \"bar\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object for a failing command","suites":["exec node","calling exec"],"updatePoint":{"line":647,"column":79,"index":19119},"line":647,"code":"    it('should preserve existing properties on msg object for a failing command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"error\",\n        addpay: false,\n        append: \"\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      var spy = sinon.stub(child_process, 'exec').callsFake(function (arg1, arg2, arg3, arg4) {\n        // arg3(error,stdout,stderr);\n        arg3({\n          code: 1\n        }, arg1, arg1.toUpperCase());\n      });\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null, null];\n        var completeTest = function () {\n          received++;\n          if (received < 3) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"error\");\n            msg.should.have.property(\"rc\");\n            msg.rc.should.have.property(\"code\", 1);\n            msg.rc.should.have.property(\"message\", undefined);\n            msg.should.have.property(\"foo\", null);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(\"ERROR\");\n            msg.should.have.property(\"foo\", null);\n            msg = messages[2];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            msg.should.have.property(\"foo\", null);\n            child_process.exec.restore();\n            done();\n          } catch (err) {\n            child_process.exec.restore();\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n3.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[2] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: \"and\",\n          foo: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command","suites":["exec node","calling spawn"],"updatePoint":{"line":729,"column":37,"index":21606},"line":729,"code":"    it('should spawn a simple command', function (done) {\n      var flow;\n      var expected;\n      if (osType === \"Windows_NT\") {\n        // Need to use cmd to spawn a process because Windows echo command is a built-in command and cannot be spawned.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"hello world\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"hello world\\n\";\n      }\n      var events = require('events');\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var payload = \"\";\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            payload += msg.payload;\n            if (payload.endsWith(\"\\n\")) {\n              payload.should.equal(expected);\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"hello world\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command with a non string payload parameter","suites":["exec node","calling spawn"],"updatePoint":{"line":802,"column":73,"index":23597},"line":802,"code":"    it('should spawn a simple command with a non string payload parameter', function (done) {\n      var flow;\n      var expected;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \" deg C\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"12345 deg C\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \" deg C\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"12345 deg C\\n\";\n      }\n      var payload = \"\";\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            payload += msg.payload;\n            if (payload.endsWith(\"\\n\")) {\n              payload.should.equal(expected);\n              done();\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 12345\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should spawn a simple command and return binary buffer","suites":["exec node","calling spawn"],"updatePoint":{"line":873,"column":62,"index":25421},"line":873,"code":"    it('should spawn a simple command and return binary buffer', function (done) {\n      var flow;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo\",\n          addpay: true,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            Buffer.isBuffer(msg.payload).should.be.true();\n            if (osType === \"Windows_NT\") {\n              msg.payload.length.should.equalOneOf(6, 8);\n            } else {\n              msg.payload.length.should.equal(7);\n            }\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: Buffer.from([0x01, 0x02, 0x03, 0x88])\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should work if passed multiple words to spawn command","suites":["exec node","calling spawn"],"updatePoint":{"line":940,"column":61,"index":27175},"line":940,"code":"    it('should work if passed multiple words to spawn command', function (done) {\n      var flow;\n      var expected;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\n\";\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n        var completeTest = function () {\n          received++;\n          if (received < 2) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(expected);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            should.exist(msg.payload);\n            msg.payload.should.have.property(\"code\", 0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          var payload = msg.payload;\n          if (messages[0]) {\n            messages[0].payload += payload;\n          } else {\n            messages[0] = msg;\n          }\n          if (payload.endsWith(\"\\n\")) {\n            completeTest();\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          fred: 123\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a bad command","suites":["exec node","calling spawn"],"updatePoint":{"line":1033,"column":48,"index":29654},"line":1033,"code":"    it('should return an error for a bad command', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"exec\",\n        wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n        command: \"madeupcommandshouldfail\",\n        addpay: false,\n        append: \"\",\n        useSpawn: \"true\",\n        oldrc: \"false\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }, {\n        id: \"n4\",\n        type: \"helper\"\n      }];\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\");\n            msg.payload.code.should.be.below(0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a failing command","suites":["exec node","calling spawn"],"updatePoint":{"line":1073,"column":52,"index":30710},"line":1073,"code":"    it('should return an error for a failing command', function (done) {\n      var flow;\n      var expected;\n      var expectedFound = false;\n      if (osType === \"Windows_NT\") {\n        // Cannot use mkdir because Windows mkdir command automatically creates non-existent directories.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"IP address must be specified.\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"mkdir /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = ' directory';\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n3.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            if (msg.payload.indexOf(expected) >= 0) {\n              // The error text on the stderr stream might get sent in more than one piece.\n              // We only need to know that it occurred before the return code is sent,\n              // as checked below in node n4.\n              expectedFound = true;\n            }\n          } catch (err) {\n            done(err);\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          try {\n            expectedFound.should.be.true;\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: null\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to timeout a long running command","suites":["exec node","calling spawn"],"updatePoint":{"line":1155,"column":56,"index":33107},"line":1155,"code":"    it('should be able to timeout a long running command', function (done) {\n      var flow;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000\",\n          timer: \"0.3\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"0.3\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", null);\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command","suites":["exec node","calling spawn"],"updatePoint":{"line":1218,"column":53,"index":34736},"line":1218,"code":"    it('should be able to kill a long running command', function (done) {\n      var flow;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", \"SIGTERM\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be able to kill a long running command - SIGINT","suites":["exec node","calling spawn"],"updatePoint":{"line":1283,"column":62,"index":36368},"line":1283,"code":"    it('should be able to kill a long running command - SIGINT', function (done) {\n      var flow;\n      var sig = \"SIGINT\";\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping\",\n          addpay: false,\n          append: \"192.0.2.0 -n 1 -w 1000 > NUL\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"sleep\",\n          addpay: false,\n          append: \"1\",\n          timer: \"2\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        n4.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"signal\", sig);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        setTimeout(function () {\n          n1.receive({\n            kill: \"SIGINT\"\n          });\n        }, 150);\n        n1.receive({});\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object","suites":["exec node","calling spawn"],"updatePoint":{"line":1349,"column":57,"index":38021},"line":1349,"code":"    it('should preserve existing properties on msg object', function (done) {\n      var flow;\n      var expected;\n      if (osType === \"Windows_NT\") {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"cmd /C echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\r\\n\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"echo this now works\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"this now works\\n\";\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n        var completeTest = function () {\n          received++;\n          if (received < 2) {\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.payload.should.equal(expected);\n            msg.should.have.property(\"foo\", 123);\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            should.exist(msg.payload);\n            msg.payload.should.have.property(\"code\", 0);\n            msg.should.have.property(\"foo\", 123);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n        n2.on(\"input\", function (msg) {\n          var payload = msg.payload;\n          if (messages[0]) {\n            messages[0].payload += payload;\n          } else {\n            messages[0] = msg;\n          }\n          if (payload.endsWith(\"\\n\")) {\n            completeTest();\n          }\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          foo: 123\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should preserve existing properties on msg object for a failing command","suites":["exec node","calling spawn"],"updatePoint":{"line":1444,"column":79,"index":40630},"line":1444,"code":"    it('should preserve existing properties on msg object for a failing command', function (done) {\n      var flow;\n      var expected;\n      if (osType === \"Windows_NT\") {\n        // Cannot use mkdir because Windows mkdir command automatically creates non-existent directories.\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"ping /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = \"IP address must be specified.\";\n      } else {\n        flow = [{\n          id: \"n1\",\n          type: \"exec\",\n          wires: [[\"n2\"], [\"n3\"], [\"n4\"]],\n          command: \"mkdir /foo/bar/doo/dah\",\n          addpay: false,\n          append: \"\",\n          useSpawn: \"true\",\n          oldrc: \"false\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }, {\n          id: \"n3\",\n          type: \"helper\"\n        }, {\n          id: \"n4\",\n          type: \"helper\"\n        }];\n        expected = ' directory';\n      }\n      helper.load(execNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        var n4 = helper.getNode(\"n4\");\n        var received = 0;\n        var messages = [null, null];\n        var completeTest = function () {\n          if (messages[0] === null || messages[1] === null) {\n            // We have not yet had responses on both ports.\n            return;\n          }\n          try {\n            var msg = messages[0];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.be.a.String();\n            msg.should.have.property(\"foo\", \"baz\");\n            msg = messages[1];\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"code\", 1);\n            msg.should.have.property(\"foo\", \"baz\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        };\n        n3.on(\"input\", function (msg) {\n          messages[0] = msg;\n          completeTest();\n        });\n        n4.on(\"input\", function (msg) {\n          messages[1] = msg;\n          completeTest();\n        });\n        n1.receive({\n          payload: null,\n          foo: \"baz\"\n        });\n      });\n    });","file":"nodes/core/function/90-exec_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with correct defaults","suites":["rbe node"],"updatePoint":{"line":15,"column":44,"index":450},"line":15,"code":"  it(\"should be loaded with correct defaults\", function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      \"name\": \"rbe1\",\n      \"wires\": [[]]\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property(\"name\", \"rbe1\");\n      n1.should.have.property(\"func\", \"rbe\");\n      n1.should.have.property(\"gap\", \"0\");\n      done();\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if payload changes - with multiple topics (rbe)","suites":["rbe node"],"updatePoint":{"line":30,"column":77,"index":902},"line":30,"code":"  it('should only send output if payload changes - with multiple topics (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 2);\n          c += 1;\n        } else if (c == 2) {\n          msg.should.have.a.property(\"payload\");\n          msg.payload.should.have.a.property(\"b\", 1);\n          msg.payload.should.have.a.property(\"c\", 2);\n          c += 1;\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 4) {\n          msg.should.have.a.property(\"payload\", false);\n          c += 1;\n        } else if (c == 5) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 6) {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else if (c == 7) {\n          msg.should.have.a.property(\"topic\", \"b\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else {\n          c += 1;\n          msg.should.have.a.property(\"topic\", \"c\");\n          msg.should.have.a.property(\"payload\", 1);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n      n1.emit(\"input\", {\n        payload: false\n      });\n      n1.emit(\"input\", {\n        payload: false\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should ignore multiple topics if told to (rbe)","suites":["rbe node"],"updatePoint":{"line":148,"column":52,"index":3678},"line":148,"code":"  it('should ignore multiple topics if told to (rbe)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      septopics: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 2);\n          c += 1;\n        } else if (c == 2) {\n          msg.should.have.a.property(\"payload\");\n          msg.payload.should.have.a.property(\"b\", 1);\n          msg.payload.should.have.a.property(\"c\", 2);\n          c += 1;\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 4) {\n          msg.should.have.a.property(\"payload\", false);\n          c += 1;\n        } else if (c == 5) {\n          msg.should.have.a.property(\"payload\", true);\n          c += 1;\n        } else if (c == 6) {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 1);\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"topic\", \"a\");\n          msg.should.have.a.property(\"payload\", 2);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: false\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: false\n      });\n      n1.emit(\"input\", {\n        topic: \"d\",\n        payload: true\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"d\",\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: 2\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if another chosen property changes - foo (rbe)","suites":["rbe node"],"updatePoint":{"line":271,"column":76,"index":6509},"line":271,"code":"  it('should only send output if another chosen property changes - foo (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      property: \"foo\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"foo\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"foo\", \"b\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"foo\");\n          msg.foo.should.have.a.property(\"b\", 1);\n          msg.foo.should.have.a.property(\"c\", 2);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"a\"\n      });\n      n1.emit(\"input\", {\n        foo: \"b\"\n      });\n      n1.emit(\"input\", {\n        foo: {\n          b: 1,\n          c: 2\n        }\n      });\n      n1.emit(\"input\", {\n        foo: {\n          c: 2,\n          b: 1\n        }\n      });\n      n1.emit(\"input\", {\n        payload: {\n          c: 2,\n          b: 1\n        }\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if payload changes - ignoring first value (rbei)","suites":["rbe node"],"updatePoint":{"line":339,"column":78,"index":7974},"line":339,"code":"  it('should only send output if payload changes - ignoring first value (rbei)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbei\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          msg.should.have.a.property(\"topic\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          msg.should.have.a.property(\"topic\", \"b\");\n          c += 1;\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", \"c\");\n          msg.should.have.a.property(\"topic\", \"a\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"payload\", \"c\");\n          msg.should.have.a.property(\"topic\", \"b\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"b\"\n      });\n      n1.emit(\"input\", {\n        payload: \"a\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"b\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"b\",\n        topic: \"b\"\n      });\n      n1.emit(\"input\", {\n        payload: \"c\",\n        topic: \"a\"\n      });\n      n1.emit(\"input\", {\n        payload: \"c\",\n        topic: \"b\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should send output if queue is reset (rbe)","suites":["rbe node"],"updatePoint":{"line":403,"column":48,"index":9549},"line":403,"code":"  it('should send output if queue is reset (rbe)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"rbe\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 4) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 5) {\n          msg.should.have.a.property(\"payload\", \"b\");\n          c += 1;\n        } else if (c === 6) {\n          msg.should.have.a.property(\"payload\", \"a\");\n          c += 1;\n        } else {\n          msg.should.have.a.property(\"payload\", \"c\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        reset: true\n      }); // reset all\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"b\",\n        reset: \"\"\n      }); // reset b\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        reset: \"\"\n      }); // reset all\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\"\n      }); // don't reset a non topic\n      n1.emit(\"input\", {\n        topic: \"b\",\n        payload: \"b\"\n      });\n      n1.emit(\"input\", {\n        topic: \"a\",\n        payload: \"a\"\n      });\n      n1.emit(\"input\", {\n        topic: \"c\",\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if x away from original value (deadbandEq)","suites":["rbe node"],"updatePoint":{"line":512,"column":72,"index":12102},"line":512,"code":"  it('should only send output if x away from original value (deadbandEq)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadbandEq\",\n      gap: \"10\",\n      inout: \"out\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 10);\n        } else if (c == 3) {\n          msg.should.have.a.property(\"payload\", 20);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 4\n      });\n      n1.emit(\"input\", {\n        payload: 6\n      });\n      n1.emit(\"input\", {\n        payload: 8\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if more than x away from original value (deadband)","suites":["rbe node"],"updatePoint":{"line":565,"column":80,"index":13320},"line":565,"code":"  it('should only send output if more than x away from original value (deadband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n        //console.log(c,msg);\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 20);\n        } else {\n          msg.should.have.a.property(\"payload\", \"5 deg\");\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 2\n      });\n      n1.emit(\"input\", {\n        payload: 4\n      });\n      n1.emit(\"input\", {\n        payload: \"6 deg\"\n      });\n      n1.emit(\"input\", {\n        payload: 8\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: \"5 deg\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should only send output if more than x% away from original value (deadband)","suites":["rbe node"],"updatePoint":{"line":618,"column":81,"index":14551},"line":618,"code":"  it('should only send output if more than x% away from original value (deadband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10%\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 100);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 111);\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", 135);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 100\n      });\n      n1.emit(\"input\", {\n        payload: 95\n      });\n      n1.emit(\"input\", {\n        payload: 105\n      });\n      n1.emit(\"input\", {\n        payload: 111\n      });\n      n1.emit(\"input\", {\n        payload: 120\n      });\n      n1.emit(\"input\", {\n        payload: 135\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should warn if no number found in deadband mode","suites":["rbe node"],"updatePoint":{"line":664,"column":53,"index":15626},"line":664,"code":"  it('should warn if no number found in deadband mode', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"deadband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c += 1;\n      });\n      setTimeout(function () {\n        c.should.equal(0);\n        helper.log().called.should.be.true;\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"rbe\";\n        });\n        logEvents.should.have.length(1);\n        var msg = logEvents[0][0];\n        msg.should.have.property('level', helper.log().WARN);\n        msg.should.have.property('id', 'n1');\n        msg.should.have.property('type', 'rbe');\n        msg.should.have.property('msg', 'rbe.warn.nonumber');\n        done();\n      }, 50);\n      n1.emit(\"input\", {\n        payload: \"banana\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if x away or greater from original value (narrowbandEq)","suites":["rbe node"],"updatePoint":{"line":701,"column":84,"index":16725},"line":701,"code":"  it('should not send output if x away or greater from original value (narrowbandEq)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowbandEq\",\n      gap: \"10\",\n      inout: \"out\",\n      start: \"1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        c = c + 1;\n        //console.log(c,msg);\n        if (c === 1) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 2) {\n          msg.should.have.a.property(\"payload\", 5);\n        } else if (c === 3) {\n          msg.should.have.a.property(\"payload\", 10);\n          done();\n        }\n      });\n      n1.emit(\"input\", {\n        payload: 100\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 5\n      });\n      n1.emit(\"input\", {\n        payload: 15\n      });\n      n1.emit(\"input\", {\n        payload: 10\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 25\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if more than x away from original value (narrowband)","suites":["rbe node"],"updatePoint":{"line":756,"column":81,"index":17998},"line":756,"code":"  it('should not send output if more than x away from original value (narrowband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"10\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 0);\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", \"6 deg\");\n        } else {\n          msg.should.have.a.property(\"payload\", \"5 deg\");\n          done();\n        }\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 40\n      });\n      n1.emit(\"input\", {\n        payload: \"6 deg\"\n      });\n      n1.emit(\"input\", {\n        payload: 18\n      });\n      n1.emit(\"input\", {\n        payload: 20\n      });\n      n1.emit(\"input\", {\n        payload: 50\n      });\n      n1.emit(\"input\", {\n        payload: \"5 deg\"\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should send output if gap is 0 and input doesnt change (narrowband)","suites":["rbe node"],"updatePoint":{"line":808,"column":73,"index":19198},"line":808,"code":"  it('should send output if gap is 0 and input doesnt change (narrowband)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"0\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 1);\n        } else if (c === 4) {\n          msg.should.have.a.property(\"payload\", 1);\n          done();\n        }\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: 0\n      });\n      n1.emit(\"input\", {\n        payload: 1\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should not send output if more than x away from original value (narrowband in step mode)","suites":["rbe node"],"updatePoint":{"line":852,"column":94,"index":20212},"line":852,"code":"  it('should not send output if more than x away from original value (narrowband in step mode)', function (done) {\n    var flow = [{\n      \"id\": \"n1\",\n      \"type\": \"rbe\",\n      func: \"narrowband\",\n      gap: \"10\",\n      inout: \"in\",\n      start: \"500\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(testNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 0) {\n          msg.should.have.a.property(\"payload\", 55);\n        } else if (c === 1) {\n          msg.should.have.a.property(\"payload\", 205);\n          done();\n        }\n        c += 1;\n      });\n      n1.emit(\"input\", {\n        payload: 50\n      });\n      n1.emit(\"input\", {\n        payload: 55\n      });\n      n1.emit(\"input\", {\n        payload: 200\n      });\n      n1.emit(\"input\", {\n        payload: 205\n      });\n    });\n  });","file":"nodes/core/function/rbe_spec.js","skipped":false,"dir":"test"},{"name":"should get plain text content","suites":["HTTP Request Node","request"],"updatePoint":{"line":378,"column":37,"index":12421},"line":378,"code":"    it('should get plain text content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.redirectList.length.should.equal(0);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should get JSON content","suites":["HTTP Request Node","request"],"updatePoint":{"line":411,"column":31,"index":13455},"line":411,"code":"    it('should get JSON content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/json-valid')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              a: 1\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send the payload as the body of a POST as application/json","suites":["HTTP Request Node","request"],"updatePoint":{"line":444,"column":73,"index":14433},"line":444,"code":"    it('should send the payload as the body of a POST as application/json', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('{\"foo\":\"abcde\"}');\n            msg.payload.headers.should.have.property('content-type').which.startWith('application/json');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a payload of 0 as the body of a POST as text/plain","suites":["HTTP Request Node","request"],"updatePoint":{"line":479,"column":70,"index":15573},"line":479,"code":"    it('should send a payload of 0 as the body of a POST as text/plain', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('0');\n            msg.payload.headers.should.have.property('content-length', '1');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: 0,\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send an Object payload as the body of a POST","suites":["HTTP Request Node","request"],"updatePoint":{"line":515,"column":59,"index":16699},"line":515,"code":"    it('should send an Object payload as the body of a POST', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('{\"foo\":\"abcde\"}');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          },\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a Buffer as the body of a POST","suites":["HTTP Request Node","request"],"updatePoint":{"line":553,"column":50,"index":17888},"line":553,"code":"    it('should send a Buffer as the body of a POST', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('hello');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: Buffer.from('hello'),\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send form-based request","suites":["HTTP Request Node","request"],"updatePoint":{"line":589,"column":38,"index":19037},"line":589,"code":"    it('should send form-based request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.body.should.equal(\"foo=1%202%203&bar=\");\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('content-type', 'application/x-www-form-urlencoded');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: '1 2 3',\n            bar: ''\n          },\n          headers: {\n            'content-type': 'application/x-www-form-urlencoded'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send PUT request","suites":["HTTP Request Node","request"],"updatePoint":{"line":626,"column":31,"index":20124},"line":626,"code":"    it('should send PUT request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"PUT\",\n        ret: \"obj\",\n        url: getTestURL('/putInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send DELETE request","suites":["HTTP Request Node","request"],"updatePoint":{"line":662,"column":34,"index":21250},"line":662,"code":"    it('should send DELETE request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"DELETE\",\n        ret: \"obj\",\n        url: getTestURL('/deleteInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            foo: \"abcde\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send HEAD request","suites":["HTTP Request Node","request"],"updatePoint":{"line":693,"column":32,"index":22047},"line":693,"code":"    it('should send HEAD request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"txt\",\n        url: getTestURL('/headInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"head\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send PATCH request","suites":["HTTP Request Node","request"],"updatePoint":{"line":723,"column":33,"index":22833},"line":723,"code":"    it('should send PATCH request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"PATCH\",\n        ret: \"obj\",\n        url: getTestURL('/patchInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('etag');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send OPTIONS request","suites":["HTTP Request Node","request"],"updatePoint":{"line":758,"column":35,"index":23820},"line":758,"code":"    it('should send OPTIONS request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"obj\",\n        url: getTestURL('/*')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"options\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send TRACE request","suites":["HTTP Request Node","request"],"updatePoint":{"line":787,"column":33,"index":24546},"line":787,"code":"    it('should send TRACE request', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"obj\",\n        url: getTestURL('/traceInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.body.should.eql('foo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"trace\",\n          headers: {\n            'content-type': 'text/plain'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should get Buffer content","suites":["HTTP Request Node","request"],"updatePoint":{"line":820,"column":33,"index":25396},"line":820,"code":"    it('should get Buffer content', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"bin\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            Buffer.isBuffer(msg.payload).should.be.true();\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return plain text when JSON fails to parse","suites":["HTTP Request Node","request"],"updatePoint":{"line":852,"column":57,"index":26339},"line":852,"code":"    it('should return plain text when JSON fails to parse', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/json-invalid')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', \"{a:1\");\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-type').which.startWith('application/json');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return the status code","suites":["HTTP Request Node","request"],"updatePoint":{"line":883,"column":37,"index":27255},"line":883,"code":"    it('should return the status code', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/statusCode204')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '');\n            msg.should.have.property('statusCode', 204);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.url","suites":["HTTP Request Node","request"],"updatePoint":{"line":912,"column":26,"index":28010},"line":912,"code":"    it('should use msg.url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: \"/foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when URL is not provided","suites":["HTTP Request Node","request"],"updatePoint":{"line":942,"column":55,"index":28813},"line":942,"code":"    it('should output an error when URL is not provided', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: \"\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"no url allowed though\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the message to provide the url","suites":["HTTP Request Node","request"],"updatePoint":{"line":973,"column":51,"index":29594},"line":973,"code":"    it('should allow the message to provide the url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: getTestURL('/text')\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the url to contain mustache placeholders","suites":["HTTP Request Node","request"],"updatePoint":{"line":1005,"column":61,"index":30607},"line":1005,"code":"    it('should allow the url to contain mustache placeholders', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/te{{placeholder}}')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          placeholder: \"xt\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the url to be missing the http:// prefix","suites":["HTTP Request Node","request"],"updatePoint":{"line":1038,"column":61,"index":31660},"line":1038,"code":"    it('should allow the url to be missing the http:// prefix', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text').substring(\"http://\".length)\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject non http:// schemes - node config","suites":["HTTP Request Node","request"],"updatePoint":{"line":1070,"column":55,"index":32693},"line":1070,"code":"    it('should reject non http:// schemes - node config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: \"ftp://foo\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"non http(s):// scheme allowed through\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject non http:// schemes - msg.url","suites":["HTTP Request Node","request"],"updatePoint":{"line":1101,"column":51,"index":33499},"line":1101,"code":"    it('should reject non http:// schemes - msg.url', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var inError = false;\n        n2.on(\"input\", function (msg) {\n          inError = true;\n        });\n        n1.receive({\n          payload: \"foo\",\n          url: \"ftp://foo\"\n        });\n        setTimeout(function () {\n          if (inError) {\n            done(new Error(\"non http(s):// scheme allowed through\"));\n          } else {\n            done();\n          }\n        }, 20);\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.method","suites":["HTTP Request Node","request"],"updatePoint":{"line":1132,"column":29,"index":34285},"line":1132,"code":"    it('should use msg.method', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"POST\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should allow the message to provide the method","suites":["HTTP Request Node","request"],"updatePoint":{"line":1162,"column":54,"index":35090},"line":1162,"code":"    it('should allow the message to provide the method', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"use\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          method: \"get\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive msg.responseUrl","suites":["HTTP Request Node","request"],"updatePoint":{"line":1195,"column":38,"index":36103},"line":1195,"code":"    it('should receive msg.responseUrl', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('responseUrl', getTestURL('/text'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive msg.responseUrl when redirected","suites":["HTTP Request Node","request"],"updatePoint":{"line":1224,"column":54,"index":36898},"line":1224,"code":"    it('should receive msg.responseUrl when redirected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/redirectToText')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('responseUrl', getTestURL('/text'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should prevent following redirect when msg.followRedirects is false","suites":["HTTP Request Node","request"],"updatePoint":{"line":1254,"column":75,"index":37782},"line":1254,"code":"    it('should prevent following redirect when msg.followRedirects is false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/redirectToText')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 302);\n            msg.should.have.property('responseUrl', getTestURL('/redirectToText'));\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          followRedirects: false\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when request timeout occurred","suites":["HTTP Request Node","request"],"updatePoint":{"line":1284,"column":60,"index":38637},"line":1284,"code":"    it('should output an error when request timeout occurred', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var timeout = RED.settings.httpRequestTimeout;\n      RED.settings.httpRequestTimeout = 50;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode');\n            /TIMEDOUT/.test(msg.statusCode).should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(1);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().ERROR,\n              id: 'n1',\n              type: 'http request',\n              msg: 'common.notification.errors.no-response',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          } finally {\n            RED.settings.httpRequestTimeout = timeout;\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should output an error when request timeout occurred when set via msg.requestTimeout","suites":["HTTP Request Node","request"],"updatePoint":{"line":1330,"column":92,"index":40144},"line":1330,"code":"    it('should output an error when request timeout occurred when set via msg.requestTimeout', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode');\n            /TIMEDOUT/.test(msg.statusCode).should.be.true();\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(1);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().ERROR,\n              id: 'n1',\n              type: 'http request',\n              msg: 'common.notification.errors.no-response',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 50\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is not a number","suites":["HTTP Request Node","request"],"updatePoint":{"line":1373,"column":67,"index":41482},"line":1373,"code":"    it('should show a warning if msg.requestTimeout is not a number', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnan',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is negative","suites":["HTTP Request Node","request"],"updatePoint":{"line":1415,"column":63,"index":42747},"line":1415,"code":"    it('should show a warning if msg.requestTimeout is negative', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnegative',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: -4\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should show a warning if msg.requestTimeout is set to 0","suites":["HTTP Request Node","request"],"updatePoint":{"line":1457,"column":63,"index":44014},"line":1457,"code":"    it('should show a warning if msg.requestTimeout is set to 0', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == 'http request';\n            });\n            logEvents.should.have.length(2);\n            var tstmp = logEvents[0][0].timestamp;\n            logEvents[0][0].should.eql({\n              level: helper.log().WARN,\n              id: 'n1',\n              type: 'http request',\n              msg: 'httpin.errors.timeout-isnegative',\n              timestamp: tstmp,\n              path: \"global\"\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 0\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should pass if response time is faster than timeout set via msg.requestTimeout","suites":["HTTP Request Node","request"],"updatePoint":{"line":1499,"column":86,"index":45303},"line":1499,"code":"    it('should pass if response time is faster than timeout set via msg.requestTimeout', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/timeout50ms')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          requestTimeout: 100\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should append query params to url - obj","suites":["HTTP Request Node","request"],"updatePoint":{"line":1528,"column":47,"index":46055},"line":1528,"code":"    it('should append query params to url - obj', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        paytoqs: true,\n        ret: \"obj\",\n        url: getTestURL('/getQueryParams')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              query: {\n                a: '1',\n                b: '2',\n                c: '3'\n              },\n              url: '/getQueryParams?a=1&b=2&c=3'\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            a: 1,\n            b: 2,\n            c: 3\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 400","suites":["HTTP Request Node","request"],"updatePoint":{"line":1570,"column":59,"index":47150},"line":1570,"code":"    it('should send a msg for non-2xx response status - 400', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/400')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '400'\n            });\n            msg.should.have.property('statusCode', 400);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 404","suites":["HTTP Request Node","request"],"updatePoint":{"line":1599,"column":59,"index":47949},"line":1599,"code":"    it('should send a msg for non-2xx response status - 404', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/404')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '404'\n            });\n            msg.should.have.property('statusCode', 404);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send a msg for non-2xx response status - 500","suites":["HTTP Request Node","request"],"updatePoint":{"line":1628,"column":59,"index":48748},"line":1628,"code":"    it('should send a msg for non-2xx response status - 500', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/returnError/500')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              gotError: '500'\n            });\n            msg.should.have.property('statusCode', 500);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode the url to handle special characters","suites":["HTTP Request Node","request"],"updatePoint":{"line":1657,"column":58,"index":49546},"line":1657,"code":"    it('should encode the url to handle special characters', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', {\n              query: {\n                a: 'b',\n                c: ['T24,0|H80%|W S8,3m/s']\n              },\n              url: '/getQueryParams?a=b&c[0].Text=T24,0%C2%B0|H80%25|W%20S8,3m/s'\n            });\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          url: getTestURL('/getQueryParams') + \"?a=b&c[0].Text=T24,0|H80%|W%20S8,3m/s\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive cookie","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1694,"column":29,"index":50623},"line":1694,"code":"    it('should receive cookie', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/setCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.responseCookies.should.have.property('data');\n            msg.responseCookies.data.should.have.property('value', 'hello');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie with string","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1724,"column":38,"index":51472},"line":1724,"code":"    it('should send cookie with string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: 'abc'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies with string","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1756,"column":48,"index":52313},"line":1756,"code":"    it('should send multiple cookies with string', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: 'abc',\n            foo: 'bar'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie with object data","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1790,"column":43,"index":53233},"line":1790,"code":"    it('should send cookie with object data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: 'abc'\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies with object data","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1824,"column":53,"index":54116},"line":1824,"code":"    it('should send multiple cookies with object data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: 'abc'\n            },\n            foo: {\n              value: 'bar'\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode cookie value","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1862,"column":34,"index":55101},"line":1862,"code":"    it('should encode cookie value', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = ';,/?:@ &=+$#';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', encodeURIComponent(value));\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: value\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should encode cookie object","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1895,"column":35,"index":55985},"line":1895,"code":"    it('should encode cookie object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = ';,/?:@ &=+$#';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', encodeURIComponent(value));\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: value,\n              encode: true\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not encode cookie when encode option is false","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1931,"column":60,"index":56959},"line":1931,"code":"    it('should not encode cookie when encode option is false', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var value = '!#$%&\\'()*+-./:<>?@[]^_`{|}~';\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', value);\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            data: {\n              value: value,\n              encode: false\n            }\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookie by msg.headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":1967,"column":41,"index":57911},"line":1967,"code":"    it('should send cookie by msg.headers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            boo: '123'\n          },\n          headers: {\n            'cookie': 'data=abc'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send multiple cookies by msg.headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2002,"column":51,"index":58821},"line":2002,"code":"    it('should send multiple cookies by msg.headers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/checkCookie')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property('data', 'abc');\n            msg.payload.should.have.property('foo', 'bar');\n            msg.should.have.property('statusCode', 200);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          cookies: {\n            boo: '123'\n          },\n          headers: {\n            'cookie': 'data=abc; foo=bar;'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should convert all HTTP headers into lower case","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2038,"column":55,"index":59805},"line":2038,"code":"    it('should convert all HTTP headers into lower case', function (done) {\n      // This is a bad test. Express lower-cases headers in the `req.headers` object,\n      // so this is actually testing express, not the original request.\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.payload.headers.should.have.property('content-length', \"3\");\n            msg.payload.headers.should.have.property('if-modified-since', 'Sun, 01 Jun 2000 00:00:00 GMT');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'Content-Type': 'text/plain',\n            'Content-Length': \"3\",\n            'If-Modified-Since': 'Sun, 01 Jun 2000 00:00:00 GMT'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should keep HTTP header case as provided by the user","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2077,"column":60,"index":61216},"line":2077,"code":"    it('should keep HTTP header case as provided by the user', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/rawHeaders')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.have.property('Content-Type').which.startWith('text/plain');\n            msg.payload.headers.should.have.property('X-Test-HEAD', \"foo\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          headers: {\n            'Content-Type': 'text/plain',\n            \"X-Test-HEAD\": \"foo\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should receive HTTP header","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2112,"column":34,"index":62265},"line":2112,"code":"    it('should receive HTTP header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getTestURL('/headersInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.headers.should.have.property('x-test-header', 'bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should ignore unmodified x-node-red-request-node header","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2141,"column":63,"index":63075},"line":2141,"code":"    it('should ignore unmodified x-node-red-request-node header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.headers.should.have.property('content-type').which.startWith('application/json');\n            msg.payload.headers.should.not.have.property('x-node-red-request-node');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        // Pass in a headers property with an unmodified x-node-red-request-node hash\n        // This should cause the node to ignore the headers\n\n        var headers = {\n          'content-type': 'text/plain'\n        };\n        headers['x-node-red-request-node'] = require(\"hash-sum\")(headers);\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          headers: headers\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use modified msg.headers property","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2180,"column":48,"index":64287},"line":2180,"code":"    it('should use modified msg.headers property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.headers.should.have.property('content-type').which.startWith('text/plain');\n            msg.payload.headers.should.not.have.property('x-node-red-request-node');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        // Pass in a headers property with a x-node-red-request-node hash that doesn't match the contents\n        // This should cause the node to use the headers\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          headers: {\n            'content-type': 'text/plain',\n            \"x-node-red-request-node\": \"INVALID_SUM\"\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use ui headers","suites":["HTTP Request Node","HTTP header"],"updatePoint":{"line":2217,"column":29,"index":65442},"line":2217,"code":"    it('should use ui headers', function (done) {\n      const flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/rawHeaders'),\n        \"headers\": [{\n          \"keyType\": \"Accept\",\n          \"keyValue\": \"\",\n          \"valueType\": \"application/json\",\n          \"valueValue\": \"\"\n        },\n        //set \"Accept\" to \"application/json\"\n        {\n          \"keyType\": \"Content-Type\",\n          \"keyValue\": \"\",\n          \"valueType\": \"application/json\",\n          \"valueValue\": \"\"\n        },\n        //overwrite msg.headers['content-type'] with UI header 'Content-Type']\n        {\n          \"keyType\": \"msg\",\n          \"keyValue\": \"dynamicHeaderName\",\n          \"valueType\": \"msg\",\n          \"valueValue\": \"dynamicHeaderValue\"\n        },\n        //dynamic msg.dynamicHeaderName/msg.dynamicHeaderValue\n        {\n          \"keyType\": \"other\",\n          \"keyValue\": \"static-header-name\",\n          \"valueType\": \"other\",\n          \"valueValue\": \"static-header-value\"\n        },\n        //static \"other\" header and value\n        {\n          \"keyType\": \"Location\",\n          \"keyValue\": \"\",\n          \"valueType\": \"other\",\n          \"valueValue\": \"\"\n        } //delete \"Location\" header (initially set in msg.headers['location'] by passing empty string for value\n        ]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        const n1 = helper.getNode(\"n1\");\n        const n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            //msg.headers['Accept'] should be set by Flow UI\n            msg.payload.headers.should.have.property('Accept').which.startWith('application/json');\n            //msg.headers['content-type'] should be updated to 'Content-Type' by the value set in the Flow UI\n            msg.payload.headers.should.have.property('Content-Type').which.startWith('application/json');\n            //msg.dynamicHeaderName should be present in headers with the value of msg.dynamicHeaderValue\n            msg.payload.headers.should.have.property('dyn-header-name').which.startWith('dyn-header-value');\n            //static (custom) header set in Flow UI should be present \n            msg.payload.headers.should.have.property('static-header-name').which.startWith('static-header-value');\n            //msg.headers['location'] should be deleted because Flow UI \"Location\" header has a blank value\n            //ensures headers with matching characters but different case are eliminated\n            msg.payload.headers.should.not.have.property('location');\n            msg.payload.headers.should.not.have.property('Location');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        // Pass in a headers property with a \"content-type\" & \"location\" header\n        // Pass in dynamicHeaderName & dynamicHeaderValue properties to set the Flow UI `msg.xxx` header entries\n        n1.receive({\n          payload: {\n            foo: \"bar\"\n          },\n          dynamicHeaderName: \"dyn-header-name\",\n          dynamicHeaderValue: \"dyn-header-value\",\n          headers: {\n            'content-type': 'text/plain',\n            'location': 'london'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.rejectUnauthorized","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2305,"column":41,"index":68943},"line":2305,"code":"    it('should use msg.rejectUnauthorized', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURL('/text')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\",\n          rejectUnauthorized: false\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2339,"column":29,"index":70043},"line":2339,"code":"    it('should use tls-config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURLWithoutProtocol('/text'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"\",\n        verifyservercert: false\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config and verify serverCert","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2382,"column":51,"index":71443},"line":2382,"code":"    it('should use tls-config and verify serverCert', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslTestURL('/text'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"test/resources/ssl/server.crt\",\n        verifyservercert: true\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use tls-config and send client cert","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2425,"column":50,"index":72855},"line":2425,"code":"    it('should use tls-config and send client cert', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"txt\",\n        url: getSslClientTestURL('/getClientCert'),\n        tls: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"tls-config\",\n        cert: \"test/resources/ssl/server.crt\",\n        key: \"test/resources/ssl/server.key\",\n        ca: \"test/resources/ssl/server.crt\",\n        verifyservercert: false\n      }];\n      var testNodes = [httpRequestNode, tlsNode];\n      helper.load(testNodes, flow, function () {\n        var n3 = helper.getNode(\"n3\");\n        var n2 = helper.getNode(\"n2\");\n        var n1 = helper.getNode(\"n1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'hello');\n            msg.should.have.property('statusCode', 200);\n            msg.should.have.property('headers');\n            msg.headers.should.have.property('content-length', '' + 'hello'.length);\n            msg.headers.should.have.property('content-type').which.startWith('text/html');\n            msg.should.have.property('responseUrl').which.startWith('https://');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http_proxy","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2471,"column":29,"index":74361},"line":2471,"code":"    it('should use http_proxy', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://localhost:\" + testProxyPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http_proxy when environment variable is invalid","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2506,"column":66,"index":75354},"line":2506,"code":"    it('should use http_proxy when environment variable is invalid', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"invalidvalue\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use HTTP_PROXY","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2541,"column":29,"index":76337},"line":2541,"code":"    it('should use HTTP_PROXY', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.HTTP_PROXY = \"http://localhost:\" + testProxyPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use no_proxy","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2575,"column":27,"index":77290},"line":2575,"code":"    it('should use no_proxy', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://localhost:\" + testProxyPort;\n      process.env.no_proxy = \"foo,localhost\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use NO_PROXY","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2607,"column":27,"index":78224},"line":2607,"code":"    it('should use NO_PROXY', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.HTTP_PROXY = \"http://localhost:\" + testProxyPort;\n      process.env.NO_PROXY = \"foo,localhost\";\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http-proxy-config","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2642,"column":36,"index":79224},"line":2642,"code":"    it('should use http-proxy-config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyPort\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not use http-proxy-config when invalid url is specified","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2681,"column":70,"index":80327},"line":2681,"code":"    it('should not use http-proxy-config when invalid url is specified', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"invalidvalue\"\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('headers');\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should use http-proxy-config when valid noproxy is specified","suites":["HTTP Request Node","protocol"],"updatePoint":{"line":2718,"column":68,"index":81399},"line":2718,"code":"    it('should use http-proxy-config when valid noproxy is specified', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"POST\",\n        ret: \"obj\",\n        url: getTestURL('/postInspect'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyPort,\n        noproxy: [\"foo\", \"localhost\"]\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.headers.should.not.have.property('x-testproxy-header', 'foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - basic","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2757,"column":45,"index":82500},"line":2757,"code":"    it('should authenticate on server - basic', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          user: 'userfoo',\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('user', 'userfoo');\n            msg.payload.should.have.property('pass', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - basic","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2791,"column":45,"index":83453},"line":2791,"code":"    it('should authenticate on server - basic', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          user: 'foo@example.com',\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('user', 'foo@example.com');\n            msg.payload.should.have.property('pass', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on server - bearer","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2825,"column":46,"index":84423},"line":2825,"code":"    it('should authenticate on server - bearer', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        authType: \"bearer\",\n        url: getTestURL('/authenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.credentials = {\n          password: 'passwordfoo'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            msg.payload.should.have.property('token', 'passwordfoo');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on proxy server","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2862,"column":43,"index":85440},"line":2862,"code":"    it('should authenticate on proxy server', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/proxyAuthenticate')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      deleteProxySetting();\n      process.env.http_proxy = \"http://foouser:barpassword@localhost:\" + testProxyAuthPort;\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            //msg.payload.should.have.property('user', 'foouser');\n            //msg.payload.should.have.property('pass', 'barpassword');\n            msg.payload.should.have.property('headers');\n            //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should authenticate on proxy server(http-proxy-config)","suites":["HTTP Request Node","authentication"],"updatePoint":{"line":2920,"column":62,"index":87690},"line":2920,"code":"    it('should authenticate on proxy server(http-proxy-config)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"http request\",\n        wires: [[\"n2\"]],\n        method: \"GET\",\n        ret: \"obj\",\n        url: getTestURL('/proxyAuthenticate'),\n        proxy: \"n3\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }, {\n        id: \"n3\",\n        type: \"http proxy\",\n        url: \"http://localhost:\" + testProxyAuthPort\n      }];\n      var testNode = [httpRequestNode, httpProxyNode];\n      deleteProxySetting();\n      helper.load(testNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var n3 = helper.getNode(\"n3\");\n        n3.credentials = {\n          username: 'foouser',\n          password: 'barpassword'\n        };\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('statusCode', 200);\n            // msg.payload.should.have.property('user', 'foouser');\n            // msg.payload.should.have.property('pass', 'barpassword');\n            msg.payload.should.have.property('headers');\n            //msg.payload.headers.should.have.property('x-testproxy-header','foobar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"foo\"\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should upload a file","suites":["HTTP Request Node","file-upload"],"updatePoint":{"line":2996,"column":28,"index":90398},"line":2996,"code":"    it('should upload a file', function (done) {\n      const flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'POST',\n        ret: 'obj',\n        url: getTestURL('/file-upload'),\n        headers: [{\n          \"keyType\": \"Content-Type\",\n          \"keyValue\": \"\",\n          \"valueType\": \"multipart/form-data\",\n          \"valueValue\": \"\"\n        }]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.payload.should.have.property(\"body\", {\n              \"other\": \"123\"\n            });\n            msg.payload.should.have.property(\"files\");\n            msg.payload.files.should.have.length(1);\n            msg.payload.files[0].should.have.property('fieldname', 'file');\n            msg.payload.files[0].should.have.property('originalname', 'file.txt');\n            msg.payload.files[0].should.have.property('buffer', {\n              \"type\": \"Buffer\",\n              \"data\": [72, 101, 108, 108, 111, 32, 87, 111, 114, 108, 100]\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: {\n            file: {\n              value: Buffer.from(\"Hello World\"),\n              options: {\n                filename: \"file.txt\"\n              }\n            },\n            other: 123\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(no cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3050,"column":74,"index":92059},"line":3050,"code":"    it('should send cookies to the same domain when redirected(no cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n            var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n            if (cookies1 && Object.keys(cookies1).length != 0) {\n              done(new Error('Invalid cookie(path:/rediectToSame)'));\n              return;\n            }\n            if (cookies2 && Object.keys(cookies2).length != 1 || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n              done(new Error('Invalid cookie(path:/rediectReurn)'));\n              return;\n            }\n            var redirect1 = msg.redirectList[0];\n            redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n            redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n            redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(no cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3090,"column":83,"index":93654},"line":3090,"code":"    it('should not send cookies to the different domain when redirected(no cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n          if (cookies1 && Object.keys(cookies1).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({});\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(msg.cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3126,"column":75,"index":95090},"line":3126,"code":"    it('should send cookies to the same domain when redirected(msg.cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToSame)'));\n            return;\n          }\n          if (cookies2 && Object.keys(cookies2).length != 2 || cookies1['requestCookie'] !== 'request1' || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n          redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n          done();\n        });\n        n1.receive({\n          cookies: {\n            requestCookie: 'request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(msg.cookies)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3166,"column":84,"index":96747},"line":3166,"code":"    it('should not send cookies to the different domain when redirected(msg.cookies)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToDifferentDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          cookies: {\n            requestCookie: 'request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send cookies to the same domain when redirected(msg.headers.cookie)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3206,"column":82,"index":98319},"line":3206,"code":"    it('should send cookies to the same domain when redirected(msg.headers.cookie)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToSameDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToSameDomain'];\n          var cookies2 = receivedCookies['localhost:' + testPort + '/redirectReturn'];\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToSame)'));\n            return;\n          }\n          if (cookies2 && Object.keys(cookies2).length != 2 || cookies1['requestCookie'] !== 'request1' || cookies2['redirectToSameDomainCookie'] !== 'same1') {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToSameDomainCookie.Path.should.equal('/');\n          redirect1.cookies.redirectToSameDomainCookie.value.should.equal('same1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should not send cookies to the different domain when redirected(msg.headers.cookie)","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3246,"column":91,"index":99990},"line":3246,"code":"    it('should not send cookies to the different domain when redirected(msg.headers.cookie)', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectToDifferentDomain')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var cookies1 = receivedCookies['localhost:' + testPort + '/redirectToDifferentDomain'];\n          var cookies2 = receivedCookies['127.0.0.1:' + testPort + '/redirectReturn'];\n          if (cookies1 && Object.keys(cookies1).length != 1 || cookies1['requestCookie'] !== 'request1') {\n            done(new Error('Invalid cookie(path:/rediectToDiffer)'));\n            return;\n          }\n          if (cookies2 && Object.keys(cookies2).length != 0) {\n            done(new Error('Invalid cookie(path:/rediectReurn)'));\n            return;\n          }\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect1.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect1.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should return all redirect information when redirected multiple times","suites":["HTTP Request Node","redirect-cookie"],"updatePoint":{"line":3286,"column":77,"index":101564},"line":3286,"code":"    it('should return all redirect information when redirected multiple times', function (done) {\n      var flow = [{\n        id: 'n1',\n        type: 'http request',\n        wires: [['n2']],\n        method: 'GET',\n        ret: 'obj',\n        url: getTestURL('/redirectMultipleTimes')\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      receivedCookies = {};\n      helper.load(httpRequestNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          var redirect1 = msg.redirectList[0];\n          redirect1.location.should.equal('http://localhost:' + testPort + '/redirectToDifferentDomain');\n          redirect1.cookies.redirectMultipleTimes.Path.should.equal('/');\n          redirect1.cookies.redirectMultipleTimes.value.should.equal('multiple1');\n          var redirect2 = msg.redirectList[1];\n          redirect2.location.should.equal('http://127.0.0.1:' + testPort + '/redirectReturn');\n          redirect2.cookies.redirectToDifferentDomain.Path.should.equal('/');\n          redirect2.cookies.redirectToDifferentDomain.value.should.equal('different1');\n          done();\n        });\n        n1.receive({\n          headers: {\n            cookie: 'requestCookie=request1'\n          }\n        });\n      });\n    });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should accept broken headers","suites":["HTTP Request Node","should parse broken headers"],"updatePoint":{"line":3338,"column":38,"index":103546},"line":3338,"code":"      it('should accept broken headers', function (done) {\n        var flow = [{\n          id: 'n1',\n          type: 'http request',\n          wires: [['n2']],\n          method: 'GET',\n          ret: 'obj',\n          url: `http://localhost:${port}/`,\n          insecureHTTPParser: true\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(httpRequestNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on('input', function (msg) {\n            try {\n              msg.payload.should.equal('HelloWorld');\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: 'foo'\n          });\n        });\n      });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should reject broken headers","suites":["HTTP Request Node","should parse broken headers"],"updatePoint":{"line":3367,"column":38,"index":104344},"line":3367,"code":"      it('should reject broken headers', function (done) {\n        var flow = [{\n          id: 'n1',\n          type: 'http request',\n          wires: [['n2']],\n          method: 'GET',\n          ret: 'obj',\n          url: `http://localhost:${port}/`\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(httpRequestNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on('input', function (msg) {\n            try {\n              msg.payload.should.equal(`RequestError: Parse Error: Missing expected CR after header value : http://localhost:${port}/`);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: 'foo'\n          });\n        });\n      });","file":"nodes/core/network/21-httprequest_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded and have default values (MQTT V4)","suites":["MQTT Nodes"],"updatePoint":{"line":27,"column":56,"index":940},"line":27,"code":"  it('should be loaded and have default values (MQTT V4)', function (done) {\n    this.timeout = 2000;\n    const {\n      flow,\n      nodes\n    } = buildBasicMQTTSendRecvFlow({\n      id: \"mqtt.broker\",\n      name: \"mqtt_broker\",\n      autoConnect: false\n    }, {\n      id: \"mqtt.in\",\n      topic: \"in_topic\"\n    }, {\n      id: \"mqtt.out\",\n      topic: \"out_topic\"\n    });\n    helper.load(mqttNodes, flow, function () {\n      try {\n        const mqttIn = helper.getNode(\"mqtt.in\");\n        const mqttOut = helper.getNode(\"mqtt.out\");\n        const mqttBroker = helper.getNode(\"mqtt.broker\");\n        should(mqttIn).be.type(\"object\", \"mqtt in node should be an object\");\n        mqttIn.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n        mqttIn.should.have.property('datatype', 'utf8'); //default: 'utf8'\n        mqttIn.should.have.property('isDynamic', false); //default: false\n        mqttIn.should.have.property('inputs', 0); //default: 0 \n        mqttIn.should.have.property('qos', 2); //default: 2\n        mqttIn.should.have.property('topic', \"in_topic\");\n        mqttIn.should.have.property('wires', [[\"helper.node\"]]);\n        should(mqttOut).be.type(\"object\", \"mqtt out node should be an object\");\n        mqttOut.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n        mqttOut.should.have.property('topic', \"out_topic\");\n        should(mqttBroker).be.type(\"object\", \"mqtt broker node should be an object\");\n        mqttBroker.should.have.property('broker', BROKER_HOST);\n        mqttBroker.should.have.property('port', BROKER_PORT);\n        mqttBroker.should.have.property('brokerurl');\n        // mqttBroker.should.have.property('autoUnsubscribe', true);//default: true \n        mqttBroker.should.have.property('autoConnect', false); //Set \"autoConnect:false\" in brokerOptions \n        mqttBroker.should.have.property('options');\n        mqttBroker.options.should.have.property('clean', true);\n        mqttBroker.options.should.have.property('clientId');\n        mqttBroker.options.clientId.should.containEql('nodered_');\n        mqttBroker.options.should.have.property('keepalive').type(\"number\");\n        mqttBroker.options.should.have.property('reconnectPeriod').type(\"number\");\n        //as this is not a v5 connection, ensure v5 properties are not present\n        mqttBroker.options.should.not.have.property('protocolVersion', 5);\n        mqttBroker.options.should.not.have.property('properties');\n        done();\n      } catch (error) {\n        done(error);\n      }\n    });\n  });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded and have default values (MQTT V5)","suites":["MQTT Nodes"],"updatePoint":{"line":80,"column":56,"index":3524},"line":80,"code":"  it('should be loaded and have default values (MQTT V5)', function (done) {\n    this.timeout = 2000;\n    const {\n      flow,\n      nodes\n    } = buildBasicMQTTSendRecvFlow({\n      id: \"mqtt.broker\",\n      name: \"mqtt_broker\",\n      autoConnect: false,\n      cleansession: false,\n      clientid: 'clientid',\n      keepalive: 35,\n      sessionExpiry: '6000',\n      protocolVersion: '5',\n      userProps: {\n        \"prop\": \"val\"\n      }\n    }, {\n      id: \"mqtt.in\",\n      topic: \"in_topic\"\n    }, {\n      id: \"mqtt.out\",\n      topic: \"out_topic\"\n    });\n    helper.load(mqttNodes, flow, function () {\n      try {\n        const mqttIn = helper.getNode(\"mqtt.in\");\n        const mqttOut = helper.getNode(\"mqtt.out\");\n        const mqttBroker = helper.getNode(\"mqtt.broker\");\n        should(mqttIn).be.type(\"object\", \"mqtt in node should be an object\");\n        mqttIn.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n        mqttIn.should.have.property('datatype', 'utf8'); //default: 'utf8'\n        mqttIn.should.have.property('isDynamic', false); //default: false\n        mqttIn.should.have.property('inputs', 0); //default: 0 \n        mqttIn.should.have.property('qos', 2); //default: 2\n        mqttIn.should.have.property('topic', \"in_topic\");\n        mqttIn.should.have.property('wires', [[\"helper.node\"]]);\n        should(mqttOut).be.type(\"object\", \"mqtt out node should be an object\");\n        mqttOut.should.have.property('broker', nodes.mqtt_broker.id); //should be the id of the broker node\n        mqttOut.should.have.property('topic', \"out_topic\");\n        should(mqttBroker).be.type(\"object\", \"mqtt broker node should be an object\");\n        mqttBroker.should.have.property('broker', BROKER_HOST);\n        mqttBroker.should.have.property('port', BROKER_PORT);\n        mqttBroker.should.have.property('brokerurl');\n        // mqttBroker.should.have.property('autoUnsubscribe', true);//default: true \n        mqttBroker.should.have.property('autoConnect', false); //Set \"autoConnect:false\" in brokerOptions \n        mqttBroker.should.have.property('options');\n        mqttBroker.options.should.have.property('clean', false);\n        mqttBroker.options.should.have.property('clientId', 'clientid');\n        mqttBroker.options.should.have.property('keepalive').type(\"number\", 35);\n        mqttBroker.options.should.have.property('reconnectPeriod').type(\"number\");\n        //as this IS a v5 connection, ensure v5 properties are not present\n        mqttBroker.options.should.have.property('protocolVersion', 5);\n        mqttBroker.options.should.have.property('properties');\n        mqttBroker.options.properties.should.have.property('sessionExpiryInterval');\n        done();\n      } catch (error) {\n        done(error);\n      }\n    });\n  });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"skipping MQTT tests. Set env var \"NR_MQTT_TESTS=true\" to enable. Requires a v5 capable broker running on localhost:1883.","suites":["MQTT Nodes"],"updatePoint":{"line":142,"column":128,"index":6405},"line":142,"code":"    it('skipping MQTT tests. Set env var \"NR_MQTT_TESTS=true\" to enable. Requires a v5 capable broker running on localhost:1883.', function (done) {\n      done();\n    });","file":"nodes/core/network/21-mqtt_spec.js","skipped":false,"dir":"test"},{"name":"should load","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":61,"column":19,"index":1807},"line":61,"code":"    it('should load', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"path\", \"/ws\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should be server","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":72,"column":24,"index":2109},"line":72,"code":"    it('should be server', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('isServer', true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle wholemsg property","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":83,"column":39,"index":2429},"line":83,"code":"    it('should handle wholemsg property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-listener\",\n        path: \"/ws2\",\n        wholemsg: \"true\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"wholemsg\", false);\n        helper.getNode(\"n2\").should.have.property(\"wholemsg\", true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should create socket","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":100,"column":28,"index":2920},"line":100,"code":"    it('should create socket', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should close socket on delete","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":118,"column":37,"index":3368},"line":118,"code":"    it('should close socket on delete', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"close\", function (code, msg) {\n            done();\n          });\n          helper.clearFlows();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive data","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":135,"column":27,"index":3823},"line":135,"code":"    it('should receive data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", \"hello\");\n            done();\n          });\n          sock.send(\"hello\");\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":161,"column":31,"index":4506},"line":161,"code":"    it('should receive wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.send('{\"text\":\"hello\"}');\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"text\", \"hello\");\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not JSON","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":188,"column":50,"index":5242},"line":188,"code":"    it('should receive wholemsg when data not JSON', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.send('hello');\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", \"hello\");\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not object","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":215,"column":52,"index":5972},"line":215,"code":"    it('should receive wholemsg when data not object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          helper.getNode(\"n3\").on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\", 123);\n            done();\n          });\n          sock.send(123);\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":242,"column":19,"index":6661},"line":242,"code":"    it('should send', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"helper\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n          helper.getNode(\"n2\").send({\n            payload: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":270,"column":28,"index":7367},"line":270,"code":"    it('should send wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n          helper.getNode(\"n3\").send({\n            text: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should do nothing if no payload","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":299,"column":39,"index":8135},"line":299,"code":"    it('should do nothing if no payload', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"helper\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          setTimeout(function () {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            logEvents.should.have.length(0);\n            done();\n          }, 100);\n          helper.getNode(\"n2\").send({\n            topic: \"hello\"\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should echo","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":330,"column":19,"index":8953},"line":330,"code":"    it('should echo', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n          sock.send(\"hello\");\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should echo wholemsg","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":357,"column":28,"index":9636},"line":357,"code":"    it('should echo wholemsg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        server: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        createClient(\"n1\").then(function (sock) {\n          sock.on(\"message\", function (msg, flags) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n          sock.send('{\"text\":\"hello\"}');\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should broadcast","suites":["websocket Node","websocket-listener"],"updatePoint":{"line":385,"column":24,"index":10380},"line":385,"code":"    it('should broadcast', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        Promise.all([createClient(\"n1\"), createClient(\"n1\")]).then(function (socks) {\n          var promises = [new Promise((resolve, reject) => {\n            socks[0].on(\"message\", function (msg, flags) {\n              try {\n                msg.should.equal(\"hello\");\n                resolve();\n              } catch (err) {\n                reject(err);\n              }\n            });\n          }), new Promise((resolve, reject) => {\n            socks[1].on(\"message\", function (msg, flags) {\n              try {\n                msg.should.equal(\"hello\");\n                resolve();\n              } catch (err) {\n                reject(err);\n              }\n            });\n          })];\n          helper.getNode(\"n3\").send({\n            payload: \"hello\"\n          });\n          return Promise.all(promises).then(() => {\n            done();\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should load","suites":["websocket Node","websocket-client"],"updatePoint":{"line":433,"column":19,"index":11729},"line":433,"code":"    it('should load', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('path', getWsUrl(\"/ws\"));\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should not be server","suites":["websocket Node","websocket-client"],"updatePoint":{"line":448,"column":28,"index":12142},"line":448,"code":"    it('should not be server', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property('isServer', false);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle wholemsg property","suites":["websocket Node","websocket-client"],"updatePoint":{"line":463,"column":39,"index":12560},"line":463,"code":"    it('should handle wholemsg property', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"wholemsg\", false);\n        helper.getNode(\"n2\").should.have.property(\"wholemsg\", true);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should handle protocol property","suites":["websocket Node","websocket-client"],"updatePoint":{"line":484,"column":39,"index":13166},"line":484,"code":"    it('should handle protocol property', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        subprotocol: \"testprotocol1, testprotocol2\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        helper.getNode(\"n1\").should.have.property(\"subprotocol\", []);\n        helper.getNode(\"n2\").should.have.property(\"subprotocol\", [\"testprotocol1\", \"testprotocol2\"]);\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should connect to server","suites":["websocket Node","websocket-client"],"updatePoint":{"line":505,"column":32,"index":13825},"line":505,"code":"    it('should connect to server', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should initiate with subprotocol","suites":["websocket Node","websocket-client"],"updatePoint":{"line":521,"column":40,"index":14251},"line":521,"code":"    it('should initiate with subprotocol', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        subprotocol: \"testprotocol\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.should.have.property(\"protocol\", \"testprotocol\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should close on delete","suites":["websocket Node","websocket-client"],"updatePoint":{"line":539,"column":30,"index":14769},"line":539,"code":"    it('should close on delete', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n2\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('close', function () {\n            done();\n          });\n          helper.getNode(\"n2\").close();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive data","suites":["websocket Node","websocket-client"],"updatePoint":{"line":558,"column":27,"index":15279},"line":558,"code":"    it('should receive data', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('hello');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"payload\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg data ","suites":["websocket Node","websocket-client"],"updatePoint":{"line":586,"column":37,"index":16015},"line":586,"code":"    it('should receive wholemsg data ', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('{\"text\":\"hello\"}');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"text\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should receive wholemsg when data not JSON","suites":["websocket Node","websocket-client"],"updatePoint":{"line":615,"column":50,"index":16798},"line":615,"code":"    it('should receive wholemsg when data not JSON', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket in\",\n        client: \"n1\",\n        wires: [[\"n3\"]]\n      }, {\n        id: \"n3\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.send('hello');\n        });\n        helper.getNode(\"n3\").on(\"input\", function (msg) {\n          msg.should.have.property(\"payload\", \"hello\");\n          done();\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send","suites":["websocket Node","websocket-client"],"updatePoint":{"line":644,"column":19,"index":17542},"line":644,"code":"    it('should send', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            msg.should.equal(\"hello\");\n            done();\n          });\n        });\n        getSocket(\"n1\").on(\"open\", function () {\n          helper.getNode(\"n3\").send({\n            payload: \"hello\"\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send buffer","suites":["websocket Node","websocket-client"],"updatePoint":{"line":676,"column":26,"index":18355},"line":676,"code":"    it('should send buffer', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\")\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            Buffer.isBuffer(msg).should.be.true();\n            msg.should.have.length(5);\n            done();\n          });\n        });\n        getSocket(\"n1\").on(\"open\", function () {\n          helper.getNode(\"n3\").send({\n            payload: Buffer.from(\"hello\")\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should send wholemsg","suites":["websocket Node","websocket-client"],"updatePoint":{"line":709,"column":28,"index":19234},"line":709,"code":"    it('should send wholemsg', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\"\n      }, {\n        id: \"n1\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        client: \"n1\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('server').on('connection', function (sock) {\n          sock.on('message', function (msg) {\n            JSON.parse(msg).should.have.property(\"text\", \"hello\");\n            done();\n          });\n        });\n        getSocket(\"n1\").on('open', function () {\n          helper.getNode(\"n3\").send({\n            text: \"hello\"\n          });\n        });\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should NOT feedback more than once","suites":["websocket Node","websocket-client"],"updatePoint":{"line":742,"column":42,"index":20114},"line":742,"code":"    it('should NOT feedback more than once', function (done) {\n      var flow = [{\n        id: \"server\",\n        type: \"websocket-listener\",\n        path: \"/ws\",\n        wholemsg: \"true\"\n      }, {\n        id: \"client\",\n        type: \"websocket-client\",\n        path: getWsUrl(\"/ws\"),\n        wholemsg: \"true\"\n      }, {\n        id: \"n1\",\n        type: \"websocket in\",\n        client: \"client\",\n        wires: [[\"n2\", \"output\"]]\n      }, {\n        id: \"n2\",\n        type: \"websocket out\",\n        server: \"server\"\n      }, {\n        id: \"n3\",\n        type: \"helper\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"output\",\n        type: \"helper\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        getSocket('client').on('open', function () {\n          helper.getNode(\"n3\").send({\n            payload: \"ping\"\n          });\n        });\n        var acc = 0;\n        helper.getNode(\"output\").on(\"input\", function (msg) {\n          acc = acc + 1;\n        });\n        setTimeout(function () {\n          acc.should.equal(1);\n          helper.clearFlows();\n          done();\n        }, 250);\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should report error if no server config","suites":["websocket Node","websocket in node"],"updatePoint":{"line":789,"column":47,"index":21294},"line":789,"code":"    it('should report error if no server config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket in\",\n        mode: \"server\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"websocket in\";\n        });\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"websocket.errors.missing-conf\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should report error if no server config","suites":["websocket Node","websocket out node"],"updatePoint":{"line":807,"column":47,"index":21915},"line":807,"code":"    it('should report error if no server config', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"websocket out\",\n        mode: \"server\"\n      }];\n      helper.load(websocketNode, flow, function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"websocket out\";\n        });\n        //console.log(logEvents);\n        logEvents.should.have.length(1);\n        logEvents[0][0].should.have.a.property('msg');\n        logEvents[0][0].msg.toString().should.startWith(\"websocket.errors.missing-conf\");\n        done();\n      });\n    });","file":"nodes/core/network/22-websocket_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":99,"column":38,"index":2788},"line":99,"code":"  it('should recv data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":118,"column":52,"index":3227},"line":118,"code":"  it('should recv data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:o\\n)","suites":["TCP in Node"],"updatePoint":{"line":137,"column":53,"index":3671},"line":137,"code":"  it('should recv data (Stream/String/Delimiter:o\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"o\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"fo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/Delimiter:o\\n) and reattach o","suites":["TCP in Node"],"updatePoint":{"line":156,"column":68,"index":4130},"line":156,"code":"  it('should recv data (Stream/String/Delimiter:o\\\\n) and reattach o', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"o\\n\",\n      trim: true,\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\\n\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":176,"column":51,"index":4593},"line":176,"code":"  it('should recv data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\"], [\"foo\\nbar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":195,"column":38,"index":5018},"line":195,"code":"  it('should recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Single/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":214,"column":38,"index":5462},"line":214,"code":"  it('should recv data (Single/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Single/String)","suites":["TCP in Node"],"updatePoint":{"line":233,"column":38,"index":5887},"line":233,"code":"  it('should recv data (Single/String)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\\nbar\\nbaz\"], [\"foo\\nbar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":252,"column":38,"index":6324},"line":252,"code":"  it('should recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"single\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":271,"column":47,"index":6777},"line":271,"code":"  it('should recv multiple data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\"], [Buffer(\"foo\"), Buffer(\"bar\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":290,"column":61,"index":7247},"line":290,"code":"  it('should recv multiple data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\\nbaz\"], [\"foo\", \"bar\", \"baz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":309,"column":60,"index":7712},"line":309,"code":"  it('should recv multiple data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP0(flow, [\"foo\", \"bar\\nbaz\"], [\"foo\", \"bar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv multiple data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":328,"column":47,"index":8160},"line":328,"code":"  it('should recv multiple data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"server\",\n      host: \"localhost\",\n      port: port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var wdata = [\"foo\", \"bar\"];\n    var rdata = wdata.map(function (x) {\n      return Buffer(x).toString('base64');\n    });\n    testTCP0(flow, wdata, rdata, done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":351,"column":48,"index":8707},"line":351,"code":"  it('should connect & recv data (Stream/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/String/Delimiter:\\n)","suites":["TCP in Node"],"updatePoint":{"line":370,"column":62,"index":9163},"line":370,"code":"  it('should connect & recv data (Stream/String/Delimiter:\\\\n)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\"], [\"foo\", \"bar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/String/No delimiter)","suites":["TCP in Node"],"updatePoint":{"line":389,"column":61,"index":9622},"line":389,"code":"  it('should connect & recv data (Stream/String/No delimiter)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"utf8\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\"], [\"foo\\nbar\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":408,"column":48,"index":10064},"line":408,"code":"  it('should connect & recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"stream\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Single/Buffer)","suites":["TCP in Node"],"updatePoint":{"line":427,"column":48,"index":10525},"line":427,"code":"  it('should connect & recv data (Single/Buffer)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"buffer\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\")], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Single/String)","suites":["TCP in Node"],"updatePoint":{"line":446,"column":48,"index":10967},"line":446,"code":"  it('should connect & recv data (Single/String)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"utf8\",\n      newline: \"\\n\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\\nbar\\nbaz\"], [\"foo\\nbar\\nbaz\"], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should connect & recv data (Stream/Base64)","suites":["TCP in Node"],"updatePoint":{"line":465,"column":48,"index":11421},"line":465,"code":"  it('should connect & recv data (Stream/Base64)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"tcp in\",\n      server: \"client\",\n      host: \"localhost\",\n      port: server_port,\n      datamode: \"single\",\n      datatype: \"base64\",\n      newline: \"\",\n      topic: \"\",\n      base64: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    testTCP1(flow, [\"foo\"], [Buffer(\"foo\").toString('base64')], done);\n  });","file":"nodes/core/network/31-tcpin_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data","suites":["TCP Request Node","single message"],"updatePoint":{"line":112,"column":31,"index":3449},"line":112,"code":"    it('should send & recv data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should retain complete message","suites":["TCP Request Node","single message"],"updatePoint":{"line":133,"column":38,"index":3903},"line":133,"code":"    it('should retain complete message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data when specified character received","suites":["TCP Request Node","single message"],"updatePoint":{"line":154,"column":65,"index":4384},"line":154,"code":"    it('should send & recv data when specified character received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"char\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo0bar0',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo0',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data after fixed number of chars received","suites":["TCP Request Node","single message"],"updatePoint":{"line":175,"column":68,"index":4874},"line":175,"code":"    it('should send & recv data after fixed number of chars received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"count\",\n        splitc: \"7\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo bar',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection","suites":["TCP Request Node","single message"],"updatePoint":{"line":196,"column":51,"index":5346},"line":196,"code":"    it('should send & receive, then keep connection', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: 'foo',\n        topic: 'bar'\n      }, {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data to/from server:port from msg","suites":["TCP Request Node","single message"],"updatePoint":{"line":217,"column":60,"index":5821},"line":217,"code":"    it('should send & recv data to/from server:port from msg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"\",\n        port: \"\",\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCP(flow, {\n        payload: \"foo\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"ACK:foo\",\n        host: 'localhost',\n        port: port\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data","suites":["TCP Request Node","many messages"],"updatePoint":{"line":242,"column":31,"index":6355},"line":242,"code":"    it('should send & recv data', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: 'f',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'bar'\n      }], {\n        payload: 'ACK:foo',\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data when specified character received","suites":["TCP Request Node","many messages"],"updatePoint":{"line":269,"column":65,"index":6948},"line":269,"code":"    it('should send & recv data when specified character received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"char\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo0\",\n        topic: 'bar'\n      }, {\n        payload: \"bar0\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foo0\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data after fixed number of chars received","suites":["TCP Request Node","many messages"],"updatePoint":{"line":293,"column":68,"index":7497},"line":293,"code":"    it('should send & recv data after fixed number of chars received', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"count\",\n        splitc: \"7\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"fo\",\n        topic: 'bar'\n      }, {\n        payload: \"ob\",\n        topic: 'bar'\n      }, {\n        payload: \"ar\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foo\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection","suites":["TCP Request Node","many messages"],"updatePoint":{"line":320,"column":51,"index":8080},"line":320,"code":"    it('should send & receive, then keep connection', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'bar'\n      }, {\n        payload: \"bar\",\n        topic: 'bar'\n      }, {\n        payload: \"baz\",\n        topic: 'bar'\n      }], {\n        payload: \"ACK:foobarbaz\",\n        topic: 'bar'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and not split return strings","suites":["TCP Request Node","many messages"],"updatePoint":{"line":347,"column":81,"index":8700},"line":347,"code":"    it('should send & receive, then keep connection, and not split return strings', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar<A>\\nfoo\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and split return strings","suites":["TCP Request Node","many messages"],"updatePoint":{"line":372,"column":77,"index":9296},"line":372,"code":"    it('should send & receive, then keep connection, and split return strings', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"<A>\\\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & receive, then keep connection, and split return strings and reattach delimiter","suites":["TCP Request Node","many messages"],"updatePoint":{"line":397,"column":100,"index":9913},"line":397,"code":"    it('should send & receive, then keep connection, and split return strings and reattach delimiter', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        ret: \"string\",\n        newline: \"<A>\\\\n\",\n        trim: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"foo\",\n        topic: 'boo'\n      }, {\n        payload: \"bar<A>\\nfoo\",\n        topic: 'boo'\n      }], {\n        payload: \"ACK:foobar<A>\\n\",\n        topic: 'boo'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should send & recv data to/from server:port from msg","suites":["TCP Request Node","many messages"],"updatePoint":{"line":423,"column":60,"index":10515},"line":423,"code":"    it('should send & recv data to/from server:port from msg', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"\",\n        port: \"\",\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: \"f\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"o\",\n        host: \"localhost\",\n        port: port\n      }, {\n        payload: \"o\",\n        host: \"localhost\",\n        port: port\n      }], {\n        payload: \"ACK:foo\",\n        host: 'localhost',\n        port: port\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should limit the queue size","suites":["TCP Request Node","many messages"],"updatePoint":{"line":454,"column":35,"index":11167},"line":454,"code":"    it('should limit the queue size', function (done) {\n      RED.settings.tcpMsgQueueSize = 10;\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"sit\",\n        splitc: \"5\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      // create one more msg than is allowed\n      const msgs = new Array(RED.settings.tcpMsgQueueSize + 1).fill('x');\n      const expected = msgs.slice(0, -1);\n      testTCPMany(flow, msgs, \"ACK:\" + expected.join(''), done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should only retain the latest message","suites":["TCP Request Node","many messages"],"updatePoint":{"line":473,"column":45,"index":11751},"line":473,"code":"    it('should only retain the latest message', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"tcp request\",\n        server: \"localhost\",\n        port: port,\n        out: \"time\",\n        splitc: \"0\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      testTCPMany(flow, [{\n        payload: 'f',\n        topic: 'bar'\n      }, {\n        payload: 'o',\n        topic: 'baz'\n      }, {\n        payload: 'o',\n        topic: 'quux'\n      }], {\n        payload: 'ACK:foo',\n        topic: 'quux'\n      }, done);\n    });","file":"nodes/core/network/31-tcprequest_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (Buffer)","suites":["UDP in Node"],"updatePoint":{"line":70,"column":36,"index":2084},"line":70,"code":"  it('should recv IPv4 data (Buffer)', function (done) {\n    checkRecv('buffer', 'udp4', 'hello', Buffer('hello'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (String)","suites":["UDP in Node"],"updatePoint":{"line":73,"column":36,"index":2212},"line":73,"code":"  it('should recv IPv4 data (String)', function (done) {\n    checkRecv('utf8', 'udp4', 'hello', 'hello', done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv4 data (base64)","suites":["UDP in Node"],"updatePoint":{"line":76,"column":36,"index":2330},"line":76,"code":"  it('should recv IPv4 data (base64)', function (done) {\n    checkRecv('base64', 'udp4', 'hello', Buffer('hello').toString('base64'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (Buffer)","suites":["UDP in Node"],"updatePoint":{"line":79,"column":36,"index":2477},"line":79,"code":"  it('should recv IPv6 data (Buffer)', function (done) {\n    checkRecv('buffer', 'udp6', 'hello', Buffer('hello'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (String)","suites":["UDP in Node"],"updatePoint":{"line":82,"column":36,"index":2605},"line":82,"code":"  it('should recv IPv6 data (String)', function (done) {\n    checkRecv('utf8', 'udp6', 'hello', 'hello', done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should recv IPv6 data (base64)","suites":["UDP in Node"],"updatePoint":{"line":85,"column":36,"index":2723},"line":85,"code":"  it('should recv IPv6 data (base64)', function (done) {\n    checkRecv('base64', 'udp6', 'hello', Buffer('hello').toString('base64'), done);\n  });","file":"nodes/core/network/32-udpin_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data","suites":["UDP out Node"],"updatePoint":{"line":74,"column":27,"index":2179},"line":74,"code":"  it('should send IPv4 data', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), false, false, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data (base64)","suites":["UDP out Node"],"updatePoint":{"line":77,"column":36,"index":2316},"line":77,"code":"  it('should send IPv4 data (base64)', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), true, false, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should send IPv4 data with dest from msg","suites":["UDP out Node"],"updatePoint":{"line":80,"column":46,"index":2462},"line":80,"code":"  it('should send IPv4 data with dest from msg', function (done) {\n    checkSend('udp4', 'hello', Buffer.from('hello'), false, true, done);\n  });","file":"nodes/core/network/32-udpout_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with defaults","suites":["CSV node"],"updatePoint":{"line":33,"column":36,"index":1130},"line":33,"code":"  it('should be loaded with defaults', function (done) {\n    var flow = [{\n      id: \"csvNode1\",\n      type: \"csv\",\n      name: \"csvNode\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"csvNode1\");\n      n1.should.have.property('name', 'csvNode');\n      n1.should.have.property('template', '');\n      n1.should.have.property('sep', ',');\n      n1.should.have.property('quo', '\"');\n      n1.should.have.property('ret', '\\n');\n      n1.should.have.property('winflag', false);\n      n1.should.have.property('lineend', '\\n');\n      n1.should.have.property('multi', 'one');\n      n1.should.have.property('hdrin', false);\n      done();\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple csv string to a javascript object","suites":["CSV node","csv to json"],"updatePoint":{"line":68,"column":65,"index":2322},"line":68,"code":"    it('should convert a simple csv string to a javascript object', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          msg.should.have.property('columns', \"a,b,c,d\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with | separator (no template)","suites":["CSV node","csv to json"],"updatePoint":{"line":98,"column":92,"index":3174},"line":98,"code":"    it('should convert a simple string to a javascript object with | separator (no template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \"|\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            col1: 1,\n            col2: 2,\n            col3: 3,\n            col4: 4\n          });\n          msg.should.have.property('columns', \"col1,col2,col3,col4\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1|2|3|4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with tab separator (with template)","suites":["CSV node","csv to json"],"updatePoint":{"line":128,"column":96,"index":4047},"line":128,"code":"    it('should convert a simple string to a javascript object with tab separator (with template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \"\\t\",\n        temp: \"A,B,,D\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            A: 1,\n            B: 2,\n            D: 4\n          });\n          msg.should.have.property('columns', \"A,B,D\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1\\t2\\t3\\t4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple string to a javascript object with space separator (with spaced template)","suites":["CSV node","csv to json"],"updatePoint":{"line":158,"column":105,"index":4913},"line":158,"code":"    it('should convert a simple string to a javascript object with space separator (with spaced template)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        sep: \" \",\n        temp: \"A, B, , D\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            A: 1,\n            B: 2,\n            D: 4\n          });\n          msg.should.have.property('columns', \"A,B,D\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1 2 3 4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should remove quotes and whitespace from template","suites":["CSV node","csv to json"],"updatePoint":{"line":188,"column":57,"index":5730},"line":188,"code":"    it('should remove quotes and whitespace from template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: '\"a\",  \"b\" , \" c \",\" d  \" ',\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should create column names if no template provided","suites":["CSV node","csv to json"],"updatePoint":{"line":217,"column":58,"index":6508},"line":217,"code":"    it('should create column names if no template provided', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: '',\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            col1: 1,\n            col2: 2,\n            col3: 3,\n            col4: 4\n          });\n          msg.should.have.property('columns', \"col1,col2,col3,col4\");\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow dropping of fields from the template","suites":["CSV node","csv to json"],"updatePoint":{"line":247,"column":57,"index":7342},"line":247,"code":"    it('should allow dropping of fields from the template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,,,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            d: 4\n          });\n          msg.should.have.property('columns', 'a,d');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow commas and spaces in the template","suites":["CSV node","csv to json"],"updatePoint":{"line":275,"column":54,"index":8114},"line":275,"code":"    it('should allow commas and spaces in the template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b b,\\\"c,c\\\",\\\" d, d \\\"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c,c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,\"c,c\",\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV","suites":["CSV node","csv to json"],"updatePoint":{"line":305,"column":63,"index":8978},"line":305,"code":"    it('should allow passing in a template as first line of CSV', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c,c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,\"c,c\",\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a,b b,\"c,c\",\" d, d \"' + \"\\n\" + \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (not comma)","suites":["CSV node","csv to json"],"updatePoint":{"line":336,"column":75,"index":9883},"line":336,"code":"    it('should allow passing in a template as first line of CSV (not comma)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \";\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c;c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c;c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a;b b;\"c;c\";\" d, d \"' + \"\\n\" + \"1;2;3;4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (special char /)","suites":["CSV node","csv to json"],"updatePoint":{"line":368,"column":80,"index":10809},"line":368,"code":"    it('should allow passing in a template as first line of CSV (special char /)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \"/\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c/c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c/c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a/b b/\"c/c\"/\" d, d \"' + \"\\n\" + \"1/2/3/4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow passing in a template as first line of CSV (special char \\)","suites":["CSV node","csv to json"],"updatePoint":{"line":400,"column":81,"index":11736},"line":400,"code":"    it('should allow passing in a template as first line of CSV (special char \\\\)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        sep: \"\\\\\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            \"b b\": 2,\n            \"c\\\\c\": 3,\n            \"d, d\": 4\n          });\n          msg.should.have.property('columns', 'a,b b,c\\\\c,\"d, d\"');\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = 'a\\\\b b\\\\\"c\\\\c\"\\\\\" d, d \"' + \"\\n\" + \"1\\\\2\\\\3\\\\4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should leave numbers starting with 0, e and + as strings (except 0.)","suites":["CSV node","csv to json"],"updatePoint":{"line":432,"column":76,"index":12668},"line":432,"code":"    it('should leave numbers starting with 0, e and + as strings (except 0.)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 123,\n            b: \"0123\",\n            c: '+123',\n            d: 'e123',\n            e: 'E123',\n            f: -123\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '123,0123,+123,e123,E123,-123' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should not parse numbers when told not to do so","suites":["CSV node","csv to json"],"updatePoint":{"line":463,"column":55,"index":13513},"line":463,"code":"    it('should not parse numbers when told not to do so', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        strings: false,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: \"1.23\",\n            b: \"0123\",\n            c: \"+123\",\n            d: \"e123\",\n            e: \"0\",\n            f: \"-123\",\n            g: \"1e3\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '1.23,0123,+123,e123,0,-123,1e3' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should parse numbers when told to do so","suites":["CSV node","csv to json"],"updatePoint":{"line":496,"column":47,"index":14400},"line":496,"code":"    it('should parse numbers when told to do so', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1.23,\n            b: -123,\n            c: 1000,\n            d: 0\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = ' 1.23 ,  -123,1e3 ,    0  ' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should leave handle strings with scientific notation as numbers","suites":["CSV node","csv to json"],"updatePoint":{"line":525,"column":71,"index":15207},"line":525,"code":"    it('should leave handle strings with scientific notation as numbers', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 12000,\n            b: 0.012,\n            c: -12000,\n            d: -0.012\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '12E3,12e-3,-12e3,-12E-3' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow quotes in the input (but drop blank strings)","suites":["CSV node","csv to json"],"updatePoint":{"line":554,"column":65,"index":16014},"line":554,"code":"    it('should allow quotes in the input (but drop blank strings)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g,h\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: -2,\n            c: '+3',\n            d: '04',\n            f: '-05',\n            g: 'ab\"cd',\n            h: 'with,a,comma'\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"1\",\"-2\",\"+3\",\"04\",\"\",\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow blank strings in the input if selected","suites":["CSV node","csv to json"],"updatePoint":{"line":587,"column":59,"index":16941},"line":587,"code":"    it('should allow blank strings in the input if selected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        include_empty_strings: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: '',\n            c: '',\n            d: '',\n            e: '-05',\n            f: 'ab\"cd',\n            g: 'with,a,comma'\n          });\n          //check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"1\",\"\",\"\",\"\",\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should allow missing columns (nulls) in the input if selected","suites":["CSV node","csv to json"],"updatePoint":{"line":621,"column":69,"index":17902},"line":621,"code":"    it('should allow missing columns (nulls) in the input if selected', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        include_null_values: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: 1,\n            b: null,\n            c: '+3',\n            d: null,\n            e: '-05',\n            f: 'ab\"cd',\n            g: 'with,a,comma'\n          });\n          //check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"1\",,\"+3\",,\"-05\",\"ab\"\"cd\",\"with,a,comma\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle cr and lf in the input","suites":["CSV node","csv to json"],"updatePoint":{"line":655,"column":44,"index":18840},"line":655,"code":"    it('should handle cr and lf in the input', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          msg.should.have.property('payload', {\n            a: \"with a\\nnew line\",\n            b: \"and a\\rcarriage return\",\n            c: \"and why\\r\\nnot both\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = '\"with a' + String.fromCharCode(10) + 'new line\",\"and a' + String.fromCharCode(13) + 'carriage return\",\"and why\\r\\nnot both\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should recover from an odd number of quotes in the input","suites":["CSV node","csv to json"],"updatePoint":{"line":684,"column":64,"index":19800},"line":684,"code":"    it('should recover from an odd number of quotes in the input', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c == 0) {\n            c = 1;\n            msg.should.have.property('payload', {\n              a: \"with,an\",\n              b: \"odd,number\",\n              c: \"ofquotes\\n\"\n            });\n            check_parts(msg, 0, 1);\n          } else {\n            msg.should.have.property('payload', {\n              a: \"this is\",\n              b: \"a normal\",\n              c: \"line\"\n            });\n            check_parts(msg, 0, 1);\n            done();\n          }\n        });\n        var testString = '\"with,a\"n,odd\",\"num\"ber\",\"of\"qu\"ot\"es\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n        n1.emit(\"input\", {\n          payload: '\"this is\",\"a normal\",\"line\"'\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should recover from an odd number of quotes in the input (2)","suites":["CSV node","csv to json"],"updatePoint":{"line":726,"column":68,"index":20997},"line":726,"code":"    it('should recover from an odd number of quotes in the input (2)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e,f,g\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          //console.log(msg)\n          if (c == 0) {\n            c = 1;\n            msg.should.have.property('payload', {\n              a: \"with,an\",\n              b: \"odd,number\",\n              c: \"ofquotes\\nthis is,a normal,line\"\n            });\n            check_parts(msg, 0, 1);\n          } else {\n            msg.should.have.property('payload', {\n              a: \"this is\",\n              b: \"another\",\n              c: \"line\"\n            });\n            check_parts(msg, 0, 1);\n            done();\n          }\n        });\n        var testString = '\"with,a\"n,odd\",\"num\"ber\",\"of\"qu\"ot\"es\"' + String.fromCharCode(10) + '\"this is\",\"a normal\",\"line\"' + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n        n1.emit(\"input\", {\n          payload: '\"this is\",\"another\",\"line\"'\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use the first line as a template","suites":["CSV node","csv to json"],"updatePoint":{"line":769,"column":58,"index":22290},"line":769,"code":"    it('should be able to use the first line as a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          //console.log(msg);\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString = \"w,x,y,z\\n1,2,3,4\\n\\n5,6,7,8\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to output multiple lines as one array","suites":["CSV node","csv to json"],"updatePoint":{"line":812,"column":60,"index":23389},"line":812,"code":"    it('should be able to output multiple lines as one array', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        multi: \"yes\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          }, {\n            a: 5,\n            b: -6,\n            c: '07',\n            d: '+8'\n          }, {\n            a: 9,\n            b: 0,\n            c: 'a',\n            d: 'b'\n          }, {\n            a: 'c',\n            b: 'd',\n            c: 'e',\n            d: 'f'\n          }]);\n          msg.should.have.property('columns', 'a,b,c,d');\n          msg.should.not.have.property('parts');\n          done();\n        });\n        var testString = \"1,2,3,4\\n5,-6,07,+8\\n9,0,a,b\\nc,d,e,f\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to create an array from multiple parts","suites":["CSV node","csv to json"],"updatePoint":{"line":858,"column":61,"index":24530},"line":858,"code":"    it('should be able to create an array from multiple parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        multi: \"mult\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            \"a\": 1,\n            \"b\": 2,\n            \"c\": 3\n          }, {\n            \"a\": 4,\n            \"b\": 5,\n            \"c\": 6\n          }, {\n            \"a\": 7,\n            \"b\": 8,\n            \"c\": 9\n          }]);\n          msg.should.have.property('columns', 'a,b,c');\n          msg.should.not.have.property('parts');\n          done();\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"a,b,c\",\n          \"parts\": {\n            \"index\": 0,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"1,2,3\",\n          \"parts\": {\n            \"index\": 1,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"4,5,6\",\n          \"parts\": {\n            \"index\": 2,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n        n1.emit(\"input\", {\n          \"payload\": \"7,8,9\",\n          \"parts\": {\n            \"index\": 3,\n            count: 4,\n            \"ch\": \"\\n\",\n            \"type\": \"string\",\n            \"id\": \"1\"\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to output multiple objects as an array from an input of parts","suites":["CSV node","csv to json"],"updatePoint":{"line":930,"column":84,"index":26261},"line":930,"code":"    it('should be able to output multiple objects as an array from an input of parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        multi: \"yes\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', [{\n            \"Col1\": \"V1\",\n            \"Col2\": \"V2\"\n          }, {\n            \"Col1\": \"V3\",\n            \"Col2\": \"V4\"\n          }, {\n            \"Col1\": \"V5\",\n            \"Col2\": \"V6\"\n          }]);\n          msg.should.have.property('columns', 'Col1,Col2');\n          msg.should.have.property('parts');\n          done();\n        });\n        //var testString = \"1,2,3,4\\n5,-6,07,+8\\n9,0,a,b\\nc,d,e,f\";\n        // n1.emit(\"input\", {payload:testString});\n        n1.emit(\"input\", {\n          \"payload\": \"Col1,Col2\\nV1,V2\\nV3,V4\\nV5,V6\",\n          \"topic\": \"\",\n          \"parts\": {\n            \"id\": \"3af07e18.865652\",\n            \"type\": \"array\",\n            \"count\": 2,\n            \"len\": 1,\n            \"index\": 0\n          }\n        });\n        //n1.emit(\"input\", {\"payload\":\"Var1,Var2\\nW1,W2\\nW3,W4\\nW5,W6\",\"topic\":\"\",\"parts\":{\"id\":\"3af07e18.865652\",\"type\":\"array\",\"count\":2,\"len\":1,\"index\":1}});\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle numbers in strings but not IP addresses","suites":["CSV node","csv to json"],"updatePoint":{"line":977,"column":61,"index":27680},"line":977,"code":"    it('should handle numbers in strings but not IP addresses', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d,e\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: \"a\",\n            b: \"127.0.0.1\",\n            c: 56.7,\n            d: -32.8,\n            e: \"+76.22C\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"a,127.0.0.1,56.7,-32.8,+76.22C\";\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should preserve parts property","suites":["CSV node","csv to json"],"updatePoint":{"line":1007,"column":38,"index":28464},"line":1007,"code":"    it('should preserve parts property', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 1,\n            b: 2,\n            c: 3,\n            d: 4\n          });\n          check_parts(msg, 3, 4);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString,\n          parts: {\n            id: \"X\",\n            index: 3,\n            count: 4\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to use the first of multiple parts as a template if parts are present","suites":["CSV node","csv to json"],"updatePoint":{"line":1041,"column":92,"index":29354},"line":1041,"code":"    it('should be able to use the first of multiple parts as a template if parts are present', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString1 = \"w,x,y,z\\n\";\n        var testString2 = \"1,2,3,4\\n\";\n        var testString3 = \"5,6,7,8\\n\";\n        n1.emit(\"input\", {\n          payload: testString1,\n          parts: {\n            id: \"X\",\n            index: 0,\n            count: 3\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString2,\n          parts: {\n            id: \"X\",\n            index: 1,\n            count: 3\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString3,\n          parts: {\n            id: \"X\",\n            index: 2,\n            count: 3\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start if requested","suites":["CSV node","csv to json"],"updatePoint":{"line":1106,"column":57,"index":30903},"line":1106,"code":"    it('should skip several lines from start if requested', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            a: 9,\n            b: 0,\n            c: \"A\",\n            d: \"B\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start then use next line as a template","suites":["CSV node","csv to json"],"updatePoint":{"line":1136,"column":77,"index":31779},"line":1136,"code":"    it('should skip several lines from start then use next line as a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrin: true,\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload', {\n            \"9\": \"C\",\n            \"0\": \"D\",\n            \"A\": \"E\",\n            \"B\": \"F\"\n          });\n          check_parts(msg, 0, 1);\n          done();\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10) + \"C,D,E,F\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should skip several lines from start and correct parts","suites":["CSV node","csv to json"],"updatePoint":{"line":1167,"column":62,"index":32711},"line":1167,"code":"    it('should skip several lines from start and correct parts', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              a: 9,\n              b: 0,\n              c: \"A\",\n              d: \"B\"\n            });\n            check_parts(msg, 0, 2);\n            c = c + 1;\n          } else {\n            msg.should.have.property('payload', {\n              a: \"C\",\n              b: \"D\",\n              c: \"E\",\n              d: \"F\"\n            });\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testString = \"1,2,3,4\" + String.fromCharCode(10) + \"5,6,7,8\" + String.fromCharCode(10) + \"9,0,A,B\" + String.fromCharCode(10) + \"C,D,E,F\" + String.fromCharCode(10);\n        n1.emit(\"input\", {\n          payload: testString\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to skip and then use the first of multiple parts as a template if parts are present","suites":["CSV node","csv to json"],"updatePoint":{"line":1209,"column":106,"index":33957},"line":1209,"code":"    it('should be able to skip and then use the first of multiple parts as a template if parts are present', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrin: true,\n        skip: 2,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          if (c === 0) {\n            msg.should.have.property('payload', {\n              w: 1,\n              x: 2,\n              y: 3,\n              z: 4\n            });\n            msg.should.have.property('columns', 'w,x,y,z');\n            check_parts(msg, 0, 2);\n            c += 1;\n          } else {\n            msg.should.have.property('payload', {\n              w: 5,\n              x: 6,\n              y: 7,\n              z: 8\n            });\n            msg.should.have.property('columns', 'w,x,y,z');\n            check_parts(msg, 1, 2);\n            done();\n          }\n        });\n        var testStringA = \"foo\\n\";\n        var testStringB = \"bar\\n\";\n        var testString1 = \"w,x,y,z\\n\";\n        var testString2 = \"1,2,3,4\\n\";\n        var testString3 = \"5,6,7,8\\n\";\n        n1.emit(\"input\", {\n          payload: testStringA,\n          parts: {\n            id: \"X\",\n            index: 0,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testStringB,\n          parts: {\n            id: \"X\",\n            index: 1,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString1,\n          parts: {\n            id: \"X\",\n            index: 2,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString2,\n          parts: {\n            id: \"X\",\n            index: 3,\n            count: 5\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testString3,\n          parts: {\n            id: \"X\",\n            index: 4,\n            count: 5\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1297,"column":52,"index":36093},"line":1297,"code":"    it('should convert a simple object back to a csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,,e,f,g,h,i,j,k\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // console.log(\"GOT\",msg)\n          try {\n            msg.should.have.property('payload', '4,foo,true,,0,\"Hello\\nWorld\",,,undefined,null,null\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          e: 0,\n          d: 1,\n          b: \"foo\",\n          c: true,\n          a: 4,\n          f: \"Hello\\nWorld\",\n          h: undefined,\n          i: \"undefined\",\n          j: null,\n          k: \"null\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a csv with no template","suites":["CSV node","json object to csv"],"updatePoint":{"line":1336,"column":69,"index":37103},"line":1336,"code":"    it('should convert a simple object back to a csv with no template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \" \",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          // console.log(\"GOT\",msg)\n          try {\n            msg.should.have.property('payload', '1,foo,\"ba\"\"r\",\"di,ng\",,undefined,null\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: \"foo\",\n          c: \"ba\\\"r\",\n          a: \"di,ng\",\n          e: undefined,\n          f: \"undefined\",\n          g: null,\n          h: \"null\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple object back to a tsv using a tab as a separator","suites":["CSV node","json object to csv"],"updatePoint":{"line":1373,"column":79,"index":38055},"line":1373,"code":"    it('should convert a simple object back to a tsv using a tab as a separator', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        sep: \"\\t\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '1\\tfoo\\t\"ba\"\"r\"\\tdi,ng\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: \"foo\",\n          c: \"ba\\\"r\",\n          a: \"di,ng\"\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle a template with spaces in the property names","suites":["CSV node","json object to csv"],"updatePoint":{"line":1406,"column":66,"index":38871},"line":1406,"code":"    it('should handle a template with spaces in the property names', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b o,c p,,e\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '4,foo,true,,0\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          e: 0,\n          d: 1,\n          \"b o\": \"foo\",\n          \"c p\": true,\n          a: 4\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1439,"column":62,"index":39682},"line":1439,"code":"    it('should convert an array of objects to a multi-line csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,d,c,b\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '4,1,2,3\\n1,4,3,2\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv and add a header","suites":["CSV node","json object to csv"],"updatePoint":{"line":1476,"column":79,"index":40555},"line":1476,"code":"    it('should convert an array of objects to a multi-line csv and add a header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrout: \"all\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,b,c,d\\n4,3,2,1\\n1,2,3,\"a\\nb\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: \"a\\nb\",\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv without a template","suites":["CSV node","json object to csv"],"updatePoint":{"line":1514,"column":81,"index":41472},"line":1514,"code":"    it('should convert an array of objects to a multi-line csv without a template', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '1,3,2,4\\n4,2,3,1\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: 2\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of objects to a multi-line csv without a template and with a header","suites":["CSV node","json object to csv"],"updatePoint":{"line":1551,"column":99,"index":42358},"line":1551,"code":"    it('should convert an array of objects to a multi-line csv without a template and with a header', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrout: \"all\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'd,b,c,a\\n1,3,2,4\\n4,\"f\\ng\",3,1\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }, {\n          d: 4,\n          a: 1,\n          c: 3,\n          b: \"f\\ng\"\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert a simple array back to a csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1589,"column":51,"index":43238},"line":1589,"code":"    it('should convert a simple array back to a csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', ',0,1,foo,\"ba\"\"r\",\"di,ng\",\"fa\\nba\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [\"\", 0, 1, \"foo\", 'ba\"r', 'di,ng', \"fa\\nba\"];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array of arrays back to a multi-line csv","suites":["CSV node","json object to csv"],"updatePoint":{"line":1616,"column":66,"index":44007},"line":1616,"code":"    it('should convert an array of arrays back to a multi-line csv', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '0,1,2,3,4\\n4,3,2,1,0\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [[0, 1, 2, 3, 4], [4, 3, 2, 1, 0]];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to include column names as first row","suites":["CSV node","json object to csv"],"updatePoint":{"line":1643,"column":59,"index":44746},"line":1643,"code":"    it('should be able to include column names as first row', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        hdrout: true,\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,b,c,d\\r\\n4,3,2,1\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to include column names as first row, and missing properties","suites":["CSV node","json object to csv"],"updatePoint":{"line":1677,"column":83,"index":45594},"line":1677,"code":"    it('should be able to include column names as first row, and missing properties', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        hdrout: true,\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'col1,col2,col3,col4\\r\\nH1,H2,H3,H4\\r\\nA,B,,\\r\\nA,,C,\\r\\nA,,,\"D\\nE\"\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          \"col1\": \"H1\",\n          \"col2\": \"H2\",\n          \"col3\": \"H3\",\n          \"col4\": \"H4\"\n        }, {\n          \"col1\": \"A\",\n          \"col2\": \"B\"\n        }, {\n          \"col1\": \"A\",\n          \"col3\": \"C\"\n        }, {\n          \"col1\": \"A\",\n          \"col4\": \"D\\nE\"\n        }];\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to pass in column names","suites":["CSV node","json object to csv"],"updatePoint":{"line":1719,"column":46,"index":46637},"line":1719,"code":"    it('should be able to pass in column names', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"\",\n        hdrout: \"once\",\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          count += 1;\n          try {\n            if (count === 1) {\n              msg.should.have.property('payload', 'a,,b,a\\r\\n4,,3,4\\r\\n');\n            }\n            if (count === 3) {\n              msg.should.have.property('payload', '4,,3,4\\r\\n');\n              done();\n            }\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = [{\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        }];\n        n1.emit(\"input\", {\n          payload: testJson,\n          columns: \"a,,b,a\",\n          parts: {\n            index: 0\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testJson,\n          parts: {\n            index: 1\n          }\n        });\n        n1.emit(\"input\", {\n          payload: testJson,\n          parts: {\n            index: 2\n          }\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be able to pass in column names - with payload as an array","suites":["CSV node","json object to csv"],"updatePoint":{"line":1776,"column":73,"index":47994},"line":1776,"code":"    it('should be able to pass in column names - with payload as an array', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        hdrout: \"once\",\n        ret: \"\\r\\n\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', 'a,,b,a\\r\\n4,,3,4\\r\\n4,,3,4\\r\\n4,,3,4\\r\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: 1,\n          b: 3,\n          c: 2,\n          a: 4\n        };\n        n1.emit(\"input\", {\n          payload: [testJson, testJson, testJson],\n          columns: \"a,,b,a\"\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should handle quotes and sub-properties","suites":["CSV node","json object to csv"],"updatePoint":{"line":1810,"column":47,"index":48850},"line":1810,"code":"    it('should handle quotes and sub-properties', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"csv\",\n        temp: \"a,b,c,d\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(csvNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload', '{},\"text,with,commas\",\"This \"\"is\"\" a banana\",\"{\"\"sub\"\":\"\"object\"\"}\"\\n');\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        var testJson = {\n          d: {\n            sub: \"object\"\n          },\n          b: \"text,with,commas\",\n          c: 'This \"is\" a banana',\n          a: {\n            sub2: undefined\n          }\n        };\n        n1.emit(\"input\", {\n          payload: testJson\n        });\n      });\n    });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should just pass through if no payload provided","suites":["CSV node","json object to csv"],"updatePoint":{"line":1847,"column":53,"index":49790},"line":1847,"code":"  it('should just pass through if no payload provided', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', {\n            a: 4,\n            b: 3,\n            c: 2,\n            d: 1\n          });\n          msg.should.not.have.property('payload');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      var testJson = {\n        d: 1,\n        b: 3,\n        c: 2,\n        a: 4\n      };\n      n1.emit(\"input\", {\n        topic: testJson\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should warn if provided a number or boolean","suites":["CSV node","json object to csv"],"updatePoint":{"line":1885,"column":49,"index":50604},"line":1885,"code":"  it('should warn if provided a number or boolean', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(csvNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"csv\";\n          });\n          logEvents.should.have.length(2);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.startWith('csv.errors.csv_js');\n          logEvents[1][0].should.have.a.property('msg');\n          logEvents[1][0].msg.toString().should.startWith('csv.errors.csv_js');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 150);\n      n1.emit(\"input\", {\n        payload: 1\n      });\n      n1.emit(\"input\", {\n        payload: true\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should call done when message processing is completed","suites":["CSV node","json object to csv"],"updatePoint":{"line":1921,"column":59,"index":51653},"line":1921,"code":"  it('should call done when message processing is completed', function (done) {\n    const completeNode = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/24-complete.js\");\n    const flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[]]\n    }, {\n      id: \"c1\",\n      type: \"complete\",\n      scope: [\"n1\"],\n      uncaught: false,\n      wires: [[\"h1\"]]\n    }, {\n      id: \"h1\",\n      type: \"helper\",\n      wires: [[]]\n    }];\n    helper.load([csvNode, completeNode], flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const h1 = helper.getNode(\"h1\");\n      h1.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property('payload', \"1,2,3,4\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"1,2,3,4\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should call done when input causes an error","suites":["CSV node","json object to csv"],"updatePoint":{"line":1955,"column":49,"index":52512},"line":1955,"code":"  it('should call done when input causes an error', function (done) {\n    const completeNode = require(\"nr-test-utils\").require(\"@node-red/nodes/core/common/24-complete.js\");\n    const flow = [{\n      id: \"n1\",\n      type: \"csv\",\n      temp: \"a,b,c,d\",\n      wires: [[]]\n    }, {\n      id: \"c1\",\n      type: \"complete\",\n      scope: [\"n1\"],\n      uncaught: false,\n      wires: [[\"h1\"]]\n    }, {\n      id: \"h1\",\n      type: \"helper\",\n      wires: [[]]\n    }];\n    helper.load([csvNode, completeNode], flow, function () {\n      const n1 = helper.getNode(\"n1\");\n      const h1 = helper.getNode(\"h1\");\n      h1.on(\"input\", function (msg) {\n        try {\n          msg.should.have.a.property('payload', 1);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      }); // neither object nor string\n    });\n  });","file":"nodes/core/parsers/70-CSV_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["HTML node"],"updatePoint":{"line":37,"column":22,"index":1366},"line":37,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"htmlNode1\",\n      type: \"html\",\n      name: \"htmlNode\"\n    }];\n    helper.load(htmlNode, flow, function () {\n      var htmlNode1 = helper.getNode(\"htmlNode1\");\n      htmlNode1.should.have.property('name', 'htmlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select","suites":["HTML node"],"updatePoint":{"line":49,"column":63,"index":1725},"line":49,"code":"  it('should retrieve header contents if asked to by msg.select', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, 'This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        // include 'body' in the select to verify we're in document mode\n        // for the parser. See https://github.com/node-red/node-red/issues/3079\n        n1.receive({\n          payload: data,\n          topic: \"bar\",\n          select: \"body h1\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select - alternative in property","suites":["HTML node"],"updatePoint":{"line":82,"column":89,"index":2758},"line":82,"code":"  it('should retrieve header contents if asked to by msg.select - alternative in property', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        property: \"foo\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.foo[0].should.equal('This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          foo: data,\n          topic: \"bar\",\n          select: \"h1\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve header contents if asked to by msg.select - alternative in and out properties","suites":["HTML node"],"updatePoint":{"line":114,"column":99,"index":3662},"line":114,"code":"  it('should retrieve header contents if asked to by msg.select - alternative in and out properties', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        property: \"foo\",\n        outproperty: \"bar\",\n        tag: \"h1\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.bar[0].should.equal('This is a test page for node 70-HTML');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          foo: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should emit an empty array if no matching elements","suites":["HTML node"],"updatePoint":{"line":147,"column":56,"index":4546},"line":147,"code":"  it('should emit an empty array if no matching elements', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.have.property('payload');\n            msg.payload.should.be.empty;\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\",\n          select: \"h4\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve paragraph contents when specified","suites":["HTML node"],"updatePoint":{"line":179,"column":55,"index":5398},"line":179,"code":"  it('should retrieve paragraph contents when specified', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        ret: \"text\",\n        tag: \"p\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, 'There\\'s nothing to read here.');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as an array of html as default","suites":["HTML node"],"updatePoint":{"line":210,"column":66,"index":6230},"line":210,"code":"  it('should retrieve list contents as an array of html as default', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"ol\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.payload[0].indexOf(\"<li>Blue</li>\").should.be.above(-1);\n            msg.payload[0].indexOf(\"<li>Red</li>\").should.be.above(-1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as an array of text","suites":["HTML node"],"updatePoint":{"line":241,"column":55,"index":7103},"line":241,"code":"  it('should retrieve list contents as an array of text', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"ol\",\n        ret: \"text\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.payload[0].indexOf(\"Blue\").should.be.above(-1);\n            msg.payload[0].indexOf(\"Red\").should.be.above(-1);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should fix up a unclosed tag","suites":["HTML node"],"updatePoint":{"line":273,"column":34,"index":7958},"line":273,"code":"  it('should fix up a unclosed tag', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"span\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            should.equal(msg.payload, '<img src=\"foo.png\"/>');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve an attribute from a tag","suites":["HTML node"],"updatePoint":{"line":303,"column":45,"index":8741},"line":303,"code":"  it('should retrieve an attribute from a tag', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        ret: \"attr\",\n        tag: \"span img\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload[0].should.have.property('src', 'foo.png');\n            msg.should.have.property('topic', 'bar');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: data,\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should log on error","suites":["HTML node"],"updatePoint":{"line":335,"column":25,"index":9582},"line":335,"code":"  it('should log on error', function (done) {\n    fs.readFile(file, function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        tag: \"p\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        try {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n1.receive({\n            payload: null,\n            topic: \"bar\"\n          });\n          setTimeout(function () {\n            try {\n              helper.log().called.should.be.true();\n              var logEvents = helper.log().args.filter(function (evt) {\n                return evt[0].type == \"html\";\n              });\n              logEvents.should.have.length(1);\n              // Each logEvent is the array of args passed to the function.\n              logEvents[0][0].should.have.a.property('msg');\n              logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          }, 50);\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should pass through if payload empty","suites":["HTML node"],"updatePoint":{"line":375,"column":42,"index":10781},"line":375,"code":"  it('should pass through if payload empty', function (done) {\n    fs.readFile(file, 'utf8', function (err, data) {\n      var flow = [{\n        id: \"n1\",\n        type: \"html\",\n        wires: [[\"n2\"]],\n        func: \"return msg;\"\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(htmlNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('topic', 'bar');\n            msg.should.not.have.property('payload');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          topic: \"bar\"\n        });\n      });\n    });\n  });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as html as default with output as multiple msgs","suites":["HTML node","multiple messages"],"updatePoint":{"line":425,"column":85,"index":12278},"line":425,"code":"    it('should retrieve list contents as html as default with output as multiple msgs', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n              if (cnt === 1) {\n                msg.payload.indexOf(\"<li>Apple</li>\").should.be.above(-1);\n                msg.payload.indexOf(\"<li>Pear</li>\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.payload.indexOf(\"<li>Potato</li>\").should.be.above(-1);\n                msg.payload.indexOf(\"<li>Parsnip</li>\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as html as default with output as multiple msgs - alternative property","suites":["HTML node","multiple messages"],"updatePoint":{"line":467,"column":108,"index":13682},"line":467,"code":"    it('should retrieve list contents as html as default with output as multiple msgs - alternative property', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          property: \"foo\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n              if (cnt === 1) {\n                msg.foo.indexOf(\"<li>Apple</li>\").should.be.above(-1);\n                msg.foo.indexOf(\"<li>Pear</li>\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.foo.indexOf(\"<li>Potato</li>\").should.be.above(-1);\n                msg.foo.indexOf(\"<li>Parsnip</li>\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            foo: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve list contents as text with output as multiple msgs ","suites":["HTML node","multiple messages"],"updatePoint":{"line":510,"column":75,"index":15060},"line":510,"code":"    it('should retrieve list contents as text with output as multiple msgs ', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          ret: \"text\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, cnt - 1, 2);\n              if (cnt !== 1 && cnt !== 2) {\n                return false;\n              }\n              if (cnt === 1) {\n                msg.payload.indexOf(\"Apple\").should.be.above(-1);\n                msg.payload.indexOf(\"Pear\").should.be.above(-1);\n              } else if (cnt === 2) {\n                msg.payload.indexOf(\"Potato\").should.be.above(-1);\n                msg.payload.indexOf(\"Parsnip\").should.be.above(-1);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should retrieve an attribute from a tag","suites":["HTML node","multiple messages"],"updatePoint":{"line":553,"column":47,"index":16390},"line":553,"code":"    it('should retrieve an attribute from a tag', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          ret: \"attr\",\n          tag: \"span img\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          n2.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property('payload');\n              msg.payload.should.have.property('src', 'foo.png');\n              msg.should.have.property('topic', 'bar');\n              check_parts(msg, 0, 1);\n              cnt = 2; // frig the answer as only one img tag\n              done();\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should not reuse message","suites":["HTML node","multiple messages"],"updatePoint":{"line":588,"column":32,"index":17420},"line":588,"code":"    it('should not reuse message', function (done) {\n      fs.readFile(file, 'utf8', function (err, data) {\n        var flow = [{\n          id: \"n1\",\n          type: \"html\",\n          wires: [[\"n2\"]],\n          tag: \"ul\",\n          ret: \"text\",\n          as: \"multi\"\n        }, {\n          id: \"n2\",\n          type: \"helper\"\n        }];\n        helper.load(htmlNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          var prev_msg = undefined;\n          n2.on(\"input\", function (msg) {\n            try {\n              cnt++;\n              if (prev_msg == undefined) {\n                prev_msg = msg;\n              } else {\n                msg.should.not.equal(prev_msg);\n              }\n              if (cnt == 2) {\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n          });\n          n1.receive({\n            payload: data,\n            topic: \"bar\"\n          });\n        });\n      });\n    });","file":"nodes/core/parsers/70-HTML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid json string to a javascript object","suites":["JSON node"],"updatePoint":{"line":30,"column":63,"index":1088},"line":30,"code":"  it('should convert a valid json string to a javascript object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var jsonString = ' {\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}\\r\\n ';\n      jn1.receive({\n        payload: jsonString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a buffer of a valid json string to a javascript object","suites":["JSON node"],"updatePoint":{"line":56,"column":75,"index":1946},"line":56,"code":"  it('should convert a buffer of a valid json string to a javascript object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var jsonString = Buffer.from(' {\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}\\r\\n ');\n      jn1.receive({\n        payload: jsonString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a json string","suites":["JSON node"],"updatePoint":{"line":83,"column":57,"index":2820},"line":83,"code":"  it('should convert a javascript object to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a array to a json string","suites":["JSON node"],"updatePoint":{"line":110,"column":45,"index":3484},"line":110,"code":"  it('should convert a array to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '[1,2,3]');\n        done();\n      });\n      var obj = [1, 2, 3];\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a boolean to a json string","suites":["JSON node"],"updatePoint":{"line":132,"column":47,"index":4012},"line":132,"code":"  it('should convert a boolean to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, 'true');\n        done();\n      });\n      var obj = true;\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a json string to a boolean","suites":["JSON node"],"updatePoint":{"line":154,"column":47,"index":4532},"line":154,"code":"  it('should convert a json string to a boolean', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, true);\n        done();\n      });\n      var obj = \"true\";\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a number to a json string","suites":["JSON node"],"updatePoint":{"line":176,"column":46,"index":5051},"line":176,"code":"  it('should convert a number to a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '2019');\n        done();\n      });\n      var obj = 2019;\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should convert a json string to a number","suites":["JSON node"],"updatePoint":{"line":198,"column":46,"index":5570},"line":198,"code":"  it('should convert a json string to a number', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, 1962);\n        done();\n      });\n      var obj = '1962';\n      jn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid json string","suites":["JSON node"],"updatePoint":{"line":220,"column":66,"index":6109},"line":220,"code":"  it('should log an error if asked to parse an invalid json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        jn1.receive({\n          payload: 'foo',\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"Unexpected token o\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid json string in a buffer","suites":["JSON node"],"updatePoint":{"line":256,"column":78,"index":7160},"line":256,"code":"  it('should log an error if asked to parse an invalid json string in a buffer', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        jn1.receive({\n          payload: Buffer.from('{\"name\":foo}'),\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"Unexpected token o\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 20);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass straight through if no payload set","suites":["JSON node"],"updatePoint":{"line":317,"column":52,"index":9246},"line":317,"code":"  it('should pass straight through if no payload set', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      jn1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should ensure the result is a json string","suites":["JSON node"],"updatePoint":{"line":339,"column":47,"index":9800},"line":339,"code":"  it('should ensure the result is a json string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      var count = 0;\n      jn2.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.payload, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n          count++;\n          if (count === 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n      jn1.receive({\n        payload: JSON.stringify(obj),\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should ensure the result is a JS Object","suites":["JSON node"],"updatePoint":{"line":380,"column":45,"index":10752},"line":380,"code":"  it('should ensure the result is a JS Object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      var count = 0;\n      jn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.payload.should.have.property('employees');\n          msg.payload.employees[0].should.have.property('firstName', 'John');\n          msg.payload.employees[0].should.have.property('lastName', 'Smith');\n          count++;\n          if (count === 2) {\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      jn1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n      jn1.receive({\n        payload: JSON.stringify(obj),\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should handle any msg property - receive existing string","suites":["JSON node"],"updatePoint":{"line":424,"column":62,"index":11890},"line":424,"code":"  it('should handle any msg property - receive existing string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      property: \"one.two\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property('topic', 'bar');\n          msg.should.have.property('one');\n          msg.one.should.have.property('two');\n          msg.one.two.should.have.property('employees');\n          msg.one.two.employees[0].should.have.property('firstName', 'John');\n          msg.one.two.employees[0].should.have.property('lastName', 'Smith');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var jsonString = '{\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}';\n      jn1.receive({\n        payload: \"\",\n        one: {\n          two: jsonString\n        },\n        topic: \"bar\"\n      });\n      var logEvents = helper.log().args.filter(function (evt) {\n        return evt[0].type == \"json\";\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should handle any msg property - receive existing obj","suites":["JSON node"],"updatePoint":{"line":463,"column":59,"index":13078},"line":463,"code":"  it('should handle any msg property - receive existing obj', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      property: \"one.two\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        try {\n          should.equal(msg.one.two, '{\"employees\":[{\"firstName\":\"John\",\"lastName\":\"Smith\"}]}');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n      var jsonString = '{\"employees\":[{\"firstName\":\"John\", \"lastName\":\"Smith\"}]}';\n      jn1.receive({\n        payload: \"\",\n        one: {\n          two: JSON.parse(jsonString)\n        },\n        topic: \"bar\"\n      });\n      var logEvents = helper.log().args.filter(function (evt) {\n        return evt[0].type == \"json\";\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass an object if provided a valid JSON string and schema","suites":["JSON node"],"updatePoint":{"line":497,"column":70,"index":14030},"line":497,"code":"  it('should pass an object if provided a valid JSON string and schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload.number, 3);\n        should.equal(msg.payload.string, \"allo\");\n        done();\n      });\n      var jsonString = '{\"number\": 3, \"string\": \"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass an object if provided a valid object and schema and action is object","suites":["JSON node"],"updatePoint":{"line":533,"column":86,"index":14942},"line":533,"code":"  it('should pass an object if provided a valid object and schema and action is object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload.number, 3);\n        should.equal(msg.payload.string, \"allo\");\n        done();\n      });\n      var obj = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: obj,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass a string if provided a valid object and schema","suites":["JSON node"],"updatePoint":{"line":573,"column":64,"index":15861},"line":573,"code":"  it('should pass a string if provided a valid object and schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"number\":3,\"string\":\"allo\"}');\n        done();\n      });\n      var obj = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: obj,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should pass a string if provided a valid JSON string and schema and action is string","suites":["JSON node"],"updatePoint":{"line":611,"column":90,"index":16757},"line":611,"code":"  it('should pass a string if provided a valid JSON string and schema and action is string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, '{\"number\":3,\"string\":\"allo\"}');\n        done();\n      });\n      var jsonString = '{\"number\":3,\"string\":\"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid object and valid schema","suites":["JSON node"],"updatePoint":{"line":647,"column":70,"index":17643},"line":647,"code":"  it('should log an error if passed an invalid object and valid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid object and valid schema and action is object","suites":["JSON node"],"updatePoint":{"line":699,"column":91,"index":19051},"line":699,"code":"  it('should log an error if passed an invalid object and valid schema and action is object', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"obj\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid JSON string and valid schema","suites":["JSON node"],"updatePoint":{"line":752,"column":75,"index":20464},"line":752,"code":"  it('should log an error if passed an invalid JSON string and valid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var jsonString = '{\"number\":\"Hello\",\"string\":3}';\n        jn1.receive({\n          payload: jsonString,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed an invalid JSON string and valid schema and action is string","suites":["JSON node"],"updatePoint":{"line":801,"column":96,"index":21862},"line":801,"code":"  it('should log an error if passed an invalid JSON string and valid schema and action is string', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = {\n          title: \"testSchema\",\n          type: \"object\",\n          properties: {\n            number: {\n              type: \"number\"\n            },\n            string: {\n              type: \"string\"\n            }\n          }\n        };\n        var jsonString = '{\"number\":\"Hello\",\"string\":3}';\n        jn1.receive({\n          payload: jsonString,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"json.errors.schema-error\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if passed a valid object and invalid schema","suites":["JSON node"],"updatePoint":{"line":851,"column":69,"index":23254},"line":851,"code":"  it('should log an error if passed a valid object and invalid schema', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      try {\n        var jn1 = helper.getNode(\"jn1\");\n        var jn2 = helper.getNode(\"jn2\");\n        var schema = \"garbage\";\n        var obj = {\n          \"number\": \"foo\",\n          \"string\": 3\n        };\n        jn1.receive({\n          payload: obj,\n          schema: schema\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"json\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.equal(\"json.errors.schema-error-compile\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"msg.schema property should be deleted before sending to next node (string input)","suites":["JSON node"],"updatePoint":{"line":892,"column":86,"index":24435},"line":892,"code":"  it('msg.schema property should be deleted before sending to next node (string input)', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.schema, undefined);\n        done();\n      });\n      var jsonString = '{\"number\":3,\"string\":\"allo\"}';\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonString,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"msg.schema property should be deleted before sending to next node (object input)","suites":["JSON node"],"updatePoint":{"line":928,"column":86,"index":25315},"line":928,"code":"  it('msg.schema property should be deleted before sending to next node (object input)', function (done) {\n    var flow = [{\n      id: \"jn1\",\n      type: \"json\",\n      action: \"str\",\n      wires: [[\"jn2\"]]\n    }, {\n      id: \"jn2\",\n      type: \"helper\"\n    }];\n    helper.load(jsonNode, flow, function () {\n      var jn1 = helper.getNode(\"jn1\");\n      var jn2 = helper.getNode(\"jn2\");\n      jn2.on(\"input\", function (msg) {\n        should.equal(msg.schema, undefined);\n        done();\n      });\n      var jsonObject = {\n        \"number\": 3,\n        \"string\": \"allo\"\n      };\n      var schema = {\n        title: \"testSchema\",\n        type: \"object\",\n        properties: {\n          number: {\n            type: \"number\"\n          },\n          string: {\n            type: \"string\"\n          }\n        }\n      };\n      jn1.receive({\n        payload: jsonObject,\n        schema: schema\n      });\n    });\n  });","file":"nodes/core/parsers/70-JSON_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["XML node"],"updatePoint":{"line":30,"column":22,"index":1044},"line":30,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"xmlNode1\",\n      type: \"xml\",\n      name: \"xmlNode\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var xmlNode1 = helper.getNode(\"xmlNode1\");\n      xmlNode1.should.have.property('name', 'xmlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object","suites":["XML node"],"updatePoint":{"line":42,"column":62,"index":1394},"line":42,"code":"  it('should convert a valid xml string to a javascript object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees.should.have.property('firstName');\n        should.equal(msg.payload.employees.firstName[0], 'John');\n        msg.payload.employees.should.have.property('lastName');\n        should.equal(msg.payload.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n  ';\n      n1.receive({\n        payload: string,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object - alternative property","suites":["XML node"],"updatePoint":{"line":71,"column":85,"index":2401},"line":71,"code":"  it('should convert a valid xml string to a javascript object - alternative property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      property: \"foo\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.foo.should.have.property('employees');\n        msg.foo.employees.should.have.property('firstName');\n        should.equal(msg.foo.employees.firstName[0], 'John');\n        msg.foo.employees.should.have.property('lastName');\n        should.equal(msg.foo.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n ';\n      n1.receive({\n        foo: string,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid xml string to a javascript object with options","suites":["XML node"],"updatePoint":{"line":101,"column":75,"index":3396},"line":101,"code":"  it('should convert a valid xml string to a javascript object with options', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees.should.have.property('firstName');\n        should.equal(msg.payload.employees.firstName[0], 'John');\n        msg.payload.employees.should.have.property('lastName');\n        should.equal(msg.payload.employees.lastName[0], 'Smith');\n        done();\n      });\n      var string = '  <employees><firstName>John</firstName><lastName>Smith</lastName></employees>\\r\\n  ';\n      n1.receive({\n        payload: string,\n        topic: \"bar\",\n        options: {\n          trim: true\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to an xml string","suites":["XML node"],"updatePoint":{"line":133,"column":57,"index":4426},"line":133,"code":"  it('should convert a javascript object to an xml string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        var index = msg.payload.indexOf('<employees><firstName>John</firstName><lastName>Smith</lastName></employees>');\n        index.should.be.above(-1);\n        done();\n      });\n      var obj = {\n        \"employees\": {\n          \"firstName\": [\"John\"],\n          \"lastName\": [\"Smith\"]\n        }\n      };\n      n1.receive({\n        payload: obj,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to an xml string with options - alternative property","suites":["XML node"],"updatePoint":{"line":164,"column":93,"index":5296},"line":164,"code":"  it('should convert a javascript object to an xml string with options - alternative property', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      property: \"foo\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        var index = msg.foo.indexOf('<employees>\\n  <firstName>John</firstName>\\n  <lastName>Smith</lastName>\\n</employees>');\n        index.should.be.above(-1);\n        done();\n      });\n      var obj = {\n        \"employees\": {\n          \"firstName\": [\"John\"],\n          \"lastName\": [\"Smith\"]\n        }\n      };\n      n1.receive({\n        foo: obj,\n        topic: \"bar\",\n        options: {\n          headless: true\n        }\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid xml string","suites":["XML node"],"updatePoint":{"line":199,"column":65,"index":6218},"line":199,"code":"  it('should log an error if asked to parse an invalid xml string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.receive({\n        payload: '<not valid>',\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"xml\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.startWith(\"Error: Attribute without value\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 200);\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse something thats not xml or js","suites":["XML node"],"updatePoint":{"line":231,"column":73,"index":7132},"line":231,"code":"  it('should log an error if asked to parse something thats not xml or js', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.receive({\n        payload: 1,\n        topic: \"bar\"\n      });\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"xml\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg', \"xml.errors.xml_js\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 200);\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should just pass through if payload is missing","suites":["XML node"],"updatePoint":{"line":262,"column":52,"index":7941},"line":262,"code":"  it('should just pass through if payload is missing', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"xml\",\n      wires: [[\"n2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(xmlNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      n1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-XML_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["YAML node"],"updatePoint":{"line":30,"column":22,"index":1047},"line":30,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"yamlNode1\",\n      type: \"yaml\",\n      name: \"yamlNode\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yamlNode1 = helper.getNode(\"yamlNode1\");\n      yamlNode1.should.have.property('name', 'yamlNode');\n      done();\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid yaml string to a javascript object","suites":["YAML node"],"updatePoint":{"line":42,"column":63,"index":1406},"line":42,"code":"  it('should convert a valid yaml string to a javascript object', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.payload.should.have.property('employees');\n        msg.payload.employees[0].should.have.property('firstName', 'John');\n        msg.payload.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var yamlString = \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\";\n      yn1.receive({\n        payload: yamlString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a valid yaml string to a javascript object - using another property","suites":["YAML node"],"updatePoint":{"line":69,"column":88,"index":2296},"line":69,"code":"  it('should convert a valid yaml string to a javascript object - using another property', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      property: \"foo\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.foo.should.have.property('employees');\n        msg.foo.employees[0].should.have.property('firstName', 'John');\n        msg.foo.employees[0].should.have.property('lastName', 'Smith');\n        done();\n      });\n      var yamlString = \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\";\n      yn1.receive({\n        foo: yamlString,\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a yaml string","suites":["YAML node"],"updatePoint":{"line":97,"column":57,"index":3162},"line":97,"code":"  it('should convert a javascript object to a yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\");\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      yn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert a javascript object to a yaml string - using another property","suites":["YAML node"],"updatePoint":{"line":125,"column":82,"index":3889},"line":125,"code":"  it('should convert a javascript object to a yaml string - using another property', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      property: \"foo\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.foo, \"employees:\\n  - firstName: John\\n    lastName: Smith\\n\");\n        done();\n      });\n      var obj = {\n        employees: [{\n          firstName: \"John\",\n          lastName: \"Smith\"\n        }]\n      };\n      yn1.receive({\n        foo: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should convert an array to a yaml string","suites":["YAML node"],"updatePoint":{"line":154,"column":46,"index":4595},"line":154,"code":"  it('should convert an array to a yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        should.equal(msg.payload, \"- 1\\n- 2\\n- 3\\n\");\n        done();\n      });\n      var obj = [1, 2, 3];\n      yn1.receive({\n        payload: obj\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse an invalid yaml string","suites":["YAML node"],"updatePoint":{"line":177,"column":66,"index":5177},"line":177,"code":"  it('should log an error if asked to parse an invalid yaml string', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      try {\n        var yn1 = helper.getNode(\"yn1\");\n        var yn2 = helper.getNode(\"yn2\");\n        yn1.receive({\n          payload: 'employees:\\n-firstName: John\\n- lastName: Smith\\n',\n          topic: \"bar\"\n        });\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"yaml\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.should.startWith(\"end of the stream\");\n            logEvents[0][0].should.have.a.property('level', helper.log().ERROR);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should log an error if asked to parse something thats not yaml or js","suites":["YAML node"],"updatePoint":{"line":214,"column":74,"index":6296},"line":214,"code":"  it('should log an error if asked to parse something thats not yaml or js', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      setTimeout(function () {\n        try {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"yaml\";\n          });\n          logEvents.should.have.length(3);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.eql('yaml.errors.dropped');\n          logEvents[1][0].should.have.a.property('msg');\n          logEvents[1][0].msg.toString().should.eql('yaml.errors.dropped');\n          logEvents[2][0].should.have.a.property('msg');\n          logEvents[2][0].msg.toString().should.eql('yaml.errors.dropped-object');\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }, 150);\n      yn1.receive({\n        payload: true\n      });\n      yn1.receive({\n        payload: 1\n      });\n      yn1.receive({\n        payload: Buffer.from(\"a\")\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should pass straight through if no payload set","suites":["YAML node"],"updatePoint":{"line":255,"column":52,"index":7538},"line":255,"code":"  it('should pass straight through if no payload set', function (done) {\n    var flow = [{\n      id: \"yn1\",\n      type: \"yaml\",\n      wires: [[\"yn2\"]],\n      func: \"return msg;\"\n    }, {\n      id: \"yn2\",\n      type: \"helper\"\n    }];\n    helper.load(yamlNode, flow, function () {\n      var yn1 = helper.getNode(\"yn1\");\n      var yn2 = helper.getNode(\"yn2\");\n      yn2.on(\"input\", function (msg) {\n        msg.should.have.property('topic', 'bar');\n        msg.should.not.have.property('payload');\n        done();\n      });\n      yn1.receive({\n        topic: \"bar\"\n      });\n    });\n  });","file":"nodes/core/parsers/70-YAML_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["SPLIT node"],"updatePoint":{"line":34,"column":22,"index":1329},"line":34,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"splitNode1\",\n      type: \"split\",\n      name: \"splitNode\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var splitNode1 = helper.getNode(\"splitNode1\");\n      splitNode1.should.have.property('name', 'splitNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an array into multiple messages","suites":["SPLIT node"],"updatePoint":{"line":46,"column":50,"index":1683},"line":46,"code":"  it('should split an array into multiple messages', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"type\", \"array\");\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(2);\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(3);\n        }\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(4);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: [1, 2, 3, 4]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an array into multiple messages of a specified size","suites":["SPLIT node"],"updatePoint":{"line":82,"column":70,"index":2719},"line":82,"code":"  it('should split an array into multiple messages of a specified size', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      arraySplt: 3,\n      arraySpltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"type\", \"array\");\n        msg.parts.should.have.property(\"index\");\n        msg.payload.should.be.an.Array();\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(3);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: [1, 2, 3, 4]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an object into pieces","suites":["SPLIT node"],"updatePoint":{"line":115,"column":40,"index":3657},"line":115,"code":"  it('should split an object into pieces', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      var count = 0;\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\");\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"type\", \"object\");\n        msg.parts.should.have.property(\"key\");\n        msg.parts.should.have.property(\"count\");\n        msg.parts.should.have.property(\"index\");\n        msg.topic.should.equal(\"foo\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(true);\n          done();\n        }\n      });\n      sn1.receive({\n        topic: \"foo\",\n        payload: {\n          a: 1,\n          b: \"2\",\n          c: true\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split an object into pieces and overwrite their topics","suites":["SPLIT node"],"updatePoint":{"line":157,"column":67,"index":4832},"line":157,"code":"  it('should split an object into pieces and overwrite their topics', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      addname: \"topic\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      var count = 0;\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\");\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"type\", \"object\");\n        msg.parts.should.have.property(\"key\");\n        msg.parts.should.have.property(\"count\");\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(1);\n          msg.topic.should.equal(\"a\");\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n          msg.topic.should.equal(\"b\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(true);\n          msg.topic.should.equal(\"c\");\n          done();\n        }\n      });\n      sn1.receive({\n        topic: \"foo\",\n        payload: {\n          a: 1,\n          b: \"2\",\n          c: true\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string into new-lines","suites":["SPLIT node"],"updatePoint":{"line":202,"column":42,"index":6084},"line":202,"code":"  it('should split a string into new-lines', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"type\", \"string\");\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"Da\");\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"ve\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\" \");\n        }\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"CJ\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"Da\\nve\\n \\nCJ\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string on a specified char","suites":["SPLIT node"],"updatePoint":{"line":238,"column":47,"index":7112},"line":238,"code":"  it('should split a string on a specified char', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"\\n\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 3);\n        msg.parts.should.have.property(\"ch\", \"\\n\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"1\");\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"3\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"1\\n2\\n3\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string into lengths","suites":["SPLIT node"],"updatePoint":{"line":273,"column":40,"index":8106},"line":273,"code":"  it('should split a string into lengths', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"2\",\n      spltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 4);\n        msg.parts.should.have.property(\"ch\", \"\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"12\");\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"34\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"56\");\n        }\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"78\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"12345678\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a string on a specified char in stream mode","suites":["SPLIT node"],"updatePoint":{"line":312,"column":62,"index":9235},"line":312,"code":"  it('should split a string on a specified char in stream mode', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"\\n\",\n      stream: true\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"ch\", \"\\n\");\n        msg.parts.should.have.property(\"index\");\n        msg.parts.should.have.property(\"type\", \"string\");\n        if (msg.parts.index === 0) {\n          msg.payload.should.equal(\"1\");\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.should.equal(\"2\");\n        }\n        if (msg.parts.index === 2) {\n          msg.payload.should.equal(\"3\");\n        }\n        if (msg.parts.index === 3) {\n          msg.payload.should.equal(\"4\");\n        }\n        if (msg.parts.index === 4) {\n          msg.payload.should.equal(\"5\");\n        }\n        if (msg.parts.index === 5) {\n          msg.payload.should.equal(\"6\");\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"1\\n2\\n3\\n\"\n      });\n      sn1.receive({\n        payload: \"4\\n5\\n6\\n\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a buffer into lengths","suites":["SPLIT node"],"updatePoint":{"line":359,"column":40,"index":10522},"line":359,"code":"  it('should split a buffer into lengths', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"2\",\n      spltType: \"len\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          //console.log(msg);\n          msg.should.have.property(\"parts\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.parts.should.have.property(\"count\", 4);\n          msg.parts.should.have.property(\"index\");\n          msg.parts.should.have.property(\"type\", \"buffer\");\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"12\");\n          }\n          if (msg.parts.index === 1) {\n            msg.payload.toString().should.equal(\"34\");\n          }\n          if (msg.parts.index === 2) {\n            msg.payload.toString().should.equal(\"56\");\n          }\n          if (msg.parts.index === 3) {\n            msg.payload.toString().should.equal(\"78\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var b = Buffer.from(\"12345678\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should split a buffer on another buffer (streaming)","suites":["SPLIT node"],"updatePoint":{"line":404,"column":57,"index":11860},"line":404,"code":"  it('should split a buffer on another buffer (streaming)', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"[52]\",\n      spltType: \"bin\",\n      stream: true\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"parts\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.parts.should.have.property(\"index\");\n          msg.parts.should.have.property(\"type\", \"buffer\");\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"123\");\n          }\n          if (msg.parts.index === 1) {\n            msg.payload.toString().should.equal(\"123\");\n          }\n          if (msg.parts.index === 2) {\n            msg.payload.toString().should.equal(\"123\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      var b1 = Buffer.from(\"123412\");\n      var b2 = Buffer.from(\"341234\");\n      sn1.receive({\n        payload: b1\n      });\n      sn1.receive({\n        payload: b2\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid spltType (not an array)","suites":["SPLIT node"],"updatePoint":{"line":449,"column":51,"index":13116},"line":449,"code":"  it('should handle invalid spltType (not an array)', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"1\",\n      spltType: \"bin\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid splt length","suites":["SPLIT node"],"updatePoint":{"line":474,"column":39,"index":13728},"line":474,"code":"  it('should handle invalid splt length', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: 0,\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid array splt length","suites":["SPLIT node"],"updatePoint":{"line":499,"column":45,"index":14344},"line":499,"code":"  it('should handle invalid array splt length', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      arraySplt: 0,\n      arraySpltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      sn2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should ceil count value when msg.payload type is string","suites":["SPLIT node"],"updatePoint":{"line":524,"column":61,"index":14986},"line":524,"code":"  it('should ceil count value when msg.payload type is string', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle spltBufferString value of undefined","suites":["SPLIT node"],"updatePoint":{"line":555,"column":55,"index":15825},"line":555,"code":"  it('should handle spltBufferString value of undefined', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      wires: [[\"sn2\"]],\n      splt: \"[52]\",\n      spltType: \"bin\"\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"parts\");\n          msg.parts.should.have.property(\"index\");\n          if (msg.parts.index === 0) {\n            msg.payload.toString().should.equal(\"123\");\n            done();\n          }\n        } catch (err) {\n          done(err);\n        }\n      });\n      sn1.receive({\n        payload: \"123\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should ceil count value when msg.payload type is Buffer","suites":["SPLIT node"],"updatePoint":{"line":586,"column":61,"index":16617},"line":586,"code":"  it('should ceil count value when msg.payload type is Buffer', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"len\",\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      var b = Buffer.from(\"123\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should set msg.parts.ch when node.spltType is str","suites":["SPLIT node"],"updatePoint":{"line":618,"column":55,"index":17486},"line":618,"code":"  it('should set msg.parts.ch when node.spltType is str', function (done) {\n    var flow = [{\n      id: \"sn1\",\n      type: \"split\",\n      splt: \"2\",\n      spltType: \"str\",\n      stream: false,\n      wires: [[\"sn2\"]]\n    }, {\n      id: \"sn2\",\n      type: \"helper\"\n    }];\n    helper.load(splitNode, flow, function () {\n      var sn1 = helper.getNode(\"sn1\");\n      var sn2 = helper.getNode(\"sn2\");\n      sn2.on(\"input\", function (msg) {\n        msg.should.have.property(\"parts\");\n        msg.parts.should.have.property(\"count\", 2);\n        msg.parts.should.have.property(\"index\");\n        if (msg.parts.index === 0) {\n          msg.payload.length.should.equal(2);\n        }\n        if (msg.parts.index === 1) {\n          msg.payload.length.should.equal(1);\n          done();\n        }\n      });\n      var b = Buffer.from(\"123\");\n      sn1.receive({\n        payload: b\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["JOIN node"],"updatePoint":{"line":680,"column":22,"index":18966},"line":680,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"joinNode1\",\n      type: \"join\",\n      name: \"joinNode\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var joinNode1 = helper.getNode(\"joinNode1\");\n      joinNode1.should.have.property('name', 'joinNode');\n      joinNode1.should.have.property('count', 0);\n      joinNode1.should.have.property('timer', 0);\n      joinNode1.should.have.property('build', 'array');\n      done();\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of string back together automatically","suites":["JOIN node"],"updatePoint":{"line":695,"column":60,"index":19478},"line":695,"code":"  it('should join bits of string back together automatically', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"A,B,C,D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of string back together automatically with a buffer joiner","suites":["JOIN node"],"updatePoint":{"line":761,"column":81,"index":20847},"line":761,"code":"  it('should join bits of string back together automatically with a buffer joiner', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"A,B,C,D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join bits of buffer back together automatically","suites":["JOIN node"],"updatePoint":{"line":828,"column":60,"index":22223},"line":828,"code":"  it('should join bits of buffer back together automatically', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.toString().should.equal(\"A-B-C-D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 0,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 1,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 2,\n          count: 4\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"D\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          ch: Buffer.from(\"-\"),\n          index: 3,\n          count: 4\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array after a count","suites":["JOIN node"],"updatePoint":{"line":895,"column":52,"index":23735},"line":895,"code":"  it('should join things into an array after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true);\n          //msg.payload[2].a.should.equal(1);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      });\n      n1.receive({\n        payload: true\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array ignoring msg.parts.index in manual mode","suites":["JOIN node"],"updatePoint":{"line":935,"column":78,"index":24682},"line":935,"code":"  it('should join things into an array ignoring msg.parts.index in manual mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true);\n          //msg.payload[2].a.should.equal(1);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 3\n        }\n      });\n      n1.receive({\n        payload: true,\n        parts: {\n          index: 0\n        }\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        parts: {\n          index: 9\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an array after a count with a buffer join set","suites":["JOIN node"],"updatePoint":{"line":984,"column":75,"index":25767},"line":984,"code":"  it('should join things into an array after a count with a buffer join set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 3,\n      joinerType: \"bin\",\n      joiner: \"\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(true);\n          //msg.payload[2].a.should.equal(1);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1\n      });\n      n1.receive({\n        payload: true\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings into a buffer after a count","suites":["JOIN node"],"updatePoint":{"line":1025,"column":53,"index":26713},"line":1025,"code":"  it('should join strings into a buffer after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 2,\n      build: \"buffer\",\n      joinerType: \"bin\",\n      joiner: \"\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.length.should.equal(10);\n          msg.payload.toString().should.equal(\"helloworld\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"hello\"\n      });\n      n1.receive({\n        payload: \"world\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join things into an object after a count","suites":["JOIN node"],"updatePoint":{"line":1060,"column":53,"index":27549},"line":1060,"code":"  it('should join things into an object after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 5,\n      build: \"object\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", \"2\");\n          msg.payload.should.have.property(\"c\", true);\n          msg.payload.should.have.property(\"d\");\n          msg.payload.d.should.have.property(\"e\", 7);\n          // msg.payload.should.have.property(\"g\");\n          // msg.payload.g.should.have.property(\"f\",6);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: \"2\",\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: true,\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          e: 5\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          e: 7\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          f: 6\n        },\n        topic: \"g\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should merge objects","suites":["JOIN node"],"updatePoint":{"line":1122,"column":26,"index":28959},"line":1122,"code":"  it('should merge objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 5,\n      build: \"merged\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          msg.payload.should.have.property(\"e\", 5);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: {\n          a: 9\n        },\n        topic: \"f\"\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 9\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          d: 4\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          e: 5\n        },\n        topic: \"e\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should merge full msg objects","suites":["JOIN node"],"updatePoint":{"line":1194,"column":35,"index":30429},"line":1194,"code":"  it('should merge full msg objects', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      count: 6,\n      build: \"merged\",\n      mode: \"custom\",\n      propertyType: \"full\",\n      property: \"\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.have.property(\"payload\", 7);\n          msg.payload.should.have.property(\"aha\", 'c');\n          msg.payload.should.have.property(\"bar\", 'b');\n          msg.payload.should.have.property(\"bingo\", 'e');\n          msg.payload.should.have.property(\"foo\", 'd');\n          msg.payload.should.have.property(\"topic\", 'a');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"f\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 4,\n        bar: \"b\"\n      });\n      n1.receive({\n        payload: 5,\n        aha: \"c\"\n      });\n      n1.receive({\n        payload: 6,\n        foo: \"d\"\n      });\n      n1.receive({\n        payload: 7,\n        bingo: \"e\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should accumulate a merged object","suites":["JOIN node"],"updatePoint":{"line":1254,"column":39,"index":31803},"line":1254,"code":"  it('should accumulate a merged object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"merged\",\n      mode: \"custom\",\n      accumulate: true,\n      count: 3\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 3) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"a\", 3);\n            msg.payload.should.have.property(\"b\", 2);\n            msg.payload.should.have.property(\"c\", 1);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        }\n        c += 1;\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          a: 3\n        },\n        topic: \"d\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"e\"\n      });\n      n1.receive({\n        payload: {\n          c: 1\n        },\n        topic: \"f\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be able to reset an accumulation","suites":["JOIN node"],"updatePoint":{"line":1323,"column":45,"index":33194},"line":1323,"code":"  it('should be able to reset an accumulation', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"merged\",\n      accumulate: true,\n      mode: \"custom\",\n      count: 3\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        if (c === 1) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"a\", 1);\n            msg.payload.should.have.property(\"b\", 2);\n            msg.payload.should.have.property(\"c\", 3);\n            msg.payload.should.have.property(\"d\", 4);\n          } catch (e) {\n            done(e);\n          }\n        }\n        if (c === 2) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"e\", 2);\n            msg.payload.should.have.property(\"f\", 1);\n          } catch (e) {\n            done(e);\n          }\n        }\n        if (c === 3) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.have.property(\"g\", 2);\n            msg.payload.should.have.property(\"h\", 1);\n            msg.payload.should.have.property(\"i\", 3);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        }\n        c += 1;\n      });\n      n1.receive({\n        payload: {\n          a: 1\n        },\n        topic: \"a\"\n      });\n      n1.receive({\n        payload: {\n          b: 2\n        },\n        topic: \"b\"\n      });\n      n1.receive({\n        payload: {\n          c: 3\n        },\n        topic: \"c\"\n      });\n      n1.receive({\n        payload: {\n          d: 4\n        },\n        topic: \"d\",\n        complete: true\n      });\n      n1.receive({\n        payload: {\n          e: 2\n        },\n        topic: \"e\"\n      });\n      n1.receive({\n        payload: {\n          f: 1\n        },\n        topic: \"f\",\n        complete: true\n      });\n      n1.receive({\n        payload: {\n          g: 2\n        },\n        topic: \"g\"\n      });\n      n1.receive({\n        payload: {\n          h: 1\n        },\n        topic: \"h\"\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: {\n          g: 2\n        },\n        topic: \"g\"\n      });\n      n1.receive({\n        payload: {\n          h: 1\n        },\n        topic: \"h\"\n      });\n      n1.receive({\n        payload: {\n          i: 3\n        },\n        topic: \"i\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should accumulate a key/value object","suites":["JOIN node"],"updatePoint":{"line":1447,"column":42,"index":35778},"line":1447,"code":"  it('should accumulate a key/value object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"object\",\n      accumulate: true,\n      mode: \"custom\",\n      topic: \"bar\",\n      key: \"foo\",\n      count: 4\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var c = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          //msg.should.have.property(\"topic\",\"bar\");\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 2,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"c\"\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: 1,\n        foo: \"a\"\n      });\n      n1.receive({\n        payload: 2,\n        foo: \"b\"\n      });\n      n1.receive({\n        payload: 3,\n        foo: \"c\"\n      });\n      n1.receive({\n        payload: 4,\n        foo: \"d\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings with a specifed character after a timeout","suites":["JOIN node"],"updatePoint":{"line":1508,"column":67,"index":37154},"line":1508,"code":"  it('should join strings with a specifed character after a timeout', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 0.05,\n      count: \"\",\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"a,b,c\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\"\n      });\n      n1.receive({\n        payload: \"b\"\n      });\n      n1.receive({\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should allow the timeout to be restarted","suites":["JOIN node"],"updatePoint":{"line":1545,"column":46,"index":37960},"line":1545,"code":"  it('should allow the timeout to be restarted', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 0.5,\n      count: \"\",\n      joiner: \",\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"a,b,c\");\n          const timeTaken = (Date.now() - start) / 1000;\n          // Node times out after 0.5s.\n          // It receives a restartTimeout after 0.4s.\n          // So time taken to timeout should be approx 0.9\n          timeTaken.should.be.approximately(0.9, 0.15);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      var start = Date.now();\n      n1.receive({\n        payload: \"a\"\n      });\n      setTimeout(function () {\n        n1.receive({\n          payload: \"b\",\n          restartTimeout: true\n        });\n        n1.receive({\n          payload: \"c\"\n        });\n      }, 400);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join strings with a specifed character and complete when told to","suites":["JOIN node"],"updatePoint":{"line":1591,"column":77,"index":39182},"line":1591,"code":"  it('should join strings with a specifed character and complete when told to', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"string\",\n      timeout: 5,\n      count: 0,\n      joiner: \"\\n\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(\"Hello\\nNodeRED\\nWorld\\n\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"Hello\"\n      });\n      n1.receive({\n        payload: \"NodeRED\"\n      });\n      n1.receive({\n        payload: \"World\"\n      });\n      n1.receive({\n        payload: '',\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join complete message objects into an array after a count","suites":["JOIN node"],"updatePoint":{"line":1632,"column":70,"index":40114},"line":1632,"code":"  it('should join complete message objects into an array after a count', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"array\",\n      timeout: 0,\n      count: 3,\n      propertyType: \"full\",\n      mode: \"custom\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.be.an.Object();\n          msg.payload[0].should.have.property(\"payload\", \"a\");\n          msg.payload[1].should.be.an.Object();\n          msg.payload[1].should.have.property(\"payload\", \"b\");\n          msg.payload[2].should.be.an.Object();\n          msg.payload[2].should.have.property(\"payload\", \"c\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\"\n      });\n      n1.receive({\n        payload: \"b\"\n      });\n      n1.receive({\n        payload: \"c\"\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things back into an array","suites":["JOIN node"],"updatePoint":{"line":1674,"column":49,"index":41212},"line":1674,"code":"  it('should join split things back into an array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          msg.payload[3].should.equal(4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 111\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 111\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things back into an object","suites":["JOIN node"],"updatePoint":{"line":1733,"column":50,"index":42473},"line":1733,"code":"  it('should join split things back into an object', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.have.property(\"a\", 1);\n          msg.payload.should.have.property(\"b\", 2);\n          msg.payload.should.have.property(\"c\", 3);\n          msg.payload.should.have.property(\"d\", 4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222,\n          key: \"c\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222,\n          key: \"b\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222,\n          key: \"d\",\n          type: \"object\"\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222,\n          key: \"a\",\n          type: \"object\"\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split things, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1799,"column":55,"index":43919},"line":1799,"code":"  it('should join split things, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 0.250\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          (msg.payload[0] === undefined).should.be.true();\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          msg.payload[3].should.equal(4);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 444\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 444\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 444\n        },\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should manually join things into an array, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1852,"column":72,"index":45131},"line":1852,"code":"  it('should manually join things into an array, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 1,\n      mode: \"custom\",\n      build: \"array\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload.length.should.equal(3);\n          msg.payload[0].should.equal(1);\n          msg.payload[1].should.equal(2);\n          msg.payload[2].should.equal(3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.receive({\n        payload: 3,\n        topic: \"C\"\n      });\n      n1.receive({\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should manually join things into an object, send when told complete","suites":["JOIN node"],"updatePoint":{"line":1897,"column":73,"index":46201},"line":1897,"code":"  it('should manually join things into an object, send when told complete', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      timeout: 1,\n      mode: \"custom\",\n      build: \"object\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Object();\n          Object.keys(msg.payload).length.should.equal(3);\n          msg.payload.A.should.equal(1);\n          msg.payload.B.should.equal(2);\n          msg.payload.C.should.equal(3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        topic: \"A\"\n      });\n      n1.receive({\n        payload: 2,\n        topic: \"B\"\n      });\n      n1.receive({\n        payload: 3,\n        topic: \"C\"\n      });\n      n1.receive({\n        complete: true\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should join split strings back into a word","suites":["JOIN node"],"updatePoint":{"line":1942,"column":48,"index":47258},"line":1942,"code":"  it('should join split strings back into a word', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"abcd\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"a\",\n        parts: {\n          type: 'string',\n          index: 0,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"d\",\n        parts: {\n          type: 'string',\n          index: 3,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"c\",\n        parts: {\n          type: 'string',\n          index: 2,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n      n1.receive({\n        payload: \"b\",\n        parts: {\n          type: 'string',\n          index: 1,\n          count: 4,\n          ch: \"\",\n          id: 555\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should allow chained split-split-join-join sequences","suites":["JOIN node"],"updatePoint":{"line":2007,"column":58,"index":48608},"line":2007,"code":"  it('should allow chained split-split-join-join sequences', function (done) {\n    var flow = [{\n      id: \"s1\",\n      type: \"split\",\n      wires: [[\"s2\"]]\n    }, {\n      id: \"s2\",\n      type: \"split\",\n      wires: [[\"j1\"]]\n    }, {\n      id: \"j1\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"j2\"]]\n    }, {\n      id: \"j2\",\n      type: \"join\",\n      mode: \"auto\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var s1 = helper.getNode(\"s1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.eql([[1, 2, 3], \"a\\nb\\nc\", [7, 8, 9]]);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      s1.receive({\n        payload: [[1, 2, 3], \"a\\nb\\nc\", [7, 8, 9]]\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages","suites":["JOIN node"],"updatePoint":{"line":2047,"column":28,"index":49491},"line":2047,"code":"  it('should reduce messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(10);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages - count only in last part","suites":["JOIN node"],"updatePoint":{"line":2109,"column":54,"index":50766},"line":2109,"code":"  it('should reduce messages - count only in last part', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(10);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (str)","suites":["JOIN node"],"updatePoint":{"line":2243,"column":50,"index":53714},"line":2243,"code":"  it('should reduce messages with init types (str)', function (done) {\n    checkInitTypesSimple('str', \"xyz\", done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (num)","suites":["JOIN node"],"updatePoint":{"line":2246,"column":50,"index":53837},"line":2246,"code":"  it('should reduce messages with init types (num)', function (done) {\n    checkInitTypesSimple('num', 10, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (bool)","suites":["JOIN node"],"updatePoint":{"line":2249,"column":51,"index":53958},"line":2249,"code":"  it('should reduce messages with init types (bool)', function (done) {\n    checkInitTypesSimple('bool', true, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (json)","suites":["JOIN node"],"updatePoint":{"line":2252,"column":51,"index":54082},"line":2252,"code":"  it('should reduce messages with init types (json)', function (done) {\n    var ival = '{\"x\":\"vx\", \"y\":\"vy\", \"z\":\"vz\"}';\n    var rval = JSON.parse(ival);\n    checkInitTypesComplex('json', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (bin)","suites":["JOIN node"],"updatePoint":{"line":2257,"column":50,"index":54294},"line":2257,"code":"  it('should reduce messages with init types (bin)', function (done) {\n    var ival = \"[1,2,3]\";\n    var rval = Buffer.from(JSON.parse(ival));\n    checkInitTypesComplex('bin', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (JSONata)","suites":["JOIN node"],"updatePoint":{"line":2262,"column":54,"index":54499},"line":2262,"code":"  it('should reduce messages with init types (JSONata)', function (done) {\n    var ival = \"1+2+3\";\n    var rval = 6;\n    checkInitTypesComplex('jsonata', ival, rval, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (env)","suites":["JOIN node"],"updatePoint":{"line":2267,"column":50,"index":54674},"line":2267,"code":"  it('should reduce messages with init types (env)', function (done) {\n    function init(node, cb) {\n      process.env.NR_XYZ = \"nr_xyz\";\n      cb();\n    }\n    function fin(err) {\n      delete process.env.NR_XYZ;\n      done(err);\n    }\n    checkInitTypes('env', \"NR_XYZ\", \"nr_xyz\", init, should.equal, fin);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (flow.name)","suites":["JOIN node"],"updatePoint":{"line":2278,"column":56,"index":54994},"line":2278,"code":"  it('should reduce messages with init types (flow.name)', function (done) {\n    function init(node, cb) {\n      var context = node.context();\n      context.flow.set(\"foo\", \"bar\");\n      cb();\n    }\n    checkInitTypes('flow', \"foo\", \"bar\", init, should.equal, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with init types (global.name)","suites":["JOIN node"],"updatePoint":{"line":2286,"column":58,"index":55269},"line":2286,"code":"  it('should reduce messages with init types (global.name)', function (done) {\n    function init(node, cb) {\n      var context = node.context();\n      context.global.set(\"foo\", \"bar\");\n      cb();\n    }\n    checkInitTypes('global', \"foo\", \"bar\", init, should.equal, done);\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages using $I","suites":["JOIN node"],"updatePoint":{"line":2294,"column":37,"index":55527},"line":2294,"code":"  it('should reduce messages using $I', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+$I\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(6);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with fixup","suites":["JOIN node"],"updatePoint":{"line":2356,"column":39,"index":56781},"line":2356,"code":"  it('should reduce messages with fixup', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"$A/$N\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal(2);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 5,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 0,\n        parts: {\n          index: 4,\n          count: 5,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages (left)","suites":["JOIN node"],"updatePoint":{"line":2426,"column":35,"index":58168},"line":2426,"code":"  it('should reduce messages (left)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"'(' & $A & '+' & payload & ')'\",\n      reduceInit: \"0\",\n      reduceInitType: \"str\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"((((0+1)+2)+3)+4)\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: '3',\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '2',\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '4',\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '1',\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages (right)","suites":["JOIN node"],"updatePoint":{"line":2489,"column":36,"index":59515},"line":2489,"code":"  it('should reduce messages (right)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: true,\n      reduceExp: \"'(' & $A & '+' & payload & ')'\",\n      reduceInit: \"0\",\n      reduceInitType: \"str\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.String();\n          msg.payload.should.equal(\"((((0+4)+3)+2)+1)\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: '3',\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '2',\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '4',\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: '1',\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with array result","suites":["JOIN node"],"updatePoint":{"line":2552,"column":46,"index":60871},"line":2552,"code":"  it('should reduce messages with array result', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$append($A,[payload])\",\n      reduceInit: \"[]\",\n      reduceInitType: \"json\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          var payload = msg.payload;\n          payload.length.should.equal(2);\n          if (count == 0) {\n            payload[0].should.equal(1);\n            payload[1].should.equal(2);\n          } else if (count == 1) {\n            payload[0].should.equal(3);\n            payload[1].should.equal(4);\n            done();\n          }\n          count++;\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 2,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 2,\n          id: 333\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 2,\n          id: 333\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages for reduce mode","suites":["JOIN node"],"updatePoint":{"line":2624,"column":61,"index":62505},"line":2624,"code":"  it('should handle too many pending messages for reduce mode', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+payload\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"join\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"join\");\n        evt.should.have.property('msg', \"join.too-many\");\n        done();\n      }, TimeoutForErrorCase);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with flow context","suites":["JOIN node"],"updatePoint":{"line":2686,"column":46,"index":63932},"line":2686,"code":"  it('should reduce messages with flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload*$flowContext(\\\"two\\\"))\",\n      reduceInit: \"$flowContext(\\\"one\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$flowContext(\\\"three\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal((1 + 1 * 2 + 2 * 2 + 3 * 2 + 4 * 2) * 3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.context().flow.set(\"one\", 1);\n      n1.context().flow.set(\"two\", 2);\n      n1.context().flow.set(\"three\", 3);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with global context","suites":["JOIN node"],"updatePoint":{"line":2756,"column":48,"index":65503},"line":2756,"code":"  it('should reduce messages with global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload/$globalContext(\\\"two\\\"))\",\n      reduceInit: \"$globalContext(\\\"one\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$globalContext(\\\"three\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.equal((1 + 1 / 2 + 2 / 2 + 3 / 2 + 4 / 2) * 3);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.context().global.set(\"one\", 1);\n      n1.context().global.set(\"two\", 2);\n      n1.context().global.set(\"three\", 3);\n      n1.receive({\n        payload: 3,\n        parts: {\n          index: 2,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 2,\n        parts: {\n          index: 1,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 4,\n        parts: {\n          index: 3,\n          count: 4,\n          id: 222\n        }\n      });\n      n1.receive({\n        payload: 1,\n        parts: {\n          index: 0,\n          count: 4,\n          id: 222\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with persistable flow context","suites":["JOIN node"],"updatePoint":{"line":2826,"column":58,"index":67096},"line":2826,"code":"  it('should reduce messages with persistable flow context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload*$flowContext(\\\"two\\\",\\\"memory\\\"))\",\n      reduceInit: \"$flowContext(\\\"one\\\",\\\"memory\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$flowContext(\\\"three\\\",\\\"memory\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        try {\n          n2.on(\"input\", function (msg) {\n            try {\n              msg.should.have.property(\"payload\");\n              msg.payload.should.equal((1 + 1 * 2 + 2 * 2 + 3 * 2 + 4 * 2) * 3);\n              done();\n            } catch (e) {\n              done(e);\n            }\n          });\n          n1.context().flow.set([\"one\", \"two\", \"three\"], [1, 2, 3], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              n1.receive({\n                payload: 3,\n                parts: {\n                  index: 2,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 2,\n                parts: {\n                  index: 1,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 4,\n                parts: {\n                  index: 3,\n                  count: 4,\n                  id: 222\n                }\n              });\n              n1.receive({\n                payload: 1,\n                parts: {\n                  index: 0,\n                  count: 4,\n                  id: 222\n                }\n              });\n            }\n          });\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should reduce messages with persistable global context","suites":["JOIN node"],"updatePoint":{"line":2904,"column":60,"index":69171},"line":2904,"code":"  it('should reduce messages with persistable global context', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A+(payload/$globalContext(\\\"two\\\",\\\"memory\\\"))\",\n      reduceInit: \"$globalContext(\\\"one\\\",\\\"memory\\\")\",\n      reduceInitType: \"jsonata\",\n      reduceFixup: \"$A*$globalContext(\\\"three\\\",\\\"memory\\\")\",\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    helper.load(joinNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            msg.payload.should.equal((1 + 1 / 2 + 2 / 2 + 3 / 2 + 4 / 2) * 3);\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.context().global.set([\"one\", \"two\", \"three\"], [1, 2, 3], \"memory\", function (err) {\n          if (err) {\n            done(err);\n          } else {\n            n1.receive({\n              payload: 3,\n              parts: {\n                index: 2,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 2,\n              parts: {\n                index: 1,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 4,\n              parts: {\n                index: 3,\n                count: 4,\n                id: 222\n              }\n            });\n            n1.receive({\n              payload: 1,\n              parts: {\n                index: 0,\n                count: 4,\n                id: 222\n              }\n            });\n          }\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata reduce expression - syntax error\"","suites":["JOIN node"],"updatePoint":{"line":2978,"column":69,"index":71100},"line":2978,"code":"  it('should handle invalid JSONata reduce expression - syntax error\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"invalid expr\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata reduce expression - runtime error\"","suites":["JOIN node"],"updatePoint":{"line":3014,"column":70,"index":71982},"line":3014,"code":"  it('should handle invalid JSONata reduce expression - runtime error\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$uknown()\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: undefined,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata fixup expression - syntax err\"","suites":["JOIN node"],"updatePoint":{"line":3050,"column":66,"index":72857},"line":3050,"code":"  it('should handle invalid JSONata fixup expression - syntax err\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"invalid expr\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle invalid JSONata fixup expression - runtime err\"","suites":["JOIN node"],"updatePoint":{"line":3086,"column":67,"index":73731},"line":3086,"code":"  it('should handle invalid JSONata fixup expression - runtime err\"', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      mode: \"reduce\",\n      reduceRight: false,\n      reduceExp: \"$A\",\n      reduceInit: \"0\",\n      reduceInitType: \"num\",\n      reduceFixup: \"$unknown()\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 1\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is array","suites":["JOIN node"],"updatePoint":{"line":3122,"column":52,"index":74588},"line":3122,"code":"  it('should concat payload when group.type is array', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.should.be.an.Array();\n          msg.payload[0].should.equal(\"ab\");\n          msg.payload[1].should.equal(\"cd\");\n          msg.payload[2].should.equal(\"ef\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"ab\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 3,\n          len: 2\n        }\n      });\n      n1.receive({\n        payload: \"cd\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 3,\n          len: 2\n        }\n      });\n      n1.receive({\n        payload: \"ef\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 2,\n          count: 3,\n          len: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is buffer and group.joinChar is undefined","suites":["JOIN node"],"updatePoint":{"line":3183,"column":85,"index":75948},"line":3183,"code":"  it('should concat payload when group.type is buffer and group.joinChar is undefined', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.toString().should.equal(\"ABC\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 0,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 1,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"buffer\",\n          index: 2,\n          count: 3\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should concat payload when group.type is string and group.joinChar is not string","suites":["JOIN node"],"updatePoint":{"line":3237,"column":86,"index":77189},"line":3237,"code":"  it('should concat payload when group.type is string and group.joinChar is not string', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \",\",\n      build: \"buffer\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload.toString().should.equal(\"A0B0C\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"A\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 0,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"B\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 1,\n          count: 3\n        }\n      });\n      n1.receive({\n        payload: Buffer.from(\"C\"),\n        parts: {\n          id: 1,\n          type: \"string\",\n          ch: Buffer.from(\"0\"),\n          index: 2,\n          count: 3\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle msg.parts property when mode is auto and parts or id are missing","suites":["JOIN node"],"updatePoint":{"line":3293,"column":84,"index":78469},"line":3293,"code":"  it('should handle msg.parts property when mode is auto and parts or id are missing', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"string\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        done(new Error(\"This path does not go through.\"));\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          type: \"string\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          type: \"string\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n      setTimeout(function () {\n        done();\n      }, TimeoutForErrorCase);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle join an array when mode is auto and duplicate indexed parts arrive","suites":["JOIN node"],"updatePoint":{"line":3335,"column":86,"index":79439},"line":3335,"code":"  it('should handle join an array when mode is auto and duplicate indexed parts arrive', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload[0].should.equal(\"C\");\n          msg.payload[1].should.equal(\"D\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle join an array when using msg.parts and duplicate indexed parts arrive and being reset halfway","suites":["JOIN node"],"updatePoint":{"line":3403,"column":113,"index":80904},"line":3403,"code":"  it('should handle join an array when using msg.parts and duplicate indexed parts arrive and being reset halfway', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      joiner: \"[44]\",\n      joinerType: \"bin\",\n      build: \"array\",\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.payload[0].should.equal(\"D\");\n          msg.payload[1].should.equal(\"C\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"A\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"B\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n      n1.receive({\n        reset: true\n      });\n      n1.receive({\n        payload: \"C\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 1,\n          count: 2\n        }\n      });\n      n1.receive({\n        payload: \"D\",\n        parts: {\n          id: 1,\n          type: \"array\",\n          ch: \",\",\n          index: 0,\n          count: 2\n        }\n      });\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (string)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3524,"column":56,"index":84064},"line":3524,"code":"    it('should call done() when message is sent (string)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: \"12345\"\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (array)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3535,"column":55,"index":84337},"line":3535,"code":"    it('should call done() when message is sent (array)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: [0, 1, 2, 3, 4]\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (object)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3546,"column":56,"index":84619},"line":3546,"code":"    it('should call done() when message is sent (object)', function (done) {\n      mapiDoneSplitTestHelper(done, 2, \"len\", false, [{\n        msg: {\n          seq: 0,\n          payload: {\n            a: 1,\n            b: 2\n          }\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (string, len)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3560,"column":77,"index":84955},"line":3560,"code":"    it('should call done() when consolidated message is emitted (string, len)', function (done) {\n      mapiDoneSplitTestHelper(done, 5, \"len\", true, [{\n        msg: {\n          seq: 0,\n          payload: \"12\"\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"34\"\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"5\"\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, len)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3587,"column":77,"index":85515},"line":3587,"code":"    it('should call done() when consolidated message is emitted (Buffer, len)', function (done) {\n      mapiDoneSplitTestHelper(done, 5, \"len\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, str)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3614,"column":77,"index":86114},"line":3614,"code":"    it('should call done() when consolidated message is emitted (Buffer, str)', function (done) {\n      mapiDoneSplitTestHelper(done, \"5\", \"str\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when consolidated message is emitted (Buffer, bin)","suites":["JOIN node","messaging API"],"updatePoint":{"line":3641,"column":77,"index":86715},"line":3641,"code":"    it('should call done() when consolidated message is emitted (Buffer, bin)', function (done) {\n      mapiDoneSplitTestHelper(done, \"[53]\", \"bin\", true, [{\n        msg: {\n          seq: 0,\n          payload: Buffer.from(\"12\")\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: Buffer.from(\"34\")\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: Buffer.from(\"5\")\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when all messages are joined","suites":["JOIN node","messaging API"],"updatePoint":{"line":3715,"column":55,"index":88922},"line":3715,"code":"    it('should call done() when all messages are joined', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"auto\",\n        timeout: 1\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"C\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when the node is reset","suites":["JOIN node","messaging API"],"updatePoint":{"line":3766,"column":49,"index":89916},"line":3766,"code":"    it('should call done() when the node is reset', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"auto\",\n        timeout: 1\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\",\n          parts: {\n            id: 1,\n            type: \"string\",\n            ch: \",\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: \"dummy\",\n          reset: true,\n          parts: {\n            id: 1\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when timed out","suites":["JOIN node","messaging API"],"updatePoint":{"line":3814,"column":41,"index":90836},"line":3814,"code":"    it('should call done() when timed out', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"custom\",\n        joiner: \",\",\n        build: \"string\",\n        timeout: 0.5\n      }, [{\n        msg: {\n          seq: 0,\n          payload: \"A\"\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: \"B\"\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when all messages are reduced","suites":["JOIN node","messaging API"],"updatePoint":{"line":3838,"column":56,"index":91325},"line":3838,"code":"    it('should call done() when all messages are reduced', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"reduce\",\n        reduceRight: false,\n        reduceExp: \"$A+payload\",\n        reduceInit: \"0\",\n        reduceInitType: \"num\",\n        reduceFixup: undefined\n      }, [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            index: 2,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            index: 1,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 200,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 4,\n          parts: {\n            index: 0,\n            count: 3,\n            id: 222\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow","suites":["JOIN node","messaging API"],"updatePoint":{"line":3887,"column":56,"index":92310},"line":3887,"code":"    it('should call done() regardless of buffer overflow', function (done) {\n      mapiDoneJoinTestHelper(done, {\n        mode: \"reduce\",\n        reduceRight: false,\n        reduceExp: \"$A+payload\",\n        reduceInit: \"0\",\n        reduceInitType: \"num\",\n        reduceFixup: undefined\n      }, [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            index: 2,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 0,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            index: 1,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 200,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 4,\n          parts: {\n            index: 0,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 400,\n        avr: 600,\n        var: 100\n      }, {\n        msg: {\n          seq: 3,\n          payload: 1,\n          parts: {\n            index: 3,\n            count: 5,\n            id: 222\n          }\n        },\n        delay: 600,\n        avr: 600,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should handle msg.parts even if messages are out of order in auto mode if exactly one message has count set","suites":["JOIN node","messaging API"],"updatePoint":{"line":3950,"column":113,"index":93585},"line":3950,"code":"  it('should handle msg.parts even if messages are out of order in auto mode if exactly one message has count set', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"join\",\n      wires: [[\"n2\"]],\n      mode: \"auto\"\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(joinNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.payload.length.should.be.eql(5);\n        msg.payload.should.be.eql([0, 1, 2, 3, 4]);\n        done();\n      });\n      var msg = {};\n      msg.parts = {\n        id: RED.util.generateId()\n      };\n      for (var elem = 1; elem < 5; ++elem) {\n        var _msg = RED.util.cloneMessage(msg);\n        _msg.parts.index = elem;\n        if (elem == 4) {\n          _msg.parts.count = 5;\n        }\n        _msg.payload = elem;\n        n1.receive(_msg);\n      }\n      var _msg = RED.util.cloneMessage(msg);\n      delete _msg.parts.count;\n      _msg.parts.index = 0;\n      _msg.payload = 0;\n      n1.receive(_msg);\n    });\n  });","file":"nodes/core/sequence/17-split_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["SORT node"],"updatePoint":{"line":44,"column":22,"index":1466},"line":44,"code":"  it('should be loaded', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      name: \"SortNode\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'SortNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":188,"column":57,"index":5667},"line":188,"code":"    it('should sort payload (elem, not number, ascending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":191,"column":58,"index":5805},"line":191,"code":"    it('should sort msg prop (elem, not number, ascending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (not number, ascending)","suites":["SORT node"],"updatePoint":{"line":194,"column":65,"index":5950},"line":194,"code":"    it('should sort message group/payload (not number, ascending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (not number, ascending)","suites":["SORT node"],"updatePoint":{"line":197,"column":62,"index":6092},"line":197,"code":"    it('should sort message group/prop (not number, ascending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, not number, descending)","suites":["SORT node"],"updatePoint":{"line":214,"column":58,"index":6526},"line":214,"code":"    it('should sort payload (elem, not number, descending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, not number, descending)","suites":["SORT node"],"updatePoint":{"line":217,"column":59,"index":6665},"line":217,"code":"    it('should sort msg prop (elem, not number, descending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (not number, descending)","suites":["SORT node"],"updatePoint":{"line":220,"column":66,"index":6811},"line":220,"code":"    it('should sort message group/payload (not number, descending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (not number, descending)","suites":["SORT node"],"updatePoint":{"line":223,"column":63,"index":6954},"line":223,"code":"    it('should sort message group/prop (not number, descending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, number, ascending)","suites":["SORT node"],"updatePoint":{"line":240,"column":53,"index":7381},"line":240,"code":"    it('should sort payload (elem, number, ascending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, number, ascending)","suites":["SORT node"],"updatePoint":{"line":243,"column":54,"index":7515},"line":243,"code":"    it('should sort msg prop (elem, number, ascending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (number, ascending)","suites":["SORT node"],"updatePoint":{"line":246,"column":61,"index":7656},"line":246,"code":"    it('should sort message group/payload (number, ascending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (number, ascending)","suites":["SORT node"],"updatePoint":{"line":249,"column":58,"index":7794},"line":249,"code":"    it('should sort message group/prop (number, ascending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (elem, number, descending)","suites":["SORT node"],"updatePoint":{"line":266,"column":54,"index":8223},"line":266,"code":"    it('should sort payload (elem, number, descending)', function (done) {\n      check_sort0A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort msg prop (elem, number, descending)","suites":["SORT node"],"updatePoint":{"line":269,"column":55,"index":8358},"line":269,"code":"    it('should sort msg prop (elem, number, descending)', function (done) {\n      check_sort0B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/payload (number, descending)","suites":["SORT node"],"updatePoint":{"line":272,"column":62,"index":8500},"line":272,"code":"    it('should sort message group/payload (number, descending)', function (done) {\n      check_sort1A(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group/prop (number, descending)","suites":["SORT node"],"updatePoint":{"line":275,"column":59,"index":8639},"line":275,"code":"    it('should sort message group/prop (number, descending)', function (done) {\n      check_sort1B(flow, data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":292,"column":56,"index":9078},"line":292,"code":"    it('should sort payload (exp, not number, ascending)', function (done) {\n      check_sort0C(flow, \"$substring($,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":295,"column":62,"index":9239},"line":295,"code":"    it('should sort message group (exp, not number, ascending)', function (done) {\n      check_sort1C(flow, \"$substring(payload,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":312,"column":63,"index":9711},"line":312,"code":"    it('should sort message group (exp, not number, descending)', function (done) {\n      check_sort0C(flow, \"$substring($,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":315,"column":57,"index":9867},"line":315,"code":"    it('should sort payload (exp, not number, descending)', function (done) {\n      check_sort1C(flow, \"$substring(payload,1)\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload of objects","suites":["SORT node"],"updatePoint":{"line":339,"column":38,"index":10442},"line":339,"code":"    it('should sort payload of objects', function (done) {\n      check_sort0C(flow, \"val\", data_in, data_out, done);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload by context (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":343,"column":65,"index":10602},"line":343,"code":"  it('should sort payload by context (exp, not number, ascending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"msg\",\n      msgKey: \"$flowContext($)\",\n      msgKeyType: \"jsonata\",\n      order: \"ascending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"second\", \"third\", \"first\", \"fourth\"];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n1.context()[\"flow\"].set(\"first\", \"3\");\n      n1.context()[\"flow\"].set(\"second\", \"1\");\n      n1.context()[\"flow\"].set(\"third\", \"2\");\n      n1.context()[\"flow\"].set(\"fourth\", \"4\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"data\");\n        var data = msg[\"data\"];\n        data.length.should.equal(data_out.length);\n        for (var i = 0; i < data_out.length; i++) {\n          data[i].should.equal(data_out[i]);\n        }\n        done();\n      });\n      var msg = {};\n      msg[\"data\"] = data_in;\n      n1.receive(msg);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group by context (exp, not number, ascending)","suites":["SORT node"],"updatePoint":{"line":386,"column":71,"index":11864},"line":386,"code":"  it('should sort message group by context (exp, not number, ascending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"seq\",\n      seqKey: \"$globalContext(payload)\",\n      seqKeyType: \"jsonata\",\n      order: \"ascending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"second\", \"fourth\", \"third\", \"first\"];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      var count = 0;\n      n1.context()[\"global\"].set(\"first\", \"4\");\n      n1.context()[\"global\"].set(\"second\", \"1\");\n      n1.context()[\"global\"].set(\"third\", \"3\");\n      n1.context()[\"global\"].set(\"fourth\", \"2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\");\n          msg.should.have.property(\"parts\");\n          msg.parts.should.have.property(\"count\", data_out.length);\n          var data = msg[\"payload\"];\n          var index = data_out.indexOf(data);\n          msg.parts.should.have.property(\"index\", index);\n          count++;\n          if (count === data_out.length) {\n            done();\n          }\n        } catch (e) {\n          done(e);\n        }\n      });\n      var len = data_in.length;\n      for (var i = 0; i < len; i++) {\n        var parts = {\n          id: \"X\",\n          index: i,\n          count: len\n        };\n        var msg = {\n          parts: parts\n        };\n        msg[\"payload\"] = data_in[i];\n        n1.receive(msg);\n      }\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort payload by persistable context (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":447,"column":78,"index":13597},"line":447,"code":"  it('should sort payload by persistable context (exp, not number, descending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"msg\",\n      msgKey: \"$globalContext($,\\\"memory\\\")\",\n      msgKeyType: \"jsonata\",\n      order: \"descending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"fourth\", \"first\", \"third\", \"second\"];\n    helper.load(sortNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        n1.context()[\"global\"].set([\"first\", \"second\", \"third\", \"fourth\"], [\"3\", \"1\", \"2\", \"4\"], \"memory\", function () {\n          n2.on(\"input\", function (msg) {\n            msg.should.have.property(\"data\");\n            var data = msg[\"data\"];\n            data.length.should.equal(data_out.length);\n            for (var i = 0; i < data_out.length; i++) {\n              data[i].should.equal(data_out[i]);\n            }\n            done();\n          });\n          var msg = {};\n          msg[\"data\"] = data_in;\n          n1.receive(msg);\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should sort message group by persistable context (exp, not number, descending)","suites":["SORT node"],"updatePoint":{"line":490,"column":84,"index":14927},"line":490,"code":"  it('should sort message group by persistable context (exp, not number, descending)', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      target: \"data\",\n      targetType: \"seq\",\n      seqKey: \"$flowContext(payload,\\\"memory\\\")\",\n      seqKeyType: \"jsonata\",\n      order: \"descending\",\n      as_num: false,\n      wires: [[\"n2\"]],\n      z: \"flow\"\n    }, {\n      id: \"n2\",\n      type: \"helper\",\n      z: \"flow\"\n    }, {\n      id: \"flow\",\n      type: \"tab\"\n    }];\n    var data_in = [\"first\", \"second\", \"third\", \"fourth\"];\n    var data_out = [\"first\", \"third\", \"fourth\", \"second\"];\n    helper.load(sortNode, flow, function () {\n      initContext(function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var count = 0;\n        n1.context()[\"flow\"].set([\"first\", \"second\", \"third\", \"fourth\"], [\"4\", \"1\", \"3\", \"2\"], \"memory\", function () {\n          n2.on(\"input\", function (msg) {\n            msg.should.have.property(\"payload\");\n            msg.should.have.property(\"parts\");\n            msg.parts.should.have.property(\"count\", data_out.length);\n            var data = msg[\"payload\"];\n            var index = data_out.indexOf(data);\n            msg.parts.should.have.property(\"index\", index);\n            count++;\n            if (count === data_out.length) {\n              done();\n            }\n          });\n          var len = data_in.length;\n          for (var i = 0; i < len; i++) {\n            var parts = {\n              id: \"X\",\n              index: i,\n              count: len\n            };\n            var msg = {\n              parts: parts\n            };\n            msg[\"payload\"] = data_in[i];\n            n1.receive(msg);\n          }\n        });\n      });\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should handle JSONata script error","suites":["SORT node"],"updatePoint":{"line":547,"column":40,"index":16632},"line":547,"code":"  it('should handle JSONata script error', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"$unknown()\",\n      seqKeyType: \"jsonata\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"sort\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"sort\");\n        evt.should.have.property('msg', \"sort.invalid-exp\");\n        done();\n      }, 150);\n      var msg0 = {\n        payload: \"A\",\n        parts: {\n          id: \"X\",\n          index: 0,\n          count: 2\n        }\n      };\n      var msg1 = {\n        payload: \"B\",\n        parts: {\n          id: \"X\",\n          index: 1,\n          count: 2\n        }\n      };\n      n1.receive(msg0);\n      n1.receive(msg1);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["SORT node"],"updatePoint":{"line":594,"column":45,"index":17769},"line":594,"code":"  it('should handle too many pending messages', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"payload\",\n      seqKeyType: \"msg\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      RED.settings.nodeMessageBufferMaxLength = 2;\n      setTimeout(function () {\n        var logEvents = helper.log().args.filter(function (evt) {\n          return evt[0].type == \"sort\";\n        });\n        var evt = logEvents[0][0];\n        evt.should.have.property('id', \"n1\");\n        evt.should.have.property('type', \"sort\");\n        evt.should.have.property('msg', \"sort.too-many\");\n        done();\n      }, 150);\n      for (var i = 0; i < 4; i++) {\n        var msg = {\n          payload: \"V\" + i,\n          parts: {\n            id: \"X\",\n            index: i,\n            count: 4\n          }\n        };\n        n1.receive(msg);\n      }\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should clear pending messages on close","suites":["SORT node"],"updatePoint":{"line":635,"column":44,"index":18851},"line":635,"code":"  it('should clear pending messages on close', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"sort\",\n      order: \"ascending\",\n      as_num: false,\n      target: \"payload\",\n      targetType: \"seq\",\n      seqKey: \"payload\",\n      seqKeyType: \"msg\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(sortNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var msg = {\n        payload: 0,\n        parts: {\n          id: \"X\",\n          index: 0,\n          count: 2\n        }\n      };\n      n1.receive(msg);\n      setTimeout(function () {\n        n1.close().then(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"sort\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"sort\");\n          evt.should.have.property('msg', \"sort.clear\");\n          done();\n        });\n      }, 150);\n    });\n  });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (payload)","suites":["SORT node","messaging API"],"updatePoint":{"line":728,"column":57,"index":21672},"line":728,"code":"    it('should call done() when message is sent (payload)', function (done) {\n      mapiDoneTestHelper(done, \"msg\", [{\n        msg: {\n          seq: 0,\n          payload: [1, 3, 2]\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (sequence)","suites":["SORT node","messaging API"],"updatePoint":{"line":739,"column":58,"index":21935},"line":739,"code":"    it('should call done() when message is sent (sequence)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 3,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 2,\n          parts: {\n            id: \"A\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (same group)","suites":["SORT node","messaging API"],"updatePoint":{"line":768,"column":69,"index":22526},"line":768,"code":"    it('should call done() regardless of buffer overflow (same group)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 1,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 3,\n          parts: {\n            id: \"A\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 2,\n          parts: {\n            id: \"A\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (different group)","suites":["SORT node","messaging API"],"updatePoint":{"line":810,"column":74,"index":23353},"line":810,"code":"    it('should call done() regardless of buffer overflow (different group)', function (done) {\n      mapiDoneTestHelper(done, \"seq\", [{\n        msg: {\n          seq: 0,\n          payload: 1,\n          parts: {\n            id: \"A\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          seq: 1,\n          payload: 3,\n          parts: {\n            id: \"B\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 500,\n        avr: 1200,\n        var: 100\n      }, {\n        msg: {\n          seq: 2,\n          payload: 5,\n          parts: {\n            id: \"C\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 1000,\n        avr: 1500,\n        var: 100\n      }, {\n        msg: {\n          seq: 3,\n          payload: 2,\n          parts: {\n            id: \"B\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1200,\n        avr: 1200,\n        var: 100\n      }, {\n        msg: {\n          seq: 4,\n          payload: 4,\n          parts: {\n            id: \"C\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1500,\n        avr: 1500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/18-sort_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded with defaults","suites":["BATCH node"],"updatePoint":{"line":33,"column":36,"index":1203},"line":33,"code":"  it('should be loaded with defaults', function (done) {\n    var flow = [{\n      id: \"n1\",\n      type: \"batch\",\n      name: \"BatchNode\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    helper.load(batchNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      n1.should.have.property('name', 'BatchNode');\n      done();\n    });\n  });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with count","suites":["BATCH node","mode: count"],"updatePoint":{"line":154,"column":37,"index":4341},"line":154,"code":"    it('should create seq. with count', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 2,\n        overlap: 0,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3], [4, 5]];\n      check_count(flow, results, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with count and overlap","suites":["BATCH node","mode: count"],"updatePoint":{"line":173,"column":49,"index":4817},"line":173,"code":"    it('should create seq. with count and overlap', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 3,\n        overlap: 2,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1, 2], [1, 2, 3], [2, 3, 4], [3, 4, 5]];\n      check_count(flow, results, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: count"],"updatePoint":{"line":192,"column":47,"index":5311},"line":192,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 5,\n        overlap: 0,\n        interval: 10,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n        for (var i = 0; i < 3; i++) {\n          n1.receive({\n            payload: i\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: count"],"updatePoint":{"line":229,"column":27,"index":6369},"line":229,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"count\",\n        count: 2,\n        overlap: 0,\n        interval: 0,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var results = [[0, 1], [4, 5]];\n        check_data(n1, n2, results, done);\n        n1.receive({\n          payload: 0\n        });\n        n1.receive({\n          payload: 1\n        });\n        n1.receive({\n          payload: 2\n        });\n        n1.receive({\n          payload: 3,\n          reset: true\n        });\n        n1.receive({\n          payload: 4\n        });\n        n1.receive({\n          payload: 5\n        });\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval","suites":["BATCH node","mode: interval"],"updatePoint":{"line":273,"column":40,"index":7365},"line":273,"code":"    it('should create seq. with interval', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3]];\n      check_interval(flow, results, 450, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval (in float)","suites":["BATCH node","mode: interval"],"updatePoint":{"line":292,"column":51,"index":7845},"line":292,"code":"    it('should create seq. with interval (in float)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 0.5,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[0, 1], [2, 3]];\n      check_interval(flow, results, 225, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval & not send empty seq","suites":["BATCH node","mode: interval"],"updatePoint":{"line":311,"column":61,"index":8337},"line":311,"code":"    it('should create seq. with interval & not send empty seq', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [\n      // 1300, 2600, 3900, 5200,\n      [0], [1], [2], [3]];\n      check_interval(flow, results, 1300, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should create seq. with interval & send empty seq","suites":["BATCH node","mode: interval"],"updatePoint":{"line":332,"column":57,"index":8868},"line":332,"code":"    it('should create seq. with interval & send empty seq', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: true,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [\n      // 1300, 2600, 3900, 5200,\n      [null], [0], [1], [2], [null], [3]];\n      check_interval(flow, results, 1300, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: interval"],"updatePoint":{"line":353,"column":47,"index":9404},"line":353,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n        for (var i = 0; i < 3; i++) {\n          n1.receive({\n            payload: i\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: interval"],"updatePoint":{"line":390,"column":27,"index":10464},"line":390,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"interval\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        var results = [[0, 1], [4, 5]];\n        check_data(n1, n2, results, done);\n        delayed_send(n1, 0, 3, 400, function () {\n          setTimeout(function () {\n            n1.receive({\n              payload: \"3\",\n              reset: true\n            });\n            delayed_send(n1, 4, 7, 400);\n          }, 10);\n        });\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat two seq. (series)","suites":["BATCH node","mode: concat"],"updatePoint":{"line":424,"column":39,"index":11364},"line":424,"code":"    it('should concat two seq. (series)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1]];\n      var inputs = [[\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat two seq. (mixed)","suites":["BATCH node","mode: concat"],"updatePoint":{"line":448,"column":38,"index":11985},"line":448,"code":"    it('should concat two seq. (mixed)', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1]];\n      var inputs = [[\"TA\", 2, 0, 2], [\"TB\", 0, 0, 2], [\"TA\", 3, 1, 2], [\"TB\", 1, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat three seq.","suites":["BATCH node","mode: concat"],"updatePoint":{"line":472,"column":32,"index":12600},"line":472,"code":"    it('should concat three seq.', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }, {\n          topic: \"TC\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[2, 3, 0, 1, 4]];\n      var inputs = [[\"TC\", 4, 0, 1], [\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should concat same seq.","suites":["BATCH node","mode: concat"],"updatePoint":{"line":498,"column":31,"index":13269},"line":498,"code":"    it('should concat same seq.', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TA\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      var results = [[9, 8, 9, 8]];\n      var inputs = [[\"TA\", 9, 0, 2], [\"TA\", 8, 1, 2]];\n      check_concat(flow, results, inputs, done);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle too many pending messages","suites":["BATCH node","mode: concat"],"updatePoint":{"line":522,"column":47,"index":13865},"line":522,"code":"    it('should handle too many pending messages', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(batchNode, flow, function () {\n        var n1 = helper.getNode(\"n1\");\n        var n2 = helper.getNode(\"n2\");\n        RED.settings.nodeMessageBufferMaxLength = 2;\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"batch\";\n          });\n          var evt = logEvents[0][0];\n          evt.should.have.property('id', \"n1\");\n          evt.should.have.property('type', \"batch\");\n          evt.should.have.property('msg', \"batch.too-many\");\n          done();\n        }, 150);\n        var C = 3;\n        for (var i = 0; i < C; i++) {\n          var parts_a = {\n            index: i,\n            count: C,\n            id: \"A\"\n          };\n          var parts_b = {\n            index: i,\n            count: C,\n            id: \"B\"\n          };\n          n1.receive({\n            payload: i,\n            topic: \"TA\",\n            parts: parts_a\n          });\n          n1.receive({\n            payload: i,\n            topic: \"TB\",\n            parts: parts_b\n          });\n        }\n      });\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should handle reset","suites":["BATCH node","mode: concat"],"updatePoint":{"line":581,"column":27,"index":15382},"line":581,"code":"    it('should handle reset', function (done) {\n      var flow = [{\n        id: \"n1\",\n        type: \"batch\",\n        name: \"BatchNode\",\n        mode: \"concat\",\n        count: 0,\n        overlap: 0,\n        interval: 1,\n        allowEmptySequence: false,\n        topics: [{\n          topic: \"TA\"\n        }, {\n          topic: \"TB\"\n        }],\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      try {\n        helper.load(batchNode, flow, function () {\n          var n1 = helper.getNode(\"n1\");\n          var n2 = helper.getNode(\"n2\");\n          var results = [[2, 3, 0, 1]];\n          check_data(n1, n2, results, done);\n          var inputs0 = [[\"TB\", 0, 0, 2], [\"TA\", 1, 0, 2]];\n          for (var data of inputs0) {\n            var msg = {\n              topic: data[0],\n              payload: data[1],\n              parts: {\n                id: data[0],\n                index: data[2],\n                count: data[3]\n              }\n            };\n            n1.receive(msg);\n          }\n          n1.receive({\n            payload: undefined,\n            reset: true\n          });\n          var inputs1 = [[\"TB\", 0, 0, 2], [\"TB\", 1, 1, 2], [\"TA\", 2, 0, 2], [\"TA\", 3, 1, 2]];\n          for (var data of inputs1) {\n            var msg = {\n              topic: data[0],\n              payload: data[1],\n              parts: {\n                id: data[0],\n                index: data[2],\n                count: data[3]\n              }\n            };\n            n1.receive(msg);\n          }\n        });\n      } catch (e) {\n        done(e);\n      }\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":699,"column":61,"index":18872},"line":699,"code":"    it('should call done() when message is sent (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 0,\n        avr: 0,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":716,"column":51,"index":19229},"line":716,"code":"    it('should call done() when reset (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 200,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 200,\n        avr: 200,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: count)","suites":["BATCH node","messaging API"],"updatePoint":{"line":734,"column":70,"index":19634},"line":734,"code":"    it('should call done() regardless of buffer overflow (mode: count)', function (done) {\n      mapiDoneTestHelper(done, \"count\", 10, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 100,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 2\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":758,"column":64,"index":20124},"line":758,"code":"    it('should call done() when message is sent (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 2000,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 500,\n        avr: 2000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":775,"column":54,"index":20495},"line":775,"code":"    it('should call done() when reset (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 200,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 200,\n        avr: 200,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: interval)","suites":["BATCH node","messaging API"],"updatePoint":{"line":793,"column":73,"index":20906},"line":793,"code":"    it('should call done() regardless of buffer overflow (mode: interval)', function (done) {\n      mapiDoneTestHelper(done, \"interval\", 2, 0, 2, false, [{\n        msg: {\n          payload: 0\n        },\n        delay: 0,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 1\n        },\n        delay: 100,\n        avr: 500,\n        var: 100\n      }, {\n        msg: {\n          payload: 2\n        },\n        delay: 500,\n        avr: 500,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when message is sent (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":817,"column":62,"index":21396},"line":817,"code":"    it('should call done() when message is sent (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 1,\n          parts: {\n            id: \"TA\",\n            index: 1,\n            count: 2\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() when reset (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":846,"column":52,"index":22004},"line":846,"code":"    it('should call done() when reset (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 2\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          payload: 1,\n          reset: true\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should call done() regardless of buffer overflow (mode: concat)","suites":["BATCH node","messaging API"],"updatePoint":{"line":870,"column":71,"index":22534},"line":870,"code":"    it('should call done() regardless of buffer overflow (mode: concat)', function (done) {\n      mapiDoneTestHelper(done, \"concat\", 2, 0, 2, false, [{\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 0,\n            count: 3\n          }\n        },\n        delay: 0,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 1,\n            count: 3\n          }\n        },\n        delay: 500,\n        avr: 1000,\n        var: 100\n      }, {\n        msg: {\n          topic: \"TA\",\n          payload: 0,\n          parts: {\n            id: \"TA\",\n            index: 2,\n            count: 3\n          }\n        },\n        delay: 1000,\n        avr: 1000,\n        var: 100\n      }]);\n    });","file":"nodes/core/sequence/19-batch_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["file Nodes","file out Node"],"updatePoint":{"line":57,"column":24,"index":2075},"line":57,"code":"    it('should be loaded', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        try {\n          var fileNode1 = helper.getNode(\"fileNode1\");\n          fileNode1.should.have.property('name', 'fileNode');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":76,"column":30,"index":2588},"line":76,"code":"    it('should write to a file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest);\n            f.should.have.length(4);\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"test\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file using RED.settings.fileWorkingDirectory","suites":["file Nodes","file out Node"],"updatePoint":{"line":108,"column":70,"index":3517},"line":108,"code":"    it('should write to a file using RED.settings.fileWorkingDirectory', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": relativePathToFile,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        RED.settings.fileWorkingDirectory = resourcesDir;\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest);\n            f.should.have.length(4);\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"test\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write multi-byte string to a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":141,"column":48,"index":4490},"line":141,"code":"    it('should write multi-byte string to a file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.have.length(2);\n            f.should.equal(\"\");\n            fs.unlinkSync(fileToTest);\n            msg.should.have.property(\"payload\", \"\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file and add newline","suites":["file Nodes","file out Node"],"updatePoint":{"line":174,"column":47,"index":5437},"line":174,"code":"    it('should append to a file and add newline', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        var data = [\"test2\", true, 999, [2]];\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n            if (count === 3) {\n              var f = fs.readFileSync(fileToTest).toString();\n              if (os.type() !== \"Windows_NT\") {\n                f.should.have.length(19);\n                f.should.equal(\"test2\\ntrue\\n999\\n[2]\\n\");\n              } else {\n                f.should.have.length(23);\n                f.should.equal(\"test2\\r\\ntrue\\r\\n999\\r\\n[2]\\r\\n\");\n              }\n              done();\n            }\n            count++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"test2\"\n        }); // string\n        setTimeout(function () {\n          n1.receive({\n            payload: true\n          }); // boolean\n        }, 30);\n        setTimeout(function () {\n          n1.receive({\n            payload: 999\n          }); // number\n        }, 60);\n        setTimeout(function () {\n          n1.receive({\n            payload: [2]\n          }); // object (array)\n        }, 90);\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file after it has been deleted ","suites":["file Nodes","file out Node"],"updatePoint":{"line":235,"column":58,"index":7223},"line":235,"code":"    it('should append to a file after it has been deleted ', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var data = [\"one\", \"two\", \"three\", \"four\"];\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n            try {\n              if (count === 1) {\n                // Check they got appended as expected\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"onetwo\");\n\n                // Delete the file\n                fs.unlinkSync(fileToTest);\n                setTimeout(function () {\n                  // Send two more messages to the file\n                  n1.receive({\n                    payload: \"three\"\n                  });\n                  n1.receive({\n                    payload: \"four\"\n                  });\n                }, wait);\n              }\n              if (count === 3) {\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"threefour\");\n                fs.unlinkSync(fileToTest);\n                done();\n              }\n            } catch (err) {\n              done(err);\n            }\n            count++;\n          } catch (e) {\n            done(e);\n          }\n        });\n\n        // Send two messages to the file\n        n1.receive({\n          payload: \"one\"\n        });\n        n1.receive({\n          payload: \"two\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should append to a file after it has been recreated ","suites":["file Nodes","file out Node"],"updatePoint":{"line":302,"column":60,"index":9208},"line":302,"code":"    it('should append to a file after it has been recreated ', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": false,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      try {\n        fs.unlinkSync(fileToTest);\n      } catch (err) {}\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var data = [\"one\", \"two\", \"three\", \"four\"];\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\");\n            data.should.containDeep([msg.payload]);\n            if (count == 1) {\n              // Check they got appended as expected\n              var f = fs.readFileSync(fileToTest).toString();\n              f.should.equal(\"onetwo\");\n              if (os.type() === \"Windows_NT\") {\n                var dummyFile = path.join(resourcesDir, \"50-file-test-dummy.txt\");\n                fs.rename(fileToTest, dummyFile, function () {\n                  recreateTest(n1, dummyFile);\n                });\n              } else {\n                recreateTest(n1, fileToTest);\n              }\n            }\n            if (count == 3) {\n              // Check the file was updated\n              try {\n                var f = fs.readFileSync(fileToTest).toString();\n                f.should.equal(\"threefour\");\n                fs.unlinkSync(fileToTest);\n                done();\n              } catch (err) {\n                done(err);\n              }\n            }\n          } catch (err) {\n            done(err);\n          }\n          count++;\n        });\n\n        // Send two messages to the file\n        n1.receive({\n          payload: \"one\"\n        });\n        n1.receive({\n          payload: \"two\"\n        });\n      });\n      function recreateTest(n1, fileToDelete) {\n        // Delete the file\n        fs.unlinkSync(fileToDelete);\n\n        // Recreate it\n        fs.writeFileSync(fileToTest, \"\");\n\n        // Send two more messages to the file\n        n1.receive({\n          payload: \"three\"\n        });\n        n1.receive({\n          payload: \"four\"\n        });\n      }\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use msg.filename if filename not set in node","suites":["file Nodes","file out Node"],"updatePoint":{"line":381,"column":59,"index":11547},"line":381,"code":"    it('should use msg.filename if filename not set in node', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"fine\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n            if (os.type() !== \"Windows_NT\") {\n              f.should.have.length(5);\n              f.should.equal(\"fine\\n\");\n            } else {\n              f.should.have.length(6);\n              f.should.equal(\"fine\\r\\n\");\n            }\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"fine\",\n          filename: fileToTest\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use msg._user_specified_filename set in nodes typedInput","suites":["file Nodes","file out Node"],"updatePoint":{"line":419,"column":71,"index":12714},"line":419,"code":"    it('should use msg._user_specified_filename set in nodes typedInput', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        filename: \"_user_specified_filename\",\n        filenameType: \"msg\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"typedInput\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n            if (os.type() !== \"Windows_NT\") {\n              f.should.equal(\"typedInput\\n\");\n            } else {\n              f.should.equal(\"typedInput\\r\\n\");\n            }\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"typedInput\",\n          _user_specified_filename: fileToTest\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should use env.TEST_FILE set in nodes typedInput","suites":["file Nodes","file out Node"],"updatePoint":{"line":457,"column":56,"index":13903},"line":457,"code":"    it('should use env.TEST_FILE set in nodes typedInput', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        filename: \"TEST_FILE\",\n        filenameType: \"env\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property(\"payload\", \"envTest\");\n            msg.should.have.property(\"filename\", fileToTest);\n            var f = fs.readFileSync(fileToTest).toString();\n            if (os.type() !== \"Windows_NT\") {\n              f.should.equal(\"envTest\\n\");\n            } else {\n              f.should.equal(\"envTest\\r\\n\");\n            }\n            done();\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"envTest\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should be able to delete the file","suites":["file Nodes","file out Node"],"updatePoint":{"line":494,"column":41,"index":15002},"line":494,"code":"    it('should be able to delete the file', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": \"delete\",\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        n2.on(\"input\", function (msg) {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\");\n            //done();\n          } catch (e) {\n            e.code.should.equal(\"ENOENT\");\n            done();\n          }\n        });\n        n1.receive({\n          payload: \"fine\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should warn if filename not set","suites":["file Nodes","file out Node"],"updatePoint":{"line":525,"column":39,"index":15866},"line":525,"code":"    it('should warn if filename not set', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        n1.emit(\"input\", {\n          payload: \"nofile\"\n        });\n        setTimeout(function () {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\");\n            //done();\n          } catch (e) {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.equal(\"file.errors.nofilename\");\n            done();\n          }\n        }, wait);\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"ignore a missing payload","suites":["file Nodes","file out Node"],"updatePoint":{"line":556,"column":32,"index":16863},"line":556,"code":"    it('ignore a missing payload', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var f = fs.readFileSync(fileToTest).toString();\n            f.should.not.equal(\"fine\");\n            //done();\n          } catch (e) {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(0);\n            done();\n          }\n        }, wait);\n        n1.emit(\"input\", {\n          topic: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to write to a ro file","suites":["file Nodes","file out Node"],"updatePoint":{"line":586,"column":41,"index":17755},"line":586,"code":"    it('should fail to write to a ro file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'createWriteStream').callsFake(function (arg1, arg2) {\n        var ws = {};\n        ws.on = function (e, d) {\n          throw \"Stub error message\";\n        };\n        ws.write = function (e, d) {};\n        return ws;\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": false,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Stub error message\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.createWriteStream.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to append to a ro file","suites":["file Nodes","file out Node"],"updatePoint":{"line":627,"column":42,"index":19061},"line":627,"code":"    it('should fail to append to a ro file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'createWriteStream').callsFake(function (arg1, arg2) {\n        var ws = {};\n        ws.on = function (e, d) {\n          throw \"Stub error message\";\n        };\n        ws.write = function (e, d) {};\n        return ws;\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Stub error message\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.createWriteStream.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should cope with failing to delete a file","suites":["file Nodes","file out Node"],"updatePoint":{"line":668,"column":49,"index":20375},"line":668,"code":"    it('should cope with failing to delete a file', function (done) {\n      // Stub file write so we can make writes fail\n      var spy = sinon.stub(fs, 'unlink').callsFake(function (arg, arg2) {\n        arg2(new Error(\"Stub error message\"));\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest,\n        \"appendNewline\": true,\n        \"overwriteFile\": \"delete\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.deletefail\");\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.unlink.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to create a new directory if not asked to do so (append)","suites":["file Nodes","file out Node"],"updatePoint":{"line":704,"column":76,"index":21585},"line":704,"code":"    it('should fail to create a new directory if not asked to do so (append)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      //var spy = sinon.stub(fs, 'appendFile').callsFake(function(arg,arg2,arg3,arg4){ arg4(new Error(\"Stub error message\")); });\n\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": false\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.appendfail\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n          //finally { fs.appendFile.restore(); }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should try to create a new directory if asked to do so (append)","suites":["file Nodes","file out Node"],"updatePoint":{"line":739,"column":71,"index":22873},"line":739,"code":"    it('should try to create a new directory if asked to do so (append)', function (done) {\n      // fs.writeFileSync of afterEach failed on Windows.\n      if (os.type() === \"Windows_NT\") {\n        done();\n        return;\n      }\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      var spy = sinon.stub(fs, \"ensureDir\").callsFake(function (arg1, arg2, arg3, arg4) {\n        arg2(null);\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": false,\n        \"createDir\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(0);\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.ensureDir.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should fail to create a new directory if not asked to do so (overwrite)","suites":["file Nodes","file out Node"],"updatePoint":{"line":780,"column":79,"index":24186},"line":780,"code":"    it('should fail to create a new directory if not asked to do so (overwrite)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      //var spy = sinon.stub(fs, 'appendFile').callsFake(function(arg,arg2,arg3,arg4){ arg4(new Error(\"Stub error message\")); });\n\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": false,\n        \"overwriteFile\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"file.errors.writefail\");\n            done();\n          } catch (e) {\n            done(e);\n          }\n          //finally { fs.appendFile.restore(); }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should try to create a new directory if asked to do so (overwrite)","suites":["file Nodes","file out Node"],"updatePoint":{"line":815,"column":74,"index":25476},"line":815,"code":"    it('should try to create a new directory if asked to do so (overwrite)', function (done) {\n      // Stub file write so we can make writes fail\n      var fileToTest2 = path.join(resourcesDir, \"file-out-node\", \"50-file-test-file.txt\");\n      var spy = sinon.stub(fs, \"ensureDir\").callsFake(function (arg1, arg2, arg3, arg4) {\n        arg2(null);\n      });\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"filename\": fileToTest2,\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        setTimeout(function () {\n          try {\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file\";\n            });\n            //console.log(logEvents);\n            logEvents.should.have.length(0);\n            done();\n          } catch (e) {\n            done(e);\n          } finally {\n            fs.ensureDir.restore();\n          }\n        }, wait);\n        n1.receive({\n          payload: \"test2\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to multiple files","suites":["file Nodes","file out Node"],"updatePoint":{"line":851,"column":38,"index":26609},"line":851,"code":"    it('should write to multiple files', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      var tmp_path = path.join(resourcesDir, \"tmp\");\n      var len = 1024 * 1024 * 10;\n      var file_count = 5;\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            count++;\n            if (count == file_count) {\n              for (var i = 0; i < file_count; i++) {\n                var name = path.join(tmp_path, String(i));\n                var f = fs.readFileSync(name);\n                f.should.have.length(len);\n                f[0].should.have.equal(i);\n              }\n              fs.removeSync(tmp_path);\n              done();\n            }\n          } catch (e) {\n            try {\n              fs.removeSync(tmp_path);\n            } catch (e1) {}\n            done(e);\n          }\n        });\n        for (var i = 0; i < file_count; i++) {\n          var data = Buffer.alloc ? Buffer.alloc(len) : new Buffer(len);\n          data.fill(i);\n          var name = path.join(tmp_path, String(i));\n          var msg = {\n            payload: data,\n            filename: name\n          };\n          n1.receive(msg);\n        }\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to multiple files if node is closed","suites":["file Nodes","file out Node"],"updatePoint":{"line":903,"column":56,"index":28197},"line":903,"code":"    it('should write to multiple files if node is closed', function (done) {\n      var flow = [{\n        id: \"fileNode1\",\n        type: \"file\",\n        name: \"fileNode\",\n        \"appendNewline\": true,\n        \"overwriteFile\": true,\n        \"createDir\": true,\n        wires: [[\"helperNode1\"]]\n      }, {\n        id: \"helperNode1\",\n        type: \"helper\"\n      }];\n      var tmp_path = path.join(resourcesDir, \"tmp\");\n      var len = 1024 * 1024 * 10;\n      var file_count = 5;\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileNode1\");\n        var n2 = helper.getNode(\"helperNode1\");\n        var count = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            count++;\n            if (count == file_count) {\n              for (var i = 0; i < file_count; i++) {\n                var name = path.join(tmp_path, String(i));\n                var f = fs.readFileSync(name);\n                f.should.have.length(len);\n                f[0].should.have.equal(i);\n              }\n              fs.removeSync(tmp_path);\n              done();\n            }\n          } catch (e) {\n            try {\n              fs.removeSync(tmp_path);\n            } catch (e1) {}\n            done(e);\n          }\n        });\n        for (var i = 0; i < file_count; i++) {\n          var data = Buffer.alloc ? Buffer.alloc(len) : new Buffer(len);\n          data.fill(i);\n          var name = path.join(tmp_path, String(i));\n          var msg = {\n            payload: data,\n            filename: name\n          };\n          n1.receive(msg);\n        }\n        n1.close();\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"none\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":992,"column":53,"index":30857},"line":992,"code":"      it('should write to a file with \"none\" encoding', function (done) {\n        checkWriteWithEncoding(\"none\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":997,"column":53,"index":31012},"line":997,"code":"      it('should write to a file with \"utf8\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf8\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"ucs2\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1000,"column":53,"index":31148},"line":1000,"code":"      it('should write to a file with \"ucs2\" encoding', function (done) {\n        checkWriteWithEncoding(\"ucs2\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf-16le\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1003,"column":57,"index":31288},"line":1003,"code":"      it('should write to a file with \"utf-16le\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf-16le\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"binary\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1006,"column":55,"index":31430},"line":1006,"code":"      it('should write to a file with \"binary\" encoding', function (done) {\n        checkWriteWithEncoding(\"binary\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"base64\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1009,"column":55,"index":31572},"line":1009,"code":"      it('should write to a file with \"base64\" encoding', function (done) {\n        checkWriteWithEncoding(\"base64\", \"5pel5pys6KqeCg==\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"hex\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1012,"column":52,"index":31723},"line":1012,"code":"      it('should write to a file with \"hex\" encoding', function (done) {\n        checkWriteWithEncoding(\"hex\", \"deadbeef\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"utf-16be\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1017,"column":57,"index":31886},"line":1017,"code":"      it('should write to a file with \"utf-16be\" encoding', function (done) {\n        checkWriteWithEncoding(\"utf-16be\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Shift_JIS\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1022,"column":58,"index":32050},"line":1022,"code":"      it('should write to a file with \"Shift_JIS\" encoding', function (done) {\n        checkWriteWithEncoding(\"Shift_JIS\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows-31j\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1025,"column":60,"index":32198},"line":1025,"code":"      it('should write to a file with \"Windows-31j\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows-31j\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows932\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1028,"column":59,"index":32347},"line":1028,"code":"      it('should write to a file with \"Windows932\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows932\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-JP\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1031,"column":55,"index":32491},"line":1031,"code":"      it('should write to a file with \"EUC-JP\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-JP\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GB2312\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1037,"column":55,"index":32707},"line":1037,"code":"      it('should write to a file with \"GB2312\" encoding', function (done) {\n        checkWriteWithEncoding(\"GB2312\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GBK\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1040,"column":52,"index":32846},"line":1040,"code":"      it('should write to a file with \"GBK\" encoding', function (done) {\n        checkWriteWithEncoding(\"GBK\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"GB18030\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1043,"column":56,"index":32986},"line":1043,"code":"      it('should write to a file with \"GB18030\" encoding', function (done) {\n        checkWriteWithEncoding(\"GB18030\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows936\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1046,"column":59,"index":33133},"line":1046,"code":"      it('should write to a file with \"Windows936\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows936\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-CN\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1049,"column":55,"index":33279},"line":1049,"code":"      it('should write to a file with \"EUC-CN\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-CN\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"KS_C_5601\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1054,"column":58,"index":33441},"line":1054,"code":"      it('should write to a file with \"KS_C_5601\" encoding', function (done) {\n        checkWriteWithEncoding(\"KS_C_5601\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows949\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1057,"column":59,"index":33590},"line":1057,"code":"      it('should write to a file with \"Windows949\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows949\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"EUC-KR\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1060,"column":55,"index":33736},"line":1060,"code":"      it('should write to a file with \"EUC-KR\" encoding', function (done) {\n        checkWriteWithEncoding(\"EUC-KR\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Big5\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1065,"column":53,"index":33903},"line":1065,"code":"      it('should write to a file with \"Big5\" encoding', function (done) {\n        checkWriteWithEncoding(\"Big5\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Big5-HKSCS\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1068,"column":59,"index":34047},"line":1068,"code":"      it('should write to a file with \"Big5-HKSCS\" encoding', function (done) {\n        checkWriteWithEncoding(\"Big5-HKSCS\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"Windows950\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1071,"column":59,"index":34197},"line":1071,"code":"      it('should write to a file with \"Windows950\" encoding', function (done) {\n        checkWriteWithEncoding(\"Windows950\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp874\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1076,"column":54,"index":34360},"line":1076,"code":"      it('should write to a file with \"cp874\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp874\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1250\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1079,"column":55,"index":34501},"line":1079,"code":"      it('should write to a file with \"cp1250\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1250\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1251\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1082,"column":55,"index":34643},"line":1082,"code":"      it('should write to a file with \"cp1251\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1251\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1252\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1085,"column":55,"index":34785},"line":1085,"code":"      it('should write to a file with \"cp1252\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1252\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1253\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1088,"column":55,"index":34927},"line":1088,"code":"      it('should write to a file with \"cp1253\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1253\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1254\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1091,"column":55,"index":35069},"line":1091,"code":"      it('should write to a file with \"cp1254\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1254\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1255\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1094,"column":55,"index":35211},"line":1094,"code":"      it('should write to a file with \"cp1255\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1255\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1256\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1097,"column":55,"index":35353},"line":1097,"code":"      it('should write to a file with \"cp1256\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1256\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1257\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1100,"column":55,"index":35495},"line":1100,"code":"      it('should write to a file with \"cp1257\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1257\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1258\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1103,"column":55,"index":35637},"line":1103,"code":"      it('should write to a file with \"cp1258\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1258\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp437\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1108,"column":54,"index":35792},"line":1108,"code":"      it('should write to a file with \"cp437\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp437\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp737\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1111,"column":54,"index":35932},"line":1111,"code":"      it('should write to a file with \"cp737\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp737\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp775\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1114,"column":54,"index":36072},"line":1114,"code":"      it('should write to a file with \"cp775\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp775\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp808\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1117,"column":54,"index":36212},"line":1117,"code":"      it('should write to a file with \"cp808\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp808\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp850\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1120,"column":54,"index":36352},"line":1120,"code":"      it('should write to a file with \"cp850\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp850\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp852\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1123,"column":54,"index":36492},"line":1123,"code":"      it('should write to a file with \"cp852\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp852\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp855\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1126,"column":54,"index":36632},"line":1126,"code":"      it('should write to a file with \"cp855\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp855\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp856\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1129,"column":54,"index":36772},"line":1129,"code":"      it('should write to a file with \"cp856\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp856\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp857\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1132,"column":54,"index":36912},"line":1132,"code":"      it('should write to a file with \"cp857\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp857\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp858\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1135,"column":54,"index":37052},"line":1135,"code":"      it('should write to a file with \"cp858\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp858\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp860\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1138,"column":54,"index":37192},"line":1138,"code":"      it('should write to a file with \"cp860\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp860\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp861\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1141,"column":54,"index":37332},"line":1141,"code":"      it('should write to a file with \"cp861\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp861\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp866\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1144,"column":54,"index":37472},"line":1144,"code":"      it('should write to a file with \"cp866\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp866\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp869\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1147,"column":54,"index":37612},"line":1147,"code":"      it('should write to a file with \"cp869\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp869\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp922\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1150,"column":54,"index":37752},"line":1150,"code":"      it('should write to a file with \"cp922\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp922\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1046\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1153,"column":55,"index":37893},"line":1153,"code":"      it('should write to a file with \"cp1046\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1046\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1124\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1156,"column":55,"index":38035},"line":1156,"code":"      it('should write to a file with \"cp1124\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1124\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1125\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1159,"column":55,"index":38177},"line":1159,"code":"      it('should write to a file with \"cp1125\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1125\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1129\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1162,"column":55,"index":38319},"line":1162,"code":"      it('should write to a file with \"cp1129\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1129\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1133\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1165,"column":55,"index":38461},"line":1165,"code":"      it('should write to a file with \"cp1133\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1133\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1161\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1168,"column":55,"index":38603},"line":1168,"code":"      it('should write to a file with \"cp1161\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1161\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1162\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1171,"column":55,"index":38745},"line":1171,"code":"      it('should write to a file with \"cp1162\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1162\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"cp1163\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1174,"column":55,"index":38887},"line":1174,"code":"      it('should write to a file with \"cp1163\" encoding', function (done) {\n        checkWriteWithEncoding(\"cp1163\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccroatian\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1179,"column":60,"index":39048},"line":1179,"code":"      it('should write to a file with \"maccroatian\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccroatian\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccyrillic\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1182,"column":60,"index":39200},"line":1182,"code":"      it('should write to a file with \"maccyrillic\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccyrillic\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macgreek\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1185,"column":57,"index":39349},"line":1185,"code":"      it('should write to a file with \"macgreek\" encoding', function (done) {\n        checkWriteWithEncoding(\"macgreek\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maciceland\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1188,"column":59,"index":39497},"line":1188,"code":"      it('should write to a file with \"maciceland\" encoding', function (done) {\n        checkWriteWithEncoding(\"maciceland\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macroman\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1191,"column":57,"index":39645},"line":1191,"code":"      it('should write to a file with \"macroman\" encoding', function (done) {\n        checkWriteWithEncoding(\"macroman\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macromania\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1194,"column":59,"index":39793},"line":1194,"code":"      it('should write to a file with \"macromania\" encoding', function (done) {\n        checkWriteWithEncoding(\"macromania\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macthai\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1197,"column":56,"index":39940},"line":1197,"code":"      it('should write to a file with \"macthai\" encoding', function (done) {\n        checkWriteWithEncoding(\"macthai\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macturkish\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1200,"column":59,"index":40087},"line":1200,"code":"      it('should write to a file with \"macturkish\" encoding', function (done) {\n        checkWriteWithEncoding(\"macturkish\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macukraine\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1203,"column":59,"index":40237},"line":1203,"code":"      it('should write to a file with \"macukraine\" encoding', function (done) {\n        checkWriteWithEncoding(\"macukraine\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"maccenteuro\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1206,"column":60,"index":40388},"line":1206,"code":"      it('should write to a file with \"maccenteuro\" encoding', function (done) {\n        checkWriteWithEncoding(\"maccenteuro\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"macintosh\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1209,"column":58,"index":40538},"line":1209,"code":"      it('should write to a file with \"macintosh\" encoding', function (done) {\n        checkWriteWithEncoding(\"macintosh\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-r\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1214,"column":55,"index":40698},"line":1214,"code":"      it('should write to a file with \"koi8-r\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-r\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-u\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1217,"column":55,"index":40840},"line":1217,"code":"      it('should write to a file with \"koi8-u\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-u\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-ru\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1220,"column":56,"index":40983},"line":1220,"code":"      it('should write to a file with \"koi8-ru\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-ru\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"koi8-t\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1223,"column":55,"index":41126},"line":1223,"code":"      it('should write to a file with \"koi8-t\" encoding', function (done) {\n        checkWriteWithEncoding(\"koi8-t\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"armscii8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1228,"column":57,"index":41285},"line":1228,"code":"      it('should write to a file with \"armscii8\" encoding', function (done) {\n        checkWriteWithEncoding(\"armscii8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"rk1048\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1231,"column":55,"index":41429},"line":1231,"code":"      it('should write to a file with \"rk1048\" encoding', function (done) {\n        checkWriteWithEncoding(\"rk1048\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"tcvn\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1234,"column":53,"index":41569},"line":1234,"code":"      it('should write to a file with \"tcvn\" encoding', function (done) {\n        checkWriteWithEncoding(\"tcvn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"georgianacademy\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1237,"column":64,"index":41718},"line":1237,"code":"      it('should write to a file with \"georgianacademy\" encoding', function (done) {\n        checkWriteWithEncoding(\"georgianacademy\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"georgianps\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1240,"column":59,"index":41873},"line":1240,"code":"      it('should write to a file with \"georgianps\" encoding', function (done) {\n        checkWriteWithEncoding(\"georgianps\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"pt154\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1243,"column":54,"index":42018},"line":1243,"code":"      it('should write to a file with \"pt154\" encoding', function (done) {\n        checkWriteWithEncoding(\"pt154\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"viscii\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1246,"column":55,"index":42159},"line":1246,"code":"      it('should write to a file with \"viscii\" encoding', function (done) {\n        checkWriteWithEncoding(\"viscii\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"iso646cn\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1249,"column":57,"index":42303},"line":1249,"code":"      it('should write to a file with \"iso646cn\" encoding', function (done) {\n        checkWriteWithEncoding(\"iso646cn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"iso646jp\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1252,"column":57,"index":42449},"line":1252,"code":"      it('should write to a file with \"iso646jp\" encoding', function (done) {\n        checkWriteWithEncoding(\"iso646jp\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"hproman8\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1255,"column":57,"index":42595},"line":1255,"code":"      it('should write to a file with \"hproman8\" encoding', function (done) {\n        checkWriteWithEncoding(\"hproman8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should write to a file with \"tis620\" encoding","suites":["file Nodes","file out Node","encodings"],"updatePoint":{"line":1258,"column":55,"index":42739},"line":1258,"code":"      it('should write to a file with \"tis620\" encoding', function (done) {\n        checkWriteWithEncoding(\"tis620\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should be loaded","suites":["file Nodes","file in Node"],"updatePoint":{"line":1280,"column":24,"index":43566},"line":1280,"code":"    it('should be loaded', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"utf8\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        n1.should.have.property('name', 'fileInNode');\n        done();\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a buffer","suites":["file Nodes","file in Node"],"updatePoint":{"line":1294,"column":49,"index":43988},"line":1294,"code":"    it('should read in a file and output a buffer', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload');\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.should.have.length(40);\n          msg.payload.toString().should.equal('File message line 1\\nFile message line 2\\n');\n          done();\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a utf8 string","suites":["file Nodes","file in Node"],"updatePoint":{"line":1321,"column":54,"index":44824},"line":1321,"code":"    it('should read in a file and output a utf8 string', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file using fileWorkingDirectory to set cwd","suites":["file Nodes","file in Node"],"updatePoint":{"line":1352,"column":67,"index":45740},"line":1352,"code":"    it('should read in a file using fileWorkingDirectory to set cwd', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": relativePathToFile,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        RED.settings.fileWorkingDirectory = resourcesDir;\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file ending in cr and output a utf8 string","suites":["file Nodes","file in Node"],"updatePoint":{"line":1384,"column":67,"index":46722},"line":1384,"code":"    it('should read in a file ending in cr and output a utf8 string', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": fileToTest2,\n        \"format\": \"utf8\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.payload.should.have.length(40);\n            msg.payload.should.equal(\"File message line 1\\nFile message line 2\\n\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output split lines with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1415,"column":63,"index":47635},"line":1415,"code":"    it('should read in a file and output split lines with parts', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.should.have.property('topic');\n            msg.should.not.have.property('foo');\n            msg.should.not.have.property('bar');\n            msg.payload.should.be.a.String();\n            msg.should.have.property('parts');\n            msg.parts.should.have.property('index', c);\n            msg.parts.should.have.property('type', 'string');\n            msg.parts.should.have.property('ch', '\\n');\n            if (c === 0) {\n              msg.payload.should.equal(\"File message line 1\");\n            }\n            if (c === 1) {\n              msg.payload.should.equal(\"File message line 2\");\n            }\n            if (c === 2) {\n              msg.payload.should.equal(\"\");\n              done();\n            }\n            c++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\",\n          topic: \"A\",\n          foo: \"bar\",\n          bar: \"foo\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with empty line and output split lines with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1465,"column":79,"index":49187},"line":1465,"code":"    it('should read in a file with empty line and output split lines with parts', function (done) {\n      var data = [\"-\", \"\", \"-\", \"\"];\n      var line = data.join(\"\\n\");\n      fs.writeFileSync(fileToTest, line);\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.equal(data[c]);\n            msg.should.have.property('parts');\n            var parts = msg.parts;\n            parts.should.have.property('index', c);\n            parts.should.have.property('type', 'string');\n            parts.should.have.property('ch', '\\n');\n            c++;\n            if (c === data.length) {\n              parts.should.have.property('count', data.length);\n              done();\n            } else {\n              parts.should.not.have.property('count');\n            }\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output split lines with parts and extra props","suites":["file Nodes","file in Node"],"updatePoint":{"line":1509,"column":79,"index":50563},"line":1509,"code":"    it('should read in a file and output split lines with parts and extra props', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"lines\",\n        allProps: true,\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        var c = 0;\n        n2.on(\"input\", function (msg) {\n          // console.log(msg)\n          try {\n            msg.should.have.property('payload');\n            msg.payload.should.be.a.String();\n            msg.should.have.property('topic');\n            msg.should.have.property('foo');\n            msg.should.have.property('bar');\n            msg.should.have.property('parts');\n            msg.parts.should.have.property('index', c);\n            msg.parts.should.have.property('type', 'string');\n            msg.parts.should.have.property('ch', '\\n');\n            if (c === 0) {\n              msg.payload.should.equal(\"File message line 1\");\n            }\n            if (c === 1) {\n              msg.payload.should.equal(\"File message line 2\");\n            }\n            if (c === 2) {\n              msg.payload.should.equal(\"\");\n              done();\n            }\n            c++;\n          } catch (e) {\n            done(e);\n          }\n        });\n        n1.receive({\n          payload: \"\",\n          topic: \"B\",\n          foo: \"bar\",\n          bar: \"foo\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file and output a buffer with parts","suites":["file Nodes","file in Node"],"updatePoint":{"line":1561,"column":60,"index":52142},"line":1561,"code":"    it('should read in a file and output a buffer with parts', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        filename: fileToTest,\n        format: \"stream\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          msg.should.have.property('payload');\n          Buffer.isBuffer(msg.payload).should.be.true();\n          msg.payload.should.have.length(40);\n          msg.should.have.property('parts');\n          msg.parts.should.have.property('count', 1);\n          msg.parts.should.have.property('type', 'buffer');\n          msg.parts.should.have.property('ch', '');\n          done();\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should warn if no filename set","suites":["file Nodes","file in Node"],"updatePoint":{"line":1591,"column":38,"index":53082},"line":1591,"code":"    it('should warn if no filename set', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"format\": \"\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        setTimeout(function () {\n          var logEvents = helper.log().args.filter(function (evt) {\n            return evt[0].type == \"file in\";\n          });\n          logEvents.should.have.length(1);\n          logEvents[0][0].should.have.a.property('msg');\n          logEvents[0][0].msg.toString().should.equal(\"file.errors.nofilename\");\n          done();\n        }, wait);\n        n1.receive({});\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should handle a file read error","suites":["file Nodes","file in Node"],"updatePoint":{"line":1612,"column":39,"index":53788},"line":1612,"code":"    it('should handle a file read error', function (done) {\n      var flow = [{\n        id: \"fileInNode1\",\n        type: \"file in\",\n        name: \"fileInNode\",\n        \"filename\": \"badfile\",\n        \"format\": \"\",\n        wires: [[\"n2\"]]\n      }, {\n        id: \"n2\",\n        type: \"helper\"\n      }];\n      helper.load(fileNode, flow, function () {\n        var n1 = helper.getNode(\"fileInNode1\");\n        var n2 = helper.getNode(\"n2\");\n        n2.on(\"input\", function (msg) {\n          try {\n            msg.should.not.have.property('payload');\n            msg.should.have.property(\"error\");\n            msg.error.should.have.property(\"code\", \"ENOENT\");\n            var logEvents = helper.log().args.filter(function (evt) {\n              return evt[0].type == \"file in\";\n            });\n            logEvents.should.have.length(1);\n            logEvents[0][0].should.have.a.property('msg');\n            logEvents[0][0].msg.toString().should.startWith(\"Error\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n        n1.receive({\n          payload: \"\"\n        });\n      });\n    });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"none\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1683,"column":52,"index":55918},"line":1683,"code":"      it('should read in a file with \"none\" encoding', function (done) {\n        checkReadWithEncoding(\"none\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1688,"column":52,"index":56069},"line":1688,"code":"      it('should read in a file with \"utf8\" encoding', function (done) {\n        checkReadWithEncoding(\"utf8\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"ucs2\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1691,"column":52,"index":56203},"line":1691,"code":"      it('should read in a file with \"ucs2\" encoding', function (done) {\n        checkReadWithEncoding(\"ucs2\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf-16le\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1694,"column":56,"index":56341},"line":1694,"code":"      it('should read in a file with \"utf-16le\" encoding', function (done) {\n        checkReadWithEncoding(\"utf-16le\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"binary\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1697,"column":54,"index":56481},"line":1697,"code":"      it('should read in a file with \"binary\" encoding', function (done) {\n        checkReadWithEncoding(\"binary\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"base64\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1700,"column":54,"index":56621},"line":1700,"code":"      it('should read in a file with \"base64\" encoding', function (done) {\n        checkReadWithEncoding(\"base64\", \"5pel5pys6KqeCg==\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"hex\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1703,"column":51,"index":56770},"line":1703,"code":"      it('should read in a file with \"hex\" encoding', function (done) {\n        checkReadWithEncoding(\"hex\", \"deadbeef\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"utf-16be\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1708,"column":56,"index":56931},"line":1708,"code":"      it('should read in a file with \"utf-16be\" encoding', function (done) {\n        checkReadWithEncoding(\"utf-16be\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Shift_JIS\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1713,"column":57,"index":57093},"line":1713,"code":"      it('should read in a file with \"Shift_JIS\" encoding', function (done) {\n        checkReadWithEncoding(\"Shift_JIS\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows-31j\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1716,"column":59,"index":57239},"line":1716,"code":"      it('should read in a file with \"Windows-31j\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows-31j\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows932\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1719,"column":58,"index":57386},"line":1719,"code":"      it('should read in a file with \"Windows932\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows932\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-JP\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1722,"column":54,"index":57528},"line":1722,"code":"      it('should read in a file with \"EUC-JP\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-JP\", \"\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GB2312\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1728,"column":54,"index":57742},"line":1728,"code":"      it('should read in a file with \"GB2312\" encoding', function (done) {\n        checkReadWithEncoding(\"GB2312\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GBK\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1731,"column":51,"index":57879},"line":1731,"code":"      it('should read in a file with \"GBK\" encoding', function (done) {\n        checkReadWithEncoding(\"GBK\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"GB18030\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1734,"column":55,"index":58017},"line":1734,"code":"      it('should read in a file with \"GB18030\" encoding', function (done) {\n        checkReadWithEncoding(\"GB18030\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows936\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1737,"column":58,"index":58162},"line":1737,"code":"      it('should read in a file with \"Windows936\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows936\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-CN\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1740,"column":54,"index":58306},"line":1740,"code":"      it('should read in a file with \"EUC-CN\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-CN\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"KS_C_5601\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1745,"column":57,"index":58466},"line":1745,"code":"      it('should read in a file with \"KS_C_5601\" encoding', function (done) {\n        checkReadWithEncoding(\"KS_C_5601\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows949\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1748,"column":58,"index":58613},"line":1748,"code":"      it('should read in a file with \"Windows949\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows949\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"EUC-KR\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1751,"column":54,"index":58757},"line":1751,"code":"      it('should read in a file with \"EUC-KR\" encoding', function (done) {\n        checkReadWithEncoding(\"EUC-KR\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Big5\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1756,"column":52,"index":58922},"line":1756,"code":"      it('should read in a file with \"Big5\" encoding', function (done) {\n        checkReadWithEncoding(\"Big5\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Big5-HKSCS\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1759,"column":58,"index":59064},"line":1759,"code":"      it('should read in a file with \"Big5-HKSCS\" encoding', function (done) {\n        checkReadWithEncoding(\"Big5-HKSCS\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"Windows950\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1762,"column":58,"index":59212},"line":1762,"code":"      it('should read in a file with \"Windows950\" encoding', function (done) {\n        checkReadWithEncoding(\"Windows950\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp874\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1767,"column":53,"index":59373},"line":1767,"code":"      it('should read in a file with \"cp874\" encoding', function (done) {\n        checkReadWithEncoding(\"cp874\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1250\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1770,"column":54,"index":59512},"line":1770,"code":"      it('should read in a file with \"cp1250\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1250\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1251\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1773,"column":54,"index":59652},"line":1773,"code":"      it('should read in a file with \"cp1251\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1251\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1252\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1776,"column":54,"index":59792},"line":1776,"code":"      it('should read in a file with \"cp1252\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1252\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1253\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1779,"column":54,"index":59932},"line":1779,"code":"      it('should read in a file with \"cp1253\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1253\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1254\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1782,"column":54,"index":60072},"line":1782,"code":"      it('should read in a file with \"cp1254\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1254\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1255\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1785,"column":54,"index":60212},"line":1785,"code":"      it('should read in a file with \"cp1255\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1255\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1256\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1788,"column":54,"index":60352},"line":1788,"code":"      it('should read in a file with \"cp1256\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1256\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1257\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1791,"column":54,"index":60492},"line":1791,"code":"      it('should read in a file with \"cp1257\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1257\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1258\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1794,"column":54,"index":60632},"line":1794,"code":"      it('should read in a file with \"cp1258\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1258\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp437\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1799,"column":53,"index":60785},"line":1799,"code":"      it('should read in a file with \"cp437\" encoding', function (done) {\n        checkReadWithEncoding(\"cp437\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp737\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1802,"column":53,"index":60923},"line":1802,"code":"      it('should read in a file with \"cp737\" encoding', function (done) {\n        checkReadWithEncoding(\"cp737\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp775\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1805,"column":53,"index":61061},"line":1805,"code":"      it('should read in a file with \"cp775\" encoding', function (done) {\n        checkReadWithEncoding(\"cp775\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp808\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1808,"column":53,"index":61199},"line":1808,"code":"      it('should read in a file with \"cp808\" encoding', function (done) {\n        checkReadWithEncoding(\"cp808\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp850\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1811,"column":53,"index":61337},"line":1811,"code":"      it('should read in a file with \"cp850\" encoding', function (done) {\n        checkReadWithEncoding(\"cp850\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp852\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1814,"column":53,"index":61475},"line":1814,"code":"      it('should read in a file with \"cp852\" encoding', function (done) {\n        checkReadWithEncoding(\"cp852\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp855\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1817,"column":53,"index":61613},"line":1817,"code":"      it('should read in a file with \"cp855\" encoding', function (done) {\n        checkReadWithEncoding(\"cp855\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp856\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1820,"column":53,"index":61751},"line":1820,"code":"      it('should read in a file with \"cp856\" encoding', function (done) {\n        checkReadWithEncoding(\"cp856\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp857\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1823,"column":53,"index":61889},"line":1823,"code":"      it('should read in a file with \"cp857\" encoding', function (done) {\n        checkReadWithEncoding(\"cp857\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp858\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1826,"column":53,"index":62027},"line":1826,"code":"      it('should read in a file with \"cp858\" encoding', function (done) {\n        checkReadWithEncoding(\"cp858\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp860\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1829,"column":53,"index":62165},"line":1829,"code":"      it('should read in a file with \"cp860\" encoding', function (done) {\n        checkReadWithEncoding(\"cp860\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp861\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1832,"column":53,"index":62303},"line":1832,"code":"      it('should read in a file with \"cp861\" encoding', function (done) {\n        checkReadWithEncoding(\"cp861\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp866\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1835,"column":53,"index":62441},"line":1835,"code":"      it('should read in a file with \"cp866\" encoding', function (done) {\n        checkReadWithEncoding(\"cp866\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp869\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1838,"column":53,"index":62579},"line":1838,"code":"      it('should read in a file with \"cp869\" encoding', function (done) {\n        checkReadWithEncoding(\"cp869\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp922\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1841,"column":53,"index":62717},"line":1841,"code":"      it('should read in a file with \"cp922\" encoding', function (done) {\n        checkReadWithEncoding(\"cp922\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1046\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1844,"column":54,"index":62856},"line":1844,"code":"      it('should read in a file with \"cp1046\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1046\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1124\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1847,"column":54,"index":62996},"line":1847,"code":"      it('should read in a file with \"cp1124\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1124\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1125\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1850,"column":54,"index":63136},"line":1850,"code":"      it('should read in a file with \"cp1125\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1125\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1129\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1853,"column":54,"index":63276},"line":1853,"code":"      it('should read in a file with \"cp1129\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1129\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1133\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1856,"column":54,"index":63416},"line":1856,"code":"      it('should read in a file with \"cp1133\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1133\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1161\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1859,"column":54,"index":63556},"line":1859,"code":"      it('should read in a file with \"cp1161\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1161\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1162\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1862,"column":54,"index":63696},"line":1862,"code":"      it('should read in a file with \"cp1162\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1162\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"cp1163\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1865,"column":54,"index":63836},"line":1865,"code":"      it('should read in a file with \"cp1163\" encoding', function (done) {\n        checkReadWithEncoding(\"cp1163\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccroatian\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1870,"column":59,"index":63995},"line":1870,"code":"      it('should read in a file with \"maccroatian\" encoding', function (done) {\n        checkReadWithEncoding(\"maccroatian\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccyrillic\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1873,"column":59,"index":64145},"line":1873,"code":"      it('should read in a file with \"maccyrillic\" encoding', function (done) {\n        checkReadWithEncoding(\"maccyrillic\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macgreek\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1876,"column":56,"index":64292},"line":1876,"code":"      it('should read in a file with \"macgreek\" encoding', function (done) {\n        checkReadWithEncoding(\"macgreek\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maciceland\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1879,"column":58,"index":64438},"line":1879,"code":"      it('should read in a file with \"maciceland\" encoding', function (done) {\n        checkReadWithEncoding(\"maciceland\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macroman\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1882,"column":56,"index":64584},"line":1882,"code":"      it('should read in a file with \"macroman\" encoding', function (done) {\n        checkReadWithEncoding(\"macroman\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macromania\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1885,"column":58,"index":64730},"line":1885,"code":"      it('should read in a file with \"macromania\" encoding', function (done) {\n        checkReadWithEncoding(\"macromania\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macthai\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1888,"column":55,"index":64875},"line":1888,"code":"      it('should read in a file with \"macthai\" encoding', function (done) {\n        checkReadWithEncoding(\"macthai\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macturkish\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1891,"column":58,"index":65020},"line":1891,"code":"      it('should read in a file with \"macturkish\" encoding', function (done) {\n        checkReadWithEncoding(\"macturkish\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macukraine\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1894,"column":58,"index":65168},"line":1894,"code":"      it('should read in a file with \"macukraine\" encoding', function (done) {\n        checkReadWithEncoding(\"macukraine\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"maccenteuro\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1897,"column":59,"index":65317},"line":1897,"code":"      it('should read in a file with \"maccenteuro\" encoding', function (done) {\n        checkReadWithEncoding(\"maccenteuro\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"macintosh\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1900,"column":57,"index":65465},"line":1900,"code":"      it('should read in a file with \"macintosh\" encoding', function (done) {\n        checkReadWithEncoding(\"macintosh\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-r\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1905,"column":54,"index":65623},"line":1905,"code":"      it('should read in a file with \"koi8-r\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-r\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-u\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1908,"column":54,"index":65763},"line":1908,"code":"      it('should read in a file with \"koi8-u\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-u\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-ru\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1911,"column":55,"index":65904},"line":1911,"code":"      it('should read in a file with \"koi8-ru\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-ru\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"koi8-t\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1914,"column":54,"index":66045},"line":1914,"code":"      it('should read in a file with \"koi8-t\" encoding', function (done) {\n        checkReadWithEncoding(\"koi8-t\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"armscii8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1919,"column":56,"index":66202},"line":1919,"code":"      it('should read in a file with \"armscii8\" encoding', function (done) {\n        checkReadWithEncoding(\"armscii8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"rk1048\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1922,"column":54,"index":66344},"line":1922,"code":"      it('should read in a file with \"rk1048\" encoding', function (done) {\n        checkReadWithEncoding(\"rk1048\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"tcvn\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1925,"column":52,"index":66482},"line":1925,"code":"      it('should read in a file with \"tcvn\" encoding', function (done) {\n        checkReadWithEncoding(\"tcvn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"georgianacademy\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1928,"column":63,"index":66629},"line":1928,"code":"      it('should read in a file with \"georgianacademy\" encoding', function (done) {\n        checkReadWithEncoding(\"georgianacademy\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"georgianps\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1931,"column":58,"index":66782},"line":1931,"code":"      it('should read in a file with \"georgianps\" encoding', function (done) {\n        checkReadWithEncoding(\"georgianps\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"pt154\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1934,"column":53,"index":66925},"line":1934,"code":"      it('should read in a file with \"pt154\" encoding', function (done) {\n        checkReadWithEncoding(\"pt154\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"viscii\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1937,"column":54,"index":67064},"line":1937,"code":"      it('should read in a file with \"viscii\" encoding', function (done) {\n        checkReadWithEncoding(\"viscii\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"iso646cn\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1940,"column":56,"index":67206},"line":1940,"code":"      it('should read in a file with \"iso646cn\" encoding', function (done) {\n        checkReadWithEncoding(\"iso646cn\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"iso646jp\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1943,"column":56,"index":67350},"line":1943,"code":"      it('should read in a file with \"iso646jp\" encoding', function (done) {\n        checkReadWithEncoding(\"iso646jp\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"hproman8\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1946,"column":56,"index":67494},"line":1946,"code":"      it('should read in a file with \"hproman8\" encoding', function (done) {\n        checkReadWithEncoding(\"hproman8\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should read in a file with \"tis620\" encoding","suites":["file Nodes","file in Node","encodings"],"updatePoint":{"line":1949,"column":54,"index":67636},"line":1949,"code":"      it('should read in a file with \"tis620\" encoding', function (done) {\n        checkReadWithEncoding(\"tis620\", \"test\", done);\n      });","file":"nodes/core/storage/10-file_spec.js","skipped":false,"dir":"test"},{"name":"should watch a file to be changed","suites":["watch Node"],"updatePoint":{"line":97,"column":39,"index":3175},"line":97,"code":"  it('should watch a file to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file',\n        'size': 5\n      }\n    };\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch multiple files to be changed","suites":["watch Node"],"updatePoint":{"line":123,"column":47,"index":3819},"line":123,"code":"  it('should watch multiple files to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    fs.writeFileSync(files.file1ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch + \",\" + files.file1ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 5\n      },\n\n      'file1.txt': {\n        'payload': files.file1ToWatch,\n        'topic': files.file1ToWatch,\n        'type': 'file' //,\n        // 'size': 3\n      }\n    };\n\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n      fs.appendFileSync(files.file1ToWatch, \"123\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch attribute of a file to be changed","suites":["watch Node"],"updatePoint":{"line":159,"column":52,"index":4755},"line":159,"code":"  it('should watch attribute of a file to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    fs.chmodSync(files.file0ToWatch, 0o444);\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.file0ToWatch,\n      recursive: false,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 0\n      }\n    };\n\n    testWatch(flow, function () {\n      fs.chmodSync(files.file0ToWatch, 0o777);\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch a file in a directory to be changed","suites":["watch Node"],"updatePoint":{"line":187,"column":54,"index":5451},"line":187,"code":"  it('should watch a file in a directory to be changed', function (done) {\n    var files = prepareDir();\n    fs.writeFileSync(files.file0ToWatch, '');\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.dirToWatch,\n      recursive: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file0.txt': {\n        'payload': files.file0ToWatch,\n        'topic': files.file0ToWatch,\n        'type': 'file' //,\n        // 'size': 5\n      }\n    };\n\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file0ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should watch a sub directory in a directory to be changed","suites":["watch Node"],"updatePoint":{"line":214,"column":63,"index":6115},"line":214,"code":"  it('should watch a sub directory in a directory to be changed', function (done) {\n    var files = prepareDir();\n    fs.mkdirSync(files.subDirToWatch);\n    var flow = [{\n      id: \"n1\",\n      type: \"watch\",\n      name: \"watch\",\n      files: files.dirToWatch,\n      recursive: true,\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      type: \"helper\"\n    }];\n    var results = {\n      'file2.txt': {\n        payload: files.file2ToWatch,\n        type: 'file' //,\n        // size: 5\n      }\n    };\n\n    testWatch(flow, function () {\n      fs.appendFileSync(files.file2ToWatch, \"ABCDE\");\n    }, results, done);\n  });","file":"nodes/core/storage/23-watch_spec.js","skipped":false,"dir":"test"},{"name":"should define subflow","suites":["subflow"],"updatePoint":{"line":34,"column":27,"index":1121},"line":34,"code":"  it('should define subflow', function (done) {\n    var flow = [{\n      id: \"t1\",\n      type: \"tab\"\n    }, {\n      id: \"n1\",\n      z: \"t1\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      z: \"t1\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      done();\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should pass data to/from subflow","suites":["subflow"],"updatePoint":{"line":77,"column":38,"index":1867},"line":77,"code":"  it('should pass data to/from subflow', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = msg.payload+'bar'; return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"foobar\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should pass data to/from nested subflow","suites":["subflow"],"updatePoint":{"line":141,"column":45,"index":3078},"line":141,"code":"  it('should pass data to/from nested subflow', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = msg.payload+'baz'; return msg;\",\n      wires: []\n    },\n    // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.payload=msg.payload+'bar'; return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"payload\", \"foobarbaz\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of subflow template","suites":["subflow"],"updatePoint":{"line":242,"column":47,"index":4918},"line":242,"code":"  it('should access env var of subflow template', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of subflow instance","suites":["subflow"],"updatePoint":{"line":316,"column":47,"index":6287},"line":316,"code":"  it('should access env var of subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access last env var with same name","suites":["subflow"],"updatePoint":{"line":390,"column":47,"index":7656},"line":390,"code":"  it('should access last env var with same name', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V0\"\n      }, {\n        name: \"X\",\n        type: \"str\",\n        value: \"VX\"\n      }, {\n        name: \"K\",\n        type: \"str\",\n        value: \"V1\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V1\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access typed value of env var","suites":["subflow"],"updatePoint":{"line":472,"column":42,"index":9164},"line":472,"code":"  it('should access typed value of env var', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"KN\",\n        type: \"num\",\n        value: \"100\"\n      }, {\n        name: \"KB\",\n        type: \"bool\",\n        value: \"true\"\n      }, {\n        name: \"KJ\",\n        type: \"json\",\n        value: \"[1,2,3]\"\n      }, {\n        name: \"Kb\",\n        type: \"bin\",\n        value: \"[65,65]\"\n      }, {\n        name: \"Ke\",\n        type: \"env\",\n        value: \"KS\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }],\n      env: [{\n        name: \"KS\",\n        type: \"str\",\n        value: \"STR\"\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.VE = env.get('Ke'); msg.VS = env.get('KS'); msg.VN = env.get('KN'); msg.VB = env.get('KB'); msg.VJ = env.get('KJ'); msg.Vb = env.get('Kb'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"VS\", \"STR\");\n          msg.should.have.property(\"VN\", 100);\n          msg.should.have.property(\"VB\", true);\n          msg.should.have.property(\"VJ\", [1, 2, 3]);\n          msg.should.have.property(\"Vb\");\n          should.ok(msg.Vb instanceof Buffer);\n          msg.should.have.property(\"VE\", \"STR\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should overwrite env var of subflow template by env var of subflow instance","suites":["subflow"],"updatePoint":{"line":572,"column":81,"index":11343},"line":572,"code":"  it('should overwrite env var of subflow template by env var of subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"TV\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of parent subflow template","suites":["subflow"],"updatePoint":{"line":651,"column":54,"index":12803},"line":651,"code":"  it('should access env var of parent subflow template', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    },\n    // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"V\", \"V\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of parent subflow instance","suites":["subflow"],"updatePoint":{"line":757,"column":54,"index":14677},"line":757,"code":"  it('should access env var of parent subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow1\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow1\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n2\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"subflow:s2\",\n      wires: [[\"s1-n2\"]]\n    }, {\n      id: \"s1-n2\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"return msg;\",\n      wires: []\n    },\n    // Subflow2\n    {\n      id: \"s2\",\n      type: \"subflow\",\n      name: \"Subflow2\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s2-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s2-n1\",\n      x: 10,\n      y: 10,\n      z: \"s2\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        msg.should.have.property(\"V\", \"V\");\n        done();\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of tab","suites":["subflow"],"updatePoint":{"line":863,"column":34,"index":16531},"line":863,"code":"  it('should access env var of tab', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of group","suites":["subflow"],"updatePoint":{"line":938,"column":36,"index":17904},"line":938,"code":"  it('should access env var of group', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"g1\",\n      z: \"t0\",\n      type: \"group\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      g: \"g1\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access env var of nested group","suites":["subflow"],"updatePoint":{"line":1018,"column":43,"index":19359},"line":1018,"code":"  it('should access env var of nested group', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"g1\",\n      z: \"t0\",\n      type: \"group\",\n      env: [{\n        name: \"K\",\n        type: \"str\",\n        value: \"V\"\n      }]\n    }, {\n      id: \"g2\",\n      z: \"t0\",\n      g: \"g1\",\n      type: \"group\",\n      env: []\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      g: \"g2\",\n      type: \"subflow:s1\",\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      env: [],\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.V = env.get('K'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"V\", \"V\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"should access NR_NODE_PATH env var within subflow instance","suites":["subflow"],"updatePoint":{"line":1104,"column":64,"index":20925},"line":1104,"code":"  it('should access NR_NODE_PATH env var within subflow instance', function (done) {\n    var flow = [{\n      id: \"t0\",\n      type: \"tab\",\n      label: \"\",\n      disabled: false,\n      info: \"\"\n    }, {\n      id: \"n1\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"subflow:s1\",\n      env: [],\n      wires: [[\"n2\"]]\n    }, {\n      id: \"n2\",\n      x: 10,\n      y: 10,\n      z: \"t0\",\n      type: \"helper\",\n      wires: []\n    },\n    // Subflow\n    {\n      id: \"s1\",\n      type: \"subflow\",\n      name: \"Subflow\",\n      info: \"\",\n      in: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\"\n        }]\n      }],\n      out: [{\n        x: 10,\n        y: 10,\n        wires: [{\n          id: \"s1-n1\",\n          port: 0\n        }]\n      }]\n    }, {\n      id: \"s1-n1\",\n      x: 10,\n      y: 10,\n      z: \"s1\",\n      type: \"function\",\n      func: \"msg.payload = env.get('NR_NODE_PATH'); return msg;\",\n      wires: []\n    }];\n    helper.load(functionNode, flow, function () {\n      var n1 = helper.getNode(\"n1\");\n      var n2 = helper.getNode(\"n2\");\n      n2.on(\"input\", function (msg) {\n        try {\n          msg.should.have.property(\"payload\", \"t0/n1/s1-n1\");\n          done();\n        } catch (e) {\n          console.log(e);\n          done(e);\n        }\n      });\n      n1.receive({\n        payload: \"foo\"\n      });\n    });\n  });","file":"nodes/subflow/subflow_spec.js","skipped":false,"dir":"test"},{"name":"is checking if all .js files have a corresponding _spec.js test file.","suites":["_spec.js"],"updatePoint":{"line":74,"column":75,"index":2761},"line":74,"code":"  it('is checking if all .js files have a corresponding _spec.js test file.', function (done) {\n    walkDirectory(jsdir).then(function (errors) {\n      if (errors.length > 0) {\n        var error = new Error(\"Missing/empty _spec files:\\n\\t\" + errors.join(\"\\n\\t\"));\n        done(error);\n      } else {\n        done();\n      }\n    });\n  });","file":"unit/_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get global contexts","suites":["api/admin/context","get"],"updatePoint":{"line":80,"column":59,"index":2262},"line":80,"code":"    it('should call context.getValue to get global contexts', function (done) {\n      stub.returns(Promise.resolve(gContext));\n      request(app).get('/context/global').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'global');\n        stub.args[0][0].should.have.property('id', undefined);\n        stub.args[0][0].should.have.property('key', undefined);\n        stub.args[0][0].should.have.property('store', undefined);\n        var body = res.body;\n        body.should.eql(gContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get flow contexts","suites":["api/admin/context","get"],"updatePoint":{"line":96,"column":57,"index":2979},"line":96,"code":"    it('should call context.getValue to get flow contexts', function (done) {\n      stub.returns(Promise.resolve(fContext));\n      request(app).get('/context/flow/1234/').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'flow');\n        stub.args[0][0].should.have.property('id', '1234');\n        stub.args[0][0].should.have.property('key', undefined);\n        stub.args[0][0].should.have.property('store', undefined);\n        var body = res.body;\n        body.should.eql(fContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.getValue to get a node context","suites":["api/admin/context","get"],"updatePoint":{"line":112,"column":58,"index":3696},"line":112,"code":"    it('should call context.getValue to get a node context', function (done) {\n      stub.returns(Promise.resolve(nContext));\n      request(app).get('/context/node/5678/foo?store=file').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'node');\n        stub.args[0][0].should.have.property('id', '5678');\n        stub.args[0][0].should.have.property('key', 'foo');\n        stub.args[0][0].should.have.property('store', 'file');\n        var body = res.body;\n        body.should.eql(nContext);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should handle error which context.getValue causes","suites":["api/admin/context","get"],"updatePoint":{"line":128,"column":57,"index":4419},"line":128,"code":"    it('should handle error which context.getValue causes', function (done) {\n      var stubbedResult = Promise.reject('error');\n      stubbedResult.catch(function () {});\n      stub.returns(stubbedResult);\n      request(app).get('/context/global').set('Accept', 'application/json').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('code', 'unexpected_error');\n        res.body.should.has.a.property('message', 'error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a global context","suites":["api/admin/context","delete"],"updatePoint":{"line":154,"column":61,"index":5205},"line":154,"code":"    it('should call context.delete to delete a global context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/global/abc?store=default').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'global');\n        stub.args[0][0].should.have.property('id', undefined);\n        stub.args[0][0].should.have.property('key', 'abc');\n        stub.args[0][0].should.have.property('store', 'default');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a flow context","suites":["api/admin/context","delete"],"updatePoint":{"line":168,"column":59,"index":5835},"line":168,"code":"    it('should call context.delete to delete a flow context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/flow/1234/abc?store=file').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'flow');\n        stub.args[0][0].should.have.property('id', '1234');\n        stub.args[0][0].should.have.property('key', 'abc');\n        stub.args[0][0].should.have.property('store', 'file');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should call context.delete to delete a node context","suites":["api/admin/context","delete"],"updatePoint":{"line":182,"column":59,"index":6457},"line":182,"code":"    it('should call context.delete to delete a node context', function (done) {\n      stub.returns(Promise.resolve());\n      request(app).delete('/context/node/5678/foo?store=file').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        stub.args[0][0].should.have.property('user', undefined);\n        stub.args[0][0].should.have.property('scope', 'node');\n        stub.args[0][0].should.have.property('id', '5678');\n        stub.args[0][0].should.have.property('key', 'foo');\n        stub.args[0][0].should.have.property('store', 'file');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"should handle error which context.delete causes","suites":["api/admin/context","delete"],"updatePoint":{"line":196,"column":55,"index":7075},"line":196,"code":"    it('should handle error which context.delete causes', function (done) {\n      var stubbedResult = Promise.reject('error');\n      stubbedResult.catch(function () {});\n      stub.returns(stubbedResult);\n      request(app).delete('/context/global/abc?store=default').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('code', 'unexpected_error');\n        res.body.should.has.a.property('message', 'error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/context_spec.js","skipped":false,"dir":"test"},{"name":"returns the diagnostics report when explicitly enabled","suites":["api/editor/diagnostics"],"updatePoint":{"line":15,"column":60,"index":573},"line":15,"code":"  it('returns the diagnostics report when explicitly enabled', function (done) {\n    const settings = {\n      diagnostics: {\n        ui: true,\n        enabled: true\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n            try {\n              resolve({\n                opts: opts,\n                a: 1,\n                b: 2\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(200).end(function (err, res) {\n      if (err || typeof res.error === \"object\") {\n        return done(err || res.error);\n      }\n      res.should.have.property(\"statusCode\", 200);\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"returns the diagnostics report when not explicitly enabled (implicitly enabled)","suites":["api/editor/diagnostics"],"updatePoint":{"line":52,"column":85,"index":1612},"line":52,"code":"  it('returns the diagnostics report when not explicitly enabled (implicitly enabled)', function (done) {\n    const settings = {\n      diagnostics: {\n        enabled: undefined\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n            try {\n              resolve({\n                opts: opts,\n                a: 3,\n                b: 4\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(200).end(function (err, res) {\n      if (err || typeof res.error === \"object\") {\n        return done(err || res.error);\n      }\n      res.should.have.property(\"statusCode\", 200);\n      res.body.should.have.property(\"a\", 3);\n      res.body.should.have.property(\"b\", 4);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"should error when setting is disabled","suites":["api/editor/diagnostics"],"updatePoint":{"line":88,"column":43,"index":2596},"line":88,"code":"  it('should error when setting is disabled', function (done) {\n    const settings = {\n      diagnostics: {\n        ui: true,\n        enabled: false\n      }\n    };\n    const runtimeAPI = {\n      diagnostics: {\n        get: async function (opts) {\n          return new Promise(function (resolve, reject) {\n            opts = opts || {};\n            try {\n              resolve({\n                opts: opts\n              });\n            } catch (error) {\n              error.status = 500;\n              reject(error);\n            }\n          });\n        }\n      }\n    };\n    diagnostics.init(settings, runtimeAPI);\n    request(app).get(\"/diagnostics\").expect(403).end(function (err, res) {\n      if (!err && typeof res.error !== \"object\") {\n        return done(new Error(\"accessing diagnostics endpoint while disabled should raise error\"));\n      }\n      res.should.have.property(\"statusCode\", 403);\n      res.body.should.have.property(\"message\", \"diagnostics are disabled\");\n      res.body.should.have.property(\"code\", \"diagnostics.disabled\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"gets a known flow","suites":["api/admin/flow","get"],"updatePoint":{"line":57,"column":25,"index":1819},"line":57,"code":"    it('gets a known flow', function (done) {\n      request(app).get('/flow/123').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"404s an unknown flow","suites":["api/admin/flow","get"],"updatePoint":{"line":66,"column":28,"index":2120},"line":66,"code":"    it('404s an unknown flow', function (done) {\n      request(app).get('/flow/456').set('Accept', 'application/json').expect(404).end(done);\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"adds a new flow","suites":["api/admin/flow","add"],"updatePoint":{"line":91,"column":23,"index":2827},"line":91,"code":"    it('adds a new flow', function (done) {\n      request(app).post('/flow').set('Accept', 'application/json').send({\n        id: '123'\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","add"],"updatePoint":{"line":102,"column":27,"index":3158},"line":102,"code":"    it('400 an invalid flow', function (done) {\n      request(app).post('/flow').set('Accept', 'application/json').send({\n        id: 'error'\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"updates an existing flow","suites":["api/admin/flow","update"],"updatePoint":{"line":136,"column":32,"index":4137},"line":136,"code":"    it('updates an existing flow', function (done) {\n      request(app).put('/flow/123').set('Accept', 'application/json').send({\n        id: '123'\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('id', '123');\n        opts.should.have.property('id', '123');\n        opts.should.have.property('flow', {\n          id: '123'\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","update"],"updatePoint":{"line":151,"column":27,"index":4595},"line":151,"code":"    it('400 an invalid flow', function (done) {\n      request(app).put('/flow/456').set('Accept', 'application/json').send({\n        id: '456'\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"deletes an existing flow","suites":["api/admin/flow","delete"],"updatePoint":{"line":185,"column":32,"index":5570},"line":185,"code":"    it('deletes an existing flow', function (done) {\n      request(app).del('/flow/123').set('Accept', 'application/json').expect(204).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        opts.should.have.property('id', '123');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"400 an invalid flow","suites":["api/admin/flow","delete"],"updatePoint":{"line":194,"column":27,"index":5865},"line":194,"code":"    it('400 an invalid flow', function (done) {\n      request(app).del('/flow/456').set('Accept', 'application/json').expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.has.a.property('code', 'random_error');\n        res.body.should.has.a.property('message', 'random error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/flow_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - v1","suites":["api/admin/flows"],"updatePoint":{"line":34,"column":23,"index":1251},"line":34,"code":"  it('returns flow - v1', function (done) {\n    flows.init({\n      flows: {\n        getFlows: function () {\n          return Promise.resolve({\n            rev: \"123\",\n            flows: [1, 2, 3]\n          });\n        }\n      }\n    });\n    request(app).get('/flows').set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.lengthOf(3);\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - v2","suites":["api/admin/flows"],"updatePoint":{"line":57,"column":23,"index":1777},"line":57,"code":"  it('returns flow - v2', function (done) {\n    flows.init({\n      flows: {\n        getFlows: function () {\n          return Promise.resolve({\n            rev: \"123\",\n            flows: [1, 2, 3]\n          });\n        }\n      }\n    });\n    request(app).get('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'v2').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.a.property('rev', '123');\n        res.body.should.have.a.property('flows');\n        res.body.flows.should.have.lengthOf(3);\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flow - bad version","suites":["api/admin/flows"],"updatePoint":{"line":82,"column":32,"index":2457},"line":82,"code":"  it('returns flow - bad version', function (done) {\n    request(app).get('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'xxx').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.a.property('code', 'invalid_api_version');\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows - default - v1","suites":["api/admin/flows"],"updatePoint":{"line":95,"column":31,"index":2864},"line":95,"code":"  it('sets flows - default - v1', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      setFlows.calledOnce.should.be.true();\n      setFlows.lastCall.args[0].should.have.property('deploymentType', 'full');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows - non-default - v1","suites":["api/admin/flows"],"updatePoint":{"line":113,"column":35,"index":3385},"line":113,"code":"  it('sets flows - non-default - v1', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'nodes').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      setFlows.calledOnce.should.be.true();\n      setFlows.lastCall.args[0].should.have.property('deploymentType', 'nodes');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"set flows - rejects mismatched revision - v2","suites":["api/admin/flows"],"updatePoint":{"line":131,"column":50,"index":3963},"line":131,"code":"  it('set flows - rejects mismatched revision - v2', function (done) {\n    flows.init({\n      flows: {\n        setFlows: function () {\n          var err = new Error(\"mismatch\");\n          err.code = \"version_mismatch\";\n          err.status = 409;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'v2').send({\n      rev: 456,\n      flows: [4, 5, 6]\n    }).expect(409).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property(\"code\", \"version_mismatch\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flow - bad version","suites":["api/admin/flows"],"updatePoint":{"line":155,"column":29,"index":4638},"line":155,"code":"  it('sets flow - bad version', function (done) {\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-API-Version', 'xxx').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.a.property('code', 'invalid_api_version');\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"reloads flows","suites":["api/admin/flows"],"updatePoint":{"line":168,"column":19,"index":5034},"line":168,"code":"  it('reloads flows', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows\n      }\n    });\n    request(app).post('/flows').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'reload').expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      setFlows.called.should.be.true();\n      setFlows.lastCall.args[0].should.not.have.property('flows');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns flows run state","suites":["api/admin/flows"],"updatePoint":{"line":186,"column":29,"index":5574},"line":186,"code":"  it('returns flows run state', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        }\n      }\n    });\n    request(app).get('/flows/state').set('Accept', 'application/json').set('Node-RED-Deployment-Type', 'reload').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.a.property('started', true);\n        res.body.should.have.a.property('state', \"started\");\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows run state - stopped","suites":["api/admin/flows"],"updatePoint":{"line":214,"column":36,"index":6331},"line":214,"code":"  it('sets flows run state - stopped', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    flows.init({\n      flows: {\n        setFlows: setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        },\n        setState: async function () {\n          return {\n            started: false,\n            state: \"stopped\"\n          };\n        }\n      }\n    });\n    request(app).post('/flows/state').set('Accept', 'application/json').send({\n      state: 'stop'\n    }).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        res.body.should.have.a.property('started', false);\n        res.body.should.have.a.property('state', \"stopped\");\n        done();\n      } catch (e) {\n        return done(e);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"sets flows run state - bad value","suites":["api/admin/flows"],"updatePoint":{"line":250,"column":38,"index":7232},"line":250,"code":"  it('sets flows run state - bad value', function (done) {\n    var setFlows = sinon.spy(function () {\n      return Promise.resolve();\n    });\n    const makeError = (error, errcode, statusCode) => {\n      const message = typeof error == \"object\" ? error.message : error;\n      const err = typeof error == \"object\" ? error : new Error(message || \"Unexpected Error\");\n      err.status = err.status || statusCode || 400;\n      err.code = err.code || errcode || \"unexpected_error\";\n      return err;\n    };\n    flows.init({\n      flows: {\n        setFlows: setFlows,\n        getState: async function () {\n          return {\n            started: true,\n            state: \"started\"\n          };\n        },\n        setState: async function () {\n          var err = makeError(\"Cannot set runtime state. Invalid state\", \"invalid_run_state\", 400);\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/flows/state').set('Accept', 'application/json').send({\n      state: 'bad-state'\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property(\"code\", \"invalid_run_state\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/flows_spec.js","skipped":false,"dir":"test"},{"name":"GET /flows","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":99,"column":18,"index":3842},"line":99,"code":"    it('GET /flows', function (done) {\n      request(app).get(\"/flows\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /flows","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":108,"column":19,"index":4108},"line":108,"code":"    it('POST /flows', function (done) {\n      request(app).post(\"/flows\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":117,"column":22,"index":4379},"line":117,"code":"    it('GET /flow/1234', function (done) {\n      request(app).get(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.read', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /flow","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":127,"column":18,"index":4711},"line":127,"code":"    it('POST /flow', function (done) {\n      request(app).post(\"/flow\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":136,"column":25,"index":4984},"line":136,"code":"    it('DELETE /flow/1234', function (done) {\n      request(app).del(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.write', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":146,"column":22,"index":5321},"line":146,"code":"    it('PUT /flow/1234', function (done) {\n      request(app).put(\"/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('flows.write', 1);\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":156,"column":18,"index":5654},"line":156,"code":"    it('GET /nodes', function (done) {\n      request(app).get(\"/nodes\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"POST /nodes","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":165,"column":19,"index":5920},"line":165,"code":"    it('POST /nodes', function (done) {\n      request(app).post(\"/nodes\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":174,"column":25,"index":6194},"line":174,"code":"    it('GET /nodes/module', function (done) {\n      request(app).get(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":184,"column":32,"index":6542},"line":184,"code":"    it('GET /nodes/@scope/module', function (done) {\n      request(app).get(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":194,"column":25,"index":6897},"line":194,"code":"    it('PUT /nodes/module', function (done) {\n      request(app).put(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":204,"column":32,"index":7246},"line":204,"code":"    it('PUT /nodes/@scope/module', function (done) {\n      request(app).put(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /nodes/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":214,"column":28,"index":7605},"line":214,"code":"    it('DELETE /nodes/module', function (done) {\n      request(app).del(\"/nodes/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /nodes/@scope/module","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":224,"column":35,"index":7957},"line":224,"code":"    it('DELETE /nodes/@scope/module', function (done) {\n      request(app).del(\"/nodes/@scope/module\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":234,"column":29,"index":8317},"line":234,"code":"    it('GET /nodes/module/set', function (done) {\n      request(app).get(\"/nodes/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":245,"column":36,"index":8732},"line":245,"code":"    it('GET /nodes/@scope/module/set', function (done) {\n      request(app).get(\"/nodes/@scope/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":256,"column":29,"index":9154},"line":256,"code":"    it('PUT /nodes/module/set', function (done) {\n      request(app).put(\"/nodes/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, 'module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"PUT /nodes/@scope/module/set","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":267,"column":36,"index":9570},"line":267,"code":"    it('PUT /nodes/@scope/module/set', function (done) {\n      request(app).put(\"/nodes/@scope/module/set\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.write', 1);\n        lastRequest.params.should.have.property(0, '@scope/module');\n        lastRequest.params.should.have.property(2, 'set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":278,"column":27,"index":9991},"line":278,"code":"    it('GET /nodes/messages', function (done) {\n      request(app).get(\"/nodes/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/module/set/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":287,"column":38,"index":10285},"line":287,"code":"    it('GET /nodes/module/set/messages', function (done) {\n      request(app).get(\"/nodes/module/set/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, 'module/set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /nodes/@scope/module/set/messages","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":297,"column":45,"index":10663},"line":297,"code":"    it('GET /nodes/@scope/module/set/messages', function (done) {\n      request(app).get(\"/nodes/@scope/module/set/messages\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('nodes.read', 1);\n        lastRequest.params.should.have.property(0, '@scope/module/set');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/global","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":307,"column":27,"index":11037},"line":307,"code":"    it('GET /context/global', function (done) {\n      request(app).get(\"/context/global\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/global/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":317,"column":44,"index":11407},"line":317,"code":"    it('GET /context/global/key?store=memory', function (done) {\n      request(app).get(\"/context/global/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/flow/1234","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":329,"column":30,"index":11906},"line":329,"code":"    it('GET /context/flow/1234', function (done) {\n      request(app).get(\"/context/flow/1234\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/flow/1234/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":340,"column":47,"index":12343},"line":340,"code":"    it('GET /context/flow/1234/key?store=memory', function (done) {\n      request(app).get(\"/context/flow/1234/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/node/5678","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":353,"column":30,"index":12906},"line":353,"code":"    it('GET /context/node/5678', function (done) {\n      request(app).get(\"/context/node/5678\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"GET /context/node/5678/foo?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":364,"column":47,"index":13343},"line":364,"code":"    it('GET /context/node/5678/foo?store=memory', function (done) {\n      request(app).get(\"/context/node/5678/foo?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.read', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        lastRequest.params.should.have.property(0, 'foo');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/global/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":377,"column":47,"index":13923},"line":377,"code":"    it('DELETE /context/global/key?store=memory', function (done) {\n      request(app).del(\"/context/global/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'global');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/flow/1234/key?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":389,"column":50,"index":14443},"line":389,"code":"    it('DELETE /context/flow/1234/key?store=memory', function (done) {\n      request(app).del(\"/context/flow/1234/key?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'flow');\n        lastRequest.params.should.have.property('id', '1234');\n        lastRequest.params.should.have.property(0, 'key');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /context/node/5678/foo?store=memory","suites":["api/admin/index","Ensure all API routes are correctly mounted, with the expected permissions checks"],"updatePoint":{"line":402,"column":50,"index":15027},"line":402,"code":"    it('DELETE /context/node/5678/foo?store=memory', function (done) {\n      request(app).del(\"/context/node/5678/foo?store=memory\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        permissionChecks.should.have.property('context.write', 1);\n        lastRequest.params.should.have.property('scope', 'node');\n        lastRequest.params.should.have.property('id', '5678');\n        lastRequest.params.should.have.property(0, 'foo');\n        lastRequest.query.should.have.property('store', 'memory');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/index_spec.js","skipped":false,"dir":"test"},{"name":"returns node list","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":48,"column":25,"index":1977},"line":48,"code":"    it('returns node list', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeList: function () {\n            return Promise.resolve([1, 2, 3]);\n          }\n        }\n      });\n      request(app).get('/nodes').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.be.an.Array();\n        res.body.should.have.lengthOf(3);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node configs","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":66,"column":28,"index":2470},"line":66,"code":"    it('returns node configs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeConfigs: function () {\n            return Promise.resolve(\"<script></script>\");\n          }\n        },\n        i18n: {\n          determineLangFromHeaders: function () {}\n        }\n      });\n      request(app).get('/nodes').set('Accept', 'text/html').expect(200).expect(\"<script></script>\").end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node module info","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":85,"column":32,"index":2998},"line":85,"code":"    it('returns node module info', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleInfo: function (opts) {\n            return Promise.resolve({\n              \"node-red\": {\n                name: \"node-red\"\n              }\n            }[opts.module]);\n          }\n        }\n      });\n      request(app).get('/nodes/node-red').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"name\", \"node-red\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 for unknown module","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":106,"column":38,"index":3556},"line":106,"code":"    it('returns 404 for unknown module', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleInfo: function (opts) {\n            var errInstance = new Error(\"Not Found\");\n            errInstance.code = \"not_found\";\n            errInstance.status = 404;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).get('/nodes/node-blue').expect(404).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns individual node info","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":127,"column":36,"index":4149},"line":127,"code":"    it('returns individual node info', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeInfo: function (opts) {\n            return Promise.resolve({\n              \"node-red/123\": {\n                id: \"node-red/123\"\n              }\n            }[opts.id]);\n          }\n        }\n      });\n      request(app).get('/nodes/node-red/123').set('Accept', 'application/json').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"id\", \"node-red/123\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns individual node configs","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":148,"column":39,"index":4748},"line":148,"code":"    it('returns individual node configs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeConfig: function (opts) {\n            return Promise.resolve({\n              \"node-red/123\": \"<script></script>\"\n            }[opts.id]);\n          }\n        },\n        i18n: {\n          determineLangFromHeaders: function () {}\n        }\n      });\n      request(app).get('/nodes/node-red/123').set('Accept', 'text/html').expect(200).expect(\"<script></script>\").end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 for unknown node","suites":["api/admin/nodes","get nodes"],"updatePoint":{"line":169,"column":36,"index":5351},"line":169,"code":"    it('returns 404 for unknown node', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getNodeInfo: function (opts) {\n            var errInstance = new Error(\"Not Found\");\n            errInstance.code = \"not_found\";\n            errInstance.status = 404;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).get('/nodes/node-red/456').set('Accept', 'application/json').expect(404).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"installs the module and returns module info","suites":["api/admin/nodes","install"],"updatePoint":{"line":192,"column":51,"index":6036},"line":192,"code":"    it('installs the module and returns module info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          addModule: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              name: \"foo\",\n              nodes: [{\n                id: \"123\"\n              }]\n            });\n          }\n        }\n      });\n      request(app).post('/nodes').send({\n        module: 'foo',\n        version: \"1.2.3\",\n        url: \"https://example/foo-1.2.3.tgz\"\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"name\", \"foo\");\n        res.body.should.have.property(\"nodes\");\n        res.body.nodes[0].should.have.property(\"id\", \"123\");\n        opts.should.have.property(\"module\", \"foo\");\n        opts.should.have.property(\"version\", \"1.2.3\");\n        opts.should.have.property(\"url\", \"https://example/foo-1.2.3.tgz\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns error","suites":["api/admin/nodes","install"],"updatePoint":{"line":225,"column":21,"index":7008},"line":225,"code":"    it('returns error', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          addModule: function (opts) {\n            var errInstance = new Error(\"Message\");\n            errInstance.code = \"random_error\";\n            errInstance.status = 400;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).post('/nodes').send({\n        module: 'foo',\n        version: \"1.2.3\",\n        url: \"https://example/foo-1.2.3.tgz\"\n      }).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.a.property('code', 'random_error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"uninstalls the module","suites":["api/admin/nodes","delete"],"updatePoint":{"line":253,"column":29,"index":7798},"line":253,"code":"    it('uninstalls the module', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          removeModule: function (_opts) {\n            opts = _opts;\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).del('/nodes/123').expect(204).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        opts.should.have.property(\"module\", \"123\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns error","suites":["api/admin/nodes","delete"],"updatePoint":{"line":272,"column":21,"index":8264},"line":272,"code":"    it('returns error', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          removeModule: function (opts) {\n            var errInstance = new Error(\"Message\");\n            errInstance.code = \"random_error\";\n            errInstance.status = 400;\n            var p = Promise.reject(errInstance);\n            p.catch(() => {});\n            return p;\n          }\n        }\n      });\n      request(app).del('/nodes/123').expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.a.property('code', 'random_error');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 400 for invalid request payload","suites":["api/admin/nodes","enable/disable node set"],"updatePoint":{"line":296,"column":47,"index":8985},"line":296,"code":"    it('returns 400 for invalid request payload', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          setNodeSetState: function (opts) {\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).put('/nodes/node-red/foo').send({}).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"code\", \"invalid_request\");\n        res.body.should.have.property(\"message\", \"Invalid request\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"sets node state and returns node info","suites":["api/admin/nodes","enable/disable node set"],"updatePoint":{"line":314,"column":45,"index":9536},"line":314,"code":"    it('sets node state and returns node info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          setNodeSetState: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              id: \"123\",\n              enabled: true\n            });\n          }\n        }\n      });\n      request(app).put('/nodes/node-red/foo').send({\n        enabled: true\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"id\", \"123\");\n        res.body.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"id\", \"node-red/foo\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 400 for invalid request payload","suites":["api/admin/nodes","enable/disable module"],"updatePoint":{"line":343,"column":47,"index":10367},"line":343,"code":"    it('returns 400 for invalid request payload', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          setModuleState: function (opts) {\n            return Promise.resolve();\n          }\n        }\n      });\n      request(app).put('/nodes/node-red').send({}).expect(400).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"code\", \"invalid_request\");\n        res.body.should.have.property(\"message\", \"Invalid request\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"sets module state and returns module info","suites":["api/admin/nodes","enable/disable module"],"updatePoint":{"line":361,"column":49,"index":10917},"line":361,"code":"    it('sets module state and returns module info', function (done) {\n      var opts;\n      nodes.init({\n        settings: {},\n        nodes: {\n          setModuleState: function (_opts) {\n            opts = _opts;\n            return Promise.resolve({\n              name: \"node-red\"\n            });\n          }\n        }\n      });\n      request(app).put('/nodes/node-red').send({\n        enabled: true\n      }).expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"name\", \"node-red\");\n        opts.should.have.property(\"enabled\", true);\n        opts.should.have.property(\"module\", \"node-red\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns icon list","suites":["api/admin/nodes","get icons"],"updatePoint":{"line":388,"column":25,"index":11638},"line":388,"code":"    it('returns icon list', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getIconList: function () {\n            return Promise.resolve({\n              module: [1, 2, 3]\n            });\n          }\n        }\n      });\n      request(app).get('/getIcons').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.have.property(\"module\");\n        res.body.module.should.be.an.Array();\n        res.body.module.should.have.lengthOf(3);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns message catalog","suites":["api/admin/nodes","get module messages"],"updatePoint":{"line":411,"column":31,"index":12258},"line":411,"code":"    it('returns message catalog', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleCatalog: function (opts) {\n            return Promise.resolve({\n              a: 123\n            });\n          }\n        }\n      });\n      request(app).get('/nodes/module/set/messages').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.eql({\n          a: 123\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns all node catalogs","suites":["api/admin/nodes","get module messages"],"updatePoint":{"line":432,"column":33,"index":12756},"line":432,"code":"    it('returns all node catalogs', function (done) {\n      nodes.init({\n        settings: {},\n        nodes: {\n          getModuleCatalogs: function (opts) {\n            return Promise.resolve({\n              a: 1\n            });\n          }\n        }\n      });\n      request(app).get('/nodes/messages').expect(200).end(function (err, res) {\n        if (err) {\n          throw err;\n        }\n        res.body.should.eql({\n          a: 1\n        });\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/admin/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns the list of plugins","suites":["api/editor/plugins"],"updatePoint":{"line":59,"column":33,"index":1517},"line":59,"code":"  it('returns the list of plugins', function (done) {\n    request(app).get(\"/plugins\").set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        JSON.stringify(res.body).should.eql(JSON.stringify(pluginList));\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the plugin configs","suites":["api/editor/plugins"],"updatePoint":{"line":72,"column":32,"index":1890},"line":72,"code":"  it('returns the plugin configs', function (done) {\n    request(app).get(\"/plugins\").set('Accept', 'text/html').expect(200).expect(pluginConfigs).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the plugin catalogs","suites":["api/editor/plugins"],"updatePoint":{"line":80,"column":33,"index":2143},"line":80,"code":"  it('returns the plugin catalogs', function (done) {\n    request(app).get(\"/plugins/messages\").set('Accept', 'application/json').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        JSON.stringify(res.body).should.eql(JSON.stringify(pluginCatalogs));\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns the runtime settings","suites":["api/editor/settings"],"updatePoint":{"line":41,"column":34,"index":1417},"line":41,"code":"  it('returns the runtime settings', function (done) {\n    info.init({}, {\n      settings: {\n        getRuntimeSettings: function (opts) {\n          return Promise.resolve({\n            a: 1,\n            b: 2,\n            editorTheme: {\n              existing: 789\n            }\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2);\n      res.body.should.have.property(\"editorTheme\", {\n        existing: 789,\n        test: 456\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the runtime settings - disableEditor true","suites":["api/editor/settings"],"updatePoint":{"line":68,"column":55,"index":2102},"line":68,"code":"  it('returns the runtime settings - disableEditor true', function (done) {\n    info.init({\n      disableEditor: true\n    }, {\n      settings: {\n        getRuntimeSettings: function (opts) {\n          return Promise.resolve({\n            a: 1,\n            b: 2\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property(\"a\", 1);\n      res.body.should.have.property(\"b\", 2);\n      // no editorTheme if disabledEditor true\n      res.body.should.not.have.property(\"editorTheme\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/admin/settings_spec.js","skipped":false,"dir":"test"},{"name":"finds the known editor client","suites":["api/auth/clients"],"updatePoint":{"line":21,"column":35,"index":871},"line":21,"code":"  it('finds the known editor client', function (done) {\n    Clients.get(\"node-red-editor\").then(function (client) {\n      client.should.have.property(\"id\", \"node-red-editor\");\n      client.should.have.property(\"secret\", \"not_available\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"finds the known admin client","suites":["api/auth/clients"],"updatePoint":{"line":28,"column":34,"index":1136},"line":28,"code":"  it('finds the known admin client', function (done) {\n    Clients.get(\"node-red-admin\").then(function (client) {\n      client.should.have.property(\"id\", \"node-red-admin\");\n      client.should.have.property(\"secret\", \"not_available\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"returns null for unknown client","suites":["api/auth/clients"],"updatePoint":{"line":37,"column":37,"index":1449},"line":37,"code":"  it('returns null for unknown client', function (done) {\n    Clients.get(\"unknown-client\").then(function (client) {\n      should.not.exist(client);\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/editor-api/lib/auth/clients_spec.js","skipped":false,"dir":"test"},{"name":"leaves client_secret alone if not present","suites":["api/auth/index","ensureClientSecret"],"updatePoint":{"line":30,"column":49,"index":1279},"line":30,"code":"    it(\"leaves client_secret alone if not present\", function (done) {\n      var req = {\n        body: {\n          client_secret: \"test_value\"\n        }\n      };\n      auth.ensureClientSecret(req, null, function () {\n        req.body.should.have.a.property(\"client_secret\", \"test_value\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"applies a default client_secret if not present","suites":["api/auth/index","ensureClientSecret"],"updatePoint":{"line":41,"column":54,"index":1606},"line":41,"code":"    it(\"applies a default client_secret if not present\", function (done) {\n      var req = {\n        body: {}\n      };\n      auth.ensureClientSecret(req, null, function () {\n        req.body.should.have.a.property(\"client_secret\", \"not_available\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"revokes a token","suites":["api/auth/index","revoke"],"updatePoint":{"line":52,"column":23,"index":1899},"line":52,"code":"    it(\"revokes a token\", function (done) {\n      var revokeToken = sinon.stub(Tokens, \"revoke\").callsFake(function () {\n        return Promise.resolve();\n      });\n      var req = {\n        body: {\n          token: \"abcdef\"\n        }\n      };\n      var res = {\n        status: function (resp) {\n          revokeToken.restore();\n          resp.should.equal(200);\n          return {\n            end: done\n          };\n        }\n      };\n      auth.revoke(req, res);\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - credentials","suites":["api/auth/index","login"],"updatePoint":{"line":82,"column":43,"index":2681},"line":82,"code":"    it(\"returns login details - credentials\", function (done) {\n      auth.init({\n        adminAuth: {\n          type: \"credentials\"\n        }\n      }, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.have.a.property(\"type\", \"credentials\");\n          resp.should.have.a.property(\"prompts\");\n          resp.prompts.should.have.a.lengthOf(2);\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - none","suites":["api/auth/index","login"],"updatePoint":{"line":97,"column":36,"index":3096},"line":97,"code":"    it(\"returns login details - none\", function (done) {\n      auth.init({}, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.eql({});\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"returns login details - strategy","suites":["api/auth/index","login"],"updatePoint":{"line":106,"column":40,"index":3316},"line":106,"code":"    it(\"returns login details - strategy\", function (done) {\n      auth.init({\n        adminAuth: {\n          type: \"strategy\",\n          strategy: {\n            label: \"test-strategy\",\n            icon: \"test-icon\"\n          }\n        }\n      }, {});\n      auth.login(null, {\n        json: function (resp) {\n          resp.should.have.a.property(\"type\", \"strategy\");\n          resp.should.have.a.property(\"prompts\");\n          resp.prompts.should.have.a.lengthOf(1);\n          resp.prompts[0].should.have.a.property(\"type\", \"button\");\n          resp.prompts[0].should.have.a.property(\"label\", \"test-strategy\");\n          resp.prompts[0].should.have.a.property(\"icon\", \"test-icon\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"no-ops if adminAuth not set","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":144,"column":35,"index":4531},"line":144,"code":"    it('no-ops if adminAuth not set', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {};\n      });\n      auth.init({});\n      var func = auth.needsPermission(\"foo\");\n      func({}, {}, function () {\n        passport.authenticate.called.should.be.false();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"skips auth if req.user undefined","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":155,"column":40,"index":4916},"line":155,"code":"    it('skips auth if req.user undefined', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return true;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: null\n      }, {}, function () {\n        try {\n          passport.authenticate.called.should.be.true();\n          Permissions.hasPermission.called.should.be.false();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"passes for valid user permission","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":180,"column":40,"index":5623},"line":180,"code":"    it('passes for valid user permission', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return true;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: true,\n        authInfo: {\n          scope: \"read\"\n        }\n      }, {}, function () {\n        try {\n          passport.authenticate.called.should.be.true();\n          Permissions.hasPermission.called.should.be.true();\n          Permissions.hasPermission.lastCall.args[0].should.eql(\"read\");\n          Permissions.hasPermission.lastCall.args[1].should.eql(\"foo\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects for invalid user permission","suites":["api/auth/index","needsPermission"],"updatePoint":{"line":210,"column":43,"index":6532},"line":210,"code":"    it('rejects for invalid user permission', function (done) {\n      sinon.stub(passport, \"authenticate\").callsFake(function (scopes, opts) {\n        return function (req, res, next) {\n          next();\n        };\n      });\n      sinon.stub(Permissions, \"hasPermission\").callsFake(function (perm) {\n        return false;\n      });\n      auth.init({\n        adminAuth: {}\n      });\n      var func = auth.needsPermission(\"foo\");\n      func({\n        user: true,\n        authInfo: {\n          scope: \"read\"\n        }\n      }, {\n        status: function (status) {\n          return {\n            end: function () {\n              try {\n                status.should.eql(401);\n                done();\n              } catch (err) {\n                done(err);\n              }\n            }\n          };\n        }\n      }, function () {\n        done(new Error(\"hasPermission unexpected passed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/index_spec.js","skipped":false,"dir":"test"},{"name":"a user with no permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":22,"column":34,"index":924},"line":22,"code":"    it('a user with no permissions', function () {\n      permissions.hasPermission([], \"*\").should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with global permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":25,"column":38,"index":1047},"line":25,"code":"    it('a user with global permissions', function () {\n      permissions.hasPermission(\"*\", \"read\").should.be.true();\n      permissions.hasPermission([\"*\"], \"write\").should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with read permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":29,"column":36,"index":1237},"line":29,"code":"    it('a user with read permissions', function () {\n      permissions.hasPermission([\"read\"], \"read\").should.be.true();\n      permissions.hasPermission([\"read\"], \"node.read\").should.be.true();\n      permissions.hasPermission([\"read\"], \"write\").should.be.false();\n      permissions.hasPermission([\"read\"], \"node.write\").should.be.false();\n      permissions.hasPermission([\"*.read\"], \"read\").should.be.true();\n      permissions.hasPermission([\"*.read\"], \"node.read\").should.be.true();\n      permissions.hasPermission([\"*.read\"], \"write\").should.be.false();\n      permissions.hasPermission([\"*.read\"], \"node.write\").should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"a user with foo permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":39,"column":35,"index":1877},"line":39,"code":"    it('a user with foo permissions', function () {\n      permissions.hasPermission(\"foo\", \"foo\").should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"an array of permissions","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":42,"column":31,"index":1997},"line":42,"code":"    it('an array of permissions', function () {\n      permissions.hasPermission([\"*\"], [\"foo.read\", \"foo.write\"]).should.be.true();\n      permissions.hasPermission(\"read\", [\"foo.read\", \"foo.write\"]).should.be.false();\n      permissions.hasPermission(\"read\", [\"foo.read\", \"bar.read\"]).should.be.true();\n      permissions.hasPermission([\"flows.read\"], [\"flows.read\"]).should.be.true();\n      permissions.hasPermission([\"flows.read\"], [\"flows.write\"]).should.be.false();\n      permissions.hasPermission([\"flows.read\", \"nodes.write\"], [\"flows.write\"]).should.be.false();\n      permissions.hasPermission([\"flows.read\", \"nodes.write\"], [\"nodes.write\"]).should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"permits an empty permission","suites":["api/auth/permissions","hasPermission"],"updatePoint":{"line":51,"column":35,"index":2674},"line":51,"code":"    it('permits an empty permission', function () {\n      permissions.hasPermission(\"*\", \"\").should.be.true();\n      permissions.hasPermission(\"read\", [\"\"]).should.be.true();\n    });","file":"unit/@node-red/editor-api/lib/auth/permissions_spec.js","skipped":false,"dir":"test"},{"name":"Handles authentication failure","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":33,"column":38,"index":1370},"line":33,"code":"    it('Handles authentication failure', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve(null);\n      });\n      strategies.passwordTokenExchange({}, \"user\", \"password\", \"scope\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Handles scope overreach","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":47,"column":31,"index":1838},"line":47,"code":"    it('Handles scope overreach', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"read\"\n        });\n      });\n      strategies.passwordTokenExchange({}, \"user\", \"password\", \"*\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Creates new token on authentication success","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":64,"column":51,"index":2387},"line":64,"code":"    it('Creates new token on authentication success', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"*\"\n        });\n      });\n      var tokenDetails = {};\n      var tokenCreate = sinon.stub(Tokens, \"create\").callsFake(function (username, client, scope) {\n        tokenDetails.username = username;\n        tokenDetails.client = client;\n        tokenDetails.scope = scope;\n        return Promise.resolve({\n          accessToken: \"123456\"\n        });\n      });\n      strategies.passwordTokenExchange({\n        id: \"myclient\"\n      }, \"user\", \"password\", \"read\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.equal(\"123456\");\n          tokenDetails.should.have.property(\"username\", \"user\");\n          tokenDetails.should.have.property(\"client\", \"myclient\");\n          tokenDetails.should.have.property(\"scope\", \"read\");\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          tokenCreate.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Uses provided token on authentication success and token provided","suites":["api/auth/strategies","Password Token Exchange"],"updatePoint":{"line":97,"column":72,"index":3571},"line":97,"code":"    it('Uses provided token on authentication success and token provided', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve({\n          username: \"user\",\n          permissions: \"*\",\n          token: \"123456\"\n        });\n      });\n      strategies.passwordTokenExchange({\n        id: \"myclient\"\n      }, \"user\", \"password\", \"read\", function (err, token) {\n        try {\n          should.not.exist(err);\n          token.should.equal(\"123456\");\n          done();\n        } catch (e) {\n          done(e);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if anon user enabled","suites":["api/auth/strategies","Anonymous Strategy"],"updatePoint":{"line":119,"column":37,"index":4221},"line":119,"code":"    it('Succeeds if anon user enabled', function (done) {\n      var userDefault = sinon.stub(Users, \"default\").callsFake(function () {\n        return Promise.resolve(\"anon\");\n      });\n      strategies.anonymousStrategy._success = strategies.anonymousStrategy.success;\n      strategies.anonymousStrategy.success = function (user) {\n        user.should.equal(\"anon\");\n        strategies.anonymousStrategy.success = strategies.anonymousStrategy._success;\n        delete strategies.anonymousStrategy._success;\n        done();\n      };\n      strategies.anonymousStrategy.authenticate({});\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fails if anon user not enabled","suites":["api/auth/strategies","Anonymous Strategy"],"updatePoint":{"line":132,"column":38,"index":4815},"line":132,"code":"    it('Fails if anon user not enabled', function (done) {\n      var userDefault = sinon.stub(Users, \"default\").callsFake(function () {\n        return Promise.resolve(null);\n      });\n      strategies.anonymousStrategy._fail = strategies.anonymousStrategy.fail;\n      strategies.anonymousStrategy.fail = function (err) {\n        err.should.equal(401);\n        strategies.anonymousStrategy.fail = strategies.anonymousStrategy._fail;\n        delete strategies.anonymousStrategy._fail;\n        done();\n      };\n      strategies.anonymousStrategy.authenticate({});\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if tokens user enabled custom header","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":150,"column":53,"index":5516},"line":150,"code":"    it('Succeeds if tokens user enabled custom header', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function (token) {\n        return Promise.resolve(\"tokens-\" + token);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"x-test-token\";\n      });\n      strategies.tokensStrategy._success = strategies.tokensStrategy.success;\n      strategies.tokensStrategy.success = function (user) {\n        user.should.equal(\"tokens-1234\");\n        strategies.tokensStrategy.success = strategies.tokensStrategy._success;\n        delete strategies.tokensStrategy._success;\n        done();\n      };\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"x-test-token\": \"1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Succeeds if tokens user enabled default header","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":170,"column":54,"index":6326},"line":170,"code":"    it('Succeeds if tokens user enabled default header', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function (token) {\n        return Promise.resolve(\"tokens-\" + token);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"authorization\";\n      });\n      strategies.tokensStrategy._success = strategies.tokensStrategy.success;\n      strategies.tokensStrategy.success = function (user) {\n        user.should.equal(\"tokens-1234\");\n        strategies.tokensStrategy.success = strategies.tokensStrategy._success;\n        delete strategies.tokensStrategy._success;\n        done();\n      };\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"authorization\": \"Bearer 1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fails if tokens user not enabled","suites":["api/auth/strategies","Tokens Strategy"],"updatePoint":{"line":190,"column":40,"index":7131},"line":190,"code":"    it('Fails if tokens user not enabled', function (done) {\n      var userTokens = sinon.stub(Users, \"tokens\").callsFake(function () {\n        return Promise.resolve(null);\n      });\n      var userTokenHeader = sinon.stub(Users, \"tokenHeader\").callsFake(function (token) {\n        return \"authorization\";\n      });\n      strategies.tokensStrategy._fail = strategies.tokensStrategy.fail;\n      strategies.tokensStrategy.fail = function (err) {\n        err.should.equal(401);\n        strategies.tokensStrategy.fail = strategies.tokensStrategy._fail;\n        delete strategies.tokensStrategy._fail;\n        done();\n      };\n      strategies.tokensStrategy.authenticate({\n        headers: {\n          \"authorization\": \"Bearer 1234\"\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":216,"column":29,"index":8028},"line":216,"code":"    it('Rejects invalid token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve(null);\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user) {\n        try {\n          should.not.exist(err);\n          user.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Accepts valid token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":232,"column":27,"index":8481},"line":232,"code":"    it('Accepts valid token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve({\n          user: \"user\",\n          scope: \"scope\"\n        });\n      });\n      var getUser = sinon.stub(Users, \"get\").callsFake(function (username) {\n        return Promise.resolve(\"aUser\");\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user, opts) {\n        try {\n          should.not.exist(err);\n          user.should.equal(\"aUser\");\n          opts.should.have.a.property(\"scope\", \"scope\");\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n          getUser.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Fail if no user for token","suites":["api/auth/strategies","Bearer Strategy"],"updatePoint":{"line":256,"column":33,"index":9220},"line":256,"code":"    it('Fail if no user for token', function (done) {\n      var getToken = sinon.stub(Tokens, \"get\").callsFake(function (token) {\n        return Promise.resolve({\n          user: \"user\",\n          scope: \"scope\"\n        });\n      });\n      var getUser = sinon.stub(Users, \"get\").callsFake(function (username) {\n        return Promise.resolve(null);\n      });\n      strategies.bearerStrategy(\"1234\", function (err, user, opts) {\n        try {\n          should.not.exist(err);\n          user.should.equal(false);\n          should.not.exist(opts);\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getToken.restore();\n          getUser.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Accepts valid client","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":282,"column":28,"index":9985},"line":282,"code":"    it('Accepts valid client', function (done) {\n      var testClient = {\n        id: \"node-red-editor\",\n        secret: \"not_available\"\n      };\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(testClient);\n      });\n      strategies.clientPasswordStrategy(testClient.id, testClient.secret, function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.eql(testClient);\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid client secret","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":302,"column":37,"index":10598},"line":302,"code":"    it('Rejects invalid client secret', function (done) {\n      var testClient = {\n        id: \"node-red-editor\",\n        secret: \"not_available\"\n      };\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(testClient);\n      });\n      strategies.clientPasswordStrategy(testClient.id, \"invalid_secret\", function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Rejects invalid client id","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":322,"column":33,"index":11201},"line":322,"code":"    it('Rejects invalid client id', function (done) {\n      var getClient = sinon.stub(Clients, \"get\").callsFake(function (client) {\n        return Promise.resolve(null);\n      });\n      strategies.clientPasswordStrategy(\"invalid_id\", \"invalid_secret\", function (err, client) {\n        try {\n          should.not.exist(err);\n          client.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          getClient.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"Blocks after 5 failures","suites":["api/auth/strategies","Client Password Strategy"],"updatePoint":{"line":339,"column":31,"index":11726},"line":339,"code":"    it('Blocks after 5 failures', function (done) {\n      userAuthentication = sinon.stub(Users, \"authenticate\").callsFake(function (username, password) {\n        return Promise.resolve(null);\n      });\n      for (var z = 0; z < 5; z++) {\n        strategies.passwordTokenExchange({}, \"user\", \"badpassword\", \"scope\", function (err, token) {});\n      }\n      strategies.passwordTokenExchange({}, \"user\", \"badpassword\", \"scope\", function (err, token) {\n        try {\n          err.toString().should.equal(\"Error: Too many login attempts. Wait 10 minutes and try again\");\n          token.should.be.false();\n          done();\n        } catch (e) {\n          done(e);\n        } finally {\n          userAuthentication.restore();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/strategies_spec.js","skipped":false,"dir":"test"},{"name":"loads sessions","suites":["api/auth/tokens","#init"],"updatePoint":{"line":23,"column":22,"index":919},"line":23,"code":"    it('loads sessions', function (done) {\n      Tokens.init({}).then(done);\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":28,"column":29,"index":1050},"line":28,"code":"    it('returns a valid token', function (done) {\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": Date.now() + 1000\n            }\n          });\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            token.should.have.a.property(\"user\", \"fred\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns null for an invalid token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":49,"column":41,"index":1603},"line":49,"code":"    it('returns null for an invalid token', function (done) {\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({});\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            should.not.exist(token);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns null for an expired token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":65,"column":41,"index":2015},"line":65,"code":"    it('returns null for an expired token', function (done) {\n      var saveSessions = sinon.stub().returns(Promise.resolve());\n      var expiryTime = Date.now() + 50;\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": expiryTime\n            }\n          });\n        },\n        saveSessions: saveSessions\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            should.exist(token);\n            setTimeout(function () {\n              Tokens.get(\"1234\").then(function (token) {\n                try {\n                  should.not.exist(token);\n                  saveSessions.calledOnce.should.be.true();\n                  done();\n                } catch (err) {\n                  done(err);\n                }\n              });\n            }, 100);\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid api token","suites":["api/auth/tokens","#get"],"updatePoint":{"line":99,"column":33,"index":3013},"line":99,"code":"    it('returns a valid api token', function (done) {\n      Tokens.init({\n        tokens: [{\n          token: \"1234\",\n          user: \"fred\"\n        }]\n      }, {\n        getSessions: function () {\n          return Promise.resolve({});\n        }\n      }).then(function () {\n        Tokens.get(\"1234\").then(function (token) {\n          try {\n            token.should.have.a.property(\"user\", \"fred\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"creates a token","suites":["api/auth/tokens","#create"],"updatePoint":{"line":122,"column":23,"index":3555},"line":122,"code":"    it('creates a token', function (done) {\n      var savedSession;\n      Tokens.init({\n        sessionExpiryTime: 10\n      }, {\n        getSessions: function () {\n          return Promise.resolve({});\n        },\n        saveSessions: function (sess) {\n          savedSession = sess;\n          return Promise.resolve();\n        }\n      });\n      var expectedExpiryTime = Date.now() + 10000;\n      Tokens.create(\"user\", \"client\", \"scope\").then(function (token) {\n        try {\n          should.exist(savedSession);\n          var sessionKeys = Object.keys(savedSession);\n          sessionKeys.should.have.lengthOf(1);\n          token.should.have.a.property('accessToken', sessionKeys[0]);\n          savedSession[sessionKeys[0]].should.have.a.property('user', 'user');\n          savedSession[sessionKeys[0]].should.have.a.property('client', 'client');\n          savedSession[sessionKeys[0]].should.have.a.property('scope', 'scope');\n          savedSession[sessionKeys[0]].should.have.a.property('expires');\n          savedSession[sessionKeys[0]].expires.should.be.within(expectedExpiryTime - 200, expectedExpiryTime + 200);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"revokes a token","suites":["api/auth/tokens","#revoke"],"updatePoint":{"line":155,"column":23,"index":4809},"line":155,"code":"    it('revokes a token', function (done) {\n      var savedSession;\n      Tokens.init({}, {\n        getSessions: function () {\n          return Promise.resolve({\n            \"1234\": {\n              \"user\": \"fred\",\n              \"expires\": Date.now() + 1000\n            }\n          });\n        },\n        saveSessions: function (sess) {\n          savedSession = sess;\n          return Promise.resolve();\n        }\n      }).then(function () {\n        Tokens.revoke(\"1234\").then(function () {\n          try {\n            savedSession.should.not.have.a.property(\"1234\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n    });","file":"unit/@node-red/editor-api/lib/auth/tokens_spec.js","skipped":false,"dir":"test"},{"name":"returns known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#get"],"updatePoint":{"line":38,"column":28,"index":1374},"line":38,"code":"      it('returns known user', function (done) {\n        Users.get(\"fred\").then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"fred\");\n            user.should.have.a.property(\"permissions\", \"*\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for unknown user","suites":["api/auth/users","Initalised with a credentials object, no anon","#get"],"updatePoint":{"line":50,"column":39,"index":1781},"line":50,"code":"      it('returns null for unknown user', function (done) {\n        Users.get(\"barney\").then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for default user","suites":["api/auth/users","Initalised with a credentials object, no anon","#default"],"updatePoint":{"line":62,"column":39,"index":2094},"line":62,"code":"      it('returns null for default user', function (done) {\n        Users.default().then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"authenticates a known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":74,"column":36,"index":2405},"line":74,"code":"      it('authenticates a known user', function (done) {\n        Users.authenticate('fred', 'password').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"fred\");\n            user.should.have.a.property(\"permissions\", \"*\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid password for a known user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":86,"column":51,"index":2845},"line":86,"code":"      it('rejects invalid password for a known user', function (done) {\n        Users.authenticate('fred', 'wrong').then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid user","suites":["api/auth/users","Initalised with a credentials object, no anon","#authenticate"],"updatePoint":{"line":96,"column":30,"index":3118},"line":96,"code":"      it('rejects invalid user', function (done) {\n        Users.authenticate('barney', 'wrong').then(function (user) {\n          try {\n            should.not.exist(user);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns default user","suites":["api/auth/users","Initalised with a credentials object including anon","#default"],"updatePoint":{"line":119,"column":30,"index":3692},"line":119,"code":"      it('returns default user', function (done) {\n        Users.default().then(function (user) {\n          try {\n            user.should.have.a.property('anonymous', true);\n            user.should.have.a.property('permissions', '*');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"returns null for tokenHeader","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":155,"column":38,"index":4731},"line":155,"code":"      it(\"returns null for tokenHeader\", function () {\n        should.not.exist(Users.tokenHeader());\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"delegates get user","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":158,"column":28,"index":4833},"line":158,"code":"      it('delegates get user', function (done) {\n        Users.get('dave').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"dave\");\n            user.should.have.a.property(\"permissions\", \"read\");\n            user.should.not.have.a.property(\"password\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"delegates authenticate user","suites":["api/auth/users","Initialised with a credentials object with user functions","#get"],"updatePoint":{"line":170,"column":37,"index":5241},"line":170,"code":"      it('delegates authenticate user', function (done) {\n        Users.authenticate('pete', 'secret').then(function (user) {\n          try {\n            user.should.have.a.property(\"username\", \"pete\");\n            user.should.have.a.property(\"permissions\", \"write\");\n            user.should.not.have.a.property(\"password\");\n            authUsername.should.equal('pete');\n            authPassword.should.equal('secret');\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"should fail to return user fred","suites":["api/auth/users","Initialised with bad settings to test else cases","#get"],"updatePoint":{"line":198,"column":41,"index":6144},"line":198,"code":"      it('should fail to return user fred', function (done) {\n        Users.get(\"fred\").then(function (userf) {\n          try {\n            should.not.exist(userf);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.default being a function","suites":["api/auth/users","Initialised with default set as function","#default"],"updatePoint":{"line":223,"column":46,"index":6750},"line":223,"code":"      it('handles api.default being a function', function (done) {\n        Users.should.have.property('default').which.is.a.Function();\n        Users.default().should.equal(\"Done\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.tokens being a function","suites":["api/auth/users","Initialised with tokens set as function","#tokens"],"updatePoint":{"line":243,"column":45,"index":7298},"line":243,"code":"      it('handles api.tokens being a function', function (done) {\n        Users.should.have.property('tokens').which.is.a.Function();\n        Users.tokens(\"1234\").should.equal(\"Done-1234\");\n        Users.tokenHeader().should.equal(\"authorization\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"handles api.tokens being a function and api.tokenHeader being a header name","suites":["api/auth/users","Initialised with tokens set as function and tokenHeader set as token header name","#tokens"],"updatePoint":{"line":265,"column":85,"index":8032},"line":265,"code":"      it('handles api.tokens being a function and api.tokenHeader being a header name', function (done) {\n        Users.should.have.property('tokens').which.is.a.Function();\n        Users.tokens(\"1234\").should.equal(\"Done-1234\");\n        Users.should.have.property('tokenHeader').which.is.a.Function();\n        Users.tokenHeader().should.equal(\"x-test-token\");\n        done();\n      });","file":"unit/@node-red/editor-api/lib/auth/users_spec.js","skipped":false,"dir":"test"},{"name":"accepts connection","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":82,"column":26,"index":2642},"line":82,"code":"    it('accepts connection', function (done) {\n      var ws = new WebSocket(url);\n      connections.length.should.eql(0);\n      ws.on('open', function () {\n        try {\n          connections.length.should.eql(1);\n          ws.close();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"publishes message after subscription","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":95,"column":44,"index":2987},"line":95,"code":"    it('publishes message after subscription', function (done) {\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"topic1\"}');\n        connections.length.should.eql(1);\n        connections[0].send('topic1', 'foo');\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"topic1\",\"data\":\"foo\"}]');\n        ws.close();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"malformed messages are ignored","suites":["api/editor/comms","with default keepalive"],"updatePoint":{"line":108,"column":38,"index":3413},"line":108,"code":"    it('malformed messages are ignored', function (done) {\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        ws.send('not json');\n        ws.send('[]');\n        ws.send('{\"subscribe\":\"topic3\"}');\n        connections[0].send('topic3', 'correct');\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"topic3\",\"data\":\"correct\"}]');\n        ws.close();\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects websocket connections","suites":["api/editor/comms","disabled editor"],"updatePoint":{"line":152,"column":37,"index":4636},"line":152,"code":"    it('rejects websocket connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        done(new Error(\"Socket connection unexpectedly accepted\"));\n        ws.close();\n      });\n      ws.on('error', function () {\n        connections.length.should.eql(0);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: /adminPath"],"updatePoint":{"line":194,"column":27,"index":5826},"line":194,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: /adminPath/"],"updatePoint":{"line":236,"column":27,"index":7003},"line":236,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"accepts connections","suites":["api/editor/comms","non-default httpAdminRoot set: adminPath"],"updatePoint":{"line":278,"column":27,"index":8176},"line":278,"code":"    it('accepts connections', function (done) {\n      connections.length.should.eql(0);\n      var ws = new WebSocket(url);\n      ws.on('open', function () {\n        connections.length.should.eql(1);\n        ws.close();\n        done();\n      });\n      ws.on('error', function () {\n        done(new Error(\"Socket connection failed\"));\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"are sent","suites":["api/editor/comms","keep alives"],"updatePoint":{"line":320,"column":16,"index":9300},"line":320,"code":"    it('are sent', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      ws.on('message', function (data) {\n        var msg = JSON.parse(data)[0];\n        msg.should.have.property('topic', 'hb');\n        msg.should.have.property('data').be.a.Number();\n        count++;\n        if (count == 3) {\n          ws.close();\n          done();\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"are not sent if other messages are sent","suites":["api/editor/comms","keep alives"],"updatePoint":{"line":334,"column":47,"index":9720},"line":334,"code":"    it('are not sent if other messages are sent', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        interval = setInterval(function () {\n          connections[0].send('foo', 'bar');\n        }, 50);\n      });\n      ws.on('message', function (data) {\n        var msg = JSON.parse(data)[0];\n        // It is possible a heartbeat message may arrive - so ignore them\n        if (msg.topic != \"hb\") {\n          msg.should.have.property('topic', 'foo');\n          msg.should.have.property('data', 'bar');\n          count++;\n          if (count == 5) {\n            clearInterval(interval);\n            ws.close();\n            done();\n          }\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"prevents connections that do not authenticate","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":453,"column":53,"index":13302},"line":453,"code":"    it('prevents connections that do not authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":464,"column":47,"index":13599},"line":464,"code":"    it('allows connections that do authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"1234\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n        if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(2);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate - header-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":490,"column":71,"index":14356},"line":490,"code":"    it('allows connections that do authenticate - header-provided-token', function (done) {\n      var ws = new WebSocket(url, {\n        headers: {\n          \"custom-header\": \"knock-knock\"\n        }\n      });\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        connections.should.have.length(1);\n        connections[0].send('foo', 'correct');\n      });\n      ws.on('message', function (msg) {\n        received++;\n        if (received == 1) {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(1);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows connections that do authenticate - user-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":518,"column":69,"index":15133},"line":518,"code":"    it('allows connections that do authenticate - user-provided-token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"abcde\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n        if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          ws.close();\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(2);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for non-existant token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":544,"column":50,"index":15870},"line":544,"code":"    it('rejects connections for non-existant token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"2345\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for invalid token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":554,"column":45,"index":16144},"line":554,"code":"    it('rejects connections for invalid token', function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"5678\"}');\n      });\n      ws.on('close', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"rejects connections for invalid token - header-provided-token","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":564,"column":69,"index":16442},"line":564,"code":"    it('rejects connections for invalid token - header-provided-token', function (done) {\n      var ws = new WebSocket(url, {\n        headers: {\n          \"custom-header\": \"bad token\"\n        }\n      });\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n      });\n      ws.on('error', function () {\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"expires websocket sessions","suites":["api/editor/comms","authentication required, no anonymous"],"updatePoint":{"line":578,"column":34,"index":16788},"line":578,"code":"    it(\"expires websocket sessions\", function (done) {\n      var ws = new WebSocket(url);\n      var received = 0;\n      ws.on('open', function () {\n        ws.send('{\"auth\":\"1234\"}');\n      });\n      ws.on('message', function (msg) {\n        received++;\n        if (received == 3) {\n          msg.should.equal('{\"auth\":\"fail\"}');\n        } else if (received == 1) {\n          msg.should.equal('{\"auth\":\"ok\"}');\n          ws.send('{\"subscribe\":\"foo\"}');\n          connections[0].send('foo', 'correct');\n        } else {\n          msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n          setTimeout(function () {\n            onSessionExpiryCallback({\n              accessToken: \"1234\"\n            });\n          }, 50);\n        }\n      });\n      ws.on('close', function () {\n        try {\n          received.should.equal(3);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"allows anonymous connections that do not authenticate","suites":["api/editor/comms","authentication required, anonymous enabled"],"updatePoint":{"line":643,"column":61,"index":18617},"line":643,"code":"    it('allows anonymous connections that do not authenticate', function (done) {\n      var ws = new WebSocket(url);\n      var count = 0;\n      var interval;\n      ws.on('open', function () {\n        ws.send('{\"subscribe\":\"foo\"}');\n        setTimeout(function () {\n          connections[0].send('foo', 'correct');\n        }, 200);\n      });\n      ws.on('message', function (msg) {\n        msg.should.equal('[{\"topic\":\"foo\",\"data\":\"correct\"}]');\n        count++;\n        ws.close();\n      });\n      ws.on('close', function () {\n        try {\n          count.should.equal(1);\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/comms_spec.js","skipped":false,"dir":"test"},{"name":"returns stored credentials","suites":["api/editor/credentials"],"updatePoint":{"line":47,"column":32,"index":1595},"line":47,"code":"  it('returns stored credentials', function (done) {\n    request(app).get(\"/credentials/known-type/n1\").expect(\"Content-Type\", /json/).expect(200).end(function (err, res) {\n      if (err) {\n        done(err);\n      } else {\n        try {\n          res.body.should.have.a.property(\"user1\", \"abc\");\n          res.body.should.not.have.a.property(\"password1\");\n          res.body.should.have.a.property(\"has_password1\", true);\n          done();\n        } catch (e) {\n          done(e);\n        }\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/credentials_spec.js","skipped":false,"dir":"test"},{"name":"returns any error","suites":["api/editor/credentials"],"updatePoint":{"line":63,"column":23,"index":2100},"line":63,"code":"  it('returns any error', function (done) {\n    request(app).get(\"/credentials/unknown-type/n2\").expect(\"Content-Type\", /json/).expect(400).end(function (err, res) {\n      if (err) {\n        done(err);\n      } else {\n        try {\n          res.body.should.have.property('code');\n          res.body.code.should.be.equal(\"test_code\");\n          res.body.should.have.property('message');\n          res.body.message.should.be.equal('message');\n          done();\n        } catch (e) {\n          done(e);\n        }\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/credentials_spec.js","skipped":false,"dir":"test"},{"name":"disables the editor","suites":["api/editor/index","disabled the editor"],"updatePoint":{"line":38,"column":27,"index":1539},"line":38,"code":"    it(\"disables the editor\", function () {\n      var editorApp = editorApi.init({}, {\n        disableEditor: true\n      }, {});\n      should.not.exist(editorApp);\n      comms.init.called.should.be.false();\n      info.init.called.should.be.false();\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":86,"column":25,"index":3191},"line":86,"code":"    it('serves the editor', function (done) {\n      request(app).get(\"/\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        // Index page should probably mention Node-RED somewhere\n        res.text.indexOf(\"Node-RED\").should.not.eql(-1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"serves icons","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":96,"column":20,"index":3511},"line":96,"code":"    it('serves icons', function (done) {\n      request(app).get(\"/red/images/icons/arrow-in.svg\").expect(200).expect(\"Content-Type\", /image\\/svg\\+xml/).end(function (err, res) {\n        done(err);\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"handles page not there","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":101,"column":30,"index":3736},"line":101,"code":"    it('handles page not there', function (done) {\n      request(app).get(\"/foo\").expect(404, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"warns if runtime not started","suites":["api/editor/index","enables the editor"],"updatePoint":{"line":104,"column":36,"index":3851},"line":104,"code":"    it('warns if runtime not started', function (done) {\n      isStarted = false;\n      request(app).get(\"/\").expect(503).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.text.should.eql(\"Not started\");\n        errors.should.have.lengthOf(1);\n        errors[0].should.eql(\"Node-RED runtime not started\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/index_spec.js","skipped":false,"dir":"test"},{"name":"returns an individual entry - flow type","suites":["api/editor/library"],"updatePoint":{"line":33,"column":45,"index":1286},"line":33,"code":"  it('returns an individual entry - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve('{\"a\":1,\"b\":2}');\n        }\n      }\n    });\n    request(app).get('/library/local/flows/abc').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a directory listing - flow type","suites":["api/editor/library"],"updatePoint":{"line":55,"column":45,"index":1947},"line":55,"code":"  it('returns a directory listing - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve({\n            \"a\": 1,\n            \"b\": 2\n          });\n        }\n      }\n    });\n    request(app).get('/library/local/flows/abc/def').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc/def');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an individual entry - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":80,"column":49,"index":2657},"line":80,"code":"  it('returns an individual entry - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve('{\"a\":1,\"b\":2}');\n        }\n      }\n    });\n    request(app).get('/library/local/non-flow/abc').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc');\n      res.text.should.eql('{\"a\":1,\"b\":2}');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a directory listing - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":101,"column":49,"index":3282},"line":101,"code":"  it('returns a directory listing - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve({\n            \"a\": 1,\n            \"b\": 2\n          });\n        }\n      }\n    });\n    request(app).get('/library/local/non-flow/abc/def').expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('a', 1);\n      res.body.should.have.property('b', 2);\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc/def');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an error on individual get","suites":["api/editor/library"],"updatePoint":{"line":126,"column":40,"index":3989},"line":126,"code":"  it('returns an error on individual get', function (done) {\n    var opts;\n    library.init({\n      library: {\n        getEntry: function (_opts) {\n          opts = _opts;\n          var err = new Error(\"message\");\n          err.code = \"random_error\";\n          err.status = 400;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).get('/library/local/flows/123').expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', '123');\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"random_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"message\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an individual entry - flow type","suites":["api/editor/library"],"updatePoint":{"line":155,"column":43,"index":4899},"line":155,"code":"  it('saves an individual entry - flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post('/library/local/flows/abc/def').expect(204).send({\n      a: 1,\n      b: 2,\n      c: 3\n    }).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'flows');\n      opts.should.have.property('path', 'abc/def');\n      opts.should.have.property('meta', {});\n      opts.should.have.property('body', JSON.stringify({\n        a: 1,\n        b: 2,\n        c: 3\n      }));\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an individual entry - non-flow type","suites":["api/editor/library"],"updatePoint":{"line":185,"column":47,"index":5670},"line":185,"code":"  it('saves an individual entry - non-flow type', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post('/library/local/non-flow/abc/def').expect(204).send({\n      a: 1,\n      b: 2,\n      text: \"123\"\n    }).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('path', 'abc/def');\n      opts.should.have.property('meta', {\n        a: 1,\n        b: 2\n      });\n      opts.should.have.property('body', \"123\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns an error on individual save","suites":["api/editor/library"],"updatePoint":{"line":214,"column":41,"index":6421},"line":214,"code":"  it('returns an error on individual save', function (done) {\n    var opts;\n    library.init({\n      library: {\n        saveEntry: function (_opts) {\n          opts = _opts;\n          var err = new Error(\"message\");\n          err.code = \"random_error\";\n          err.status = 400;\n          var p = Promise.reject(err);\n          p.catch(() => {});\n          return p;\n        }\n      }\n    });\n    request(app).post('/library/local/non-flow/abc/def').send({\n      a: 1,\n      b: 2,\n      text: \"123\"\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      opts.should.have.property('type', 'non-flow');\n      opts.should.have.property('library', 'local');\n      opts.should.have.property('path', 'abc/def');\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"random_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"message\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/library_spec.js","skipped":false,"dir":"test"},{"name":"returns with default language","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":80,"column":37,"index":2762},"line":80,"code":"    it('returns with default language', function (done) {\n      request(app).get(\"/locales/message-catalog\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.have.property('namespace', 'message-catalog');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"returns with selected language","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":89,"column":38,"index":3072},"line":89,"code":"    it('returns with selected language', function (done) {\n      request(app).get(\"/locales/message-catalog?lng=fr-FR\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.have.property('namespace', 'message-catalog');\n        res.body.should.have.property('lang', 'fr-FR');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"returns for locale defined only with primary tag ","suites":["api/editor/locales","get named resource catalog"],"updatePoint":{"line":99,"column":57,"index":3467},"line":99,"code":"    it('returns for locale defined only with primary tag ', function (done) {\n      var orig = i18n.i.getResourceBundle;\n      i18n.i.getResourceBundle = function (lang, ns) {\n        if (lang === \"ja-JP\") {\n          return undefined;\n        }\n        return orig(lang, ns);\n      };\n      request(app)\n      // returns `ja` instead of `ja-JP`\n      .get(\"/locales/message-catalog?lng=ja-JP\").expect(200).end(function (err, res) {\n        i18n.i.getResourceBundle = orig;\n        if (err) {\n          return done(err);\n        }\n        res.body.should.have.property('namespace', 'message-catalog');\n        res.body.should.have.property('lang', 'ja');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/locales_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["api/editor/projects"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/editor-api/lib/editor/projects_spec.js","skipped":true,"dir":"test"},{"name":"returns the user settings","suites":["api/editor/settings"],"updatePoint":{"line":48,"column":31,"index":1622},"line":48,"code":"  it('returns the user settings', function (done) {\n    info.init({\n      settings: {\n        getUserSettings: function (opts) {\n          if (opts.user !== \"fred\") {\n            return Promise.reject(new Error(\"Unknown user\"));\n          }\n          return Promise.resolve({\n            c: 3,\n            d: 4\n          });\n        }\n      }\n    });\n    request(app).get(\"/settings/user\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.eql({\n        c: 3,\n        d: 4\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/settings_spec.js","skipped":false,"dir":"test"},{"name":"updates the user settings","suites":["api/editor/settings"],"updatePoint":{"line":73,"column":31,"index":2194},"line":73,"code":"  it('updates the user settings', function (done) {\n    var update;\n    info.init({\n      settings: {\n        updateUserSettings: function (opts) {\n          if (opts.user !== \"fred\") {\n            return Promise.reject(new Error(\"Unknown user\"));\n          }\n          update = opts.settings;\n          return Promise.resolve();\n        }\n      }\n    });\n    request(app).post(\"/settings/user\").send({\n      e: 4,\n      f: 5\n    }).expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      update.should.eql({\n        e: 4,\n        f: 5\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/settings_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return empty list","suites":["api/editor/sshkeys"],"updatePoint":{"line":52,"column":51,"index":1879},"line":52,"code":"  it('GET /settings/user/keys --- return empty list', function (done) {\n    mockRuntime.settings.getUserKeys.returns(Promise.resolve([]));\n    request(app).get(\"/settings/user/keys\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('keys');\n      res.body.keys.should.be.empty();\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return normal list","suites":["api/editor/sshkeys"],"updatePoint":{"line":63,"column":52,"index":2264},"line":63,"code":"  it('GET /settings/user/keys --- return normal list', function (done) {\n    var fileList = ['test_key01', 'test_key02'];\n    var retList = fileList.map(function (elem) {\n      return {\n        name: elem\n      };\n    });\n    mockRuntime.settings.getUserKeys.returns(Promise.resolve(retList));\n    request(app).get(\"/settings/user/keys\").expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('keys');\n      for (var item of retList) {\n        res.body.keys.should.containEql(item);\n      }\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":82,"column":46,"index":2847},"line":82,"code":"  it('GET /settings/user/keys --- return Error', function (done) {\n    var errInstance = new Error(\"Messages here.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKeys.returns(p);\n    request(app).get(\"/settings/user/keys\").expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(errInstance.code);\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return 404","suites":["api/editor/sshkeys"],"updatePoint":{"line":99,"column":60,"index":3502},"line":99,"code":"  it('GET /settings/user/keys/<key_file_name> --- return 404', function (done) {\n    var errInstance = new Error(\"Not Found.\");\n    errInstance.code = \"not_found\";\n    errInstance.status = 404;\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/NOT_REAL\").expect(404).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":113,"column":57,"index":3975},"line":113,"code":"  it('GET /settings/user/keys --- return Unexpected Error', function (done) {\n    var errInstance = new Error();\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKeys.returns(p);\n    request(app).get(\"/settings/user/keys\").expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.toString());\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return content","suites":["api/editor/sshkeys"],"updatePoint":{"line":129,"column":64,"index":4583},"line":129,"code":"  it('GET /settings/user/keys/<key_file_name> --- return content', function (done) {\n    var key_file_name = \"test_key\";\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    mockRuntime.settings.getUserKey.returns(Promise.resolve(fileContent));\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      mockRuntime.settings.getUserKey.called.should.be.true();\n      mockRuntime.settings.getUserKey.firstCall.args[0].should.eql({\n        user: undefined,\n        id: 'test_key'\n      });\n      res.body.should.be.deepEqual({\n        publickey: fileContent\n      });\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":148,"column":62,"index":5976},"line":148,"code":"  it('GET /settings/user/keys/<key_file_name> --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(errInstance.code);\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"GET /settings/user/keys/<key_file_name> --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":166,"column":73,"index":6691},"line":166,"code":"  it('GET /settings/user/keys/<key_file_name> --- return Unexpected Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.getUserKey.returns(p);\n    request(app).get(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"Messages.....\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- success","suites":["api/editor/sshkeys"],"updatePoint":{"line":183,"column":42,"index":7337},"line":183,"code":"  it('POST /settings/user/keys --- success', function (done) {\n    var key_file_name = \"test_key\";\n    mockRuntime.settings.generateUserKey.returns(Promise.resolve(key_file_name));\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(200).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":195,"column":47,"index":7725},"line":195,"code":"  it('POST /settings/user/keys --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.generateUserKey.returns(p);\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"test_code\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"POST /settings/user/keys --- return Unexpected error","suites":["api/editor/sshkeys"],"updatePoint":{"line":215,"column":58,"index":8449},"line":215,"code":"  it('POST /settings/user/keys --- return Unexpected error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.generateUserKey.returns(p);\n    request(app).post(\"/settings/user/keys\").send({\n      name: key_file_name\n    }).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(\"Messages.....\");\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- success","suites":["api/editor/sshkeys"],"updatePoint":{"line":234,"column":60,"index":9142},"line":234,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- success', function (done) {\n    var key_file_name = \"test_key\";\n    mockRuntime.settings.removeUserKey.returns(Promise.resolve(true));\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(204).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.be.deepEqual({});\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- return Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":245,"column":65,"index":9556},"line":245,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- return Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    errInstance.code = \"test_code\";\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.removeUserKey.returns(p);\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"test_code\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal(errInstance.message);\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"DELETE /settings/user/keys/<key_file_name> --- return Unexpected Error","suites":["api/editor/sshkeys"],"updatePoint":{"line":263,"column":76,"index":10275},"line":263,"code":"  it('DELETE /settings/user/keys/<key_file_name> --- return Unexpected Error', function (done) {\n    var key_file_name = \"test_key\";\n    var errInstance = new Error(\"Messages.....\");\n    var p = Promise.reject(errInstance);\n    p.catch(() => {});\n    mockRuntime.settings.removeUserKey.returns(p);\n    request(app).delete(\"/settings/user/keys/\" + key_file_name).expect(400).end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      res.body.should.have.property('code');\n      res.body.code.should.be.equal(\"unexpected_error\");\n      res.body.should.have.property('message');\n      res.body.message.should.be.equal('Messages.....');\n      done();\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/sshkeys_spec.js","skipped":false,"dir":"test"},{"name":"applies the default theme","suites":["api/editor/theme"],"updatePoint":{"line":37,"column":31,"index":1228},"line":37,"code":"  it(\"applies the default theme\", async function () {\n    var result = theme.init({});\n    should.not.exist(result);\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"title\", \"Node-RED\");\n    context.page.should.have.a.property(\"favicon\", \"favicon.ico\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"red/images/node-red-icon-black.svg\");\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f0000\");\n    context.should.have.a.property(\"header\");\n    context.header.should.have.a.property(\"title\", \"Node-RED\");\n    context.header.should.have.a.property(\"image\", \"red/images/node-red.svg\");\n    context.should.have.a.property(\"asset\");\n    context.asset.should.have.a.property(\"red\", \"red/red.min.js\");\n    context.asset.should.have.a.property(\"main\", \"red/main.min.js\");\n    context.asset.should.have.a.property(\"vendorMonaco\", \"vendor/monaco/monaco-bootstrap.js\");\n    should.not.exist(theme.settings());\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"uses non-minified js files when in dev mode","suites":["api/editor/theme"],"updatePoint":{"line":56,"column":49,"index":2305},"line":56,"code":"  it(\"uses non-minified js files when in dev mode\", async function () {\n    const previousEnv = process.env.NODE_ENV;\n    try {\n      process.env.NODE_ENV = 'development';\n      theme.init({});\n      var context = await theme.context();\n      context.asset.should.have.a.property(\"red\", \"red/red.js\");\n      context.asset.should.have.a.property(\"main\", \"red/main.js\");\n    } finally {\n      process.env.NODE_ENV = previousEnv;\n    }\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"Does not add monaco bootstrap when ace selected","suites":["api/editor/theme"],"updatePoint":{"line":68,"column":53,"index":2748},"line":68,"code":"  it(\"Does not add monaco bootstrap when ace selected\", async function () {\n    theme.init({\n      editorTheme: {\n        codeEditor: {\n          lib: 'ace'\n        }\n      }\n    });\n    var context = await theme.context();\n    context.asset.should.have.a.property(\"vendorMonaco\", \"\");\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"picks up custom theme","suites":["api/editor/theme"],"updatePoint":{"line":79,"column":27,"index":3014},"line":79,"code":"  it(\"picks up custom theme\", async function () {\n    theme.init({\n      editorTheme: {\n        page: {\n          title: \"Test Page Title\",\n          favicon: \"/absolute/path/to/theme/favicon\",\n          tabicon: {\n            icon: \"/absolute/path/to/theme/tabicon\",\n            colour: \"#8f008f\"\n          },\n          css: [\"/absolute/path/to/custom/css/file.css\"],\n          scripts: \"/absolute/path/to/script.js\"\n        },\n        header: {\n          title: \"Test Header Title\",\n          url: \"http://nodered.org\",\n          image: \"/absolute/path/to/header/image\" // or null to remove image\n        },\n\n        deployButton: {\n          type: \"simple\",\n          label: \"Save\",\n          icon: \"/absolute/path/to/deploy/button/image\" // or null to remove image\n        },\n\n        menu: {\n          // Hide unwanted menu items by id. see editor/js/main.js:loadEditor for complete list\n          \"menu-item-import-library\": false,\n          \"menu-item-export-library\": false,\n          \"menu-item-keyboard-shortcuts\": false,\n          \"menu-item-help\": {\n            label: \"Alternative Help Link Text\",\n            url: \"http://example.com\"\n          }\n        },\n        userMenu: false,\n        // Hide the user-menu even if adminAuth is enabled\n\n        login: {\n          image: \"/absolute/path/to/login/page/big/image\" // a 256x256 image\n        },\n\n        palette: {\n          editable: true,\n          catalogues: ['https://catalogue.nodered.org/catalogue.json'],\n          theme: [{\n            category: \".*\",\n            type: \".*\",\n            color: \"#f0f\"\n          }]\n        },\n        projects: {\n          enabled: false\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"title\", \"Test Page Title\");\n    context.page.should.have.a.property(\"favicon\", \"theme/favicon/favicon\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"theme/tabicon/tabicon\");\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f008f\");\n    context.should.have.a.property(\"header\");\n    context.header.should.have.a.property(\"title\", \"Test Header Title\");\n    context.header.should.have.a.property(\"url\", \"http://nodered.org\");\n    context.header.should.have.a.property(\"image\", \"theme/header/image\");\n    context.page.should.have.a.property(\"css\");\n    context.page.css.should.have.lengthOf(1);\n    context.page.css[0].should.eql('theme/css/file.css');\n    context.page.should.have.a.property(\"scripts\");\n    context.page.scripts.should.have.lengthOf(1);\n    context.page.scripts[0].should.eql('theme/scripts/script.js');\n    context.should.have.a.property(\"login\");\n    context.login.should.have.a.property(\"image\", \"theme/login/image\");\n    var settings = theme.settings();\n    settings.should.have.a.property(\"deployButton\");\n    settings.deployButton.should.have.a.property(\"type\", \"simple\");\n    settings.deployButton.should.have.a.property(\"label\", \"Save\");\n    settings.deployButton.should.have.a.property(\"icon\", \"theme/deploy/image\");\n    settings.should.have.a.property(\"userMenu\");\n    settings.userMenu.should.be.eql(false);\n    settings.should.have.a.property(\"menu\");\n    settings.menu.should.have.a.property(\"menu-item-import-library\", false);\n    settings.menu.should.have.a.property(\"menu-item-export-library\", false);\n    settings.menu.should.have.a.property(\"menu-item-keyboard-shortcuts\", false);\n    settings.menu.should.have.a.property(\"menu-item-help\", {\n      label: \"Alternative Help Link Text\",\n      url: \"http://example.com\"\n    });\n    settings.should.have.a.property(\"palette\");\n    settings.palette.should.have.a.property(\"editable\", true);\n    settings.palette.should.have.a.property(\"catalogues\", ['https://catalogue.nodered.org/catalogue.json']);\n    settings.palette.should.have.a.property(\"theme\", [{\n      category: \".*\",\n      type: \".*\",\n      color: \"#f0f\"\n    }]);\n    settings.should.have.a.property(\"projects\");\n    settings.projects.should.have.a.property(\"enabled\", false);\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"picks up backwards compatible tabicon setting","suites":["api/editor/theme"],"updatePoint":{"line":181,"column":51,"index":7152},"line":181,"code":"  it(\"picks up backwards compatible tabicon setting\", async function () {\n    theme.init({\n      editorTheme: {\n        page: {\n          tabicon: \"/absolute/path/to/theme/tabicon\"\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"tabicon\");\n    context.page.tabicon.should.have.a.property(\"icon\", \"theme/tabicon/tabicon\");\n    // The colour property should remain as default in this case as the\n    // legacy format for defining tabicon doesn't allow specifying a colour\n    context.page.tabicon.should.have.a.property(\"colour\", \"#8f0000\");\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"test explicit userMenu set to true in theme setting","suites":["api/editor/theme"],"updatePoint":{"line":198,"column":57,"index":7825},"line":198,"code":"  it(\"test explicit userMenu set to true in theme setting\", function () {\n    theme.init({\n      editorTheme: {\n        userMenu: true\n      }\n    });\n    theme.app();\n    var settings = theme.settings();\n    settings.should.have.a.property(\"userMenu\");\n    settings.userMenu.should.be.eql(true);\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"includes list of plugin themes","suites":["api/editor/theme"],"updatePoint":{"line":209,"column":36,"index":8107},"line":209,"code":"  it(\"includes list of plugin themes\", function (done) {\n    theme.init({}, {\n      plugins: {\n        getPluginsByType: _ => [{\n          id: \"theme-plugin\"\n        }]\n      }\n    });\n    const app = theme.app();\n    request(app).get(\"/\").end(function (err, res) {\n      if (err) {\n        return done(err);\n      }\n      try {\n        const response = JSON.parse(res.text);\n        response.should.have.property(\"themes\");\n        response.themes.should.eql([\"theme-plugin\"]);\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"includes theme plugin settings","suites":["api/editor/theme"],"updatePoint":{"line":232,"column":36,"index":8665},"line":232,"code":"  it(\"includes theme plugin settings\", async function () {\n    theme.init({\n      editorTheme: {\n        theme: 'test-theme'\n      }\n    }, {\n      plugins: {\n        getPlugin: t => {\n          return {\n            'test-theme': {\n              path: '/abosolute/path/to/plugin',\n              css: [\"path/to/custom/css/file1.css\", \"/invalid/path/to/file2.css\", \"../another/invalid/path/file3.css\"],\n              scripts: [\"path/to/custom/js/file1.js\", \"/invalid/path/to/file2.js\", \"../another/invalid/path/file3.js\"]\n            }\n          }[t.id];\n        }\n      }\n    });\n    theme.app();\n    var context = await theme.context();\n    context.should.have.a.property(\"page\");\n    context.page.should.have.a.property(\"css\");\n    context.page.css.should.have.lengthOf(1);\n    context.page.css[0].should.eql('theme/css/file1.css');\n    context.page.should.have.a.property(\"scripts\");\n    context.page.scripts.should.have.lengthOf(1);\n    context.page.scripts[0].should.eql('theme/scripts/file1.js');\n  });","file":"unit/@node-red/editor-api/lib/editor/theme_spec.js","skipped":false,"dir":"test"},{"name":"redirects if the path does not end in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":57,"column":53,"index":1922},"line":57,"code":"    it('redirects if the path does not end in a slash', function (done) {\n      request(app).get('/foo').expect(301, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"redirects if the path, with query string, does not end in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":60,"column":73,"index":2074},"line":60,"code":"    it('redirects if the path, with query string, does not end in a slash', function (done) {\n      request(app).get('/foo?abc=def').expect(301).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.header['location'].should.equal(\"/foo/?abc=def\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"does not redirect if the path ends in a slash","suites":["api/editor/ui","slash handler"],"updatePoint":{"line":69,"column":53,"index":2378},"line":69,"code":"    it('does not redirect if the path ends in a slash', function (done) {\n      request(app).get('/foo/').expect(200, done);\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the requested icon","suites":["api/editor/ui","icon handler"],"updatePoint":{"line":94,"column":34,"index":3096},"line":94,"code":"    it('returns the requested icon', function (done) {\n      var defaultIcon = fs.readFileSync(NR_TEST_UTILS.resolve(\"@node-red/editor-client/src/images/icons/arrow-in.svg\"));\n      request(app).get(\"/icons/module/icon.png\").expect(\"Content-Type\", /image\\/png/).expect(200).parse(binaryParser).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        Buffer.isBuffer(res.body).should.be.true();\n        compareBuffers(res.body, defaultIcon);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the default icon for invalid paths","suites":["api/editor/ui","icon handler"],"updatePoint":{"line":105,"column":50,"index":3622},"line":105,"code":"    it('returns the default icon for invalid paths', function (done) {\n      var defaultIcon = fs.readFileSync(NR_TEST_UTILS.resolve(\"@node-red/editor-client/src/images/icons/arrow-in.svg\"));\n      request(app).get(\"/icons/module/unreal.png\").expect(\"Content-Type\", /image\\/svg/).expect(200).parse(binaryParser).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        Buffer.isBuffer(res.body).should.be.true();\n        compareBuffers(res.body, defaultIcon);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"returns the requested resource","suites":["api/editor/ui","module resource handler"],"updatePoint":{"line":122,"column":38,"index":4333},"line":122,"code":"    it('returns the requested resource', function (done) {\n      request(app).get(\"/resources/test-module/a/path/text.txt\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.text.should.eql('Some text data');\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"404s invalid paths","suites":["api/editor/ui","module resource handler"],"updatePoint":{"line":131,"column":26,"index":4621},"line":131,"code":"    it('404s invalid paths', function (done) {\n      request(app).get(\"/resources/test-module/../a/path/text.txt\").expect(404).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor","suites":["api/editor/ui","editor ui handler"],"updatePoint":{"line":145,"column":25,"index":5003},"line":145,"code":"    it('serves the editor', function (done) {\n      request(app).get(\"/\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        // Index page should probably mention Node-RED somewhere\n        res.text.indexOf(\"Node-RED\").should.not.eql(-1);\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"serves the editor resources","suites":["api/editor/ui","editor ui resource handler"],"updatePoint":{"line":161,"column":35,"index":5495},"line":161,"code":"    it('serves the editor resources', function (done) {\n      request(app).get(\"/favicon.ico\").expect(200).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/editor/ui_spec.js","skipped":false,"dir":"test"},{"name":"does not setup admin api if httpAdminRoot is false","suites":["api/index"],"updatePoint":{"line":56,"column":56,"index":2014},"line":56,"code":"  it(\"does not setup admin api if httpAdminRoot is false\", function (done) {\n    api.init({\n      httpAdminRoot: false\n    }, {}, {}, {});\n    should.not.exist(api.httpAdmin);\n    done();\n  });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the editor","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":69,"column":26,"index":2352},"line":69,"code":"    it('exposes the editor', function (done) {\n      request(api.httpAdmin).get(\"/editor\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the admin api","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":72,"column":29,"index":2477},"line":72,"code":"    it('exposes the admin api', function (done) {\n      request(api.httpAdmin).get(\"/admin\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the auth api","suites":["api/index","initalises admin api without adminAuth"],"updatePoint":{"line":75,"column":28,"index":2600},"line":75,"code":"    it('exposes the auth api', function (done) {\n      request(api.httpAdmin).get(\"/auth/login\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"does not expose the editor","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":87,"column":34,"index":2946},"line":87,"code":"    it('does not expose the editor', function (done) {\n      request(api.httpAdmin).get(\"/editor\").expect(404).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the admin api","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":90,"column":29,"index":3071},"line":90,"code":"    it('exposes the admin api', function (done) {\n      request(api.httpAdmin).get(\"/admin\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"exposes the auth api","suites":["api/index","initalises admin api without editor"],"updatePoint":{"line":93,"column":28,"index":3194},"line":93,"code":"    it('exposes the auth api', function (done) {\n      request(api.httpAdmin).get(\"/auth/login\").expect(200).end(done);\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"ignores non-function values","suites":["api/index","initialises api with admin middleware"],"updatePoint":{"line":98,"column":35,"index":3401},"line":98,"code":"    it('ignores non-function values', function (done) {\n      api.init({\n        httpAdminRoot: true,\n        httpAdminMiddleware: undefined\n      }, {}, {}, {});\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'testMiddleware');\n      should(middlewareFound).be.empty();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"only accepts functions as middleware","suites":["api/index","initialises api with admin middleware"],"updatePoint":{"line":107,"column":44,"index":3745},"line":107,"code":"    it('only accepts functions as middleware', function (done) {\n      const testMiddleware = function (req, res, next) {\n        next();\n      };\n      api.init({\n        httpAdminRoot: true,\n        httpAdminMiddleware: testMiddleware\n      }, {}, {}, {});\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'testMiddleware');\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables an oauth/openID based authentication mechanism","suites":["api/index","initialises api with authentication enabled"],"updatePoint":{"line":121,"column":62,"index":4274},"line":121,"code":"    it('enables an oauth/openID based authentication mechanism', function (done) {\n      const stub = sinon.stub(apiAuth, 'genericStrategy').callsFake(function () {});\n      const adminAuth = {\n        type: 'strategy',\n        strategy: {}\n      };\n      api.init({\n        httpAdminRoot: true,\n        adminAuth\n      }, {}, {}, {});\n      should(stub.called).be.ok();\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables password protection","suites":["api/index","initialises api with authentication enabled"],"updatePoint":{"line":135,"column":35,"index":4662},"line":135,"code":"    it('enables password protection', function (done) {\n      const adminAuth = {\n        type: 'credentials'\n      };\n      api.init({\n        httpAdminRoot: true,\n        adminAuth\n      }, {}, {}, {});\n\n      // is the name (\"initialize\") of the passport middleware present\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'initialize');\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"uses default cors middleware when user settings absent","suites":["api/index","initialises api with custom cors config"],"updatePoint":{"line":155,"column":62,"index":5301},"line":155,"code":"    it('uses default cors middleware when user settings absent', function (done) {\n      api.init({\n        httpAdminRoot: true\n      }, {}, {}, {});\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'corsMiddleware');\n      should(middlewareFound).be.length(1);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables custom cors middleware when settings present","suites":["api/index","initialises api with custom cors config"],"updatePoint":{"line":163,"column":60,"index":5623},"line":163,"code":"    it('enables custom cors middleware when settings present', function (done) {\n      api.init({\n        httpAdminRoot: true,\n        httpAdminCors\n      }, {}, {}, {});\n      const middlewareFound = api.httpAdmin._router.stack.filter(layer => layer.name === 'corsMiddleware');\n      should(middlewareFound).be.length(2);\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"cannot be started when editor is disabled","suites":["api/index","editor start"],"updatePoint":{"line":174,"column":49,"index":6004},"line":174,"code":"    it('cannot be started when editor is disabled', function (done) {\n      const stub = sinon.stub(apiEditor, 'start').callsFake(function () {\n        return Promise.resolve(true);\n      });\n      api.init({\n        httpAdminRoot: true,\n        disableEditor: true\n      }, {}, {}, {});\n      should(api.start()).resolvedWith(true);\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"can be started when editor enabled","suites":["api/index","editor start"],"updatePoint":{"line":186,"column":42,"index":6375},"line":186,"code":"    it('can be started when editor enabled', function (done) {\n      const stub = sinon.stub(apiEditor, 'start');\n      api.init({\n        httpAdminRoot: true,\n        disableEditor: false\n      }, {}, {}, {});\n      api.start();\n      should(stub.called).be.true();\n      stub.restore();\n      done();\n    });","file":"unit/@node-red/editor-api/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"logs an error for request entity too large","suites":["api/util","errorHandler"],"updatePoint":{"line":57,"column":50,"index":1962},"line":57,"code":"    it(\"logs an error for request entity too large\", function (done) {\n      request(app).get(\"/tooLarge\").expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.have.property(\"error\", \"unexpected_error\");\n        res.body.should.have.property(\"message\", \"Error: request entity too large\");\n        loggedError.should.have.property(\"message\", \"request entity too large\");\n        loggedEvent.should.have.property(\"event\", \"api.error\");\n        loggedEvent.should.have.property(\"error\", \"unexpected_error\");\n        loggedEvent.should.have.property(\"message\", \"Error: request entity too large\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"logs an error plus stack for other errors","suites":["api/util","errorHandler"],"updatePoint":{"line":71,"column":49,"index":2654},"line":71,"code":"    it(\"logs an error plus stack for other errors\", function (done) {\n      request(app).get(\"/stack\").expect(400).end(function (err, res) {\n        if (err) {\n          return done(err);\n        }\n        res.body.should.have.property(\"error\", \"unexpected_error\");\n        res.body.should.have.property(\"message\", \"Error: stacktrace\");\n        /Error: stacktrace\\s*at.*util_spec.js/m.test(loggedError).should.be.true();\n        loggedEvent.should.have.property(\"event\", \"api.error\");\n        loggedEvent.should.have.property(\"error\", \"unexpected_error\");\n        loggedEvent.should.have.property(\"message\", \"Error: stacktrace\");\n        done();\n      });\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns the default lang if non provided","suites":["api/util","determineLangFromHeaders"],"updatePoint":{"line":95,"column":48,"index":3581},"line":95,"code":"    it('returns the default lang if non provided', function () {\n      apiUtil.determineLangFromHeaders(null).should.eql(\"en-US\");\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns the first language accepted","suites":["api/util","determineLangFromHeaders"],"updatePoint":{"line":98,"column":43,"index":3715},"line":98,"code":"    it('returns the first language accepted', function () {\n      apiUtil.determineLangFromHeaders(['fr-FR', 'en-GB']).should.eql(\"fr-FR\");\n    });","file":"unit/@node-red/editor-api/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should return info on a node","suites":["deprecated"],"updatePoint":{"line":21,"column":34,"index":866},"line":21,"code":"  it('should return info on a node', function () {\n    deprecated.get(\"irc in\").should.eql({\n      module: \"node-red-node-irc\"\n    });\n  });","file":"unit/@node-red/registry/lib/deprecated_spec.js","skipped":false,"dir":"test"},{"name":"should return null for non-deprecated node","suites":["deprecated"],"updatePoint":{"line":26,"column":48,"index":1021},"line":26,"code":"  it('should return null for non-deprecated node', function () {\n    should.not.exist(deprecated.get(\"foo\"));\n  });","file":"unit/@node-red/registry/lib/deprecated_spec.js","skipped":false,"dir":"test"},{"name":"does nothing when no types are registered","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":64,"column":49,"index":2102},"line":64,"code":"    it(\"does nothing when no types are registered\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips install for modules already installed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":78,"column":51,"index":2477},"line":78,"code":"    it(\"skips install for modules already installed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await setupExternalModulesPackage({\n        \"foo\": \"1.2.3\",\n        \"bar\": \"2.3.4\"\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips install for built-in modules","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":97,"column":42,"index":2994},"line":97,"code":"    it(\"skips install for built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"fs\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"installs missing modules","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":112,"column":32,"index":3401},"line":112,"code":"    it(\"installs missing modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"calls pre/postInstall hooks","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":127,"column":35,"index":3811},"line":127,"code":"    it(\"calls pre/postInstall hooks\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        event.args = [\"a\"];\n        receivedPreEvent = event;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.true();\n      // exec.run.lastCall.args[1].should.eql([ 'install', 'a', 'foo' ]);\n      receivedPreEvent.should.have.property(\"module\", \"foo\");\n      receivedPreEvent.should.have.property(\"version\");\n      receivedPreEvent.should.have.property(\"dir\");\n      receivedPreEvent.should.eql(receivedPostEvent);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"skips npm install if preInstall returns false","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":155,"column":53,"index":4800},"line":155,"code":"    it(\"skips npm install if preInstall returns false\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        receivedPreEvent = event;\n        return false;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"function\",\n        libs: [{\n          module: \"foo\"\n        }]\n      }]);\n      exec.run.called.should.be.false();\n      receivedPreEvent.should.have.property(\"module\", \"foo\");\n      receivedPreEvent.should.have.property(\"version\");\n      receivedPreEvent.should.have.property(\"dir\");\n      receivedPreEvent.should.eql(receivedPostEvent);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"installs missing modules from inside subflow module","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":182,"column":59,"index":5716},"line":182,"code":"    it(\"installs missing modules from inside subflow module\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      externalModules.registerSubflow(\"sf\", {\n        \"flow\": [{\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }]\n        }]\n      });\n      await externalModules.checkFlowDependencies([{\n        type: \"sf\"\n      }]);\n      exec.run.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - 404","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":202,"column":34,"index":6238},"line":202,"code":"    it(\"reports install fail - 404\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleNotFound\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleNotFound\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", 404);\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - target","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":227,"column":37,"index":7102},"line":227,"code":"    it(\"reports install fail - target\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleVersionNotFound\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleVersionNotFound\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", 404);\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - unexpected","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":252,"column":41,"index":7984},"line":252,"code":"    it(\"reports install fail - unexpected\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleFail\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleFail\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"unexpected_error\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - multiple","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":277,"column":39,"index":8857},"line":277,"code":"    it(\"reports install fail - multiple\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"moduleNotFound\"\n          }, {\n            module: \"moduleFail\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.called.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(2);\n        // Sort the array so we know the order to test for\n        err.sort(function (A, B) {\n          return A.module.module.localeCompare(B.module.module);\n        });\n        err[1].should.have.property(\"module\");\n        err[1].module.should.have.property(\"module\", \"moduleNotFound\");\n        err[1].should.have.property(\"error\");\n        err[1].error.should.have.property(\"code\", 404);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"moduleFail\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"unexpected_error\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - install disabled","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":312,"column":47,"index":10182},"line":312,"code":"    it(\"reports install fail - install disabled\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            allowInstall: false\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([{\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        // Should not try to install\n        exec.run.called.should.be.false();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"foo\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"install_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - module disallowed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":343,"column":48,"index":11194},"line":343,"code":"    it(\"reports install fail - module disallowed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['foo']\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([\n        // foo disallowed\n        // bar allowed\n        {\n          type: \"function\",\n          libs: [{\n            module: \"foo\"\n          }, {\n            module: \"bar\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.calledOnce.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"foo\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"install_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"reports install fail - built-in module disallowed","suites":["externalModules api","checkFlowDependencies"],"updatePoint":{"line":378,"column":57,"index":12278},"line":378,"code":"    it(\"reports install fail - built-in module disallowed\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n      externalModules.register(\"function\", \"libs\");\n      try {\n        await externalModules.checkFlowDependencies([\n        // foo disallowed\n        // bar allowed\n        {\n          type: \"function\",\n          libs: [{\n            module: \"fs\"\n          }, {\n            module: \"bar\"\n          }]\n        }]);\n        throw new Error(\"checkFlowDependencies did not reject after install fail\");\n      } catch (err) {\n        exec.run.calledOnce.should.be.true();\n        Array.isArray(err).should.be.true();\n        err.should.have.length(1);\n        err[0].should.have.property(\"module\");\n        err[0].module.should.have.property(\"module\", \"fs\");\n        err[0].should.have.property(\"error\");\n        err[0].error.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"requires built-in modules","suites":["externalModules api","require"],"updatePoint":{"line":415,"column":33,"index":13382},"line":415,"code":"    it(\"requires built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      const result = externalModules.require(\"fs\");\n      result.should.eql(require(\"fs\"));\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects unknown modules","suites":["externalModules api","require"],"updatePoint":{"line":424,"column":31,"index":13646},"line":424,"code":"    it(\"rejects unknown modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      try {\n        externalModules.require(\"foo\");\n        throw new Error(\"require did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects disallowed modules","suites":["externalModules api","require"],"updatePoint":{"line":437,"column":34,"index":14029},"line":437,"code":"    it(\"rejects disallowed modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n      try {\n        externalModules.require(\"fs\");\n        throw new Error(\"require did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"import built-in modules","suites":["externalModules api","import"],"updatePoint":{"line":457,"column":31,"index":14555},"line":457,"code":"    it(\"import built-in modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      const result = await externalModules.import(\"fs\");\n      // `result` won't have the `should` property\n      should.exist(result);\n      should.exist(result.existsSync);\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects unknown modules","suites":["externalModules api","import"],"updatePoint":{"line":468,"column":31,"index":14902},"line":468,"code":"    it(\"rejects unknown modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {}\n      });\n      try {\n        await externalModules.import(\"foo\");\n        throw new Error(\"import did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"rejects disallowed modules","suites":["externalModules api","import"],"updatePoint":{"line":481,"column":34,"index":15289},"line":481,"code":"    it(\"rejects disallowed modules\", async function () {\n      externalModules.init({\n        userDir: homeDir,\n        get: () => {},\n        set: () => {},\n        externalModules: {\n          modules: {\n            denyList: ['fs']\n          }\n        }\n      });\n      try {\n        await externalModules.import(\"fs\");\n        throw new Error(\"import did not reject after fail\");\n      } catch (err) {\n        err.should.have.property(\"code\", \"module_not_allowed\");\n      }\n    });","file":"unit/@node-red/registry/lib/externalModules_spec.js","skipped":false,"dir":"test"},{"name":"intialises components","suites":["red/registry/index","#init"],"updatePoint":{"line":34,"column":29,"index":1284},"line":34,"code":"    it('intialises components', function () {\n      stubs.push(sinon.stub(installer, \"init\"));\n      stubs.push(sinon.stub(loader, \"init\"));\n      stubs.push(sinon.stub(typeRegistry, \"init\"));\n      registry.init({\n        settings: {}\n      });\n      installer.init.called.should.be.true();\n      loader.init.called.should.be.true();\n      typeRegistry.init.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the module and returns its info","suites":["red/registry/index","#addModule"],"updatePoint":{"line":47,"column":45,"index":1737},"line":47,"code":"    it('loads the module and returns its info', function (done) {\n      stubs.push(sinon.stub(loader, \"addModule\").callsFake(function (module) {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function (module) {\n        return \"info\";\n      }));\n      registry.addModule(\"foo\").then(function (info) {\n        info.should.eql(\"info\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects if loader rejects","suites":["red/registry/index","#addModule"],"updatePoint":{"line":61,"column":33,"index":2211},"line":61,"code":"    it('rejects if loader rejects', function (done) {\n      stubs.push(sinon.stub(loader, \"addModule\").callsFake(function (module) {\n        return Promise.reject(\"error\");\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function (module) {\n        return \"info\";\n      }));\n      registry.addModule(\"foo\").then(function (info) {\n        done(new Error(\"unexpected resolve\"));\n      }).catch(function (err) {\n        err.should.eql(\"error\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"enables a node set","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":77,"column":26,"index":2758},"line":77,"code":"    it('enables a node set', function (done) {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getNodeInfo\").callsFake(function () {\n        return {\n          id: \"node-set\",\n          loaded: true\n        };\n      }));\n      registry.enableNode(\"node-set\").then(function (ns) {\n        typeRegistry.enableNodeSet.called.should.be.true();\n        ns.should.have.a.property('id', 'node-set');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects if node unknown","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":95,"column":31,"index":3364},"line":95,"code":"    it('rejects if node unknown', function () {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        throw new Error('failure');\n      }));\n      /*jshint immed: false */\n      (function () {\n        registry.enableNode(\"node-set\");\n      }).should.throw();\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"triggers a node load","suites":["red/registry/index","#enableNode"],"updatePoint":{"line":104,"column":28,"index":3665},"line":104,"code":"    it('triggers a node load', function (done) {\n      stubs.push(sinon.stub(typeRegistry, \"enableNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      var calls = 0;\n      stubs.push(sinon.stub(typeRegistry, \"getNodeInfo\").callsFake(function () {\n        // loaded=false on first call, true on subsequent\n        return {\n          id: \"node-set\",\n          loaded: calls++ > 0\n        };\n      }));\n      stubs.push(sinon.stub(loader, \"loadNodeSet\").callsFake(function () {\n        return Promise.resolve();\n      }));\n      stubs.push(sinon.stub(typeRegistry, \"getFullNodeInfo\"));\n      registry.enableNode(\"node-set\").then(function (ns) {\n        typeRegistry.enableNodeSet.called.should.be.true();\n        loader.loadNodeSet.called.should.be.true();\n        ns.should.have.a.property('id', 'node-set');\n        ns.should.have.a.property('loaded', true);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects module name that includes version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":76,"column":49,"index":2396},"line":76,"code":"    it(\"rejects module name that includes version\", function (done) {\n      installer.installModule(\"module@version\", null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects missing module name","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":82,"column":35,"index":2636},"line":82,"code":"    it(\"rejects missing module name\", function (done) {\n      installer.installModule(\"\", null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects null module name","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":88,"column":32,"index":2859},"line":88,"code":"    it(\"rejects null module name\", function (done) {\n      installer.installModule(null, null, null).catch(function (err) {\n        err.code.should.be.eql('invalid_module_name');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid url","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":94,"column":27,"index":3079},"line":94,"code":"    it(\"rejects invalid url\", function (done) {\n      installer.installModule(\"module\", null, \"abc\").catch(function (err) {\n        err.code.should.be.eql('invalid_module_url');\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when npm returns a 404","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":100,"column":38,"index":3302},"line":100,"code":"    it(\"rejects when npm returns a 404\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" 404  this_wont_exist\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(\"this_wont_exist\").catch(function (err) {\n        err.should.have.property(\"code\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when npm does not find specified version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":114,"column":56,"index":3733},"line":114,"code":"    it(\"rejects when npm does not find specified version\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" version not found: this_wont_exist@0.1.2\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n        err.code.should.be.eql(404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested to existing version","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":133,"column":57,"index":4321},"line":133,"code":"    it(\"rejects when update requested to existing version\", function (done) {\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          user: true,\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.1\").catch(function (err) {\n        err.code.should.be.eql('module_already_loaded');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested to existing version and url","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":145,"column":65,"index":4750},"line":145,"code":"    it(\"rejects when update requested to existing version and url\", function (done) {\n      sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n        return {\n          user: true,\n          version: \"0.1.1\"\n        };\n      });\n      installer.installModule(\"this_wont_exist\", \"0.1.1\", \"https://example/foo-0.1.1.tgz\").catch(function (err) {\n        err.code.should.be.eql('module_already_loaded');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects with generic error","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":157,"column":34,"index":5181},"line":157,"code":"    it(\"rejects with generic error\", function (done) {\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \" kaboom!\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(\"this_wont_exist\").then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(err => {\n        // Expected result\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when module is found","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":173,"column":37,"index":5615},"line":173,"code":"    it(\"succeeds when module is found\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\").then(function (info) {\n        info.should.eql(nodeInfo);\n        // commsMessages.should.have.length(1);\n        // commsMessages[0].topic.should.equal(\"node/added\");\n        // commsMessages[0].msg.should.eql(nodeInfo.nodes);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when non-existant path is provided","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":199,"column":50,"index":6419},"line":199,"code":"    it(\"rejects when non-existant path is provided\", function (done) {\n      this.timeout(20000);\n      var resourcesDir = path.resolve(path.join(__dirname, \"resources\", \"local\", \"TestNodeModule\", \"node_modules\", \"NonExistant\"));\n      installer.installModule(resourcesDir).then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(function (err) {\n        if (err.hasOwnProperty(\"code\")) {\n          err.code.should.eql(404);\n          done();\n        } else {\n          console.log(\"ERRROR::\" + err.toString() + \"::\");\n          err.toString().should.eql(\"Error: Install failed\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when path is valid node-red module","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":215,"column":51,"index":7072},"line":215,"code":"    it(\"succeeds when path is valid node-red module\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      var resourcesDir = path.resolve(path.join(__dirname, \"resources\", \"local\", \"TestNodeModule\", \"node_modules\", \"TestNodeModule\"));\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.installModule(resourcesDir).then(function (info) {\n        info.should.eql(nodeInfo);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when url is valid node-red module","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":239,"column":50,"index":7836},"line":239,"code":"    it(\"succeeds when url is valid node-red module\", function (done) {\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", null, \"https://example/foo-0.1.1.tgz\").then(function (info) {\n        info.should.eql(nodeInfo);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"triggers preInstall and postInstall hooks","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":262,"column":49,"index":8508},"line":262,"code":"    it(\"triggers preInstall and postInstall hooks\", function (done) {\n      let receivedPreEvent, receivedPostEvent;\n      hooks.add(\"preInstall\", function (event) {\n        event.args = [\"a\"];\n        receivedPreEvent = event;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedPostEvent = event;\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").then(function (info) {\n        exec.run.called.should.be.true();\n        exec.run.lastCall.args[1].should.eql(['install', 'a', 'this_wont_exist@1.2.3']);\n        info.should.eql(nodeInfo);\n        should.exist(receivedPreEvent);\n        receivedPreEvent.should.have.property(\"module\", \"this_wont_exist\");\n        receivedPreEvent.should.have.property(\"version\", \"1.2.3\");\n        receivedPreEvent.should.have.property(\"dir\");\n        receivedPreEvent.should.have.property(\"url\");\n        receivedPreEvent.should.have.property(\"isExisting\");\n        receivedPreEvent.should.have.property(\"isUpgrade\");\n        receivedPreEvent.should.eql(receivedPostEvent);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"fails install if preInstall hook fails","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":303,"column":46,"index":10009},"line":303,"code":"    it(\"fails install if preInstall hook fails\", function (done) {\n      let receivedEvent;\n      hooks.add(\"preInstall\", function (event) {\n        throw new Error(\"preInstall-error\");\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").catch(function (err) {\n        exec.run.called.should.be.false();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"skips invoking npm if preInstall returns false","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":319,"column":54,"index":10490},"line":319,"code":"    it(\"skips invoking npm if preInstall returns false\", function (done) {\n      let receivedEvent;\n      hooks.add(\"preInstall\", function (event) {\n        return false;\n      });\n      hooks.add(\"postInstall\", function (event) {\n        receivedEvent = event;\n      });\n      var nodeInfo = {\n        nodes: {\n          module: \"foo\",\n          types: [\"a\"]\n        }\n      };\n      var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").then(function () {\n        exec.run.called.should.be.false();\n        should.exist(receivedEvent);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rollsback install if postInstall hook fails","suites":["nodes/registry/installer","installs module"],"updatePoint":{"line":342,"column":51,"index":11203},"line":342,"code":"    it(\"rollsback install if postInstall hook fails\", function (done) {\n      hooks.add(\"postInstall\", function (event) {\n        throw new Error(\"fail\");\n      });\n      installer.installModule(\"this_wont_exist\", \"1.2.3\").catch(function (err) {\n        exec.run.calledTwice.should.be.true();\n        exec.run.firstCall.args[1].includes(\"install\").should.be.true();\n        exec.run.secondCall.args[1].includes(\"remove\").should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with allowUpdate set to false","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":354,"column":69,"index":11754},"line":354,"code":"      it(\"rejects when update requested with allowUpdate set to false\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdate: false\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when update requested with module not on denyUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":373,"column":74,"index":12359},"line":373,"code":"      it(\"succeeds when update requested with module not on denyUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              denyUpdateList: ['this_wont_exist']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_is_allowed\", \"0.1.2\").then(function () {\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with module on denyUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":411,"column":69,"index":13512},"line":411,"code":"      it(\"rejects when update requested with module on denyUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              denyUpdateList: ['this_wont_exist']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when update requested with module on allowUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":450,"column":71,"index":14727},"line":450,"code":"      it(\"succeeds when update requested with module on allowUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdateList: ['this_is_allowed']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_is_allowed\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_is_allowed\", \"0.1.2\").then(function () {\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update requested with module not on allowUpdateList","suites":["nodes/registry/installer","installs module","allowUpdate lists"],"updatePoint":{"line":488,"column":74,"index":15886},"line":488,"code":"      it(\"rejects when update requested with module not on allowUpdateList\", function (done) {\n        installer.init({\n          externalModules: {\n            palette: {\n              allowUpdateList: ['this_is_allowed']\n            }\n          }\n        });\n        sinon.stub(typeRegistry, \"getModuleInfo\").callsFake(function () {\n          return {\n            user: true,\n            version: \"0.1.1\"\n          };\n        });\n        var res = {\n          code: 0,\n          stdout: \"\",\n          stderr: \"\"\n        };\n        var p = Promise.resolve(res);\n        p.catch(err => {});\n        execResponse = p;\n        var nodeInfo = {\n          nodes: {\n            module: \"this_wont_exist\",\n            types: [\"a\"]\n          }\n        };\n        var addModule = sinon.stub(registry, \"addModule\").callsFake(function (md) {\n          return Promise.resolve(nodeInfo);\n        });\n        sinon.stub(typeRegistry, \"setModulePendingUpdated\").callsFake(function () {\n          return Promise.resolve(nodeInfo);\n        });\n        installer.installModule(\"this_wont_exist\", \"0.1.2\").catch(function (err) {\n          err.code.should.be.eql('update_not_allowed');\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid module names","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":530,"column":36,"index":17127},"line":530,"code":"    it(\"rejects invalid module names\", function (done) {\n      var promises = [];\n      var rejectedCount = 0;\n      promises.push(installer.uninstallModule(\"this_wont_exist \").catch(() => {\n        rejectedCount++;\n      }));\n      promises.push(installer.uninstallModule(\"this_wont_exist;no_it_really_wont\").catch(() => {\n        rejectedCount++;\n      }));\n      Promise.all(promises).then(function () {\n        rejectedCount.should.eql(2);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"rejects with generic error","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":544,"column":34,"index":17615},"line":544,"code":"    it(\"rejects with generic error\", function (done) {\n      var nodeInfo = [{\n        module: \"foo\",\n        types: [\"a\"]\n      }];\n      var removeModule = sinon.stub(registry, \"removeModule\").callsFake(function (md) {\n        return Promise.resolve(nodeInfo);\n      });\n      var res = {\n        code: 1,\n        stdout: \"\",\n        stderr: \"error\"\n      };\n      var p = Promise.reject(res);\n      p.catch(err => {});\n      execResponse = p;\n      installer.uninstallModule(\"this_wont_exist\").then(function () {\n        done(new Error(\"Unexpected success\"));\n      }).catch(err => {\n        // Expected result\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"succeeds when module is found","suites":["nodes/registry/installer","uninstalls module"],"updatePoint":{"line":567,"column":37,"index":18266},"line":567,"code":"    it(\"succeeds when module is found\", function (done) {\n      var nodeInfo = [{\n        module: \"foo\",\n        types: [\"a\"]\n      }];\n      var removeModule = sinon.stub(typeRegistry, \"removeModule\").callsFake(function (md) {\n        return nodeInfo;\n      });\n      var getModuleInfo = sinon.stub(registry, \"getModuleInfo\").callsFake(function (md) {\n        return {\n          nodes: []\n        };\n      });\n      var res = {\n        code: 0,\n        stdout: \"\",\n        stderr: \"\"\n      };\n      var p = Promise.resolve(res);\n      p.catch(err => {});\n      execResponse = p;\n      sinon.stub(fs, \"statSync\").callsFake(function (fn) {\n        return {};\n      });\n      installer.uninstallModule(\"this_wont_exist\").then(function (info) {\n        info.should.eql(nodeInfo);\n        // commsMessages.should.have.length(1);\n        // commsMessages[0].topic.should.equal(\"node/removed\");\n        // commsMessages[0].msg.should.eql(nodeInfo);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/registry/lib/installer_spec.js","skipped":false,"dir":"test"},{"name":"returns null list when no modules have been registered","suites":["library api"],"updatePoint":{"line":23,"column":60,"index":936},"line":23,"code":"  it('returns null list when no modules have been registered', function () {\n    library.init();\n    should.not.exist(library.getExampleFlows());\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"returns null path when module is not known","suites":["library api"],"updatePoint":{"line":27,"column":48,"index":1076},"line":27,"code":"  it('returns null path when module is not known', function () {\n    library.init();\n    should.not.exist(library.getExampleFlowPath('foo', 'bar'));\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"returns a valid example path","suites":["library api"],"updatePoint":{"line":31,"column":34,"index":1217},"line":31,"code":"  it('returns a valid example path', function (done) {\n    library.init();\n    library.addExamplesDir(\"test-module\", path.resolve(__dirname + '/resources/examples')).then(function () {\n      try {\n        var flows = library.getExampleFlows();\n        flows.should.deepEqual({\n          \"test-module\": {\n            \"f\": [\"one\"]\n          }\n        });\n        var examplePath = library.getExampleFlowPath('test-module', 'one');\n        examplePath.should.eql(path.resolve(__dirname + '/resources/examples/one.json'));\n        library.removeExamplesDir('test-module');\n        try {\n          should.not.exist(library.getExampleFlows());\n          should.not.exist(library.getExampleFlowPath('test-module', 'one'));\n          done();\n        } catch (err) {\n          done(err);\n        }\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/registry/lib/library_spec.js","skipped":false,"dir":"test"},{"name":"load empty set without settings available","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":41,"column":49,"index":1547},"line":41,"code":"    it(\"load empty set without settings available\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        return {};\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return false;\n          }\n        }\n      });\n      loader.load(true).then(function () {\n        localfilesystem.getNodeFiles.called.should.be.true();\n        localfilesystem.getNodeFiles.lastCall.args[0].should.be.true();\n        registry.saveNodeList.called.should.be.false();\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load empty set with settings available triggers registery save","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":67,"column":70,"index":2369},"line":67,"code":"    it(\"load empty set with settings available triggers registery save\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        return {};\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load(true).then(function () {\n        registry.saveNodeList.called.should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - single node single file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":93,"column":69,"index":3105},"line":93,"code":"    it(\"load core node files scanned by lfs - single node single file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"node-red/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true);\n        module.nodes.TestNode1.should.have.property(\"types\");\n        module.nodes.TestNode1.types.should.have.a.length(1);\n        module.nodes.TestNode1.types[0].should.eql('test-node-1');\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.config.should.not.eql(\"\");\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.help.should.have.property(\"en-US\");\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode1');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-1');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - ignore html if disableEditor true","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":162,"column":79,"index":5996},"line":162,"code":"    it(\"load core node files scanned by lfs - ignore html if disableEditor true\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          disableEditor: true,\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"node-red/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true);\n        // With disableEditor true, the types property is not populated by the\n        // html file - but instead is populated as nodes register themselves.\n        // But for this test, we have stubbed out registerType, so we won't get any types\n        // module.nodes.TestNode1.should.have.property(\"types\");\n        // module.nodes.TestNode1.types.should.have.a.length(1);\n        // module.nodes.TestNode1.types[0].should.eql('test-node-1');\n\n        // With disableEditor set, config should be blank\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.config.should.eql(\"\");\n\n        // help should be an empty object\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.help.should.eql({});\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode1');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-1');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - multiple nodes single file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":239,"column":72,"index":9250},"line":239,"code":"    it(\"load core node files scanned by lfs - multiple nodes single file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"4.5.6\",\n          \"nodes\": {\n            \"MultipleNodes1\": {\n              \"file\": path.join(resourcesDir, \"MultipleNodes1\", \"MultipleNodes1.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"MultipleNodes1\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"4.5.6\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"id\", \"node-red/MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"module\", \"node-red\");\n        module.nodes.MultipleNodes1.should.have.property(\"name\", \"MultipleNodes1\");\n        module.nodes.MultipleNodes1.should.have.property(\"file\");\n        module.nodes.MultipleNodes1.should.have.property(\"template\");\n        module.nodes.MultipleNodes1.should.have.property(\"enabled\", true);\n        module.nodes.MultipleNodes1.should.have.property(\"loaded\", true);\n        module.nodes.MultipleNodes1.should.have.property(\"types\");\n        module.nodes.MultipleNodes1.types.should.have.a.length(2);\n        module.nodes.MultipleNodes1.types[0].should.eql('test-node-multiple-1a');\n        module.nodes.MultipleNodes1.types[1].should.eql('test-node-multiple-1b');\n        module.nodes.MultipleNodes1.should.have.property(\"config\");\n        module.nodes.MultipleNodes1.should.have.property(\"help\");\n        module.nodes.MultipleNodes1.should.have.property(\"namespace\", \"node-red\");\n        nodes.registerType.calledTwice.should.be.true();\n        nodes.registerType.firstCall.args[0].should.eql('node-red/MultipleNodes1');\n        nodes.registerType.firstCall.args[1].should.eql('test-node-multiple-1a');\n        nodes.registerType.secondCall.args[0].should.eql('node-red/MultipleNodes1');\n        nodes.registerType.secondCall.args[1].should.eql('test-node-multiple-1b');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - node with promise","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":309,"column":63,"index":12378},"line":309,"code":"    it(\"load core node files scanned by lfs - node with promise\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"2.4.6\",\n          \"nodes\": {\n            \"TestNode2\": {\n              \"file\": path.join(resourcesDir, \"TestNode2\", \"TestNode2.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode2\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"2.4.6\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"id\", \"node-red/TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode2.should.have.property(\"name\", \"TestNode2\");\n        module.nodes.TestNode2.should.have.property(\"file\");\n        module.nodes.TestNode2.should.have.property(\"template\");\n        module.nodes.TestNode2.should.have.property(\"enabled\", true);\n        module.nodes.TestNode2.should.have.property(\"loaded\", true);\n        module.nodes.TestNode2.should.have.property(\"types\");\n        module.nodes.TestNode2.types.should.have.a.length(1);\n        module.nodes.TestNode2.types[0].should.eql('test-node-2');\n        module.nodes.TestNode2.should.have.property(\"config\");\n        module.nodes.TestNode2.should.have.property(\"help\");\n        module.nodes.TestNode2.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.TestNode2.should.not.have.property('err');\n        nodes.registerType.calledOnce.should.be.true();\n        nodes.registerType.lastCall.args[0].should.eql('node-red/TestNode2');\n        nodes.registerType.lastCall.args[1].should.eql('test-node-2');\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - node with rejecting promise","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":377,"column":73,"index":15202},"line":377,"code":"    it(\"load core node files scanned by lfs - node with rejecting promise\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode3\": {\n              \"file\": path.join(resourcesDir, \"TestNode3\", \"TestNode3.js\"),\n              \"module\": \"node-red\",\n              \"name\": \"TestNode3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"id\", \"node-red/TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"module\", \"node-red\");\n        module.nodes.TestNode3.should.have.property(\"name\", \"TestNode3\");\n        module.nodes.TestNode3.should.have.property(\"file\");\n        module.nodes.TestNode3.should.have.property(\"template\");\n        module.nodes.TestNode3.should.have.property(\"enabled\", true);\n        module.nodes.TestNode3.should.have.property(\"loaded\", false);\n        module.nodes.TestNode3.should.have.property(\"types\");\n        module.nodes.TestNode3.types.should.have.a.length(1);\n        module.nodes.TestNode3.types[0].should.eql('test-node-3');\n        module.nodes.TestNode3.should.have.property(\"config\");\n        module.nodes.TestNode3.should.have.property(\"help\");\n        module.nodes.TestNode3.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.TestNode3.should.have.property('err', 'fail');\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"load core node files scanned by lfs - missing file","suites":["red/nodes/registry/loader","#load"],"updatePoint":{"line":443,"column":58,"index":17864},"line":443,"code":"    it(\"load core node files scanned by lfs - missing file\", function (done) {\n      stubs.push(sinon.stub(localfilesystem, \"getNodeFiles\").callsFake(function () {\n        var result = {};\n        result[\"node-red\"] = {\n          \"name\": \"node-red\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"DoesNotExist\": {\n              \"file\": path.join(resourcesDir, \"doesnotexist\"),\n              \"module\": \"node-red\",\n              \"name\": \"DoesNotExist\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.load().then(function (result) {\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"node-red\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"id\", \"node-red/DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"module\", \"node-red\");\n        module.nodes.DoesNotExist.should.have.property(\"name\", \"DoesNotExist\");\n        module.nodes.DoesNotExist.should.have.property(\"file\");\n        module.nodes.DoesNotExist.should.have.property(\"template\");\n        module.nodes.DoesNotExist.should.have.property(\"enabled\", true);\n        module.nodes.DoesNotExist.should.have.property(\"loaded\", false);\n        module.nodes.DoesNotExist.should.have.property(\"types\");\n        module.nodes.DoesNotExist.types.should.have.a.length(0);\n        module.nodes.DoesNotExist.should.have.property(\"config\", \"\");\n        module.nodes.DoesNotExist.should.have.property(\"help\", {});\n        module.nodes.DoesNotExist.should.have.property(\"namespace\", \"node-red\");\n        module.nodes.DoesNotExist.should.have.property('err');\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":567,"column":44,"index":23428},"line":567,"code":"    it(\"throws error if settings unavailable\", function () {\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return false;\n          }\n        }\n      });\n      /*jshint immed: false */\n      (function () {\n        loader.addModule(\"test-module\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns rejected error if module already loaded","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":585,"column":55,"index":23889},"line":585,"code":"    it(\"returns rejected error if module already loaded\", function (done) {\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return {};\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"test-module\").catch(function (err) {\n        err.code.should.eql(\"module_already_loaded\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns rejected error if module not found","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":606,"column":50,"index":24458},"line":606,"code":"    it(\"returns rejected error if module not found\", function (done) {\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        throw new Error(\"failure\");\n      }));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"test-module\").catch(function (err) {\n        err.message.should.eql(\"failure\");\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads module by name","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":630,"column":28,"index":25130},"line":630,"code":"    it(\"loads module by name\", function (done) {\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        var result = {};\n        result[\"TestNodeModule\"] = {\n          \"name\": \"TestNodeModule\",\n          \"version\": \"1.2.3\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNodeModule\", \"node_modules\", \"TestNodeModule\", \"TestNodeModule.js\"),\n              \"module\": \"TestNodeModule\",\n              \"name\": \"TestNode1\",\n              \"version\": \"1.2.3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return \"a node list\";\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        nodes: nodes,\n        log: {\n          info: function () {},\n          _: function () {}\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"TestNodeModule\").then(function (result) {\n        result.should.eql(\"TestNodeModule\");\n        registry.addModule.called.should.be.true();\n        var module = registry.addModule.lastCall.args[0];\n        module.should.have.property(\"name\", \"TestNodeModule\");\n        module.should.have.property(\"version\", \"1.2.3\");\n        module.should.have.property(\"nodes\");\n        module.nodes.should.have.property(\"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"id\", \"TestNodeModule/TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"module\", \"TestNodeModule\");\n        module.nodes.TestNode1.should.have.property(\"name\", \"TestNode1\");\n        module.nodes.TestNode1.should.have.property(\"file\");\n        module.nodes.TestNode1.should.have.property(\"template\");\n        module.nodes.TestNode1.should.have.property(\"enabled\", true);\n        module.nodes.TestNode1.should.have.property(\"loaded\", true);\n        module.nodes.TestNode1.should.have.property(\"types\");\n        module.nodes.TestNode1.types.should.have.a.length(1);\n        module.nodes.TestNode1.types[0].should.eql('test-node-mod-1');\n        module.nodes.TestNode1.should.have.property(\"config\");\n        module.nodes.TestNode1.should.have.property(\"help\");\n        module.nodes.TestNode1.should.have.property(\"namespace\", \"TestNodeModule\");\n        module.nodes.TestNode1.should.not.have.property('err');\n        nodes.registerType.calledOnce.should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"skips module that fails version check","suites":["red/nodes/registry/loader","#addModule"],"updatePoint":{"line":701,"column":45,"index":28094},"line":701,"code":"    it(\"skips module that fails version check\", function (done) {\n      // This module isn't already loaded\n      stubs.push(sinon.stub(registry, \"getNodeInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(registry, \"getModuleInfo\").callsFake(function () {\n        return null;\n      }));\n      stubs.push(sinon.stub(localfilesystem, \"getModuleFiles\").callsFake(function () {\n        var result = {};\n        result[\"TestNodeModule\"] = {\n          \"name\": \"TestNodeModule\",\n          \"version\": \"1.2.3\",\n          \"redVersion\": \"999.0.0\",\n          \"nodes\": {\n            \"TestNode1\": {\n              \"file\": path.join(resourcesDir, \"TestNodeModule\", \"node_modules\", \"TestNodeModule\", \"TestNodeModule.js\"),\n              \"module\": \"TestNodeModule\",\n              \"name\": \"TestNode1\",\n              \"version\": \"1.2.3\"\n            }\n          }\n        };\n        return result;\n      }));\n      stubs.push(sinon.stub(registry, \"saveNodeList\").callsFake(function () {\n        return \"a node list\";\n      }));\n      stubs.push(sinon.stub(registry, \"addModule\").callsFake(function () {\n        return;\n      }));\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.init({\n        log: {\n          \"_\": function () {},\n          warn: function () {}\n        },\n        nodes: nodes,\n        version: function () {\n          return \"0.12.0\";\n        },\n        settings: {\n          available: function () {\n            return true;\n          }\n        }\n      });\n      loader.addModule(\"TestNodeModule\").then(function (result) {\n        result.should.eql(\"TestNodeModule\");\n        registry.addModule.called.should.be.false();\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"registers a message catalog","suites":["red/nodes/registry/loader","#addModule"],"line":757,"code":"    it.skip('registers a message catalog');","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":true,"dir":"test"},{"name":"no-ops the load if node is not enabled","suites":["red/nodes/registry/loader","#loadNodeSet"],"updatePoint":{"line":760,"column":46,"index":30000},"line":760,"code":"    it(\"no-ops the load if node is not enabled\", function (done) {\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.loadNodeSet({\n        \"file\": path.join(resourcesDir, \"TestNode1\", \"TestNode1.js\"),\n        \"module\": \"node-red\",\n        \"name\": \"TestNode1\",\n        \"enabled\": false\n      }).then(function (node) {\n        node.enabled.should.be.false();\n        nodes.registerType.called.should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"handles node that errors on require","suites":["red/nodes/registry/loader","#loadNodeSet"],"updatePoint":{"line":775,"column":43,"index":30508},"line":775,"code":"    it(\"handles node that errors on require\", function (done) {\n      stubs.push(sinon.stub(nodes, \"registerType\"));\n      loader.loadNodeSet({\n        \"file\": path.join(resourcesDir, \"TestNode4\", \"TestNode4.js\"),\n        \"module\": \"node-red\",\n        \"name\": \"TestNode4\",\n        \"enabled\": true\n      }).then(function (node) {\n        node.enabled.should.be.true();\n        nodes.registerType.called.should.be.false();\n        node.should.have.property('err');\n        node.err.toString().should.eql(\"Error: fail to require (line:1)\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"returns preloaded help","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":794,"column":30,"index":31165},"line":794,"code":"    it(\"returns preloaded help\", function () {\n      loader.getNodeHelp({\n        help: {\n          en: \"foo\"\n        }\n      }, \"en\").should.eql(\"foo\");\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, caching result","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":801,"column":34,"index":31331},"line":801,"code":"    it(\"loads help, caching result\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        return 'bar';\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {\n          en: \"foo\"\n        }\n      };\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      node.help['fr'].should.eql(\"bar\");\n      fs.readFileSync.calledOnce.should.be.true();\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      fs.readFileSync.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, defaulting to en-US content","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":818,"column":47,"index":32003},"line":818,"code":"    it(\"loads help, defaulting to en-US content\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      node.help['en-US'] = 'foo';\n      loader.getNodeHelp(node, \"fr\").should.eql(\"foo\");\n      node.help['fr'].should.eql(\"foo\");\n      fs.readFileSync.calledOnce.should.be.true();\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"foo\");\n      fs.readFileSync.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"loads help, defaulting to en-US content for extra nodes","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":834,"column":63,"index":32712},"line":834,"code":"    it(\"loads help, defaulting to en-US content for extra nodes\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        if (path.indexOf(\"en-US\") >= 0) {\n          return 'bar';\n        }\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      delete node.help['en-US'];\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      node.help['fr'].should.eql(\"bar\");\n      fs.readFileSync.calledTwice.should.be.true();\n      fs.readFileSync.firstCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/fr/file.html\"));\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en-US/file.html\"));\n      loader.getNodeHelp(node, \"fr\").should.eql(\"bar\");\n      fs.readFileSync.calledTwice.should.be.true();\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"fails to load en-US help content","suites":["red/nodes/registry/loader","#getNodeHelp"],"updatePoint":{"line":854,"column":40,"index":33590},"line":854,"code":"    it(\"fails to load en-US help content\", function () {\n      stubs.push(sinon.stub(fs, \"readFileSync\").callsFake(function (path) {\n        throw new Error(\"not found\");\n      }));\n      var node = {\n        template: \"/tmp/node/directory/file.html\",\n        help: {}\n      };\n      delete node.help['en-US'];\n      should.not.exist(loader.getNodeHelp(node, \"en-US\"));\n      should.not.exist(node.help['en-US']);\n      fs.readFileSync.calledTwice.should.be.true();\n      fs.readFileSync.firstCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en-US/file.html\"));\n      fs.readFileSync.lastCall.args[0].should.eql(path.normalize(\"/tmp/node/directory/locales/en/file.html\"));\n      should.not.exist(loader.getNodeHelp(node, \"en-US\"));\n      fs.readFileSync.callCount.should.eql(4);\n    });","file":"unit/@node-red/registry/lib/loader_spec.js","skipped":false,"dir":"test"},{"name":"Finds all the node files in the resources tree","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":65,"column":54,"index":2857},"line":65,"code":"    it(\"Finds all the node files in the resources tree\", function (done) {\n      localfilesystem.init({\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      var nodes = nm.nodes;\n      checkNodes(nm.nodes, ['TestNode1', 'MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4'], ['TestNodeModule']);\n      i18n.registerMessageCatalog.called.should.be.true();\n      i18n.registerMessageCatalog.lastCall.args[0].should.eql('node-red');\n      i18n.registerMessageCatalog.lastCall.args[1].should.eql(path.resolve(path.join(resourcesDir, \"locales\")));\n      i18n.registerMessageCatalog.lastCall.args[2].should.eql('messages.json');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Includes node files from settings","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":82,"column":41,"index":3744},"line":82,"code":"    it(\"Includes node files from settings\", function (done) {\n      localfilesystem.init({\n        nodesIncludes: ['TestNode1.js'],\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode1'], ['MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4', 'TestNodeModule']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Excludes node files from settings","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":95,"column":41,"index":4317},"line":95,"code":"    it(\"Excludes node files from settings\", function (done) {\n      localfilesystem.init({\n        nodesExcludes: ['TestNode1.js'],\n        coreNodesDir: resourcesDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['MultipleNodes1', 'NestedNode', 'TestNode2', 'TestNode3', 'TestNode4'], ['TestNode1', 'TestNodeModule']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in userDir/nodes","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":108,"column":36,"index":4885},"line":108,"code":"    it(\"Finds nodes in userDir/nodes\", function (done) {\n      localfilesystem.init({\n        userDir: userDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (string)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":120,"column":49,"index":5339},"line":120,"code":"    it(\"Finds nodes in settings.nodesDir (string)\", function (done) {\n      localfilesystem.init({\n        nodesDir: userDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (string,relative path)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":132,"column":63,"index":5808},"line":132,"code":"    it(\"Finds nodes in settings.nodesDir (string,relative path)\", function (done) {\n      var relativeUserDir = path.join(\"test\", \"unit\", \"@node-red\", \"registry\", \"lib\", \"resources\", \"userDir\");\n      localfilesystem.init({\n        nodesDir: relativeUserDir\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes in settings.nodesDir (array)","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":145,"column":48,"index":6381},"line":145,"code":"    it(\"Finds nodes in settings.nodesDir (array)\", function (done) {\n      localfilesystem.init({\n        nodesDir: [userDir]\n      });\n      var nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNode5'], ['TestNode1']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes and icons only in nodesDir with files, icons and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":157,"column":92,"index":6881},"line":157,"code":"    it(\"Finds nodes and icons only in nodesDir with files, icons and valid node-red packages\", function (done) {\n      localfilesystem.init({\n        nodesDir: nodesDir1\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      nm.should.have.a.property(\"icons\");\n      checkNodes(nm.nodes, ['loose1', 'loose2'], []);\n      //1 icon in nodesDir1/icons/  - should be found\n      //2 icons in nodesDir1/loose2/icons/  - should be found\n      //1 icons in nodesDir1/node-red-node-testnode/icons/  - should be found\n      //1 icons in nodesDir1/regular_module/icons/  - should NOT be found\n      //total icon sets 3, total icons 4\n      nm.icons.should.have.a.property(\"length\", 3);\n      nm.icons[0].should.have.a.property(\"path\");\n      nm.icons[0].should.have.a.property(\"icons\", ['loose1.svg']);\n      nm.icons[1].should.have.a.property(\"path\");\n      nm.icons[1].should.have.a.property(\"icons\", ['loose2.svg', 'loose2b.svg']);\n      nm.icons[2].should.have.a.property(\"path\");\n      nm.icons[2].should.have.a.property(\"icons\", ['test.svg']);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Should not find node-red node in nodesDir with files, icons and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":182,"column":95,"index":8151},"line":182,"code":"    it(\"Should not find node-red node in nodesDir with files, icons and valid node-red packages\", function (done) {\n      // path contains a regular node module and a node-red node module\n      localfilesystem.init({\n        nodesDir: path.join(nodesDir1)\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      nm.nodes.should.have.a.property(\"loose1\");\n      nm.nodes.should.have.a.property(\"loose2\");\n      nm.nodes.should.not.have.a.property(\"regular_module\");\n      nm.nodes.should.not.have.a.property(\"node-red-node-testnode\");\n      for (let key of Object.keys(nm.nodes)) {\n        const n = nm.nodes[key];\n        n.file.indexOf(\"regular_module\").should.eql(-1, `found icons in a node-red module`);\n        n.file.indexOf(\"node-red-node-testnode\").should.eql(-1, `found icons in a node-red module`);\n      }\n      //1 icon in nodesDir1/icons/  - should be found\n      //2 icons in nodesDir1/loose2/icons/  - should be found\n      //1 icons in nodesDir1/node-red-node-testnode/icons/  - should be found\n      //1 icons in nodesDir1/regular_module/icons/  - should NOT be found\n      //total icon sets 3, total icons 4\n      nm.should.have.a.property(\"icons\");\n      nm.icons.should.have.a.property(\"length\", 3);\n      let iconCount = 0;\n      for (let index = 0; index < nm.icons.length; index++) {\n        const iconDir = nm.icons[index];\n        iconCount += iconDir.icons.length;\n        iconDir.path.indexOf(\"node-red-node-testnode\").should.eql(-1, `should not find icons in a node-red module`);\n      }\n      should(iconCount).eql(4, \"Should find only 4 icons\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Should not find node-red node in nodesDir when regular package and valid node-red packages","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":217,"column":98,"index":9955},"line":217,"code":"    it(\"Should not find node-red node in nodesDir when regular package and valid node-red packages\", function (done) {\n      localfilesystem.init({\n        nodesDir: path.join(nodesDir1, \"regular_module\")\n      });\n      const nodeList = localfilesystem.getNodeFiles(true);\n      nodeList.should.have.a.property(\"node-red\");\n      const nm = nodeList['node-red'];\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\", {});\n      nm.should.have.a.property(\"icons\");\n      nm.icons.should.have.a.property(\"length\", 1); //should find 1 icons folder\n      nm.icons[0].should.have.a.property(\"icons\", ['test.svg']); //should find 1 icon in regular package\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds nodes module path","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":231,"column":31,"index":10601},"line":231,"code":"    it(\"Finds nodes module path\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeList = localfilesystem.getNodeFiles();\n      nodeList.should.have.a.property(\"node-red\");\n      var nm = nodeList['node-red'];\n      // The `node-red` module is loaded differently to those scanned for\n      // It doesn't get the `path` property set. Maybe it should.\n      nm.should.have.a.property('name', 'node-red');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, [], ['TestNode1']);\n      nm = nodeList['TestNodeModule'];\n      nm.should.have.a.property('path');\n      nm.should.have.a.property('name', 'TestNodeModule');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['TestNodeMod1', 'TestNodeMod2'], [], 'TestNodeModule');\n      nm = nodeList['VersionMismatchModule'];\n      nm.should.have.a.property('path');\n      nm.should.have.a.property('name', 'VersionMismatchModule');\n      nm.should.have.a.property(\"nodes\");\n      checkNodes(nm.nodes, ['VersionMismatchMod1', 'VersionMismatchMod2'], [], 'VersionMismatchModule');\n      i18n.registerMessageCatalog.called.should.be.true();\n      i18n.registerMessageCatalog.lastCall.args[0].should.eql('node-red');\n      i18n.registerMessageCatalog.lastCall.args[1].should.eql(path.resolve(path.join(moduleDir, \"locales\")));\n      i18n.registerMessageCatalog.lastCall.args[2].should.eql('messages.json');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"finds locales directory","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"line":260,"code":"    it.skip(\"finds locales directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"finds icon path directory","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"line":261,"code":"    it.skip(\"finds icon path directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"scans icon files in the resources tree","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":262,"column":46,"index":12177},"line":262,"code":"    it(\"scans icon files in the resources tree\", function (done) {\n      var count = 0;\n      localfilesystem.init({\n        coreNodesDir: resourcesDir\n      });\n      var list = localfilesystem.getNodeFiles(true);\n      list.should.have.property(\"node-red\");\n      list[\"node-red\"].should.have.property(\"icons\");\n      list[\"node-red\"].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].should.have.property(\"path\", path.join(__dirname, \"resources/local/NestedDirectoryNode/NestedNode/icons\"));\n      list[\"node-red\"].icons[0].should.have.property(\"icons\");\n      list[\"node-red\"].icons[0].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].icons[0].should.eql(\"arrow-in.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"scans icons dir in library","suites":["red/nodes/registry/localfilesystem","#getNodeFiles"],"updatePoint":{"line":277,"column":34,"index":12886},"line":277,"code":"    it(\"scans icons dir in library\", function (done) {\n      var count = 0;\n      localfilesystem.init({\n        userDir: userDir\n      });\n      var list = localfilesystem.getNodeFiles(true);\n      list.should.have.property(\"node-red\");\n      list[\"node-red\"].should.have.property(\"icons\");\n      list[\"node-red\"].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].should.have.property(\"path\", path.join(__dirname, \"resources/userDir/lib/icons\"));\n      list[\"node-red\"].icons[0].should.have.property(\"icons\");\n      list[\"node-red\"].icons[0].icons.should.have.length(1);\n      list[\"node-red\"].icons[0].icons[0].should.eql(\"test_icon.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"gets a nodes module files","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":294,"column":33,"index":13610},"line":294,"code":"    it(\"gets a nodes module files\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeModule = localfilesystem.getModuleFiles('TestNodeModule');\n      nodeModule.should.have.a.property('TestNodeModule');\n      nodeModule['TestNodeModule'].should.have.a.property('name', 'TestNodeModule');\n      nodeModule['TestNodeModule'].should.have.a.property('version', '0.0.1');\n      nodeModule['TestNodeModule'].should.have.a.property('nodes');\n      nodeModule['TestNodeModule'].should.have.a.property('path');\n      checkNodes(nodeModule['TestNodeModule'].nodes, ['TestNodeMod1', 'TestNodeMod2'], [], 'TestNodeModule');\n      nodeModule = localfilesystem.getModuleFiles('VersionMismatchModule');\n      nodeModule.should.have.a.property('VersionMismatchModule');\n      nodeModule['VersionMismatchModule'].should.have.a.property('redVersion', '100.0.0');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds only 1 node-red node in nodesDir amongst legacy nodes and regular nodes","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":311,"column":85,"index":14605},"line":311,"code":"    it(\"Finds only 1 node-red node in nodesDir amongst legacy nodes and regular nodes\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir1, \"node-red-node-testnode\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 1);\n      loaded.indexOf('node-red-node-testnode').should.greaterThan(-1, \"Should load node-red-node-testnode\");\n      nodeModule['node-red-node-testnode'].should.have.a.property('name', 'node-red-node-testnode');\n      nodeModule['node-red-node-testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['node-red-node-testnode'].should.have.a.property('nodes');\n      nodeModule['node-red-node-testnode'].should.have.a.property('path');\n      nodeModule['node-red-node-testnode'].should.have.a.property('user', false);\n      checkNodes(nodeModule['node-red-node-testnode'].nodes, ['testnode'], [], 'node-red-node-testnode');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds a node-red node in nodesDir with a sub dir containing valid node-red package","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":328,"column":90,"index":15657},"line":328,"code":"    it(\"Finds a node-red node in nodesDir with a sub dir containing valid node-red package\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir1, \"node-red-node-testnode\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      nodeModule['node-red-node-testnode'].should.have.a.property('name', 'node-red-node-testnode');\n      nodeModule['node-red-node-testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['node-red-node-testnode'].should.have.a.property('nodes');\n      nodeModule['node-red-node-testnode'].should.have.a.property('path');\n      nodeModule['node-red-node-testnode'].should.have.a.property('user', false);\n      checkNodes(nodeModule['node-red-node-testnode'].nodes, ['testnode'], [], 'node-red-node-testnode');\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds 2 node-red modules and 1 plugin in nodesDir (in root of dir)","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":343,"column":74,"index":16534},"line":343,"code":"    it(\"Finds 2 node-red modules and 1 plugin in nodesDir (in root of dir)\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [nodesDir2]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 3);\n      loaded.indexOf('@test/testnode').should.greaterThan(-1, \"Should load @test/testnode\");\n      loaded.indexOf('testnode2').should.greaterThan(-1, \"Should load testnode2\");\n      loaded.indexOf('test-theme2').should.greaterThan(-1, \"Should load test-theme2\");\n      nodeModule['@test/testnode'].should.have.a.property('name', '@test/testnode');\n      nodeModule['@test/testnode'].should.have.a.property('version', '1.0.0');\n      nodeModule['@test/testnode'].should.have.a.property('nodes');\n      nodeModule['@test/testnode'].should.have.a.property('path');\n      nodeModule['@test/testnode'].should.have.a.property('user', false);\n      nodeModule['testnode2'].should.have.a.property('name', 'testnode2');\n      nodeModule['testnode2'].should.have.a.property('version', '1.0.0');\n      nodeModule['testnode2'].should.have.a.property('nodes');\n      nodeModule['testnode2'].should.have.a.property('path');\n      nodeModule['testnode2'].should.have.a.property('user', false);\n      nodeModule['test-theme2'].should.have.a.property('name', 'test-theme2');\n      nodeModule['test-theme2'].should.have.a.property('version', '0.0.1');\n      nodeModule['test-theme2'].should.have.a.property('nodes', {});\n      nodeModule['test-theme2'].should.have.a.property('path');\n      nodeModule['test-theme2'].should.have.a.property('user', false);\n      nodeModule['test-theme2'].should.have.a.property('plugins');\n      nodeModule['test-theme2'].plugins.should.have.a.property('test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('name', 'test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('module', 'test-theme2');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('version', '0.0.1');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('file');\n      nodeModule['test-theme2'].plugins['test-theme2'].should.have.a.property('local', false);\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"Finds 2 node-red modules and 1 plugin in nodesDir pointing to a node_modules dir","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":378,"column":88,"index":18882},"line":378,"code":"    it(\"Finds 2 node-red modules and 1 plugin in nodesDir pointing to a node_modules dir\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        nodesDir: [path.join(nodesDir3, \"node_modules\")]\n      });\n      const nodeModule = localfilesystem.getModuleFiles();\n      const loaded = Object.keys(nodeModule);\n      loaded.should.have.a.property(\"length\", 3);\n      loaded.indexOf('@test/testnode').should.greaterThan(-1, \"Should load @test/testnode\");\n      loaded.indexOf('@test/test-theme3').should.greaterThan(-1, \"Should load test-theme3\");\n      loaded.indexOf('testnode3').should.greaterThan(-1, \"Should load testnode3\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if a node isn't found","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":391,"column":45,"index":19512},"line":391,"code":"    it(\"throws an error if a node isn't found\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      /*jshint immed: false */\n      (function () {\n        localfilesystem.getModuleFiles('WontExistModule');\n      }).should.throw();\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"finds locales directory","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"line":402,"code":"    it.skip(\"finds locales directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"finds icon path directory","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"line":403,"code":"    it.skip(\"finds icon path directory\");","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":true,"dir":"test"},{"name":"scans icon files with a module file","suites":["red/nodes/registry/localfilesystem","#getModuleFiles"],"updatePoint":{"line":404,"column":43,"index":19909},"line":404,"code":"    it(\"scans icon files with a module file\", function (done) {\n      stubPathJoin();\n      localfilesystem.init({\n        coreNodesDir: moduleDir\n      });\n      var nodeModule = localfilesystem.getModuleFiles('TestNodeModule');\n      nodeModule.should.have.property(\"TestNodeModule\");\n      nodeModule.TestNodeModule.should.have.property('icons');\n      nodeModule.TestNodeModule.icons.should.have.length(1);\n      nodeModule.TestNodeModule.icons[0].should.have.property(\"path\");\n      nodeModule.TestNodeModule.icons[0].should.have.property(\"icons\");\n      nodeModule.TestNodeModule.icons[0].icons[0].should.eql(\"arrow-in.png\");\n      done();\n    });","file":"unit/@node-red/registry/lib/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"registers a plugin","suites":["red/nodes/registry/plugins","registerPlugin"],"updatePoint":{"line":47,"column":26,"index":1480},"line":47,"code":"    it(\"registers a plugin\", function () {\n      let pluginDef = {};\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      receivedEvents.length.should.eql(1);\n      receivedEvents[0].should.eql(\"a-plugin\");\n      should.exist(modules['test-module'].plugins['test-set'].plugins[0]);\n      modules['test-module'].plugins['test-set'].plugins[0].should.equal(pluginDef);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"calls a plugins onadd function","suites":["red/nodes/registry/plugins","registerPlugin"],"updatePoint":{"line":55,"column":38,"index":1897},"line":55,"code":"    it(\"calls a plugins onadd function\", function () {\n      let pluginDef = {\n        onadd: sinon.stub()\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      pluginDef.onadd.called.should.be.true();\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered plugin","suites":["red/nodes/registry/plugins","getPlugin"],"updatePoint":{"line":64,"column":35,"index":2186},"line":64,"code":"    it(\"returns a registered plugin\", function () {\n      let pluginDef = {};\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      pluginDef.should.equal(plugins.getPlugin(\"a-plugin\"));\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a plugins of a given type","suites":["red/nodes/registry/plugins","getPluginsByType"],"updatePoint":{"line":71,"column":41,"index":2467},"line":71,"code":"    it(\"returns a plugins of a given type\", function () {\n      let pluginDef = {\n        type: \"foo\"\n      };\n      let pluginDef2 = {\n        type: \"bar\"\n      };\n      let pluginDef3 = {\n        type: \"foo\"\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin2\", pluginDef2);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin3\", pluginDef3);\n      let fooPlugins = plugins.getPluginsByType(\"foo\");\n      let barPlugins = plugins.getPluginsByType(\"bar\");\n      let noPlugins = plugins.getPluginsByType(\"none\");\n      noPlugins.should.be.of.length(0);\n      fooPlugins.should.be.of.length(2);\n      fooPlugins.should.containEql(pluginDef);\n      fooPlugins.should.containEql(pluginDef3);\n      barPlugins.should.be.of.length(1);\n      barPlugins.should.containEql(pluginDef2);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets all plugin configs","suites":["red/nodes/registry/plugins","getPluginConfigs"],"updatePoint":{"line":96,"column":31,"index":3403},"line":96,"code":"    it(\"gets all plugin configs\", function () {\n      let configs = plugins.getPluginConfigs(\"en-US\");\n      configs.should.eql(`\n<!-- --- [red-plugin:test-module/test-set] --- -->\ntest-module-config`);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"returns a plugins of a given type","suites":["red/nodes/registry/plugins","getPluginList"],"updatePoint":{"line":104,"column":41,"index":3672},"line":104,"code":"    it(\"returns a plugins of a given type\", function () {\n      let pluginDef = {\n        type: \"foo\"\n      };\n      let pluginDef2 = {\n        type: \"bar\"\n      };\n      let pluginDef3 = {\n        type: \"foo\"\n      };\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", pluginDef);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin2\", pluginDef2);\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin3\", pluginDef3);\n      let pluginList = plugins.getPluginList();\n      JSON.stringify(pluginList).should.eql(JSON.stringify([{\n        \"id\": \"test-module/test-set\",\n        \"enabled\": true,\n        \"local\": false,\n        \"user\": false,\n        \"plugins\": [{\n          \"type\": \"foo\",\n          \"id\": \"a-plugin\",\n          \"module\": \"test-module\"\n        }, {\n          \"type\": \"bar\",\n          \"id\": \"a-plugin2\",\n          \"module\": \"test-module\"\n        }, {\n          \"type\": \"foo\",\n          \"id\": \"a-plugin3\",\n          \"module\": \"test-module\"\n        }]\n      }, {\n        \"id\": \"test-module/test-disabled-set\",\n        \"enabled\": false,\n        \"local\": false,\n        \"user\": false,\n        \"plugins\": []\n      }]));\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"exports plugin settings - default false","suites":["red/nodes/registry/plugins","exportPluginSettings"],"updatePoint":{"line":146,"column":47,"index":4902},"line":146,"code":"    it(\"exports plugin settings - default false\", function () {\n      plugins.init({\n        \"a-plugin\": {\n          a: 123,\n          b: 234,\n          c: 345\n        }\n      });\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", {\n        settings: {\n          a: {\n            exportable: true\n          },\n          b: {\n            exportable: false\n          },\n          d: {\n            exportable: true,\n            value: 456\n          }\n        }\n      });\n      var exportedSet = {};\n      plugins.exportPluginSettings(exportedSet);\n      exportedSet.should.have.property(\"a-plugin\");\n      // a is exportable\n      exportedSet[\"a-plugin\"].should.have.property(\"a\", 123);\n      // b is explicitly not exportable\n      exportedSet[\"a-plugin\"].should.not.have.property(\"b\");\n      // c isn't listed and default false\n      exportedSet[\"a-plugin\"].should.not.have.property(\"c\");\n      // d has a default value\n      exportedSet[\"a-plugin\"].should.have.property(\"d\", 456);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"exports plugin settings - default true","suites":["red/nodes/registry/plugins","exportPluginSettings"],"updatePoint":{"line":180,"column":46,"index":5904},"line":180,"code":"    it(\"exports plugin settings - default true\", function () {\n      plugins.init({\n        \"a-plugin\": {\n          a: 123,\n          b: 234,\n          c: 345\n        }\n      });\n      plugins.registerPlugin(\"test-module/test-set\", \"a-plugin\", {\n        settings: {\n          '*': {\n            exportable: true\n          },\n          a: {\n            exportable: true\n          },\n          b: {\n            exportable: false\n          },\n          d: {\n            exportable: true,\n            value: 456\n          }\n        }\n      });\n      var exportedSet = {};\n      plugins.exportPluginSettings(exportedSet);\n      exportedSet.should.have.property(\"a-plugin\");\n      // a is exportable\n      exportedSet[\"a-plugin\"].should.have.property(\"a\", 123);\n      // b is explicitly not exportable\n      exportedSet[\"a-plugin\"].should.not.have.property(\"b\");\n      // c isn't listed, but default true\n      exportedSet[\"a-plugin\"].should.have.property(\"c\");\n      // d has a default value\n      exportedSet[\"a-plugin\"].should.have.property(\"d\", 456);\n    });","file":"unit/@node-red/registry/lib/plugins_spec.js","skipped":false,"dir":"test"},{"name":"loads initial config","suites":["red/nodes/registry/registry","#init/load"],"updatePoint":{"line":95,"column":28,"index":2630},"line":95,"code":"    it('loads initial config', function (done) {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.load();\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"migrates legacy format","suites":["red/nodes/registry/registry","#init/load"],"updatePoint":{"line":102,"column":30,"index":2914},"line":102,"code":"    it('migrates legacy format', function (done) {\n      var legacySettings = {\n        available: function () {\n          return true;\n        },\n        set: sinon.stub().returns(Promise.resolve()),\n        get: function () {\n          return {\n            \"123\": {\n              \"name\": \"72-sentiment.js\",\n              \"types\": [\"sentiment\"],\n              \"enabled\": true\n            },\n            \"456\": {\n              \"name\": \"20-inject.js\",\n              \"types\": [\"inject\"],\n              \"enabled\": true\n            },\n            \"789\": {\n              \"name\": \"testModule:a-module.js\",\n              \"types\": [\"example\"],\n              \"enabled\": true,\n              \"module\": \"testModule\"\n            }\n          };\n        }\n      };\n      var expected = JSON.parse('{\"node-red\":{\"name\":\"node-red\",\"nodes\":{\"sentiment\":{\"name\":\"sentiment\",\"types\":[\"sentiment\"],\"enabled\":true,\"module\":\"node-red\"},\"inject\":{\"name\":\"inject\",\"types\":[\"inject\"],\"enabled\":true,\"module\":\"node-red\"}}},\"testModule\":{\"name\":\"testModule\",\"nodes\":{\"a-module.js\":{\"name\":\"a-module.js\",\"types\":[\"example\"],\"enabled\":true,\"module\":\"testModule\"}}}}');\n      typeRegistry.init(legacySettings, null);\n      typeRegistry.load();\n      legacySettings.set.calledOnce.should.be.true();\n      legacySettings.set.args[0][1].should.eql(expected);\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"adds a node set for an unknown module","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":138,"column":45,"index":4327},"line":138,"code":"    it('adds a node set for an unknown module', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var moduleList = typeRegistry.getModuleList();\n      moduleList.should.have.a.property(\"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"name\", \"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"version\", \"0.0.1\");\n      moduleList[\"test-module\"].should.have.a.property(\"nodes\");\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      moduleList[\"test-module\"].nodes[\"test-name\"].should.eql({\n        config: 'configA',\n        id: 'test-module/test-name',\n        module: 'test-module',\n        name: 'test-name',\n        enabled: true,\n        loaded: false,\n        types: ['test-a', 'test-b']\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"adds a node set to an existing module","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":160,"column":45,"index":5366},"line":160,"code":"    it('adds a node set to an existing module', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var moduleList = typeRegistry.getModuleList();\n      Object.keys(moduleList).should.have.a.lengthOf(1);\n      moduleList.should.have.a.property(\"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"name\", \"test-module\");\n      moduleList[\"test-module\"].should.have.a.property(\"version\", \"0.0.1\");\n      moduleList[\"test-module\"].should.have.a.property(\"nodes\");\n      Object.keys(moduleList[\"test-module\"].nodes).should.have.a.lengthOf(1);\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      typeRegistry.addNodeSet(\"test-module/test-name-2\", testNodeSet2);\n      typeRegistry.getNodeList().should.have.lengthOf(2);\n      moduleList = typeRegistry.getModuleList();\n      Object.keys(moduleList).should.have.a.lengthOf(1);\n      Object.keys(moduleList[\"test-module\"].nodes).should.have.a.lengthOf(2);\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name\");\n      moduleList[\"test-module\"].nodes.should.have.a.property(\"test-name-2\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"doesnt add node set types if node set has an error","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":182,"column":58,"index":6741},"line":182,"code":"    it('doesnt add node set types if node set has an error', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getTypeId(\"test-a\").should.eql(\"test-module/test-name\");\n      should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n      typeRegistry.addNodeSet(\"test-module/test-name-2\", testNodeSet2WithError, \"0.0.1\");\n      should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"doesnt add node set if type already exists","suites":["red/nodes/registry/registry","#addNodeSet"],"updatePoint":{"line":192,"column":50,"index":7327},"line":192,"code":"    it('doesnt add node set if type already exists', function () {\n      typeRegistry.init(settings, null);\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n      typeRegistry.getModuleList().should.eql({});\n      should.not.exist(typeRegistry.getTypeId(\"test-e\"));\n      typeRegistry.addNodeSet(\"test-module/test-name\", testNodeSet1, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      should.exist(typeRegistry.getTypeId(\"test-a\"));\n      typeRegistry.addNodeSet(testNodeSet3.id, testNodeSet3, \"0.0.1\");\n      typeRegistry.getNodeList().should.have.lengthOf(2);\n\n      // testNodeSet3 registers a duplicate test-a and unique test-e\n      // as test-a is a duplicate, test-e should not get registered\n      should.not.exist(typeRegistry.getTypeId(\"test-e\"));\n      var testNodeSet3Result = typeRegistry.getNodeList()[1];\n      should.exist(testNodeSet3Result.err);\n      testNodeSet3Result.err.code.should.equal(\"type_already_registered\");\n      testNodeSet3Result.err.details.type.should.equal(\"test-a\");\n      testNodeSet3Result.err.details.moduleA.should.equal(\"test-module\");\n      testNodeSet3Result.err.details.moduleB.should.equal(\"test-module-2\");\n\n      //\n      // typeRegistry.addNodeSet(\"test-module/test-name-2\",testNodeSet2WithError, \"0.0.1\");\n      //\n      // should.not.exist(typeRegistry.getTypeId(\"test-c\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/registry","#enableNodeSet"],"updatePoint":{"line":221,"column":44,"index":8739},"line":221,"code":"    it('throws error if settings unavailable', function () {\n      typeRegistry.init(settings, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.enableNodeSet(\"test-module/test-name\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error if module unknown","suites":["red/nodes/registry/registry","#enableNodeSet"],"updatePoint":{"line":228,"column":38,"index":9003},"line":228,"code":"    it('throws error if module unknown', function () {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.enableNodeSet(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised id: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"enables the node","suites":["red/nodes/registry/registry","#enableNodeSet"],"line":235,"code":"    it.skip('enables the node', function () {});","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"throws error if settings unavailable","suites":["red/nodes/registry/registry","#disableNodeSet"],"updatePoint":{"line":238,"column":44,"index":9413},"line":238,"code":"    it('throws error if settings unavailable', function () {\n      typeRegistry.init(settings, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.disableNodeSet(\"test-module/test-name\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error if module unknown","suites":["red/nodes/registry/registry","#disableNodeSet"],"updatePoint":{"line":245,"column":38,"index":9678},"line":245,"code":"    it('throws error if module unknown', function () {\n      typeRegistry.init(settingsWithStorageAndInitialConfig, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.disableNodeSet(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised id: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"disables the node","suites":["red/nodes/registry/registry","#disableNodeSet"],"line":252,"code":"    it.skip('disables the node', function () {});","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"returns nothing for an unregistered type config","suites":["red/nodes/registry/registry","#getNodeConfig"],"updatePoint":{"line":255,"column":55,"index":10100},"line":255,"code":"    it('returns nothing for an unregistered type config', function (done) {\n      typeRegistry.init(settings, null);\n      var config = typeRegistry.getNodeConfig(\"imaginary-shark\");\n      (config === null).should.be.true();\n      done();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"rejects when settings unavailable","suites":["red/nodes/registry/registry","#saveNodeList"],"updatePoint":{"line":263,"column":41,"index":10381},"line":263,"code":"    it('rejects when settings unavailable', function (done) {\n      typeRegistry.init(stubSettings({}, false, {}), null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            module: \"test-module\",\n            name: \"test-name\",\n            types: []\n          }\n        }\n      });\n      typeRegistry.saveNodeList().catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"saves the list","suites":["red/nodes/registry/registry","#saveNodeList"],"updatePoint":{"line":280,"column":22,"index":10823},"line":280,"code":"    it('saves the list', function (done) {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": testNodeSet1,\n          \"test-name-2\": testNodeSet2WithError\n        }\n      });\n      typeRegistry.saveNodeList().then(function () {\n        s.set.called.should.be.true();\n        s.set.lastCall.args[0].should.eql('nodes');\n        var nodes = s.set.lastCall.args[1];\n        nodes.should.have.property('test-module');\n        for (var n in nodes['test-module'].nodes) {\n          if (nodes['test-module'].nodes.hasOwnProperty(n)) {\n            var nn = nodes['test-module'].nodes[n];\n            nn.should.not.have.property('err');\n            nn.should.not.have.property('id');\n          }\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown module","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":310,"column":39,"index":11821},"line":310,"code":"    it('throws error for unknown module', function () {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.removeModule(\"test-module/unknown\");\n      }).should.throw(\"Unrecognised module: test-module/unknown\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unavaiable settings","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":318,"column":44,"index":12143},"line":318,"code":"    it('throws error for unavaiable settings', function () {\n      var s = stubSettings({}, false, {});\n      typeRegistry.init(s, null);\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.removeModule(\"test-module/unknown\");\n      }).should.throw(\"Settings unavailable\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"removes a known module","suites":["red/nodes/registry/registry","#removeModule"],"updatePoint":{"line":326,"column":30,"index":12432},"line":326,"code":"    it('removes a known module', function () {\n      var s = stubSettings({}, true, {});\n      typeRegistry.init(s, null);\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": testNodeSet1\n        }\n      });\n      var moduleList = typeRegistry.getModuleList();\n      moduleList.should.have.a.property(\"test-module\");\n      typeRegistry.getNodeList().should.have.lengthOf(1);\n      var info = typeRegistry.removeModule('test-module');\n      moduleList = typeRegistry.getModuleList();\n      moduleList.should.not.have.a.property(\"test-module\");\n      typeRegistry.getNodeList().should.have.lengthOf(0);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node config","suites":["red/nodes/registry/registry","#get[All]NodeConfigs"],"updatePoint":{"line":346,"column":27,"index":13167},"line":346,"code":"    it('returns node config', function () {\n      typeRegistry.init(settings, {\n        getNodeHelp: function (config) {\n          return \"HE\" + config.name + \"LP\";\n        }\n      });\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"]\n          },\n          \"test-name-2\": {\n            id: \"test-module/test-name-2\",\n            module: \"test-module\",\n            name: \"test-name-2\",\n            enabled: true,\n            loaded: false,\n            config: \"configB\",\n            types: [\"test-c\", \"test-d\"]\n          }\n        }\n      });\n      typeRegistry.getNodeConfig(\"test-module/test-name\").should.eql('<!-- --- [red-module:test-module/test-name] --- -->\\nconfigAHEtest-nameLP');\n      typeRegistry.getNodeConfig(\"test-module/test-name-2\").should.eql('<!-- --- [red-module:test-module/test-name-2] --- -->\\nconfigBHEtest-name-2LP');\n      typeRegistry.getAllNodeConfigs().should.eql('\\n<!-- --- [red-module:test-module/test-name] --- -->\\nconfigAHEtest-nameLP\\n<!-- --- [red-module:test-module/test-name-2] --- -->\\nconfigBHEtest-name-2LP');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns module info","suites":["red/nodes/registry/registry","#getModuleInfo"],"updatePoint":{"line":382,"column":27,"index":14586},"line":382,"code":"    it('returns module info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var moduleInfo = typeRegistry.getModuleInfo(\"test-module\");\n      moduleInfo.should.have.a.property('name', 'test-module');\n      moduleInfo.should.have.a.property('version', '0.0.1');\n      moduleInfo.should.have.a.property('nodes');\n      moduleInfo.nodes.should.have.a.lengthOf(1);\n      moduleInfo.nodes[0].should.have.a.property('id', 'test-module/test-name');\n      moduleInfo.nodes[0].should.not.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["red/nodes/registry/registry","#getNodeInfo"],"updatePoint":{"line":410,"column":25,"index":15573},"line":410,"code":"    it('returns node info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var nodeSetInfo = typeRegistry.getNodeInfo(\"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('id', \"test-module/test-name\");\n      nodeSetInfo.should.not.have.a.property('config');\n      nodeSetInfo.should.not.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["red/nodes/registry/registry","#getFullNodeInfo"],"updatePoint":{"line":435,"column":25,"index":16388},"line":435,"code":"    it('returns node info', function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        }\n      });\n      var nodeSetInfo = typeRegistry.getFullNodeInfo(\"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('id', \"test-module/test-name\");\n      nodeSetInfo.should.have.a.property('config');\n      nodeSetInfo.should.have.a.property('file');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"cleans the module list","suites":["red/nodes/registry/registry","#cleanModuleList"],"line":460,"code":"    it.skip(\"cleans the module list\");","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":true,"dir":"test"},{"name":"returns a filtered list","suites":["red/nodes/registry/registry","#getNodeList"],"updatePoint":{"line":463,"column":31,"index":17291},"line":463,"code":"    it(\"returns a filtered list\", function () {\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          },\n          \"test-name-2\": {\n            id: \"test-module/test-name-2\",\n            module: \"test-module\",\n            name: \"test-name-2\",\n            enabled: true,\n            loaded: false,\n            config: \"configB\",\n            types: [\"test-c\", \"test-d\"],\n            file: \"def\"\n          }\n        }\n      });\n      var filterCallCount = 0;\n      var filteredList = typeRegistry.getNodeList(function (n) {\n        filterCallCount++;\n        return n.name === 'test-name-2';\n      });\n      filterCallCount.should.eql(2);\n      filteredList.should.have.a.lengthOf(1);\n      filteredList[0].should.have.a.property('id', \"test-module/test-name-2\");\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"registers a node constructor","suites":["red/nodes/registry/registry","#registerNodeConstructor"],"updatePoint":{"line":510,"column":36,"index":18732},"line":510,"code":"    it('registers a node constructor', function () {\n      typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      events.emit.calledOnce.should.be.true();\n      events.emit.lastCall.args[0].should.eql('type-registered');\n      events.emit.lastCall.args[1].should.eql('node-type');\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"throws error on duplicate node registration","suites":["red/nodes/registry/registry","#registerNodeConstructor"],"updatePoint":{"line":516,"column":51,"index":19071},"line":516,"code":"    it('throws error on duplicate node registration', function () {\n      typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      events.emit.calledOnce.should.be.true();\n      events.emit.lastCall.args[0].should.eql('type-registered');\n      events.emit.lastCall.args[1].should.eql('node-type');\n      /*jshint immed: false */\n      (function () {\n        typeRegistry.registerNodeConstructor('node-set', 'node-type', TestNodeConstructor);\n      }).should.throw(\"node-type already registered\");\n      events.emit.calledOnce.should.be.true();\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns the null when getting an unknown icon","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":529,"column":53,"index":19709},"line":529,"code":"    it('returns the null when getting an unknown icon', function () {\n      var iconPath = typeRegistry.getNodeIconPath('random-module', 'youwonthaveme.png');\n      should.not.exist(iconPath);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered icon","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":533,"column":33,"index":19890},"line":533,"code":"    it('returns a registered icon', function () {\n      var testIcon = path.resolve(__dirname + '/resources/userDir/lib/icons/');\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        },\n        icons: [{\n          path: testIcon,\n          icons: ['test_icon.png']\n        }]\n      });\n      var iconPath = typeRegistry.getNodeIconPath('test-module', 'test_icon.png');\n      iconPath.should.eql(path.resolve(testIcon + \"/test_icon.png\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns null when getting an unknown module","suites":["red/nodes/registry/registry","#getNodeIconPath"],"updatePoint":{"line":559,"column":51,"index":20746},"line":559,"code":"    it('returns null when getting an unknown module', function () {\n      var debugIcon = path.resolve(__dirname + '/../../../public/icons/debug.png');\n      var iconPath = typeRegistry.getNodeIconPath('unknown-module', 'debug.png');\n      should.not.exist(iconPath);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns empty icon list when no modules are registered","suites":["red/nodes/registry/registry","#getNodeIcons"],"updatePoint":{"line":566,"column":62,"index":21081},"line":566,"code":"    it('returns empty icon list when no modules are registered', function () {\n      var iconList = typeRegistry.getNodeIcons();\n      iconList.should.eql({});\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"returns an icon list of registered node module","suites":["red/nodes/registry/registry","#getNodeIcons"],"updatePoint":{"line":570,"column":54,"index":21241},"line":570,"code":"    it('returns an icon list of registered node module', function () {\n      var testIcon = path.resolve(__dirname + '/resources/userDir/lib/icons/');\n      typeRegistry.init(settings, {});\n      typeRegistry.addModule({\n        name: \"test-module\",\n        version: \"0.0.1\",\n        nodes: {\n          \"test-name\": {\n            id: \"test-module/test-name\",\n            module: \"test-module\",\n            name: \"test-name\",\n            enabled: true,\n            loaded: false,\n            config: \"configA\",\n            types: [\"test-a\", \"test-b\"],\n            file: \"abc\"\n          }\n        },\n        icons: [{\n          path: testIcon,\n          icons: ['test_icon.png']\n        }]\n      });\n      var iconList = typeRegistry.getNodeIcons();\n      iconList.should.eql({\n        \"test-module\": [\"test_icon.png\"]\n      });\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns valid resource path","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":622,"column":35,"index":22697},"line":622,"code":"    it('Returns valid resource path', function () {\n      const result = typeRegistry.getModuleResource(\"test-module\", \"one.json\");\n      should.exist(result);\n      result.should.eql(path.join(__dirname, \"resources\", \"examples\", \"one.json\"));\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns null for path that tries to break out","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":627,"column":53,"index":22967},"line":627,"code":"    it('Returns null for path that tries to break out', function () {\n      // Note - this path exists, but we don't allow .. in the resolved path to\n      // avoid breaking out of the resources dir\n      const result = typeRegistry.getModuleResource(\"test-module\", \"../../index_spec.js\");\n      should.not.exist(result);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"Returns null for path that does not exist","suites":["red/nodes/registry/registry","#getModuleResource"],"updatePoint":{"line":633,"column":49,"index":23293},"line":633,"code":"    it('Returns null for path that does not exist', function () {\n      const result = typeRegistry.getModuleResource(\"test-module\", \"two.json\");\n      should.not.exist(result);\n    });","file":"unit/@node-red/registry/lib/registry_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS","suites":["red/nodes/registry/subflow"],"line":2,"code":"  it.skip(\"NEEDS TESTS\");","file":"unit/@node-red/registry/lib/subflow_spec.js","skipped":true,"dir":"test"},{"name":"builds node-specific view of runtime api","suites":["red/nodes/registry/util","createNodeApi"],"updatePoint":{"line":42,"column":48,"index":1594},"line":42,"code":"    it(\"builds node-specific view of runtime api\", function () {\n      registryUtil.init(runtime);\n      var result = registryUtil.createNodeApi({\n        id: \"my-node\",\n        namespace: \"my-namespace\"\n      });\n      // Need a better strategy here.\n      // For now, validate the node-custom functions\n\n      var message = result._(\"message\");\n      // This should prepend the node's namespace to the message\n      message.should.eql(['my-namespace:message']);\n      var nodeConstructor = () => {};\n      var nodeOpts = {};\n      result.nodes.registerType(\"type\", nodeConstructor, nodeOpts);\n      registerType.called.should.be.true();\n      registerType.lastCall.args[0].should.eql(\"my-node\");\n      registerType.lastCall.args[1].should.eql(\"type\");\n      registerType.lastCall.args[2].should.eql(nodeConstructor);\n      registerType.lastCall.args[3].should.eql(nodeOpts);\n      var subflowDef = {};\n      result.nodes.registerSubflow(subflowDef);\n      registerSubflow.called.should.be.true();\n      registerSubflow.lastCall.args[0].should.eql(\"my-node\");\n      registerSubflow.lastCall.args[1].should.eql(subflowDef);\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"allows module with no allow/deny list provided","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":73,"column":54,"index":2998},"line":73,"code":"    it(\"allows module with no allow/deny list provided\", function () {\n      checkList(\"abc\", \"1.2.3\", [], []).should.be.true();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"defaults allow to * when only deny list is provided","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":76,"column":59,"index":3140},"line":76,"code":"    it(\"defaults allow to * when only deny list is provided\", function () {\n      checkList(\"abc\", \"1.2.3\", [\"*\"], [\"def\"]).should.be.true();\n      checkList(\"def\", \"1.2.3\", [\"*\"], [\"def\"]).should.be.false();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"uses most specific matching rule","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":80,"column":40,"index":3338},"line":80,"code":"    it(\"uses most specific matching rule\", function () {\n      checkList(\"abc\", \"1.2.3\", [\"ab*\"], [\"a*\"]).should.be.true();\n      checkList(\"def\", \"1.2.3\", [\"d*\"], [\"de*\"]).should.be.false();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"checks version string using semver rules","suites":["red/nodes/registry/util","checkModuleAllowed"],"updatePoint":{"line":84,"column":48,"index":3546},"line":84,"code":"    it(\"checks version string using semver rules\", function () {\n      // Deny\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.2\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.4\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@>1.2.3\"], [\"*\"]).should.be.false();\n      checkList(\"abc\", \"1.2.3\", [\"abc@>=1.2.3\"], [\"abc\"]).should.be.false();\n      checkList(\"node-red-contrib-foo\", \"1.2.3\", [\"*\"], [\"*contrib*\"]).should.be.false();\n\n      // Allow\n      checkList(\"abc\", \"1.2.3\", [\"abc@1.2.3\"], [\"*\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc@<1.2.4\"], [\"*\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc\"], [\"abc@>1.2.3\"]).should.be.true();\n      checkList(\"abc\", \"1.2.3\", [\"abc\"], [\"abc@<1.2.3||>1.2.3\"]).should.be.true();\n      checkList(\"node-red-contrib-foo\", \"1.2.3\", [\"*contrib*\"], [\"*\"]).should.be.true();\n    });","file":"unit/@node-red/registry/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"runtime events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":58,"column":22,"index":1827},"line":58,"code":"    it('runtime events', function () {\n      eventHandlers.should.have.property('runtime-event');\n      eventHandlers['runtime-event']({\n        id: \"my-event\",\n        payload: \"my-payload\"\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"notification/my-event\");\n      messages[0].should.have.property(\"data\", \"my-payload\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"status events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":68,"column":21,"index":2209},"line":68,"code":"    it('status events', function () {\n      eventHandlers.should.have.property('node-status');\n      eventHandlers['node-status']({\n        id: \"my-event\",\n        status: {\n          text: \"my-status\",\n          badProperty: \"should be filtered\"\n        }\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"status/my-event\");\n      messages[0].should.have.property(\"data\");\n      messages[0].data.should.have.property(\"text\", \"my-status\");\n      messages[0].data.should.not.have.property(\"badProperty\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"comms events","suites":["runtime-api/comms","listens for events"],"updatePoint":{"line":83,"column":20,"index":2767},"line":83,"code":"    it('comms events', function () {\n      eventHandlers.should.have.property('runtime-event');\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(1);\n      messages[0].should.have.property(\"topic\", \"my-topic\");\n      messages[0].should.have.property(\"data\", \"my-payload\");\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"adds new connections","suites":["runtime-api/comms","manages connections"],"updatePoint":{"line":138,"column":28,"index":4198},"line":138,"code":"    it('adds new connections', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection1\n      }).then(function () {\n        eventHandlers['comms']({\n          topic: \"my-topic\",\n          data: \"my-payload\"\n        });\n        messages.should.have.length(1);\n        comms.addConnection({\n          client: clientConnection2\n        }).then(function () {\n          eventHandlers['comms']({\n            topic: \"my-topic\",\n            data: \"my-payload\"\n          });\n          messages.should.have.length(3);\n          done();\n        }).catch(done);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"removes connections","suites":["runtime-api/comms","manages connections"],"updatePoint":{"line":164,"column":27,"index":4921},"line":164,"code":"    it('removes connections', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-topic\",\n        data: \"my-payload\"\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection1\n      }).then(function () {\n        comms.addConnection({\n          client: clientConnection2\n        }).then(function () {\n          eventHandlers['comms']({\n            topic: \"my-topic\",\n            data: \"my-payload\"\n          });\n          messages.should.have.length(2);\n          comms.removeConnection({\n            client: clientConnection1\n          }).then(function () {\n            eventHandlers['comms']({\n              topic: \"my-topic\",\n              data: \"my-payload\"\n            });\n            messages.should.have.length(3);\n            done();\n          });\n        }).catch(done);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"subscribe triggers retained messages","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":235,"column":44,"index":6748},"line":235,"code":"    it('subscribe triggers retained messages', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-event\",\n        data: \"my-payload\",\n        retain: true\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"retains non-blank status message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":256,"column":40,"index":7413},"line":256,"code":"    it('retains non-blank status message', function (done) {\n      eventHandlers['node-status']({\n        id: \"node1234\",\n        status: {\n          text: \"hello\"\n        }\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"status/node1234\");\n          messages[0].should.have.property(\"data\", {\n            text: \"hello\",\n            fill: undefined,\n            shape: undefined\n          });\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not retain blank status message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":282,"column":44,"index":8181},"line":282,"code":"    it('does not retain blank status message', function (done) {\n      eventHandlers['node-status']({\n        id: \"node1234\",\n        status: {}\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(0);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not send blank status if first status","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":300,"column":50,"index":8698},"line":300,"code":"    it('does not send blank status if first status', function (done) {\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          eventHandlers['node-status']({\n            id: \"node5678\",\n            status: {}\n          });\n          messages.should.have.length(0);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"sends blank status if replacing retained","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":318,"column":48,"index":9229},"line":318,"code":"    it('sends blank status if replacing retained', function (done) {\n      eventHandlers['node-status']({\n        id: \"node5678\",\n        status: {\n          text: \"hello\"\n        }\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"status/#\"\n        }).then(function () {\n          messages.should.have.length(1);\n          eventHandlers['node-status']({\n            id: \"node5678\",\n            status: {}\n          });\n          messages.should.have.length(2);\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"does not retain initial status blank message","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":343,"column":52,"index":9929},"line":343,"code":"    it('does not retain initial status blank message', function (done) {\n      eventHandlers['node-status']({\n        id: \"my-event\",\n        status: {}\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"retained messages get cleared","suites":["runtime-api/comms","subscriptions"],"updatePoint":{"line":363,"column":37,"index":10564},"line":363,"code":"    it('retained messages get cleared', function (done) {\n      eventHandlers['comms']({\n        topic: \"my-event\",\n        data: \"my-payload\",\n        retain: true\n      });\n      messages.should.have.length(0);\n      comms.addConnection({\n        client: clientConnection\n      }).then(function () {\n        return comms.subscribe({\n          client: clientConnection,\n          topic: \"my-event\"\n        }).then(function () {\n          messages.should.have.length(1);\n          messages[0].should.have.property(\"topic\", \"my-event\");\n          messages[0].should.have.property(\"data\", \"my-payload\");\n          // Now we have a retained message, clear it\n          eventHandlers['comms']({\n            topic: \"my-event\",\n            data: \"my-payload-cleared\"\n          });\n          messages.should.have.length(2);\n          messages[1].should.have.property(\"topic\", \"my-event\");\n          messages[1].should.have.property(\"data\", \"my-payload-cleared\");\n          // Now add a second client and subscribe - no message should arrive\n          return comms.addConnection({\n            client: clientConnection2\n          }).then(function () {\n            return comms.subscribe({\n              client: clientConnection2,\n              topic: \"my-event\"\n            }).then(function () {\n              messages.should.have.length(2);\n              done();\n            });\n          });\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/comms_spec.js","skipped":false,"dir":"test"},{"name":"gets global value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":124,"column":42,"index":3103},"line":124,"code":"    it('gets global value of default store', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '111');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets global value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":136,"column":44,"index":3472},"line":136,"code":"    it('gets global value of specified store', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '222');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets flow value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":147,"column":40,"index":3811},"line":147,"code":"    it('gets flow value of default store', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '333');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets flow value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":159,"column":42,"index":4174},"line":159,"code":"    it('gets flow value of specified store', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '444');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets node value of default store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":170,"column":40,"index":4509},"line":170,"code":"    it('gets node value of default store', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '555');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets node value of specified store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":182,"column":42,"index":4872},"line":182,"code":"    it('gets node value of specified store', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.have.property('msg', '666');\n        result.should.have.property('format', 'number');\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown store","suites":["runtime-api/context","getValue"],"updatePoint":{"line":193,"column":30,"index":5197},"line":193,"code":"    it('404s for unknown store', function (done) {\n      context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: 'unknown',\n        key: 'abc'\n      }).then(function (result) {\n        done(\"getValue for unknown store should not resolve\");\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all global value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":207,"column":40,"index":5643},"line":207,"code":"    it('gets all global value properties', function () {\n      return context.getValue({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: undefined //\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '111',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '222',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all flow value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":231,"column":38,"index":6189},"line":231,"code":"    it('gets all flow value properties', function () {\n      return context.getValue({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: undefined //\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '333',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '444',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets all node value properties","suites":["runtime-api/context","getValue"],"updatePoint":{"line":255,"column":38,"index":6731},"line":255,"code":"    it('gets all node value properties', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: undefined //\n      }).then(function (result) {\n        result.should.eql({\n          default: {\n            abc: {\n              msg: '555',\n              format: 'number'\n            }\n          },\n          file: {\n            abc: {\n              msg: '666',\n              format: 'number'\n            }\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"gets empty object when specified context doesn't exist","suites":["runtime-api/context","getValue"],"updatePoint":{"line":279,"column":63,"index":7298},"line":279,"code":"    it('gets empty object when specified context doesn\\'t exist', function () {\n      return context.getValue({\n        scope: 'node',\n        id: 'non-existent',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        result.should.be.an.Object();\n        result.should.be.empty();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes global value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":292,"column":45,"index":7650},"line":292,"code":"    it('deletes global value of default store', function () {\n      return context.delete({\n        scope: 'global',\n        id: undefined,\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        globalContext.should.eql({\n          default: {},\n          file: {\n            abc: 222\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes global value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":308,"column":47,"index":8027},"line":308,"code":"    it('deletes global value of specified store', function () {\n      return context.delete({\n        scope: 'global',\n        id: undefined,\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        globalContext.should.eql({\n          default: {\n            abc: 111\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes flow value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":323,"column":43,"index":8374},"line":323,"code":"    it('deletes flow value of default store', function () {\n      return context.delete({\n        scope: 'flow',\n        id: 'flow1',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        flowContext.should.eql({\n          default: {},\n          file: {\n            abc: 444\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes flow value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":339,"column":45,"index":8743},"line":339,"code":"    it('deletes flow value of specified store', function () {\n      return context.delete({\n        scope: 'flow',\n        id: 'flow1',\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        flowContext.should.eql({\n          default: {\n            abc: 333\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes node value of default store","suites":["runtime-api/context","delete"],"updatePoint":{"line":354,"column":43,"index":9084},"line":354,"code":"    it('deletes node value of default store', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'known',\n        store: undefined,\n        // use default\n        key: 'abc'\n      }).then(function () {\n        nodeContext.should.eql({\n          default: {},\n          file: {\n            abc: 666\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"deletes node value of specified store","suites":["runtime-api/context","delete"],"updatePoint":{"line":370,"column":45,"index":9453},"line":370,"code":"    it('deletes node value of specified store', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'known',\n        store: 'file',\n        key: 'abc'\n      }).then(function () {\n        nodeContext.should.eql({\n          default: {\n            abc: 555\n          },\n          file: {}\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"does nothing when specified context doesn't exist","suites":["runtime-api/context","delete"],"updatePoint":{"line":385,"column":58,"index":9809},"line":385,"code":"    it('does nothing when specified context doesn\\'t exist', function () {\n      return context.delete({\n        scope: 'node',\n        id: 'non-existent',\n        store: 'file',\n        key: 'abc'\n      }).then(function (result) {\n        should.not.exist(result);\n        nodeContext.should.eql({\n          default: {\n            abc: 555\n          },\n          file: {\n            abc: 666\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown store","suites":["runtime-api/context","delete"],"updatePoint":{"line":403,"column":30,"index":10216},"line":403,"code":"    it('404s for unknown store', function (done) {\n      context.delete({\n        scope: 'global',\n        id: undefined,\n        store: 'unknown',\n        key: 'abc'\n      }).then(function () {\n        done(\"delete for unknown store should not resolve\");\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/api/context_spec.js","skipped":false,"dir":"test"},{"name":"returns basic user settings","suites":["runtime-api/diagnostics","get"],"updatePoint":{"line":89,"column":35,"index":2676},"line":89,"code":"    it(\"returns basic user settings\", function () {\n      return diagnostics.get({\n        scope: \"fake_scope\"\n      }).then(result => {\n        should(result).be.type(\"object\");\n\n        //result.xxxxx\n        Object.keys(result);\n        const reportPropCount = Object.keys(result).length;\n        reportPropCount.should.eql(7); //ensure no more than 7 keys are present in the report (avoid leakage of extra info)\n        result.should.have.property(\"report\", \"diagnostics\");\n        result.should.have.property(\"scope\", \"fake_scope\");\n        result.should.have.property(\"time\").type(\"object\");\n        result.should.have.property(\"intl\").type(\"object\");\n        result.should.have.property(\"nodejs\").type(\"object\");\n        result.should.have.property(\"os\").type(\"object\");\n        result.should.have.property(\"runtime\").type(\"object\");\n\n        //result.runtime.xxxxx\n        const runtimeCount = Object.keys(result.runtime).length;\n        runtimeCount.should.eql(5); //ensure 5 keys are present in runtime \n        result.runtime.should.have.property('isStarted', true);\n        result.runtime.should.have.property('flows');\n        result.runtime.should.have.property('modules').type(\"object\");\n        result.runtime.should.have.property('settings').type(\"object\");\n        result.runtime.should.have.property('version', '7.7.7');\n\n        //result.runtime.modules.xxxxx\n        const moduleCount = Object.keys(result.runtime.modules).length;\n        moduleCount.should.eql(2); //ensure no more than the 2 modules specified are present\n        result.runtime.modules.should.have.property('node-red', '9.9.9');\n        result.runtime.modules.should.have.property('node-red-node-inject', '8.8.8');\n\n        //result.runtime.settings.xxxxx\n        const settingsCount = Object.keys(result.runtime.settings).length;\n        settingsCount.should.eql(27); //ensure no more than the 21 settings listed below are present in the settings object\n        result.runtime.settings.should.have.property('available', true);\n        result.runtime.settings.should.have.property('apiMaxLength', \"UNSET\"); //deliberately disabled to ensure UNSET is returned\n        result.runtime.settings.should.have.property('debugMaxLength', 1111);\n        result.runtime.settings.should.have.property('disableEditor', false);\n        result.runtime.settings.should.have.property('editorTheme', {});\n        result.runtime.settings.should.have.property('flowFile', \"flows.json\");\n        result.runtime.settings.should.have.property('mqttReconnectTime', 321);\n        result.runtime.settings.should.have.property('serialReconnectTime', 432);\n        result.runtime.settings.should.have.property('socketReconnectTime', 2222);\n        result.runtime.settings.should.have.property('socketTimeout', 3333);\n        result.runtime.settings.should.have.property('tcpMsgQueueSize', 4444);\n        result.runtime.settings.should.have.property('inboundWebSocketTimeout', 5555);\n        result.runtime.settings.should.have.property('runtimeState', {\n          enabled: true,\n          ui: false\n        });\n        result.runtime.settings.should.have.property(\"adminAuth\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property(\"httpAdminCors\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property('httpAdminRoot', \"/admin/root/\");\n        result.runtime.settings.should.have.property(\"httpNodeAuth\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property(\"httpNodeCors\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property('httpNodeRoot', \"/node/root/\");\n        result.runtime.settings.should.have.property(\"httpStatic\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property('httpStaticRoot', \"/static/root/\");\n        result.runtime.settings.should.have.property(\"httpStaticCors\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property(\"uiHost\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property(\"uiPort\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property(\"userDir\", \"SET\"); //should be sanitised to \"SET\"\n        result.runtime.settings.should.have.property('contextStorage').type(\"object\");\n        result.runtime.settings.should.have.property('nodesDir', \"SET\");\n\n        //result.runtime.settings.contextStorage.xxxxx\n        const contextCount = Object.keys(result.runtime.settings.contextStorage).length;\n        contextCount.should.eql(3); //ensure no more than the 3 settings listed below are present in the contextStorage object\n        result.runtime.settings.contextStorage.should.have.property('default', {\n          module: \"memory\"\n        });\n        result.runtime.settings.contextStorage.should.have.property('file', {\n          module: \"localfilesystem\"\n        });\n        result.runtime.settings.contextStorage.should.have.property('secured', {\n          module: \"secure_store\"\n        }); //only module should be present, other fields are dropped for security\n      });\n    });","file":"unit/@node-red/runtime/lib/api/diagnostics_spec.js","skipped":false,"dir":"test"},{"name":"returns the current flow configuration","suites":["runtime-api/flows","getFlows"],"updatePoint":{"line":35,"column":46,"index":1168},"line":35,"code":"    it(\"returns the current flow configuration\", function (done) {\n      flows.init({\n        log: mockLog(),\n        flows: {\n          getFlows: function () {\n            return [1, 2, 3];\n          }\n        }\n      });\n      flows.getFlows({}).then(function (result) {\n        result.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"defaults to full deploy","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":90,"column":31,"index":2571},"line":90,"code":"    it(\"defaults to full deploy\", function (done) {\n      flows.setFlows({\n        flows: {\n          flows: [4, 5, 6]\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"full\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"includes credentials when part of the request","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":105,"column":53,"index":3019},"line":105,"code":"    it(\"includes credentials when part of the request\", function (done) {\n      flows.setFlows({\n        flows: {\n          flows: [4, 5, 6],\n          credentials: {\n            $: \"creds\"\n          }\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[1].should.eql({\n          $: \"creds\"\n        });\n        setFlows.lastCall.args[2].should.eql(\"full\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"passes through other deploy types","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":126,"column":41,"index":3596},"line":126,"code":"    it(\"passes through other deploy types\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6]\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"nodes\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"triggers a flow reload","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":142,"column":30,"index":4055},"line":142,"code":"    it(\"triggers a flow reload\", function (done) {\n      flows.setFlows({\n        deploymentType: \"reload\"\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newLoadRev\"\n        });\n        setFlows.called.should.be.false();\n        loadFlows.called.should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"allows update when revision matches","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":154,"column":43,"index":4409},"line":154,"code":"    it(\"allows update when revision matches\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6],\n          rev: \"currentRev\"\n        }\n      }).then(function (result) {\n        result.should.eql({\n          rev: \"newRev\"\n        });\n        setFlows.called.should.be.true();\n        setFlows.lastCall.args[0].should.eql([4, 5, 6]);\n        setFlows.lastCall.args[2].should.eql(\"nodes\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects update when revision does not match","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":171,"column":51,"index":4918},"line":171,"code":"    it(\"rejects update when revision does not match\", function (done) {\n      flows.setFlows({\n        deploymentType: \"nodes\",\n        flows: {\n          flows: [4, 5, 6],\n          rev: \"notTheCurrentRev\"\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject rev mismatch\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'version_mismatch');\n        err.should.have.property('status', 409);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when reload fails","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":186,"column":33,"index":5396},"line":186,"code":"    it(\"rejects when reload fails\", function (done) {\n      reloadError = true;\n      flows.setFlows({\n        deploymentType: \"reload\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update fails","suites":["runtime-api/flows","setFlows"],"updatePoint":{"line":197,"column":33,"index":5753},"line":197,"code":"    it(\"rejects when update fails\", function (done) {\n      flows.setFlows({\n        deploymentType: \"full\",\n        flows: {\n          flows: [\"error\", 5, 6]\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"adds a flow","suites":["runtime-api/flows","addFlow"],"updatePoint":{"line":231,"column":19,"index":6627},"line":231,"code":"    it(\"adds a flow\", function (done) {\n      flows.addFlow({\n        flow: {\n          a: \"123\"\n        }\n      }).then(function (id) {\n        addFlow.called.should.be.true();\n        addFlow.lastCall.args[0].should.eql({\n          a: \"123\"\n        });\n        id.should.eql(\"newId\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when add fails","suites":["runtime-api/flows","addFlow"],"updatePoint":{"line":245,"column":30,"index":6971},"line":245,"code":"    it(\"rejects when add fails\", function (done) {\n      flows.addFlow({\n        flow: \"error\"\n      }).then(function (id) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets a flow","suites":["runtime-api/flows","getFlow"],"updatePoint":{"line":272,"column":19,"index":7622},"line":272,"code":"    it(\"gets a flow\", function (done) {\n      flows.getFlow({\n        id: \"123\"\n      }).then(function (flow) {\n        flow.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","getFlow"],"updatePoint":{"line":280,"column":35,"index":7832},"line":280,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.getFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"updates a flow","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":320,"column":22,"index":9010},"line":320,"code":"    it(\"updates a flow\", function (done) {\n      flows.updateFlow({\n        id: \"123\",\n        flow: [1, 2, 3]\n      }).then(function (id) {\n        id.should.eql(\"123\");\n        updateFlow.called.should.be.true();\n        updateFlow.lastCall.args[0].should.eql(\"123\");\n        updateFlow.lastCall.args[1].should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":332,"column":35,"index":9398},"line":332,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.updateFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when update fails","suites":["runtime-api/flows","updateFlow"],"updatePoint":{"line":343,"column":33,"index":9771},"line":343,"code":"    it(\"rejects when update fails\", function (done) {\n      flows.updateFlow({\n        id: \"error\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"deletes a flow","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":383,"column":22,"index":10946},"line":383,"code":"    it(\"deletes a flow\", function (done) {\n      flows.deleteFlow({\n        id: \"123\"\n      }).then(function () {\n        removeFlow.called.should.be.true();\n        removeFlow.lastCall.args[0].should.eql(\"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when flow not found","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":392,"column":35,"index":11218},"line":392,"code":"    it(\"rejects when flow not found\", function (done) {\n      flows.deleteFlow({\n        id: \"unknown\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects when delete fails","suites":["runtime-api/flows","deleteFlow"],"updatePoint":{"line":403,"column":33,"index":11591},"line":403,"code":"    it(\"rejects when delete fails\", function (done) {\n      flows.deleteFlow({\n        id: \"error\"\n      }).then(function (flow) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"returns an empty object for an unknown node","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":454,"column":51,"index":12980},"line":454,"code":"    it(\"returns an empty object for an unknown node\", function (done) {\n      flows.getNodeCredentials({\n        id: \"unknown\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({});\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered credentials for a known node with password","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":463,"column":68,"index":13257},"line":463,"code":"    it(\"gets the filtered credentials for a known node with password\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({\n          username: \"abc\",\n          has_password: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered credentials for a known node without password","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":475,"column":71,"index":13600},"line":475,"code":"    it(\"gets the filtered credentials for a known node without password\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known2\",\n        type: \"node\"\n      }).then(function (result) {\n        result.should.eql({\n          username: \"abc\",\n          has_password: false\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets the empty credentials for a known node without a registered definition","suites":["runtime-api/flows","getNodeCredentials"],"updatePoint":{"line":487,"column":83,"index":13957},"line":487,"code":"    it(\"gets the empty credentials for a known node without a registered definition\", function (done) {\n      flows.getNodeCredentials({\n        id: \"known2\",\n        type: \"unknown-type\"\n      }).then(function (result) {\n        result.should.eql({});\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"gets flows run state","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":554,"column":28,"index":15721},"line":554,"code":"    it(\"gets flows run state\", async function () {\n      flows.init(runtime);\n      const state = await flows.getState({});\n      state.should.have.property(\"state\", \"start\");\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"permits getting flows run state when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":559,"column":61,"index":15938},"line":559,"code":"    it(\"permits getting flows run state when setting disabled\", async function () {\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n      const state = await flows.getState({});\n      state.should.have.property(\"state\", \"start\");\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"start flows","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":565,"column":19,"index":16166},"line":565,"code":"    it(\"start flows\", async function () {\n      flows.init(runtime);\n      const state = await flows.setState({\n        state: \"start\"\n      });\n      state.should.have.property(\"state\", \"start\");\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.be.true();\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"stop flows","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":574,"column":18,"index":16457},"line":574,"code":"    it(\"stop flows\", async function () {\n      flows.init(runtime);\n      const state = await flows.setState({\n        state: \"stop\"\n      });\n      state.should.have.property(\"state\", \"stop\");\n      stopFlows.called.should.be.true();\n      startFlows.called.should.not.be.true();\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects starting flows when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":583,"column":52,"index":16780},"line":583,"code":"    it(\"rejects starting flows when setting disabled\", async function () {\n      let err;\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n      try {\n        await flows.setState({\n          state: \"start\"\n        });\n      } catch (error) {\n        err = error;\n      }\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"not_allowed\");\n      should(err).have.property(\"status\", 405);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects stopping flows when setting disabled","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":599,"column":52,"index":17286},"line":599,"code":"    it(\"rejects stopping flows when setting disabled\", async function () {\n      let err;\n      runtime.settings.runtimeState.enabled = false;\n      flows.init(runtime);\n      try {\n        await flows.setState({\n          state: \"stop\"\n        });\n      } catch (error) {\n        err = error;\n      }\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"not_allowed\");\n      should(err).have.property(\"status\", 405);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"rejects setting invalid flows run state","suites":["runtime-api/flows","flow run state"],"updatePoint":{"line":615,"column":47,"index":17786},"line":615,"code":"    it(\"rejects setting invalid flows run state\", async function () {\n      let err;\n      flows.init(runtime);\n      try {\n        await flows.setState({\n          state: \"bad-state\"\n        });\n      } catch (error) {\n        err = error;\n      }\n      stopFlows.called.should.not.be.true();\n      startFlows.called.should.not.be.true();\n      should(err).have.property(\"code\", \"invalid_run_state\");\n      should(err).have.property(\"status\", 400);\n    });","file":"unit/@node-red/runtime/lib/api/flows_spec.js","skipped":false,"dir":"test"},{"name":"isStarted","suites":["runtime-api/index"],"updatePoint":{"line":32,"column":15,"index":1292},"line":32,"code":"  it('isStarted', function (done) {\n    index.init({\n      isStarted: () => true\n    });\n    index.isStarted({}).then(function (started) {\n      started.should.be.true();\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/api/index_spec.js","skipped":false,"dir":"test"},{"name":"isStarted","suites":["runtime-api/index"],"updatePoint":{"line":41,"column":15,"index":1503},"line":41,"code":"  it('isStarted', function (done) {\n    index.init({\n      version: () => \"1.2.3.4\"\n    });\n    index.version({}).then(function (version) {\n      version.should.eql(\"1.2.3.4\");\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/api/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a known entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":67,"column":29,"index":2203},"line":67,"code":"    it(\"returns a known entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"known\",\n        path: \"/abc\"\n      }).then(function (result) {\n        result.should.eql(\"known\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a forbidden entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":77,"column":33,"index":2468},"line":77,"code":"    it(\"rejects a forbidden entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"forbidden\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"forbidden\");\n        err.should.have.property(\"status\", 403);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects an unknown entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":90,"column":32,"index":2879},"line":90,"code":"    it(\"rejects an unknown entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"not_found\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        err.should.have.property(\"status\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a blank (unknown) entry","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":103,"column":39,"index":3297},"line":103,"code":"    it(\"rejects a blank (unknown) entry\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"blank\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        err.should.have.property(\"status\", 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects unexpected error","suites":["runtime-api/library","getEntry"],"updatePoint":{"line":116,"column":32,"index":3704},"line":116,"code":"    it(\"rejects unexpected error\", function (done) {\n      library.getEntry({\n        library: \"local\",\n        type: \"error\",\n        path: \"/abc\"\n      }).then(function (result) {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"status\", 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"saves an entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":161,"column":22,"index":4968},"line":161,"code":"    it(\"saves an entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"known\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        opts.should.have.property(\"type\", \"known\");\n        opts.should.have.property(\"path\", \"/abc\");\n        opts.should.have.property(\"meta\", {\n          a: 1\n        });\n        opts.should.have.property(\"body\", \"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects a forbidden entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":180,"column":33,"index":5479},"line":180,"code":"    it(\"rejects a forbidden entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"forbidden\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"forbidden\");\n        err.should.have.property(\"status\", 403);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"rejects an unknown entry","suites":["runtime-api/library","saveEntry"],"updatePoint":{"line":197,"column":32,"index":5948},"line":197,"code":"    it(\"rejects an unknown entry\", function (done) {\n      library.saveEntry({\n        library: \"local\",\n        type: \"not_found\",\n        path: \"/abc\",\n        meta: {\n          a: 1\n        },\n        body: \"123\"\n      }).then(function () {\n        done(new Error(\"did not reject\"));\n      }).catch(function (err) {\n        err.should.have.property(\"status\", 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/library_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["runtime-api/nodes","getNodeInfo"],"updatePoint":{"line":51,"column":25,"index":1482},"line":51,"code":"    it(\"returns node info\", function (done) {\n      nodes.getNodeInfo({\n        id: \"known\"\n      }).then(function (result) {\n        result.should.eql({\n          id: \"known\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getNodeInfo"],"updatePoint":{"line":61,"column":37,"index":1728},"line":61,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getNodeInfo({\n        id: \"unknown\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node list","suites":["runtime-api/nodes","getNodeList"],"updatePoint":{"line":84,"column":25,"index":2338},"line":84,"code":"    it(\"returns node list\", function (done) {\n      nodes.getNodeList({}).then(function (result) {\n        result.should.eql([1, 2, 3]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node config","suites":["runtime-api/nodes","getNodeConfig"],"updatePoint":{"line":106,"column":27,"index":2875},"line":106,"code":"    it(\"returns node config\", function (done) {\n      nodes.getNodeConfig({\n        id: \"known\",\n        lang: 'lang'\n      }).then(function (result) {\n        result.should.eql(\"knownlang\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getNodeConfig"],"updatePoint":{"line":115,"column":37,"index":3123},"line":115,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getNodeConfig({\n        id: \"unknown\",\n        lang: 'lang'\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns all node configs","suites":["runtime-api/nodes","getNodeConfigs"],"updatePoint":{"line":139,"column":32,"index":3769},"line":139,"code":"    it(\"returns all node configs\", function (done) {\n      nodes.getNodeConfigs({\n        lang: 'lang'\n      }).then(function (result) {\n        result.should.eql(\"lang\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns node info","suites":["runtime-api/nodes","getModuleInfo"],"updatePoint":{"line":165,"column":25,"index":4366},"line":165,"code":"    it(\"returns node info\", function (done) {\n      nodes.getModuleInfo({\n        module: \"known\"\n      }).then(function (result) {\n        result.should.eql({\n          module: \"known\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"returns 404 if node not known","suites":["runtime-api/nodes","getModuleInfo"],"updatePoint":{"line":175,"column":37,"index":4622},"line":175,"code":"    it(\"returns 404 if node not known\", function (done) {\n      nodes.getModuleInfo({\n        module: \"unknown\"\n      }).then(function (result) {\n        done(new Error(\"Did not return internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'not_found');\n        err.should.have.property('status', 404);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/nodes_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin list","suites":["runtime-api/plugins","getPluginList"],"updatePoint":{"line":27,"column":28,"index":682},"line":27,"code":"    it(\"gets the plugin list\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginList: function () {\n            return pluginList;\n          }\n        }\n      });\n      return plugins.getPluginList({}).then(function (result) {\n        result.should.eql(pluginList);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin configs","suites":["runtime-api/plugins","getPluginConfigs"],"updatePoint":{"line":42,"column":31,"index":1068},"line":42,"code":"    it(\"gets the plugin configs\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginConfigs: function () {\n            return pluginConfigs;\n          }\n        }\n      });\n      return plugins.getPluginConfigs({}).then(function (result) {\n        result.should.eql(pluginConfigs);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"gets the plugin catalogs","suites":["runtime-api/plugins","getPluginCatalogs"],"updatePoint":{"line":57,"column":32,"index":1468},"line":57,"code":"    it(\"gets the plugin catalogs\", function () {\n      plugins.init({\n        log: mockLog(),\n        plugins: {\n          getPluginList: function () {\n            return pluginList;\n          }\n        },\n        i18n: {\n          i: {\n            changeLanguage: function (lang, done) {\n              done && done();\n            },\n            getResourceBundle: function (lang, id) {\n              return {\n                lang,\n                id\n              };\n            }\n          }\n        }\n      });\n      return plugins.getPluginCatalogs({\n        lang: \"en-US\"\n      }).then(function (result) {\n        JSON.stringify(result).should.eql(JSON.stringify({\n          one: {\n            lang: \"en-US\",\n            id: \"one\"\n          }\n        }));\n      });\n    });","file":"unit/@node-red/runtime/lib/api/plugins_spec.js","skipped":false,"dir":"test"},{"name":"resolves true if projects available","suites":["runtime-api/settings","available"],"updatePoint":{"line":35,"column":43,"index":1175},"line":35,"code":"    it(\"resolves true if projects available\", function (done) {\n      projects.init({\n        storage: {\n          projects: {}\n        }\n      });\n      projects.available().then(function (result) {\n        result.should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"resolves false if projects unavailable","suites":["runtime-api/settings","available"],"updatePoint":{"line":46,"column":46,"index":1457},"line":46,"code":"    it(\"resolves false if projects unavailable\", function (done) {\n      projects.init({\n        storage: {}\n      });\n      projects.available().then(function (result) {\n        result.should.be.false();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"lists the projects, without an active project","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":86,"column":53,"index":2498},"line":86,"code":"    it(\"lists the projects, without an active project\", function (done) {\n      projects.listProjects({\n        user: \"noActive\"\n      }).then(function (result) {\n        result.should.have.property('projects', [1, 2, 3]);\n        result.should.not.have.property('active');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"lists the projects, with an active project","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":95,"column":50,"index":2815},"line":95,"code":"    it(\"lists the projects, with an active project\", function (done) {\n      projects.listProjects({\n        user: \"foo\"\n      }).then(function (result) {\n        result.should.have.property('projects', [1, 2, 3]);\n        result.should.have.property('active', 'aProject');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","listProjects"],"updatePoint":{"line":104,"column":35,"index":3120},"line":104,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.listProjects({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"create project","suites":["runtime-api/settings","createProject"],"updatePoint":{"line":138,"column":22,"index":4071},"line":138,"code":"    it(\"create project\", function (done) {\n      projects.createProject({\n        user: \"known\",\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          a: 1\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","createProject"],"updatePoint":{"line":151,"column":35,"index":4360},"line":151,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.createProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"intialise project","suites":["runtime-api/settings","initialiseProject"],"updatePoint":{"line":188,"column":25,"index":5383},"line":188,"code":"    it(\"intialise project\", function (done) {\n      projects.initialiseProject({\n        user: \"known\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          id: 123,\n          project: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","initialiseProject"],"updatePoint":{"line":205,"column":35,"index":5747},"line":205,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.initialiseProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"returns active project","suites":["runtime-api/settings","getActiveProject"],"updatePoint":{"line":239,"column":30,"index":6708},"line":239,"code":"    it(\"returns active project\", function (done) {\n      projects.getActiveProject({\n        user: \"known\"\n      }).then(function (result) {\n        result.should.eql(\"123\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getActiveProject"],"updatePoint":{"line":247,"column":35,"index":6934},"line":247,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getActiveProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"sets project if current project is unset","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":289,"column":48,"index":8157},"line":289,"code":"    it(\"sets project if current project is unset\", function (done) {\n      activeProject = null;\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"sets project if current project is different","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":302,"column":52,"index":8494},"line":302,"code":"    it(\"sets project if current project is different\", function (done) {\n      activeProject = {\n        name: 456\n      };\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"no-ops if current project is same","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":317,"column":41,"index":8843},"line":317,"code":"    it(\"no-ops if current project is same\", function (done) {\n      activeProject = {\n        name: 123\n      };\n      projects.setActiveProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        (result === undefined).should.be.true();\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","setActiveProject"],"updatePoint":{"line":329,"column":35,"index":9152},"line":329,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.setActiveProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"returns project","suites":["runtime-api/settings","getProject"],"updatePoint":{"line":366,"column":23,"index":10150},"line":366,"code":"    it(\"returns project\", function (done) {\n      projects.getProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getProject"],"updatePoint":{"line":378,"column":35,"index":10436},"line":378,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getProject({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"updates project","suites":["runtime-api/settings","updateProject"],"updatePoint":{"line":416,"column":23,"index":11468},"line":416,"code":"    it(\"updates project\", function (done) {\n      projects.updateProject({\n        user: \"known\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          project: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","updateProject"],"updatePoint":{"line":434,"column":35,"index":11853},"line":434,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.updateProject({\n        user: \"error\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"deletes project","suites":["runtime-api/settings","deleteProject"],"updatePoint":{"line":475,"column":23,"index":12916},"line":475,"code":"    it(\"deletes project\", function (done) {\n      projects.deleteProject({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","deleteProject"],"updatePoint":{"line":487,"column":35,"index":13205},"line":487,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.deleteProject({\n        user: \"error\",\n        id: 123\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets status","suites":["runtime-api/settings","getStatus"],"updatePoint":{"line":526,"column":19,"index":14243},"line":526,"code":"    it(\"gets status\", function (done) {\n      projects.getStatus({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getStatus"],"updatePoint":{"line":544,"column":35,"index":14622},"line":544,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getStatus({\n        user: \"error\",\n        id: 123,\n        project: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets branches","suites":["runtime-api/settings","getBranches"],"updatePoint":{"line":586,"column":21,"index":15707},"line":586,"code":"    it(\"gets branches\", function (done) {\n      projects.getBranches({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getBranches"],"updatePoint":{"line":604,"column":35,"index":16088},"line":604,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getBranches({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets branch status","suites":["runtime-api/settings","getBranchStatus"],"updatePoint":{"line":646,"column":26,"index":17187},"line":646,"code":"    it(\"gets branch status\", function (done) {\n      projects.getBranchStatus({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getBranchStatus"],"updatePoint":{"line":664,"column":35,"index":17572},"line":664,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getBranchStatus({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","setBranch"],"updatePoint":{"line":707,"column":15,"index":18684},"line":707,"code":"    it(\"commits\", function (done) {\n      projects.setBranch({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        create: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          },\n          create: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","setBranch"],"updatePoint":{"line":727,"column":35,"index":19109},"line":727,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.setBranch({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        create: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","deleteBranch"],"updatePoint":{"line":771,"column":15,"index":20252},"line":771,"code":"    it(\"commits\", function (done) {\n      projects.deleteBranch({\n        user: \"known\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        force: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          branch: {\n            a: 1\n          },\n          force: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","deleteBranch"],"updatePoint":{"line":791,"column":35,"index":20678},"line":791,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.deleteBranch({\n        user: \"error\",\n        id: 123,\n        branch: {\n          a: 1\n        },\n        force: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"commits","suites":["runtime-api/settings","commit"],"updatePoint":{"line":834,"column":15,"index":21772},"line":834,"code":"    it(\"commits\", function (done) {\n      projects.commit({\n        user: \"known\",\n        id: 123,\n        message: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          message: {\n            message: {\n              a: 1\n            }\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","commit"],"updatePoint":{"line":854,"column":35,"index":22189},"line":854,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.commit({\n        user: \"error\",\n        id: 123,\n        message: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commit","suites":["runtime-api/settings","getCommit"],"updatePoint":{"line":896,"column":19,"index":23259},"line":896,"code":"    it(\"gets commit\", function (done) {\n      projects.getCommit({\n        user: \"known\",\n        id: 123,\n        sha: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          sha: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getCommit"],"updatePoint":{"line":914,"column":35,"index":23632},"line":914,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getCommit({\n        user: \"error\",\n        id: 123,\n        sha: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commits with default limit/before","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":956,"column":46,"index":24738},"line":956,"code":"    it(\"gets commits with default limit/before\", function (done) {\n      projects.getCommits({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          options: {\n            limit: 20,\n            before: undefined\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets commits with provided limit/before","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":972,"column":47,"index":25123},"line":972,"code":"    it(\"gets commits with provided limit/before\", function (done) {\n      projects.getCommits({\n        user: \"known\",\n        id: 123,\n        limit: 10,\n        before: 456\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          options: {\n            limit: 10,\n            before: 456\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getCommits"],"updatePoint":{"line":990,"column":35,"index":25530},"line":990,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getCommits({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"aborts merge","suites":["runtime-api/settings","abortMerge"],"updatePoint":{"line":1027,"column":20,"index":26519},"line":1027,"code":"    it(\"aborts merge\", function (done) {\n      projects.abortMerge({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","abortMerge"],"updatePoint":{"line":1039,"column":35,"index":26805},"line":1039,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.abortMerge({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"resolves merge","suites":["runtime-api/settings","resolveMerge"],"updatePoint":{"line":1078,"column":22,"index":27868},"line":1078,"code":"    it(\"resolves merge\", function (done) {\n      projects.resolveMerge({\n        user: \"known\",\n        id: 123,\n        path: \"/abc\",\n        resolution: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: \"/abc\",\n          resolution: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","resolveMerge"],"updatePoint":{"line":1098,"column":35,"index":28304},"line":1098,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.resolveMerge({\n        user: \"error\",\n        id: 123,\n        path: \"/abc\",\n        resolution: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets files","suites":["runtime-api/settings","getFiles"],"updatePoint":{"line":1140,"column":18,"index":29376},"line":1140,"code":"    it(\"gets files\", function (done) {\n      projects.getFiles({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFiles"],"updatePoint":{"line":1152,"column":35,"index":29660},"line":1152,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFiles({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets file","suites":["runtime-api/settings","getFile"],"updatePoint":{"line":1191,"column":17,"index":30694},"line":1191,"code":"    it(\"gets file\", function (done) {\n      projects.getFile({\n        user: \"known\",\n        id: 123,\n        path: \"/abc\",\n        tree: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: \"/abc\",\n          tree: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFile"],"updatePoint":{"line":1211,"column":35,"index":31113},"line":1211,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFile({\n        user: \"error\",\n        id: 123,\n        path: \"/abc\",\n        tree: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"stages a file","suites":["runtime-api/settings","stageFile"],"updatePoint":{"line":1254,"column":21,"index":32207},"line":1254,"code":"    it(\"stages a file\", function (done) {\n      projects.stageFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","stageFile"],"updatePoint":{"line":1272,"column":35,"index":32582},"line":1272,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.stageFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"unstages a file","suites":["runtime-api/settings","unstageFile"],"updatePoint":{"line":1314,"column":23,"index":33662},"line":1314,"code":"    it(\"unstages a file\", function (done) {\n      projects.unstageFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","unstageFile"],"updatePoint":{"line":1332,"column":35,"index":34039},"line":1332,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.unstageFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"reverts a file","suites":["runtime-api/settings","revertFile"],"updatePoint":{"line":1374,"column":22,"index":35118},"line":1374,"code":"    it(\"reverts a file\", function (done) {\n      projects.revertFile({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","revertFile"],"updatePoint":{"line":1392,"column":35,"index":35494},"line":1392,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.revertFile({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets file diff","suites":["runtime-api/settings","getFileDiff"],"updatePoint":{"line":1435,"column":22,"index":36602},"line":1435,"code":"    it(\"gets file diff\", function (done) {\n      projects.getFileDiff({\n        user: \"known\",\n        id: 123,\n        path: {\n          a: 1\n        },\n        type: \"abc\"\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          path: {\n            a: 1\n          },\n          type: \"abc\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getFileDiff"],"updatePoint":{"line":1455,"column":35,"index":37023},"line":1455,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getFileDiff({\n        user: \"error\",\n        id: 123,\n        path: {\n          a: 1\n        },\n        type: \"abc\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets remotes","suites":["runtime-api/settings","getRemotes"],"updatePoint":{"line":1497,"column":20,"index":38093},"line":1497,"code":"    it(\"gets remotes\", function (done) {\n      projects.getRemotes({\n        user: \"known\",\n        id: 123\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","getRemotes"],"updatePoint":{"line":1509,"column":35,"index":38379},"line":1509,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.getRemotes({\n        user: \"error\"\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"adds a remote","suites":["runtime-api/settings","addRemote"],"updatePoint":{"line":1547,"column":21,"index":39399},"line":1547,"code":"    it(\"adds a remote\", function (done) {\n      projects.addRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","addRemote"],"updatePoint":{"line":1565,"column":35,"index":39778},"line":1565,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.addRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"removes a remote","suites":["runtime-api/settings","removeRemote"],"updatePoint":{"line":1607,"column":24,"index":40867},"line":1607,"code":"    it(\"removes a remote\", function (done) {\n      projects.removeRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: {\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","removeRemote"],"updatePoint":{"line":1625,"column":35,"index":41249},"line":1625,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.removeRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"updates a remote","suites":["runtime-api/settings","updateRemote"],"updatePoint":{"line":1668,"column":24,"index":42369},"line":1668,"code":"    it(\"updates a remote\", function (done) {\n      projects.updateRemote({\n        user: \"known\",\n        id: 123,\n        remote: {\n          name: \"abc\",\n          a: 1\n        }\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          name: \"abc\",\n          remote: {\n            name: \"abc\",\n            a: 1\n          }\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","updateRemote"],"updatePoint":{"line":1689,"column":35,"index":42822},"line":1689,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.updateRemote({\n        user: \"error\",\n        id: 123,\n        remote: {\n          name: \"abc\",\n          a: 1\n        }\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"pulls","suites":["runtime-api/settings","pull"],"updatePoint":{"line":1734,"column":13,"index":44006},"line":1734,"code":"    it(\"pulls\", function (done) {\n      projects.pull({\n        user: \"known\",\n        id: 123,\n        remote: \"abc\",\n        track: false,\n        allowUnrelatedHistories: true\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: \"abc\",\n          track: false,\n          allowUnrelatedHistories: true\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","pull"],"updatePoint":{"line":1752,"column":35,"index":44460},"line":1752,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.pull({\n        user: \"error\",\n        id: 123,\n        remote: \"abc\",\n        track: false,\n        allowUnrelatedHistories: true\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"pulls","suites":["runtime-api/settings","push"],"updatePoint":{"line":1795,"column":13,"index":45587},"line":1795,"code":"    it(\"pulls\", function (done) {\n      projects.push({\n        user: \"known\",\n        id: 123,\n        remote: \"abc\",\n        track: false\n      }).then(function (result) {\n        result.should.eql({\n          user: \"known\",\n          id: 123,\n          remote: \"abc\",\n          track: false\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"rejects with internal error","suites":["runtime-api/settings","push"],"updatePoint":{"line":1811,"column":35,"index":45961},"line":1811,"code":"    it(\"rejects with internal error\", function (done) {\n      projects.push({\n        user: \"error\",\n        id: 123,\n        remote: \"abc\",\n        track: false\n      }).then(function (result) {\n        done(new Error(\"Did not reject internal error\"));\n      }).catch(function (err) {\n        err.should.have.property('code', 'error');\n        // err.should.have.property('status',400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/projects_spec.js","skipped":false,"dir":"test"},{"name":"gets the runtime settings","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":36,"column":33,"index":1204},"line":36,"code":"    it(\"gets the runtime settings\", function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => [\"lib1\"]\n        },\n        storage: {}\n      });\n      return settings.getRuntimeSettings({}).then(result => {\n        result.should.have.property(\"httpNodeRoot\", \"testHttpNodeRoot\");\n        result.should.have.property(\"version\", \"testVersion\");\n        result.should.have.property(\"paletteCategories\", [\"red\", \"blue\", \"green\"]);\n        result.should.have.property(\"libraries\", [\"lib1\"]);\n        result.should.have.property(\"testNodeSetting\", \"helloWorld\");\n        result.should.have.property(\"testPluginSettings\", \"helloPluginWorld\");\n        result.should.not.have.property(\"foo\", 123);\n        result.should.have.property(\"flowEncryptionType\", \"test-key-type\");\n        result.should.not.have.property(\"user\");\n        result.should.have.property(\"externalModules\");\n        result.externalModules.should.eql({\n          palette: {\n            allowInstall: false,\n            allowUpload: false\n          }\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered user settings","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":86,"column":39,"index":2981},"line":86,"code":"    it(\"gets the filtered user settings\", function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {}\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"user\");\n        result.user.should.have.property(\"username\", \"nick\");\n        result.user.should.have.property(\"permissions\", \"*\");\n        result.user.should.have.property(\"image\", \"http://example.com\");\n        result.user.should.have.property(\"anonymous\", false);\n        result.user.should.not.have.property(\"private\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"gets the filtered settings when editor disabled ","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":136,"column":56,"index":4531},"line":136,"code":"    it(\"gets the filtered settings when editor disabled \", function () {\n      settings.init({\n        settings: {\n          disableEditor: true,\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            getActiveProject: () => 'test-active-project',\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"user\");\n        result.user.should.have.property(\"username\", \"nick\");\n        result.user.should.have.property(\"permissions\", \"*\");\n        result.user.should.have.property(\"image\", \"http://example.com\");\n        result.user.should.have.property(\"anonymous\", false);\n        result.user.should.not.have.property(\"private\");\n\n        // Filtered out when disableEditor is true\n        result.should.not.have.property(\"paletteCategories\", [\"red\", \"blue\", \"green\"]);\n        result.should.not.have.property(\"testNodeSetting\", \"helloWorld\");\n        result.should.not.have.property(\"foo\", 123);\n        result.should.not.have.property(\"flowEncryptionType\", \"test-key-type\");\n        result.should.not.have.property(\"project\");\n        result.should.not.have.property(\"git\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"includes project settings if projects available","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":207,"column":55,"index":6936},"line":207,"code":"    it('includes project settings if projects available', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            getActiveProject: () => 'test-active-project',\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.have.property(\"project\", \"test-active-project\");\n        result.should.not.have.property(\"files\");\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"includes existing files details if projects enabled but no active project and files exist","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":270,"column":97,"index":8835},"line":270,"code":"    it('includes existing files details if projects enabled but no active project and files exist', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            flowFileExists: () => true,\n            getActiveProject: () => false,\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n        result.should.not.have.property(\"project\");\n        result.should.have.property(\"files\");\n        result.files.should.have.property(\"flow\", 'test-flow-file');\n        result.files.should.have.property(\"credentials\", 'test-creds-file');\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"does not include file details if projects enabled but no active project and files do not exist","suites":["runtime-api/settings","getRuntimeSettings"],"updatePoint":{"line":340,"column":102,"index":11012},"line":340,"code":"    it('does not include file details if projects enabled but no active project and files do not exist', function () {\n      settings.init({\n        settings: {\n          foo: 123,\n          httpNodeRoot: \"testHttpNodeRoot\",\n          version: \"testVersion\",\n          paletteCategories: [\"red\", \"blue\", \"green\"],\n          exportNodeSettings: obj => {\n            obj.testNodeSetting = \"helloWorld\";\n          }\n        },\n        plugins: {\n          exportPluginSettings: obj => {\n            obj.testPluginSettings = \"helloPluginWorld\";\n          }\n        },\n        nodes: {\n          listContextStores: () => {\n            return {\n              stores: [\"file\", \"memory\"],\n              default: \"file\"\n            };\n          },\n          installerEnabled: () => false,\n          getCredentialKeyType: () => \"test-key-type\"\n        },\n        library: {\n          getLibraries: () => {\n            [\"lib1\"];\n          }\n        },\n        storage: {\n          projects: {\n            flowFileExists: () => false,\n            getActiveProject: () => false,\n            getFlowFilename: () => 'test-flow-file',\n            getCredentialsFilename: () => 'test-creds-file',\n            getGlobalGitUser: () => {\n              return {\n                name: 'foo',\n                email: 'foo@example.com'\n              };\n            }\n          }\n        }\n      });\n      return settings.getRuntimeSettings({\n        user: {\n          username: \"nick\",\n          anonymous: false,\n          image: \"http://example.com\",\n          permissions: \"*\",\n          private: \"secret\"\n        }\n      }).then(result => {\n        result.should.not.have.property(\"project\");\n        result.should.not.have.property(\"files\");\n        result.should.have.property(\"git\");\n        result.git.should.have.property(\"globalUser\", {\n          name: 'foo',\n          email: 'foo@example.com'\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns default user settings","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":413,"column":37,"index":13050},"line":413,"code":"    it(\"returns default user settings\", function () {\n      return settings.getUserSettings({}).then(result => {\n        result.should.eql(\"_\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns default user settings for anonymous","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":418,"column":51,"index":13227},"line":418,"code":"    it(\"returns default user settings for anonymous\", function () {\n      return settings.getUserSettings({\n        user: {\n          anonymous: true\n        }\n      }).then(result => {\n        result.should.eql(\"_\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns user settings","suites":["runtime-api/settings","getUserSettings"],"updatePoint":{"line":427,"column":29,"index":13441},"line":427,"code":"    it(\"returns user settings\", function () {\n      return settings.getUserSettings({\n        user: {\n          username: 'nick'\n        }\n      }).then(result => {\n        result.should.eql(\"nick\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets default user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":468,"column":34,"index":14516},"line":468,"code":"    it('sets default user settings', function () {\n      return settings.updateUserSettings({\n        settings: {\n          abc: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"merges user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":477,"column":28,"index":14743},"line":477,"code":"    it('merges user settings', function () {\n      return settings.updateUserSettings({\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(123);\n        userSettings._.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets default user settings for anonymous user","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":487,"column":53,"index":15039},"line":487,"code":"    it('sets default user settings for anonymous user', function () {\n      return settings.updateUserSettings({\n        user: {\n          anonymous: true\n        },\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings._.abc.should.eql(123);\n        userSettings._.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"sets named user settings","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":500,"column":32,"index":15367},"line":500,"code":"    it('sets named user settings', function () {\n      return settings.updateUserSettings({\n        user: {\n          username: 'nick'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(function () {\n        userSettings.nick.abc.should.eql(456);\n        userSettings.nick.def.should.eql(789);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":513,"column":35,"index":15705},"line":513,"code":"    it('rejects with suitable error', function (done) {\n      settings.updateUserSettings({\n        user: {\n          username: 'error'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error - thrown","suites":["runtime-api/settings","updateUserSettings"],"updatePoint":{"line":528,"column":44,"index":16106},"line":528,"code":"    it('rejects with suitable error - thrown', function (done) {\n      settings.updateUserSettings({\n        user: {\n          username: 'throw'\n        },\n        settings: {\n          def: 789\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default users keys","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":563,"column":38,"index":17013},"line":563,"code":"    it('returns the default users keys', function () {\n      return settings.getUserKeys({}).then(result => {\n        result.should.eql(['__default']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default users keys for anonymous","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":568,"column":52,"index":17197},"line":568,"code":"    it('returns the default users keys for anonymous', function () {\n      return settings.getUserKeys({\n        user: {\n          anonymous: true\n        }\n      }).then(result => {\n        result.should.eql(['__default']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the users keys","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":577,"column":30,"index":17418},"line":577,"code":"    it('returns the users keys', function () {\n      return settings.getUserKeys({\n        user: {\n          username: 'nick'\n        }\n      }).then(result => {\n        result.should.eql(['nick']);\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","getUserKeys"],"updatePoint":{"line":586,"column":35,"index":17640},"line":586,"code":"    it('rejects with suitable error', function (done) {\n      settings.getUserKeys({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default user key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":623,"column":36,"index":18646},"line":623,"code":"    it('returns the default user key', function () {\n      return settings.getUserKey({\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the default user key - anonymous","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":633,"column":48,"index":18905},"line":633,"code":"    it('returns the default user key - anonymous', function () {\n      return settings.getUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the user key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":646,"column":28,"index":19197},"line":646,"code":"    it('returns the user key', function () {\n      return settings.getUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(result => {\n        result.should.eql({\n          id: 'keyid',\n          username: \"nick\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"404s for unknown key","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":659,"column":28,"index":19485},"line":659,"code":"    it('404s for unknown key', function (done) {\n      settings.getUserKey({\n        user: {\n          username: '404'\n        },\n        id: 'keyid'\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 404);\n        err.should.have.property('code', 'not_found');\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","getUserKey"],"updatePoint":{"line":673,"column":35,"index":19893},"line":673,"code":"    it('rejects with suitable error', function (done) {\n      settings.getUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the default user","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":708,"column":38,"index":20833},"line":708,"code":"    it('generates for the default user', function () {\n      return settings.generateUserKey({\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            id: 'keyid'\n          },\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the default user - anonymous","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":721,"column":50,"index":21168},"line":721,"code":"    it('generates for the default user - anonymous', function () {\n      return settings.generateUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            user: {\n              anonymous: true\n            },\n            id: 'keyid'\n          },\n          username: \"__default\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"generates for the user","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":740,"column":30,"index":21601},"line":740,"code":"    it('generates for the user', function () {\n      return settings.generateUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(result => {\n        var data = JSON.parse(result);\n        data.should.eql({\n          opts: {\n            user: {\n              username: 'nick'\n            },\n            id: 'keyid'\n          },\n          username: \"nick\"\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","generateUserKey"],"updatePoint":{"line":759,"column":35,"index":22036},"line":759,"code":"    it('rejects with suitable error', function (done) {\n      settings.generateUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes for the default user","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":798,"column":36,"index":23081},"line":798,"code":"    it('removes for the default user', function () {\n      return settings.removeUserKey({\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"__default\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes for the default user key - anonymous","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":806,"column":52,"index":23340},"line":806,"code":"    it('removes for the default user key - anonymous', function () {\n      return settings.removeUserKey({\n        user: {\n          anonymous: true\n        },\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"__default\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns the user key","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":817,"column":28,"index":23628},"line":817,"code":"    it('returns the user key', function () {\n      return settings.removeUserKey({\n        user: {\n          username: 'nick'\n        },\n        id: 'keyid'\n      }).then(() => {\n        received.username.should.eql(\"nick\");\n        received.id.should.eql(\"keyid\");\n      });\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects with suitable error","suites":["runtime-api/settings","removeUserKey"],"updatePoint":{"line":828,"column":35,"index":23919},"line":828,"code":"    it('rejects with suitable error', function (done) {\n      settings.removeUserKey({\n        user: {\n          username: 'error'\n        }\n      }).then(result => {\n        done(\"Unexpected resolve for error case\");\n      }).catch(err => {\n        err.should.have.property('status', 400);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/api/settings_spec.js","skipped":false,"dir":"test"},{"name":"called with an empty flow","suites":["Flow","#constructor"],"updatePoint":{"line":190,"column":33,"index":5951},"line":190,"code":"    it('called with an empty flow', function () {\n      var config = flowUtils.parseConfig([]);\n      var flow = Flow.create({}, config);\n      var nodeCount = 0;\n      Object.keys(flow.getActiveNodes()).length.should.equal(0);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates an initial configuration and stops it","suites":["Flow","#start"],"updatePoint":{"line":198,"column":58,"index":6253},"line":198,"code":"    it(\"instantiates an initial configuration and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('2').should.have.a.property('id', '2');\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4');\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"2\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].on(\"input\", function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"2\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          try {\n            currentNodes.should.not.have.a.property(\"1\");\n            currentNodes.should.not.have.a.property(\"2\");\n            currentNodes.should.not.have.a.property(\"3\");\n            currentNodes.should.not.have.a.property(\"4\");\n            stoppedNodes.should.have.a.property(\"1\");\n            stoppedNodes.should.have.a.property(\"2\");\n            stoppedNodes.should.have.a.property(\"3\");\n            stoppedNodes.should.have.a.property(\"4\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates config nodes in the right order","suites":["Flow","#start"],"updatePoint":{"line":270,"column":52,"index":8592},"line":270,"code":"    it(\"instantiates config nodes in the right order\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"5\"\n      },\n      // This node depends on #5\n      {\n        id: \"5\",\n        z: \"t1\",\n        type: \"test\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(5);\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes.should.have.a.property(\"5\");\n      currentNodes[\"1\"].should.have.a.property(\"_index\", 2);\n      currentNodes[\"2\"].should.have.a.property(\"_index\", 3);\n      currentNodes[\"3\"].should.have.a.property(\"_index\", 4);\n      currentNodes[\"4\"].should.have.a.property(\"_index\", 1);\n      currentNodes[\"5\"].should.have.a.property(\"_index\", 0);\n      flow.stop().then(function () {\n        currentNodes.should.not.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        currentNodes.should.not.have.a.property(\"4\");\n        currentNodes.should.not.have.a.property(\"5\");\n        stoppedNodes.should.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        stoppedNodes.should.have.a.property(\"4\");\n        stoppedNodes.should.have.a.property(\"5\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"detects dependency loops in config nodes","suites":["Flow","#start"],"updatePoint":{"line":337,"column":48,"index":10630},"line":337,"code":"    it(\"detects dependency loops in config nodes\", function () {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"node1\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"node2\"\n      },\n      // This node depends on #5\n      {\n        id: \"node2\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"node1\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      /*jshint immed: false */\n      (function () {\n        flow.start();\n      }).should.throw(\"Circular config node dependency detected: node1\");\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"rewires nodes specified by diff","suites":["Flow","#start"],"updatePoint":{"line":360,"column":39,"index":11220},"line":360,"code":"    it(\"rewires nodes specified by diff\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      createCount.should.equal(0);\n      flow.start();\n      //TODO: use update to pass in new wiring and verify the change\n      createCount.should.equal(3);\n      flow.start({\n        rewired: [\"2\"]\n      });\n      createCount.should.equal(3);\n      rewiredNodes.should.have.a.property(\"2\");\n      done();\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates a node with environment variable property values","suites":["Flow","#start"],"updatePoint":{"line":401,"column":69,"index":12186},"line":401,"code":"    it(\"instantiates a node with environment variable property values\", function (done) {\n      after(function () {\n        delete process.env.NODE_RED_TEST_VALUE;\n      });\n      process.env.NODE_RED_TEST_VALUE = \"a-value\";\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE)\",\n        wires: []\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: {\n          a: \"$(NODE_RED_TEST_VALUE)\"\n        },\n        wires: []\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \" $(NODE_RED_TEST_VALUE)\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE) \",\n        wires: []\n      }, {\n        id: \"5\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"$(NODE_RED_TEST_VALUE_NONE)\",\n        wires: []\n      }, {\n        id: \"6\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: [\"$(NODE_RED_TEST_VALUE)\"],\n        wires: []\n      }]);\n      var flow = Flow.create({\n        getSetting: v => process.env[v]\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].foo.should.equal(\"a-value\");\n      activeNodes[\"2\"].foo.a.should.equal(\"a-value\");\n      activeNodes[\"3\"].foo.should.equal(\" $(NODE_RED_TEST_VALUE)\");\n      activeNodes[\"4\"].foo.should.equal(\"$(NODE_RED_TEST_VALUE) \");\n      activeNodes[\"5\"].foo.should.equal(\"$(NODE_RED_TEST_VALUE_NONE)\");\n      activeNodes[\"6\"].foo[0].should.equal(\"a-value\");\n      flow.stop().then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"ignores disabled nodes","suites":["Flow","#start"],"updatePoint":{"line":475,"column":30,"index":14039},"line":475,"code":"    it(\"ignores disabled nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        d: true,\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }, {\n        id: \"5\",\n        z: \"t1\",\n        type: \"test\",\n        d: true,\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(3);\n      flow.getNode('1').should.have.a.property('id', '1');\n      should.not.exist(flow.getNode('2'));\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4');\n      should.not.exist(flow.getNode('5'));\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.not.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        // Message doesn't reach 3 as 2 is disabled\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n        flow.stop().then(function () {\n          try {\n            currentNodes.should.not.have.a.property(\"1\");\n            currentNodes.should.not.have.a.property(\"2\");\n            currentNodes.should.not.have.a.property(\"3\");\n            currentNodes.should.not.have.a.property(\"4\");\n            stoppedNodes.should.have.a.property(\"1\");\n            stoppedNodes.should.not.have.a.property(\"2\");\n            stoppedNodes.should.have.a.property(\"3\");\n            stoppedNodes.should.have.a.property(\"4\");\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops all nodes","suites":["Flow","#stop"],"updatePoint":{"line":556,"column":23,"index":16453},"line":556,"code":"    it(\"stops all nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"asyncTest\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop().then(function () {\n        currentNodes.should.not.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        stoppedNodes.should.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops specified nodes","suites":["Flow","#stop"],"updatePoint":{"line":600,"column":29,"index":17627},"line":600,"code":"    it(\"stops specified nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop([\"2\"]).then(function () {\n        currentNodes.should.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.have.a.property(\"3\");\n        stoppedNodes.should.not.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.not.have.a.property(\"3\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"stops config nodes last","suites":["Flow","#stop"],"updatePoint":{"line":644,"column":31,"index":18791},"line":644,"code":"    it(\"stops config nodes last\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"c1\",\n        z: \"t1\",\n        type: \"test\"\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"c2\",\n        z: \"t1\",\n        type: \"test\"\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"c3\",\n        z: \"t1\",\n        type: \"test\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"c1\");\n      currentNodes.should.have.a.property(\"c2\");\n      currentNodes.should.have.a.property(\"c3\");\n      stoppedOrder.should.have.a.length(0);\n      flow.stop().then(function () {\n        stoppedOrder.should.eql(['1', '2', '3', 'c1', 'c2', 'c3']);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"Times out a node that fails to close","suites":["Flow","#stop"],"updatePoint":{"line":699,"column":44,"index":20123},"line":699,"code":"    it(\"Times out a node that fails to close\", function (done) {\n      Flow.init({\n        settings: {\n          nodeCloseTimeout: 50\n        },\n        log: {\n          log: sinon.stub(),\n          debug: sinon.stub(),\n          trace: sinon.stub(),\n          warn: sinon.stub(),\n          info: sinon.stub(),\n          metric: sinon.stub(),\n          _: function () {\n            return \"abc\";\n          }\n        }\n      });\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testAsync\",\n        closeDelay: 80,\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      flow.stop().then(function () {\n        currentNodes.should.have.a.property(\"1\");\n        currentNodes.should.not.have.a.property(\"2\");\n        currentNodes.should.not.have.a.property(\"3\");\n        stoppedNodes.should.not.have.a.property(\"1\");\n        stoppedNodes.should.have.a.property(\"2\");\n        stoppedNodes.should.have.a.property(\"3\");\n        setTimeout(function () {\n          currentNodes.should.not.have.a.property(\"1\");\n          stoppedNodes.should.have.a.property(\"1\");\n          done();\n        }, 40);\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"gets a node known to the flow","suites":["Flow","#getNode"],"updatePoint":{"line":766,"column":37,"index":21882},"line":766,"code":"    it(\"gets a node known to the flow\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes to parent if node not known locally","suites":["Flow","#getNode"],"updatePoint":{"line":808,"column":50,"index":22805},"line":808,"code":"    it(\"passes to parent if node not known locally\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({\n        getNode: id => {\n          return {\n            id: id\n          };\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('parentNode').should.have.a.property('id', 'parentNode');\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"does not pass to parent if cancelBubble set","suites":["Flow","#getNode"],"updatePoint":{"line":857,"column":51,"index":23899},"line":857,"code":"    it(\"does not pass to parent if cancelBubble set\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\"\n      }]);\n      var flow = Flow.create({\n        getNode: id => {\n          return {\n            id: id\n          };\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(4);\n      flow.getNode('1').should.have.a.property('id', '1');\n      should.not.exist(flow.getNode('parentNode', true));\n      flow.stop().then(() => {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the adjacent status node","suites":["Flow","#handleStatus"],"updatePoint":{"line":908,"column":57,"index":25028},"line":908,"code":"    it(\"passes a status event to the adjacent status node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(5);\n      flow.handleStatus(config.flows[\"t1\"].nodes[\"1\"], {\n        text: \"my-status\",\n        random: \"otherProperty\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"random\", \"otherProperty\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the adjacent scoped status node ","suites":["Flow","#handleStatus"],"updatePoint":{"line":983,"column":65,"index":27453},"line":983,"code":"    it(\"passes a status event to the adjacent scoped status node \", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"2\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"1\"],\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(5);\n      flow.handleStatus(config.flows[\"t1\"].nodes[\"1\"], {\n        text: \"my-status\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"my-status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the adjacent catch node","suites":["Flow","#handleError"],"updatePoint":{"line":1053,"column":56,"index":29378},"line":1053,"code":"    it(\"passes an error event to the adjacent catch node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(6);\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n\n        // Node sn3 has uncaught:true - so should not get called\n        currentNodes[\"sn3\"].should.have.a.property(\"handled\", 0);\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the adjacent scoped catch node ","suites":["Flow","#handleError"],"updatePoint":{"line":1137,"column":64,"index":31955},"line":1137,"code":"    it(\"passes an error event to the adjacent scoped catch node \", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"2\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"1\"],\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }, {\n        id: \"sn4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        uncaught: true,\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(7);\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn2\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n\n        // Node sn3/4 have uncaught:true - so should not get called\n        currentNodes[\"sn3\"].should.have.a.property(\"handled\", 0);\n        currentNodes[\"sn4\"].should.have.a.property(\"handled\", 0);\n\n        // Inject error that sn1/2 will ignore - so should get picked up by sn3\n        flow.handleError(config.flows[\"t1\"].nodes[\"3\"], \"my-error-2\", {\n          a: \"foo-2\"\n        });\n        setTimeout(function () {\n          currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n          currentNodes[\"sn2\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"sn3\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"sn4\"].should.have.a.property(\"handled\", 1);\n          statusMessage = currentNodes[\"sn3\"].messages[0];\n          statusMessage.should.have.a.property(\"error\");\n          statusMessage.error.should.have.a.property(\"message\", \"my-error-2\");\n          statusMessage.error.should.have.a.property(\"source\");\n          statusMessage.error.source.should.have.a.property(\"id\", \"3\");\n          statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n          flow.stop().then(function () {\n            done();\n          });\n        }, 50);\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"moves any existing error object sideways","suites":["Flow","#handleError"],"updatePoint":{"line":1242,"column":48,"index":35226},"line":1242,"code":"    it(\"moves any existing error object sideways\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      flow.handleError(config.flows[\"t1\"].nodes[\"1\"], \"my-error\", {\n        a: \"foo\",\n        error: \"existing\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"_error\", \"existing\");\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"my-error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"id\", \"1\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"test\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"a\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"prevents an error looping more than 10 times","suites":["Flow","#handleError"],"updatePoint":{"line":1300,"column":52,"index":36890},"line":1300,"code":"    it(\"prevents an error looping more than 10 times\", function () {});","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"passes a complete event to the adjacent Complete node","suites":["Flow","#handleComplete"],"updatePoint":{"line":1303,"column":61,"index":37021},"line":1303,"code":"    it(\"passes a complete event to the adjacent Complete node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testDone\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"testDone\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"cn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"complete\",\n        scope: [\"1\", \"3\"],\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4);\n      var msg = {\n        payload: \"hello world\"\n      };\n      var n1 = currentNodes[\"1\"].receive(msg);\n      setTimeout(function () {\n        currentNodes[\"cn\"].should.have.a.property(\"handled\", 2);\n        currentNodes[\"cn\"].messages[0].should.have.a.property(\"handled\", 1);\n        currentNodes[\"cn\"].messages[1].should.have.a.property(\"handled\", 2);\n        flow.stop().then(function () {\n          done();\n        });\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - no cloning","suites":["Flow","#send"],"updatePoint":{"line":1359,"column":36,"index":38401},"line":1359,"code":"    it(\"sends a message - no cloning\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      var messageReceived = false;\n      n2.receive = function (msg) {\n        messageReceived = true;\n        try {\n          msg.should.be.exactly(message);\n          shutdownTest();\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: false\n      }]);\n      messageReceived.should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - cloning","suites":["Flow","#send"],"updatePoint":{"line":1418,"column":33,"index":39762},"line":1418,"code":"    it(\"sends a message - cloning\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      n2.receive = function (msg) {\n        try {\n          // Message should be cloned\n          msg.should.be.eql(message);\n          msg.should.not.be.exactly(message);\n          shutdownTest();\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: true\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends multiple messages","suites":["Flow","#send"],"updatePoint":{"line":1476,"column":31,"index":41092},"line":1476,"code":"    it(\"sends multiple messages\", function (done) {\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      var messageCount = 0;\n      n2.receive = function (msg) {\n        try {\n          msg.should.be.exactly(messages[messageCount++]);\n          if (messageCount === 2) {\n            shutdownTest();\n          }\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n      var messages = [{\n        payload: \"hello\"\n      }, {\n        payload: \"world\"\n      }];\n      flow.send([{\n        msg: messages[0],\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        }\n      }, {\n        msg: messages[1],\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        }\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sends a message - triggers hooks","suites":["Flow","#send"],"updatePoint":{"line":1546,"column":40,"index":42643},"line":1546,"code":"    it(\"sends a message - triggers hooks\", function (done) {\n      var hookErrors = [];\n      var messageReceived = false;\n      var hooksCalled = [];\n      hooks.add(\"onSend\", function (sendEvents) {\n        hooksCalled.push(\"onSend\");\n        try {\n          messageReceived.should.be.false();\n          sendEvents.should.have.length(1);\n          sendEvents[0].msg.should.be.exactly(message);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"preRoute\", function (sendEvent) {\n        hooksCalled.push(\"preRoute\");\n        try {\n          messageReceived.should.be.false();\n          sendEvent.msg.should.be.exactly(message);\n          should.not.exist(sendEvent.destination.node);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"preDeliver\", function (sendEvent) {\n        hooksCalled.push(\"preDeliver\");\n        try {\n          messageReceived.should.be.false();\n          // Cloning should have happened\n          sendEvent.msg.should.not.be.exactly(message);\n          // Destinatino node populated\n          should.exist(sendEvent.destination.node);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"postDeliver\", function (sendEvent) {\n        hooksCalled.push(\"postDeliver\");\n        try {\n          messageReceived.should.be.false();\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      var shutdownTest = function (err) {\n        hooks.clear();\n        flow.stop().then(() => {\n          done(err);\n        });\n      };\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"3\"]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      Object.keys(flow.getActiveNodes()).should.have.length(2);\n      var n1 = flow.getNode('1');\n      var n2 = flow.getNode('2');\n      n2.receive = function (msg) {\n        messageReceived = true;\n        try {\n          msg.should.be.eql(message);\n          msg.should.not.be.exactly(message);\n          hooksCalled.should.eql([\"onSend\", \"preRoute\", \"preDeliver\", \"postDeliver\"]);\n          if (hookErrors.length > 0) {\n            shutdownTest(hookErrors[0]);\n          } else {\n            shutdownTest();\n          }\n        } catch (err) {\n          shutdownTest(err);\n        }\n      };\n      var message = {\n        payload: \"hello\"\n      };\n      flow.send([{\n        msg: message,\n        source: {\n          id: \"1\",\n          node: n1\n        },\n        destination: {\n          id: \"2\",\n          node: undefined\n        },\n        cloneMessage: true\n      }]);\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"onSend","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1746,"column":16,"index":48151},"line":1746,"code":"      it(\"onSend\", function (done) {\n        testHook(\"onSend\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preRoute","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1749,"column":18,"index":48241},"line":1749,"code":"      it(\"preRoute\", function (done) {\n        testHook(\"preRoute\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preDeliver","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1752,"column":20,"index":48335},"line":1752,"code":"      it(\"preDeliver\", function (done) {\n        testHook(\"preDeliver\", false, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"postDeliver","suites":["Flow","#send","errors thrown by hooks are reported to the sending node"],"updatePoint":{"line":1755,"column":21,"index":48432},"line":1755,"code":"      it(\"postDeliver\", function (done) {\n        testHook(\"postDeliver\", true, done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"onSend","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1858,"column":16,"index":51208},"line":1858,"code":"      it(\"onSend\", function (done) {\n        testHook(\"onSend\", done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preRoute","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1861,"column":18,"index":51291},"line":1861,"code":"      it(\"preRoute\", function (done) {\n        testHook(\"preRoute\", done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"preDeliver","suites":["Flow","#send","hooks can stop the sending of messages"],"updatePoint":{"line":1864,"column":20,"index":51378},"line":1864,"code":"      it(\"preDeliver\", function (done) {\n        testHook(\"preDeliver\", done);\n      });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"can instantiate a node with environment variable property values of group and tab","suites":["Flow","#env"],"updatePoint":{"line":1873,"column":89,"index":51736},"line":1873,"code":"    it(\"can instantiate a node with environment variable property values of group and tab\", function (done) {\n      try {\n        after(function () {\n          delete process.env.V0;\n          delete process.env.V1;\n        });\n        process.env.V0 = \"gv0\";\n        process.env.V1 = \"gv1\";\n        var config = flowUtils.parseConfig([{\n          id: \"t1\",\n          type: \"tab\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v0\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g1\",\n          type: \"group\",\n          z: \"t1\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v1\",\n            type: \"str\"\n          }, {\n            \"name\": \"V1\",\n            value: \"v2\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g2\",\n          type: \"group\",\n          z: \"t1\",\n          g: \"g1\",\n          env: [{\n            \"name\": \"V1\",\n            value: \"v3\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"1\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"$(V0)\",\n          wires: []\n        }, {\n          id: \"2\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"$(V0)\",\n          wires: []\n        }, {\n          id: \"3\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }, {\n          id: \"4\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g2\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }, {\n          id: \"5\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"$(V1)\",\n          wires: []\n        }]);\n        var flow = Flow.create({\n          getSetting: v => process.env[v]\n        }, config, config.flows[\"t1\"]);\n        flow.start();\n        var activeNodes = flow.getActiveNodes();\n        activeNodes[\"1\"].foo.should.equal(\"v0\");\n        activeNodes[\"2\"].foo.should.equal(\"v1\");\n        activeNodes[\"3\"].foo.should.equal(\"v2\");\n        activeNodes[\"4\"].foo.should.equal(\"v3\");\n        activeNodes[\"5\"].foo.should.equal(\"gv1\");\n        flow.stop().then(function () {\n          done();\n        });\n      } catch (e) {\n        console.log(e.stack);\n        done(e);\n      }\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"can access environment variable property using $parent","suites":["Flow","#env"],"updatePoint":{"line":1974,"column":62,"index":54090},"line":1974,"code":"    it(\"can access environment variable property using $parent\", function (done) {\n      try {\n        after(function () {\n          delete process.env.V0;\n          delete process.env.V1;\n        });\n        process.env.V0 = \"gv0\";\n        process.env.V1 = \"gv1\";\n        var config = flowUtils.parseConfig([{\n          id: \"t1\",\n          type: \"tab\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v0\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g1\",\n          type: \"group\",\n          z: \"t1\",\n          env: [{\n            \"name\": \"V0\",\n            value: \"v1\",\n            type: \"str\"\n          }, {\n            \"name\": \"V1\",\n            value: \"v2\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"g2\",\n          type: \"group\",\n          z: \"t1\",\n          g: \"g1\",\n          env: [{\n            \"name\": \"V1\",\n            value: \"v3\",\n            type: \"str\"\n          }]\n        }, {\n          id: \"1\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"${$parent.V0}\",\n          wires: []\n        }, {\n          id: \"2\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"${$parent.V0}\",\n          wires: []\n        }, {\n          id: \"3\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g1\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }, {\n          id: \"4\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          g: \"g2\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }, {\n          id: \"5\",\n          x: 10,\n          y: 10,\n          z: \"t1\",\n          type: \"test\",\n          foo: \"${$parent.V1}\",\n          wires: []\n        }]);\n        var flow = Flow.create({\n          getSetting: v => process.env[v]\n        }, config, config.flows[\"t1\"]);\n        flow.start();\n        var activeNodes = flow.getActiveNodes();\n        activeNodes[\"1\"].foo.should.equal(\"gv0\");\n        activeNodes[\"2\"].foo.should.equal(\"v0\");\n        activeNodes[\"3\"].foo.should.equal(\"gv1\");\n        activeNodes[\"4\"].foo.should.equal(\"v2\");\n        activeNodes[\"5\"].foo.should.equal(\"gv1\");\n        flow.stop().then(function () {\n          done();\n        });\n      } catch (e) {\n        console.log(e.stack);\n        done(e);\n      }\n    });","file":"unit/@node-red/runtime/lib/flows/Flow_spec.js","skipped":false,"dir":"test"},{"name":"sets the full flow","suites":["flows/index","#setFlows"],"updatePoint":{"line":123,"column":26,"index":4002},"line":123,"code":"    it('sets the full flow', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        credentialsClean.called.should.be.true();\n        storage.hasOwnProperty('conf').should.be.true();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the full flow for type load","suites":["flows/index","#setFlows"],"updatePoint":{"line":147,"column":41,"index":4614},"line":147,"code":"    it('loads the full flow for type load', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var loadStorage = {\n        saveFlows: function (conf) {\n          loadStorage.conf = conf;\n          return Promise.resolve(456);\n        },\n        getFlows: function () {\n          return Promise.resolve({\n            flows: originalConfig,\n            rev: 123\n          });\n        }\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: loadStorage\n      });\n      flows.setFlows(originalConfig, \"load\").then(function () {\n        credentialsClean.called.should.be.false();\n        // 'load' type does not trigger a save\n        loadStorage.hasOwnProperty('conf').should.be.false();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"extracts credentials from the full flow","suites":["flows/index","#setFlows"],"updatePoint":{"line":184,"column":47,"index":5601},"line":184,"code":"    it('extracts credentials from the full flow', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: [],\n        credentials: {\n          \"a\": 1\n        }\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        credentialsClean.called.should.be.true();\n        storage.hasOwnProperty('conf').should.be.true();\n        var cleanedFlows = flows.getFlows();\n        storage.conf.flows.should.eql(cleanedFlows.flows);\n        cleanedFlows.flows.should.not.eql(originalConfig);\n        cleanedFlows.flows[0].credentials = {\n          \"a\": 1\n        };\n        cleanedFlows.flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"sets the full flow including credentials","suites":["flows/index","#setFlows"],"updatePoint":{"line":217,"column":48,"index":6504},"line":217,"code":"    it('sets the full flow including credentials', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var credentials = {\n        \"t1-1\": {\n          \"a\": 1\n        }\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig, credentials).then(function () {\n        credentialsClean.called.should.be.true();\n        credentialsAdd.called.should.be.true();\n        credentialsAdd.lastCall.args[0].should.eql(\"t1-1\");\n        credentialsAdd.lastCall.args[1].should.eql({\n          \"a\": 1\n        });\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updates existing flows with partial deployment - nodes","suites":["flows/index","#setFlows"],"updatePoint":{"line":250,"column":62,"index":7363},"line":250,"code":"    it('updates existing flows with partial deployment - nodes', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var newConfig = clone(originalConfig);\n      newConfig.push({\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      });\n      newConfig.push({\n        id: \"t2\",\n        type: \"tab\"\n      });\n      newConfig.push({\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      });\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      events.once('flows:started', function () {\n        flows.setFlows(newConfig, \"nodes\").then(function () {\n          flows.getFlows().flows.should.eql(newConfig);\n          flowCreate.flows['t1'].update.called.should.be.true();\n          flowCreate.flows['t2'].start.called.should.be.true();\n          flowCreate.flows['_GLOBAL_'].update.called.should.be.true();\n          done();\n        });\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updates existing flows with partial deployment - flows","suites":["flows/index","#setFlows"],"updatePoint":{"line":306,"column":62,"index":8752},"line":306,"code":"    it('updates existing flows with partial deployment - flows', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var newConfig = clone(originalConfig);\n      newConfig.push({\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      });\n      newConfig.push({\n        id: \"t2\",\n        type: \"tab\"\n      });\n      newConfig.push({\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      });\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      events.once('flows:started', function () {\n        flows.setFlows(newConfig, \"nodes\").then(function () {\n          flows.getFlows().flows.should.eql(newConfig);\n          flowCreate.flows['t1'].update.called.should.be.true();\n          flowCreate.flows['t2'].start.called.should.be.true();\n          flowCreate.flows['_GLOBAL_'].update.called.should.be.true();\n          flows.stopFlows().then(done);\n        });\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"returns error if it cannot decrypt credentials","suites":["flows/index","#setFlows"],"updatePoint":{"line":362,"column":54,"index":10155},"line":362,"code":"    it('returns error if it cannot decrypt credentials', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var credentials = {\n        \"$\": \"fail\"\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig, credentials).then(function () {\n        done(\"Unexpected success when credentials couldn't be decrypted\");\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"loads the flow config","suites":["flows/index","#load"],"updatePoint":{"line":390,"column":29,"index":10804},"line":390,"code":"    it('loads the flow config', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        credentialsLoad.called.should.be.true();\n        // 'load' type does not trigger a save\n        storage.hasOwnProperty('conf').should.be.false();\n        flows.getFlows().flows.should.eql(originalConfig);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"starts the loaded config","suites":["flows/index","#startFlows"],"updatePoint":{"line":422,"column":32,"index":11607},"line":422,"code":"    it('starts the loaded config', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      events.once('flows:started', function () {\n        Object.keys(flowCreate.flows).should.eql(['_GLOBAL_', 't1']);\n        done();\n      });\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"does not start if nodes missing","suites":["flows/index","#startFlows"],"updatePoint":{"line":452,"column":39,"index":12322},"line":452,"code":"    it('does not start if nodes missing', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(() => {\n        try {\n          flowCreate.called.should.be.false();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"starts when missing nodes registered","suites":["flows/index","#startFlows"],"updatePoint":{"line":492,"column":44,"index":13174},"line":492,"code":"    it('starts when missing nodes registered', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }, {\n        id: \"t1-3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing2\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(() => {\n        flowCreate.called.should.be.false();\n        events.emit(\"type-registered\", \"missing\");\n        setTimeout(function () {\n          flowCreate.called.should.be.false();\n          events.emit(\"type-registered\", \"missing2\");\n          setTimeout(function () {\n            flowCreate.called.should.be.true();\n            done();\n          }, 10);\n        }, 10);\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"does not start if external modules missing","suites":["flows/index","#startFlows"],"updatePoint":{"line":543,"column":50,"index":14387},"line":543,"code":"    it('does not start if external modules missing', function (done) {\n      var originalConfig = [{\n        id: \"node-with-missing-modules\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      var receivedEvent = null;\n      var handleEvent = function (payload) {\n        receivedEvent = payload;\n      };\n      events.on(\"runtime-event\", handleEvent);\n\n      //{id:\"runtime-state\",payload:{error:\"missing-modules\", type:\"warning\",text:\"notification.warnings.missing-modules\",modules:missingModules},retain:true});\"\n\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(flows.startFlows).then(() => {\n        events.removeListener(\"runtime-event\", handleEvent);\n        try {\n          flowCreate.called.should.be.false();\n          receivedEvent.should.have.property('id', 'runtime-state');\n          receivedEvent.should.have.property('payload', {\n            state: 'stop',\n            error: 'missing-modules',\n            type: 'warning',\n            text: 'notification.warnings.missing-modules',\n            modules: []\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"iterates the flow nodes","suites":["flows/index","#eachNode"],"updatePoint":{"line":594,"column":31,"index":15880},"line":594,"code":"    it('iterates the flow nodes', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        var c = 0;\n        flows.eachNode(function (node) {\n          c++;\n        });\n        c.should.equal(2);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"returns cleanly if type not is use","suites":["flows/index","#checkTypeInUse"],"updatePoint":{"line":752,"column":42,"index":21480},"line":752,"code":"    it('returns cleanly if type not is use', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        flows.checkTypeInUse(\"unused-module\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error if type is in use","suites":["flows/index","#checkTypeInUse"],"updatePoint":{"line":774,"column":38,"index":21970},"line":774,"code":"    it('throws error if type is in use', function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.setFlows(originalConfig).then(function () {\n        /*jshint immed: false */\n        try {\n          flows.checkTypeInUse(\"used-module\");\n          done(\"type_in_use error not thrown\");\n        } catch (err) {\n          err.code.should.eql(\"type_in_use\");\n          done();\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"rejects duplicate node id","suites":["flows/index","#addFlow"],"updatePoint":{"line":804,"column":33,"index":22675},"line":804,"code":"    it(\"rejects duplicate node id\", function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        flows.addFlow({\n          label: 'new flow',\n          nodes: [{\n            id: \"t1-1\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }]\n        }).then(function () {\n          done(new Error('failed to reject duplicate node id'));\n        }).catch(function (err) {\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"addFlow","suites":["flows/index","#addFlow"],"updatePoint":{"line":844,"column":15,"index":23562},"line":844,"code":"    it(\"addFlow\", function (done) {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      storage.getFlows = function () {\n        return Promise.resolve({\n          flows: originalConfig\n        });\n      };\n      storage.setFlows = function () {\n        return Promise.resolve();\n      };\n      flows.init({\n        log: mockLog,\n        settings: {},\n        storage: storage\n      });\n      flows.load().then(function () {\n        return flows.startFlows();\n      }).then(function () {\n        flows.addFlow({\n          label: 'new flow',\n          nodes: [{\n            id: \"t2-1\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }, {\n            id: \"t2-2\",\n            x: 10,\n            y: 10,\n            z: \"t1\",\n            type: \"test\",\n            wires: []\n          }, {\n            id: \"t2-3\",\n            z: \"t1\",\n            type: \"test\"\n          }]\n        }).then(function (id) {\n          flows.getFlows().flows.should.have.lengthOf(6);\n          var createdFlows = Object.keys(flowCreate.flows);\n          createdFlows.should.have.lengthOf(3);\n          createdFlows[2].should.eql(id);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":false,"dir":"test"},{"name":"updateFlow","suites":["flows/index","#updateFlow"],"line":906,"code":"    it.skip(\"updateFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"removeFlow","suites":["flows/index","#removeFlow"],"line":909,"code":"    it.skip(\"removeFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"disableFlow","suites":["flows/index","#disableFlow"],"line":912,"code":"    it.skip(\"disableFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"enableFlow","suites":["flows/index","#enableFlow"],"line":915,"code":"    it.skip(\"enableFlow\");","file":"unit/@node-red/runtime/lib/flows/index_spec.js","skipped":true,"dir":"test"},{"name":"instantiates a subflow and stops it","suites":["Subflow","#start"],"updatePoint":{"line":284,"column":43,"index":8600},"line":284,"code":"    it(\"instantiates a subflow and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\", \"4\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }, {\n          \"wires\": [{\n            \"id\": \"sf1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        foo: \"sf1-cn\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sf1-cn\",\n        type: \"test\",\n        \"z\": \"sf1\"\n      }]);\n      var flow = Flow.create({\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4);\n      // var sfInstanceId = Object.keys(activeNodes)[5];\n      // var sfInstanceId2 = Object.keys(activeNodes)[6];\n      var sfConfigId = Object.keys(activeNodes)[4];\n      flow.getNode('1').should.have.a.property('id', '1');\n      flow.getNode('2').should.have.a.property('id', '2');\n      flow.getNode('3').should.have.a.property('id', '3');\n      flow.getNode('4').should.have.a.property('id', '4');\n      // flow.getNode(sfInstanceId).should.have.a.property('id',sfInstanceId);\n      // flow.getNode(sfInstanceId2).should.have.a.property('id',sfInstanceId2);\n      // flow.getNode(sfConfigId).should.have.a.property('id',sfConfigId);\n\n      // flow.getNode(sfInstanceId2).should.have.a.property('foo',sfConfigId);\n\n      Object.keys(currentNodes).should.have.length(6);\n      currentNodes.should.have.a.property(\"1\");\n      currentNodes.should.not.have.a.property(\"2\");\n      currentNodes.should.have.a.property(\"3\");\n      currentNodes.should.have.a.property(\"4\");\n      // currentNodes.should.have.a.property(sfInstanceId);\n      // currentNodes.should.have.a.property(sfInstanceId2);\n      // currentNodes.should.have.a.property(sfConfigId);\n\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"4\"].should.have.a.property(\"handled\", 0);\n      // currentNodes[sfInstanceId].should.have.a.property(\"handled\",0);\n      // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",0);\n\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        // currentNodes[sfInstanceId].should.have.a.property(\"handled\",1);\n        // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"4\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          Object.keys(currentNodes).should.have.length(0);\n          Object.keys(stoppedNodes).should.have.length(6);\n\n          // currentNodes.should.not.have.a.property(\"1\");\n          // currentNodes.should.not.have.a.property(\"3\");\n          // currentNodes.should.not.have.a.property(\"4\");\n          // // currentNodes.should.not.have.a.property(sfInstanceId);\n          // // currentNodes.should.not.have.a.property(sfInstanceId2);\n          // // currentNodes.should.not.have.a.property(sfConfigId);\n          // stoppedNodes.should.have.a.property(\"1\");\n          // stoppedNodes.should.have.a.property(\"3\");\n          // stoppedNodes.should.have.a.property(\"4\");\n          // // stoppedNodes.should.have.a.property(sfInstanceId);\n          // // stoppedNodes.should.have.a.property(sfInstanceId2);\n          // // stoppedNodes.should.have.a.property(sfConfigId);\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"instantiates a subflow inside a subflow and stops it","suites":["Subflow","#start"],"updatePoint":{"line":425,"column":60,"index":13225},"line":425,"code":"    it(\"instantiates a subflow inside a subflow and stops it\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\", \"4\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 1\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf2\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          wires: []\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"subflow:sf2\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        flow.stop().then(function () {\n          Object.keys(currentNodes).should.have.length(0);\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"rewires a subflow node on update/start","suites":["Subflow","#start"],"updatePoint":{"line":521,"column":46,"index":15340},"line":521,"code":"    it(\"rewires a subflow node on update/start\", function (done) {\n      var rawConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test1\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"test2\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }];\n      var config = flowUtils.parseConfig(clone(rawConfig));\n      rawConfig[2].wires = [[\"4\"]];\n      var newConfig = flowUtils.parseConfig(rawConfig);\n      var diff = flowUtils.diffConfigs(config, newConfig);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(4);\n      // var sfInstanceId = Object.keys(activeNodes)[4];\n      // var sfInstanceId2 = Object.keys(activeNodes)[5];\n\n      currentNodes[\"1\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"3\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"4\"].should.have.a.property(\"handled\", 0);\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"1\"].should.have.a.property(\"handled\", 1);\n        // currentNodes[sfInstanceId].should.have.a.property(\"handled\",1);\n        // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",1);\n        currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n        currentNodes[\"4\"].should.have.a.property(\"handled\", 0);\n        flow.update(newConfig, newConfig.flows[\"t1\"]);\n        flow.start(diff);\n        currentNodes[\"1\"].receive({\n          payload: \"test2\"\n        });\n        setTimeout(function () {\n          currentNodes[\"1\"].should.have.a.property(\"handled\", 2);\n          // currentNodes[sfInstanceId].should.have.a.property(\"handled\",2);\n          // currentNodes[sfInstanceId2].should.have.a.property(\"handled\",2);\n          currentNodes[\"3\"].should.have.a.property(\"handled\", 1);\n          currentNodes[\"4\"].should.have.a.property(\"handled\", 1);\n          flow.stop().then(function () {\n            done();\n          });\n        }, 150);\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"stops subflow instance nodes","suites":["Subflow","#stop"],"updatePoint":{"line":629,"column":36,"index":18402},"line":629,"code":"    it(\"stops subflow instance nodes\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      Object.keys(activeNodes).should.have.length(3);\n      Object.keys(stoppedNodes).should.have.length(0);\n      flow.stop([\"2\"]).then(function () {\n        Object.keys(currentNodes).should.have.length(2);\n        Object.keys(stoppedNodes).should.have.length(1);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the subflow's parent tab status node - all scope","suites":["Subflow","#handleStatus"],"updatePoint":{"line":693,"column":81,"index":19913},"line":693,"code":"    it(\"passes a status event to the subflow's parent tab status node - all scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"testStatus\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"test-status-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes a status event to the subflow's parent tab status node - targetted scope","suites":["Subflow","#handleStatus"],"updatePoint":{"line":772,"column":87,"index":21928},"line":772,"code":"    it(\"passes a status event to the subflow's parent tab status node - targetted scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        scope: [\"2\"],\n        wires: []\n      }]);\n      var parentFlowStatusCalled = false;\n      var flow = Flow.create({\n        handleStatus: () => {\n          parentFlowStatusCalled = true;\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        parentFlowStatusCalled.should.be.false();\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test status\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"testStatus\");\n        statusMessage.status.source.should.have.a.property(\"name\", \"test-status-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.payload as string","suites":["Subflow","status node"],"updatePoint":{"line":859,"column":102,"index":24188},"line":859,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.payload as string\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test-payload\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"test-payload\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.payload as status obj","suites":["Subflow","status node"],"updatePoint":{"line":944,"column":106,"index":26286},"line":944,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.payload as status obj\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: {\n          text: \"payload-obj\"\n        }\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"payload-obj\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"emits a status event when a message is passed to a subflow-status node - msg.status","suites":["Subflow","status node"],"updatePoint":{"line":1031,"column":91,"index":28395},"line":1031,"code":"    it(\"emits a status event when a message is passed to a subflow-status node - msg.status\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        name: \"test\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        status: {\n          text: \"status-obj\"\n        }\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"status\");\n        statusMessage.status.should.have.a.property(\"text\", \"status-obj\");\n        statusMessage.status.should.have.a.property(\"source\");\n        statusMessage.status.source.should.have.a.property(\"id\", \"2\");\n        statusMessage.status.source.should.have.a.property(\"type\", \"subflow:sf1\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"does not emit a regular status event if it contains a subflow-status node","suites":["Subflow","status node"],"updatePoint":{"line":1118,"column":81,"index":30491},"line":1118,"code":"    it(\"does not emit a regular status event if it contains a subflow-status node\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-1\",\n            port: 0\n          }]\n        }],\n        status: {\n          wires: []\n        }\n      }, {\n        id: \"sf1-1\",\n        type: \"testStatus\",\n        name: \"test-status-node\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"status\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test-payload\"\n      });\n      currentNodes[\"sn\"].should.have.a.property(\"handled\", 0);\n      flow.stop().then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the subflow's parent tab catch node - all scope","suites":["Subflow","#handleError"],"updatePoint":{"line":1194,"column":80,"index":32106},"line":1194,"code":"    it(\"passes an error event to the subflow's parent tab catch node - all scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        name: \"test-error-node\",\n        type: \"testError\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        foo: \"a\",\n        wires: []\n      }]);\n      var flow = Flow.create({}, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"test error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"testError\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"test-error-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"passes an error event to the subflow's parent tab catch node - targetted scope","suites":["Subflow","#handleError"],"updatePoint":{"line":1273,"column":86,"index":34112},"line":1273,"code":"    it(\"passes an error event to the subflow's parent tab catch node - targetted scope\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        name: \"a\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"name\": \"Subflow 2\",\n        \"info\": \"\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        name: \"test-error-node\",\n        type: \"testError\",\n        \"z\": \"sf1\",\n        x: 166,\n        y: 99,\n        \"wires\": [[]]\n      }, {\n        id: \"sn\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"catch\",\n        scope: [\"2\"],\n        wires: []\n      }]);\n      var parentFlowErrorCalled = false;\n      var flow = Flow.create({\n        handleError: () => {\n          parentFlowErrorCalled = true;\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var activeNodes = flow.getActiveNodes();\n      activeNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        parentFlowErrorCalled.should.be.false();\n        currentNodes[\"sn\"].should.have.a.property(\"handled\", 1);\n        var statusMessage = currentNodes[\"sn\"].messages[0];\n        statusMessage.should.have.a.property(\"error\");\n        statusMessage.error.should.have.a.property(\"message\", \"test error\");\n        statusMessage.error.should.have.a.property(\"source\");\n        statusMessage.error.source.should.have.a.property(\"type\", \"testError\");\n        statusMessage.error.source.should.have.a.property(\"name\", \"test-error-node\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access process env var","suites":["Subflow","#env var"],"updatePoint":{"line":1375,"column":34,"index":36644},"line":1375,"code":"    it(\"can access process env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testEnv\",\n        z: \"sf1\",\n        foo: \"sf1-cn\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      process.env[\"__KEY__\"] = \"__VAL__\";\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL__\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access subflow env var","suites":["Subflow","#env var"],"updatePoint":{"line":1453,"column":34,"index":38300},"line":1453,"code":"    it(\"can access subflow env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var testenv_node = null;\n      for (var n in currentNodes) {\n        var node = currentNodes[n];\n        if (node.type === \"testEnv\") {\n          testenv_node = node;\n          break;\n        }\n      }\n      process.env[\"__KEY__\"] = \"__VAL0__\";\n      setEnv(testenv_node, \"__KEY__\", \"__VAL1__\");\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL1__\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access nested subflow env var","suites":["Subflow","#env var"],"updatePoint":{"line":1540,"column":41,"index":40223},"line":1540,"code":"    it(\"can access nested subflow env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 1\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf2\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        in: [{\n          wires: [{\n            id: \"sf2-1\"\n          }]\n        }],\n        out: [{\n          wires: [{\n            id: \"sf2-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"subflow:sf2\",\n        z: \"sf1\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }, {\n        id: \"sf2-1\",\n        type: \"test\",\n        z: \"sf2\",\n        foo: \"sf2.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf2-2\"]]\n      }, {\n        id: \"sf2-2\",\n        type: \"testEnv\",\n        z: \"sf2\",\n        foo: \"sf2.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      var node_sf1_1 = null;\n      var node_sf2_1 = null;\n      var testenv_node = null;\n      for (var n in currentNodes) {\n        var node = currentNodes[n];\n        if (node.foo === \"sf1.1\") {\n          node_sf1_1 = node;\n        }\n        if (node.foo === \"sf2.1\") {\n          node_sf2_1 = node;\n        }\n      }\n      process.env[\"__KEY__\"] = \"__VAL0__\";\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL0__\");\n        setEnv(node_sf1_1, \"__KEY__\", \"__VAL1__\");\n        currentNodes[\"1\"].receive({\n          payload: \"test\"\n        });\n        setTimeout(function () {\n          currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL1__\");\n          setEnv(node_sf2_1, \"__KEY__\", \"__VAL2__\");\n          currentNodes[\"1\"].receive({\n            payload: \"test\"\n          });\n          setTimeout(function () {\n            currentNodes[\"3\"].should.have.a.property(\"received\", \"__VAL2__\");\n            flow.stop().then(function () {\n              done();\n            });\n          }, 150);\n        }, 150);\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access name of subflow as env var","suites":["Subflow","#env var"],"updatePoint":{"line":1675,"column":45,"index":43305},"line":1675,"code":"    it(\"can access name of subflow as env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        name: \"SFN\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testNameEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"SFN\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"can access id of subflow as env var","suites":["Subflow","#env var"],"updatePoint":{"line":1753,"column":43,"index":44948},"line":1753,"code":"    it(\"can access id of subflow as env var\", function (done) {\n      var config = flowUtils.parseConfig([{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.1\",\n        wires: [\"2\"]\n      }, {\n        id: \"2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        name: \"SFN\",\n        wires: [\"3\"]\n      }, {\n        id: \"3\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"t1.3\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        name: \"Subflow 2\",\n        info: \"\",\n        \"in\": [{\n          wires: [{\n            id: \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          wires: [{\n            id: \"sf1-2\",\n            port: 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        type: \"test\",\n        z: \"sf1\",\n        foo: \"sf1.1\",\n        x: 166,\n        y: 99,\n        wires: [[\"sf1-2\"]]\n      }, {\n        id: \"sf1-2\",\n        type: \"testIDEnv\",\n        z: \"sf1\",\n        foo: \"sf1.2\",\n        x: 166,\n        y: 99,\n        wires: [[]]\n      }]);\n      var flow = Flow.create({\n        getSetting: k => process.env[k],\n        handleError: (a, b, c) => {\n          console.log(a, b, c);\n        }\n      }, config, config.flows[\"t1\"]);\n      flow.start();\n      currentNodes[\"1\"].receive({\n        payload: \"test\"\n      });\n      setTimeout(function () {\n        currentNodes[\"3\"].should.have.a.property(\"received\", \"2\");\n        flow.stop().then(function () {\n          done();\n        });\n      }, 150);\n    });","file":"unit/@node-red/runtime/lib/flows/Subflow_spec.js","skipped":false,"dir":"test"},{"name":"handles ENV substitutions in an object - $()","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":45,"column":52,"index":1578},"line":45,"code":"    it('handles ENV substitutions in an object - $()', function () {\n      var foo = {\n        a: \"$(foo1)\",\n        b: \"$(foo2)\",\n        c: {\n          d: \"$(foo3)\"\n        }\n      };\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: p => process.env[p]\n          });\n        }\n      }\n      foo.should.eql({\n        a: 'bar1',\n        b: 'bar2',\n        c: {\n          d: 'bar3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles ENV substitutions in an object - ${}","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":68,"column":52,"index":2075},"line":68,"code":"    it('handles ENV substitutions in an object - ${}', function () {\n      var foo = {\n        a: \"${foo1}\",\n        b: \"${foo2}\",\n        c: {\n          d: \"${foo3}\"\n        }\n      };\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: p => process.env[p]\n          });\n        }\n      }\n      foo.should.eql({\n        a: 'bar1',\n        b: 'bar2',\n        c: {\n          d: 'bar3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"gets ENV from parent flow","suites":["flows/util","#mapEnvVarProperties"],"updatePoint":{"line":91,"column":33,"index":2553},"line":91,"code":"    it('gets ENV from parent flow', function () {\n      var foo = {\n        a: \"$(unknown)\",\n        b: \"$(foo2)\",\n        c: {\n          d: \"$(foo3)\"\n        }\n      };\n      for (var p in foo) {\n        if (foo.hasOwnProperty(p)) {\n          flowUtil.mapEnvVarProperties(foo, p, {\n            getSetting: name => name[0] === 'f' ? name.toUpperCase() : undefined\n          });\n        }\n      }\n      foo.should.eql({\n        a: '$(unknown)',\n        b: 'FOO2',\n        c: {\n          d: 'FOO3'\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns a known env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":122,"column":31,"index":3249},"line":122,"code":"    it('returns a known env var', function () {\n      flowUtil.init({\n        settings: {}\n      });\n      flowUtil.getEnvVar(\"foo1\").should.equal(\"bar1\");\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns undefined for an unknown env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":128,"column":48,"index":3430},"line":128,"code":"    it('returns undefined for an unknown env var', function () {\n      flowUtil.init({\n        settings: {}\n      });\n      (flowUtil.getEnvVar(\"foo2\") === undefined).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"returns undefined for an excluded env var","suites":["flows/util","#getEnvVar"],"updatePoint":{"line":134,"column":49,"index":3624},"line":134,"code":"    it('returns undefined for an excluded env var', function () {\n      flowUtil.init({\n        settings: {\n          envVarExcludes: ['foo1']\n        }\n      });\n      (flowUtil.getEnvVar(\"foo1\") === undefined).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles a null old node","suites":["flows/util","#diffNodes"],"updatePoint":{"line":144,"column":31,"index":3889},"line":144,"code":"    it('handles a null old node', function () {\n      flowUtil.diffNodes(null, {}).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores x/y changes","suites":["flows/util","#diffNodes"],"updatePoint":{"line":147,"column":27,"index":3994},"line":147,"code":"    it('ignores x/y changes', function () {\n      flowUtil.diffNodes({\n        x: 10,\n        y: 10\n      }, {\n        x: 20,\n        y: 10\n      }).should.be.false();\n      flowUtil.diffNodes({\n        x: 10,\n        y: 10\n      }, {\n        x: 10,\n        y: 20\n      }).should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores wiring changes","suites":["flows/util","#diffNodes"],"updatePoint":{"line":163,"column":30,"index":4297},"line":163,"code":"    it('ignores wiring changes', function () {\n      flowUtil.diffNodes({\n        wires: []\n      }, {\n        wires: [1, 2, 3]\n      }).should.be.false();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - string","suites":["flows/util","#diffNodes"],"updatePoint":{"line":170,"column":47,"index":4478},"line":170,"code":"    it('spots existing property change - string', function () {\n      flowUtil.diffNodes({\n        a: \"foo\"\n      }, {\n        a: \"bar\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - number","suites":["flows/util","#diffNodes"],"updatePoint":{"line":177,"column":47,"index":4649},"line":177,"code":"    it('spots existing property change - number', function () {\n      flowUtil.diffNodes({\n        a: 0\n      }, {\n        a: 1\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - boolean","suites":["flows/util","#diffNodes"],"updatePoint":{"line":184,"column":48,"index":4813},"line":184,"code":"    it('spots existing property change - boolean', function () {\n      flowUtil.diffNodes({\n        a: true\n      }, {\n        a: false\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - truthy","suites":["flows/util","#diffNodes"],"updatePoint":{"line":191,"column":47,"index":4983},"line":191,"code":"    it('spots existing property change - truthy', function () {\n      flowUtil.diffNodes({\n        a: true\n      }, {\n        a: 1\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - falsey","suites":["flows/util","#diffNodes"],"updatePoint":{"line":198,"column":47,"index":5149},"line":198,"code":"    it('spots existing property change - falsey', function () {\n      flowUtil.diffNodes({\n        a: false\n      }, {\n        a: 0\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - array","suites":["flows/util","#diffNodes"],"updatePoint":{"line":205,"column":46,"index":5315},"line":205,"code":"    it('spots existing property change - array', function () {\n      flowUtil.diffNodes({\n        a: [0, 1, 2]\n      }, {\n        a: [0, 2, 3]\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots existing property change - object","suites":["flows/util","#diffNodes"],"updatePoint":{"line":212,"column":47,"index":5494},"line":212,"code":"    it('spots existing property change - object', function () {\n      flowUtil.diffNodes({\n        a: {\n          a: [0, 1, 2]\n        }\n      }, {\n        a: {\n          a: [0, 2, 3]\n        }\n      }).should.be.true();\n      flowUtil.diffNodes({\n        a: {\n          a: [0, 1, 2]\n        }\n      }, {\n        a: {\n          b: [0, 1, 2]\n        }\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots added property","suites":["flows/util","#diffNodes"],"updatePoint":{"line":232,"column":28,"index":5861},"line":232,"code":"    it('spots added property', function () {\n      flowUtil.diffNodes({\n        a: \"foo\"\n      }, {\n        a: \"foo\",\n        b: \"bar\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"spots removed property","suites":["flows/util","#diffNodes"],"updatePoint":{"line":240,"column":30,"index":6033},"line":240,"code":"    it('spots removed property', function () {\n      flowUtil.diffNodes({\n        a: \"foo\",\n        b: \"bar\"\n      }, {\n        a: \"foo\"\n      }).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a single-tab flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":250,"column":32,"index":6254},"line":250,"code":"    it('parses a single-tab flow', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a single-tab flow with global config node","suites":["flows/util","#parseConfig"],"updatePoint":{"line":303,"column":56,"index":7474},"line":303,"code":"    it('parses a single-tab flow with global config node', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"cn\",\n        wires: []\n      }, {\n        id: \"cn\",\n        type: \"test\"\n      }, {\n        id: \"t1\",\n        type: \"tab\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"foo\": \"cn\",\n            \"wires\": []\n          },\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\"\n          },\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\",\n            \"_users\": [\"t1-1\"]\n          }\n        },\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"foo\": \"cn\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a multi-tab flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":372,"column":31,"index":8996},"line":372,"code":"    it('parses a multi-tab flow', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"t2\",\n        type: \"tab\"\n      }, {\n        id: \"t2-1\",\n        x: 10,\n        y: 10,\n        z: \"t2\",\n        type: \"test\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"t2\": {\n            \"id\": \"t2\",\n            \"type\": \"tab\"\n          },\n          \"t2-1\": {\n            \"id\": \"t2-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t2\",\n            \"type\": \"test\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          },\n          \"t2\": {\n            \"id\": \"t2\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t2-1\": {\n                \"id\": \"t2-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t2\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a subflow flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":463,"column":29,"index":10994},"line":463,"code":"    it('parses a subflow flow', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"subflow:sf1\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        x: 10,\n        y: 10,\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"subflow:sf1\",\n            \"wires\": []\n          },\n          \"sf1\": {\n            \"id\": \"sf1\",\n            \"type\": \"subflow\"\n          },\n          \"sf1-1\": {\n            \"id\": \"sf1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"sf1\",\n            \"type\": \"test\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {\n          \"sf1\": {\n            \"id\": \"sf1\",\n            \"type\": \"subflow\",\n            \"configs\": {},\n            \"nodes\": {\n              \"sf1-1\": {\n                \"id\": \"sf1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"sf1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            },\n            \"instances\": [{\n              \"id\": \"t1-1\",\n              \"x\": 10,\n              \"y\": 10,\n              \"z\": \"t1\",\n              \"type\": \"subflow:sf1\",\n              \"wires\": [],\n              \"subflow\": \"sf1\"\n            }]\n          }\n        },\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"subflow:sf1\",\n                \"wires\": [],\n                \"subflow\": \"sf1\"\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow with a missing type","suites":["flows/util","#parseConfig"],"updatePoint":{"line":564,"column":41,"index":13302},"line":564,"code":"    it('parses a flow with a missing type', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"sf1\",\n        wires: []\n      }, {\n        id: \"t1-2\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"missing\",\n        wires: []\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      parsedConfig.missingTypes.should.eql(['missing']);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"sf1\",\n            \"wires\": []\n          },\n          \"t1-2\": {\n            \"id\": \"t1-2\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"missing\",\n            \"wires\": []\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"sf1\",\n                \"wires\": []\n              },\n              't1-2': {\n                id: 't1-2',\n                x: 10,\n                y: 10,\n                z: 't1',\n                type: 'missing',\n                wires: []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": [\"missing\"]\n      };\n      redUtil.compareObjects(parsedConfig, expectedConfig).should.be.true();\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow with a missing flow","suites":["flows/util","#parseConfig"],"updatePoint":{"line":641,"column":41,"index":15099},"line":641,"code":"    it('parses a flow with a missing flow', function () {\n      var originalConfig = [{\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        foo: \"cn\",\n        wires: []\n      }, {\n        id: \"cn\",\n        type: \"test\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"foo\": \"cn\",\n            \"wires\": []\n          },\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {\n          \"cn\": {\n            \"id\": \"cn\",\n            \"type\": \"test\",\n            \"_users\": [\"t1-1\"]\n          }\n        },\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"foo\": \"cn\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {},\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"parses a flow including a group","suites":["flows/util","#parseConfig"],"updatePoint":{"line":703,"column":39,"index":16499},"line":703,"code":"    it('parses a flow including a group', function () {\n      var originalConfig = [{\n        id: \"t1\",\n        type: \"tab\"\n      }, {\n        id: \"t1-1\",\n        x: 10,\n        y: 10,\n        z: \"t1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"g1\",\n        type: \"group\",\n        z: \"t1\"\n      }];\n      var parsedConfig = flowUtil.parseConfig(originalConfig);\n      var expectedConfig = {\n        \"allNodes\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\"\n          },\n          \"t1-1\": {\n            \"id\": \"t1-1\",\n            \"x\": 10,\n            \"y\": 10,\n            \"z\": \"t1\",\n            \"type\": \"test\",\n            \"wires\": []\n          },\n          \"g1\": {\n            \"id\": \"g1\",\n            \"type\": \"group\",\n            \"z\": \"t1\"\n          }\n        },\n        \"subflows\": {},\n        \"configs\": {},\n        \"flows\": {\n          \"t1\": {\n            \"id\": \"t1\",\n            \"type\": \"tab\",\n            \"subflows\": {},\n            \"configs\": {},\n            \"nodes\": {\n              \"t1-1\": {\n                \"id\": \"t1-1\",\n                \"x\": 10,\n                \"y\": 10,\n                \"z\": \"t1\",\n                \"type\": \"test\",\n                \"wires\": []\n              }\n            }\n          }\n        },\n        \"groups\": {\n          \"g1\": {\n            \"id\": \"g1\",\n            \"type\": \"group\",\n            \"z\": \"t1\"\n          }\n        },\n        \"missingTypes\": []\n      };\n      parsedConfig.should.eql(expectedConfig);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"handles an identical configuration","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":773,"column":42,"index":18040},"line":773,"code":"    it('handles an identical configuration', function () {\n      var config = [{\n        id: \"123\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var originalConfig = flowUtil.parseConfig(clone(config));\n      var changedConfig = flowUtil.parseConfig(clone(config));\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed properties, including downstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":790,"column":77,"index":18748},"line":790,"code":"    it('identifies nodes with changed properties, including downstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[1]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[0].foo = \"b\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"1\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"2\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed properties, including upstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":819,"column":75,"index":19675},"line":819,"code":"    it('identifies nodes with changed properties, including upstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].bar = \"c\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"2\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed credentials, including downstream linked","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":848,"column":78,"index":20607},"line":848,"code":"    it('identifies nodes with changed credentials, including downstream linked', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[0].credentials = {};\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.eql([\"1\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.should.eql([\"2\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":876,"column":44,"index":21494},"line":876,"code":"    it('identifies nodes with changed wiring', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires[0][0] = \"3\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring - second connection added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":905,"column":70,"index":22438},"line":905,"code":"    it('identifies nodes with changed wiring - second connection added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires[0].push(\"1\");\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies nodes with changed wiring - node connected","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":934,"column":61,"index":23369},"line":934,"code":"    it('identifies nodes with changed wiring - node connected', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[1].wires.push(\"3\");\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.eql([\"2\"]);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies new nodes","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":963,"column":28,"index":24271},"line":963,"code":"    it('identifies new nodes', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.push({\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]]\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.eql([\"2\"]);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies deleted nodes","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":992,"column":32,"index":25156},"line":992,"code":"    it('identifies deleted nodes', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.splice(1, 1);\n      newConfig[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.eql([\"2\"]);\n      diffResult.rewired.should.eql([\"1\"]);\n      diffResult.linked.sort().should.eql([\"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies config nodes changes, node->config","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1022,"column":53,"index":26102},"line":1022,"code":"    it('identifies config nodes changes, node->config', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"configNode\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"configNode\",\n        type: \"testConfig\"\n      }];\n      var newConfig = clone(config);\n      newConfig[3].foo = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql([\"1\", \"configNode\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"2\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"identifies config nodes changes, node->config->config","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1054,"column":61,"index":27130},"line":1054,"code":"    it('identifies config nodes changes, node->config->config', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        foo: \"configNode1\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"configNode1\",\n        foo: \"configNode2\",\n        type: \"testConfig\"\n      }, {\n        id: \"configNode2\",\n        type: \"testConfig\"\n      }];\n      var newConfig = clone(config);\n      newConfig[4].foo = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql([\"1\", \"configNode1\", \"configNode2\"]);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"2\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal property change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1090,"column":73,"index":28281},"line":1090,"code":"    it('marks a parent subflow as changed for an internal property change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        foo: \"a\",\n        wires: []\n      }, {\n        id: \"4\",\n        type: \"subflow:sf1\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[4].foo = \"b\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', '4', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal wiring change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1129,"column":71,"index":29432},"line":1129,"code":"    it('marks a parent subflow as changed for an internal wiring change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[4].wires = [[\"sf1-2\"]];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal node add","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1168,"column":66,"index":30580},"line":1168,"code":"    it('marks a parent subflow as changed for an internal node add', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.push({\n        id: \"sf1-3\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal node delete","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1212,"column":69,"index":31803},"line":1212,"code":"    it('marks a parent subflow as changed for an internal node delete', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig.splice(5, 1);\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(1);\n      diffResult.removed.sort().should.eql(['sf1-2']);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - input removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1252,"column":95,"index":33025},"line":1252,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - input removed', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].in[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - input added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1302,"column":93,"index":34401},"line":1302,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - input added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].in[0].wires.push({\n        \"id\": \"sf1-2\"\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - output added","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1354,"column":94,"index":35811},"line":1354,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - output added', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].out[0].wires.push({\n        \"id\": \"sf1-2\",\n        \"port\": 0\n      });\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow wiring change - output removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1407,"column":96,"index":37243},"line":1407,"code":"    it('marks a parent subflow as changed for an internal subflow wiring change - output removed', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\",\n        \"in\": [{\n          \"wires\": [{\n            \"id\": \"sf1-1\"\n          }]\n        }],\n        \"out\": [{\n          \"wires\": [{\n            \"id\": \"sf1-2\",\n            \"port\": 0\n          }]\n        }]\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[3].out[0].wires = [];\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for a global config node change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1457,"column":73,"index":38600},"line":1457,"code":"    it('marks a parent subflow as changed for a global config node change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        prop: \"configNode\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"configNode\",\n        a: \"foo\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[6].a = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', \"configNode\", 'sf1']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a parent subflow as changed for an internal subflow instance change","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1502,"column":81,"index":39890},"line":1502,"code":"    it('marks a parent subflow as changed for an internal subflow instance change', function () {\n      var config = [{\n        id: \"1\",\n        type: \"test\",\n        wires: [[\"2\"]]\n      }, {\n        id: \"2\",\n        type: \"subflow:sf1\",\n        wires: [[\"3\"]]\n      }, {\n        id: \"3\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1\",\n        type: \"subflow\"\n      }, {\n        id: \"sf2\",\n        type: \"subflow\"\n      }, {\n        id: \"sf1-1\",\n        z: \"sf1\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf1-2\",\n        z: \"sf1\",\n        type: \"subflow:sf2\",\n        wires: []\n      }, {\n        id: \"sf2-1\",\n        z: \"sf2\",\n        type: \"test\",\n        wires: []\n      }, {\n        id: \"sf2-2\",\n        z: \"sf2\",\n        type: \"test\",\n        wires: []\n      }];\n      var newConfig = clone(config);\n      newConfig[8].a = \"bar\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.sort().should.eql(['2', 'sf1', 'sf2']);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n      diffResult.linked.sort().should.eql([\"1\", \"3\"]);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores tab changes that are immaterial","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1554,"column":47,"index":41257},"line":1554,"code":"    it('ignores tab changes that are immaterial', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].label = \"barney\";\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a deleted tab as removed","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1577,"column":38,"index":42032},"line":1577,"code":"    it('marks a deleted tab as removed', function () {\n      var config = [{\n        id: \"f1\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"n1\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"f1\"\n      }, {\n        id: \"f2\",\n        type: \"tab\",\n        label: \"fred\"\n      }, {\n        id: \"n2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"f2\"\n      }];\n      var newConfig = clone(config);\n      newConfig = newConfig.slice(0, 2);\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.sort().should.eql(['f2', 'n2']);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks all nodes as added when tab state changes disabled to enabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1610,"column":75,"index":43042},"line":1610,"code":"    it('marks all nodes as added when tab state changes disabled to enabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: true,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].disabled = false;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(2);\n      diffResult.added.sort().should.eql([\"1\", \"2\"]);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(0);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks all nodes as removed when tab state changes enabled to disabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1638,"column":77,"index":43983},"line":1638,"code":"    it('marks all nodes as removed when tab state changes enabled to disabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: false,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[0].disabled = true;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(0);\n      diffResult.removed.should.have.length(2);\n      diffResult.removed.sort().should.eql([\"1\", \"2\"]);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"marks a node as removed when its state changes enabled to disabled","suites":["flows/util","#diffConfigs"],"updatePoint":{"line":1666,"column":74,"index":44923},"line":1666,"code":"    it('marks a node as removed when its state changes enabled to disabled', function () {\n      var config = [{\n        id: \"1\",\n        type: \"tab\",\n        disabled: false,\n        label: \"fred\"\n      }, {\n        id: \"2\",\n        type: \"test\",\n        bar: \"b\",\n        wires: [[\"1\"]],\n        z: \"1\"\n      }, {\n        id: \"3\",\n        type: \"test\"\n      }];\n      var newConfig = clone(config);\n      newConfig[1].d = true;\n      var originalConfig = flowUtil.parseConfig(config);\n      var changedConfig = flowUtil.parseConfig(newConfig);\n      originalConfig.missingTypes.should.have.length(0);\n      var diffResult = flowUtil.diffConfigs(originalConfig, changedConfig);\n      diffResult.added.should.have.length(0);\n      diffResult.changed.should.have.length(2);\n      diffResult.changed.sort().should.eql([\"1\", \"2\"]);\n      diffResult.removed.should.have.length(1);\n      diffResult.removed.sort().should.eql([\"2\"]);\n      diffResult.rewired.should.have.length(0);\n    });","file":"unit/@node-red/runtime/lib/flows/util_spec.js","skipped":false,"dir":"test"},{"name":"initialises components","suites":["runtime","init"],"updatePoint":{"line":77,"column":30,"index":2907},"line":77,"code":"    it(\"initialises components\", function () {\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\"\n      });\n      settings.init.called.should.be.true();\n      redNodes.init.called.should.be.true();\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"returns version","suites":["runtime","init"],"updatePoint":{"line":85,"column":23,"index":3131},"line":85,"code":"    it(\"returns version\", function () {\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\"\n      });\n      return runtime.version().then(version => {\n        /^\\d+\\.\\d+\\.\\d+(-.*)?$/.test(version).should.be.true();\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports errored/missing modules","suites":["runtime","start"],"updatePoint":{"line":134,"column":39,"index":4858},"line":134,"code":"    it(\"reports errored/missing modules\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        },\n        // error\n        {\n          module: \"module\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeA\", \"typeB\"]\n        } // missing\n        ].filter(cb);\n      });\n      runtime.init({\n        testSettings: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      });\n      // sinon.stub(console,\"log\");\n      runtime.start().then(function () {\n        // console.log.restore();\n        try {\n          storageInit.calledOnce.should.be.true();\n          redNodesInit.calledOnce.should.be.true();\n          redNodesLoad.calledOnce.should.be.true();\n          redNodesLoadFlows.calledOnce.should.be.true();\n          log.warn.calledWithMatch(\"Failed to register 1 node type\");\n          log.warn.calledWithMatch(\"Missing node modules\");\n          log.warn.calledWithMatch(\" - module: typeA, typeB\");\n          redNodesCleanModuleList.calledOnce.should.be.true();\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"initiates load of missing modules","suites":["runtime","start"],"updatePoint":{"line":176,"column":41,"index":6173},"line":176,"code":"    it(\"initiates load of missing modules\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        },\n        // error\n        {\n          err: \"errored\",\n          name: \"errName\"\n        },\n        // error\n        {\n          module: \"module\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeA\", \"typeB\"]\n        },\n        // missing\n        {\n          module: \"node-red\",\n          enabled: true,\n          loaded: false,\n          types: [\"typeC\", \"typeD\"]\n        } // missing\n        ].filter(cb);\n      });\n      var serverInstallModule = sinon.stub(redNodes, \"installModule\").callsFake(function (name) {\n        return Promise.resolve({\n          nodes: []\n        });\n      });\n      runtime.init({\n        testSettings: true,\n        autoInstallModules: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      });\n      sinon.stub(console, \"log\");\n      runtime.start().then(function () {\n        console.log.restore();\n        try {\n          log.warn.calledWithMatch(\"Failed to register 2 node types\");\n          log.warn.calledWithMatch(\"Missing node modules\");\n          log.warn.calledWithMatch(\" - module: typeA, typeB\");\n          log.warn.calledWithMatch(\" - node-red: typeC, typeD\");\n          redNodesCleanModuleList.calledOnce.should.be.false();\n          serverInstallModule.calledOnce.should.be.true();\n          serverInstallModule.calledWithMatch(\"module\");\n          done();\n        } catch (err) {\n          done(err);\n        } finally {\n          serverInstallModule.restore();\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports errored modules when verbose is enabled","suites":["runtime","start"],"updatePoint":{"line":237,"column":55,"index":7982},"line":237,"code":"    it(\"reports errored modules when verbose is enabled\", function (done) {\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function (cb) {\n        return [{\n          err: \"errored\",\n          name: \"errName\"\n        } // error\n        ].filter(cb);\n      });\n      runtime.init({\n        testSettings: true,\n        verbose: true,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      });\n      sinon.stub(console, \"log\");\n      runtime.start().then(function () {\n        console.log.restore();\n        try {\n          log.warn.neverCalledWithMatch(\"Failed to register 1 node type\");\n          log.warn.calledWithMatch(\"[errName] errored\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"reports runtime metrics","suites":["runtime","start"],"updatePoint":{"line":267,"column":31,"index":8815},"line":267,"code":"    it(\"reports runtime metrics\", function (done) {\n      var stopFlows = sinon.stub(redNodes, \"stopFlows\").callsFake(function () {\n        return Promise.resolve();\n      });\n      redNodesGetNodeList = sinon.stub(redNodes, \"getNodeList\").callsFake(function () {\n        return [];\n      });\n      unmockUtil();\n      mockUtil(true);\n      runtime.init({\n        testSettings: true,\n        runtimeMetricInterval: 200,\n        httpAdminRoot: \"/\",\n        load: function () {\n          return Promise.resolve();\n        }\n      }, {}, undefined);\n      // sinon.stub(console,\"log\");\n      runtime.start().then(function () {\n        // console.log.restore();\n        setTimeout(function () {\n          try {\n            log.log.args.should.have.lengthOf(3);\n            log.log.args[0][0].should.have.property(\"event\", \"runtime.memory.rss\");\n            log.log.args[1][0].should.have.property(\"event\", \"runtime.memory.heapTotal\");\n            log.log.args[2][0].should.have.property(\"event\", \"runtime.memory.heapUsed\");\n            done();\n          } catch (err) {\n            done(err);\n          } finally {\n            runtime.stop();\n            stopFlows.restore();\n          }\n        }, 300);\n      }).catch(err => {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"stops components","suites":["runtime","start"],"updatePoint":{"line":306,"column":22,"index":10074},"line":306,"code":"  it(\"stops components\", function (done) {\n    var stopFlows = sinon.stub(redNodes, \"stopFlows\").callsFake(function () {\n      return Promise.resolve();\n    });\n    var closeContextsPlugin = sinon.stub(redNodes, \"closeContextsPlugin\").callsFake(function () {\n      return Promise.resolve();\n    });\n    runtime.stop().then(function () {\n      stopFlows.called.should.be.true();\n      closeContextsPlugin.called.should.be.true();\n      stopFlows.restore();\n      closeContextsPlugin.restore();\n      done();\n    }).catch(function (err) {\n      stopFlows.restore();\n      closeContextsPlugin.restore();\n      return done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":86,"column":36,"index":2643},"line":86,"code":"    it('returns a flow example entry', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/abc\").then(function (result) {\n        result.should.eql(\"Example flow result\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - top level","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":92,"column":50,"index":2894},"line":92,"code":"    it('returns a flow example listing - top level', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"\").then(function (result) {\n        result.should.eql(['test-module', '@scope/test-module']);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - in module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":98,"column":50,"index":3146},"line":98,"code":"    it('returns a flow example listing - in module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module\").then(function (result) {\n        result.should.eql([{\n          fn: 'abc'\n        }]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example listing - in scoped module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":106,"column":57,"index":3412},"line":106,"code":"    it('returns a flow example listing - in scoped module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"@scope/test-module\").then(function (result) {\n        result.should.eql([{\n          fn: 'abc'\n        }, {\n          fn: 'throw'\n        }]);\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry from scoped module","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":116,"column":55,"index":3718},"line":116,"code":"    it('returns a flow example entry from scoped module', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"@scope/test-module/abc\").then(function (result) {\n        result.should.eql(\"Example scope flow result\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for unknown flow example entry","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":122,"column":55,"index":3987},"line":122,"code":"    it('returns an error for unknown flow example entry', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"unknown/abc\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        err.should.have.property(\"code\", \"not_found\");\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for file load error - async","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":130,"column":52,"index":4305},"line":130,"code":"    it('returns an error for file load error - async', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/unknown\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns an error for file load error - sync","suites":["runtime/library/examples","getEntry"],"updatePoint":{"line":137,"column":51,"index":4575},"line":137,"code":"    it('returns an error for file load error - sync', function (done) {\n      examplesLibrary.getEntry(\"flows\", \"test-module/throw\").then(function (result) {\n        done(new Error(\"No error thrown\"));\n      }).catch(function (err) {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/library/examples_spec.js","skipped":false,"dir":"test"},{"name":"returns the default and examples libraries","suites":["runtime/library","getLibraries"],"updatePoint":{"line":78,"column":50,"index":2533},"line":78,"code":"    it('returns the default and examples libraries', function () {\n      const libs = library.getLibraries();\n      libs.should.have.length(2);\n      libs[0].should.have.property('id', 'local');\n      libs[0].should.have.property('label', 'editor:library.types.local');\n      libs[0].should.have.property(\"user\", false);\n      libs[0].should.have.property('icon', 'font-awesome/fa-hdd-o');\n      libs[1].should.have.property('id', 'examples');\n      libs[1].should.have.property('label', 'editor:library.types.examples');\n      libs[1].should.have.property(\"user\", false);\n      libs[1].should.have.property('icon', 'font-awesome/fa-life-ring');\n      libs[1].should.have.property('readOnly', true);\n      libs[1].should.have.property('types', ['flows']);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns the libraries from settings","suites":["runtime/library","getLibraries"],"updatePoint":{"line":92,"column":43,"index":3290},"line":92,"code":"    it('returns the libraries from settings', function () {\n      library.init({\n        plugins: {\n          getPlugin: id => {\n            return {\n              id: \"test-library-plugin\",\n              type: \"node-red-library-source\",\n              class: function () {}\n            };\n          }\n        },\n        settings: {\n          editorTheme: {\n            library: {\n              sources: [{\n                id: \"test-plugin-id\",\n                type: \"test-library-plugin\"\n              }]\n            }\n          }\n        }\n      });\n      let libs = library.getLibraries();\n      libs.should.have.length(2);\n      events.emit(\"registry:plugin-added\", \"test-library-plugin\");\n      libs = library.getLibraries();\n      libs.should.have.length(3);\n      libs[2].should.have.property('id', 'test-plugin-id');\n      libs[2].should.have.property(\"user\", false);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unregistered type","suites":["runtime/library","getEntry"],"updatePoint":{"line":127,"column":42,"index":4272},"line":127,"code":"    it('throws error for unregistered type', function () {\n      should(() => {\n        library.getEntry(\"local\", \"unknown\", \"/abc\");\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown library","suites":["runtime/library","getEntry"],"updatePoint":{"line":132,"column":40,"index":4430},"line":132,"code":"    it('throws error for unknown library', function () {\n      should(() => {\n        library.getEntry(\"unknown\", \"unknown\", \"/abc\");\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered non-flow entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":137,"column":43,"index":4593},"line":137,"code":"    it('returns a registered non-flow entry', function (done) {\n      library.register(\"test-module\", \"test-type\");\n      library.getEntry(\"local\", \"test-type\", \"/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"local\");\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":146,"column":28,"index":4986},"line":146,"code":"    it('returns a flow entry', function (done) {\n      library.getEntry(\"local\", \"flows\", \"/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"local\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow example entry","suites":["runtime/library","getEntry"],"updatePoint":{"line":153,"column":36,"index":5273},"line":153,"code":"    it('returns a flow example entry', function (done) {\n      library.getEntry(\"examples\", \"flows\", \"/test-module/abc\").then(function (result) {\n        result.should.have.property(\"library\", \"_examples_\");\n        result.should.have.property(\"path\", \"/test-module/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unknown library","suites":["runtime/library","saveEntry"],"updatePoint":{"line":165,"column":40,"index":5697},"line":165,"code":"    it('throws error for unknown library', function () {\n      should(() => {\n        library.saveEntry(\"unknown\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for unregistered type","suites":["runtime/library","saveEntry"],"updatePoint":{"line":174,"column":42,"index":5928},"line":174,"code":"    it('throws error for unregistered type', function () {\n      should(() => {\n        library.saveEntry(\"local\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"throws error for save to readonly library","suites":["runtime/library","saveEntry"],"updatePoint":{"line":183,"column":49,"index":6164},"line":183,"code":"    it('throws error for save to readonly library', function () {\n      should(() => {\n        library.saveEntry(\"_examples_\", \"unknown\", \"/abc\", {\n          id: \"meta\"\n        }, {\n          id: \"body\"\n        });\n      }).throw();\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"saves a flow entry","suites":["runtime/library","saveEntry"],"updatePoint":{"line":192,"column":26,"index":6382},"line":192,"code":"    it('saves a flow entry', function (done) {\n      library.saveEntry('local', 'flows', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"saves a non-flow entry","suites":["runtime/library","saveEntry"],"updatePoint":{"line":205,"column":30,"index":6746},"line":205,"code":"    it('saves a non-flow entry', function (done) {\n      library.register(\"test-module\", \"test-type\");\n      library.saveEntry('local', 'test-type', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"meta\", {\n          id: \"meta\"\n        });\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/index_spec.js","skipped":false,"dir":"test"},{"name":"returns a registered non-flow entry","suites":["runtime/library/local","getEntry"],"updatePoint":{"line":48,"column":43,"index":1447},"line":48,"code":"    it('returns a registered non-flow entry', function (done) {\n      localLibrary.getEntry(\"test-type\", \"/abc\").then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"returns a flow entry","suites":["runtime/library/local","getEntry"],"updatePoint":{"line":55,"column":28,"index":1727},"line":55,"code":"    it('returns a flow entry', function (done) {\n      localLibrary.getEntry(\"flows\", \"/abc\").then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"saves a flow entry","suites":["runtime/library/local","saveEntry"],"updatePoint":{"line":78,"column":26,"index":2315},"line":78,"code":"    it('saves a flow entry', function (done) {\n      localLibrary.saveEntry('flows', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"saves a non-flow entry","suites":["runtime/library/local","saveEntry"],"updatePoint":{"line":91,"column":30,"index":2675},"line":91,"code":"    it('saves a non-flow entry', function (done) {\n      localLibrary.saveEntry('test-type', '/abc', {\n        id: \"meta\"\n      }, {\n        id: \"body\"\n      }).then(function (result) {\n        result.should.have.property(\"type\", \"test-type\");\n        result.should.have.property(\"path\", \"/abc\");\n        result.should.have.property(\"meta\", {\n          id: \"meta\"\n        });\n        result.should.have.property(\"body\", {\n          id: \"body\"\n        });\n        done();\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/library/local_spec.js","skipped":false,"dir":"test"},{"name":"stores local property","suites":["context","local memory"],"updatePoint":{"line":35,"column":29,"index":1191},"line":35,"code":"    it('stores local property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.get(\"foo\"));\n      context1.set(\"foo\", \"test\");\n      context1.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores local property - creates parent properties","suites":["context","local memory"],"updatePoint":{"line":42,"column":57,"index":1506},"line":42,"code":"    it('stores local property - creates parent properties', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      context1.set(\"foo.bar\", \"test\");\n      context1.get(\"foo\").should.eql({\n        bar: \"test\"\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes local property","suites":["context","local memory"],"updatePoint":{"line":50,"column":30,"index":1774},"line":50,"code":"    it('deletes local property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      context1.set(\"foo.abc.bar1\", \"test1\");\n      context1.set(\"foo.abc.bar2\", \"test2\");\n      context1.get(\"foo.abc\").should.eql({\n        bar1: \"test1\",\n        bar2: \"test2\"\n      });\n      context1.set(\"foo.abc.bar1\", undefined);\n      context1.get(\"foo.abc\").should.eql({\n        bar2: \"test2\"\n      });\n      context1.set(\"foo.abc\", undefined);\n      should.not.exist(context1.get(\"foo.abc\"));\n      context1.set(\"foo\", undefined);\n      should.not.exist(context1.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores flow property","suites":["context","local memory"],"updatePoint":{"line":68,"column":28,"index":2416},"line":68,"code":"    it('stores flow property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"stores global property","suites":["context","local memory"],"updatePoint":{"line":75,"column":30,"index":2719},"line":75,"code":"    it('stores global property', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      should.not.exist(context1.global.get(\"foo\"));\n      context1.global.set(\"foo\", \"test\");\n      context1.global.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"keeps local context local","suites":["context","local memory"],"updatePoint":{"line":82,"column":33,"index":3031},"line":82,"code":"    it('keeps local context local', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowA\");\n      should.not.exist(context1.get(\"foo\"));\n      should.not.exist(context2.get(\"foo\"));\n      context1.set(\"foo\", \"test\");\n      context1.get(\"foo\").should.equal(\"test\");\n      should.not.exist(context2.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"flow context accessible to all flow nodes","suites":["context","local memory"],"updatePoint":{"line":92,"column":49,"index":3476},"line":92,"code":"    it('flow context accessible to all flow nodes', function () {\n      var flowContext = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowA\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      should.not.exist(context2.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n      context2.flow.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"flow context not shared to nodes on other flows","suites":["context","local memory"],"updatePoint":{"line":102,"column":55,"index":3955},"line":102,"code":"    it('flow context not shared to nodes on other flows', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var flowContextB = Context.getFlowContext(\"flowB\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowB\");\n      should.not.exist(context1.flow.get(\"foo\"));\n      should.not.exist(context2.flow.get(\"foo\"));\n      context1.flow.set(\"foo\", \"test\");\n      context1.flow.get(\"foo\").should.equal(\"test\");\n      should.not.exist(context2.flow.get(\"foo\"));\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"global context shared to all nodes","suites":["context","local memory"],"updatePoint":{"line":113,"column":42,"index":4477},"line":113,"code":"    it('global context shared to all nodes', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var flowContextB = Context.getFlowContext(\"flowB\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      var context2 = Context.get(\"2\", \"flowB\");\n      should.not.exist(context1.global.get(\"foo\"));\n      should.not.exist(context2.global.get(\"foo\"));\n      context1.global.set(\"foo\", \"test\");\n      context1.global.get(\"foo\").should.equal(\"test\");\n      context2.global.get(\"foo\").should.equal(\"test\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"context.flow/global are not enumerable","suites":["context","local memory"],"updatePoint":{"line":124,"column":46,"index":5016},"line":124,"code":"    it('context.flow/global are not enumerable', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      Object.keys(context1).length.should.equal(0);\n      Object.keys(context1.flow).length.should.equal(0);\n      Object.keys(context1.global).length.should.equal(0);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"context.flow/global cannot be deleted","suites":["context","local memory"],"updatePoint":{"line":131,"column":45,"index":5360},"line":131,"code":"    it('context.flow/global cannot be deleted', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context1 = Context.get(\"1\", \"flowA\");\n      delete context1.flow;\n      should.exist(context1.flow);\n      delete context1.global;\n      should.exist(context1.global);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes context","suites":["context","local memory"],"updatePoint":{"line":139,"column":23,"index":5644},"line":139,"code":"    it('deletes context', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      should.not.exist(context.get(\"foo\"));\n      context.set(\"foo\", \"abc\");\n      context.get(\"foo\").should.equal(\"abc\");\n      return Context.delete(\"1\", \"flowA\").then(function () {\n        context = Context.get(\"1\", \"flowA\");\n        should.not.exist(context.get(\"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"deletes global context","suites":["context","local memory"],"updatePoint":{"line":150,"column":30,"index":6089},"line":150,"code":"    it('deletes global context', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      return Context.load().then(function () {\n        var globalContextA = Context.get(\"global\");\n        globalContextA.get('foo').should.eql('bar');\n        globalContextA.set(\"another\", \"value\");\n        return Context.delete(\"global\").then(function () {\n          var globalContextB = Context.get(\"global\");\n          globalContextB.get('foo').should.eql('bar');\n          should.not.exist(globalContextB.get(\"another\"));\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"enumerates context keys - sync","suites":["context","local memory"],"updatePoint":{"line":167,"column":38,"index":6696},"line":167,"code":"    it('enumerates context keys - sync', function () {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      var keys = context.keys();\n      keys.should.be.an.Array();\n      keys.should.be.empty();\n      context.set(\"foo\", \"bar\");\n      keys = context.keys();\n      keys.should.have.length(1);\n      keys[0].should.equal(\"foo\");\n      context.set(\"abc.def\", \"bar\");\n      keys = context.keys();\n      keys.should.have.length(2);\n      keys[1].should.equal(\"abc\");\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"enumerates context keys - async","suites":["context","local memory"],"updatePoint":{"line":182,"column":39,"index":7227},"line":182,"code":"    it('enumerates context keys - async', function (done) {\n      var flowContextA = Context.getFlowContext(\"flowA\");\n      var context = Context.get(\"1\", \"flowA\");\n      var keys = context.keys(function (err, keys) {\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"foo\", \"bar\");\n        keys = context.keys(function (err, keys) {\n          keys.should.have.length(1);\n          keys[0].should.equal(\"foo\");\n          context.set(\"abc.def\", \"bar\");\n          keys = context.keys(function (err, keys) {\n            keys.should.have.length(2);\n            keys[1].should.equal(\"abc\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate only context keys when GlobalContext was given - sync","suites":["context","local memory"],"updatePoint":{"line":201,"column":78,"index":7953},"line":201,"code":"    it('should enumerate only context keys when GlobalContext was given - sync', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        context.global.set(\"foo2\", \"bar2\");\n        var keys = context.global.keys();\n        keys.should.have.length(2);\n        keys[0].should.equal(\"foo\");\n        keys[1].should.equal(\"foo2\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate only context keys when GlobalContext was given - async","suites":["context","local memory"],"updatePoint":{"line":217,"column":79,"index":8508},"line":217,"code":"    it('should enumerate only context keys when GlobalContext was given - async', function (done) {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        context.global.set(\"foo2\", \"bar2\");\n        context.global.keys(function (err, keys) {\n          keys.should.have.length(2);\n          keys[0].should.equal(\"foo\");\n          keys[1].should.equal(\"foo2\");\n          done();\n        });\n      }).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"returns functionGlobalContext value if store value undefined","suites":["context","local memory"],"updatePoint":{"line":235,"column":68,"index":9113},"line":235,"code":"    it('returns functionGlobalContext value if store value undefined', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: \"bar\"\n        }\n      });\n      return Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        var v = context.global.get('foo');\n        v.should.equal('bar');\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"returns functionGlobalContext sub-value if store value undefined","suites":["context","local memory"],"updatePoint":{"line":248,"column":72,"index":9545},"line":248,"code":"    it('returns functionGlobalContext sub-value if store value undefined', function () {\n      Context.init({\n        functionGlobalContext: {\n          foo: {\n            bar: 123\n          }\n        }\n      });\n      return Context.load().then(function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var context = Context.get(\"1\", \"flowA\");\n        var v = context.global.get('foo.bar');\n        should.equal(v, 123);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent without key","suites":["context","local memory","$parent"],"updatePoint":{"line":264,"column":54,"index":10029},"line":264,"code":"      it('should get undefined for $parent without key', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.get(\"$parent\");\n        should.equal(parent, undefined);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent of root","suites":["context","local memory","$parent"],"updatePoint":{"line":272,"column":50,"index":10422},"line":272,"code":"      it('should get undefined for $parent of root', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.flow.get(\"$parent.$parent.K\");\n        should.equal(parent, undefined);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get undefined for $parent of root - callback","suites":["context","local memory","$parent"],"updatePoint":{"line":280,"column":61,"index":10841},"line":280,"code":"      it('should get undefined for $parent of root - callback', function (done) {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        context1.flow.get(\"$parent.$parent.K\", function (err, result) {\n          try {\n            should.equal(err, undefined);\n            should.equal(result, undefined);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should get value in $parent","suites":["context","local memory","$parent"],"updatePoint":{"line":295,"column":37,"index":11406},"line":295,"code":"      it('should get value in $parent', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        flowContextA.set(\"K\", \"v\");\n        var v = context1.flow.get(\"$parent.K\");\n        should.equal(v, \"v\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should set value in $parent","suites":["context","local memory","$parent"],"updatePoint":{"line":304,"column":37,"index":11813},"line":304,"code":"      it('should set value in $parent', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        context1.flow.set(\"$parent.K\", \"v\");\n        var v = flowContextA.get(\"K\");\n        should.equal(v, \"v\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not contain $parent in keys","suites":["context","local memory","$parent"],"updatePoint":{"line":313,"column":44,"index":12227},"line":313,"code":"      it('should not contain $parent in keys', function () {\n        var flowContextA = Context.getFlowContext(\"flowA\");\n        var flowContextB = Context.getFlowContext(\"flowB\", \"flowA\");\n        var context0 = Context.get(\"0\", \"flowA\");\n        var context1 = Context.get(\"1\", \"flowB\");\n        var parent = context1.get(\"$parent\");\n        flowContextA.set(\"K0\", \"v0\");\n        context1.set(\"K1\", \"v1\");\n        var keys = context1.keys();\n        keys.should.have.length(1);\n        keys[0].should.equal(\"K1\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"clears all context","suites":["context","local memory","clear"],"updatePoint":{"line":327,"column":28,"index":12781},"line":327,"code":"      it('clears all context', function () {\n        Context.init({\n          functionGlobalContext: {\n            foo: \"bar\"\n          }\n        });\n        return Context.load().then(function () {\n          var globalContextA = Context.get(\"global\");\n          globalContextA.get('foo').should.eql('bar');\n          globalContextA.set(\"another\", \"value\");\n          var flowContextA = Context.getFlowContext(\"flowA\");\n          flowContextA.set(\"foo\", \"abc\");\n          flowContextA.get(\"foo\").should.equal(\"abc\");\n          return Context.clear().then(function () {\n            var globalContextB = Context.getFlowContext(\"global\");\n            globalContextB.get('foo').should.eql('bar');\n            should.not.exist(globalContextB.get(\"another\"));\n            flowContextA = Context.getFlowContext(\"flowA\");\n            should.not.exist(flowContextA.get(\"foo\"));\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call open()","suites":["context","external context storage","load modules"],"updatePoint":{"line":429,"column":28,"index":16148},"line":429,"code":"      it('should call open()', function () {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          stubOpen.called.should.be.true();\n          stubOpen2.called.should.be.true();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should load memory module","suites":["context","external context storage","load modules"],"updatePoint":{"line":438,"column":35,"index":16436},"line":438,"code":"      it('should load memory module', function () {\n        Context.init({\n          contextStorage: {\n            memory: {\n              module: \"memory\"\n            }\n          }\n        });\n        return Context.load();\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should load localfilesystem module","suites":["context","external context storage","load modules"],"updatePoint":{"line":448,"column":44,"index":16680},"line":448,"code":"      it('should load localfilesystem module', function () {\n        Context.init({\n          contextStorage: {\n            file: {\n              module: \"localfilesystem\",\n              config: {\n                dir: resourcesDir\n              }\n            }\n          }\n        });\n        return Context.load();\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should ignore reserved storage name `_`","suites":["context","external context storage","load modules"],"updatePoint":{"line":461,"column":49,"index":17011},"line":461,"code":"      it('should ignore reserved storage name `_`', function (done) {\n        Context.init({\n          contextStorage: {\n            _: {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {};\n          context.set(\"foo\", \"bar\", \"_\", cb);\n          context.get(\"foo\", \"_\", cb);\n          context.keys(\"_\", cb);\n          stubSet.called.should.be.false();\n          stubGet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid store name","suites":["context","external context storage","load modules"],"updatePoint":{"line":482,"column":51,"index":17712},"line":482,"code":"      it('should fail when using invalid store name', function (done) {\n        Context.init({\n          contextStorage: {\n            'Invalid name': {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid sign character","suites":["context","external context storage","load modules"],"updatePoint":{"line":496,"column":55,"index":18096},"line":496,"code":"      it('should fail when using invalid sign character', function (done) {\n        Context.init({\n          contextStorage: {\n            'abc-123': {\n              module: testPlugin\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail when using invalid default context","suites":["context","external context storage","load modules"],"updatePoint":{"line":510,"column":56,"index":18476},"line":510,"code":"      it('should fail when using invalid default context', function (done) {\n        Context.init({\n          contextStorage: {\n            default: \"noexist\"\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail for the storage with no module","suites":["context","external context storage","load modules"],"updatePoint":{"line":522,"column":52,"index":18811},"line":522,"code":"      it('should fail for the storage with no module', function (done) {\n        Context.init({\n          contextStorage: {\n            test: {}\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail to load non-existent module","suites":["context","external context storage","load modules"],"updatePoint":{"line":534,"column":49,"index":19133},"line":534,"code":"      it('should fail to load non-existent module', function (done) {\n        Context.init({\n          contextStorage: {\n            file: {\n              module: \"nonexistent\"\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should fail to load invalid module","suites":["context","external context storage","load modules"],"updatePoint":{"line":548,"column":44,"index":19499},"line":548,"code":"      it('should fail to load invalid module', function (done) {\n        Context.init({\n          contextStorage: {\n            test: {\n              module: function (config) {\n                throw new Error(\"invalid plugin was loaded.\");\n              }\n            }\n          }\n        });\n        Context.load().then(function () {\n          done(\"An error was not thrown\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call close()","suites":["context","external context storage","close modules"],"updatePoint":{"line":566,"column":29,"index":19987},"line":566,"code":"      it('should call close()', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          return Context.close().then(function () {\n            stubClose.called.should.be.true();\n            stubClose2.called.should.be.true();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store local property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":580,"column":65,"index":20465},"line":580,"code":"      it('should store local property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        var cb = function () {\n          done(\"An error occurred\");\n        };\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"test\", cb);\n          context.get(\"foo\", \"test\", cb);\n          context.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store flow property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":599,"column":64,"index":21251},"line":599,"code":"      it('should store flow property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.flow.set(\"foo\", \"bar\", \"test\", cb);\n          context.flow.get(\"foo\", \"test\", cb);\n          context.flow.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store global property to external context storage","suites":["context","external context storage","store context"],"updatePoint":{"line":618,"column":66,"index":22054},"line":618,"code":"      it('should store global property to external context storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.global.set(\"foo\", \"bar\", \"test\", cb);\n          context.global.get(\"foo\", \"test\", cb);\n          context.global.keys(\"test\", cb);\n          stubSet.calledWithExactly(\"global\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet.calledWith(\"global\", \"foo\").should.be.true();\n          stubKeys.calledWith(\"global\").should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store data to the default context when non-existent context storage was specified","suites":["context","external context storage","store context"],"updatePoint":{"line":637,"column":98,"index":22890},"line":637,"code":"      it('should store data to the default context when non-existent context storage was specified', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.set(\"foo\", \"bar\", \"nonexist\", cb);\n          context.get(\"foo\", \"nonexist\", cb);\n          context.keys(\"nonexist\", cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use the default context","suites":["context","external context storage","store context"],"updatePoint":{"line":659,"column":40,"index":23813},"line":659,"code":"      it('should use the default context', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.set(\"foo\", \"bar\", \"default\", cb);\n          context.get(\"foo\", \"default\", cb);\n          context.keys(\"default\", cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"bar\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use the alias of default context","suites":["context","external context storage","store context"],"updatePoint":{"line":681,"column":49,"index":24742},"line":681,"code":"      it('should use the alias of default context', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.set(\"foo\", \"alias\", cb);\n          context.get(\"foo\", cb);\n          context.keys(cb);\n          stubGet.called.should.be.false();\n          stubSet.called.should.be.false();\n          stubKeys.called.should.be.false();\n          stubSet2.calledWithExactly(\"1:flow\", \"foo\", \"alias\", cb).should.be.true();\n          stubGet2.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys2.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should allow the store name to be provide in the key","suites":["context","external context storage","store context"],"updatePoint":{"line":703,"column":62,"index":25655},"line":703,"code":"      it('should allow the store name to be provide in the key', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.set(\"#:(test)::foo\", \"bar\");\n          context.get(\"#:(test)::foo\");\n          stubGet2.called.should.be.false();\n          stubSet2.called.should.be.false();\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"bar\", undefined).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use default as the alias of other context","suites":["context","external context storage","store context"],"updatePoint":{"line":722,"column":58,"index":26436},"line":722,"code":"      it('should use default as the alias of other context', function (done) {\n        Context.init({\n          contextStorage: contextAlias\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.set(\"foo\", \"alias\", cb);\n          context.get(\"foo\", cb);\n          context.keys(cb);\n          stubSet.calledWithExactly(\"1:flow\", \"foo\", \"alias\", cb).should.be.true();\n          stubGet.calledWith(\"1:flow\", \"foo\").should.be.true();\n          stubKeys.calledWithExactly(\"1:flow\", cb).should.be.true();\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error using undefined storage for local context","suites":["context","external context storage","store context"],"updatePoint":{"line":741,"column":77,"index":27219},"line":741,"code":"      it('should not throw an error using undefined storage for local context', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.get(\"local\", \"nonexist\", cb);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error using undefined storage for flow context","suites":["context","external context storage","store context"],"updatePoint":{"line":755,"column":72,"index":27725},"line":755,"code":"      it('should throw an error using undefined storage for flow context', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          var cb = function () {\n            done(\"An error occurred\");\n          };\n          context.flow.get(\"flow\", \"nonexist\", cb);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return functionGlobalContext value as a default - synchronous","suites":["context","external context storage","store context"],"updatePoint":{"line":769,"column":78,"index":28241},"line":769,"code":"      it('should return functionGlobalContext value as a default - synchronous', function (done) {\n        var fGC = {\n          \"foo\": 456\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          // Get foo - should be value from fGC\n          var v = context.global.get(\"foo\");\n          v.should.equal(456);\n\n          // Update foo - should not touch fGC object\n          context.global.set(\"foo\", \"new value\");\n          fGC.foo.should.equal(456);\n\n          // Get foo - should be the updated value\n          v = context.global.get(\"foo\");\n          v.should.equal(\"new value\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return functionGlobalContext value as a default - async","suites":["context","external context storage","store context"],"updatePoint":{"line":794,"column":72,"index":29101},"line":794,"code":"      it('should return functionGlobalContext value as a default - async', function (done) {\n        var fGC = {\n          \"foo\": 456\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          // Get foo - should be value from fGC\n          context.global.get(\"foo\", function (err, v) {\n            if (err) {\n              done(err);\n            } else {\n              v.should.equal(456);\n              // Update foo - should not touch fGC object\n              context.global.set(\"foo\", \"new value\", function (err) {\n                if (err) {\n                  done(err);\n                } else {\n                  fGC.foo.should.equal(456);\n                  // Get foo - should be the updated value\n                  context.global.get(\"foo\", function (err, v) {\n                    if (err) {\n                      done(err);\n                    } else {\n                      v.should.equal(\"new value\");\n                      done();\n                    }\n                  });\n                }\n              });\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return multiple values if key is an array","suites":["context","external context storage","store context"],"updatePoint":{"line":832,"column":58,"index":30398},"line":832,"code":"      it('should return multiple values if key is an array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo1\", \"bar1\", \"memory\");\n          context.set(\"foo2\", \"bar2\", \"memory\");\n          context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err) {\n              done(err);\n            } else {\n              foo1.should.be.equal(\"bar1\");\n              foo2.should.be.equal(\"bar2\");\n              should.not.exist(foo3);\n              done();\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return multiple functionGlobalContext values if key is an array","suites":["context","external context storage","store context"],"updatePoint":{"line":855,"column":80,"index":31239},"line":855,"code":"      it('should return multiple functionGlobalContext values if key is an array', function (done) {\n        var fGC = {\n          \"foo1\": 456,\n          \"foo2\": {\n            \"bar\": 789\n          }\n        };\n        Context.init({\n          contextStorage: memoryStorage,\n          functionGlobalContext: fGC\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.global.get([\"foo1\", \"foo2.bar\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err) {\n              done(err);\n            } else {\n              should.equal(foo1, 456);\n              should.equal(foo2, 789);\n              should.not.exist(foo3);\n              done();\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an error if an error occurs in getting multiple store values","suites":["context","external context storage","store context"],"updatePoint":{"line":883,"column":84,"index":32134},"line":883,"code":"      it('should return an error if an error occurs in getting multiple store values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubGet.onFirstCall().callsArgWith(2, \"error2\", \"bar1\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.global.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err === \"error2\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return a first error if some errors occur in getting multiple store values","suites":["context","external context storage","store context"],"updatePoint":{"line":902,"column":91,"index":32864},"line":902,"code":"      it('should return a first error if some errors occur in getting multiple store values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubGet.onFirstCall().callsArgWith(2, \"error1\");\n        stubGet.onSecondCall().callsArgWith(2, null, \"bar2\");\n        stubGet.onThirdCall().callsArgWith(2, \"error3\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n            if (err === \"error1\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store multiple properties if key and value are arrays","suites":["context","external context storage","store context"],"updatePoint":{"line":923,"column":70,"index":33677},"line":923,"code":"      it('should store multiple properties if key and value are arrays', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                if (err) {\n                  done(err);\n                } else {\n                  foo1.should.be.equal(\"bar1\");\n                  foo2.should.be.equal(\"bar2\");\n                  foo3.should.be.equal(\"bar3\");\n                  done();\n                }\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should deletes multiple properties","suites":["context","external context storage","store context"],"updatePoint":{"line":948,"column":44,"index":34573},"line":948,"code":"      it('should deletes multiple properties', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                if (err) {\n                  done(err);\n                } else {\n                  foo1.should.be.equal(\"bar1\");\n                  foo2.should.be.equal(\"bar2\");\n                  foo3.should.be.equal(\"bar3\");\n                  context.set([\"foo1\", \"foo2\", \"foo3\"], new Array(3), \"memory\", function (err) {\n                    if (err) {\n                      done(err);\n                    } else {\n                      context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                        if (err) {\n                          done(err);\n                        } else {\n                          should.not.exist(foo1);\n                          should.not.exist(foo2);\n                          should.not.exist(foo3);\n                          done();\n                        }\n                      });\n                    }\n                  });\n                }\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use null for missing values if the value array is shorter than the key array","suites":["context","external context storage","store context"],"updatePoint":{"line":988,"column":93,"index":36172},"line":988,"code":"      it('should use null for missing values if the value array is shorter than the key array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    foo2.should.be.equal(\"bar2\");\n                    should(foo3).be.null();\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should use null for missing values if the value is not array","suites":["context","external context storage","store context"],"updatePoint":{"line":1017,"column":70,"index":37271},"line":1017,"code":"      it('should use null for missing values if the value is not array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], \"bar1\", \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    should(foo2).be.null();\n                    should(foo3).be.null();\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should ignore the extra values if the value array is longer than the key array","suites":["context","external context storage","store context"],"updatePoint":{"line":1046,"column":88,"index":38372},"line":1046,"code":"      it('should ignore the extra values if the value array is longer than the key array', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\", \"ignored\"], \"memory\", function (err) {\n            if (err) {\n              done(err);\n            } else {\n              context.keys(function (err, keys) {\n                keys.should.have.length(3);\n                keys.should.eql([\"foo1\", \"foo2\", \"foo3\"]);\n                context.get([\"foo1\", \"foo2\", \"foo3\"], \"memory\", function (err, foo1, foo2, foo3) {\n                  if (err) {\n                    done(err);\n                  } else {\n                    foo1.should.be.equal(\"bar1\");\n                    foo2.should.be.equal(\"bar2\");\n                    foo3.should.be.equal(\"bar3\");\n                    done();\n                  }\n                });\n              });\n            }\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an error if an error occurs in storing multiple values","suites":["context","external context storage","store context"],"updatePoint":{"line":1075,"column":78,"index":39504},"line":1075,"code":"      it('should return an error if an error occurs in storing multiple values', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        stubSet.onFirstCall().callsArgWith(3, \"error2\");\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"foo1\", \"foo2\", \"foo3\"], [\"bar1\", \"bar2\", \"bar3\"], \"memory\", function (err) {\n            if (err === \"error2\") {\n              done();\n            } else {\n              done(\"An error occurred\");\n            }\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.get is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1094,"column":76,"index":40212},"line":1094,"code":"      it('should throw an error if callback of context.get is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"foo\", \"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.get is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1107,"column":79,"index":40704},"line":1107,"code":"      it('should not throw an error if callback of context.get is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"foo\", \"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.set is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1118,"column":76,"index":41120},"line":1118,"code":"      it('should throw an error if callback of context.set is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.set is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1131,"column":79,"index":41619},"line":1131,"code":"      it('should not throw an error if callback of context.set is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"foo\", \"bar\", \"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error if callback of context.keys is not a function","suites":["context","external context storage","store context"],"updatePoint":{"line":1142,"column":77,"index":42043},"line":1142,"code":"      it('should throw an error if callback of context.keys is not a function', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.keys(\"memory\", \"callback\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error if callback of context.keys is not specified","suites":["context","external context storage","store context"],"updatePoint":{"line":1155,"column":80,"index":42530},"line":1155,"code":"      it('should not throw an error if callback of context.keys is not specified', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var flowContext = Context.getFlowContext(\"flow\");\n          var context = Context.get(\"1\", \"flow\");\n          context.keys(\"memory\");\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1166,"column":69,"index":42933},"line":1166,"code":"      it('should throw an error in context.get if key is empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"\");\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1178,"column":66,"index":43327},"line":1178,"code":"      it('should throw an error in context.get if key is an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get({});\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key is a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1190,"column":65,"index":43720},"line":1190,"code":"      it('should throw an error in context.get if key is a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains an empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1202,"column":84,"index":44131},"line":1202,"code":"      it('should throw an error in context.get if key array contains an empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", \"\", \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1214,"column":78,"index":44553},"line":1214,"code":"      it('should throw an error in context.get if key array contains an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", {}, \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.get if key array contains a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1226,"column":77,"index":44974},"line":1226,"code":"      it('should throw an error in context.get if key array contains a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get([\"ok1\", 1, \"ok2\"]);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1238,"column":69,"index":45386},"line":1238,"code":"      it('should throw an error in context.set if key is empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"\", 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1250,"column":66,"index":45783},"line":1250,"code":"      it('should throw an error in context.set if key is an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set({}, 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key is a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1262,"column":65,"index":46179},"line":1262,"code":"      it('should throw an error in context.set if key is a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(1, 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains an empty string","suites":["context","external context storage","store context"],"updatePoint":{"line":1274,"column":84,"index":46593},"line":1274,"code":"      it('should throw an error in context.set if key array contains an empty string', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", \"\", \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains an object","suites":["context","external context storage","store context"],"updatePoint":{"line":1286,"column":78,"index":47018},"line":1286,"code":"      it('should throw an error in context.set if key array contains an object', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", {}, \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error in context.set if key array contains a number","suites":["context","external context storage","store context"],"updatePoint":{"line":1298,"column":77,"index":47442},"line":1298,"code":"      it('should throw an error in context.set if key array contains a number', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set([\"ok1\", 1, \"ok2\"], 1);\n          done(\"should throw an error.\");\n        }).catch(function () {\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should have an err set in callback for invalid key in context.get","suites":["context","external context storage","store context"],"updatePoint":{"line":1310,"column":75,"index":47863},"line":1310,"code":"      it('should have an err set in callback for invalid key in context.get', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.get(\"\", function (err) {\n            if (err) {\n              done();\n            } else {\n              done(\"should throw an error.\");\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should have an err set in callback for invalid key in context.set","suites":["context","external context storage","store context"],"updatePoint":{"line":1325,"column":75,"index":48343},"line":1325,"code":"      it('should have an err set in callback for invalid key in context.set', function (done) {\n        Context.init({\n          contextStorage: memoryStorage\n        });\n        Context.load().then(function () {\n          var context = Context.get(\"1\", \"flow\");\n          context.set(\"\", \"value\", function (err) {\n            if (err) {\n              done();\n            } else {\n              done(\"should throw an error.\");\n            }\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should list context storages","suites":["context","external context storage","listStores"],"updatePoint":{"line":1342,"column":38,"index":48844},"line":1342,"code":"      it('should list context storages', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          var list = Context.listStores();\n          list.default.should.equal(\"default\");\n          list.stores.should.eql([\"default\", \"test\"]);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should list context storages without default storage","suites":["context","external context storage","listStores"],"updatePoint":{"line":1353,"column":62,"index":49250},"line":1353,"code":"      it('should list context storages without default storage', function (done) {\n        Context.init({\n          contextStorage: contextStorage\n        });\n        Context.load().then(function () {\n          var list = Context.listStores();\n          list.default.should.equal(\"test\");\n          list.stores.should.eql([\"test\"]);\n          done();\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should not call delete() when external context storage is used","suites":["context","external context storage","delete context"],"updatePoint":{"line":1366,"column":72,"index":49698},"line":1366,"code":"      it('should not call delete() when external context storage is used', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          Context.get(\"flowA\");\n          return Context.delete(\"flowA\").then(function () {\n            stubDelete.called.should.be.false();\n            stubDelete2.called.should.be.false();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should call clean()","suites":["context","external context storage","clean context"],"updatePoint":{"line":1381,"column":29,"index":50184},"line":1381,"code":"      it('should call clean()', function (done) {\n        Context.init({\n          contextStorage: contextDefaultStorage\n        });\n        Context.load().then(function () {\n          return Context.clean({\n            allNodes: {}\n          }).then(function () {\n            stubClean.calledWithExactly([]).should.be.true();\n            stubClean2.calledWithExactly([]).should.be.true();\n            done();\n          });\n        }).catch(done);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/index_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":44,"column":29,"index":1538},"line":44,"code":"    it('should store property', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        if (err) {\n          return done(err);\n        }\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n          if (err) {\n            return done(err);\n          }\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            if (err) {\n              return done(err);\n            }\n            value.should.be.equal(\"test\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property - creates parent properties","suites":["localfilesystem","#get/set"],"updatePoint":{"line":64,"column":57,"index":2126},"line":64,"code":"    it('should store property - creates parent properties', function (done) {\n      context.set(\"nodeX\", \"foo.bar\", \"test\", function (err) {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          value.should.be.eql({\n            bar: \"test\"\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store local scope property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":74,"column":41,"index":2429},"line":74,"code":"    it('should store local scope property', function (done) {\n      context.set(\"abc:def\", \"foo.bar\", \"test\", function (err) {\n        context.get(\"abc:def\", \"foo\", function (err, value) {\n          value.should.be.eql({\n            bar: \"test\"\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete property","suites":["localfilesystem","#get/set"],"updatePoint":{"line":84,"column":30,"index":2725},"line":84,"code":"    it('should delete property', function (done) {\n      context.set(\"nodeX\", \"foo.abc.bar1\", \"test1\", function (err) {\n        context.set(\"nodeX\", \"foo.abc.bar2\", \"test2\", function (err) {\n          context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n            value.should.be.eql({\n              bar1: \"test1\",\n              bar2: \"test2\"\n            });\n            context.set(\"nodeX\", \"foo.abc.bar1\", undefined, function (err) {\n              context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n                value.should.be.eql({\n                  bar2: \"test2\"\n                });\n                context.set(\"nodeX\", \"foo.abc\", undefined, function (err) {\n                  context.get(\"nodeX\", \"foo.abc\", function (err, value) {\n                    should.not.exist(value);\n                    context.set(\"nodeX\", \"foo\", undefined, function (err) {\n                      context.get(\"nodeX\", \"foo\", function (err, value) {\n                        should.not.exist(value);\n                        done();\n                      });\n                    });\n                  });\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not shared context with other scope","suites":["localfilesystem","#get/set"],"updatePoint":{"line":114,"column":50,"index":3942},"line":114,"code":"    it('should not shared context with other scope', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.get(\"nodeY\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"testX\", function (err) {\n            context.set(\"nodeY\", \"foo\", \"testY\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.equal(\"testX\");\n                context.get(\"nodeY\", \"foo\", function (err, value) {\n                  value.should.be.equal(\"testY\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store string","suites":["localfilesystem","#get/set"],"updatePoint":{"line":133,"column":27,"index":4662},"line":133,"code":"    it('should store string', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.String();\n            value.should.be.equal(\"bar\");\n            context.set(\"nodeX\", \"foo\", \"1\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.String();\n                value.should.be.equal(\"1\");\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store number","suites":["localfilesystem","#get/set"],"updatePoint":{"line":151,"column":27,"index":5319},"line":151,"code":"    it('should store number', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", 1, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Number();\n            value.should.be.equal(1);\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store null","suites":["localfilesystem","#get/set"],"updatePoint":{"line":163,"column":25,"index":5714},"line":163,"code":"    it('should store null', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", null, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            should(value).be.null();\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store boolean","suites":["localfilesystem","#get/set"],"updatePoint":{"line":174,"column":28,"index":6076},"line":174,"code":"    it('should store boolean', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", true, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Boolean().and.true();\n            context.set(\"nodeX\", \"foo\", false, function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.Boolean().and.false();\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store object","suites":["localfilesystem","#get/set"],"updatePoint":{"line":190,"column":27,"index":6673},"line":190,"code":"    it('should store object', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", {\n          obj: \"bar\"\n        }, function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Object();\n            value.should.eql({\n              obj: \"bar\"\n            });\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array","suites":["localfilesystem","#get/set"],"updatePoint":{"line":206,"column":26,"index":7134},"line":206,"code":"    it('should store array', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [\"a\", \"b\", \"c\"], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.eql([\"a\", \"b\", \"c\"]);\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.String();\n              value.should.equal(\"b\");\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array of arrays","suites":["localfilesystem","#get/set"],"updatePoint":{"line":222,"column":36,"index":7726},"line":222,"code":"    it('should store array of arrays', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [[\"a\", \"b\", \"c\"], [1, 2, 3, 4], [true, false]], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.have.length(3);\n            value[0].should.have.length(3);\n            value[1].should.have.length(4);\n            value[2].should.have.length(2);\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.Array();\n              value.should.have.length(4);\n              value.should.be.eql([1, 2, 3, 4]);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store array of objects","suites":["localfilesystem","#get/set"],"updatePoint":{"line":242,"column":37,"index":8528},"line":242,"code":"    it('should store array of objects', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.set(\"nodeX\", \"foo\", [{\n          obj: \"bar1\"\n        }, {\n          obj: \"bar2\"\n        }, {\n          obj: \"bar3\"\n        }], function (err) {\n          context.get(\"nodeX\", \"foo\", function (err, value) {\n            value.should.be.Array();\n            value.should.have.length(3);\n            value[0].should.be.Object();\n            value[1].should.be.Object();\n            value[2].should.be.Object();\n            context.get(\"nodeX\", \"foo[1]\", function (err, value) {\n              value.should.be.Object();\n              value.should.be.eql({\n                obj: \"bar2\"\n              });\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values","suites":["localfilesystem","#get/set"],"updatePoint":{"line":269,"column":38,"index":9372},"line":269,"code":"    it('should set/get multiple values', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\"]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values - get unknown","suites":["localfilesystem","#get/set"],"updatePoint":{"line":277,"column":52,"index":9742},"line":277,"code":"    it('should set/get multiple values - get unknown', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\", \"unknown\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\", undefined]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should set/get multiple values - single value providd","suites":["localfilesystem","#get/set"],"updatePoint":{"line":285,"column":61,"index":10143},"line":285,"code":"    it('should set/get multiple values - single value providd', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], \"test1\", function (err) {\n        context.get(\"nodeX\", [\"one\", \"two\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", null]);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys - get","suites":["localfilesystem","#get/set"],"updatePoint":{"line":293,"column":69,"index":10507},"line":293,"code":"    it('should throw error if bad key included in multiple keys - get', function (done) {\n      context.set(\"nodeX\", [\"one\", \"two\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        context.get(\"nodeX\", [\"one\", \".foo\", \"three\"], function (err) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys - set","suites":["localfilesystem","#get/set"],"updatePoint":{"line":301,"column":69,"index":10844},"line":301,"code":"    it('should throw error if bad key included in multiple keys - set', function (done) {\n      context.set(\"nodeX\", [\"one\", \".foo\", \"three\"], [\"test1\", \"test2\", \"test3\"], function (err) {\n        should.exist(err);\n        // Check 'one' didn't get set as a result\n        context.get(\"nodeX\", \"one\", function (err, one) {\n          should.not.exist(one);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when getting a value with invalid key","suites":["localfilesystem","#get/set"],"updatePoint":{"line":311,"column":67,"index":11247},"line":311,"code":"    it('should throw an error when getting a value with invalid key', function (done) {\n      context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n        context.get(\"nodeX\", \" \", function (err, value) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when setting a value with invalid key","suites":["localfilesystem","#get/set"],"updatePoint":{"line":319,"column":67,"index":11528},"line":319,"code":"    it('should throw an error when setting a value with invalid key', function (done) {\n      context.set(\"nodeX\", \" \", \"bar\", function (err) {\n        should.exist(err);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of get() is not a function","suites":["localfilesystem","#get/set"],"updatePoint":{"line":325,"column":70,"index":11736},"line":325,"code":"    it('should throw an error when callback of get() is not a function', function (done) {\n      try {\n        context.get(\"nodeX\", \"foo\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of get() is not specified","suites":["localfilesystem","#get/set"],"updatePoint":{"line":333,"column":69,"index":11981},"line":333,"code":"    it('should throw an error when callback of get() is not specified', function (done) {\n      try {\n        context.get(\"nodeX\", \"foo\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of set() is not a function","suites":["localfilesystem","#get/set"],"updatePoint":{"line":341,"column":70,"index":12215},"line":341,"code":"    it('should throw an error when callback of set() is not a function', function (done) {\n      try {\n        context.set(\"nodeX\", \"foo\", \"bar\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not throw an error when callback of set() is not specified","suites":["localfilesystem","#get/set"],"updatePoint":{"line":349,"column":73,"index":12471},"line":349,"code":"    it('should not throw an error when callback of set() is not specified', function (done) {\n      try {\n        context.set(\"nodeX\", \" \", \"bar\");\n        done();\n      } catch (err) {\n        done(\"should not throw an error.\");\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty context file","suites":["localfilesystem","#get/set"],"updatePoint":{"line":357,"column":40,"index":12684},"line":357,"code":"    it('should handle empty context file', function (done) {\n      fs.outputFile(path.join(resourcesDir, defaultContextBase, \"nodeX\", \"flow.json\"), \"\", function () {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n            context.get(\"nodeX\", \"foo\", function (err, value) {\n              value.should.be.equal(\"test\");\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when reading corrupt context file","suites":["localfilesystem","#get/set"],"updatePoint":{"line":370,"column":63,"index":13222},"line":370,"code":"    it('should throw an error when reading corrupt context file', function (done) {\n      fs.outputFile(path.join(resourcesDir, defaultContextBase, \"nodeX\", \"flow.json\"), \"{abc\", function () {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.exist(err);\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["localfilesystem","#keys"],"updatePoint":{"line":395,"column":37,"index":13937},"line":395,"code":"    it('should enumerate context keys', function (done) {\n      context.keys(\"nodeX\", function (err, value) {\n        value.should.be.an.Array();\n        value.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n          context.keys(\"nodeX\", function (err, value) {\n            value.should.have.length(1);\n            value[0].should.equal(\"foo\");\n            context.set(\"nodeX\", \"abc.def\", \"bar\", function (err) {\n              context.keys(\"nodeX\", function (err, value) {\n                value.should.have.length(2);\n                value[1].should.equal(\"abc\");\n                done();\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in each scopes","suites":["localfilesystem","#keys"],"updatePoint":{"line":414,"column":52,"index":14651},"line":414,"code":"    it('should enumerate context keys in each scopes', function (done) {\n      context.keys(\"nodeX\", function (err, value) {\n        value.should.be.an.Array();\n        value.should.be.empty();\n        context.keys(\"nodeY\", function (err, value) {\n          value.should.be.an.Array();\n          value.should.be.empty();\n          context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n            context.set(\"nodeY\", \"hoge\", \"piyo\", function (err) {\n              context.keys(\"nodeX\", function (err, value) {\n                value.should.have.length(1);\n                value[0].should.equal(\"foo\");\n                context.keys(\"nodeY\", function (err, value) {\n                  value.should.have.length(1);\n                  value[0].should.equal(\"hoge\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of keys() is not a function","suites":["localfilesystem","#keys"],"updatePoint":{"line":437,"column":71,"index":15552},"line":437,"code":"    it('should throw an error when callback of keys() is not a function', function (done) {\n      try {\n        context.keys(\"nodeX\", \"callback\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should throw an error when callback of keys() is not specified","suites":["localfilesystem","#keys"],"updatePoint":{"line":445,"column":70,"index":15792},"line":445,"code":"    it('should throw an error when callback of keys() is not specified', function (done) {\n      try {\n        context.keys(\"nodeX\");\n        done(\"should throw an error.\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete context","suites":["localfilesystem","#delete"],"updatePoint":{"line":470,"column":29,"index":16392},"line":470,"code":"    it('should delete context', function (done) {\n      context.get(\"nodeX\", \"foo\", function (err, value) {\n        should.not.exist(value);\n        context.get(\"nodeY\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"testX\", function (err) {\n            context.set(\"nodeY\", \"foo\", \"testY\", function (err) {\n              context.get(\"nodeX\", \"foo\", function (err, value) {\n                value.should.be.equal(\"testX\");\n                context.get(\"nodeY\", \"foo\", function (err, value) {\n                  value.should.be.equal(\"testY\");\n                  context.delete(\"nodeX\").then(function () {\n                    context.get(\"nodeX\", \"foo\", function (err, value) {\n                      should.not.exist(value);\n                      context.get(\"nodeY\", \"foo\", function (err, value) {\n                        value.should.be.equal(\"testY\");\n                        done();\n                      });\n                    });\n                  }).catch(done);\n                });\n              });\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context","suites":["localfilesystem","#clean"],"updatePoint":{"line":538,"column":40,"index":18557},"line":538,"code":"    it('should clean unnecessary context', function (done) {\n      contextSet(\"global\", \"foo\", \"testGlobal\").then(function () {\n        return contextSet(\"nodeX:flow1\", \"foo\", \"testX\");\n      }).then(function () {\n        return contextSet(\"nodeY:flow2\", \"foo\", \"testY\");\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testY\");\n      }).then(function () {\n        return context.clean([]);\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"global\", \"foo\");\n      }).then(function (value) {\n        value.should.eql(\"testGlobal\");\n      }).then(done).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should not clean active context","suites":["localfilesystem","#clean"],"updatePoint":{"line":567,"column":39,"index":19662},"line":567,"code":"    it('should not clean active context', function (done) {\n      contextSet(\"global\", \"foo\", \"testGlobal\").then(function () {\n        return contextSet(\"nodeX:flow1\", \"foo\", \"testX\");\n      }).then(function () {\n        return contextSet(\"nodeY:flow2\", \"foo\", \"testY\");\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testY\");\n      }).then(function () {\n        return context.clean([\"flow1\", \"nodeX\"]);\n      }).then(function () {\n        return contextGet(\"nodeX:flow1\", \"foo\");\n      }).then(function (value) {\n        value.should.be.equal(\"testX\");\n      }).then(function () {\n        return contextGet(\"nodeY:flow2\", \"foo\");\n      }).then(function (value) {\n        should.not.exist(value);\n      }).then(function () {\n        return contextGet(\"global\", \"foo\");\n      }).then(function (value) {\n        value.should.eql(\"testGlobal\");\n      }).then(done).catch(done);\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should load contexts into the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":613,"column":43,"index":21220},"line":613,"code":"    it('should load contexts into the cache', function () {\n      var globalData = {\n        key: \"global\"\n      };\n      var flowData = {\n        key: \"flow\"\n      };\n      var nodeData = {\n        key: \"node\"\n      };\n      return Promise.all([fs.outputFile(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"), JSON.stringify(globalData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flow\", \"flow.json\"), JSON.stringify(flowData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flow\", \"node.json\"), JSON.stringify(nodeData, null, 4), \"utf8\")]).then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true\n        });\n        return context.open();\n      }).then(function () {\n        return Promise.all([fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")), fs.remove(path.join(resourcesDir, defaultContextBase, \"flow\", \"flow.json\")), fs.remove(path.join(resourcesDir, defaultContextBase, \"flow\", \"node.json\"))]);\n      }).then(function () {\n        context.get(\"global\", \"key\").should.be.equal(\"global\");\n        context.get(\"flow\", \"key\").should.be.equal(\"flow\");\n        context.get(\"node:flow\", \"key\").should.be.equal(\"node\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property to the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":637,"column":42,"index":22521},"line":637,"code":"    it('should store property to the cache', function () {\n      context = LocalFileSystem({\n        dir: resourcesDir,\n        cache: true,\n        flushInterval: 1\n      });\n      return context.open().then(function () {\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo\", \"bar\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              fs.readJson(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")).then(function (data) {\n                // File should not exist as flush hasn't happened\n                reject(\"File global/global.json should not exist\");\n              }).catch(function (err) {\n                setTimeout(function () {\n                  fs.readJson(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\")).then(function (data) {\n                    data.should.eql({\n                      foo: 'bar'\n                    });\n                    resolve();\n                  }).catch(function (err) {\n                    reject(err);\n                  });\n                }, 1100);\n              });\n            }\n          });\n        });\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        context.get(\"global\", \"foo\").should.be.equal(\"bar\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":673,"column":50,"index":23939},"line":673,"code":"    it('should enumerate context keys in the cache', function () {\n      var globalData = {\n        foo: \"bar\"\n      };\n      return fs.outputFile(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"), JSON.stringify(globalData, null, 4), \"utf8\").then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true,\n          flushInterval: 2\n        });\n        return context.open();\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        var keys = context.keys(\"global\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo2\", \"bar2\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve();\n            }\n          });\n        });\n      }).then(function () {\n        return fs.remove(path.join(resourcesDir, defaultContextBase, \"global\", \"global.json\"));\n      }).then(function () {\n        var keys = context.keys(\"global\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"foo2\");\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should delete context in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":707,"column":42,"index":25182},"line":707,"code":"    it('should delete context in the cache', function () {\n      context = LocalFileSystem({\n        dir: resourcesDir,\n        cache: true,\n        flushInterval: 2\n      });\n      return context.open().then(function () {\n        return new Promise(function (resolve, reject) {\n          context.set(\"global\", \"foo\", \"bar\", function (err) {\n            if (err) {\n              reject(err);\n            } else {\n              resolve();\n            }\n          });\n        });\n      }).then(function () {\n        context.get(\"global\", \"foo\").should.be.equal(\"bar\");\n        return context.delete(\"global\");\n      }).then(function () {\n        should.not.exist(context.get(\"global\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context in the cache","suites":["localfilesystem","#if cache is enabled"],"updatePoint":{"line":730,"column":53,"index":25903},"line":730,"code":"    it('should clean unnecessary context in the cache', function () {\n      var flowAData = {\n        key: \"flowA\"\n      };\n      var flowBData = {\n        key: \"flowB\"\n      };\n      return Promise.all([fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flowA\", \"flow.json\"), JSON.stringify(flowAData, null, 4), \"utf8\"), fs.outputFile(path.join(resourcesDir, defaultContextBase, \"flowB\", \"flow.json\"), JSON.stringify(flowBData, null, 4), \"utf8\")]).then(function () {\n        context = LocalFileSystem({\n          dir: resourcesDir,\n          cache: true,\n          flushInterval: 2\n        });\n        return context.open();\n      }).then(function () {\n        context.get(\"flowA\", \"key\").should.be.equal(\"flowA\");\n        context.get(\"flowB\", \"key\").should.be.equal(\"flowB\");\n        return context.clean([\"flowA\"]);\n      }).then(function () {\n        context.get(\"flowA\", \"key\").should.be.equal(\"flowA\");\n        should.not.exist(context.get(\"flowB\", \"key\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should change a base directory","suites":["localfilesystem","Configuration"],"updatePoint":{"line":770,"column":38,"index":27297},"line":770,"code":"    it('should change a base directory', function (done) {\n      var differentBaseContext = LocalFileSystem({\n        base: \"contexts2\",\n        dir: resourcesDir,\n        cache: false\n      });\n      differentBaseContext.open().then(function () {\n        differentBaseContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n          differentBaseContext.get(\"node2\", \"foo2\", function (err, value) {\n            value.should.be.equal(\"bar2\");\n            context.get(\"node2\", \"foo2\", function (err, value) {\n              should.not.exist(value);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use userDir","suites":["localfilesystem","Configuration"],"updatePoint":{"line":788,"column":26,"index":27913},"line":788,"code":"    it('should use userDir', function (done) {\n      var userDirContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false,\n        settings: {\n          userDir: resourcesDir\n        }\n      });\n      userDirContext.open().then(function () {\n        userDirContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n          userDirContext.get(\"node2\", \"foo2\", function (err, value) {\n            value.should.be.equal(\"bar2\");\n            context.get(\"node2\", \"foo2\", function (err, value) {\n              should.not.exist(value);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use NODE_RED_HOME","suites":["localfilesystem","Configuration"],"updatePoint":{"line":808,"column":32,"index":28547},"line":808,"code":"    it('should use NODE_RED_HOME', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      process.env.NODE_RED_HOME = resourcesDir;\n      fs.ensureDirSync(resourcesDir);\n      fs.writeFileSync(path.join(resourcesDir, \".config.json\"), \"\");\n      var nrHomeContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false\n      });\n      try {\n        nrHomeContext.open().then(function () {\n          nrHomeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n            nrHomeContext.get(\"node2\", \"foo2\", function (err, value) {\n              value.should.be.equal(\"bar2\");\n              context.get(\"node2\", \"foo2\", function (err, value) {\n                should.not.exist(value);\n                done();\n              });\n            });\n          });\n        });\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use HOME_PATH","suites":["localfilesystem","Configuration"],"updatePoint":{"line":833,"column":28,"index":29415},"line":833,"code":"    it('should use HOME_PATH', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      var oldHOMEPATH = process.env.HOMEPATH;\n      process.env.NODE_RED_HOME = resourcesDir;\n      process.env.HOMEPATH = resourcesDir;\n      var homePath = path.join(resourcesDir, \".node-red\");\n      fs.outputFile(path.join(homePath, \".config.json\"), \"\", function () {\n        var homeContext = LocalFileSystem({\n          base: \"contexts2\",\n          cache: false\n        });\n        try {\n          homeContext.open().then(function () {\n            homeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n              homeContext.get(\"node2\", \"foo2\", function (err, value) {\n                value.should.be.equal(\"bar2\");\n                context.get(\"node2\", \"foo2\", function (err, value) {\n                  should.not.exist(value);\n                  done();\n                });\n              });\n            });\n          });\n        } finally {\n          process.env.NODE_RED_HOME = oldNRH;\n          process.env.HOMEPATH = oldHOMEPATH;\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should use HOME_PATH","suites":["localfilesystem","Configuration"],"updatePoint":{"line":862,"column":28,"index":30485},"line":862,"code":"    it('should use HOME_PATH', function (done) {\n      var oldNRH = process.env.NODE_RED_HOME;\n      var oldHOMEPATH = process.env.HOMEPATH;\n      var oldHOME = process.env.HOME;\n      process.env.NODE_RED_HOME = resourcesDir;\n      process.env.HOMEPATH = resourcesDir;\n      process.env.HOME = resourcesDir;\n      var homeContext = LocalFileSystem({\n        base: \"contexts2\",\n        cache: false\n      });\n      try {\n        homeContext.open().then(function () {\n          homeContext.set(\"node2\", \"foo2\", \"bar2\", function (err) {\n            homeContext.get(\"node2\", \"foo2\", function (err, value) {\n              value.should.be.equal(\"bar2\");\n              context.get(\"node2\", \"foo2\", function (err, value) {\n                should.not.exist(value);\n                done();\n              });\n            });\n          });\n        });\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOMEPATH = oldHOMEPATH;\n        process.env.HOME = oldHOME;\n      }\n    });","file":"unit/@node-red/runtime/lib/nodes/context/localfilesystem_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["memory","#get/set","sync"],"updatePoint":{"line":33,"column":31,"index":1152},"line":33,"code":"      it('should store property', function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        context.set(\"nodeX\", \"foo\", \"test\");\n        context.get(\"nodeX\", \"foo\").should.equal(\"test\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should store property - creates parent properties","suites":["memory","#get/set","sync"],"updatePoint":{"line":38,"column":59,"index":1396},"line":38,"code":"      it('should store property - creates parent properties', function () {\n        context.set(\"nodeX\", \"foo.bar\", \"test\");\n        context.get(\"nodeX\", \"foo\").should.eql({\n          bar: \"test\"\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should delete property","suites":["memory","#get/set","sync"],"updatePoint":{"line":44,"column":32,"index":1587},"line":44,"code":"      it('should delete property', function () {\n        context.set(\"nodeX\", \"foo.abc.bar1\", \"test1\");\n        context.set(\"nodeX\", \"foo.abc.bar2\", \"test2\");\n        context.get(\"nodeX\", \"foo.abc\").should.eql({\n          bar1: \"test1\",\n          bar2: \"test2\"\n        });\n        context.set(\"nodeX\", \"foo.abc.bar1\", undefined);\n        context.get(\"nodeX\", \"foo.abc\").should.eql({\n          bar2: \"test2\"\n        });\n        context.set(\"nodeX\", \"foo.abc\", undefined);\n        should.not.exist(context.get(\"nodeX\", \"foo.abc\"));\n        context.set(\"nodeX\", \"foo\", undefined);\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not shared context with other scope","suites":["memory","#get/set","sync"],"updatePoint":{"line":60,"column":52,"index":2250},"line":60,"code":"      it('should not shared context with other scope', function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n        context.set(\"nodeX\", \"foo\", \"testX\");\n        context.set(\"nodeY\", \"foo\", \"testY\");\n        context.get(\"nodeX\", \"foo\").should.equal(\"testX\");\n        context.get(\"nodeY\", \"foo\").should.equal(\"testY\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw the error if the error occurs","suites":["memory","#get/set","sync"],"updatePoint":{"line":68,"column":52,"index":2649},"line":68,"code":"      it('should throw the error if the error occurs', function () {\n        try {\n          context.set(\"nodeX\", \".foo\", \"test\");\n          should.fail(\"Error was not thrown\");\n        } catch (err) {\n          should.exist(err);\n          try {\n            context.get(\"nodeX\", \".foo\");\n            should.fail(\"Error was not thrown\");\n          } catch (err) {\n            should.exist(err);\n          }\n        }\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - all known","suites":["memory","#get/set","sync"],"updatePoint":{"line":82,"column":48,"index":3072},"line":82,"code":"      it('should get multiple values - all known', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        var values = context.get(\"nodeX\", [\"one\", \"two\", \"four\"]);\n        values.should.eql([\"test1\", \"test2\", \"test4\"]);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - include unknown","suites":["memory","#get/set","sync"],"updatePoint":{"line":90,"column":54,"index":3463},"line":90,"code":"      it('should get multiple values - include unknown', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        var values = context.get(\"nodeX\", [\"one\", \"unknown.with.multiple.levels\"]);\n        values.should.eql([\"test1\", undefined]);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys","suites":["memory","#get/set","sync"],"updatePoint":{"line":98,"column":65,"index":3875},"line":98,"code":"      it('should throw error if bad key included in multiple keys', function () {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        try {\n          var values = context.get(\"nodeX\", [\"one\", \".foo\", \"three\"]);\n          should.fail(\"Error was not thrown\");\n        } catch (err) {\n          should.exist(err);\n        }\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should store property","suites":["memory","#get/set","async"],"updatePoint":{"line":112,"column":31,"index":4359},"line":112,"code":"      it('should store property', function (done) {\n        context.get(\"nodeX\", \"foo\", function (err, value) {\n          should.not.exist(value);\n          context.set(\"nodeX\", \"foo\", \"test\", function (err) {\n            context.get(\"nodeX\", \"foo\", function (err, value) {\n              value.should.equal(\"test\");\n              done();\n            });\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should pass the error to callback if the error occurs","suites":["memory","#get/set","async"],"updatePoint":{"line":123,"column":63,"index":4781},"line":123,"code":"      it('should pass the error to callback if the error occurs', function (done) {\n        context.set(\"nodeX\", \".foo\", \"test\", function (err, value) {\n          should.exist(err);\n          context.get(\"nodeX\", \".foo\", function (err) {\n            should.exist(err);\n            done();\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - all known","suites":["memory","#get/set","async"],"updatePoint":{"line":132,"column":48,"index":5091},"line":132,"code":"      it('should get multiple values - all known', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \"two\", \"four\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", \"test2\", \"test4\"]);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should get multiple values - include unknown","suites":["memory","#get/set","async"],"updatePoint":{"line":142,"column":54,"index":5561},"line":142,"code":"      it('should get multiple values - include unknown', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \"unknown\"], function () {\n          Array.prototype.slice.apply(arguments).should.eql([undefined, \"test1\", undefined]);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if bad key included in multiple keys","suites":["memory","#get/set","async"],"updatePoint":{"line":152,"column":65,"index":6031},"line":152,"code":"      it('should throw error if bad key included in multiple keys', function (done) {\n        context.set(\"nodeX\", \"one\", \"test1\");\n        context.set(\"nodeX\", \"two\", \"test2\");\n        context.set(\"nodeX\", \"three\", \"test3\");\n        context.set(\"nodeX\", \"four\", \"test4\");\n        context.get(\"nodeX\", [\"one\", \".foo\", \"three\"], function (err) {\n          should.exist(err);\n          done();\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":166,"column":39,"index":6502},"line":166,"code":"      it('should enumerate context keys', function () {\n        var keys = context.keys(\"nodeX\");\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\");\n        keys = context.keys(\"nodeX\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        context.set(\"nodeX\", \"abc.def\", \"bar\");\n        keys = context.keys(\"nodeX\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"abc\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys in each scopes","suites":["memory","#keys","sync"],"updatePoint":{"line":179,"column":54,"index":7006},"line":179,"code":"      it('should enumerate context keys in each scopes', function () {\n        var keysX = context.keys(\"nodeX\");\n        keysX.should.be.an.Array();\n        keysX.should.be.empty();\n        var keysY = context.keys(\"nodeY\");\n        keysY.should.be.an.Array();\n        keysY.should.be.empty();\n        context.set(\"nodeX\", \"foo\", \"bar\");\n        context.set(\"nodeY\", \"hoge\", \"piyo\");\n        keysX = context.keys(\"nodeX\");\n        keysX.should.have.length(1);\n        keysX[0].should.equal(\"foo\");\n        keysY = context.keys(\"nodeY\");\n        keysY.should.have.length(1);\n        keysY[0].should.equal(\"hoge\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate global context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":195,"column":46,"index":7622},"line":195,"code":"      it('should enumerate global context keys', function () {\n        var keys = context.keys(\"global\");\n        keys.should.be.an.Array();\n        keys.should.be.empty();\n        context.set(\"global\", \"foo\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(1);\n        keys[0].should.equal(\"foo\");\n        context.set(\"global\", \"abc.def\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(2);\n        keys[1].should.equal(\"abc\");\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not return specific keys as global context keys","suites":["memory","#keys","sync"],"updatePoint":{"line":208,"column":64,"index":8141},"line":208,"code":"      it('should not return specific keys as global context keys', function () {\n        var keys = context.keys(\"global\");\n        context.set(\"global\", \"set\", \"bar\");\n        context.set(\"global\", \"get\", \"bar\");\n        context.set(\"global\", \"keys\", \"bar\");\n        keys = context.keys(\"global\");\n        keys.should.have.length(0);\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should enumerate context keys","suites":["memory","#keys","async"],"updatePoint":{"line":218,"column":39,"index":8505},"line":218,"code":"      it('should enumerate context keys', function (done) {\n        context.keys(\"nodeX\", function (err, keys) {\n          keys.should.be.an.Array();\n          keys.should.be.empty();\n          context.set(\"nodeX\", \"foo\", \"bar\", function (err) {\n            context.keys(\"nodeX\", function (err, keys) {\n              keys.should.have.length(1);\n              keys[0].should.equal(\"foo\");\n              context.set(\"nodeX\", \"abc.def\", \"bar\", function (err) {\n                context.keys(\"nodeX\", function (err, keys) {\n                  keys.should.have.length(2);\n                  keys[1].should.equal(\"abc\");\n                  done();\n                });\n              });\n            });\n          });\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should delete context","suites":["memory","#delete"],"updatePoint":{"line":240,"column":29,"index":9273},"line":240,"code":"    it('should delete context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.delete(\"nodeX\").then(function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should clean unnecessary context","suites":["memory","#clean"],"updatePoint":{"line":254,"column":40,"index":9851},"line":254,"code":"    it('should clean unnecessary context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.clean([]).then(function () {\n        should.not.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not clean active context","suites":["memory","#clean"],"updatePoint":{"line":266,"column":39,"index":10385},"line":266,"code":"    it('should not clean active context', function () {\n      should.not.exist(context.get(\"nodeX\", \"foo\"));\n      should.not.exist(context.get(\"nodeY\", \"foo\"));\n      context.set(\"nodeX\", \"foo\", \"abc\");\n      context.set(\"nodeY\", \"foo\", \"abc\");\n      context.get(\"nodeX\", \"foo\").should.equal(\"abc\");\n      context.get(\"nodeY\", \"foo\").should.equal(\"abc\");\n      return context.clean([\"nodeX\"]).then(function () {\n        should.exist(context.get(\"nodeX\", \"foo\"));\n        should.not.exist(context.get(\"nodeY\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"should not clean global context","suites":["memory","#clean"],"updatePoint":{"line":278,"column":39,"index":10922},"line":278,"code":"    it('should not clean global context', function () {\n      context.set(\"global\", \"foo\", \"abc\");\n      context.get(\"global\", \"foo\").should.equal(\"abc\");\n      return context.clean([\"global\"]).then(function () {\n        should.exist(context.get(\"global\", \"foo\"));\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/context/memory_spec.js","skipped":false,"dir":"test"},{"name":"loads provided credentials","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":33,"column":32,"index":1225},"line":33,"code":"  it('loads provided credentials', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.get(\"a\").should.have.property('b', 1);\n      credentials.get(\"a\").should.have.property('c', 2);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"adds a new credential","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":48,"column":27,"index":1595},"line":48,"code":"  it('adds a new credential', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.dirty().should.be.false();\n      should.not.exist(credentials.get(\"b\"));\n      return credentials.add(\"b\", {\n        \"foo\": \"bar\"\n      }).then(function () {\n        credentials.get(\"b\").should.have.property(\"foo\", \"bar\");\n        credentials.dirty().should.be.true();\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"deletes an existing credential","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":69,"column":36,"index":2157},"line":69,"code":"  it('deletes an existing credential', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    return credentials.load({\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    }).then(function () {\n      credentials.dirty().should.be.false();\n      credentials.delete(\"a\");\n      should.not.exist(credentials.get(\"a\"));\n      credentials.dirty().should.be.true();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"exports the credentials, clearing dirty flag","suites":["red/runtime/nodes/credentials"],"updatePoint":{"line":86,"column":50,"index":2602},"line":86,"code":"  it('exports the credentials, clearing dirty flag', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings\n    });\n    var creds = {\n      \"a\": {\n        \"b\": 1,\n        \"c\": 2\n      }\n    };\n    return credentials.load(creds).then(function () {\n      return credentials.add(\"b\", {\n        \"foo\": \"bar\"\n      });\n    }).then(function () {\n      credentials.dirty().should.be.true();\n      return credentials.export().then(function (exported) {\n        exported.should.eql(creds);\n        credentials.dirty().should.be.false();\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"removes credentials of unknown nodes","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":110,"column":44,"index":3224},"line":110,"code":"    it(\"removes credentials of unknown nodes\", function () {\n      credentials.init({\n        log: log,\n        settings: encryptionDisabledSettings,\n        nodes: {\n          getType: () => function () {}\n        }\n      });\n      var creds = {\n        \"a\": {\n          \"b\": 1,\n          \"c\": 2\n        },\n        \"b\": {\n          \"d\": 3\n        }\n      };\n      return credentials.load(creds).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"a\"));\n        should.exist(credentials.get(\"b\"));\n        return credentials.clean([{\n          id: \"b\"\n        }]).then(function () {\n          credentials.dirty().should.be.true();\n          should.not.exist(credentials.get(\"a\"));\n          should.exist(credentials.get(\"b\"));\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extracts credentials of known nodes","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":140,"column":43,"index":4032},"line":140,"code":"    it(\"extracts credentials of known nodes\", function () {\n      credentials.init({\n        log: log,\n        settings: encryptionDisabledSettings,\n        nodes: {\n          getType: () => function () {}\n        }\n      });\n      credentials.register(\"testNode\", {\n        \"b\": \"text\",\n        \"c\": \"password\"\n      });\n      var creds = {\n        \"a\": {\n          \"b\": 1,\n          \"c\": 2\n        }\n      };\n      var newConfig = [{\n        id: \"a\",\n        type: \"testNode\",\n        credentials: {\n          \"b\": \"newBValue\",\n          \"c\": \"newCValue\"\n        }\n      }];\n      return credentials.load(creds).then(function () {\n        credentials.dirty().should.be.false();\n        return credentials.clean(newConfig).then(function () {\n          credentials.dirty().should.be.true();\n          credentials.get(\"a\").should.have.property('b', \"newBValue\");\n          credentials.get(\"a\").should.have.property('c', \"newCValue\");\n          should.not.exist(newConfig[0].credentials);\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"warns if a node has no credential definition","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":177,"column":50,"index":5062},"line":177,"code":"  it('warns if a node has no credential definition', function () {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    return credentials.load({}).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\",\n        credentials: {\n          user1: \"newUser\",\n          password1: \"newPassword\"\n        }\n      };\n      sinon.spy(log, \"warn\");\n      credentials.extract(node);\n      log.warn.called.should.be.true();\n      should.not.exist(node.credentials);\n      log.warn.restore();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extract credential updates in the provided node","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":201,"column":53,"index":5686},"line":201,"code":"  it('extract credential updates in the provided node', function (done) {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    var defintion = {\n      user1: {\n        type: \"text\"\n      },\n      password1: {\n        type: \"password\"\n      },\n      user2: {\n        type: \"text\"\n      },\n      password2: {\n        type: \"password\"\n      },\n      user3: {\n        type: \"text\"\n      },\n      password3: {\n        type: \"password\"\n      }\n    };\n    credentials.register(\"test\", defintion);\n    var def = credentials.getDefinition(\"test\");\n    defintion.should.eql(def);\n    credentials.load({\n      \"node\": {\n        user1: \"abc\",\n        password1: \"123\",\n        user2: \"def\",\n        password2: \"456\",\n        user3: \"ghi\",\n        password3: \"789\"\n      }\n    }).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\",\n        credentials: {\n          // user1 unchanged\n          password1: \"__PWRD__\",\n          user2: \"\",\n          password2: \"   \",\n          user3: \"newUser\",\n          password3: \"newPassword\"\n        }\n      };\n      credentials.dirty().should.be.false();\n      credentials.extract(node);\n      node.should.not.have.a.property(\"credentials\");\n      credentials.dirty().should.be.true();\n      var newCreds = credentials.get(\"node\");\n      newCreds.should.have.a.property(\"user1\", \"abc\");\n      newCreds.should.have.a.property(\"password1\", \"123\");\n      newCreds.should.not.have.a.property(\"user2\");\n      newCreds.should.not.have.a.property(\"password2\");\n      newCreds.should.have.a.property(\"user3\", \"newUser\");\n      newCreds.should.have.a.property(\"password3\", \"newPassword\");\n      done();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"extract ignores node without credentials","suites":["red/runtime/nodes/credentials","#clean"],"updatePoint":{"line":268,"column":46,"index":7443},"line":268,"code":"  it('extract ignores node without credentials', function (done) {\n    credentials.init({\n      log: log,\n      settings: encryptionDisabledSettings,\n      nodes: {\n        getType: () => function () {}\n      }\n    });\n    credentials.load({\n      \"node\": {\n        user1: \"abc\",\n        password1: \"123\"\n      }\n    }).then(function () {\n      var node = {\n        id: \"node\",\n        type: \"test\"\n      };\n      credentials.dirty().should.be.false();\n      credentials.extract(node);\n      credentials.dirty().should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates to encrypted and generates default key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":313,"column":55,"index":8505},"line":313,"code":"    it('migrates to encrypted and generates default key', function (done) {\n      settings = {};\n      credentials.init(runtime);\n      credentials.load({\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      }).then(function () {\n        settings.should.have.a.property(\"_credentialSecret\");\n        settings._credentialSecret.should.have.a.length(64);\n        credentials.dirty().should.be.true();\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses default key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":337,"column":24,"index":9328},"line":337,"code":"    it('uses default key', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        should.exist(credentials.get(\"node\"));\n        credentials.dirty().should.be.false();\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses user key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":367,"column":21,"index":10539},"line":367,"code":"    it('uses user key', function (done) {\n      settings = {\n        credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"node\"));\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"uses user key - when settings are otherwise unavailable","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":398,"column":63,"index":11792},"line":398,"code":"    it('uses user key - when settings are otherwise unavailable', function (done) {\n      var runtime = {\n        log: log,\n        settings: {\n          get: function (key) {\n            if (key === 'credentialSecret') {\n              return \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\";\n            }\n            throw new Error();\n          },\n          set: function (key, value) {\n            throw new Error();\n          }\n        }\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        should.exist(credentials.get(\"node\"));\n        credentials.add(\"node\", {\n          user1: \"def\",\n          password1: \"456\"\n        });\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"def\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"456\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to user key","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":439,"column":45,"index":13245},"line":439,"code":"    it('migrates from default key to user key', function () {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: \"aaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbcccccccccccccddddddddddddeeeee\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      return credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        return credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\");\n\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          return credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"abc\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"123\");\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to user key - unencrypted original","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":467,"column":68,"index":14565},"line":467,"code":"    it('migrates from default key to user key - unencrypted original', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: \"aaaaaaaaaaaaaaaaabbbbbbbbbbbbbbbbbcccccccccccccddddddddddddeeeee\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var unencryptedFlows = {\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      };\n      credentials.init(runtime);\n      credentials.load(unencryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\");\n          // reset everything - but with _credentialSecret still set\n          credentials.init(runtime);\n          // load the freshly encrypted version\n          credentials.load(result).then(function () {\n            should.exist(credentials.get(\"node\"));\n            credentials.get(\"node\").should.have.a.property(\"user1\", \"abc\");\n            credentials.get(\"node\").should.have.a.property(\"password1\", \"123\");\n            done();\n          });\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"migrates from default key to unencrypted","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":498,"column":48,"index":15850},"line":498,"code":"    it('migrates from default key to unencrypted', function (done) {\n      settings = {\n        _credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\",\n        credentialSecret: false\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        credentials.dirty().should.be.true();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.not.have.a.property(\"$\");\n          settings.should.not.have.a.property(\"_credentialSecret\");\n          result.should.eql({\n            \"node\": {\n              user1: \"abc\",\n              password1: \"123\"\n            }\n          });\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad default key - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":524,"column":52,"index":16807},"line":524,"code":"    it('handles bad default key - resets credentials', function (done) {\n      settings = {\n        _credentialSecret: \"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        // credentials.dirty().should.be.true();\n        // should.not.exist(credentials.get(\"node\"));\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad user key - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":542,"column":49,"index":17530},"line":542,"code":"    it('handles bad user key - resets credentials', function (done) {\n      settings = {\n        credentialSecret: \"badbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadbadb\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"$\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        // credentials.dirty().should.be.true();\n        // should.not.exist(credentials.get(\"node\"));\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles bad credentials object - resets credentials","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":560,"column":59,"index":18262},"line":560,"code":"    it('handles bad credentials object - resets credentials', function (done) {\n      settings = {\n        credentialSecret: \"e3a36f47f005bf2aaa51ce3fc6fcaafd79da8d03f2b1a9281f8fb0a285e6255a\"\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      var cryptedFlows = {\n        \"BADKEY\": \"5b89d8209b5158a3c313675561b1a5b5phN1gDBe81Zv98KqS/hVDmc9EKvaKqRIvcyXYvBlFNzzzJtvN7qfw06i\"\n      };\n      credentials.init(runtime);\n      credentials.load(cryptedFlows).then(function () {\n        done();\n      }).catch(function (err) {\n        err.should.have.property('code', 'credentials_load_failed');\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"handles unavailable settings - leaves creds unencrypted","suites":["red/runtime/nodes/credentials","encryption"],"updatePoint":{"line":576,"column":63,"index":18900},"line":576,"code":"    it('handles unavailable settings - leaves creds unencrypted', function (done) {\n      var runtime = {\n        log: log,\n        settings: {\n          get: function (key) {\n            throw new Error();\n          },\n          set: function (key, value) {\n            throw new Error();\n          }\n        },\n        nodes: {\n          getType: () => function () {}\n        }\n      };\n      // {\"node\":{user1:\"abc\",password1:\"123\"}}\n      credentials.init(runtime);\n      credentials.load({\n        \"node\": {\n          user1: \"abc\",\n          password1: \"123\"\n        }\n      }).then(function () {\n        credentials.dirty().should.be.false();\n        should.exist(credentials.get(\"node\"));\n        credentials.export().then(function (result) {\n          result.should.not.have.a.property(\"$\");\n          result.should.have.a.property(\"node\");\n          done();\n        });\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/credentials_spec.js","skipped":false,"dir":"test"},{"name":"nodes are initialised with credentials","suites":["red/nodes/index"],"updatePoint":{"line":94,"column":44,"index":2601},"line":94,"code":"  it('nodes are initialised with credentials', function (done) {\n    index.init(runtime);\n    index.registerType('test-node-set', 'test', TestNode);\n    index.loadFlows().then(function () {\n      var testnode = new TestNode({\n        id: 'tab1',\n        type: 'test',\n        name: 'barney'\n      });\n      testnode.credentials.should.have.property('b', 1);\n      testnode.credentials.should.have.property('c', \"2\");\n      testnode.credentials.should.have.property('d', \"bar\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"flows should be initialised","suites":["red/nodes/index"],"updatePoint":{"line":111,"column":33,"index":3143},"line":111,"code":"  it('flows should be initialised', function (done) {\n    index.init(runtime);\n    index.loadFlows().then(function () {\n      // console.log(testFlows);\n      // console.log(index.getFlows());\n      should.deepEqual(testFlows, index.getFlows().flows);\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"called without node-set name","suites":["red/nodes/index","registerType","logs deprecated usage"],"updatePoint":{"line":130,"column":38,"index":3728},"line":130,"code":"      it(\"called without node-set name\", function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: sinon.spy()\n          },\n          events: new EventEmitter()\n        };\n        index.init(runtime);\n        index.registerType( /*'test-node-set',*/'test', TestNode, {});\n        runtime.log.warn.called.should.be.true();\n        registry.registerType.called.should.be.true();\n        registry.registerType.firstCall.args[0].should.eql('');\n        registry.registerType.firstCall.args[1].should.eql('test');\n        registry.registerType.firstCall.args[2].should.eql(TestNode);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"extends a constructor with the Node constructor","suites":["red/nodes/index","registerType","extends constructor with Node constructor"],"updatePoint":{"line":170,"column":57,"index":5075},"line":170,"code":"      it('extends a constructor with the Node constructor', function () {\n        TestNodeConstructor.prototype.should.not.be.an.instanceOf(Node);\n        index.registerType('node-set', 'node-type', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"does not override a constructor prototype","suites":["red/nodes/index","registerType","extends constructor with Node constructor"],"updatePoint":{"line":175,"column":51,"index":5369},"line":175,"code":"      it('does not override a constructor prototype', function () {\n        function Foo() {}\n        ;\n        inherits(TestNodeConstructor, Foo);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n        TestNodeConstructor.prototype.should.not.be.an.instanceOf(Node);\n        index.registerType('node-set', 'node-type', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n        index.registerType('node-set', 'node-type2', TestNodeConstructor);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Node);\n        TestNodeConstructor.prototype.should.be.an.instanceOf(Foo);\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"definition defined","suites":["red/nodes/index","registerType","register credentials definition"],"updatePoint":{"line":239,"column":28,"index":7930},"line":239,"code":"      it('definition defined', function () {\n        index.registerType('test-node-set', 'test', TestNode, {\n          credentials: {\n            foo: {\n              type: \"test\"\n            }\n          }\n        });\n        var testnode = new TestNode({\n          id: 'tab1',\n          type: 'test',\n          name: 'barney',\n          '_alias': 'tab1'\n        });\n        index.getCredentialDefinition(\"test\").should.have.property('foo');\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"registers valid settings","suites":["red/nodes/index","registerType","register settings definition"],"updatePoint":{"line":263,"column":34,"index":8623},"line":263,"code":"      it('registers valid settings', function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: function () {}\n          },\n          events: new EventEmitter()\n        };\n        runtime.settings.registerNodeSettings = sinon.spy();\n        index.init(runtime);\n        index.registerType('test-node-set', 'test', TestNode, {\n          settings: {\n            testOne: {}\n          }\n        });\n        runtime.settings.registerNodeSettings.called.should.be.true();\n        runtime.settings.registerNodeSettings.firstCall.args[0].should.eql('test');\n        runtime.settings.registerNodeSettings.firstCall.args[1].should.eql({\n          testOne: {}\n        });\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"logs invalid settings","suites":["red/nodes/index","registerType","register settings definition"],"updatePoint":{"line":286,"column":31,"index":9399},"line":286,"code":"      it('logs invalid settings', function () {\n        var runtime = {\n          settings: settings,\n          storage: storage,\n          log: {\n            debug: function () {},\n            warn: sinon.spy()\n          },\n          events: new EventEmitter()\n        };\n        runtime.settings.registerNodeSettings = function () {\n          throw new Error(\"pass\");\n        };\n        index.init(runtime);\n        index.registerType('test-node-set', 'test', TestNode, {\n          settings: {\n            testOne: {}\n          }\n        });\n        runtime.log.warn.called.should.be.true();\n      });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"allows an unused node type to be disabled","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":335,"column":49,"index":10798},"line":335,"code":"    it('allows an unused node type to be disabled', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        return index.disableNode(\"5678\").then(function (info) {\n          registry.disableNode.calledOnce.should.be.true();\n          registry.disableNode.calledWith(\"5678\").should.be.true();\n          info.should.eql(randomNodeInfo);\n          done();\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents disabling a node type that is in use","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":349,"column":53,"index":11337},"line":349,"code":"    it('prevents disabling a node type that is in use', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.disabledNode(\"test\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents disabling a node type that is unknown","suites":["red/nodes/index","allows nodes to be added/removed/enabled/disabled from the registry"],"updatePoint":{"line":362,"column":54,"index":11749},"line":362,"code":"    it('prevents disabling a node type that is unknown', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.disableNode(\"doesnotexist\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents removing a module that is in use","suites":["red/nodes/index","allows modules to be removed from the registry"],"updatePoint":{"line":420,"column":49,"index":13373},"line":420,"code":"    it('prevents removing a module that is in use', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.removeModule(\"node-red\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"prevents removing a module that is unknown","suites":["red/nodes/index","allows modules to be removed from the registry"],"updatePoint":{"line":433,"column":50,"index":13785},"line":433,"code":"    it('prevents removing a module that is unknown', function (done) {\n      index.init(runtime);\n      index.registerType('test-node-set', 'test', TestNode);\n      index.loadFlows().then(function () {\n        /*jshint immed: false */\n        (function () {\n          index.removeModule(\"doesnotexist\");\n        }).should.throw();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/index_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id and a type","suites":["Node","#constructor"],"updatePoint":{"line":26,"column":39,"index":1113},"line":26,"code":"    it('is called with an id and a type', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.not.have.property('name');\n      n.wires.should.be.empty();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id, a type and a name","suites":["Node","#constructor"],"updatePoint":{"line":36,"column":47,"index":1425},"line":36,"code":"    it('is called with an id, a type and a name', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        name: 'barney'\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.have.property('name', 'barney');\n      n.wires.should.be.empty();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"is called with an id, a type and some wires","suites":["Node","#constructor"],"updatePoint":{"line":47,"column":51,"index":1771},"line":47,"code":"    it('is called with an id, a type and some wires', function () {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        wires: ['123', '456']\n      });\n      n.should.have.property('id', '123');\n      n.should.have.property('type', 'abc');\n      n.should.not.have.property('name');\n      n.wires.should.have.length(2);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits close event when closed","suites":["Node","#close"],"updatePoint":{"line":60,"column":37,"index":2149},"line":60,"code":"    it('emits close event when closed', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('close', function () {\n        done();\n      });\n      n.close();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns a promise when provided a callback with a done parameter","suites":["Node","#close"],"updatePoint":{"line":70,"column":72,"index":2404},"line":70,"code":"    it('returns a promise when provided a callback with a done parameter', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('close', function (done) {\n        setTimeout(function () {\n          done();\n        }, 50);\n      });\n      var p = n.close();\n      should.exist(p);\n      p.then(function () {\n        testdone();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"accepts a callback with \"removed\" and \"done\" parameters","suites":["Node","#close"],"updatePoint":{"line":86,"column":63,"index":2797},"line":86,"code":"    it('accepts a callback with \"removed\" and \"done\" parameters', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var receivedRemoved;\n      n.on('close', function (removed, done) {\n        receivedRemoved = removed;\n        setTimeout(function () {\n          done();\n        }, 50);\n      });\n      var p = n.close(true);\n      should.exist(p);\n      receivedRemoved.should.be.true();\n      p.then(function () {\n        testdone();\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"allows multiple close handlers to be registered","suites":["Node","#close"],"updatePoint":{"line":105,"column":55,"index":3297},"line":105,"code":"    it('allows multiple close handlers to be registered', function (testdone) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var callbacksClosed = 0;\n      n.on('close', function (done) {\n        setTimeout(function () {\n          callbacksClosed++;\n          done();\n        }, 50);\n      });\n      n.on('close', function (done) {\n        setTimeout(function () {\n          callbacksClosed++;\n          done();\n        }, 75);\n      });\n      n.on('close', function () {\n        callbacksClosed++;\n      });\n      var p = n.close();\n      should.exist(p);\n      p.then(function () {\n        callbacksClosed.should.eql(3);\n        testdone();\n      }).catch(function (e) {\n        testdone(e);\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits input event when called","suites":["Node","#receive"],"updatePoint":{"line":137,"column":37,"index":4072},"line":137,"code":"    it('emits input event when called', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        should.deepEqual(msg, message);\n        done();\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"writes metric info with undefined msg","suites":["Node","#receive"],"updatePoint":{"line":151,"column":45,"index":4414},"line":151,"code":"    it('writes metric info with undefined msg', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('input', function (msg) {\n        (typeof msg).should.not.be.equal(\"undefined\");\n        (typeof msg._msgid).should.not.be.equal(\"undefined\");\n        done();\n      });\n      n.receive();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"writes metric info with null msg","suites":["Node","#receive"],"updatePoint":{"line":163,"column":40,"index":4759},"line":163,"code":"    it('writes metric info with null msg', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      n.on('input', function (msg) {\n        (typeof msg).should.not.be.equal(\"undefined\");\n        (typeof msg._msgid).should.not.be.equal(\"undefined\");\n        done();\n      });\n      n.receive(null);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"handles thrown errors","suites":["Node","#receive"],"updatePoint":{"line":175,"column":29,"index":5097},"line":175,"code":"    it('handles thrown errors', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      sinon.stub(n, \"error\").callsFake(function (err, msg) {});\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        throw new Error(\"test error\");\n      });\n      n.receive(message);\n      setTimeout(function () {\n        n.error.called.should.be.true();\n        n.error.firstCall.args[1].should.equal(message);\n        done();\n      }, 50);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"calls parent flow handleComplete when callback provided","suites":["Node","#receive"],"updatePoint":{"line":194,"column":63,"index":5663},"line":194,"code":"    it('calls parent flow handleComplete when callback provided', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            try {\n              msg.should.deepEqual(message);\n              done();\n            } catch (err) {\n              done(err);\n            }\n          }\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone();\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers onComplete hook when done callback provided","suites":["Node","#receive"],"updatePoint":{"line":217,"column":60,"index":6245},"line":217,"code":"    it('triggers onComplete hook when done callback provided', function (done) {\n      var handleCompleteCalled = false;\n      var hookCalled = false;\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            handleCompleteCalled = true;\n          }\n        }\n      });\n      var hookError;\n      hooks.add(\"onComplete\", function (completeEvent) {\n        hookCalled = true;\n        try {\n          handleCompleteCalled.should.be.false(\"onComplete should be called before handleComplete\");\n          should.not.exist(completeEvent.error);\n          completeEvent.msg.should.deepEqual(message);\n          completeEvent.node.id.should.eql(\"123\");\n          completeEvent.node.node.should.equal(n);\n        } catch (err) {\n          hookError = err;\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone();\n      });\n      n.receive(message);\n      setTimeout(function () {\n        if (hookError) {\n          done(hookError);\n          return;\n        }\n        try {\n          hookCalled.should.be.true(\"onComplete hook should be called\");\n          handleCompleteCalled.should.be.true(\"handleComplete should be called\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers onComplete hook when done callback provided - with error","suites":["Node","#receive"],"updatePoint":{"line":263,"column":73,"index":7659},"line":263,"code":"    it('triggers onComplete hook when done callback provided - with error', function (done) {\n      var handleCompleteCalled = false;\n      var hookCalled = false;\n      var errorReported = false;\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        _flow: {\n          handleComplete: function (node, msg) {\n            handleCompleteCalled = true;\n          }\n        }\n      });\n      var hookError;\n      hooks.add(\"onComplete\", function (completeEvent) {\n        hookCalled = true;\n        try {\n          handleCompleteCalled.should.be.false(\"onComplete should be called before handleComplete\");\n          should.exist(completeEvent.error);\n          completeEvent.error.toString().should.equal(\"Error: test error\");\n          completeEvent.msg.should.deepEqual(message);\n          completeEvent.node.id.should.eql(\"123\");\n          completeEvent.node.node.should.equal(n);\n        } catch (err) {\n          hookError = err;\n        }\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone(new Error(\"test error\"));\n      });\n      n.error = function (err, msg) {\n        errorReported = true;\n      };\n      n.receive(message);\n      setTimeout(function () {\n        if (hookError) {\n          done(hookError);\n          return;\n        }\n        try {\n          hookCalled.should.be.true(\"onComplete hook should be called\");\n          handleCompleteCalled.should.be.false(\"handleComplete should not be called\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"logs error if callback provides error","suites":["Node","#receive"],"updatePoint":{"line":314,"column":45,"index":9255},"line":314,"code":"    it('logs error if callback provides error', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      sinon.stub(n, \"error\").callsFake(function (err, msg) {});\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg, nodeSend, nodeDone) {\n        nodeDone(new Error(\"test error\"));\n        setTimeout(function () {\n          try {\n            n.error.called.should.be.true();\n            n.error.firstCall.args[0].toString().should.equal(\"Error: test error\");\n            n.error.firstCall.args[1].should.equal(message);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }, 50);\n      });\n      n.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"triggers hooks when receiving a message","suites":["Node","#receive"],"updatePoint":{"line":338,"column":47,"index":10006},"line":338,"code":"    it(\"triggers hooks when receiving a message\", function (done) {\n      var hookErrors = [];\n      var messageReceived = false;\n      var hooksCalled = [];\n      hooks.add(\"onReceive\", function (receiveEvent) {\n        hooksCalled.push(\"onReceive\");\n        try {\n          messageReceived.should.be.false(\"Message should not have been received before onReceive\");\n          receiveEvent.msg.should.be.exactly(message);\n          receiveEvent.destination.id.should.equal(\"123\");\n          receiveEvent.destination.node.should.equal(n);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      hooks.add(\"postReceive\", function (receiveEvent) {\n        hooksCalled.push(\"postReceive\");\n        try {\n          messageReceived.should.be.true(\"Message should have been received before postReceive\");\n          receiveEvent.msg.should.be.exactly(message);\n          receiveEvent.destination.id.should.equal(\"123\");\n          receiveEvent.destination.node.should.equal(n);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n.on('input', function (msg) {\n        messageReceived = true;\n        try {\n          should.strictEqual(this, n);\n          hooksCalled.should.eql([\"onReceive\"]);\n          should.deepEqual(msg, message);\n        } catch (err) {\n          hookErrors.push(err);\n        }\n      });\n      n.receive(message);\n      setTimeout(function () {\n        hooks.clear();\n        if (hookErrors.length > 0) {\n          done(hookErrors[0]);\n        } else {\n          done();\n        }\n      }, 10);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"onReceive","suites":["Node","#receive","errors thrown by hooks are reported"],"updatePoint":{"line":435,"column":19,"index":13090},"line":435,"code":"      it(\"onReceive\", function (done) {\n        testHook(\"onReceive\", false, done);\n      });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"postReceive","suites":["Node","#receive","errors thrown by hooks are reported"],"updatePoint":{"line":438,"column":21,"index":13186},"line":438,"code":"      it(\"postReceive\", function (done) {\n        testHook(\"postReceive\", true, done);\n      });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"onReceive","suites":["Node","hooks can halt receive"],"updatePoint":{"line":481,"column":17,"index":14329},"line":481,"code":"    it(\"onReceive\", function (done) {\n      testHook(\"onReceive\", false, done);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits a single message","suites":["Node","#send"],"updatePoint":{"line":486,"column":30,"index":14470},"line":486,"code":"    it('emits a single message', function (done) {\n      var flow = {\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(1);\n            sendEvents[0].msg.should.equal(message);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n1.send(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits a message with callback provided send","suites":["Node","#send"],"updatePoint":{"line":518,"column":51,"index":15276},"line":518,"code":"    it('emits a message with callback provided send', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        handleComplete: (node, msg) => {},\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(1);\n            sendEvents[0].msg.should.equal(message);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var message = {\n        payload: \"hello world\"\n      };\n      n1.on('input', function (msg, nodeSend, nodeDone) {\n        nodeSend(msg);\n        nodeDone();\n      });\n      n1.receive(message);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits multiple messages on a single output","suites":["Node","#send"],"updatePoint":{"line":559,"column":50,"index":16400},"line":559,"code":"    it('emits multiple messages on a single output', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(2);\n            sendEvents[0].msg.should.equal(messages[0]);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            sendEvents[1].msg.should.equal(messages[1]);\n            sendEvents[1].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[1].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[1].cloneMessage.should.be.true();\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var messages = [{\n        payload: \"hello world\"\n      }, {\n        payload: \"hello world again\"\n      }];\n      n1.send([messages]);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits messages to multiple outputs","suites":["Node","#send"],"updatePoint":{"line":608,"column":42,"index":17784},"line":608,"code":"    it('emits messages to multiple outputs', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        send: sendEvents => {\n          try {\n            sendEvents.should.have.length(3);\n            sendEvents[0].msg.should.equal(messages[0]);\n            sendEvents[0].destination.should.eql({\n              id: \"n2\",\n              node: undefined\n            });\n            sendEvents[0].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 0\n            });\n            sendEvents[0].cloneMessage.should.be.false();\n            should.exist(sendEvents[0].msg._msgid);\n            sendEvents[1].msg.should.equal(messages[2]);\n            sendEvents[1].destination.should.eql({\n              id: \"n4\",\n              node: undefined\n            });\n            sendEvents[1].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 2\n            });\n            sendEvents[1].cloneMessage.should.be.true();\n            should.exist(sendEvents[1].msg._msgid);\n            sendEvents[2].msg.should.equal(messages[2]);\n            sendEvents[2].destination.should.eql({\n              id: \"n5\",\n              node: undefined\n            });\n            sendEvents[2].source.should.eql({\n              id: \"n1\",\n              node: n1,\n              port: 2\n            });\n            sendEvents[2].cloneMessage.should.be.true();\n            should.exist(sendEvents[2].msg._msgid);\n            sendEvents[0].msg._msgid.should.eql(sendEvents[1].msg._msgid);\n            sendEvents[1].msg._msgid.should.eql(sendEvents[2].msg._msgid);\n            done();\n          } catch (err) {\n            done(err);\n          }\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2'], ['n3'], ['n4', 'n5']]\n      });\n      var n2 = new RedNode({\n        _flow: flow,\n        id: 'n2',\n        type: 'abc'\n      });\n      var n3 = new RedNode({\n        _flow: flow,\n        id: 'n3',\n        type: 'abc'\n      });\n      var n4 = new RedNode({\n        _flow: flow,\n        id: 'n4',\n        type: 'abc'\n      });\n      var n5 = new RedNode({\n        _flow: flow,\n        id: 'n5',\n        type: 'abc'\n      });\n      var messages = [{\n        payload: \"hello world\"\n      }, null, {\n        payload: \"hello world again\"\n      }];\n      var rcvdCount = 0;\n      n1.send(messages);\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"emits no messages","suites":["Node","#send"],"updatePoint":{"line":694,"column":25,"index":20267},"line":694,"code":"    it('emits no messages', function (done) {\n      var flow = {\n        handleError: (node, logMessage, msg, reportingNode) => {\n          done(logMessage);\n        },\n        getNode: id => {\n          return {\n            'n1': n1,\n            'n2': n2\n          }[id];\n        }\n      };\n      var n1 = new RedNode({\n        _flow: flow,\n        id: 'n1',\n        type: 'abc',\n        wires: [['n2']]\n      });\n      var n2 = new RedNode({\n        _flow: flow,\n        id: 'n2',\n        type: 'abc'\n      });\n      n2.on('input', function (msg) {\n        should.fail(null, null, \"unexpected message\");\n      });\n      setTimeout(function () {\n        done();\n      }, 200);\n      n1.send();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a log message","suites":["Node","#log"],"updatePoint":{"line":808,"column":30,"index":24361},"line":808,"code":"    it('produces a log message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.log(\"a log message\");\n      should.deepEqual({\n        level: Log.INFO,\n        id: n.id,\n        type: n.type,\n        msg: \"a log message\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a log message with a name","suites":["Node","#log"],"updatePoint":{"line":830,"column":42,"index":24850},"line":830,"code":"    it('produces a log message with a name', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        name: \"barney\",\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.log(\"a log message\");\n      should.deepEqual({\n        level: Log.INFO,\n        id: n.id,\n        name: \"barney\",\n        type: n.type,\n        msg: \"a log message\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a warning message","suites":["Node","#warn"],"updatePoint":{"line":856,"column":34,"index":25419},"line":856,"code":"    it('produces a warning message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc',\n        z: '789',\n        _flow: {\n          log: function (msg) {\n            loginfo = msg;\n          }\n        }\n      });\n      var loginfo = {};\n      n.warn(\"a warning\");\n      should.deepEqual({\n        level: Log.WARN,\n        id: n.id,\n        type: n.type,\n        msg: \"a warning\",\n        z: '789'\n      }, loginfo);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"handles a null error message","suites":["Node","#error"],"updatePoint":{"line":880,"column":36,"index":25936},"line":880,"code":"    it('handles a null error message', function (done) {\n      var flow = {\n        handleError: sinon.stub(),\n        log: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc',\n        z: '789'\n      });\n      var message = {\n        a: 1\n      };\n      n.error(null, message);\n      flow.handleError.called.should.be.true();\n      flow.handleError.args[0][0].should.eql(n);\n      flow.handleError.args[0][1].should.eql(\"\");\n      flow.handleError.args[0][2].should.eql(message);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces an error message","suites":["Node","#error"],"updatePoint":{"line":901,"column":33,"index":26493},"line":901,"code":"    it('produces an error message', function (done) {\n      var flow = {\n        handleError: sinon.stub(),\n        log: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc',\n        z: '789'\n      });\n      var message = {\n        a: 2\n      };\n      n.error(\"This is an error\", message);\n      flow.handleError.called.should.be.true();\n      flow.handleError.args[0][0].should.eql(n);\n      flow.handleError.args[0][1].should.eql(\"This is an error\");\n      flow.handleError.args[0][2].should.eql(message);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"produces a metric message","suites":["Node","#metric"],"updatePoint":{"line":924,"column":33,"index":27122},"line":924,"code":"    it('produces a metric message', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      n.metric(\"test.metric\", msg, \"15mb\");\n      should.deepEqual({\n        value: \"15mb\",\n        level: Log.METRIC,\n        nodeid: n.id,\n        event: \"node.abc.test.metric\",\n        msgid: \"987654321\"\n      }, loginfo);\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns metric value if eventname undefined","suites":["Node","#metric"],"updatePoint":{"line":950,"column":51,"index":27778},"line":950,"code":"    it('returns metric value if eventname undefined', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      var m = n.metric(undefined, msg, \"15mb\");\n      m.should.be.a.Boolean();\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"returns not defined if eventname defined","suites":["Node","#metric"],"updatePoint":{"line":968,"column":48,"index":28242},"line":968,"code":"    it('returns not defined if eventname defined', function (done) {\n      var n = new RedNode({\n        id: '123',\n        type: 'abc'\n      });\n      var loginfo = {};\n      sinon.stub(Log, 'log').callsFake(function (msg) {\n        loginfo = msg;\n      });\n      var msg = {\n        payload: \"foo\",\n        _msgid: \"987654321\"\n      };\n      var m = n.metric(\"info\", msg, \"15mb\");\n      should(m).be.undefined;\n      Log.log.restore();\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status","suites":["Node","#status"],"updatePoint":{"line":988,"column":24,"index":28720},"line":988,"code":"    it('publishes status', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      var status = {\n        fill: \"green\",\n        shape: \"dot\",\n        text: \"connected\"\n      };\n      n.status(status);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql(status);\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain string","suites":["Node","#status"],"updatePoint":{"line":1008,"column":41,"index":29244},"line":1008,"code":"    it('publishes status for plain string', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(\"text status\");\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"text status\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain boolean","suites":["Node","#status"],"updatePoint":{"line":1025,"column":42,"index":29706},"line":1025,"code":"    it('publishes status for plain boolean', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(false);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"false\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"publishes status for plain number","suites":["Node","#status"],"updatePoint":{"line":1042,"column":41,"index":30153},"line":1042,"code":"    it('publishes status for plain number', function (done) {\n      var flow = {\n        handleStatus: sinon.stub()\n      };\n      var n = new RedNode({\n        _flow: flow,\n        id: '123',\n        type: 'abc'\n      });\n      n.status(123);\n      flow.handleStatus.called.should.be.true();\n      flow.handleStatus.args[0][0].should.eql(n);\n      flow.handleStatus.args[0][1].should.eql({\n        text: \"123\"\n      });\n      done();\n    });","file":"unit/@node-red/runtime/lib/nodes/Node_spec.js","skipped":false,"dir":"test"},{"name":"delegates all functions to registry module","suites":["runtime/plugins"],"line":6,"code":"  it.skip(\"delegates all functions to registry module\", function () {","file":"unit/@node-red/runtime/lib/plugins_spec.js","skipped":true,"dir":"test"},{"name":"wraps the user settings as read-only properties","suites":["runtime/settings"],"updatePoint":{"line":23,"column":53,"index":936},"line":23,"code":"  it('wraps the user settings as read-only properties', function () {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n    settings.a.should.equal(123);\n    settings.b.should.equal(\"test\");\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(3);\n    settings.get(\"a\").should.equal(123);\n    settings.get(\"b\").should.equal(\"test\");\n    settings.get(\"c\").should.be.an.Array();\n    settings.get(\"c\").should.have.lengthOf(3);\n\n    /*jshint immed: false */\n    (function () {\n      settings.a = 456;\n    }).should.throw();\n    settings.c.push(5);\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(4);\n\n    /*jshint immed: false */\n    (function () {\n      settings.set(\"a\", 456);\n    }).should.throw();\n\n    /*jshint immed: false */\n    (function () {\n      settings.set(\"a\", 456);\n    }).should.throw();\n\n    /*jshint immed: false */\n    (function () {\n      settings.get(\"unknown\");\n    }).should.throw();\n\n    /*jshint immed: false */\n    (function () {\n      settings.set(\"unknown\", 456);\n    }).should.throw();\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"loads global settings from storage","suites":["runtime/settings"],"updatePoint":{"line":68,"column":40,"index":2094},"line":68,"code":"  it('loads global settings from storage', function (done) {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    var savedSettings = null;\n    var saveCount = 0;\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          globalA: 789\n        });\n      },\n      saveSettings: function (settings) {\n        saveCount++;\n        savedSettings = settings;\n        return Promise.resolve();\n      }\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n\n    /*jshint immed: false */\n    (function () {\n      settings.get(\"unknown\");\n    }).should.throw();\n    settings.load(storage).then(function () {\n      settings.available().should.be.true();\n      settings.get(\"globalA\").should.equal(789);\n      settings.set(\"globalA\", \"abc\").then(function () {\n        savedSettings.globalA.should.equal(\"abc\");\n        saveCount.should.equal(1);\n        settings.set(\"globalA\", \"abc\").then(function () {\n          savedSettings.globalA.should.equal(\"abc\");\n          // setting to existing value should not trigger save\n          saveCount.should.equal(1);\n          done();\n        });\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"removes persistent settings when reset","suites":["runtime/settings"],"updatePoint":{"line":112,"column":44,"index":3344},"line":112,"code":"  it('removes persistent settings when reset', function () {\n    var userSettings = {\n      a: 123,\n      b: \"test\",\n      c: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.available().should.be.false();\n    settings.should.have.property(\"a\", 123);\n    settings.should.have.property(\"b\", \"test\");\n    settings.c.should.be.an.Array();\n    settings.c.should.have.lengthOf(3);\n    settings.reset();\n    settings.should.not.have.property(\"a\");\n    settings.should.not.have.property(\"d\");\n    settings.should.not.have.property(\"c\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"registers node settings and exports them","suites":["runtime/settings"],"updatePoint":{"line":129,"column":46,"index":3896},"line":129,"code":"  it('registers node settings and exports them', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      },\n      injectSize: {\n        value: \"100\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mqtt\", {\n      mqttColor: {\n        value: \"purple\",\n        exportable: false\n      },\n      mqttSize: {\n        value: \"50\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"http request\", {\n      httpRequest1: {\n        value: \"a1\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"  http--request<> \", {\n      httpRequest2: {\n        value: \"a2\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"_http_request_\", {\n      httpRequest3: {\n        value: \"a3\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mQtT\", {\n      mQtTColor: {\n        value: \"purple\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"abc123\", {\n      abc123: {\n        value: \"def456\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"noValue\", {\n      noValueHasValue: {\n        value: \"123\",\n        exportable: true\n      },\n      noValueNoValue: {\n        exportable: true\n      }\n    });\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.have.property(\"injectSize\", \"100\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"mqttSize\", \"50\");\n    safeSettings.should.have.property(\"httpRequest1\", \"a1\");\n    safeSettings.should.have.property(\"httpRequest2\", \"a2\");\n    safeSettings.should.have.property(\"httpRequest3\", \"a3\");\n    safeSettings.should.have.property(\"mQtTColor\", \"purple\");\n    safeSettings.should.have.property(\"abc123\", \"def456\");\n    safeSettings.should.have.property(\"noValueHasValue\", \"123\");\n    safeSettings.should.not.have.property(\"noValueNoValue\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"prohibits registering the property whose name do not start with type name","suites":["runtime/settings"],"updatePoint":{"line":205,"column":79,"index":6071},"line":205,"code":"  it('prohibits registering the property whose name do not start with type name', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    (function () {\n      settings.registerNodeSettings(\"inject\", {\n        color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"_a_b_1_\", {\n        ab1Color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"AB2\", {\n        AB2Color: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    (function () {\n      settings.registerNodeSettings(\"abcDef\", {\n        abcColor: {\n          value: \"red\",\n          exportable: true\n        }\n      });\n    }).should.throw();\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.not.have.property(\"color\");\n    safeSettings.should.not.have.property(\"ab1Color\", \"blue\");\n    safeSettings.should.not.have.property(\"AB2Color\");\n    safeSettings.should.not.have.property(\"abcColor\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"overwrites node settings with user settings","suites":["runtime/settings"],"updatePoint":{"line":247,"column":49,"index":7221},"line":247,"code":"  it('overwrites node settings with user settings', function () {\n    var userSettings = {\n      injectColor: \"green\",\n      mqttColor: \"yellow\",\n      abColor: [1, 2, 3]\n    };\n    settings.init(userSettings);\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"ab\", {\n      abColor: {\n        value: \"red\",\n        exportable: false\n      }\n    });\n    var safeSettings = {};\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"green\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.not.have.property(\"abColor\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"disables/enables node settings","suites":["runtime/settings"],"updatePoint":{"line":272,"column":36,"index":7925},"line":272,"code":"  it('disables/enables node settings', function () {\n    var userSettings = {};\n    settings.init(userSettings);\n    var safeSettings = {};\n    settings.registerNodeSettings(\"inject\", {\n      injectColor: {\n        value: \"red\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"mqtt\", {\n      mqttColor: {\n        value: \"purple\",\n        exportable: true\n      }\n    });\n    settings.registerNodeSettings(\"http request\", {\n      httpRequestColor: {\n        value: \"yellow\",\n        exportable: true\n      }\n    });\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.have.property(\"mqttColor\", \"purple\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n    safeSettings = {};\n    var types = [\"inject\", \"mqtt\"];\n    settings.disableNodeSettings(types);\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.not.have.property(\"injectColor\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n    safeSettings = {};\n    types = [\"inject\"];\n    settings.enableNodeSettings(types);\n    settings.exportNodeSettings(safeSettings);\n    safeSettings.should.have.property(\"injectColor\", \"red\");\n    safeSettings.should.not.have.property(\"mqttColor\");\n    safeSettings.should.have.property(\"httpRequestColor\", \"yellow\");\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"delete global setting","suites":["runtime/settings"],"updatePoint":{"line":313,"column":27,"index":9354},"line":313,"code":"  it('delete global setting', function () {\n    // read-only\n    var localSettings = {\n      a: 1\n    };\n    // read-write\n    var globalSettings = {\n      b: 2\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve(globalSettings);\n      },\n      saveSettings: function () {\n        return Promise.resolve();\n      }\n    };\n    settings.init(localSettings);\n    return settings.load(storage).then(function () {\n      settings.get('a').should.eql(1);\n      settings.get('b').should.eql(2);\n      return settings.delete('b');\n    }).then(function () {\n      should.not.exist(settings.get('b'));\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"refused to delete local setting","suites":["runtime/settings"],"updatePoint":{"line":339,"column":37,"index":10008},"line":339,"code":"  it('refused to delete local setting', function (done) {\n    // read-only\n    var localSettings = {\n      a: 1\n    };\n    // read-write\n    var globalSettings = {\n      b: 2\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve(globalSettings);\n      }\n    };\n    settings.init(localSettings);\n    settings.load(storage).then(function () {\n      settings.get('a').should.eql(1);\n      settings.get('b').should.eql(2);\n      try {\n        settings.delete('a');\n        return done(\"Did not throw error\");\n      } catch (err) {\n        // expected\n      }\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"get user settings","suites":["runtime/settings"],"updatePoint":{"line":366,"column":23,"index":10626},"line":366,"code":"  it('get user settings', function () {\n    var userSettings = {\n      admin: {\n        a: 1\n      }\n    };\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          a: 1,\n          users: userSettings\n        });\n      }\n    };\n    settings.init(userSettings);\n    return settings.load(storage).then(function () {\n      var result = settings.getUserSettings('admin');\n      result.should.eql(userSettings.admin);\n      // Check it has been cloned\n      result.should.not.equal(userSettings.admin);\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"set user settings","suites":["runtime/settings"],"updatePoint":{"line":388,"column":23,"index":11177},"line":388,"code":"  it('set user settings', function () {\n    var userSettings = {\n      admin: {\n        a: 1\n      }\n    };\n    var savedSettings;\n    var storage = {\n      getSettings: function () {\n        return Promise.resolve({\n          c: 3,\n          users: userSettings\n        });\n      },\n      saveSettings: function (s) {\n        savedSettings = s;\n        return Promise.resolve();\n      }\n    };\n    settings.init(userSettings);\n    return settings.load(storage).then(function () {\n      return settings.setUserSettings('admin', {\n        b: 2\n      });\n    }).then(function () {\n      savedSettings.should.have.property(\"c\", 3);\n      savedSettings.should.have.property('users');\n      savedSettings.users.should.eql({\n        admin: {\n          b: 2\n        }\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/settings_spec.js","skipped":false,"dir":"test"},{"name":"rejects the promise when settings suggest loading a bad module","suites":["red/storage/index"],"updatePoint":{"line":21,"column":68,"index":930},"line":21,"code":"  it('rejects the promise when settings suggest loading a bad module', function (done) {\n    var wrongModule = {\n      settings: {\n        storageModule: \"thisaintloading\"\n      }\n    };\n    storage.init(wrongModule).then(function () {\n      var one = 1;\n      var zero = 0;\n      try {\n        zero.should.equal(one, \"The initialization promise should never get resolved\");\n      } catch (err) {\n        done(err);\n      }\n    }).catch(function (e) {\n      done(); //successfully rejected promise\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"non-string storage module","suites":["red/storage/index"],"updatePoint":{"line":40,"column":31,"index":1406},"line":40,"code":"  it('non-string storage module', function (done) {\n    var initSetsMeToTrue = false;\n    var moduleWithBooleanSettingInit = {\n      init: function () {\n        initSetsMeToTrue = true;\n      }\n    };\n    var setsBooleanModule = {\n      settings: {\n        storageModule: moduleWithBooleanSettingInit\n      }\n    };\n    storage.init(setsBooleanModule);\n    initSetsMeToTrue.should.be.true();\n    done();\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"respects storage interface","suites":["red/storage/index"],"updatePoint":{"line":56,"column":32,"index":1817},"line":56,"code":"  it('respects storage interface', function (done) {\n    var calledFlagGetFlows = false;\n    var calledFlagGetCredentials = false;\n    var calledFlagGetAllFlows = false;\n    var calledInit = false;\n    var calledFlagGetSettings = false;\n    var calledFlagGetSessions = false;\n    var interfaceCheckerModule = {\n      init: function (settings) {\n        settings.should.be.an.Object();\n        calledInit = true;\n      },\n      getFlows: function () {\n        calledFlagGetFlows = true;\n        return Promise.resolve([]);\n      },\n      saveFlows: function (flows) {\n        flows.should.be.an.Array();\n        flows.should.have.lengthOf(0);\n        return Promise.resolve(\"\");\n      },\n      getCredentials: function () {\n        calledFlagGetCredentials = true;\n        return Promise.resolve({});\n      },\n      saveCredentials: function (credentials) {\n        credentials.should.be.true();\n      },\n      getSettings: function () {\n        calledFlagGetSettings = true;\n      },\n      saveSettings: function (settings) {\n        settings.should.be.true();\n      },\n      getSessions: function () {\n        calledFlagGetSessions = true;\n      },\n      saveSessions: function (sessions) {\n        sessions.should.be.true();\n      },\n      getAllFlows: function () {\n        calledFlagGetAllFlows = true;\n      },\n      getFlow: function (fn) {\n        fn.should.equal(\"name\");\n      },\n      saveFlow: function (fn, data) {\n        fn.should.equal(\"name\");\n        data.should.be.true();\n      },\n      getLibraryEntry: function (type, path) {\n        type.should.be.true();\n        path.should.equal(\"name\");\n      },\n      saveLibraryEntry: function (type, path, meta, body) {\n        type.should.be.true();\n        path.should.equal(\"name\");\n        meta.should.be.true();\n        body.should.be.true();\n      }\n    };\n    var moduleToLoad = {\n      settings: {\n        storageModule: interfaceCheckerModule\n      }\n    };\n    var promises = [];\n    storage.init(moduleToLoad);\n    promises.push(storage.getFlows());\n    promises.push(storage.saveFlows({\n      flows: [],\n      credentials: {}\n    }));\n    storage.getSettings();\n    storage.saveSettings(true);\n    storage.getSessions();\n    storage.saveSessions(true);\n    storage.getAllFlows();\n    storage.getFlow(\"name\");\n    storage.saveFlow(\"name\", true);\n    storage.getLibraryEntry(true, \"name\");\n    storage.saveLibraryEntry(true, \"name\", true, true);\n    Promise.all(promises).then(function () {\n      try {\n        calledInit.should.be.true();\n        calledFlagGetFlows.should.be.true();\n        calledFlagGetCredentials.should.be.true();\n        calledFlagGetAllFlows.should.be.true();\n        done();\n      } catch (err) {\n        done(err);\n      }\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"getAllFlows","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":190,"column":19,"index":5690},"line":190,"code":"    it('getAllFlows', function (done) {\n      storage.getAllFlows().then(function (res) {\n        try {\n          res.should.eql({\n            d: {\n              a: {\n                f: ['test2']\n              }\n            },\n            f: ['test']\n          });\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"getFlow","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":207,"column":15,"index":6042},"line":207,"code":"    it('getFlow', function (done) {\n      storage.getFlow(paff.join(\"a\", \"test2.json\")).then(function (res) {\n        try {\n          res.should.eql(\"test content\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"saveFlow","suites":["red/storage/index","respects deprecated flow library functions"],"updatePoint":{"line":217,"column":16,"index":6300},"line":217,"code":"    it('saveFlow', function (done) {\n      storage.saveFlow(paff.join(\"a\", \"test2.json\"), \"new content\").then(function (res) {\n        try {\n          savePath.should.eql(paff.join(\"a\", \"test2.json\"));\n          saveContent.should.eql(\"new content\");\n          saveMeta.should.eql({});\n          saveType.should.eql(\"flows\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing getSettings","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":242,"column":36,"index":7032},"line":242,"code":"    it('defaults missing getSettings', function (done) {\n      storage.getSettings().then(function (settings) {\n        should.not.exist(settings);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing saveSettings","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":248,"column":37,"index":7215},"line":248,"code":"    it('defaults missing saveSettings', function (done) {\n      storage.saveSettings({}).then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing getSessions","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":253,"column":36,"index":7356},"line":253,"code":"    it('defaults missing getSessions', function (done) {\n      storage.getSessions().then(function (settings) {\n        should.not.exist(settings);\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"defaults missing saveSessions","suites":["red/storage/index","handles missing settings/sessions interface"],"updatePoint":{"line":259,"column":37,"index":7539},"line":259,"code":"    it('defaults missing saveSessions', function (done) {\n      storage.saveSessions({}).then(function () {\n        done();\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/index_spec.js","skipped":false,"dir":"test"},{"name":"should initialise the user directory","suites":["storage/localfilesystem"],"updatePoint":{"line":50,"column":42,"index":1610},"line":50,"code":"  it('should initialise the user directory', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(path.join(userDir, \"lib\")).should.be.true();\n      fs.existsSync(path.join(userDir, \"lib\", 'flows')).should.be.true();\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to NRH if .config.json presents","suites":["storage/localfilesystem"],"updatePoint":{"line":64,"column":56,"index":2041},"line":64,"code":"  it('should set userDir to NRH if .config.json presents', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    fs.mkdirSync(process.env.NODE_RED_HOME);\n    fs.writeFileSync(path.join(process.env.NODE_RED_HOME, \".config.json\"), \"{}\", \"utf8\");\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.NODE_RED_HOME, \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.NODE_RED_HOME, \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(process.env.NODE_RED_HOME);\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to HOMEPATH/.node-red if .config.json presents","suites":["storage/localfilesystem"],"updatePoint":{"line":89,"column":71,"index":2961},"line":89,"code":"  it('should set userDir to HOMEPATH/.node-red if .config.json presents', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    fs.mkdirSync(process.env.HOMEPATH);\n    fs.mkdirSync(path.join(process.env.HOMEPATH, \".node-red\"));\n    fs.writeFileSync(path.join(process.env.HOMEPATH, \".node-red\", \".config.json\"), \"{}\", \"utf8\");\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.HOMEPATH, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.HOMEPATH, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.HOMEPATH, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.NODE_HOMEPATH = oldHOMEPATH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to HOME/.node-red","suites":["storage/localfilesystem"],"updatePoint":{"line":118,"column":42,"index":4106},"line":118,"code":"  it('should set userDir to HOME/.node-red', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOME = process.env.HOME;\n    process.env.HOME = path.join(userDir, \"HOME\");\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    fs.mkdirSync(process.env.HOME);\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.HOME, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.HOME, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.HOME, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOME = oldHOME;\n        process.env.HOMEPATH = oldHOMEPATH;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should set userDir to USERPROFILE/.node-red","suites":["storage/localfilesystem"],"updatePoint":{"line":148,"column":49,"index":5198},"line":148,"code":"  it('should set userDir to USERPROFILE/.node-red', function (done) {\n    var oldNRH = process.env.NODE_RED_HOME;\n    process.env.NODE_RED_HOME = path.join(userDir, \"NRH\");\n    var oldHOME = process.env.HOME;\n    process.env.HOME = \"\";\n    var oldHOMEPATH = process.env.HOMEPATH;\n    process.env.HOMEPATH = path.join(userDir, \"HOMEPATH\");\n    var oldUSERPROFILE = process.env.USERPROFILE;\n    process.env.USERPROFILE = path.join(userDir, \"USERPROFILE\");\n    fs.mkdirSync(process.env.USERPROFILE);\n    var settings = {\n      getUserSettings: () => {\n        {}\n      }\n    };\n    localfilesystem.init(settings, mockRuntime).then(function () {\n      try {\n        fs.existsSync(path.join(process.env.USERPROFILE, \".node-red\", \"lib\")).should.be.true();\n        fs.existsSync(path.join(process.env.USERPROFILE, \".node-red\", \"lib\", 'flows')).should.be.true();\n        settings.userDir.should.equal(path.join(process.env.USERPROFILE, \".node-red\"));\n        done();\n      } catch (err) {\n        done(err);\n      } finally {\n        process.env.NODE_RED_HOME = oldNRH;\n        process.env.HOME = oldHOME;\n        process.env.HOMEPATH = oldHOMEPATH;\n        process.env.USERPROFILE = oldUSERPROFILE;\n      }\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing flow file","suites":["storage/localfilesystem"],"updatePoint":{"line":181,"column":37,"index":6447},"line":181,"code":"  it('should handle missing flow file', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      fs.existsSync(flowFilePath).should.be.false();\n      localfilesystem.getFlows().then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty flow file, no backup","suites":["storage/localfilesystem"],"updatePoint":{"line":201,"column":46,"index":7055},"line":201,"code":"  it('should handle empty flow file, no backup', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.closeSync(fs.openSync(flowFilePath, 'w'));\n      fs.existsSync(flowFilePath).should.be.true();\n      localfilesystem.getFlows().then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle empty flow file, restores backup","suites":["storage/localfilesystem"],"updatePoint":{"line":223,"column":52,"index":7799},"line":223,"code":"  it('should handle empty flow file, restores backup', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.closeSync(fs.openSync(flowFilePath, 'w'));\n      fs.existsSync(flowFilePath).should.be.true();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      fs.writeFileSync(flowFileBackupPath, JSON.stringify(testFlow));\n      fs.existsSync(flowFileBackupPath).should.be.true();\n      setTimeout(function () {\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }, 50);\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should save flows to the default file","suites":["storage/localfilesystem"],"updatePoint":{"line":250,"column":43,"index":8784},"line":250,"code":"  it('should save flows to the default file', function (done) {\n    localfilesystem.init({\n      userDir: userDir,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      var flowFile = 'flows_' + require('os').hostname() + '.json';\n      var flowFilePath = path.join(userDir, flowFile);\n      var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n      fs.existsSync(flowFilePath).should.be.false();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFilePath).should.be.true();\n        fs.existsSync(flowFileBackupPath).should.be.false();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should save flows to the specified file","suites":["storage/localfilesystem"],"updatePoint":{"line":278,"column":45,"index":9784},"line":278,"code":"  it('should save flows to the specified file', function (done) {\n    var defaultFlowFile = 'flows_' + require('os').hostname() + '.json';\n    var defaultFlowFilePath = path.join(userDir, defaultFlowFile);\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(defaultFlowFilePath).should.be.false();\n      fs.existsSync(flowFilePath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(defaultFlowFilePath).should.be.false();\n        fs.existsSync(flowFilePath).should.be.true();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should format the flows file when flowFilePretty specified","suites":["storage/localfilesystem"],"updatePoint":{"line":308,"column":64,"index":10858},"line":308,"code":"  it('should format the flows file when flowFilePretty specified', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      flowFilePretty: true,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      localfilesystem.saveFlows(testFlow).then(function () {\n        var content = fs.readFileSync(flowFilePath, \"utf8\");\n        content.split(\"\\n\").length.should.be.above(1);\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should fsync the flows file","suites":["storage/localfilesystem"],"updatePoint":{"line":335,"column":33,"index":11676},"line":335,"code":"  it('should fsync the flows file', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      editorTheme: {\n        projects: {\n          enabled: false\n        }\n      },\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      sinon.spy(fs, \"fsync\");\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.fsync.callCount.should.be.greaterThan(0);\n        fs.fsync.restore();\n        done();\n      }).catch(function (err) {\n        fs.fsync.restore();\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should log fsync errors and continue","suites":["storage/localfilesystem"],"updatePoint":{"line":363,"column":42,"index":12417},"line":363,"code":"  it('should log fsync errors and continue', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      sinon.stub(fs, \"fsync\").callsFake(function (fd, cb) {\n        cb(new Error());\n      });\n      sinon.spy(log, \"warn\");\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.fsync.callCount.should.be.greaterThan(0);\n        log.warn.restore();\n        fs.fsync.callCount.should.be.greaterThan(0);\n        fs.fsync.restore();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should backup the flows file","suites":["storage/localfilesystem"],"updatePoint":{"line":390,"column":34,"index":13213},"line":390,"code":"  it('should backup the flows file', function (done) {\n    var defaultFlowFile = 'flows_' + require('os').hostname() + '.json';\n    var defaultFlowFilePath = path.join(userDir, defaultFlowFile);\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var flowFileBackupPath = path.join(userDir, \".\" + flowFile + \".backup\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(defaultFlowFilePath).should.be.false();\n      fs.existsSync(flowFilePath).should.be.false();\n      fs.existsSync(flowFileBackupPath).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFileBackupPath).should.be.false();\n        fs.existsSync(defaultFlowFilePath).should.be.false();\n        fs.existsSync(flowFilePath).should.be.true();\n        var content = fs.readFileSync(flowFilePath, 'utf8');\n        var testFlow2 = [{\n          \"type\": \"tab\",\n          \"id\": \"bc5672ad.2741d8\",\n          \"label\": \"Sheet 2\"\n        }];\n        localfilesystem.saveFlows(testFlow2).then(function () {\n          fs.existsSync(flowFileBackupPath).should.be.true();\n          fs.existsSync(defaultFlowFilePath).should.be.false();\n          fs.existsSync(flowFilePath).should.be.true();\n          var backupContent = fs.readFileSync(flowFileBackupPath, 'utf8');\n          content.should.equal(backupContent);\n          var content2 = fs.readFileSync(flowFilePath, 'utf8');\n          content2.should.not.equal(backupContent);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle missing credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":435,"column":39,"index":15035},"line":435,"code":"  it('should handle missing credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      localfilesystem.getCredentials().then(function (creds) {\n        creds.should.eql({});\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":457,"column":31,"index":15679},"line":457,"code":"  it('should handle credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        localfilesystem.getCredentials().then(function (creds) {\n          creds.should.eql(credentials);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should backup existing credentials","suites":["storage/localfilesystem"],"updatePoint":{"line":489,"column":40,"index":16622},"line":489,"code":"  it('should backup existing credentials', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    var credFileBackup = path.join(userDir, \".test_cred.json.backup\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.writeFileSync(credFile, \"{}\", \"utf8\");\n      fs.existsSync(credFile).should.be.true();\n      fs.existsSync(credFileBackup).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        fs.existsSync(credFileBackup).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should format the creds file when flowFilePretty specified","suites":["storage/localfilesystem"],"updatePoint":{"line":520,"column":64,"index":17643},"line":520,"code":"  it('should format the creds file when flowFilePretty specified', function (done) {\n    var flowFile = 'test.json';\n    var flowFilePath = path.join(userDir, flowFile);\n    var credFile = path.join(userDir, \"test_cred.json\");\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFilePath,\n      flowFilePretty: true,\n      getUserSettings: () => {\n        {}\n      }\n    }, mockRuntime).then(function () {\n      fs.existsSync(credFile).should.be.false();\n      var credentials = {\n        \"abc\": {\n          \"type\": \"creds\"\n        }\n      };\n      localfilesystem.saveCredentials(credentials).then(function () {\n        fs.existsSync(credFile).should.be.true();\n        var content = fs.readFileSync(credFile, \"utf8\");\n        content.split(\"\\n\").length.should.be.above(1);\n        localfilesystem.getCredentials().then(function (creds) {\n          creds.should.eql(credentials);\n          done();\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should handle flow file in random unc path and non-existent subfolder","suites":["storage/localfilesystem"],"updatePoint":{"line":555,"column":75,"index":18761},"line":555,"code":"  it('should handle flow file in random unc path and non-existent subfolder', function (done) {\n    // only test on win32\n    if (process.platform !== 'win32') {\n      console.log('skipped test as not win32');\n      done();\n      return;\n    }\n\n    // get a real windows path\n    var flowFile = path.win32.resolve(userDir + '/some/random/path');\n    var rootdir = path.win32.resolve(userDir + '/some');\n    // make it into a local UNC path\n    flowFile = flowFile.replace('C:\\\\', '\\\\\\\\localhost\\\\c$\\\\');\n    localfilesystem.init({\n      userDir: userDir,\n      flowFile: flowFile\n    }, mockRuntime).then(function () {\n      fs.existsSync(flowFile).should.be.false();\n      localfilesystem.saveFlows(testFlow).then(function () {\n        fs.existsSync(flowFile).should.be.true();\n        localfilesystem.getFlows().then(function (flows) {\n          flows.should.eql(testFlow);\n          // cleanup\n          fs.removeSync(rootdir);\n          done();\n        }).catch(function (err) {\n          // cleanup\n          fs.removeSync(rootdir);\n          done(err);\n        });\n      }).catch(function (err) {\n        // cleanup\n        fs.removeSync(rootdir);\n        done(err);\n      });\n    }).catch(function (err) {\n      // cleanup\n      fs.removeSync(rootdir);\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/index_spec.js","skipped":false,"dir":"test"},{"name":"should return an empty list of library objects","suites":["storage/localfilesystem/library"],"updatePoint":{"line":32,"column":52,"index":1229},"line":32,"code":"  it('should return an empty list of library objects', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', '').then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return an empty list of library objects (path=/)","suites":["storage/localfilesystem/library"],"updatePoint":{"line":46,"column":61,"index":1645},"line":46,"code":"  it('should return an empty list of library objects (path=/)', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', '/').then(function (flows) {\n        flows.should.eql([]);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return an error for a non-existent library object","suites":["storage/localfilesystem/library"],"updatePoint":{"line":60,"column":62,"index":2063},"line":60,"code":"  it('should return an error for a non-existent library object', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      localfilesystemLibrary.getLibraryEntry('object', 'A/B').then(function (flows) {\n        should.fail(null, null, \"non-existent flow\");\n      }).catch(function (err) {\n        should.exist(err);\n        done();\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a directory listing of library objects","suites":["storage/localfilesystem/library"],"updatePoint":{"line":93,"column":58,"index":3364},"line":93,"code":"  it('should return a directory listing of library objects', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary();\n      localfilesystemLibrary.getLibraryEntry('object', '').then(function (flows) {\n        flows.should.eql(['A', 'B', 'D', {\n          abc: 'def',\n          fn: 'file1.js'\n        }]);\n        localfilesystemLibrary.getLibraryEntry('object', 'B').then(function (flows) {\n          flows.should.eql(['C', {\n            ghi: 'jkl',\n            fn: 'file2.js'\n          }, {\n            fn: 'flow.json'\n          }]);\n          localfilesystemLibrary.getLibraryEntry('object', 'B/C').then(function (flows) {\n            flows.should.eql([]);\n            localfilesystemLibrary.getLibraryEntry('object', 'D').then(function (flows) {\n              flows.should.eql([{\n                mno: '',\n                fn: 'file3.js'\n              }]);\n              done();\n            }).catch(function (err) {\n              done(err);\n            });\n          }).catch(function (err) {\n            done(err);\n          });\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should load a flow library object with .json unspecified","suites":["storage/localfilesystem/library"],"updatePoint":{"line":134,"column":62,"index":4667},"line":134,"code":"  it('should load a flow library object with .json unspecified', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B/flow').then(function (flows) {\n        flows.should.eql(\"Hi\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a library object","suites":["storage/localfilesystem/library"],"updatePoint":{"line":147,"column":36,"index":5054},"line":147,"code":"  it('should return a library object', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary();\n      localfilesystemLibrary.getLibraryEntry('object', 'B/file2.js').then(function (body) {\n        body.should.eql(\"// not a metaline \\n\\n Hi\");\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library function","suites":["storage/localfilesystem/library"],"updatePoint":{"line":162,"column":50,"index":5521},"line":162,"code":"  it('should return a newly saved library function', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"functions\");\n      localfilesystemLibrary.getLibraryEntry('functions', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          ghi: 'jkl',\n          fn: 'file2.js'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file3.js\");\n        localfilesystemLibrary.saveLibraryEntry('functions', ft, {\n          mno: 'pqr'\n        }, \"// another non meta line\\n\\n Hi There\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('functions', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file3.js'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('functions', ft).then(function (body) {\n                body.should.eql(\"// another non meta line\\n\\n Hi There\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library flow","suites":["storage/localfilesystem/library"],"updatePoint":{"line":202,"column":46,"index":6918},"line":202,"code":"  it('should return a newly saved library flow', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          fn: 'flow.json'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file3\");\n        localfilesystemLibrary.saveLibraryEntry('flows', ft, {\n          mno: 'pqr'\n        }, \"Hi\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('flows', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file3.json'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('flows', ft + \".json\").then(function (body) {\n                body.should.eql(\"Hi\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"should return a newly saved library flow (multi-byte character)","suites":["storage/localfilesystem/library"],"updatePoint":{"line":241,"column":69,"index":8236},"line":241,"code":"  it('should return a newly saved library flow (multi-byte character)', function (done) {\n    localfilesystemLibrary.init({\n      userDir: userDir\n    }).then(function () {\n      createObjectLibrary(\"flows\");\n      localfilesystemLibrary.getLibraryEntry('flows', 'B').then(function (flows) {\n        flows.should.eql(['C', {\n          fn: 'flow.json'\n        }]);\n        var ft = path.join(\"B\", \"D\", \"file4\");\n        localfilesystemLibrary.saveLibraryEntry('flows', ft, {\n          mno: 'pqr'\n        }, \"\").then(function () {\n          setTimeout(function () {\n            localfilesystemLibrary.getLibraryEntry('flows', path.join(\"B\", \"D\")).then(function (flows) {\n              flows.should.eql([{\n                mno: 'pqr',\n                fn: 'file4.json'\n              }]);\n              localfilesystemLibrary.getLibraryEntry('flows', ft + \".json\").then(function (body) {\n                body.should.eql(\"\");\n                done();\n              }).catch(function (err) {\n                done(err);\n              });\n            }).catch(function (err) {\n              done(err);\n            });\n          }, 50);\n        }).catch(function (err) {\n          done(err);\n        });\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/library_spec.js","skipped":false,"dir":"test"},{"name":"generates package.json for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":28,"column":42,"index":1047},"line":28,"code":"  it('generates package.json for a project', function () {\n    var generated = defaultFileSet[\"package.json\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\",\n      files: {\n        flow: \"MY FLOW FILE\",\n        credentials: \"MY CREDENTIALS FILE\"\n      }\n    }, runtime);\n    var parsed = JSON.parse(generated);\n    parsed.should.have.property('name', \"A TEST NAME\");\n    parsed.should.have.property('description', \"A TEST SUMMARY\");\n    parsed.should.have.property('node-red');\n    parsed['node-red'].should.have.property('settings');\n    parsed['node-red'].settings.should.have.property('flowFile', \"MY FLOW FILE\");\n    parsed['node-red'].settings.should.have.property('credentialsFile', \"MY CREDENTIALS FILE\");\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"generates README.md for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":45,"column":39,"index":1777},"line":45,"code":"  it('generates README.md for a project', function () {\n    var generated = defaultFileSet[\"README.md\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\"\n    }, runtime);\n    generated.should.match(/A TEST NAME/);\n    generated.should.match(/A TEST SUMMARY/);\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"generates .gitignore for a project","suites":["storage/localfilesystem/projects/defaultFileSet"],"updatePoint":{"line":53,"column":40,"index":2055},"line":53,"code":"  it('generates .gitignore for a project', function () {\n    var generated = defaultFileSet[\".gitignore\"]({\n      name: \"A TEST NAME\",\n      summary: \"A TEST SUMMARY\"\n    }, runtime);\n    generated.length.should.be.greaterThan(0);\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/defaultFileSet_spec.js","skipped":false,"dir":"test"},{"name":"sets/clears auth details for a given project/remote/user","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":28,"column":62,"index":1092},"line":28,"code":"  it('sets/clears auth details for a given project/remote/user', function () {\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    authCache.set(\"project\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    var result = authCache.get(\"project\", \"remote1\", \"user1\");\n    result.should.have.property(\"foo1\", \"bar1\");\n    result = authCache.get(\"project\", \"remote1\", \"user2\");\n    result.should.have.property(\"foo2\", \"bar2\");\n    authCache.clear(\"project\", \"remote1\", \"user1\");\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"clears auth details for all users on a given project/remote","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":45,"column":65,"index":1876},"line":45,"code":"  it('clears auth details for all users on a given project/remote', function () {\n    authCache.set(\"project\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    authCache.set(\"project\", \"remote2\", \"user1\", {\n      foo3: \"bar3\"\n    });\n    should.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project\", \"remote2\", \"user1\"));\n    authCache.clear(\"project\", \"remote1\");\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user1\"));\n    should.not.exist(authCache.get(\"project\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project\", \"remote2\", \"user1\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"clears auth details for all remotes/users on a given project","suites":["localfilesystem/projects/git/authCache"],"updatePoint":{"line":63,"column":66,"index":2634},"line":63,"code":"  it('clears auth details for all remotes/users on a given project', function () {\n    authCache.set(\"project1\", \"remote1\", \"user1\", {\n      foo1: \"bar1\"\n    });\n    authCache.set(\"project1\", \"remote1\", \"user2\", {\n      foo2: \"bar2\"\n    });\n    authCache.set(\"project2\", \"remote2\", \"user1\", {\n      foo3: \"bar3\"\n    });\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user2\"));\n    should.exist(authCache.get(\"project2\", \"remote2\", \"user1\"));\n    authCache.clear(\"project2\");\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user1\"));\n    should.exist(authCache.get(\"project1\", \"remote1\", \"user2\"));\n    should.not.exist(authCache.get(\"project2\", \"remote2\", \"user1\"));\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authCache_spec.js","skipped":false,"dir":"test"},{"name":"listens for user/pass prompts and returns provided auth","suites":["localfilesystem/projects/git/authServer"],"updatePoint":{"line":44,"column":61,"index":1608},"line":44,"code":"  it(\"listens for user/pass prompts and returns provided auth\", function (done) {\n    authServer.ResponseServer({\n      username: \"TEST_USER\",\n      password: \"TEST_PASS\"\n    }).then(function (rs) {\n      sendPrompt(rs.path, \"Username\").then(function (response) {\n        response.should.eql(\"TEST_USER\");\n        return sendPrompt(rs.path, \"Password\");\n      }).then(function (response) {\n        response.should.eql(\"TEST_PASS\");\n      }).then(() => {\n        rs.close();\n        done();\n      }).catch(function (err) {\n        rs.close();\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authServer_spec.js","skipped":false,"dir":"test"},{"name":"listens for ssh prompts and returns provided auth","suites":["localfilesystem/projects/git/authServer"],"updatePoint":{"line":63,"column":55,"index":2187},"line":63,"code":"  it(\"listens for ssh prompts and returns provided auth\", function (done) {\n    authServer.ResponseSSHServer({\n      passphrase: \"TEST_PASSPHRASE\"\n    }).then(function (rs) {\n      sendPrompt(rs.path, \"The\").then(function (response) {\n        // TODO:\n        response.should.eql(\"yes\");\n        return sendPrompt(rs.path, \"Enter\");\n      }).then(function (response) {\n        response.should.eql(\"TEST_PASSPHRASE\");\n      }).then(() => {\n        rs.close();\n        done();\n      }).catch(function (err) {\n        rs.close();\n        done(err);\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authServer_spec.js","skipped":false,"dir":"test"},{"name":"connects to port and sends passphrase","suites":["localfilesystem/projects/git/authWriter"],"updatePoint":{"line":39,"column":43,"index":1508},"line":39,"code":"  it(\"connects to port and sends passphrase\", function (done) {\n    var receivedData = \"\";\n    var server = net.createServer(function (connection) {\n      connection.setEncoding('utf8');\n      connection.on('data', function (data) {\n        receivedData += data;\n        var m = data.indexOf(\"\\n\");\n        if (m !== -1) {\n          connection.end();\n        }\n      });\n    });\n    var listenPath = getListenPath();\n    server.listen(listenPath, function (ready) {\n      child_process.exec('\"' + process.execPath + '\" \"' + authWriter + '\" \"' + listenPath + '\" TEST_PHRASE_FOO', {\n        cwd: __dirname\n      }, (error, stdout, stderr) => {\n        server.close();\n        try {\n          should.not.exist(error);\n          receivedData.should.eql(\"TEST_PHRASE_FOO\\n\");\n          done();\n        } catch (err) {\n          done(err);\n        }\n      });\n    });\n    server.on('close', function () {\n      // console.log(\"Closing response server\");\n      fs.removeSync(listenPath);\n    });\n    server.on('error', function (err) {\n      console.log(\"ResponseServer unexpectedError:\", err.toString());\n      server.close();\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/authWriter_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/git/index"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/git/index_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/index"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/index_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["storage/localfilesystem/projects/Project"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/Project_spec.js","skipped":true,"dir":"test"},{"name":"should create sshkey directory when sshkey initializes","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":48,"column":60,"index":1592},"line":48,"code":"  it('should create sshkey directory when sshkey initializes', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      var ret = fs.existsSync(sshkeyDirPath);\n      ret.should.be.true();\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey empty list if there is no sshkey file","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":58,"column":61,"index":1954},"line":58,"code":"  it('should get sshkey empty list if there is no sshkey file', function (done) {\n    var username = 'test';\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(0);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":71,"column":28,"index":2357},"line":71,"code":"  it('should get sshkey list', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not get sshkey file if there is only private key","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":95,"column":61,"index":3307},"line":95,"code":"  it('should not get sshkey file if there is only private key', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    var onlyPrivateKeyFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      for (var filename of onlyPrivateKeyFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      }\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n        for (var filename of onlyPrivateKeyFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not get sshkey file if there is only public key","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":128,"column":60,"index":4630},"line":128,"code":"  it('should not get sshkey file if there is only public key', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filenameList = ['test-key01', 'test-key02'];\n    var directoryList = ['test-key03', '.test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      for (var filename of directoryList) {\n        fs.ensureDirSync(path.join(sshkeyDirPath, filename));\n      }\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n        for (var directoryname of directoryList) {\n          retObj.should.not.containEql({\n            name: directoryname\n          });\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list that does not have directory","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":161,"column":57,"index":5893},"line":161,"code":"  it('should get sshkey list that does not have directory', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var otherUsername = 'other';\n    var filenameList = ['test-key01', 'test-key02'];\n    var otherUserFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      for (var filename of otherUserFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n        for (var filename of otherUserFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey list that have keys of specified user","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":196,"column":61,"index":7345},"line":196,"code":"  it('should get sshkey list that have keys of specified user', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var otherUsername = 'other';\n    var filenameList = ['test-key01', 'test-key02'];\n    var otherUserFilenameList = ['test-key03', 'test-key04'];\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      for (var filename of filenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      for (var filename of otherUserFilenameList) {\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename), \"\", \"utf8\");\n        fs.writeFileSync(path.join(sshkeyDirPath, otherUsername + \"_\" + filename + \".pub\"), \"\", \"utf8\");\n      }\n      sshkeys.listSSHKeys(username).then(function (retObj) {\n        retObj.should.be.instanceOf(Array).and.have.lengthOf(filenameList.length);\n        for (var filename of filenameList) {\n          retObj.should.containEql({\n            name: filename\n          });\n        }\n        for (var filename of otherUserFilenameList) {\n          retObj.should.not.containEql({\n            name: filename\n          });\n        }\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with empty data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":231,"column":49,"index":8785},"line":231,"code":"  it('should generate sshkey file with empty data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      name: 'test-key01'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with only comment data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":251,"column":56,"index":9557},"line":251,"code":"  it('should generate sshkey file with only comment data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with password data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":272,"column":52,"index":10357},"line":272,"code":"  it('should generate sshkey file with password data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'testtest'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":294,"column":48,"index":11181},"line":294,"code":"  it('should generate sshkey file with size data', function (done) {\n    this.timeout(20000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      size: 4096\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should generate sshkey file with password & size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":316,"column":59,"index":12006},"line":316,"code":"  it('should generate sshkey file with password & size data', function (done) {\n    this.timeout(20000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'testtest',\n      size: 4096\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        retObj.should.be.equal(options.name);\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name)).should.be.true();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + options.name + '.pub')).should.be.true();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not generate sshkey file with illegal size data","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":339,"column":60,"index":12860},"line":339,"code":"  it('should not generate sshkey file with illegal size data', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      size: 1023\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        done(new Error('Does NOT throw error!'));\n      }).catch(function (err) {\n        try {\n          err.should.have.property('code', 'key_length_too_short');\n          done();\n        } catch (error) {\n          done(error);\n        }\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should not generate sshkey file with illegal password","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":363,"column":59,"index":13610},"line":363,"code":"  it('should not generate sshkey file with illegal password', function (done) {\n    this.timeout(10000);\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var options = {\n      comment: 'test@test.com',\n      name: 'test-key01',\n      password: 'aa'\n    };\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      sshkeys.generateSSHKey(username, options).then(function (retObj) {\n        done(new Error('Does NOT throw error!'));\n      }).catch(function (err) {\n        try {\n          err.should.have.property('code', 'key_passphrase_too_short');\n          done();\n        } catch (error) {\n          done(error);\n        }\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should get sshkey file content","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":387,"column":36,"index":14345},"line":387,"code":"  it('should get sshkey file content', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filename = 'test-key01';\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), fileContent, \"utf8\");\n      sshkeys.getSSHKey(username, filename).then(function (retObj) {\n        retObj.should.be.equal(fileContent);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"should delete sshkey files","suites":["storage/localfilesystem/projects/ssh"],"updatePoint":{"line":405,"column":32,"index":15790},"line":405,"code":"  it('should delete sshkey files', function (done) {\n    var sshkeyDirPath = path.join(userDir, 'projects', '.sshkeys');\n    var username = 'test';\n    var filename = 'test-key01';\n    var fileContent = \"ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQD3a+sgtgzSbbliWxmOq5p6+H/mE+0gjWfLWrkIVmHENd1mifV4uCmIHAR2NfuadUYMQ3+bQ90kpmmEKTMYPsyentsKpHQZxTzG7wOCAIpJnbPTHDMxEJhVTaAwEjbVyMSIzTTPfnhoavWIBu0+uMgKDDlBm+RjlgkFlyhXyCN6UwFrIUUMH6Gw+eQHLiooKIl8ce7uDxIlt+9b7hFCU+sQ3kvuse239DZluu6+8buMWqJvrEHgzS9adRFKku8nSPAEPYn85vDi7OgVAcLQufknNgs47KHBAx9h04LeSrFJ/P5J1b//ItRpMOIme+O9d1BR46puzhvUaCHLdvO9czj+OmW+dIm+QIk6lZIOOMnppG72kZxtLfeKT16ur+2FbwAdL9ItBp4BI/YTlBPoa5mLMxpuWfmX1qHntvtGc9wEwS1P7YFfmF3XiK5apxalzrn0Qlr5UmDNbVIqJb1OlbC0w03Z0oktti1xT+R2DGOLWM4lBbpXDHV1BhQ7oYOvbUD8Cnof55lTP0WHHsOHlQc/BGDti1XA9aBX/OzVyzBUYEf0pkimsD0RYo6aqt7QwehJYdlz9x1NBguBffT0s4NhNb9IWr+ASnFPvNl2sw4XH/8U0J0q8ZkMpKkbLM1Zdp1Fv00GF0f5UNRokai6uM3w/ccantJ3WvZ6GtctqytWrw== \\n\";\n    sshkeys.init(mockSettings, mockRuntime).then(function () {\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename), \"\", \"utf8\");\n      fs.writeFileSync(path.join(sshkeyDirPath, username + \"_\" + filename + \".pub\"), fileContent, \"utf8\");\n      sshkeys.deleteSSHKey(username, filename).then(function () {\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + filename)).should.be.false();\n        fs.existsSync(path.join(sshkeyDirPath, username + '_' + filename + '.pub')).should.be.false();\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/index_spec.js","skipped":false,"dir":"test"},{"name":"invokes sshkeygen","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":29,"column":23,"index":1133},"line":29,"code":"  it(\"invokes sshkeygen\", function (done) {\n    var command;\n    var args;\n    var opts;\n    sinon.stub(child_process, \"spawn\").callsFake(function (_command, _args, _opts) {\n      _command = command;\n      _args = args;\n      _opts = opts;\n      var e = new EventEmitter();\n      e.stdout = new EventEmitter();\n      e.stderr = new EventEmitter();\n      setTimeout(function () {\n        e.stdout.emit(\"data\", \"result\");\n        e.emit(\"close\", 0);\n      }, 50);\n      return e;\n    });\n    keygen.generateKey({\n      size: 1024,\n      location: 'location',\n      comment: 'comment',\n      password: 'password'\n    }).then(function (output) {\n      output.should.equal(\"result\");\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"reports passphrase too short","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":58,"column":34,"index":1898},"line":58,"code":"  it(\"reports passphrase too short\", function (done) {\n    var command;\n    var args;\n    var opts;\n    try {\n      keygen.generateKey({\n        size: 1024,\n        location: 'location',\n        comment: 'comment',\n        password: '123'\n      }).then(function (output) {\n        done(new Error(\"Error not thrown\"));\n      }).catch(function (err) {\n        done(new Error(\"Error not thrown\"));\n      });\n    } catch (err) {\n      err.should.have.property(\"code\", \"key_passphrase_too_short\");\n      done();\n    }\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"reports key length too short","suites":["localfilesystem/projects/ssh/keygen"],"updatePoint":{"line":78,"column":34,"index":2417},"line":78,"code":"  it(\"reports key length too short\", function (done) {\n    var command;\n    var args;\n    var opts;\n    try {\n      keygen.generateKey({\n        size: 123,\n        location: 'location',\n        comment: 'comment',\n        password: 'password'\n      }).then(function (output) {\n        done(new Error(\"Error not thrown\"));\n      }).catch(function (err) {\n        done(new Error(\"Error not thrown\"));\n      });\n    } catch (err) {\n      err.should.have.property(\"code\", \"key_length_too_short\");\n      done();\n    }\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/projects/ssh/keygen_spec.js","skipped":false,"dir":"test"},{"name":"should handle non-existent sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":32,"column":41,"index":1221},"line":32,"code":"  it('should handle non-existent sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.false();\n    localfilesystemSessions.getSessions().then(function (sessions) {\n      sessions.should.eql({});\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle corrupt sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":45,"column":36,"index":1631},"line":45,"code":"  it('should handle corrupt sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    fs.writeFileSync(sessionsFile, \"[This is not json\", \"utf8\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.true();\n    localfilesystemSessions.getSessions().then(function (sessions) {\n      sessions.should.eql({});\n      done();\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle sessions","suites":["storage/localfilesystem/sessions"],"updatePoint":{"line":59,"column":28,"index":2097},"line":59,"code":"  it('should handle sessions', function (done) {\n    var sessionsFile = path.join(userDir, \".sessions.json\");\n    localfilesystemSessions.init({\n      userDir: userDir\n    });\n    fs.existsSync(sessionsFile).should.be.false();\n    var sessions = {\n      \"abc\": {\n        \"type\": \"creds\"\n      }\n    };\n    localfilesystemSessions.saveSessions(sessions).then(function () {\n      fs.existsSync(sessionsFile).should.be.true();\n      localfilesystemSessions.getSessions().then(function (_sessions) {\n        _sessions.should.eql(sessions);\n        done();\n      }).catch(function (err) {\n        done(err);\n      });\n    }).catch(function (err) {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/sessions_spec.js","skipped":false,"dir":"test"},{"name":"should handle non-existent settings","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":32,"column":41,"index":1227},"line":32,"code":"  it('should handle non-existent settings', function (done) {\n    var settingsFile = path.join(userDir, \".config.json\");\n    localfilesystemSettings.init({\n      userDir: userDir\n    }).then(function () {\n      fs.existsSync(settingsFile).should.be.false();\n      return localfilesystemSettings.getSettings();\n    }).then(function (settings) {\n      settings.should.eql({});\n      done();\n    }).catch(err => {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should migrate single config.json to multiple files","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":46,"column":57,"index":1685},"line":46,"code":"  it('should migrate single config.json to multiple files', function (done) {\n    var settingsFile = path.join(userDir, \".config.json\");\n    fs.writeFileSync(settingsFile, JSON.stringify({\n      nodes: {\n        a: 1\n      },\n      _credentialSecret: \"foo\",\n      users: {\n        b: 2\n      },\n      projects: {\n        c: 3\n      }\n    }), \"utf8\");\n    async function checkFile(sectionName, expectedContents) {\n      const file = path.join(userDir, \".config.\" + sectionName + \".json\");\n      fs.existsSync(file).should.be.true();\n      var contents = await fs.readFile(file, 'utf8');\n      var data = JSON.parse(contents);\n      data.should.eql(expectedContents);\n    }\n    localfilesystemSettings.init({\n      userDir: userDir\n    }).then(async function () {\n      // (For now) leave the old settings file in place\n      fs.existsSync(settingsFile).should.be.true();\n      await checkFile(\"nodes\", {\n        a: 1\n      });\n      await checkFile(\"users\", {\n        b: 2\n      });\n      await checkFile(\"projects\", {\n        c: 3\n      });\n      await checkFile(\"runtime\", {\n        _credentialSecret: \"foo\"\n      });\n      done();\n    }).catch(err => {\n      done(err);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should load separate settings file","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":89,"column":40,"index":2854},"line":89,"code":"  it('should load separate settings file', async function () {\n    await fs.writeFile(path.join(userDir, \".config.nodes.json\"), JSON.stringify({\n      a: 1\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.users.json\"), JSON.stringify({\n      b: 2\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.projects.json\"), JSON.stringify({\n      c: 3\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.runtime.json\"), JSON.stringify({\n      _credentialSecret: \"foo\"\n    }), \"utf8\");\n    return localfilesystemSettings.init({\n      userDir: userDir\n    }).then(localfilesystemSettings.getSettings).then(settings => {\n      settings.should.eql({\n        nodes: {\n          a: 1\n        },\n        _credentialSecret: \"foo\",\n        users: {\n          b: 2\n        },\n        projects: {\n          c: 3\n        }\n      });\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"should write only the files that need writing","suites":["storage/localfilesystem/settings"],"updatePoint":{"line":119,"column":51,"index":3743},"line":119,"code":"  it('should write only the files that need writing', async function () {\n    await fs.writeFile(path.join(userDir, \".config.nodes.json\"), JSON.stringify({\n      a: 1\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.users.json\"), JSON.stringify({\n      b: 2\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.projects.json\"), JSON.stringify({\n      c: 3\n    }), \"utf8\");\n    await fs.writeFile(path.join(userDir, \".config.runtime.json\"), JSON.stringify({\n      _credentialSecret: \"foo\"\n    }), \"utf8\");\n    const fsStatNodes = await fs.stat(path.join(userDir, \".config.nodes.json\"));\n    const fsStatUsers = await fs.stat(path.join(userDir, \".config.users.json\"));\n    const fsStatProjects = await fs.stat(path.join(userDir, \".config.projects.json\"));\n    const fsStatRuntime = await fs.stat(path.join(userDir, \".config.runtime.json\"));\n    return localfilesystemSettings.init({\n      userDir: userDir\n    }).then(function () {\n      return new Promise(res => {\n        setTimeout(function () {\n          res();\n        }, 10);\n      });\n    }).then(() => {\n      return localfilesystemSettings.saveSettings({\n        nodes: {\n          d: 4\n        },\n        _credentialSecret: \"bar\",\n        users: {\n          b: 2\n        },\n        projects: {\n          c: 3\n        }\n      });\n    }).then(async function () {\n      const newFsStatNodes = await fs.stat(path.join(userDir, \".config.nodes.json\"));\n      const newFsStatUsers = await fs.stat(path.join(userDir, \".config.users.json\"));\n      const newFsStatProjects = await fs.stat(path.join(userDir, \".config.projects.json\"));\n      const newFsStatRuntime = await fs.stat(path.join(userDir, \".config.runtime.json\"));\n\n      // Not changed\n      newFsStatUsers.mtimeMs.should.eql(fsStatUsers.mtimeMs);\n      newFsStatProjects.mtimeMs.should.eql(fsStatProjects.mtimeMs);\n\n      // Changed\n      newFsStatNodes.mtimeMs.should.not.eql(fsStatNodes.mtimeMs);\n      newFsStatRuntime.mtimeMs.should.not.eql(fsStatRuntime.mtimeMs);\n    });\n  });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/settings_spec.js","skipped":false,"dir":"test"},{"name":"returns parsed JSON","suites":["storage/localfilesystem/util","parseJSON"],"updatePoint":{"line":22,"column":27,"index":923},"line":22,"code":"    it('returns parsed JSON', function () {\n      var result = util.parseJSON('{\"a\":123}');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/util_spec.js","skipped":false,"dir":"test"},{"name":"ignores BOM character","suites":["storage/localfilesystem/util","parseJSON"],"updatePoint":{"line":28,"column":29,"index":1076},"line":28,"code":"    it('ignores BOM character', function () {\n      var result = util.parseJSON('\\uFEFF{\"a\":123}');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/runtime/lib/storage/localfilesystem/util_spec.js","skipped":false,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["node-red/red"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/@node-red/util/index_spec.js","skipped":true,"dir":"test"},{"name":"can be required without errors","suites":["@node-red/util/events"],"updatePoint":{"line":19,"column":36,"index":798},"line":19,"code":"  it('can be required without errors', function () {\n    NR_TEST_UTILS.require(\"@node-red/util/lib/events\");\n  });","file":"unit/@node-red/util/lib/events_spec.js","skipped":false,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util/events"],"line":22,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/events_spec.js","skipped":true,"dir":"test"},{"name":"runs command and resolves on success - no emit","suites":["runtime/exec"],"updatePoint":{"line":51,"column":52,"index":1793},"line":51,"code":"  it(\"runs command and resolves on success - no emit\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function (result) {\n      command.should.eql(mockProcess._args.command);\n      args.should.eql(mockProcess._args.args);\n      opts.should.eql(mockProcess._args.options);\n      logEvents.length.should.eql(0);\n      result.code.should.eql(0);\n      result.stdout.should.eql(\"123\");\n      result.stderr.should.eql(\"abc\");\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 0);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and resolves on success - emit","suites":["runtime/exec"],"updatePoint":{"line":75,"column":49,"index":2636},"line":75,"code":"  it(\"runs command and resolves on success - emit\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts, true).then(function (result) {\n      logEvents.length.should.eql(8);\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 0);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and rejects on error - close","suites":["runtime/exec"],"updatePoint":{"line":93,"column":47,"index":3222},"line":93,"code":"  it(\"runs command and rejects on error - close\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function () {\n      done(\"Command should have rejected\");\n    }).catch(function (result) {\n      result;\n      result.code.should.eql(123);\n      result.stdout.should.eql(\"123\");\n      result.stderr.should.eql(\"abc\");\n      done();\n    }).catch(done);\n    mockProcess.stdout.emit('data', \"1\");\n    mockProcess.stderr.emit('data', \"a\");\n    mockProcess.stderr.emit('data', \"b\");\n    mockProcess.stdout.emit('data', \"2\");\n    mockProcess.stdout.emit('data', \"3\");\n    mockProcess.stderr.emit('data', \"c\");\n    mockProcess.emit('close', 123);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"runs command and rejects on error - error","suites":["runtime/exec"],"updatePoint":{"line":116,"column":47,"index":3964},"line":116,"code":"  it(\"runs command and rejects on error - error\", function (done) {\n    var command = \"cmd\";\n    var args = [1, 2, 3];\n    var opts = {\n      a: true\n    };\n    exec.run(command, args, opts).then(function () {\n      done(\"Command should have rejected\");\n    }).catch(function (result) {\n      result;\n      result.code.should.eql(456);\n      result.stdout.should.eql(\"\");\n      result.stderr.should.eql(\"test-error\");\n      done();\n    }).catch(done);\n    mockProcess.emit('error', \"test-error\");\n    mockProcess.emit('close', 456);\n  });","file":"unit/@node-red/util/lib/exec_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to be registered","suites":["util/hooks"],"updatePoint":{"line":8,"column":36,"index":272},"line":8,"code":"  it(\"allows a hook to be registered\", function (done) {\n    let calledWith = null;\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend\", function (payload) {\n      calledWith = payload;\n    });\n    hooks.has(\"onSend\").should.be.true();\n    let data = {\n      a: 1\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      calledWith.should.equal(data);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"rejects invalid hook id","suites":["util/hooks"],"updatePoint":{"line":23,"column":29,"index":661},"line":23,"code":"  it(\"rejects invalid hook id\", function (done) {\n    try {\n      hooks.add(\"foo\", function (payload) {});\n      done(new Error(\"Invalid hook accepted\"));\n    } catch (err) {\n      done();\n    }\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"calls hooks in the order they were registered","suites":["util/hooks"],"updatePoint":{"line":31,"column":51,"index":884},"line":31,"code":"  it(\"calls hooks in the order they were registered\", function (done) {\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"does not allow multiple hooks with same id.label","suites":["util/hooks"],"updatePoint":{"line":46,"column":54,"index":1282},"line":46,"code":"  it(\"does not allow multiple hooks with same id.label\", function () {\n    hooks.has(\"onSend.one\").should.be.false();\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend.one\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.has(\"onSend.one\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    (function () {\n      hooks.add(\"onSend.one\", function (payload) {\n        payload.order.push(\"B\");\n      });\n    }).should.throw();\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"removes labelled hook","suites":["util/hooks"],"updatePoint":{"line":60,"column":27,"index":1734},"line":60,"code":"  it(\"removes labelled hook\", function (done) {\n    hooks.has(\"onSend.A\").should.be.false();\n    hooks.has(\"onSend.B\").should.be.false();\n    hooks.has(\"onSend\").should.be.false();\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.has(\"onSend.A\").should.be.true();\n    hooks.has(\"onSend.B\").should.be.false();\n    hooks.has(\"onSend\").should.be.true();\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    hooks.has(\"onSend.A\").should.be.true();\n    hooks.has(\"onSend.B\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    hooks.remove(\"onSend.A\");\n    hooks.has(\"onSend.A\").should.be.false();\n    hooks.has(\"onSend.B\").should.be.true();\n    hooks.has(\"onSend\").should.be.true();\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        data.order.should.eql([\"B\"]);\n        hooks.remove(\"onSend.B\");\n        hooks.has(\"onSend.A\").should.be.false();\n        hooks.has(\"onSend.B\").should.be.false();\n        hooks.has(\"onSend\").should.be.false();\n        done(err);\n      } catch (err2) {\n        done(err2);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"cannot remove unlabelled hook","suites":["util/hooks"],"updatePoint":{"line":96,"column":35,"index":2913},"line":96,"code":"  it(\"cannot remove unlabelled hook\", function () {\n    hooks.add(\"onSend\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    (function () {\n      hooks.remove(\"onSend\");\n    }).should.throw();\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"removes all hooks with same label","suites":["util/hooks"],"updatePoint":{"line":104,"column":39,"index":3131},"line":104,"code":"  it(\"removes all hooks with same label\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    hooks.add(\"preRoute.A\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"preRoute.B\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      hooks.trigger(\"preRoute\", data, err => {\n        data.order.should.eql([\"A\", \"B\", \"C\", \"D\"]);\n        data.order = [];\n        hooks.remove(\"*.A\");\n        hooks.trigger(\"onSend\", data, err => {\n          data.order.should.eql([\"B\"]);\n          hooks.trigger(\"preRoute\", data, err => {\n            data.order.should.eql([\"B\", \"D\"]);\n          });\n          done(err);\n        });\n      });\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to remove itself whilst being called","suites":["util/hooks"],"updatePoint":{"line":136,"column":56,"index":4090},"line":136,"code":"  it(\"allows a hook to remove itself whilst being called\", function (done) {\n    let data = {\n      order: []\n    };\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      hooks.remove(\"*.B\");\n    });\n    hooks.add(\"onSend.C\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"onSend.D\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        should.not.exist(err);\n        data.order.should.eql([\"A\", \"C\", \"D\"]);\n        done();\n      } catch (e) {\n        done(e);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"allows a hook to remove itself and others whilst being called","suites":["util/hooks"],"updatePoint":{"line":162,"column":67,"index":4767},"line":162,"code":"  it(\"allows a hook to remove itself and others whilst being called\", function (done) {\n    let data = {\n      order: []\n    };\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      hooks.remove(\"*.B\");\n      hooks.remove(\"*.C\");\n    });\n    hooks.add(\"onSend.C\", function (payload) {\n      payload.order.push(\"C\");\n    });\n    hooks.add(\"onSend.D\", function (payload) {\n      payload.order.push(\"D\");\n    });\n    hooks.trigger(\"onSend\", data, err => {\n      try {\n        should.not.exist(err);\n        data.order.should.eql([\"A\", \"D\"]);\n        done();\n      } catch (e) {\n        done(e);\n      }\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"halts execution on return false","suites":["util/hooks"],"updatePoint":{"line":189,"column":37,"index":5436},"line":189,"code":"  it(\"halts execution on return false\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n      return false;\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      err.should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"halts execution on thrown error","suites":["util/hooks"],"updatePoint":{"line":206,"column":37,"index":5862},"line":206,"code":"  it(\"halts execution on thrown error\", function (done) {\n    hooks.add(\"onSend.A\", function (payload) {\n      payload.order.push(\"A\");\n      throw new Error(\"error\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function","suites":["util/hooks"],"updatePoint":{"line":224,"column":39,"index":6331},"line":224,"code":"  it(\"handler can use callback function\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done();\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - halt execution","suites":["util/hooks"],"updatePoint":{"line":242,"column":56,"index":6804},"line":242,"code":"  it(\"handler can use callback function - halt execution\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done(false);\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      err.should.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - halt on error","suites":["util/hooks"],"updatePoint":{"line":261,"column":55,"index":7302},"line":261,"code":"  it(\"handler can use callback function - halt on error\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        done(new Error(\"test error\"));\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function","suites":["util/hooks"],"updatePoint":{"line":280,"column":34,"index":7790},"line":280,"code":"  it(\"handler be an async function\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise(resolve => {\n        setTimeout(function () {\n          payload.order.push(\"A\");\n          resolve();\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function - halt execution","suites":["util/hooks"],"updatePoint":{"line":300,"column":51,"index":8317},"line":300,"code":"  it(\"handler be an async function - halt execution\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise(resolve => {\n        setTimeout(function () {\n          payload.order.push(\"A\");\n          resolve(false);\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([\"A\"]);\n      done(err);\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler be an async function - halt on error","suites":["util/hooks"],"updatePoint":{"line":320,"column":50,"index":8843},"line":320,"code":"  it(\"handler be an async function - halt on error\", function (done) {\n    hooks.add(\"onSend.A\", async function (payload) {\n      return new Promise((resolve, reject) => {\n        setTimeout(function () {\n          reject(new Error(\"test error\"));\n        }, 30);\n      });\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data, err => {\n      data.order.should.eql([]);\n      should.exist(err);\n      err.should.not.be.false();\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can use callback function - promise API","suites":["util/hooks"],"updatePoint":{"line":341,"column":53,"index":9416},"line":341,"code":"  it(\"handler can use callback function - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done();\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      data.order.should.eql([\"A\", \"B\"]);\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can halt execution - promise API","suites":["util/hooks"],"updatePoint":{"line":359,"column":46,"index":9892},"line":359,"code":"  it(\"handler can halt execution - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      setTimeout(function () {\n        payload.order.push(\"A\");\n        done(false);\n      }, 30);\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      data.order.should.eql([\"A\"]);\n      done();\n    }).catch(done);\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"handler can halt execution on error - promise API","suites":["util/hooks"],"updatePoint":{"line":377,"column":55,"index":10377},"line":377,"code":"  it(\"handler can halt execution on error - promise API\", function (done) {\n    hooks.add(\"onSend.A\", function (payload, done) {\n      throw new Error(\"error\");\n    });\n    hooks.add(\"onSend.B\", function (payload) {\n      payload.order.push(\"B\");\n    });\n    let data = {\n      order: []\n    };\n    hooks.trigger(\"onSend\", data).then(() => {\n      done(\"hooks.trigger resolved unexpectedly\");\n    }).catch(err => {\n      done();\n    });\n  });","file":"unit/@node-red/util/lib/hooks_spec.js","skipped":false,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util/i18n"],"line":20,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/i18n_spec.js","skipped":true,"dir":"test"},{"name":"more tests needed","suites":["@node-red/util"],"line":18,"code":"  it.skip('more tests needed', function () {});","file":"unit/@node-red/util/lib/index_spec.js","skipped":true,"dir":"test"},{"name":"it can raise an error","suites":["@node-red/util/log"],"updatePoint":{"line":37,"column":27,"index":1213},"line":37,"code":"  it('it can raise an error', function () {\n    var ret = log.error(\"This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a trace","suites":["@node-red/util/log"],"updatePoint":{"line":41,"column":26,"index":1379},"line":41,"code":"  it('it can raise a trace', function () {\n    var ret = log.trace(\"This is a trace\");\n    sinon.assert.calledWithMatch(util.log, \"[trace] This is a trace\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a debug","suites":["@node-red/util/log"],"updatePoint":{"line":45,"column":26,"index":1543},"line":45,"code":"  it('it can raise a debug', function () {\n    var ret = log.debug(\"This is a debug\");\n    sinon.assert.calledWithMatch(util.log, \"[debug] This is a debug\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a info","suites":["@node-red/util/log"],"updatePoint":{"line":49,"column":25,"index":1706},"line":49,"code":"  it('it can raise a info', function () {\n    var ret = log.info(\"This is an info\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a warn","suites":["@node-red/util/log"],"updatePoint":{"line":53,"column":25,"index":1867},"line":53,"code":"  it('it can raise a warn', function () {\n    var ret = log.warn(\"This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can raise a metric","suites":["@node-red/util/log"],"updatePoint":{"line":57,"column":27,"index":2028},"line":57,"code":"  it('it can raise a metric', function () {\n    var metrics = {};\n    metrics.level = log.METRIC;\n    metrics.nodeid = \"testid\";\n    metrics.event = \"node.test.testevent\";\n    metrics.msgid = \"12345\";\n    metrics.value = \"the metric payload\";\n    var ret = log.log(metrics);\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[metric] \").should.equal(0);\n    var body = JSON.parse(util.log.firstCall.args[0].substring(9));\n    body.should.have.a.property(\"nodeid\", \"testid\");\n    body.should.have.a.property(\"event\", \"node.test.testevent\");\n    body.should.have.a.property(\"msgid\", \"12345\");\n    body.should.have.a.property(\"value\", \"the metric payload\");\n    body.should.have.a.property(\"timestamp\");\n    body.should.have.a.property(\"level\", log.METRIC);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it checks metrics are enabled","suites":["@node-red/util/log"],"updatePoint":{"line":75,"column":35,"index":2829},"line":75,"code":"  it('it checks metrics are enabled', function () {\n    log.metric().should.equal(true);\n    var sett = {\n      logging: {\n        console: {\n          level: 'info',\n          metrics: false\n        }\n      }\n    };\n    log.init(sett);\n    log.metric().should.equal(false);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it logs node type and name if provided","suites":["@node-red/util/log"],"updatePoint":{"line":88,"column":44,"index":3119},"line":88,"code":"  it('it logs node type and name if provided', function () {\n    log.log({\n      level: log.INFO,\n      type: \"nodeType\",\n      msg: \"test\",\n      name: \"nodeName\",\n      id: \"nodeId\"\n    });\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[nodeType:nodeName]\").should.not.equal(-1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it logs node type and id if no name provided","suites":["@node-red/util/log"],"updatePoint":{"line":99,"column":50,"index":3449},"line":99,"code":"  it('it logs node type and id if no name provided', function () {\n    log.log({\n      level: log.INFO,\n      type: \"nodeType\",\n      msg: \"test\",\n      id: \"nodeId\"\n    });\n    util.log.calledOnce.should.be.true();\n    util.log.firstCall.args[0].indexOf(\"[nodeType:nodeId]\").should.not.equal(-1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"ignores lower level messages and metrics","suites":["@node-red/util/log"],"updatePoint":{"line":109,"column":46,"index":3749},"line":109,"code":"  it('ignores lower level messages and metrics', function () {\n    var settings = {\n      logging: {\n        console: {\n          level: 'warn',\n          metrics: false\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"ignores lower level messages but accepts metrics","suites":["@node-red/util/log"],"updatePoint":{"line":135,"column":54,"index":4651},"line":135,"code":"  it('ignores lower level messages but accepts metrics', function () {\n    var settings = {\n      logging: {\n        console: {\n          level: 'log',\n          metrics: true\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.calledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"default settings set to INFO and metrics off","suites":["@node-red/util/log"],"updatePoint":{"line":161,"column":50,"index":5537},"line":161,"code":"  it('default settings set to INFO and metrics off', function () {\n    log.init({\n      logging: {}\n    });\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.calledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.calledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.calledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"no logger used if custom logger handler does not exist","suites":["@node-red/util/log"],"updatePoint":{"line":181,"column":60,"index":6325},"line":181,"code":"  it('no logger used if custom logger handler does not exist', function () {\n    var settings = {\n      logging: {\n        customLogger: {\n          level: 'trace',\n          metrics: true\n        }\n      }\n    };\n    log.init(settings);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    sinon.assert.neverCalledWithMatch(util.log, \"[error] This is an error\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[warn] This is a warn\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[info] This is an info\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[debug] This is a debug\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[trace] This is a trace\");\n    sinon.assert.neverCalledWithMatch(util.log, \"[metric] \");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"add a custom log handler directly","suites":["@node-red/util/log"],"updatePoint":{"line":207,"column":39,"index":7227},"line":207,"code":"  it('add a custom log handler directly', function () {\n    var settings = {};\n    log.init(settings);\n    var logEvents = [];\n    var loggerOne = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 1,\n          msg: msg\n        });\n      }\n    };\n    var loggerTwo = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 2,\n          msg: msg\n        });\n      }\n    };\n    log.addHandler(loggerOne);\n    log.addHandler(loggerTwo);\n    log.error(\"This is an error\");\n    log.warn(\"This is a warn\");\n    log.info(\"This is an info\");\n    log.debug(\"This is a debug\");\n    log.trace(\"This is a trace\");\n    log.log({\n      level: log.METRIC,\n      msg: \"testMetric\"\n    });\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(6);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(6);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"remove a custom log handler directly","suites":["@node-red/util/log"],"updatePoint":{"line":245,"column":42,"index":8166},"line":245,"code":"  it('remove a custom log handler directly', function () {\n    var settings = {};\n    log.init(settings);\n    var logEvents = [];\n    var loggerOne = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 1,\n          msg: msg\n        });\n      }\n    };\n    var loggerTwo = {\n      emit: function (event, msg) {\n        logEvents.push({\n          logger: 2,\n          msg: msg\n        });\n      }\n    };\n    log.addHandler(loggerOne);\n    log.addHandler(loggerTwo);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(1);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n    log.removeHandler(loggerTwo);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(2);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n    log.removeHandler(loggerOne);\n    log.info(\"This is an info\");\n    logEvents.filter(function (evt) {\n      return evt.logger === 1;\n    }).should.have.lengthOf(2);\n    logEvents.filter(function (evt) {\n      return evt.logger === 2;\n    }).should.have.lengthOf(1);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can log without exception","suites":["@node-red/util/log"],"updatePoint":{"line":291,"column":34,"index":9429},"line":291,"code":"  it('it can log without exception', function () {\n    var msg = {\n      msg: {\n        mystrangeobj: \"hello\"\n      }\n    };\n    msg.msg.toString = function () {\n      throw new Error('Exception in toString - should have been caught');\n    };\n    msg.msg.constructor = {\n      name: \"strangeobj\"\n    };\n    var ret = log.info(msg.msg);\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"it can log an object but use .message","suites":["@node-red/util/log"],"updatePoint":{"line":305,"column":43,"index":9780},"line":305,"code":"  it('it can log an object but use .message', function () {\n    var msg = {\n      msg: {\n        message: \"my special message\",\n        mystrangeobj: \"hello\"\n      }\n    };\n    var ret = log.info(msg.msg);\n    sinon.assert.calledWithMatch(util.log, \"my special message\");\n  });","file":"unit/@node-red/util/lib/log_spec.js","skipped":false,"dir":"test"},{"name":"generates an id","suites":["@node-red/util/util","generateId"],"updatePoint":{"line":21,"column":23,"index":879},"line":21,"code":"    it('generates an id', function () {\n      var id = util.generateId();\n      var id2 = util.generateId();\n      id.should.not.eql(id2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"numbers","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":28,"column":15,"index":1067},"line":28,"code":"    it('numbers', function () {\n      util.compareObjects(0, 0).should.equal(true);\n      util.compareObjects(0, 1).should.equal(false);\n      util.compareObjects(1000, 1001).should.equal(false);\n      util.compareObjects(1000, 1000).should.equal(true);\n      util.compareObjects(0, \"0\").should.equal(false);\n      util.compareObjects(1, \"1\").should.equal(false);\n      util.compareObjects(0, null).should.equal(false);\n      util.compareObjects(0, undefined).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"strings","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":38,"column":15,"index":1556},"line":38,"code":"    it('strings', function () {\n      util.compareObjects(\"\", \"\").should.equal(true);\n      util.compareObjects(\"a\", \"a\").should.equal(true);\n      util.compareObjects(\"\", null).should.equal(false);\n      util.compareObjects(\"\", undefined).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"arrays","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":44,"column":14,"index":1824},"line":44,"code":"    it('arrays', function () {\n      util.compareObjects([\"a\"], [\"a\"]).should.equal(true);\n      util.compareObjects([\"a\"], [\"a\", \"b\"]).should.equal(false);\n      util.compareObjects([\"a\", \"b\"], [\"b\"]).should.equal(false);\n      util.compareObjects([\"a\"], \"a\").should.equal(false);\n      util.compareObjects([[1], [\"a\"]], [[1], [\"a\"]]).should.equal(true);\n      util.compareObjects([[1], [\"a\"]], [[\"a\"], [1]]).should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"objects","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":52,"column":15,"index":2264},"line":52,"code":"    it('objects', function () {\n      util.compareObjects({\n        \"a\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(false);\n      util.compareObjects({\n        \"a\": 1,\n        \"b\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(true);\n      util.compareObjects({\n        \"b\": 1,\n        \"a\": 1\n      }, {\n        \"a\": 1,\n        \"b\": 1\n      }).should.equal(true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffer","suites":["@node-red/util/util","compareObjects"],"updatePoint":{"line":74,"column":14,"index":2678},"line":74,"code":"    it('Buffer', function () {\n      util.compareObjects(Buffer.from(\"hello\"), Buffer.from(\"hello\")).should.equal(true);\n      util.compareObjects(Buffer.from(\"hello\"), Buffer.from(\"hello \")).should.equal(false);\n      util.compareObjects(Buffer.from(\"hello\"), \"hello\").should.equal(false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"strings are preserved","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":81,"column":29,"index":3039},"line":81,"code":"    it('strings are preserved', function () {\n      util.ensureString('string').should.equal('string');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffer is converted","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":84,"column":27,"index":3149},"line":84,"code":"    it('Buffer is converted', function () {\n      var s = util.ensureString(Buffer.from('foo'));\n      s.should.equal('foo');\n      (typeof s).should.equal('string');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Object is converted to JSON","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":89,"column":35,"index":3332},"line":89,"code":"    it('Object is converted to JSON', function () {\n      var s = util.ensureString({\n        foo: \"bar\"\n      });\n      (typeof s).should.equal('string');\n      should.deepEqual(JSON.parse(s), {\n        foo: \"bar\"\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"stringifies other things","suites":["@node-red/util/util","ensureString"],"updatePoint":{"line":98,"column":32,"index":3562},"line":98,"code":"    it('stringifies other things', function () {\n      var s = util.ensureString(123);\n      (typeof s).should.equal('string');\n      s.should.equal('123');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Buffers are preserved","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":105,"column":29,"index":3771},"line":105,"code":"    it('Buffers are preserved', function () {\n      var b = Buffer.from('');\n      util.ensureBuffer(b).should.equal(b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"string is converted","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":109,"column":27,"index":3898},"line":109,"code":"    it('string is converted', function () {\n      var b = util.ensureBuffer('foo');\n      var expected = Buffer.from('foo');\n      for (var i = 0; i < expected.length; i++) {\n        b[i].should.equal(expected[i]);\n      }\n      Buffer.isBuffer(b).should.equal(true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"Object is converted to JSON","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":117,"column":35,"index":4182},"line":117,"code":"    it('Object is converted to JSON', function () {\n      var obj = {\n        foo: \"bar\"\n      };\n      var b = util.ensureBuffer(obj);\n      Buffer.isBuffer(b).should.equal(true);\n      should.deepEqual(JSON.parse(b), obj);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"stringifies other things","suites":["@node-red/util/util","ensureBuffer"],"updatePoint":{"line":125,"column":32,"index":4412},"line":125,"code":"    it('stringifies other things', function () {\n      var b = util.ensureBuffer(123);\n      Buffer.isBuffer(b).should.equal(true);\n      var expected = Buffer.from('123');\n      for (var i = 0; i < expected.length; i++) {\n        b[i].should.equal(expected[i]);\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"clones a simple message","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":135,"column":31,"index":4737},"line":135,"code":"    it('clones a simple message', function () {\n      var msg = {\n        string: \"hi\",\n        array: [1, 2, 3],\n        object: {\n          a: 1,\n          subobject: {\n            b: 2\n          }\n        }\n      };\n      var cloned = util.cloneMessage(msg);\n      cloned.should.eql(msg);\n      cloned.should.not.equal(msg);\n      cloned.array.should.not.equal(msg.string);\n      cloned.object.should.not.equal(msg.object);\n      cloned.object.subobject.should.not.equal(msg.object.subobject);\n      cloned.should.not.have.property(\"req\");\n      cloned.should.not.have.property(\"res\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not clone http req/res properties","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":155,"column":46,"index":5349},"line":155,"code":"    it('does not clone http req/res properties', function () {\n      var msg = {\n        req: {\n          a: 1\n        },\n        res: {\n          b: 2\n        }\n      };\n      var cloned = util.cloneMessage(msg);\n      cloned.should.eql(msg);\n      cloned.should.not.equal(msg);\n      cloned.req.should.equal(msg.req);\n      cloned.res.should.equal(msg.res);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles undefined values without throwing an error","suites":["@node-red/util/util","cloneMessage"],"updatePoint":{"line":170,"column":58,"index":5729},"line":170,"code":"    it('handles undefined values without throwing an error', function () {\n      var result = util.cloneMessage(undefined);\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"gets a property beginning with \"msg.\"","suites":["@node-red/util/util","getObjectProperty"],"updatePoint":{"line":176,"column":45,"index":5932},"line":176,"code":"    it('gets a property beginning with \"msg.\"', function () {\n      // getMessageProperty strips off `msg.` prefixes.\n      // getObjectProperty does not\n      var obj = {\n        msg: {\n          a: \"foo\"\n        },\n        a: \"bar\"\n      };\n      var v = util.getObjectProperty(obj, \"msg.a\");\n      v.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a simple property","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":190,"column":35,"index":6305},"line":190,"code":"    it('retrieves a simple property', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\"\n      }, \"msg.a\");\n      v.should.eql(\"foo\");\n      var v2 = util.getMessageProperty({\n        a: \"foo\"\n      }, \"a\");\n      v2.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a nested property","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":200,"column":35,"index":6569},"line":200,"code":"    it('retrieves a nested property', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\",\n        b: {\n          foo: 1,\n          bar: 2\n        }\n      }, \"msg.b[msg.a]\");\n      v.should.eql(1);\n      var v2 = util.getMessageProperty({\n        a: \"bar\",\n        b: {\n          foo: 1,\n          bar: 2\n        }\n      }, \"b[msg.a]\");\n      v2.should.eql(2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should return undefined if property does not exist","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":218,"column":58,"index":6980},"line":218,"code":"    it('should return undefined if property does not exist', function () {\n      var v = util.getMessageProperty({\n        a: \"foo\"\n      }, \"msg.b\");\n      should.not.exist(v);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"should throw error if property parent does not exist","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":224,"column":60,"index":7168},"line":224,"code":"    it('should throw error if property parent does not exist', function () {\n      /*jshint immed: false */\n      (function () {\n        util.getMessageProperty({\n          a: \"foo\"\n        }, \"msg.a.b.c\");\n      }).should.throw();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"retrieves a property with array syntax","suites":["@node-red/util/util","getMessageProperty"],"updatePoint":{"line":232,"column":46,"index":7394},"line":232,"code":"    it('retrieves a property with array syntax', function () {\n      var v = util.getMessageProperty({\n        a: [\"foo\", \"bar\"]\n      }, \"msg.a[0]\");\n      v.should.eql(\"foo\");\n      var v2 = util.getMessageProperty({\n        a: [null, {\n          b: \"foo\"\n        }]\n      }, \"a[1].b\");\n      v2.should.eql(\"foo\");\n      var v3 = util.getMessageProperty({\n        a: [[[\"foo\"]]]\n      }, \"a[0][0][0]\");\n      v3.should.eql(\"foo\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"set a property beginning with \"msg.\"","suites":["@node-red/util/util","setObjectProperty"],"updatePoint":{"line":250,"column":44,"index":7885},"line":250,"code":"    it('set a property beginning with \"msg.\"', function () {\n      // setMessageProperty strips off `msg.` prefixes.\n      // setObjectProperty does not\n      var obj = {};\n      var result = util.setObjectProperty(obj, \"msg.a\", \"bar\");\n      result.should.be.true();\n      obj.should.have.property(\"msg\");\n      obj.msg.should.have.property(\"a\", \"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":261,"column":23,"index":8280},"line":261,"code":"    it('sets a property', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a\", \"bar\");\n      result.should.be.true();\n      msg.a.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a deep level property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":269,"column":34,"index":8510},"line":269,"code":"    it('sets a deep level property', function () {\n      var msg = {\n        a: {\n          b: {\n            c: \"foo\"\n          }\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\");\n      result.should.be.true();\n      msg.a.b.c.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing parent properties by default","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":281,"column":52,"index":8820},"line":281,"code":"    it('creates missing parent properties by default', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\");\n      result.should.be.true();\n      msg.a.b.c.should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":289,"column":49,"index":9070},"line":289,"code":"    it('does not create missing parent properties', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of array","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":297,"column":58,"index":9335},"line":297,"code":"    it('does not create missing parent properties of array', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[1].c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of string","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":305,"column":59,"index":9604},"line":305,"code":"    it('does not create missing parent properties of string', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing string property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":313,"column":57,"index":9871},"line":313,"code":"    it('does not set property of existing string property', function () {\n      var msg = {\n        a: \"foo\"\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing number property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":321,"column":57,"index":10136},"line":321,"code":"    it('does not set property of existing number property', function () {\n      var msg = {\n        a: 123\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of number","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":329,"column":59,"index":10401},"line":329,"code":"    it('does not create missing parent properties of number', function () {\n      var msg = {\n        a: 123\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not set property of existing boolean property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":337,"column":58,"index":10667},"line":337,"code":"    it('does not set property of existing boolean property', function () {\n      var msg = {\n        a: true\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties of boolean","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":345,"column":60,"index":10934},"line":345,"code":"    it('does not create missing parent properties of boolean', function () {\n      var msg = {\n        a: true\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"deletes property if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":353,"column":46,"index":11189},"line":353,"code":"    it('deletes property if value is undefined', function () {\n      var msg = {\n        a: {\n          b: {\n            c: \"foo\"\n          }\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", undefined);\n      result.should.be.true();\n      should.not.exist(msg.a.b.c);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing parent properties if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":365,"column":71,"index":11522},"line":365,"code":"    it('does not create missing parent properties if value is undefined', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b.c\", undefined);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"sets a property with array syntax","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":373,"column":41,"index":11767},"line":373,"code":"    it('sets a property with array syntax', function () {\n      var msg = {\n        a: {\n          b: [\"foo\", {\n            c: [\"\", \"\"]\n          }]\n        }\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[1].c[1]\", \"bar\");\n      result.should.be.true();\n      msg.a.b[1].c[1].should.eql('bar');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - final property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":385,"column":55,"index":12104},"line":385,"code":"    it('creates missing array elements - final property', function () {\n      var msg = {\n        a: []\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[2]\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a[2].should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - mid property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":394,"column":53,"index":12391},"line":394,"code":"    it('creates missing array elements - mid property', function () {\n      var msg = {};\n      var result = util.setMessageProperty(msg, \"msg.a[2].b\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a[2].b.should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"creates missing array elements - multi-arrays","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":401,"column":53,"index":12661},"line":401,"code":"    it('creates missing array elements - multi-arrays', function () {\n      var msg = {};\n      var result = util.setMessageProperty(msg, \"msg.a[2][2]\", \"bar\");\n      result.should.be.true();\n      msg.a.should.have.length(3);\n      msg.a.should.be.instanceOf(Array);\n      msg.a[2].should.have.length(3);\n      msg.a[2].should.be.instanceOf(Array);\n      msg.a[2][2].should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing array elements - mid property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":411,"column":61,"index":13064},"line":411,"code":"    it('does not create missing array elements - mid property', function () {\n      var msg = {\n        a: []\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[1][1]\", \"bar\", false);\n      result.should.be.false();\n      msg.a.should.empty();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"does not create missing array elements - final property","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":419,"column":63,"index":13331},"line":419,"code":"    it('does not create missing array elements - final property', function () {\n      var msg = {\n        a: {}\n      };\n      var result = util.setMessageProperty(msg, \"msg.a.b[2]\", \"bar\", false);\n      result.should.be.false();\n      should.not.exist(msg.a.b);\n      // check it has not been misinterpreted\n      msg.a.should.not.have.property(\"b[2]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"deletes property inside array if value is undefined","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":429,"column":59,"index":13690},"line":429,"code":"    it('deletes property inside array if value is undefined', function () {\n      var msg = {\n        a: [1, 2, 3]\n      };\n      var result = util.setMessageProperty(msg, \"msg.a[1]\", undefined);\n      result.should.be.true();\n      msg.a.should.have.length(2);\n      msg.a[0].should.eql(1);\n      msg.a[1].should.eql(3);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles nested message property references","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":439,"column":50,"index":14011},"line":439,"code":"    it('handles nested message property references', function () {\n      var obj = {\n        a: \"foo\",\n        b: {}\n      };\n      var result = util.setObjectProperty(obj, \"b[msg.a]\", \"bar\");\n      result.should.be.true();\n      obj.b.should.have.property(\"foo\", \"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles nested message property references","suites":["@node-red/util/util","setMessageProperty"],"updatePoint":{"line":448,"column":50,"index":14291},"line":448,"code":"    it('handles nested message property references', function () {\n      var obj = {\n        a: \"foo\",\n        b: {\n          \"foo\": [0, 0, 0]\n        }\n      };\n      var result = util.setObjectProperty(obj, \"b[msg.a][2]\", \"bar\");\n      result.should.be.true();\n      obj.b.foo.should.eql([0, 0, \"bar\"]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns string","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":461,"column":22,"index":14632},"line":461,"code":"    it('returns string', function () {\n      var result = util.evaluateNodeProperty('hello', 'str');\n      result.should.eql('hello');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns number","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":465,"column":22,"index":14775},"line":465,"code":"    it('returns number', function () {\n      var result = util.evaluateNodeProperty('0123', 'num');\n      result.should.eql(123);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns evaluated json","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":469,"column":30,"index":14921},"line":469,"code":"    it('returns evaluated json', function () {\n      var result = util.evaluateNodeProperty('{\"a\":123}', 'json');\n      result.should.eql({\n        a: 123\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns regex","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":475,"column":21,"index":15085},"line":475,"code":"    it('returns regex', function () {\n      var result = util.evaluateNodeProperty('^abc$', 're');\n      result.toString().should.eql(\"/^abc$/\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns boolean","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":479,"column":23,"index":15241},"line":479,"code":"    it('returns boolean', function () {\n      var result = util.evaluateNodeProperty('true', 'bool');\n      result.should.be.true();\n      result = util.evaluateNodeProperty('TrUe', 'bool');\n      result.should.be.true();\n      result = util.evaluateNodeProperty('false', 'bool');\n      result.should.be.false();\n      result = util.evaluateNodeProperty('', 'bool');\n      result.should.be.false();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns date","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":489,"column":20,"index":15645},"line":489,"code":"    it('returns date', function () {\n      var result = util.evaluateNodeProperty('', 'date');\n      (Date.now() - result).should.be.approximately(0, 50);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns bin","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":493,"column":19,"index":15807},"line":493,"code":"    it('returns bin', function () {\n      var result = util.evaluateNodeProperty('[1, 2]', 'bin');\n      result[0].should.eql(1);\n      result[1].should.eql(2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if buffer data is not array or string","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":498,"column":61,"index":16018},"line":498,"code":"    it('throws an error if buffer data is not array or string', function (done) {\n      try {\n        var result = util.evaluateNodeProperty('12', 'bin');\n        done(\"should throw an error\");\n      } catch (err) {\n        if (err.code === \"INVALID_BUFFER_DATA\") {\n          done();\n        } else {\n          done(\"should throw an error\");\n        }\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns msg property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":510,"column":28,"index":16353},"line":510,"code":"    it('returns msg property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'msg', {}, {\n        foo: {\n          bar: \"123\"\n        }\n      });\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"throws an error if callback is not defined","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":518,"column":50,"index":16585},"line":518,"code":"    it('throws an error if callback is not defined', function (done) {\n      try {\n        util.evaluateNodeProperty(' ', 'msg', {}, {\n          foo: {\n            bar: \"123\"\n          }\n        });\n        done(\"should throw an error\");\n      } catch (err) {\n        done();\n      }\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns flow property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":530,"column":29,"index":16856},"line":530,"code":"    it('returns flow property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'flow', {\n        context: function () {\n          return {\n            flow: {\n              get: function (k) {\n                if (k === 'foo.bar') {\n                  return '123';\n                } else {\n                  return null;\n                }\n              }\n            }\n          };\n        }\n      }, {});\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns global property","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":548,"column":31,"index":17326},"line":548,"code":"    it('returns global property', function () {\n      var result = util.evaluateNodeProperty('foo.bar', 'global', {\n        context: function () {\n          return {\n            global: {\n              get: function (k) {\n                if (k === 'foo.bar') {\n                  return '123';\n                } else {\n                  return null;\n                }\n              }\n            }\n          };\n        }\n      }, {});\n      result.should.eql(\"123\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns jsonata result","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":566,"column":30,"index":17799},"line":566,"code":"    it('returns jsonata result', function () {\n      var result = util.evaluateNodeProperty('$abs(-1)', 'jsonata', {}, {});\n      result.should.eql(1);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns null","suites":["@node-red/util/util","evaluateNodeProperty"],"updatePoint":{"line":570,"column":20,"index":17949},"line":570,"code":"    it('returns null', function () {\n      var result = util.evaluateNodeProperty(null, 'null');\n      (result === null).should.be.true();\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - NR_TEST_A","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":583,"column":53,"index":18416},"line":583,"code":"      it('returns an environment variable - NR_TEST_A', function () {\n        var result = util.evaluateNodeProperty('NR_TEST_A', 'env');\n        result.should.eql('foo');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - ${NR_TEST_A}","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":587,"column":56,"index":18601},"line":587,"code":"      it('returns an environment variable - ${NR_TEST_A}', function () {\n        var result = util.evaluateNodeProperty('${NR_TEST_A}', 'env');\n        result.should.eql('foo');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - ${NR_TEST_A","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":591,"column":55,"index":18788},"line":591,"code":"      it('returns an environment variable - ${NR_TEST_A', function () {\n        var result = util.evaluateNodeProperty('${NR_TEST_A', 'env');\n        result.should.eql('');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - foo${NR_TEST_A}bar","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":595,"column":62,"index":18978},"line":595,"code":"      it('returns an environment variable - foo${NR_TEST_A}bar', function () {\n        var result = util.evaluateNodeProperty('123${NR_TEST_A}456', 'env');\n        result.should.eql('123foo456');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"returns an environment variable - foo${NR_TEST_B}bar","suites":["@node-red/util/util","evaluateNodeProperty","environment variable"],"updatePoint":{"line":599,"column":62,"index":19184},"line":599,"code":"      it('returns an environment variable - foo${NR_TEST_B}bar', function () {\n        var result = util.evaluateNodeProperty('123${NR_TEST_B}456', 'env');\n        result.should.eql('123${NR_TEST_A}456');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":630,"column":18,"index":20250},"line":630,"code":"    it('pass a.b.c', function () {\n      testABC('a.b.c', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"b\"][\"c\"]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":633,"column":24,"index":20340},"line":633,"code":"    it('pass a[\"b\"][\"c\"]', function () {\n      testABC('a[\"b\"][\"c\"]', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":636,"column":21,"index":20433},"line":636,"code":"    it('pass a[\"b\"].c', function () {\n      testABC('a[\"b\"].c', ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['b'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":639,"column":21,"index":20523},"line":639,"code":"    it(\"pass a['b'].c\", function () {\n      testABC(\"a['b'].c\", ['a', 'b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[0].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":642,"column":19,"index":20611},"line":642,"code":"    it(\"pass a[0].c\", function () {\n      testABC(\"a[0].c\", ['a', 0, 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.0.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":645,"column":18,"index":20694},"line":645,"code":"    it(\"pass a.0.c\", function () {\n      testABC(\"a.0.c\", ['a', 0, 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['a.b[0]'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":648,"column":26,"index":20784},"line":648,"code":"    it(\"pass a['a.b[0]'].c\", function () {\n      testABC(\"a['a.b[0]'].c\", ['a', 'a.b[0]', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[0][0][0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":651,"column":23,"index":20886},"line":651,"code":"    it(\"pass a[0][0][0]\", function () {\n      testABC(\"a[0][0][0]\", ['a', 0, 0, 0]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass '1.2.3.4'","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":654,"column":22,"index":20978},"line":654,"code":"    it(\"pass '1.2.3.4'\", function () {\n      testABC(\"'1.2.3.4'\", ['1.2.3.4']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass 'a.b'[1]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":657,"column":21,"index":21065},"line":657,"code":"    it(\"pass 'a.b'[1]\", function () {\n      testABC(\"'a.b'[1]\", ['a.b', 1]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass 'a.b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":660,"column":20,"index":21149},"line":660,"code":"    it(\"pass 'a.b'.c\", function () {\n      testABC(\"'a.b'.c\", ['a.b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":663,"column":21,"index":21235},"line":663,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg[msg.b]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":666,"column":26,"index":21334},"line":666,"code":"    it(\"pass a[msg[msg.b]]\", function () {\n      testABC(\"a[msg[msg.b]]\", [\"a\", [\"msg\", [\"msg\", \"b\"]]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":669,"column":21,"index":21442},"line":669,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":672,"column":21,"index":21536},"line":672,"code":"    it(\"pass a[msg.b]\", function () {\n      testABC(\"a[msg.b]\", [\"a\", [\"msg\", \"b\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg['b]\"[']]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":675,"column":28,"index":21637},"line":675,"code":"    it(\"pass a[msg['b]\\\"[']]\", function () {\n      testABC(\"a[msg['b]\\\"[']]\", [\"a\", [\"msg\", \"b]\\\"[\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg['b][']]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":678,"column":26,"index":21747},"line":678,"code":"    it(\"pass a[msg['b][']]\", function () {\n      testABC(\"a[msg['b][']]\", [\"a\", [\"msg\", \"b][\"]]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass b[msg.a][2]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":681,"column":24,"index":21851},"line":681,"code":"    it(\"pass b[msg.a][2]\", function () {\n      testABC(\"b[msg.a][2]\", [\"b\", [\"msg\", \"a\"], 2]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass b[msg.a][2] (with message)","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":684,"column":39,"index":21969},"line":684,"code":"    it(\"pass b[msg.a][2] (with message)\", function () {\n      testABCWithMessage(\"b[msg.a][2]\", {\n        a: \"foo\"\n      }, [\"b\", \"foo\", 2]);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.$b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":689,"column":19,"index":22099},"line":689,"code":"    it('pass a.$b.c', function () {\n      testABC('a.$b.c', ['a', '$b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"$b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":692,"column":22,"index":22189},"line":692,"code":"    it('pass a[\"$b\"].c', function () {\n      testABC('a[\"$b\"].c', ['a', '$b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a._b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":695,"column":19,"index":22279},"line":695,"code":"    it('pass a._b.c', function () {\n      testABC('a._b.c', ['a', '_b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[\"_b\"].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":698,"column":22,"index":22369},"line":698,"code":"    it('pass a[\"_b\"].c', function () {\n      testABC('a[\"_b\"].c', ['a', '_b', 'c']);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a['a.b[0]'].c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":701,"column":26,"index":22466},"line":701,"code":"    it(\"pass a['a.b[0]'].c\", function () {\n      testToString(\"a['a.b[0]'].c\", null, 'a[\"a.b[0]\"][\"c\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a.b.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":704,"column":18,"index":22572},"line":704,"code":"    it(\"pass a.b.c\", function () {\n      testToString(\"a.b.c\", null, 'a[\"b\"][\"c\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a[msg.c][0][\"fred\"]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":707,"column":32,"index":22679},"line":707,"code":"    it('pass a[msg.c][0][\"fred\"]', function () {\n      testToString('a[msg.c][0][\"fred\"]', {\n        c: \"123\"\n      }, 'a[\"123\"][0][\"fred\"]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a'b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":712,"column":19,"index":22817},"line":712,"code":"    it(\"fail a'b'.c\", function () {\n      testInvalid(\"a'b'.c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['b'.c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":715,"column":20,"index":22891},"line":715,"code":"    it(\"fail a['b'.c\", function () {\n      testInvalid(\"a['b'.c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":718,"column":16,"index":22962},"line":718,"code":"    it(\"fail a[]\", function () {\n      testInvalid(\"a[]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":721,"column":15,"index":23028},"line":721,"code":"    it(\"fail a]\", function () {\n      testInvalid(\"a]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":724,"column":15,"index":23093},"line":724,"code":"    it(\"fail a[\", function () {\n      testInvalid(\"a[\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0d]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":727,"column":18,"index":23161},"line":727,"code":"    it(\"fail a[0d]\", function () {\n      testInvalid(\"a[0d]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":730,"column":16,"index":23230},"line":730,"code":"    it(\"fail a['\", function () {\n      testInvalid(\"a['\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":733,"column":17,"index":23298},"line":733,"code":"    it(\"fail a[']\", function () {\n      testInvalid(\"a[']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":736,"column":18,"index":23368},"line":736,"code":"    it(\"fail a[0']\", function () {\n      testInvalid(\"a[0']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a.[0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":739,"column":18,"index":23439},"line":739,"code":"    it(\"fail a.[0]\", function () {\n      testInvalid(\"a.[0]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail [0]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":742,"column":16,"index":23508},"line":742,"code":"    it(\"fail [0]\", function () {\n      testInvalid(\"[0]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":745,"column":16,"index":23575},"line":745,"code":"    it(\"fail a[0\", function () {\n      testInvalid(\"a[0\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a.","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":748,"column":15,"index":23641},"line":748,"code":"    it(\"fail a.\", function () {\n      testInvalid(\"a.\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail .a","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":751,"column":15,"index":23706},"line":751,"code":"    it(\"fail .a\", function () {\n      testInvalid(\".a\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a. b","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":754,"column":17,"index":23773},"line":754,"code":"    it(\"fail a. b\", function () {\n      testInvalid(\"a. b\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail  a.b","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":757,"column":17,"index":23842},"line":757,"code":"    it(\"fail  a.b\", function () {\n      testInvalid(\" a.b\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[0].[1]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":760,"column":21,"index":23915},"line":760,"code":"    it(\"fail a[0].[1]\", function () {\n      testInvalid(\"a[0].[1]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a['']","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":763,"column":18,"index":23989},"line":763,"code":"    it(\"fail a['']\", function () {\n      testInvalid(\"a['']\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail 'a.b'c","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":766,"column":19,"index":24061},"line":766,"code":"    it(\"fail 'a.b'c\", function () {\n      testInvalid(\"'a.b'c\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail <blank>","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":769,"column":20,"index":24135},"line":769,"code":"    it(\"fail <blank>\", function () {\n      testInvalid(\"\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[b]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":772,"column":17,"index":24200},"line":772,"code":"    it(\"fail a[b]\", function () {\n      testInvalid(\"a[b]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg.]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":775,"column":20,"index":24272},"line":775,"code":"    it(\"fail a[msg.]\", function () {\n      testInvalid(\"a[msg.]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg[]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":778,"column":20,"index":24347},"line":778,"code":"    it(\"fail a[msg[]\", function () {\n      testInvalid(\"a[msg[]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg.[]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":781,"column":22,"index":24424},"line":781,"code":"    it(\"fail a[msg.[]]\", function () {\n      testInvalid(\"a[msg.[]]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail a[msg['af]]","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":784,"column":24,"index":24505},"line":784,"code":"    it(\"fail a[msg['af]]\", function () {\n      testInvalid(\"a[msg['af]]\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"fail b[msg.undefined][2] (with message)","suites":["@node-red/util/util","normalisePropertyExpression"],"updatePoint":{"line":787,"column":47,"index":24611},"line":787,"code":"    it(\"fail b[msg.undefined][2] (with message)\", function () {\n      testInvalid(\"b[msg.undefined][2]\", {});\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass blank","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":796,"column":18,"index":24893},"line":796,"code":"    it('pass blank', function () {\n      normalise(\"\", \"\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass ab1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":799,"column":16,"index":24959},"line":799,"code":"    it('pass ab1', function () {\n      normalise(\"ab1\", \"ab1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass AB1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":802,"column":16,"index":25031},"line":802,"code":"    it('pass AB1', function () {\n      normalise(\"AB1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a b 1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":805,"column":18,"index":25105},"line":805,"code":"    it('pass a b 1', function () {\n      normalise(\"a b 1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass a-b-1","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":808,"column":18,"index":25181},"line":808,"code":"    it('pass a-b-1', function () {\n      normalise(\"a-b-1\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass  ab1 ","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":811,"column":18,"index":25257},"line":811,"code":"    it('pass  ab1 ', function () {\n      normalise(\" ab1 \", \"ab1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass _a_b_1_","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":814,"column":20,"index":25335},"line":814,"code":"    it('pass _a_b_1_', function () {\n      normalise(\"_a_b_1_\", \"aB1\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass http request","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":817,"column":25,"index":25420},"line":817,"code":"    it('pass http request', function () {\n      normalise(\"http request\", \"httpRequest\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"pass HttpRequest","suites":["@node-red/util/util","normaliseNodeTypeName"],"updatePoint":{"line":820,"column":24,"index":25517},"line":820,"code":"    it('pass HttpRequest', function () {\n      normalise(\"HttpRequest\", \"httpRequest\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"prepares an expression","suites":["@node-red/util/util","prepareJSONataExpression"],"updatePoint":{"line":825,"column":30,"index":25678},"line":825,"code":"    it('prepares an expression', function () {\n      var result = util.prepareJSONataExpression('payload', {});\n      result.should.have.property('evaluate');\n      result.should.have.property('assign');\n      result.should.have.property('_legacyMode', false);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"prepares a legacyMode expression","suites":["@node-red/util/util","prepareJSONataExpression"],"updatePoint":{"line":831,"column":40,"index":25957},"line":831,"code":"    it('prepares a legacyMode expression', function () {\n      var result = util.prepareJSONataExpression('msg.payload', {});\n      result.should.have.property('evaluate');\n      result.should.have.property('assign');\n      result.should.have.property('_legacyMode', true);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"evaluates an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":839,"column":31,"index":26290},"line":839,"code":"    it('evaluates an expression', function () {\n      var expr = util.prepareJSONataExpression('payload', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"hello\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"evaluates a legacyMode expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":846,"column":41,"index":26546},"line":846,"code":"    it('evaluates a legacyMode expression', function () {\n      var expr = util.prepareJSONataExpression('msg.payload', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"hello\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses flow context from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":853,"column":48,"index":26813},"line":853,"code":"    it('accesses flow context from an expression', function () {\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      result.should.eql(\"bar\");\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses undefined environment variable from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":872,"column":66,"index":27350},"line":872,"code":"    it('accesses undefined environment variable from an expression', function () {\n      var expr = util.prepareJSONataExpression('$env(\"UTIL_ENV\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses environment variable from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":877,"column":56,"index":27593},"line":877,"code":"    it('accesses environment variable from an expression', function () {\n      process.env.UTIL_ENV = 'foo';\n      var expr = util.prepareJSONataExpression('$env(\"UTIL_ENV\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('foo');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses moment from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":883,"column":42,"index":27861},"line":883,"code":"    it('accesses moment from an expression', function () {\n      var expr = util.prepareJSONataExpression('$moment(\"2020-05-27\", \"YYYY-MM-DD\").add(7, \"days\").add(1, \"months\").format(\"YYYY-MM-DD\")', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('2020-07-03');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"accesses moment-timezone from an expression","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":888,"column":51,"index":28181},"line":888,"code":"    it('accesses moment-timezone from an expression', function () {\n      var expr = util.prepareJSONataExpression('$moment(\"2013-11-18 11:55Z\").tz(\"Asia/Taipei\").format()', {});\n      var result = util.evaluateJSONataExpression(expr, {});\n      result.should.eql('2013-11-18T19:55:00+08:00');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles non-existant flow context variable","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":893,"column":50,"index":28482},"line":893,"code":"    it('handles non-existant flow context variable', function () {\n      var expr = util.prepareJSONataExpression('$flowContext(\"nonExistant\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles non-existant global context variable","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":912,"column":52,"index":29013},"line":912,"code":"    it('handles non-existant global context variable', function () {\n      var expr = util.prepareJSONataExpression('$globalContext(\"nonExistant\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key) {\n                return {\n                  'foo': 'bar'\n                }[key];\n              }\n            }\n          };\n        }\n      });\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      });\n      should.not.exist(result);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles async flow context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":931,"column":41,"index":29537},"line":931,"code":"    it('handles async flow context access', function (done) {\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key, store, callback) {\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles async global context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":959,"column":43,"index":30291},"line":959,"code":"    it('handles async global context access', function (done) {\n      var expr = util.prepareJSONataExpression('$globalContext(\"foo\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key, store, callback) {\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles persistable store in flow context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":987,"column":56,"index":31062},"line":987,"code":"    it('handles persistable store in flow context access', function (done) {\n      var storeName;\n      var expr = util.prepareJSONataExpression('$flowContext(\"foo\", \"flowStoreName\")', {\n        context: function () {\n          return {\n            flow: {\n              get: function (key, store, callback) {\n                storeName = store;\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          storeName.should.equal(\"flowStoreName\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"handles persistable store in global context access","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":1018,"column":58,"index":31955},"line":1018,"code":"    it('handles persistable store in global context access', function (done) {\n      var storeName;\n      var expr = util.prepareJSONataExpression('$globalContext(\"foo\", \"globalStoreName\")', {\n        context: function () {\n          return {\n            global: {\n              get: function (key, store, callback) {\n                storeName = store;\n                setTimeout(() => {\n                  callback(null, {\n                    'foo': 'bar'\n                  }[key]);\n                }, 10);\n              }\n            }\n          };\n        }\n      });\n      util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        try {\n          should.not.exist(err);\n          value.should.eql(\"bar\");\n          storeName.should.equal(\"globalStoreName\");\n          done();\n        } catch (err2) {\n          done(err2);\n        }\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"callbacks with error when invalid expression was specified","suites":["@node-red/util/util","evaluateJSONataExpression"],"updatePoint":{"line":1049,"column":66,"index":32864},"line":1049,"code":"    it('callbacks with error when invalid expression was specified', function (done) {\n      var expr = util.prepareJSONataExpression('$abc(1)', {});\n      var result = util.evaluateJSONataExpression(expr, {\n        payload: \"hello\"\n      }, function (err, value) {\n        should.exist(err);\n        done();\n      });\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Error with message","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1060,"column":34,"index":33206},"line":1060,"code":"    it('encodes Error with message', function () {\n      var err = new Error(\"encode error\");\n      err.name = 'encodeError';\n      var msg = {\n        msg: err\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"error\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.name.should.eql('encodeError');\n      resultJson.message.should.eql('encode error');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Error without message","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1072,"column":37,"index":33620},"line":1072,"code":"    it('encodes Error without message', function () {\n      var err = new Error();\n      err.name = 'encodeError';\n      err.toString = function () {\n        return 'error message';\n      };\n      var msg = {\n        msg: err\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"error\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.name.should.eql('encodeError');\n      resultJson.message.should.eql('error message');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Buffer","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1087,"column":22,"index":34082},"line":1087,"code":"    it('encodes Buffer', function () {\n      var msg = {\n        msg: Buffer.from(\"abc\")\n      };\n      var result = util.encodeObject(msg, {\n        maxLength: 4\n      });\n      result.format.should.eql(\"buffer[3]\");\n      result.msg[0].should.eql('6');\n      result.msg[1].should.eql('1');\n      result.msg[2].should.eql('6');\n      result.msg[3].should.eql('2');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes function","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1100,"column":24,"index":34458},"line":1100,"code":"    it('encodes function', function () {\n      var msg = {\n        msg: function () {}\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"function\");\n      result.msg.should.eql('[function]');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes boolean","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1108,"column":23,"index":34691},"line":1108,"code":"    it('encodes boolean', function () {\n      var msg = {\n        msg: true\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"boolean\");\n      result.msg.should.eql('true');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes number","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1116,"column":22,"index":34906},"line":1116,"code":"    it('encodes number', function () {\n      var msg = {\n        msg: 123\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"number\");\n      result.msg.should.eql('123');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes 0","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1124,"column":17,"index":35113},"line":1124,"code":"    it('encodes 0', function () {\n      var msg = {\n        msg: 0\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"number\");\n      result.msg.should.eql('0');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes null","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1132,"column":20,"index":35319},"line":1132,"code":"    it('encodes null', function () {\n      var msg = {\n        msg: null\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"null\");\n      result.msg.should.eql('(undefined)');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes undefined","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1140,"column":25,"index":35541},"line":1140,"code":"    it('encodes undefined', function () {\n      var msg = {\n        msg: undefined\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"undefined\");\n      result.msg.should.eql('(undefined)');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes string","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1148,"column":22,"index":35770},"line":1148,"code":"    it('encodes string', function () {\n      var msg = {\n        msg: '1234567890'\n      };\n      var result = util.encodeObject(msg, {\n        maxLength: 6\n      });\n      result.format.should.eql(\"string[10]\");\n      result.msg.should.eql('123456...');\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Map","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1158,"column":19,"index":36030},"line":1158,"code":"    it('encodes Map', function () {\n      const m = new Map();\n      m.set(\"a\", 1);\n      m.set(\"b\", 2);\n      var msg = {\n        msg: m\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"map\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.should.have.property(\"__enc__\", true);\n      resultJson.should.have.property(\"type\", \"map\");\n      resultJson.should.have.property(\"data\", {\n        \"a\": 1,\n        \"b\": 2\n      });\n      resultJson.should.have.property(\"length\", 2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"encodes Set","suites":["@node-red/util/util","encodeObject"],"updatePoint":{"line":1176,"column":19,"index":36565},"line":1176,"code":"    it('encodes Set', function () {\n      const m = new Set();\n      m.add(\"a\");\n      m.add(\"b\");\n      var msg = {\n        msg: m\n      };\n      var result = util.encodeObject(msg);\n      result.format.should.eql(\"set[2]\");\n      var resultJson = JSON.parse(result.msg);\n      resultJson.should.have.property(\"__enc__\", true);\n      resultJson.should.have.property(\"type\", \"set\");\n      resultJson.should.have.property(\"data\", [\"a\", \"b\"]);\n      resultJson.should.have.property(\"length\", 2);\n    });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1192,"column":16,"index":37108},"line":1192,"code":"      it('object', function () {\n        var msg = {\n          msg: {\n            \"foo\": \"bar\"\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.foo.should.eql('bar');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object whose name includes error","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1203,"column":42,"index":37442},"line":1203,"code":"      it('object whose name includes error', function () {\n        function MyErrorObj() {\n          this.name = 'my error obj';\n          this.message = 'my error message';\n        }\n        ;\n        var msg = {\n          msg: new MyErrorObj()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"MyErrorObj\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.name.should.eql('my error obj');\n        resultJson.message.should.eql('my error message');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with undefined property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1218,"column":40,"index":37960},"line":1218,"code":"      it('object with undefined property', function () {\n        var msg = {\n          msg: {\n            a: 1,\n            b: undefined,\n            c: 3\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"a\", 1);\n        resultJson.should.have.property(\"c\", 3);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"__enc__\", true);\n        resultJson.b.should.have.property(\"type\", \"undefined\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with no prototype builtins","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1235,"column":43,"index":38557},"line":1235,"code":"      it('object with no prototype builtins', function () {\n        const payload = new Object(null);\n        payload.c = 3;\n        var msg = {\n          msg: {\n            b: payload\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"c\", 3);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with overriden hasOwnProperty","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1249,"column":46,"index":39013},"line":1249,"code":"      it('object with overriden hasOwnProperty', function () {\n        var msg = {\n          msg: {\n            b: {\n              hasOwnProperty: null\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"b\");\n        resultJson.b.should.have.property(\"hasOwnProperty\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with Map property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1263,"column":34,"index":39445},"line":1263,"code":"      it('object with Map property', function () {\n        const m = new Map();\n        m.set(\"a\", 1);\n        m.set(\"b\", 2);\n        var msg = {\n          msg: {\n            \"aMap\": m\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"aMap\");\n        resultJson.aMap.should.have.property(\"__enc__\", true);\n        resultJson.aMap.should.have.property(\"type\", \"map\");\n        resultJson.aMap.should.have.property(\"data\", {\n          \"a\": 1,\n          \"b\": 2\n        });\n        resultJson.aMap.should.have.property(\"length\", 2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object with Set property","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1284,"column":34,"index":40135},"line":1284,"code":"      it('object with Set property', function () {\n        const m = new Set();\n        m.add(\"a\");\n        m.add(\"b\");\n        var msg = {\n          msg: {\n            \"aSet\": m\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.have.property(\"aSet\");\n        resultJson.aSet.should.have.property(\"__enc__\", true);\n        resultJson.aSet.should.have.property(\"type\", \"set\");\n        resultJson.aSet.should.have.property(\"data\", [\"a\", \"b\"]);\n        resultJson.aSet.should.have.property(\"length\", 2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of IncomingMessage","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1302,"column":40,"index":40789},"line":1302,"code":"      it('constructor of IncomingMessage', function () {\n        function IncomingMessage() {}\n        ;\n        var msg = {\n          msg: new IncomingMessage()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.empty();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"_req key in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1313,"column":25,"index":41130},"line":1313,"code":"      it('_req key in msg', function () {\n        function Socket() {}\n        ;\n        var msg = {\n          msg: {\n            \"_req\": 123\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson._req.__enc__.should.eql(true);\n        resultJson._req.type.should.eql('internal');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"_res key in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1327,"column":25,"index":41546},"line":1327,"code":"      it('_res key in msg', function () {\n        function Socket() {}\n        ;\n        var msg = {\n          msg: {\n            \"_res\": 123\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson._res.__enc__.should.eql(true);\n        resultJson._res.type.should.eql('internal');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of error","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1341,"column":24,"index":41961},"line":1341,"code":"      it('array of error', function () {\n        var msg = {\n          msg: [new Error(\"encode error\")]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[1]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql('Error: encode error');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"long array in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1350,"column":27,"index":42286},"line":1350,"code":"      it('long array in msg', function () {\n        var msg = {\n          msg: {\n            array: [1, 2, 3, 4]\n          }\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.array.__enc__.should.eql(true);\n        resultJson.array.data[0].should.eql(1);\n        resultJson.array.data[1].should.eql(2);\n        resultJson.array.length.should.eql(4);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of string","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1366,"column":25,"index":42798},"line":1366,"code":"      it('array of string', function () {\n        var msg = {\n          msg: [\"abcde\", \"12345\"]\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 3\n        });\n        result.format.should.eql(\"array[2]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql('abc...');\n        resultJson[1].should.eql('123...');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array containing undefined","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1378,"column":36,"index":43190},"line":1378,"code":"      it('array containing undefined', function () {\n        var msg = {\n          msg: [1, undefined, 3]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].should.eql(1);\n        resultJson[2].should.eql(3);\n        resultJson[1].__enc__.should.be.true();\n        resultJson[1].type.should.eql(\"undefined\");\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of function","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1390,"column":27,"index":43622},"line":1390,"code":"      it('array of function', function () {\n        var msg = {\n          msg: [function () {}]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[1]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].__enc__.should.eql(true);\n        resultJson[0].type.should.eql('function');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of number","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1400,"column":25,"index":43976},"line":1400,"code":"      it('array of number', function () {\n        var msg = {\n          msg: [1, 2, 3]\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.__enc__.should.eql(true);\n        resultJson.data[0].should.eql(1);\n        resultJson.data[1].should.eql(2);\n        resultJson.data.length.should.eql(2);\n        resultJson.length.should.eql(3);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"array of special number","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1415,"column":33,"index":44484},"line":1415,"code":"      it('array of special number', function () {\n        var msg = {\n          msg: [NaN, Infinity, -Infinity]\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"array[3]\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson[0].__enc__.should.eql(true);\n        resultJson[0].type.should.eql('number');\n        resultJson[0].data.should.eql('NaN');\n        resultJson[1].data.should.eql('Infinity');\n        resultJson[2].data.should.eql('-Infinity');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of Buffer in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1428,"column":38,"index":45008},"line":1428,"code":"      it('constructor of Buffer in msg', function () {\n        var msg = {\n          msg: {\n            buffer: Buffer.from([1, 2, 3, 4])\n          }\n        };\n        var result = util.encodeObject(msg, {\n          maxLength: 2\n        });\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.buffer.__enc__.should.eql(true);\n        resultJson.buffer.length.should.eql(4);\n        resultJson.buffer.data[0].should.eql(1);\n        resultJson.buffer.data[1].should.eql(2);\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of ServerResponse","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1444,"column":39,"index":45552},"line":1444,"code":"      it('constructor of ServerResponse', function () {\n        function ServerResponse() {}\n        ;\n        var msg = {\n          msg: new ServerResponse()\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.should.eql('[internal]');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"constructor of Socket in msg","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1455,"column":38,"index":45914},"line":1455,"code":"      it('constructor of Socket in msg', function () {\n        function Socket() {}\n        ;\n        var msg = {\n          msg: {\n            socket: new Socket()\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"Object\");\n        var resultJson = JSON.parse(result.msg);\n        resultJson.socket.should.eql('[internal]');\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object which fails to serialise","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1468,"column":41,"index":46304},"line":1468,"code":"      it('object which fails to serialise', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw 'this exception should have been caught';\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var success = result.msg.indexOf('cantserialise') > 0;\n        success &= result.msg.indexOf('this exception should have been caught') > 0;\n        success &= result.msg.indexOf('canserialise') > 0;\n        success.should.eql(1);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"object which fails to serialise - different error type","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1493,"column":64,"index":47230},"line":1493,"code":"      it('object which fails to serialise - different error type', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw new Error('this exception should have been caught');\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var success = result.msg.indexOf('cantserialise') > 0;\n        success &= result.msg.indexOf('this exception should have been caught') > 0;\n        success &= result.msg.indexOf('canserialise') > 0;\n        success.should.eql(1);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"very large object which fails to serialise should be truncated","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1518,"column":72,"index":48175},"line":1518,"code":"      it('very large object which fails to serialise should be truncated', function (done) {\n        var msg = {\n          msg: {\n            obj: {\n              big: \"\",\n              cantserialise: {\n                message: 'this will not be displayed',\n                toJSON: function (val) {\n                  throw new Error('this exception should have been caught');\n                  return 'should not display because we threw first';\n                }\n              },\n              canserialise: {\n                message: 'this should be displayed'\n              }\n            }\n          }\n        };\n        for (var i = 0; i < 1000; i++) {\n          msg.msg.obj.big += 'some more string ';\n        }\n        var result = util.encodeObject(msg);\n        result.format.should.eql(\"error\");\n        var resultJson = JSON.parse(result.msg);\n        var success = resultJson.message.length <= 1000;\n        success.should.eql(true);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"test bad toString","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1546,"column":27,"index":49101},"line":1546,"code":"      it('test bad toString', function (done) {\n        var msg = {\n          msg: {\n            mystrangeobj: \"hello\"\n          }\n        };\n        msg.msg.toString = function () {\n          throw new Error('Exception in toString - should have been caught');\n        };\n        msg.msg.constructor = {\n          name: \"strangeobj\"\n        };\n        var result = util.encodeObject(msg);\n        var success = result.msg.indexOf('[Type not printable]') >= 0;\n        success.should.eql(true);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"test bad object constructor","suites":["@node-red/util/util","encodeObject","encode object"],"updatePoint":{"line":1563,"column":37,"index":49631},"line":1563,"code":"      it('test bad object constructor', function (done) {\n        var msg = {\n          msg: {\n            mystrangeobj: \"hello\",\n            constructor: {\n              get name() {\n                throw new Error('Exception in constructor name');\n              }\n            }\n          }\n        };\n        var result = util.encodeObject(msg);\n        done();\n      });","file":"unit/@node-red/util/lib/util_spec.js","skipped":false,"dir":"test"},{"name":"reports version","suites":["red/red","externals"],"updatePoint":{"line":53,"column":23,"index":2102},"line":53,"code":"    it('reports version', function () {\n      /\\d+\\.\\d+\\.\\d+(-git)?/.test(RED.version()).should.be.true();\n    });","file":"unit/node-red/lib/red_spec.js","skipped":false,"dir":"test"},{"name":"access server externals","suites":["red/red","externals"],"line":56,"code":"    it.skip('access server externals', function () {","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"only initialises api component if httpAdmin enabled","suites":["red/red","externals"],"line":63,"code":"    it.skip('only initialises api component if httpAdmin enabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"stubs httpAdmin if httpAdmin disabled","suites":["red/red","externals"],"line":64,"code":"    it.skip('stubs httpAdmin if httpAdmin disabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"stubs httpNode if httpNode disabled","suites":["red/red","externals"],"line":65,"code":"    it.skip('stubs httpNode if httpNode disabled');","file":"unit/node-red/lib/red_spec.js","skipped":true,"dir":"test"},{"name":"NEEDS TESTS WRITING","suites":["node-red/red"],"line":19,"code":"  it.skip(\"NEEDS TESTS WRITING\", function () {});","file":"unit/node-red/red_spec.js","skipped":true,"dir":"test"}]}