{"repo":"ZijianHe/koa-router","url":"https://github.com/ZijianHe/koa-router","branch":"master","configs":[{"package":"koa-router","lang":"js","dir":"test","framework":"mocha","pattern":"**/*.{js,ts}"}],"tests":[{"name":"should expose Router","suites":["module"],"updatePoint":{"line":8,"column":26,"index":141},"line":8,"code":"  it('should expose Router', function (done) {\n    var Router = require('..');\n    should.exist(Router);\n    Router.should.be.type('function');\n    done();\n  });","file":"index.js","skipped":false,"dir":"test"},{"name":"composes multiple callbacks/middlware","suites":["Layer"],"updatePoint":{"line":12,"column":43,"index":294},"line":12,"code":"  it('composes multiple callbacks/middlware', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/:category/:title', function (ctx, next) {\n      ctx.status = 500;\n      return next();\n    }, function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    });\n    request(http.createServer(app.callback())).get('/programming/how-to-node').expect(204).end(function (err) {\n      if (err) return done(err);\n      done();\n    });\n  });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"captures URL path parameters","suites":["Layer","Layer#match()"],"updatePoint":{"line":29,"column":36,"index":839},"line":29,"code":"    it('captures URL path parameters', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('/:category/:title', function (ctx) {\n        ctx.should.have.property('params');\n        ctx.params.should.be.type('object');\n        ctx.params.should.have.property('category', 'match');\n        ctx.params.should.have.property('title', 'this');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/match/this').expect(204).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"return orginal path parameters when decodeURIComponent throw error","suites":["Layer","Layer#match()"],"updatePoint":{"line":45,"column":74,"index":1501},"line":45,"code":"    it('return orginal path parameters when decodeURIComponent throw error', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('/:category/:title', function (ctx) {\n        ctx.should.have.property('params');\n        ctx.params.should.be.type('object');\n        ctx.params.should.have.property('category', '100%');\n        ctx.params.should.have.property('title', '101%');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/100%/101%').expect(204).end(done);\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"populates ctx.captures with regexp captures","suites":["Layer","Layer#match()"],"updatePoint":{"line":58,"column":51,"index":2062},"line":58,"code":"    it('populates ctx.captures with regexp captures', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api\\/([^\\/]+)\\/?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.instanceOf(Array);\n        ctx.captures.should.have.property(0, '1');\n        return next();\n      }, function (ctx) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.instanceOf(Array);\n        ctx.captures.should.have.property(0, '1');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api/1').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"return orginal ctx.captures when decodeURIComponent throw error","suites":["Layer","Layer#match()"],"updatePoint":{"line":78,"column":71,"index":2854},"line":78,"code":"    it('return orginal ctx.captures when decodeURIComponent throw error', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api\\/([^\\/]+)\\/?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, '101%');\n        return next();\n      }, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, '101%');\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api/101%').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"populates ctx.captures with regexp captures include undefiend","suites":["Layer","Layer#match()"],"updatePoint":{"line":98,"column":69,"index":3653},"line":98,"code":"    it('populates ctx.captures with regexp captures include undefiend', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get(/^\\/api(\\/.+)?/i, function (ctx, next) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, undefined);\n        return next();\n      }, function (ctx) {\n        ctx.should.have.property('captures');\n        ctx.captures.should.be.type('object');\n        ctx.captures.should.have.property(0, undefined);\n        ctx.status = 204;\n      });\n      request(http.createServer(app.callback())).get('/api').expect(204).end(function (err) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"should throw friendly error message when handle not exists","suites":["Layer","Layer#match()"],"updatePoint":{"line":118,"column":66,"index":4438},"line":118,"code":"    it('should throw friendly error message when handle not exists', function () {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      var notexistHandle = undefined;\n      (function () {\n        router.get('/foo', notexistHandle);\n      }).should.throw('get `/foo`: `middleware` must be a function, not `undefined`');\n      (function () {\n        router.get('foo router', '/foo', notexistHandle);\n      }).should.throw('get `foo router`: `middleware` must be a function, not `undefined`');\n      (function () {\n        router.post('/foo', function () {}, notexistHandle);\n      }).should.throw('post `/foo`: `middleware` must be a function, not `undefined`');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"composes middleware for param fn","suites":["Layer","Layer#param()"],"updatePoint":{"line":135,"column":40,"index":5175},"line":135,"code":"    it('composes middleware for param fn', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var route = new Layer('/users/:user', ['GET'], [function (ctx) {\n        ctx.body = ctx.user;\n      }]);\n      route.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      router.stack.push(route);\n      app.use(router.middleware());\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"ignores params which are not matched","suites":["Layer","Layer#param()"],"updatePoint":{"line":157,"column":44,"index":5931},"line":157,"code":"    it('ignores params which are not matched', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var route = new Layer('/users/:user', ['GET'], [function (ctx) {\n        ctx.body = ctx.user;\n      }]);\n      route.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      route.param('title', function (id, ctx, next) {\n        ctx.user = {\n          name: 'mark'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      });\n      router.stack.push(route);\n      app.use(router.middleware());\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"generates route URL","suites":["Layer","Layer#url()"],"updatePoint":{"line":188,"column":27,"index":6900},"line":188,"code":"    it('generates route URL', function () {\n      var route = new Layer('/:category/:title', ['get'], [function () {}], 'books');\n      var url = route.url({\n        category: 'programming',\n        title: 'how-to-node'\n      });\n      url.should.equal('/programming/how-to-node');\n      url = route.url('programming', 'how-to-node');\n      url.should.equal('/programming/how-to-node');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"escapes using encodeURIComponent()","suites":["Layer","Layer#url()"],"updatePoint":{"line":198,"column":42,"index":7310},"line":198,"code":"    it('escapes using encodeURIComponent()', function () {\n      var route = new Layer('/:category/:title', ['get'], [function () {}], 'books');\n      var url = route.url({\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n    });","file":"lib/layer.js","skipped":false,"dir":"test"},{"name":"creates new router with koa app","suites":["Router"],"updatePoint":{"line":16,"column":37,"index":403},"line":16,"code":"  it('creates new router with koa app', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.should.be.instanceOf(Router);\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"shares context between routers (gh-205)","suites":["Router"],"updatePoint":{"line":22,"column":45,"index":584},"line":22,"code":"  it('shares context between routers (gh-205)', function (done) {\n    var app = new Koa();\n    var router1 = new Router();\n    var router2 = new Router();\n    router1.get('/', function (ctx, next) {\n      ctx.foo = 'bar';\n      return next();\n    });\n    router2.get('/', function (ctx, next) {\n      ctx.baz = 'qux';\n      ctx.body = {\n        foo: ctx.foo\n      };\n      return next();\n    });\n    app.use(router1.routes()).use(router2.routes());\n    request(http.createServer(app.callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('foo', 'bar');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not register middleware more than once (gh-184)","suites":["Router"],"updatePoint":{"line":44,"column":58,"index":1256},"line":44,"code":"  it('does not register middleware more than once (gh-184)', function (done) {\n    var app = new Koa();\n    var parentRouter = new Router();\n    var nestedRouter = new Router();\n    nestedRouter.get('/first-nested-route', function (ctx, next) {\n      ctx.body = {\n        n: ctx.n\n      };\n    }).get('/second-nested-route', function (ctx, next) {\n      return next();\n    }).get('/third-nested-route', function (ctx, next) {\n      return next();\n    });\n    parentRouter.use('/parent-route', function (ctx, next) {\n      ctx.n = ctx.n ? ctx.n + 1 : 1;\n      return next();\n    }, nestedRouter.routes());\n    app.use(parentRouter.routes());\n    request(http.createServer(app.callback())).get('/parent-route/first-nested-route').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('n', 1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"router can be accecced with ctx","suites":["Router"],"updatePoint":{"line":68,"column":37,"index":2111},"line":68,"code":"  it('router can be accecced with ctx', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('home', '/', function (ctx) {\n      ctx.body = {\n        url: ctx.router.url('home')\n      };\n    });\n    app.use(router.routes());\n    request(http.createServer(app.callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body.url).to.eql(\"/\");\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers multiple middleware for one route","suites":["Router"],"updatePoint":{"line":83,"column":49,"index":2579},"line":83,"code":"  it('registers multiple middleware for one route', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('/double', function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body = {\n            message: 'Hello'\n          };\n          resolve(next());\n        }, 1);\n      });\n    }, function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body.message += ' World';\n          resolve(next());\n        }, 1);\n      });\n    }, function (ctx, next) {\n      ctx.body.message += '!';\n    });\n    app.use(router.routes());\n    request(http.createServer(app.callback())).get('/double').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body.message).to.eql('Hello World!');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not break when nested-routes use regexp paths","suites":["Router"],"updatePoint":{"line":112,"column":56,"index":3489},"line":112,"code":"  it('does not break when nested-routes use regexp paths', function (done) {\n    var app = new Koa();\n    var parentRouter = new Router();\n    var nestedRouter = new Router();\n    nestedRouter.get(/^\\/\\w$/i, function (ctx, next) {\n      return next();\n    }).get('/first-nested-route', function (ctx, next) {\n      return next();\n    }).get('/second-nested-route', function (ctx, next) {\n      return next();\n    });\n    parentRouter.use('/parent-route', function (ctx, next) {\n      return next();\n    }, nestedRouter.routes());\n    app.use(parentRouter.routes());\n    app.should.be.ok;\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"exposes middleware factory","suites":["Router"],"updatePoint":{"line":130,"column":32,"index":4071},"line":130,"code":"  it('exposes middleware factory', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.should.have.property('routes');\n    router.routes.should.be.type('function');\n    var middleware = router.routes();\n    should.exist(middleware);\n    middleware.should.be.type('function');\n    done();\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports promises for async/await","suites":["Router"],"updatePoint":{"line":140,"column":39,"index":4405},"line":140,"code":"  it('supports promises for async/await', function (done) {\n    var app = new Koa();\n    app.experimental = true;\n    var router = Router();\n    router.get('/async', function (ctx, next) {\n      return new Promise(function (resolve, reject) {\n        setTimeout(function () {\n          ctx.body = {\n            msg: 'promises!'\n          };\n          resolve();\n        }, 1);\n      });\n    });\n    app.use(router.routes()).use(router.allowedMethods());\n    request(http.createServer(app.callback())).get('/async').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'promises!');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches middleware only if route was matched (gh-182)","suites":["Router"],"updatePoint":{"line":161,"column":59,"index":5100},"line":161,"code":"  it('matches middleware only if route was matched (gh-182)', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    var otherRouter = new Router();\n    router.use(function (ctx, next) {\n      ctx.body = {\n        bar: 'baz'\n      };\n      return next();\n    });\n    otherRouter.get('/bar', function (ctx) {\n      ctx.body = ctx.body || {\n        foo: 'bar'\n      };\n    });\n    app.use(router.routes()).use(otherRouter.routes());\n    request(http.createServer(app.callback())).get('/bar').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('foo', 'bar');\n      expect(res.body).to.not.have.property('bar');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches first to last","suites":["Router"],"updatePoint":{"line":184,"column":27,"index":5787},"line":184,"code":"  it('matches first to last', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('user_page', '/user/(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 1\n      };\n    }).all('app', '/app/(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 2\n      };\n    }).all('view', '(.*).jsx', function (ctx) {\n      ctx.body = {\n        order: 3\n      };\n    });\n    request(http.createServer(app.use(router.routes()).callback())).get('/user/account.jsx').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('order', 1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not run subsequent middleware without calling next","suites":["Router"],"updatePoint":{"line":206,"column":61,"index":6476},"line":206,"code":"  it('does not run subsequent middleware without calling next', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    router.get('user_page', '/user/(.*).jsx', function (ctx) {\n      // no next()\n    }, function (ctx) {\n      ctx.body = {\n        order: 1\n      };\n    });\n    request(http.createServer(app.use(router.routes()).callback())).get('/user/account.jsx').expect(404).end(done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"nests routers with prefixes at root","suites":["Router"],"updatePoint":{"line":218,"column":41,"index":6875},"line":218,"code":"  it('nests routers with prefixes at root', function (done) {\n    var app = new Koa();\n    var api = new Router();\n    var forums = new Router({\n      prefix: '/forums'\n    });\n    var posts = new Router({\n      prefix: '/:fid/posts'\n    });\n    var server;\n    posts.get('/', function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    }).get('/:pid', function (ctx, next) {\n      ctx.body = ctx.params;\n      return next();\n    });\n    forums.use(posts.routes());\n    server = http.createServer(app.use(forums.routes()).callback());\n    request(server).get('/forums/1/posts').expect(204).end(function (err) {\n      if (err) return done(err);\n      request(server).get('/forums/1').expect(404).end(function (err) {\n        if (err) return done(err);\n        request(server).get('/forums/1/posts/2').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('fid', '1');\n          expect(res.body).to.have.property('pid', '2');\n          done();\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"nests routers with prefixes at path","suites":["Router"],"updatePoint":{"line":250,"column":41,"index":7930},"line":250,"code":"  it('nests routers with prefixes at path', function (done) {\n    var app = new Koa();\n    var api = new Router();\n    var forums = new Router({\n      prefix: '/api'\n    });\n    var posts = new Router({\n      prefix: '/posts'\n    });\n    var server;\n    posts.get('/', function (ctx, next) {\n      ctx.status = 204;\n      return next();\n    }).get('/:pid', function (ctx, next) {\n      ctx.body = ctx.params;\n      return next();\n    });\n    forums.use('/forums/:fid', posts.routes());\n    server = http.createServer(app.use(forums.routes()).callback());\n    request(server).get('/api/forums/1/posts').expect(204).end(function (err) {\n      if (err) return done(err);\n      request(server).get('/api/forums/1').expect(404).end(function (err) {\n        if (err) return done(err);\n        request(server).get('/api/forums/1/posts/2').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('fid', '1');\n          expect(res.body).to.have.property('pid', '2');\n          done();\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs subrouter middleware after parent","suites":["Router"],"updatePoint":{"line":282,"column":44,"index":9008},"line":282,"code":"  it('runs subrouter middleware after parent', function (done) {\n    var app = new Koa();\n    var subrouter = Router().use(function (ctx, next) {\n      ctx.msg = 'subrouter';\n      return next();\n    }).get('/', function (ctx) {\n      ctx.body = {\n        msg: ctx.msg\n      };\n    });\n    var router = Router().use(function (ctx, next) {\n      ctx.msg = 'router';\n      return next();\n    }).use(subrouter.routes());\n    request(http.createServer(app.use(router.routes()).callback())).get('/').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'subrouter');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parent middleware for subrouter routes","suites":["Router"],"updatePoint":{"line":302,"column":49,"index":9668},"line":302,"code":"  it('runs parent middleware for subrouter routes', function (done) {\n    var app = new Koa();\n    var subrouter = Router().get('/sub', function (ctx) {\n      ctx.body = {\n        msg: ctx.msg\n      };\n    });\n    var router = Router().use(function (ctx, next) {\n      ctx.msg = 'router';\n      return next();\n    }).use('/parent', subrouter.routes());\n    request(http.createServer(app.use(router.routes()).callback())).get('/parent/sub').expect(200).end(function (err, res) {\n      if (err) return done(err);\n      expect(res.body).to.have.property('msg', 'router');\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"matches corresponding requests","suites":["Router"],"updatePoint":{"line":319,"column":36,"index":10252},"line":319,"code":"  it('matches corresponding requests', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/:category/:title', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.params.should.have.property('title', 'how-to-node');\n      ctx.status = 204;\n    });\n    router.post('/:category', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.status = 204;\n    });\n    router.put('/:category/not-a-title', function (ctx) {\n      ctx.should.have.property('params');\n      ctx.params.should.have.property('category', 'programming');\n      ctx.params.should.not.have.property('title');\n      ctx.status = 204;\n    });\n    var server = http.createServer(app.callback());\n    request(server).get('/programming/how-to-node').expect(204).end(function (err, res) {\n      if (err) return done(err);\n      request(server).post('/programming').expect(204).end(function (err, res) {\n        if (err) return done(err);\n        request(server).put('/programming/not-a-title').expect(204).end(function (err, res) {\n          done(err);\n        });\n      });\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"executes route middleware using `app.context`","suites":["Router"],"updatePoint":{"line":351,"column":51,"index":11545},"line":351,"code":"  it('executes route middleware using `app.context`', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    router.use(function (ctx, next) {\n      ctx.bar = 'baz';\n      return next();\n    });\n    router.get('/:category/:title', function (ctx, next) {\n      ctx.foo = 'bar';\n      return next();\n    }, function (ctx) {\n      ctx.should.have.property('bar', 'baz');\n      ctx.should.have.property('foo', 'bar');\n      ctx.should.have.property('app');\n      ctx.should.have.property('req');\n      ctx.should.have.property('res');\n      ctx.status = 204;\n      done();\n    });\n    request(http.createServer(app.callback())).get('/match/this').expect(204).end(function (err) {\n      if (err) return done(err);\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not match after ctx.throw()","suites":["Router"],"updatePoint":{"line":375,"column":38,"index":12308},"line":375,"code":"  it('does not match after ctx.throw()', function (done) {\n    var app = new Koa();\n    var counter = 0;\n    var router = new Router();\n    app.use(router.routes());\n    router.get('/', function (ctx) {\n      counter++;\n      ctx.throw(403);\n    });\n    router.get('/', function () {\n      counter++;\n    });\n    var server = http.createServer(app.callback());\n    request(server).get('/').expect(403).end(function (err, res) {\n      if (err) return done(err);\n      counter.should.equal(1);\n      done();\n    });\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports promises for route middleware","suites":["Router"],"updatePoint":{"line":394,"column":44,"index":12834},"line":394,"code":"  it('supports promises for route middleware', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(router.routes());\n    var readVersion = function () {\n      return new Promise(function (resolve, reject) {\n        var packagePath = path.join(__dirname, '..', '..', 'package.json');\n        fs.readFile(packagePath, 'utf8', function (err, data) {\n          if (err) return reject(err);\n          resolve(JSON.parse(data).version);\n        });\n      });\n    };\n    router.get('/', function (ctx, next) {\n      return next();\n    }, function (ctx) {\n      return readVersion().then(function () {\n        ctx.status = 204;\n      });\n    });\n    request(http.createServer(app.callback())).get('/').expect(204).end(done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds to OPTIONS requests","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":417,"column":36,"index":13635},"line":417,"code":"    it('responds to OPTIONS requests', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function (ctx, next) {});\n      router.put('/users', function (ctx, next) {});\n      request(http.createServer(app.callback())).options('/users').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('content-length', '0');\n        res.header.should.have.property('allow', 'HEAD, GET, PUT');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 405 Method Not Allowed","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":431,"column":44,"index":14244},"line":431,"code":"    it('responds with 405 Method Not Allowed', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('allow', 'HEAD, GET, PUT');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 405 Method Not Allowed using the \"throw\" option","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":445,"column":69,"index":14839},"line":445,"code":"    it('responds with 405 Method Not Allowed using the \"throw\" option', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.name.should.equal('MethodNotAllowedError');\n          err.statusCode.should.equal(405);\n\n          // translate the HTTPError to a normal response\n          ctx.body = err.name;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err);\n        // the 'Allow' header is not set when throwing\n        res.header.should.not.have.property('allow');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with user-provided throwable using the \"throw\" and \"methodNotAllowed\" options","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":473,"column":94,"index":15922},"line":473,"code":"    it('responds with user-provided throwable using the \"throw\" and \"methodNotAllowed\" options', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.message.should.equal('Custom Not Allowed Error');\n          err.statusCode.should.equal(405);\n\n          // translate the HTTPError to a normal response\n          ctx.body = err.body;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true,\n        methodNotAllowed: function () {\n          var notAllowedErr = new Error('Custom Not Allowed Error');\n          notAllowedErr.type = 'custom';\n          notAllowedErr.statusCode = 405;\n          notAllowedErr.body = {\n            error: 'Custom Not Allowed Error',\n            statusCode: 405,\n            otherStuff: true\n          };\n          return notAllowedErr;\n        }\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      router.post('/events', function () {});\n      request(http.createServer(app.callback())).post('/users').expect(405).end(function (err, res) {\n        if (err) return done(err);\n        // the 'Allow' header is not set when throwing\n        res.header.should.not.have.property('allow');\n        res.body.should.eql({\n          error: 'Custom Not Allowed Error',\n          statusCode: 405,\n          otherStuff: true\n        });\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 501 Not Implemented","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":517,"column":41,"index":17485},"line":517,"code":"    it('responds with 501 Not Implemented', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 501 Not Implemented using the \"throw\" option","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":529,"column":66,"index":17965},"line":529,"code":"    it('responds with 501 Not Implemented using the \"throw\" option', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that the correct HTTPError was thrown\n          err.name.should.equal('NotImplementedError');\n          err.statusCode.should.equal(501);\n\n          // translate the HTTPError to a normal response\n          ctx.body = err.name;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err);\n        // the 'Allow' header is not set when throwing\n        res.header.should.not.have.property('allow');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with user-provided throwable using the \"throw\" and \"notImplemented\" options","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":556,"column":92,"index":19000},"line":556,"code":"    it('responds with user-provided throwable using the \"throw\" and \"notImplemented\" options', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(function (ctx, next) {\n        return next().catch(function (err) {\n          // assert that our custom error was thrown\n          err.message.should.equal('Custom Not Implemented Error');\n          err.type.should.equal('custom');\n          err.statusCode.should.equal(501);\n\n          // translate the HTTPError to a normal response\n          ctx.body = err.body;\n          ctx.status = err.statusCode;\n        });\n      });\n      app.use(router.allowedMethods({\n        throw: true,\n        notImplemented: function () {\n          var notImplementedErr = new Error('Custom Not Implemented Error');\n          notImplementedErr.type = 'custom';\n          notImplementedErr.statusCode = 501;\n          notImplementedErr.body = {\n            error: 'Custom Not Implemented Error',\n            statusCode: 501,\n            otherStuff: true\n          };\n          return notImplementedErr;\n        }\n      }));\n      router.get('/users', function () {});\n      router.put('/users', function () {});\n      request(http.createServer(app.callback())).search('/users').expect(501).end(function (err, res) {\n        if (err) return done(err);\n        // the 'Allow' header is not set when throwing\n        res.header.should.not.have.property('allow');\n        res.body.should.eql({\n          error: 'Custom Not Implemented Error',\n          statusCode: 501,\n          otherStuff: true\n        });\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not send 405 if route matched but status is 404","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":600,"column":60,"index":20610},"line":600,"code":"    it('does not send 405 if route matched but status is 404', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/users', function (ctx, next) {\n        ctx.status = 404;\n      });\n      request(http.createServer(app.callback())).get('/users').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"sets the allowed methods to a single Allow header #273","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":613,"column":62,"index":21081},"line":613,"code":"    it('sets the allowed methods to a single Allow header #273', function (done) {\n      // https://tools.ietf.org/html/rfc7231#section-7.4.1\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      app.use(router.allowedMethods());\n      router.get('/', function (ctx, next) {});\n      request(http.createServer(app.callback())).options('/').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('allow', 'HEAD, GET');\n        let allowHeaders = res.res.rawHeaders.filter(item => item == 'Allow');\n        expect(allowHeaders.length).to.eql(1);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"supports custom routing detect path: ctx.routerPath","suites":["Router","Router#allowedMethods()"],"updatePoint":{"line":629,"column":57,"index":21762},"line":629,"code":"  it('supports custom routing detect path: ctx.routerPath', function (done) {\n    var app = new Koa();\n    var router = new Router();\n    app.use(function (ctx, next) {\n      // bind helloworld.example.com/users => example.com/helloworld/users\n      var appname = ctx.request.hostname.split('.', 1)[0];\n      ctx.routerPath = '/' + appname + ctx.path;\n      return next();\n    });\n    app.use(router.routes());\n    router.get('/helloworld/users', function (ctx) {\n      ctx.body = ctx.method + ' ' + ctx.url;\n    });\n    request(http.createServer(app.callback())).get('/users').set('Host', 'helloworld.example.com').expect(200).expect('GET /users', done);\n  });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route specific to HTTP verb","suites":["Router","Router#[verb]()"],"updatePoint":{"line":645,"column":45,"index":22456},"line":645,"code":"    it('registers route specific to HTTP verb', function () {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      methods.forEach(function (method) {\n        router.should.have.property(method);\n        router[method].should.be.type('function');\n        router[method]('/', function () {});\n      });\n      router.stack.should.have.length(methods.length);\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with a regexp path","suites":["Router","Router#[verb]()"],"updatePoint":{"line":656,"column":42,"index":22863},"line":656,"code":"    it('registers route with a regexp path', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](/^\\/\\w$/i, function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with a given name","suites":["Router","Router#[verb]()"],"updatePoint":{"line":662,"column":41,"index":23086},"line":662,"code":"    it('registers route with a given name', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](method, '/', function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers route with with a given name and regexp path","suites":["Router","Router#[verb]()"],"updatePoint":{"line":668,"column":62,"index":23332},"line":668,"code":"    it('registers route with with a given name and regexp path', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method](method, /^\\/$/i, function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"enables route chaining","suites":["Router","Router#[verb]()"],"updatePoint":{"line":674,"column":30,"index":23550},"line":674,"code":"    it('enables route chaining', function () {\n      var router = new Router();\n      methods.forEach(function (method) {\n        router[method]('/', function () {}).should.equal(router);\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers array of paths (gh-203)","suites":["Router","Router#[verb]()"],"updatePoint":{"line":680,"column":41,"index":23767},"line":680,"code":"    it('registers array of paths (gh-203)', function () {\n      var router = new Router();\n      router.get(['/one', '/two'], function (ctx, next) {\n        return next();\n      });\n      expect(router.stack).to.have.property('length', 2);\n      expect(router.stack[0]).to.have.property('path', '/one');\n      expect(router.stack[1]).to.have.property('path', '/two');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"resolves non-parameterized routes without attached parameters","suites":["Router","Router#[verb]()"],"updatePoint":{"line":689,"column":69,"index":24171},"line":689,"code":"    it('resolves non-parameterized routes without attached parameters', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/notparameter', function (ctx, next) {\n        ctx.body = {\n          param: ctx.params.parameter\n        };\n      });\n      router.get('/:parameter', function (ctx, next) {\n        ctx.body = {\n          param: ctx.params.parameter\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/notparameter').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body.param).to.equal(undefined);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"uses router middleware without path","suites":["Router","Router#use()"],"updatePoint":{"line":711,"column":43,"index":24879},"line":711,"code":"    it('uses router middleware without path', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(function (ctx, next) {\n        ctx.foo = 'baz';\n        return next();\n      });\n      router.use(function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      });\n      router.get('/foo/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"uses router middleware at given path","suites":["Router","Router#use()"],"updatePoint":{"line":734,"column":44,"index":25589},"line":734,"code":"    it('uses router middleware at given path', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use('/foo/bar', function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      });\n      router.get('/foo/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs router middleware before subrouter middleware","suites":["Router","Router#use()"],"updatePoint":{"line":753,"column":58,"index":26227},"line":753,"code":"    it('runs router middleware before subrouter middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var subrouter = new Router();\n      router.use(function (ctx, next) {\n        ctx.foo = 'boo';\n        return next();\n      });\n      subrouter.use(function (ctx, next) {\n        ctx.foo = 'foo';\n        return next();\n      }).get('/bar', function (ctx) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      router.use('/foo', subrouter.routes());\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/bar').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"assigns middleware to array of paths","suites":["Router","Router#use()"],"updatePoint":{"line":777,"column":44,"index":27004},"line":777,"code":"    it('assigns middleware to array of paths', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(['/foo', '/bar'], function (ctx, next) {\n        ctx.foo = 'foo';\n        ctx.bar = 'bar';\n        return next();\n      });\n      router.get('/foo', function (ctx, next) {\n        ctx.body = {\n          foobar: ctx.foo + 'bar'\n        };\n      });\n      router.get('/bar', function (ctx) {\n        ctx.body = {\n          foobar: 'foo' + ctx.bar\n        };\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('foobar', 'foobar');\n        request(http.createServer(app.callback())).get('/bar').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('foobar', 'foobar');\n          done();\n        });\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"without path, does not set params.0 to the matched path - gh-247","suites":["Router","Router#use()"],"updatePoint":{"line":806,"column":72,"index":28020},"line":806,"code":"    it('without path, does not set params.0 to the matched path - gh-247', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.use(function (ctx, next) {\n        return next();\n      });\n      router.get('/foo/:id', function (ctx) {\n        ctx.body = ctx.params;\n      });\n      app.use(router.routes());\n      request(http.createServer(app.callback())).get('/foo/815').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.have.property('id', '815');\n        expect(res.body).to.not.have.property('0');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not add an erroneous (.*) to unprefiexed nested routers - gh-369 gh-410","suites":["Router","Router#use()"],"updatePoint":{"line":823,"column":84,"index":28657},"line":823,"code":"    it('does not add an erroneous (.*) to unprefiexed nested routers - gh-369 gh-410', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var nested = new Router();\n      var called = 0;\n      nested.get('/', (ctx, next) => {\n        ctx.body = 'root';\n        called += 1;\n        return next();\n      }).get('/test', (ctx, next) => {\n        ctx.body = 'test';\n        called += 1;\n        return next();\n      });\n      router.use(nested.routes());\n      app.use(router.routes());\n      request(app.callback()).get('/test').expect(200).expect('test').end(function (err, res) {\n        if (err) return done(err);\n        expect(called).to.eql(1, 'too many routes matched');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers new routes","suites":["Router","Router#register()"],"updatePoint":{"line":847,"column":28,"index":29396},"line":847,"code":"    it('registers new routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.should.have.property('register');\n      router.register.should.be.type('function');\n      var route = router.register('/', ['GET', 'POST'], function () {});\n      app.use(router.routes());\n      router.stack.should.be.an.instanceOf(Array);\n      router.stack.should.have.property('length', 1);\n      router.stack[0].should.have.property('path', '/');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"registers redirect routes","suites":["Router","Router#redirect()"],"updatePoint":{"line":861,"column":33,"index":29948},"line":861,"code":"    it('registers redirect routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.should.have.property('redirect');\n      router.redirect.should.be.type('function');\n      router.redirect('/source', '/destination', 302);\n      app.use(router.routes());\n      router.stack.should.have.property('length', 1);\n      router.stack[0].should.be.instanceOf(Layer);\n      router.stack[0].should.have.property('path', '/source');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"redirects using route names","suites":["Router","Router#redirect()"],"updatePoint":{"line":873,"column":35,"index":30438},"line":873,"code":"    it('redirects using route names', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('home', '/', function () {});\n      router.get('sign-up-form', '/sign-up-form', function () {});\n      router.redirect('home', 'sign-up-form');\n      request(http.createServer(app.callback())).post('/').expect(301).end(function (err, res) {\n        if (err) return done(err);\n        res.header.should.have.property('location', '/sign-up-form');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"inherits routes from nested router","suites":["Router","Router#route()"],"updatePoint":{"line":888,"column":42,"index":31039},"line":888,"code":"    it('inherits routes from nested router', function () {\n      var app = new Koa();\n      var subrouter = Router().get('child', '/hello', function (ctx) {\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var router = Router().use(subrouter.routes());\n      expect(router.route('child')).to.have.property('name', 'child');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name","suites":["Router","Router#url()"],"updatePoint":{"line":900,"column":42,"index":31442},"line":900,"code":"    it('generates URL for given route name', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.get('books', '/:category/:title', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('books', {\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n      url = router.url('books', 'programming', 'how to node');\n      url.should.equal('/programming/how%20to%20node');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name within embedded routers","suites":["Router","Router#url()"],"updatePoint":{"line":916,"column":66,"index":32028},"line":916,"code":"    it('generates URL for given route name within embedded routers', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        prefix: \"/books\"\n      });\n      var embeddedRouter = new Router({\n        prefix: \"/chapters\"\n      });\n      embeddedRouter.get('chapters', '/:chapterName/:pageNumber', function (ctx) {\n        ctx.status = 204;\n      });\n      router.use(embeddedRouter.routes());\n      app.use(router.routes());\n      var url = router.url('chapters', {\n        chapterName: 'Learning ECMA6',\n        pageNumber: 123\n      });\n      url.should.equal('/books/chapters/Learning%20ECMA6/123');\n      url = router.url('chapters', 'Learning ECMA6', 123);\n      url.should.equal('/books/chapters/Learning%20ECMA6/123');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name within two embedded routers","suites":["Router","Router#url()"],"updatePoint":{"line":938,"column":70,"index":32808},"line":938,"code":"    it('generates URL for given route name within two embedded routers', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        prefix: \"/books\"\n      });\n      var embeddedRouter = new Router({\n        prefix: \"/chapters\"\n      });\n      var embeddedRouter2 = new Router({\n        prefix: \"/:chapterName/pages\"\n      });\n      embeddedRouter2.get('chapters', '/:pageNumber', function (ctx) {\n        ctx.status = 204;\n      });\n      embeddedRouter.use(embeddedRouter2.routes());\n      router.use(embeddedRouter.routes());\n      app.use(router.routes());\n      var url = router.url('chapters', {\n        chapterName: 'Learning ECMA6',\n        pageNumber: 123\n      });\n      url.should.equal('/books/chapters/Learning%20ECMA6/pages/123');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name with params and query params","suites":["Router","Router#url()"],"updatePoint":{"line":962,"column":71,"index":33601},"line":962,"code":"    it('generates URL for given route name with params and query params', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('books', '/books/:category/:id', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('books', 'programming', 4, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = router.url('books', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = router.url('books', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: 'page=3&limit=10'\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates URL for given route name without params and query params","suites":["Router","Router#url()"],"updatePoint":{"line":994,"column":74,"index":34516},"line":994,"code":"    it('generates URL for given route name without params and query params', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('category', '/category', function (ctx) {\n        ctx.status = 204;\n      });\n      var url = router.url('category', {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/category?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware","suites":["Router","Router#param()"],"updatePoint":{"line":1011,"column":33,"index":34966},"line":1011,"code":"    it('runs parameter middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      app.use(router.routes());\n      router.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (!id) return ctx.status = 404;\n        return next();\n      }).get('/users/:user', function (ctx, next) {\n        ctx.body = ctx.user;\n      });\n      request(http.createServer(app.callback())).get('/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware in order of URL appearance","suites":["Router","Router#param()"],"updatePoint":{"line":1031,"column":60,"index":35673},"line":1031,"code":"    it('runs parameter middleware in order of URL appearance', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.param('user', function (id, ctx, next) {\n        ctx.user = {\n          name: 'alex'\n        };\n        if (ctx.ranFirst) {\n          ctx.user.ordered = 'parameters';\n        }\n        if (!id) return ctx.status = 404;\n        return next();\n      }).param('first', function (id, ctx, next) {\n        ctx.ranFirst = true;\n        if (ctx.user) {\n          ctx.ranFirst = false;\n        }\n        if (!id) return ctx.status = 404;\n        return next();\n      }).get('/:first/users/:user', function (ctx) {\n        ctx.body = ctx.user;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/first/users/3').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('name', 'alex');\n        res.body.should.have.property('ordered', 'parameters');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parameter middleware in order of URL appearance even when added in random order","suites":["Router","Router#param()"],"updatePoint":{"line":1061,"column":92,"index":36764},"line":1061,"code":"    it('runs parameter middleware in order of URL appearance even when added in random order', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router\n      // intentional random order\n      .param('a', function (id, ctx, next) {\n        ctx.state.loaded = [id];\n        return next();\n      }).param('d', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).param('c', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).param('b', function (id, ctx, next) {\n        ctx.state.loaded.push(id);\n        return next();\n      }).get('/:a/:b/:c/:d', function (ctx, next) {\n        ctx.body = ctx.state.loaded;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/1/2/3/4').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.eql(['1', '2', '3', '4']);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"runs parent parameter middleware for subrouter","suites":["Router","Router#param()"],"updatePoint":{"line":1088,"column":54,"index":37747},"line":1088,"code":"    it('runs parent parameter middleware for subrouter', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var subrouter = new Router();\n      subrouter.get('/:cid', function (ctx) {\n        ctx.body = {\n          id: ctx.params.id,\n          cid: ctx.params.cid\n        };\n      });\n      router.param('id', function (id, ctx, next) {\n        ctx.params.id = 'ran';\n        if (!id) return ctx.status = 404;\n        return next();\n      }).use('/:id/children', subrouter.routes());\n      request(http.createServer(app.use(router.routes()).callback())).get('/did-not-run/children/2').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.should.have.property('body');\n        res.body.should.have.property('id', 'ran');\n        res.body.should.have.property('cid', '2');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 200","suites":["Router","Router#opts"],"updatePoint":{"line":1113,"column":25,"index":38634},"line":1113,"code":"    it('responds with 200', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.text.should.equal('hello');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should allow setting a prefix","suites":["Router","Router#opts"],"updatePoint":{"line":1127,"column":37,"index":39093},"line":1127,"code":"    it('should allow setting a prefix', function (done) {\n      var app = new Koa();\n      var routes = Router({\n        prefix: '/things/:thing_id'\n      });\n      routes.get('/list', function (ctx) {\n        ctx.body = ctx.params;\n      });\n      app.use(routes.routes());\n      request(http.createServer(app.callback())).get('/things/1/list').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.body.thing_id.should.equal('1');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 404 when has a trailing slash","suites":["Router","Router#opts"],"updatePoint":{"line":1142,"column":51,"index":39605},"line":1142,"code":"    it('responds with 404 when has a trailing slash', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info/').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 200","suites":["Router","use middleware with opts"],"updatePoint":{"line":1157,"column":25,"index":40072},"line":1157,"code":"    it('responds with 200', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        res.text.should.equal('hello');\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"responds with 404 when has a trailing slash","suites":["Router","use middleware with opts"],"updatePoint":{"line":1171,"column":51,"index":40545},"line":1171,"code":"    it('responds with 404 when has a trailing slash', function (done) {\n      var app = new Koa();\n      var router = new Router({\n        strict: true\n      });\n      router.get('/info', function (ctx) {\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/info/').expect(404).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should return composed middleware","suites":["Router","router.routes()"],"updatePoint":{"line":1186,"column":41,"index":41019},"line":1186,"code":"    it('should return composed middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var middlewareCount = 0;\n      var middlewareA = function (ctx, next) {\n        middlewareCount++;\n        return next();\n      };\n      var middlewareB = function (ctx, next) {\n        middlewareCount++;\n        return next();\n      };\n      router.use(middlewareA, middlewareB);\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var routerMiddleware = router.routes();\n      expect(routerMiddleware).to.be.a('function');\n      request(http.createServer(app.use(routerMiddleware).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.an('object');\n        expect(res.body).to.have.property('hello', 'world');\n        expect(middlewareCount).to.equal(2);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"places a `_matchedRoute` value on context","suites":["Router","router.routes()"],"updatePoint":{"line":1215,"column":49,"index":42031},"line":1215,"code":"    it('places a `_matchedRoute` value on context', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      var middleware = function (ctx, next) {\n        expect(ctx._matchedRoute).to.be('/users/:id');\n        return next();\n      };\n      router.use(middleware);\n      router.get('/users/:id', function (ctx, next) {\n        expect(ctx._matchedRoute).to.be('/users/:id');\n        should.exist(ctx.params.id);\n        ctx.body = {\n          hello: 'world'\n        };\n      });\n      var routerMiddleware = router.routes();\n      request(http.createServer(app.use(routerMiddleware).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"places a `_matchedRouteName` value on the context for a named route","suites":["Router","router.routes()"],"updatePoint":{"line":1236,"column":75,"index":42803},"line":1236,"code":"    it('places a `_matchedRouteName` value on the context for a named route', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('users#show', '/users/:id', function (ctx, next) {\n        expect(ctx._matchedRouteName).to.be('users#show');\n        ctx.status = 200;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not place a `_matchedRouteName` value on the context for unnamed routes","suites":["Router","router.routes()"],"updatePoint":{"line":1248,"column":84,"index":43324},"line":1248,"code":"    it('does not place a `_matchedRouteName` value on the context for unnamed routes', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx, next) {\n        expect(ctx._matchedRouteName).to.be(undefined);\n        ctx.status = 200;\n      });\n      request(http.createServer(app.use(router.routes()).callback())).get('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should default to GET","suites":["Router","If no HEAD method, default to GET"],"updatePoint":{"line":1262,"column":29,"index":43841},"line":1262,"code":"    it('should default to GET', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).head('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.empty();\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should work with middleware","suites":["Router","If no HEAD method, default to GET"],"updatePoint":{"line":1275,"column":35,"index":44314},"line":1275,"code":"    it('should work with middleware', function (done) {\n      var app = new Koa();\n      var router = new Router();\n      router.get('/users/:id', function (ctx) {\n        should.exist(ctx.params.id);\n        ctx.body = 'hello';\n      });\n      request(http.createServer(app.use(router.routes()).callback())).head('/users/1').expect(200).end(function (err, res) {\n        if (err) return done(err);\n        expect(res.body).to.be.empty();\n        done();\n      });\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should set opts.prefix","suites":["Router","Router#prefix"],"updatePoint":{"line":1290,"column":30,"index":44830},"line":1290,"code":"    it('should set opts.prefix', function () {\n      var router = Router();\n      expect(router.opts).to.not.have.key('prefix');\n      router.prefix('/things/:thing_id');\n      expect(router.opts.prefix).to.equal('/things/:thing_id');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should prefix existing routes","suites":["Router","Router#prefix"],"updatePoint":{"line":1296,"column":37,"index":45080},"line":1296,"code":"    it('should prefix existing routes', function () {\n      var router = Router();\n      router.get('/users/:id', function (ctx) {\n        ctx.body = 'test';\n      });\n      router.prefix('/things/:thing_id');\n      var route = router.stack[0];\n      expect(route.path).to.equal('/things/:thing_id/users/:id');\n      expect(route.paramNames).to.have.length(2);\n      expect(route.paramNames[0]).to.have.property('name', 'thing_id');\n      expect(route.paramNames[1]).to.have.property('name', 'id');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"does not set params.0 to the matched path","suites":["Router","Router#prefix","when used with .use(fn) - gh-247"],"updatePoint":{"line":1309,"column":51,"index":45664},"line":1309,"code":"      it('does not set params.0 to the matched path', function (done) {\n        var app = new Koa();\n        var router = new Router();\n        router.use(function (ctx, next) {\n          return next();\n        });\n        router.get('/foo/:id', function (ctx) {\n          ctx.body = ctx.params;\n        });\n        router.prefix('/things');\n        app.use(router.routes());\n        request(http.createServer(app.callback())).get('/things/foo/108').expect(200).end(function (err, res) {\n          if (err) return done(err);\n          expect(res.body).to.have.property('id', '108');\n          expect(res.body).to.not.have.property('0');\n          done();\n        });\n      });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support root level router middleware","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1357,"column":55,"index":47252},"line":1357,"code":"        it('should support root level router middleware', function (done) {\n          request(server).get(prefix).expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support requests with a trailing path slash","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1366,"column":62,"index":47659},"line":1366,"code":"        it('should support requests with a trailing path slash', function (done) {\n          request(server).get('/admin/').expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"should support requests without a trailing path slash","suites":["Router","Router#prefix","without trailing slash"],"updatePoint":{"line":1375,"column":65,"index":48072},"line":1375,"code":"        it('should support requests without a trailing path slash', function (done) {\n          request(server).get('/admin').expect(200).end(function (err, res) {\n            if (err) return done(err);\n            expect(middlewareCount).to.equal(2);\n            expect(res.body).to.be.an('object');\n            expect(res.body).to.have.property('name', 'worked');\n            done();\n          });\n        });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates route URL","suites":["Router","Static Router#url()"],"updatePoint":{"line":1388,"column":27,"index":48515},"line":1388,"code":"    it('generates route URL', function () {\n      var url = Router.url('/:category/:title', {\n        category: 'programming',\n        title: 'how-to-node'\n      });\n      url.should.equal('/programming/how-to-node');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"escapes using encodeURIComponent()","suites":["Router","Static Router#url()"],"updatePoint":{"line":1395,"column":42,"index":48756},"line":1395,"code":"    it('escapes using encodeURIComponent()', function () {\n      var url = Router.url('/:category/:title', {\n        category: 'programming',\n        title: 'how to node'\n      });\n      url.should.equal('/programming/how%20to%20node');\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates route URL with params and query params","suites":["Router","Static Router#url()"],"updatePoint":{"line":1402,"column":56,"index":49015},"line":1402,"code":"    it('generates route URL with params and query params', function (done) {\n      var url = Router.url('/books/:category/:id', 'programming', 4, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = Router.url('/books/:category/:id', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      var url = Router.url('/books/:category/:id', {\n        category: 'programming',\n        id: 4\n      }, {\n        query: 'page=3&limit=10'\n      });\n      url.should.equal('/books/programming/4?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"},{"name":"generates router URL without params and with with query params","suites":["Router","Static Router#url()"],"updatePoint":{"line":1429,"column":70,"index":49808},"line":1429,"code":"    it('generates router URL without params and with with query params', function (done) {\n      var url = Router.url('/category', {\n        query: {\n          page: 3,\n          limit: 10\n        }\n      });\n      url.should.equal('/category?page=3&limit=10');\n      done();\n    });","file":"lib/router.js","skipped":false,"dir":"test"}]}