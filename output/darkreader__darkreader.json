{"repo":"darkreader/darkreader","url":"https://github.com/darkreader/darkreader","branch":"master","configs":[{"package":"darkreader","lang":"ts","dir":"tests","framework":"jest","pattern":"**/*.{js,ts}"}],"tests":[{"name":"should override inline style","suites":["Inline style override"],"updatePoint":{"line":24,"column":36},"line":24,"code":"    it('should override inline style', async () => {\n        await loadBasicPage();\n\n        await expectStyles(['span', 'color', 'rgb(255, 26, 26)']);\n    });","file":"browser/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should watch for inline style change","suites":["Inline style override"],"updatePoint":{"line":30,"column":44},"line":30,"code":"    it('should watch for inline style change', async () => {\n        await loadBasicPage();\n\n        await expectStyles(['span', 'color', 'rgb(255, 26, 26)']);\n\n        await expect(evaluateScript(async () => {\n            const span = document.querySelector('span');\n            span.style.color = 'green';\n            await new Promise((resolve) => setTimeout(resolve));\n            return getComputedStyle(span).color;\n        })).resolves.toBe('rgb(114, 255, 114)');\n    });","file":"browser/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override link style","suites":["Link override"],"updatePoint":{"line":12,"column":34},"line":12,"code":"    it('should override link style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '    <link rel=\"stylesheet\" href=\"style.css\"/>',\n                '</head>',\n                '<body>',\n                '    <h1>Link style <strong>override</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n            '/style.css': multiline(\n                'body { background: gray; }',\n                'h1 strong { color: red; }',\n            ),\n        });\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'background-color', 'rgb(96, 104, 108)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h1 strong', 'color', 'rgb(255, 26, 26)'],\n        ]);\n    });","file":"browser/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override CORS style","suites":["Link override"],"updatePoint":{"line":40,"column":34},"line":40,"code":"    it('should override CORS style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                `    <link rel=\"stylesheet\" href=\"${corsURL}/style.css\"/>`,\n                '</head>',\n                '<body>',\n                '    <h1>CORS style <strong>override</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n            cors: {\n                '/style.css': multiline(\n                    'body { background: gray; }',\n                    'h1 strong { color: red; }',\n                ),\n            },\n        });\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'background-color', 'rgb(96, 104, 108)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h1 strong', 'color', 'rgb(255, 26, 26)'],\n        ]);\n    });","file":"browser/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should wait till style is loading","suites":["Link override"],"updatePoint":{"line":70,"column":41},"line":70,"code":"    it('should wait till style is loading', async () => {\n        let proceedCSSResponse: () => void;\n\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '    <link rel=\"stylesheet\" href=\"style.css\"/>',\n                '</head>',\n                '<body>',\n                '    <h1>Link loading <strong>delay</strong></h1>',\n                '</body>',\n                '</html>',\n            ),\n            '/style.css': async (_, res) => {\n                res.statusCode = 200;\n                res.setHeader('Content-Type', 'text/css');\n\n                await new Promise<void>((resolve) => proceedCSSResponse = resolve);\n\n                res.end(multiline(\n                    'body { background: gray; }',\n                    'h1 strong { color: red; }',\n                ), 'utf8');\n            },\n        }, {\n            waitUntil: 'domcontentloaded',\n        });\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h1 strong', 'color', 'rgb(232, 230, 227)'],\n        ]);\n\n        await timeout(200);\n        proceedCSSResponse();\n        await timeout(200);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'background-color', 'rgb(96, 104, 108)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h1 strong', 'color', 'rgb(255, 26, 26)'],\n        ]);\n    });","file":"browser/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override user agent style","suites":["Style override"],"updatePoint":{"line":9,"column":40},"line":9,"code":"    it('should override user agent style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    Text',\n                '    <a href=\"#\">Link</a>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override static style","suites":["Style override"],"updatePoint":{"line":33,"column":36},"line":33,"code":"    it('should override static style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '    <style>',\n                '        body { background: gray; }',\n                '        h1 strong { color: red; }',\n                '    </style>',\n                '</head>',\n                '<body>',\n                '    <h1>Style <strong>override</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'background-color', 'rgb(96, 104, 108)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h1 strong', 'color', 'rgb(255, 26, 26)'],\n        ]);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should restore override","suites":["Style override"],"updatePoint":{"line":60,"column":31},"line":60,"code":"    it('should restore override', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    <h1>Style <strong>override</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await evaluateScript(() => {\n            const styleElement = document.createElement('style');\n            styleElement.classList.add('testcase-style');\n            document.head.append(styleElement);\n            styleElement.sheet.insertRule('h1 { color: gray }');\n            styleElement.sheet.insertRule('strong { color: red }');\n        });\n\n        await expectStyles([\n            ['h1', 'color', 'rgb(152, 143, 129)'],\n            ['h1 strong', 'color', 'rgb(255, 26, 26)']\n        ]);\n\n        await expect(evaluateScript(async () => {\n            const style = document.querySelector('.testcase-style');\n            style.nextSibling.remove();\n            await new Promise((resolve) => setTimeout(resolve));\n            return (style.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync');\n        })).resolves.toBe(true);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should move override","suites":["Style override"],"updatePoint":{"line":95,"column":28},"line":95,"code":"    it('should move override', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    <h1>Some test foor...... <strong>Moving styles</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await evaluateScript(() => {\n            const styleElement = document.createElement('style');\n            styleElement.classList.add('testcase-style');\n            document.head.append(styleElement);\n            styleElement.sheet.insertRule('h1 { color: gray } ');\n            styleElement.sheet.insertRule('strong { color: red } ');\n        });\n\n        await expect(evaluateScript(async () => {\n            const style = document.querySelector('.testcase-style');\n            document.body.append(style);\n            await new Promise((resolve) => setTimeout(resolve));\n            return (style.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync');\n        })).resolves.toBe(true);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should remove override","suites":["Style override"],"updatePoint":{"line":125,"column":30},"line":125,"code":"    it('should remove override', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    <h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await evaluateScript(() => {\n            const styleElement = document.createElement('style');\n            styleElement.classList.add('testcase-style');\n            document.head.append(styleElement);\n            styleElement.sheet.insertRule('h1 { color: gray }');\n            styleElement.sheet.insertRule('strong { color: red }');\n        });\n\n        await expect(evaluateScript(async () => {\n            const style = document.querySelector('.testcase-style');\n            const sibling = style.nextSibling;\n            style.remove();\n            await new Promise((resolve) => setTimeout(resolve));\n            return sibling.isConnected && !((sibling as HTMLStyleElement).classList.contains('darkreader--sync'));\n        })).resolves.toBe(false);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to updated style","suites":["Style override"],"updatePoint":{"line":156,"column":37},"line":156,"code":"    it('should react to updated style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    <h1>Some test foor...... <strong>Oh uhm a pink background</strong></h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await evaluateScript(() => {\n            const styleElement = document.createElement('style');\n            styleElement.classList.add('testcase-style');\n            document.head.append(styleElement);\n            styleElement.sheet.insertRule('h1 { color: gray }');\n            styleElement.sheet.insertRule('strong { color: red }');\n        });\n\n        await expect(evaluateScript(async () => {\n            const style = document.querySelector('.testcase-style');\n            (style as HTMLStyleElement).sheet.insertRule('html { background-color: pink }');\n            await new Promise((resolve) => setTimeout(resolve));\n            return (style.nextSibling as HTMLStyleElement).sheet.cssRules[0].cssText;\n        })).resolves.toBe('html { background-color: rgb(89, 0, 16); }');\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to a new style","suites":["Style override"],"updatePoint":{"line":186,"column":35},"line":186,"code":"    it('should react to a new style', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '    <h1>Some test foor...... <strong>Oh uhm what?</strong>!</h1>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await expect(evaluateScript(async () => {\n            const styleElement = document.createElement('style');\n            styleElement.classList.add('testcase-style');\n            document.head.append(styleElement);\n            styleElement.sheet.insertRule('h1 { color: pink }');\n            styleElement.sheet.insertRule('strong { color: orange }');\n            await new Promise((resolve) => setTimeout(resolve));\n            return (styleElement.nextSibling as HTMLStyleElement).sheet.cssRules.length === 2 && (styleElement.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync');\n        })).resolves.toBe(true);\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle defined custom elements","suites":["Style override"],"updatePoint":{"line":211,"column":45},"line":211,"code":"    it('should handle defined custom elements', async () => {\n        await loadTestPage({\n            '/': multiline(\n                '<!DOCTYPE html>',\n                '<html>',\n                '<head>',\n                '</head>',\n                '<body>',\n                '<custom-element>',\n                '</custom-element>',\n                '</body>',\n                '</html>',\n            ),\n        });\n\n        await expect(evaluateScript(async () => {\n            class CustomElement extends HTMLElement {\n                constructor() {\n                    super();\n                    const shadowRoot = this.attachShadow({mode: 'open'});\n                    const style = document.createElement('style');\n                    style.textContent = 'p { color: pink }';\n                    const paragraph = document.createElement('p');\n                    paragraph.textContent = 'Some text content that should be pink.';\n\n                    shadowRoot.append(style);\n                    shadowRoot.append(paragraph);\n                }\n            }\n\n            customElements.define('custom-element', CustomElement);\n            await new Promise((resolve) => setTimeout(resolve, 100));\n            const shadowRoot = document.querySelector('custom-element').shadowRoot;\n            return getComputedStyle(shadowRoot.querySelector('p')).color;\n        })).resolves.toBe('rgb(255, 160, 177)');\n    });","file":"browser/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"Modifying config","suites":["Modifying config via Developer tools"],"updatePoint":{"line":32,"column":24},"line":32,"code":"    it('Modifying config', async () => {\n        await loadBasicPage();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n\n        await devtoolsUtils.paste([\n            '*',\n            '',\n            'CSS',\n            'bachground: black',\n            'color: white',\n            '',\n            '============================',\n            '',\n            'nonexistent.com',\n            '',\n            'CSS',\n            'color: red',\n            ''\n        ].join('\\n'));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)']\n        ]);\n\n        await devtoolsUtils.reset();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)']\n        ]);\n    });","file":"browser/e2e/devtools.tests.ts","skipped":false,"dir":"tests"},{"name":"If no matching URL found, returns only default fix","suites":["Correct fixes are chosen"],"updatePoint":{"line":28,"column":58},"line":28,"code":"    it('If no matching URL found, returns only default fix', async () => {\n        await loadBasicPage();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n        ]);\n\n        await devtoolsUtils.paste(multiline(\n            '*',\n            '',\n            'CSS',\n            'body {',\n            '    background: navy;',\n            '    color: white;',\n            '}',\n            'h1 {',\n            '    color: orange;',\n            '}',\n            '',\n            '============================',\n            '',\n            'nonexistent.com',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: green;',\n            '}',\n            '',\n            '============================',\n            '',\n            'other.net',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: blue;',\n            '}',\n            '',\n        ));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(0, 0, 128)'],\n            ['body', 'color', 'rgb(255, 255, 255)'],\n            ['h1', 'color', 'rgb(255, 165, 0)']\n        ]);\n\n        await devtoolsUtils.reset();\n    });","file":"browser/e2e/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"If multiple matching URL patterns found, select the most specific one","suites":["Correct fixes are chosen"],"updatePoint":{"line":82,"column":77},"line":82,"code":"    it('If multiple matching URL patterns found, select the most specific one', async () => {\n        await loadBasicPage();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)']\n        ]);\n\n        await devtoolsUtils.paste(multiline(\n            '*',\n            '',\n            'CSS',\n            'body {',\n            '    background: navy;',\n            '    color: white;',\n            '}',\n            'h1 {',\n            '    color: orange;',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891/',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: blue;',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: green;',\n            '}',\n            '',\n        ));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(0, 0, 128)'],\n            ['body', 'color', 'rgb(255, 255, 255)'],\n            ['h1', 'color', 'rgb(255, 165, 0)']\n        ]);\n\n        await devtoolsUtils.reset();\n    });","file":"browser/e2e/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"BUG COMPATIBILITY: If multiple matching URL patterns found, the most specific fix is determined by the length of first pattern","suites":["Correct fixes are chosen"],"updatePoint":{"line":136,"column":134},"line":136,"code":"    it('BUG COMPATIBILITY: If multiple matching URL patterns found, the most specific fix is determined by the length of first pattern', async () => {\n        await loadBasicPage();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)']\n        ]);\n\n        await devtoolsUtils.paste(multiline(\n            '*',\n            '',\n            'CSS',\n            'body {',\n            '    background: navy;',\n            '    color: white;',\n            '}',\n            'h1 {',\n            '    color: orange;',\n            '}',\n            '',\n            '============================',\n            '',\n            'example.com/loooooooong',\n            'localhost:8891',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: blue;',\n            '}',\n            '',\n            '============================',\n            '',\n            'example.com',\n            'localhost:8891/',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: green;',\n            '}',\n            '',\n        ));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(0, 0, 128)'],\n            ['body', 'color', 'rgb(255, 255, 255)'],\n            ['h1', 'color', 'rgb(255, 165, 0)'],\n        ]);\n\n        await devtoolsUtils.reset();\n    });","file":"browser/e2e/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"BUG COMPATIBILITY: If multiple matching URL patterns of the same length are found, select the first one","suites":["Correct fixes are chosen"],"updatePoint":{"line":192,"column":111},"line":192,"code":"    it('BUG COMPATIBILITY: If multiple matching URL patterns of the same length are found, select the first one', async () => {\n        await loadBasicPage();\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n        ]);\n\n        await devtoolsUtils.paste(multiline(\n            '*',\n            '',\n            'CSS',\n            'body {',\n            '    background: navy;',\n            '    color: white;',\n            '}',\n            'h1 {',\n            '    color: orange;',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: blue;',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: green;',\n            '}',\n            '',\n        ));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(0, 0, 128)'],\n            ['body', 'color', 'rgb(255, 255, 255)'],\n            ['h1', 'color', 'rgb(255, 165, 0)'],\n        ]);\n\n        await devtoolsUtils.reset();\n    });","file":"browser/e2e/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Different paths upon initial load","suites":["Different paths in URL patterns"],"updatePoint":{"line":63,"column":41},"line":63,"code":"    it('Different paths upon initial load', async () => {\n        await Promise.all([\n            awaitForEvent('ready-/red.html'),\n            awaitForEvent('ready-/blue.html'),\n            loadBasicPage(),\n        ]);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n\n            [['iframe#red', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'h1'], 'color', 'rgb(255, 26, 26)'],\n\n            [['iframe#blue', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'h1'], 'color', 'rgb(51, 125, 255)'],\n        ]);\n\n        await devtoolsUtils.paste([\n            '*',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: black',\n            '    color: white',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891/red',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: black',\n            '}',\n            'h1 {',\n            '    color: indigo;',\n            '}',\n            '',\n            '============================',\n            '',\n            'localhost:8891/blue',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: black',\n            '}',\n            'h1 {',\n            '    color: navy;',\n            '}',\n            '',\n            '============================',\n            '',\n            'nonexistent.com',\n            '',\n            'CSS',\n            'body {',\n            '    bachground: purple',\n            '}',\n            '',\n        ].join('\\n'));\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n            ['h2', 'color', 'rgb(232, 230, 227)'],\n\n            [['iframe#red', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'h1'], 'color', 'rgb(75, 0, 130)'],\n\n            [['iframe#blue', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'h1'], 'color', 'rgb(0, 0, 128)'],\n        ]);\n\n        const redPromise = awaitForEvent('darkreader-dynamic-theme-ready-/red.html');\n        const bluePromise = awaitForEvent('darkreader-dynamic-theme-ready-/blue.html');\n        await Promise.all([\n            redPromise,\n            bluePromise,\n            devtoolsUtils.reset(),\n        ]);\n\n        await timeout(500);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(232, 230, 227)'],\n\n            [['iframe#red', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#red', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#red', 'h1'], 'color', 'rgb(255, 26, 26)'],\n\n            [['iframe#blue', 'document'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'document'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'body'], 'background-color', 'rgba(0, 0, 0, 0)'],\n            [['iframe#blue', 'body'], 'color', 'rgb(232, 230, 227)'],\n            [['iframe#blue', 'h1'], 'color', 'rgb(51, 125, 255)'],\n        ]);\n    });","file":"browser/e2e/origin.tests.ts","skipped":false,"dir":"tests"},{"name":"should turn On/Off","suites":["Toggling the extension"],"updatePoint":{"line":32,"column":26},"line":32,"code":"    it('should turn On/Off', async () => {\n        await loadBasicPage('Toggle on/off');\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n\n        await popupUtils.click('.toggle__off');\n        await timeout(500);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['document', 'color', 'rgb(0, 0, 0)'],\n            ['body', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['body', 'color', 'rgb(0, 0, 0)'],\n            ['h1', 'color', 'rgb(255, 0, 0)'],\n            ['a', 'color', 'rgb(0, 0, 238)'],\n        ]);\n\n        await popupUtils.click('.toggle__on');\n        await timeout(500);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n    });","file":"browser/e2e/toggle.tests.ts","skipped":false,"dir":"tests"},{"name":"should follow system color scheme","suites":["Toggling the extension"],"updatePoint":{"line":69,"column":41},"line":69,"code":"    it('should follow system color scheme', async () => {\n        await loadBasicPage('Automation (color scheme)');\n\n        const automationMenuSelector = '.header__app-toggle__more-button';\n        const automationSystemSelector = '.header__app-toggle__more-settings__system-dark-mode__checkbox .checkbox__input';\n\n        await emulateMedia('prefers-color-scheme', 'light');\n        await expect(getColorScheme()).resolves.toBe('light');\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n\n        await popupUtils.click(automationMenuSelector);\n        await timeout(250);\n        await popupUtils.click(automationSystemSelector);\n        await timeout(250);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['document', 'color', 'rgb(0, 0, 0)'],\n            ['body', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['body', 'color', 'rgb(0, 0, 0)'],\n            ['h1', 'color', 'rgb(255, 0, 0)'],\n            ['a', 'color', 'rgb(0, 0, 238)'],\n        ]);\n\n        await emulateMedia('prefers-color-scheme', 'dark');\n        await expect(getColorScheme()).resolves.toBe('dark');\n        await timeout(250);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n\n        await emulateMedia('prefers-color-scheme', 'light');\n        await expect(getColorScheme()).resolves.toBe('light');\n        await timeout(250);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['document', 'color', 'rgb(0, 0, 0)'],\n            ['body', 'background-color', 'rgba(0, 0, 0, 0)'],\n            ['body', 'color', 'rgb(0, 0, 0)'],\n            ['h1', 'color', 'rgb(255, 0, 0)'],\n            ['a', 'color', 'rgb(0, 0, 238)'],\n        ]);\n\n        await popupUtils.click(automationSystemSelector);\n        await timeout(250);\n\n        await expectStyles([\n            ['document', 'background-color', 'rgb(24, 26, 27)'],\n            ['document', 'color', 'rgb(232, 230, 227)'],\n            ['body', 'background-color', 'rgb(24, 26, 27)'],\n            ['body', 'color', 'rgb(232, 230, 227)'],\n            ['h1', 'color', 'rgb(255, 26, 26)'],\n            ['a', 'color', 'rgb(51, 145, 255)'],\n        ]);\n\n        await emulateMedia('prefers-color-scheme', 'dark');\n    });","file":"browser/e2e/toggle.tests.ts","skipped":false,"dir":"tests"},{"name":"Modifying sync settings to contain long list","suites":["Modifying settings"],"updatePoint":{"line":2,"column":52},"line":2,"code":"    it('Modifying sync settings to contain long list', async () => {\n        const newSettings = {\n            siteList: [] as string[],\n            siteListEnabled: [] as string[],\n            syncSettings: true,\n        };\n\n        // Cummulative length should be over the browser limit on record size.\n        for (let i = 0; i < 1000; i ++) {\n            newSettings.siteList.push(`example${i}.com`);\n        }\n\n        await backgroundUtils.changeSettings(newSettings);\n\n        const extensionData = await backgroundUtils.collectData();\n        expect(extensionData.settings.syncSettings).toBe(true);\n        expect(extensionData.settings.siteList.length).toBe(1000);\n    });","file":"browser/settings/sitelist.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify RGBA","suites":["COLOR PARSING"],"updatePoint":{"line":22,"column":26},"line":22,"code":"    it('should modify RGBA', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: rgb(245, 185, 124); }',\n            '    h1 strong { color: rgb(34, 52, 34); }',\n            '    body { background-color: rgba(51, 170, 51, .4); }',\n            '</style>',\n            '<h1>RGB <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(126, 68, 10)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(205, 200, 194)');\n        expect(getComputedStyle(container).backgroundColor).toBe('rgba(41, 136, 41, 0.4)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify HSL","suites":["COLOR PARSING"],"updatePoint":{"line":37,"column":25},"line":37,"code":"    it('should modify HSL', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: hsl(270,60%,70%); }',\n            '    h1 strong { color: hsl(.75turn, 60%, 70%); }',\n            '    body { background-color: hsl(4.71239rad, 60%, 70%); }',\n            '</style>',\n            '<h1>HSL <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(72, 29, 114)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(176, 129, 223)');\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(72, 29, 114)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify HSLA","suites":["COLOR PARSING"],"updatePoint":{"line":52,"column":26},"line":52,"code":"    it('should modify HSLA', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: hsla(240, 100%, 50%, .7); }',\n            '    h1 strong { color: hsla(240, 100%, 50%, 1); }',\n            '    body { background-color: hsla(240, 100%, 50%, .05); }',\n            '</style>',\n            '<h1>HSLA <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 204, 0.7)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(51, 125, 255)');\n        expect(getComputedStyle(container).backgroundColor).toBe('rgba(0, 0, 204, 0.05)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify knownColors","suites":["COLOR PARSING"],"updatePoint":{"line":67,"column":33},"line":67,"code":"    it('should modify knownColors', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: rebeccapurple; }',\n            '    h1 strong { color: InfoBackground; }',\n            '    body { background-color: transparent; }',\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(82, 41, 122)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(249, 250, 166)');\n        expect(getComputedStyle(container).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle calc(...) cases","suites":["COLOR PARSING"],"updatePoint":{"line":82,"column":37},"line":82,"code":"    it('should handle calc(...) cases', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background-color: hsl(0, 0%, calc(95% - 3%)) }',\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(35, 38, 40)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle gradient's cases with rgb(...) xx%","suites":["COLOR PARSING"],"updatePoint":{"line":93,"column":57},"line":93,"code":"    it('should handle gradient\\'s cases with rgb(...) xx%', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background-image: -webkit-linear-gradient(bottom, rgb(255, 255, 255) 15%, rgb(246, 246, 245) 85%); }',\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage).toBe('-webkit-linear-gradient(bottom, rgb(24, 26, 27) 15%, rgb(29, 32, 33) 85%)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle complex calc(...) cases","suites":["COLOR PARSING"],"updatePoint":{"line":104,"column":45},"line":104,"code":"    it('should handle complex calc(...) cases', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background-color: rgb(calc(216.75 + 153 * .15), calc(216.75 + 205 * .15), calc(216.75 + 255 * .15)) }',\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(28, 31, 32)');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle gradients with calc(...) cases","suites":["COLOR PARSING"],"updatePoint":{"line":115,"column":52},"line":115,"code":"    it('should handle gradients with calc(...) cases', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background-image: linear-gradient(rgb(249, 249, 251) calc(100% - 3px), transparent), linear-gradient(-90deg, rgb(255, 145, 0), rgb(241, 3, 102) 50%, rgb(97, 115, 255)) }',\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage).toBe('linear-gradient(rgb(27, 29, 30), calc(100% - 3px), rgba(0, 0, 0, 0)), linear-gradient(-90deg, rgb(204, 116, 0), rgb(193, 2, 82) 50%, rgb(0, 17, 146))');\n    });","file":"inject/dynamic/color.tests.ts","skipped":false,"dir":"tests"},{"name":"should add custom attributes to root element","suites":["FIXES"],"updatePoint":{"line":23,"column":52},"line":23,"code":"    it('should add custom attributes to root element', () => {\n        createOrUpdateDynamicTheme(DEFAULT_THEME, null, false);\n        expect(document.documentElement.getAttribute(`data-darkreader-mode`)).toBe('dynamic');\n        expect(document.documentElement.getAttribute('data-darkreader-scheme')).toBe('dark');\n\n        createOrUpdateDynamicTheme({...DEFAULT_THEME, mode: FilterMode.light}, null, false);\n        expect(document.documentElement.getAttribute('data-darkreader-scheme')).toBe('dimmed');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should invert selectors","suites":["FIXES"],"updatePoint":{"line":32,"column":31},"line":32,"code":"    it('should invert selectors', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"logo\">Some logo</div>',\n        );\n        const fixes: DynamicThemeFix[] = [{\n            url: ['*'],\n            invert: ['.logo'],\n            css: '',\n            ignoreInlineStyle: [],\n            ignoreImageAnalysis: [],\n            disableStyleSheetsProxy: false,\n\n        }];\n        createOrUpdateDynamicTheme(DEFAULT_THEME, fixes, false);\n        expect(getComputedStyle(container.querySelector('.logo')).filter).toBe('invert(1) hue-rotate(180deg) contrast(0.9)');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should insert CSS","suites":["FIXES"],"updatePoint":{"line":49,"column":25},"line":49,"code":"    it('should insert CSS', async () => {\n        container.innerHTML = multiline(\n            '<p class=\"text\">Some text need to be red</p>',\n        );\n        const fixes: DynamicThemeFix[] = [{\n            url: ['*'],\n            invert: [''],\n            css: '.text { color: red }',\n            ignoreInlineStyle: [],\n            ignoreImageAnalysis: [],\n            disableStyleSheetsProxy: false,\n\n        }];\n        createOrUpdateDynamicTheme(DEFAULT_THEME, fixes, false);\n        expect(getComputedStyle(container.querySelector('.text')).color).toBe('rgb(255, 0, 0)');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should ignore inline style","suites":["FIXES"],"updatePoint":{"line":66,"column":34},"line":66,"code":"    it('should ignore inline style', async () => {\n        container.innerHTML = multiline(\n            '<p class=\"text\" style=\"background-color: purple\">Some text need to be red</p>',\n        );\n        const fixes: DynamicThemeFix[] = [{\n            url: ['*'],\n            invert: [''],\n            css: '',\n            ignoreInlineStyle: ['.text'],\n            ignoreImageAnalysis: [],\n            disableStyleSheetsProxy: false,\n\n        }];\n        createOrUpdateDynamicTheme(DEFAULT_THEME, fixes, false);\n        expect(getComputedStyle(container.querySelector('.text')).backgroundColor).toBe('rgb(128, 0, 128)');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should ignore styling when darkreader-lock detected","suites":["FIXES"],"updatePoint":{"line":83,"column":59},"line":83,"code":"    it('should ignore styling when darkreader-lock detected', async () => {\n        document.head.innerHTML = '<meta name=\"darkreader-lock\"></meta>',\n        container.innerHTML = multiline(\n            '<style>',\n            '    body {',\n            '        background-color: pink !important;',\n            '    }',\n            '</style>',\n        );\n        createOrUpdateDynamicTheme(DEFAULT_THEME, null, false);\n\n        expect(getComputedStyle(document.body).backgroundColor).toBe('rgb(255, 192, 203)');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should ignore styling when delayed darkreader-lock detected","suites":["FIXES"],"updatePoint":{"line":97,"column":67},"line":97,"code":"    it('should ignore styling when delayed darkreader-lock detected', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    body {',\n            '        background-color: pink !important;',\n            '    }',\n            '</style>',\n        );\n        createOrUpdateDynamicTheme(DEFAULT_THEME, null, false);\n\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(89, 0, 16)');\n        const metaElement: HTMLMetaElement = document.createElement('meta');\n        metaElement.name = 'darkreader-lock';\n        document.head.appendChild(metaElement);\n        await timeout(100);\n\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(255, 192, 203)');\n    });","file":"inject/dynamic/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"should analyze dark icon","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":127,"column":32},"line":127,"code":"    it('should analyze dark icon', async () => {\n        const details = await getImageDetails(svgToDataURL(images.darkIcon));\n        expect(details.width).toBe(8);\n        expect(details.height).toBe(8);\n        expect(details.isDark).toBe(true);\n        expect(details.isLight).toBe(false);\n        expect(details.isTransparent).toBe(false);\n        expect(details.isLarge).toBe(false);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should analyze light icon","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":137,"column":33},"line":137,"code":"    it('should analyze light icon', async () => {\n        const details = await getImageDetails(svgToDataURL(images.lightIcon));\n        expect(details.width).toBe(8);\n        expect(details.height).toBe(8);\n        expect(details.isDark).toBe(false);\n        expect(details.isLight).toBe(true);\n        expect(details.isTransparent).toBe(false);\n        expect(details.isLarge).toBe(false);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should analyze dark transparent icon","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":147,"column":44},"line":147,"code":"    it('should analyze dark transparent icon', async () => {\n        const details = await getImageDetails(svgToDataURL(images.darkTransparentIcon));\n        expect(details.width).toBe(8);\n        expect(details.height).toBe(8);\n        expect(details.isDark).toBe(true);\n        expect(details.isLight).toBe(false);\n        expect(details.isTransparent).toBe(true);\n        expect(details.isLarge).toBe(false);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should analyze large image","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":157,"column":34},"line":157,"code":"    it('should analyze large image', async () => {\n        const details = await getImageDetails(svgToDataURL(images.largeDarkImage));\n        expect(details.width).toBe(1024);\n        expect(details.height).toBe(1024);\n        expect(details.isDark).toBe(true);\n        expect(details.isLight).toBe(false);\n        expect(details.isTransparent).toBe(false);\n        expect(details.isLarge).toBe(true);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should invert dark icons","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":167,"column":32},"line":167,"code":"    it('should invert dark icons', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            getSVGImageCSS(images.darkTransparentIcon, 16, 16, 'i'),\n            '</style>',\n            '<h1>Dark icon <i></i></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        await timeout(500);\n        const bgImageValue = getComputedStyle(container.querySelector('i')).backgroundImage;\n        const info = await getBgImageInfo(bgImageValue);\n        expect(info.darkness).toBe(0);\n        expect(info.lightness).toBe(1);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should not invert light icons","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":183,"column":37},"line":183,"code":"    it('should not invert light icons', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            getSVGImageCSS(images.lightTransparentIcon, 16, 16, 'i'),\n            '</style>',\n            '<h1>Light icon <i></i></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const bgImageValue = getComputedStyle(container.querySelector('i')).backgroundImage;\n        const info = await getBgImageInfo(bgImageValue);\n        expect(info.darkness).toBe(0);\n        expect(info.lightness).toBe(1);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should not invert dark backgrounds","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":197,"column":42},"line":197,"code":"    it('should not invert dark backgrounds', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            getSVGImageCSS(images.largeDarkImage, 320, 320, 'h1'),\n            '</style>',\n            '<h1>Dark background</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const bgImageValue = getComputedStyle(container.querySelector('h1')).backgroundImage;\n        const info = await getBgImageInfo(bgImageValue);\n        expect(info.darkness).toBe(1);\n        expect(info.lightness).toBe(0);\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should hide light backgrounds","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":211,"column":37},"line":211,"code":"    it('should hide light backgrounds', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            getSVGImageCSS(images.largeLightImage, 320, 320, 'h1'),\n            '</style>',\n            '<h1>Light background</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        const bgImageValue = getComputedStyle(container.querySelector('h1')).backgroundImage;\n        expect(bgImageValue).toBe('none');\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should ignore image analysis","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":224,"column":36},"line":224,"code":"    it('should ignore image analysis', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            getSVGImageCSS(images.darkTransparentIcon, 16, 16, 'i'),\n            '</style>',\n            '<h1>Dark icon <i></i></h1>',\n        );\n        const fixes: DynamicThemeFix[] = [{\n            url: ['*'],\n            invert: [''],\n            css: '',\n            ignoreInlineStyle: ['.'],\n            ignoreImageAnalysis: ['*'],\n            disableStyleSheetsProxy: false,\n        }];\n        createOrUpdateDynamicTheme(theme, fixes, false);\n        const backgroundImage = getComputedStyle(container.querySelector('i')).backgroundImage;\n        expect(backgroundImage).toContain('data:');\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle background-image with URL and gradient","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":244,"column":60},"line":244,"code":"    it('should handle background-image with URL and gradient', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            `    h1 { background-image: url(\"${svgToDataURL(images.lightIcon)}\"), linear-gradient(red, white);`,\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage).toBe('url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iOCIgaGVpZ2h0PSI4Ij48ZGVmcz48ZmlsdGVyIGlkPSJkYXJrcmVhZGVyLWltYWdlLWZpbHRlciI+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAuMzMzIC0wLjY2NyAtMC42NjcgMC4wMDAgMS4wMDAgLTAuNjY3IDAuMzMzIC0wLjY2NyAwLjAwMCAxLjAwMCAtMC42NjcgLTAuNjY3IDAuMzMzIDAuMDAwIDEuMDAwIDAuMDAwIDAuMDAwIDAuMDAwIDEuMDAwIDAuMDAwIiAvPjwvZmlsdGVyPjwvZGVmcz48aW1hZ2Ugd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsdGVyPSJ1cmwoI2RhcmtyZWFkZXItaW1hZ2UtZmlsdGVyKSIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTRJRGdpSUhkcFpIUm9QU0k0SWlCb1pXbG5hSFE5SWpnaVBnb2dJQ0FnUEhKbFkzUWdabWxzYkQwaWQyaHBkR1VpSUhkcFpIUm9QU0l4TURBbElpQm9aV2xuYUhROUlqRXdNQ1VpSUM4K0Nqd3ZjM1puUGc9PSIgLz48L3N2Zz4=\"), linear-gradient(rgb(204, 0, 0), rgb(0, 0, 0))');\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle background-image with URL and gradient (revered)","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":256,"column":70},"line":256,"code":"    it('should handle background-image with URL and gradient (revered)', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            `    h1 { background-image: linear-gradient(red, white), url(\"${svgToDataURL(images.lightIcon)}\");`,\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        await timeout(500);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage).toBe('linear-gradient(rgb(204, 0, 0), rgb(0, 0, 0)), url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iOCIgaGVpZ2h0PSI4Ij48ZGVmcz48ZmlsdGVyIGlkPSJkYXJrcmVhZGVyLWltYWdlLWZpbHRlciI+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAuMzMzIC0wLjY2NyAtMC42NjcgMC4wMDAgMS4wMDAgLTAuNjY3IDAuMzMzIC0wLjY2NyAwLjAwMCAxLjAwMCAtMC42NjcgLTAuNjY3IDAuMzMzIDAuMDAwIDEuMDAwIDAuMDAwIDAuMDAwIDAuMDAwIDEuMDAwIDAuMDAwIiAvPjwvZmlsdGVyPjwvZGVmcz48aW1hZ2Ugd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsdGVyPSJ1cmwoI2RhcmtyZWFkZXItaW1hZ2UtZmlsdGVyKSIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTRJRGdpSUhkcFpIUm9QU0k0SWlCb1pXbG5hSFE5SWpnaVBnb2dJQ0FnUEhKbFkzUWdabWxzYkQwaWQyaHBkR1VpSUhkcFpIUm9QU0l4TURBbElpQm9aV2xuYUhROUlqRXdNQ1VpSUM4K0Nqd3ZjM1puUGc9PSIgLz48L3N2Zz4=\")');\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle background-image with empty URLs","suites":["IMAGE ANALYSIS"],"updatePoint":{"line":269,"column":54},"line":269,"code":"    it('should handle background-image with empty URLs', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            `    h1 { background-image: url(''), url(''), url(\"${svgToDataURL(images.lightIcon)}\");`,\n            '</style>',\n            '<h1>Weird color <strong>Power</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage.startsWith(isFirefox ? `url(\"about:invalid\"), url(\"about:invalid\")` : `url(\"http://localhost`)).toBeTrue();\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage.endsWith(`url(\"data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHhtbG5zOnhsaW5rPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5L3hsaW5rIiB3aWR0aD0iOCIgaGVpZ2h0PSI4Ij48ZGVmcz48ZmlsdGVyIGlkPSJkYXJrcmVhZGVyLWltYWdlLWZpbHRlciI+PGZlQ29sb3JNYXRyaXggdHlwZT0ibWF0cml4IiB2YWx1ZXM9IjAuMzMzIC0wLjY2NyAtMC42NjcgMC4wMDAgMS4wMDAgLTAuNjY3IDAuMzMzIC0wLjY2NyAwLjAwMCAxLjAwMCAtMC42NjcgLTAuNjY3IDAuMzMzIDAuMDAwIDEuMDAwIDAuMDAwIDAuMDAwIDAuMDAwIDEuMDAwIDAuMDAwIiAvPjwvZmlsdGVyPjwvZGVmcz48aW1hZ2Ugd2lkdGg9IjgiIGhlaWdodD0iOCIgZmlsdGVyPSJ1cmwoI2RhcmtyZWFkZXItaW1hZ2UtZmlsdGVyKSIgeGxpbms6aHJlZj0iZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCxQSE4yWnlCNGJXeHVjejBpYUhSMGNEb3ZMM2QzZHk1M015NXZjbWN2TWpBd01DOXpkbWNpSUhacFpYZENiM2c5SWpBZ01DQTRJRGdpSUhkcFpIUm9QU0k0SWlCb1pXbG5hSFE5SWpnaVBnb2dJQ0FnUEhKbFkzUWdabWxzYkQwaWQyaHBkR1VpSUhkcFpIUm9QU0l4TURBbElpQm9aV2xuYUhROUlqRXdNQ1VpSUM4K0Nqd3ZjM1puUGc9PSIgLz48L3N2Zz4=\")`)).toBeTrue();\n    });","file":"inject/dynamic/image-analysis.tests.ts","skipped":false,"dir":"tests"},{"name":"should override inline style","suites":["INLINE STYLES"],"updatePoint":{"line":24,"column":36},"line":24,"code":"    it('should override inline style', () => {\n        container.innerHTML = '<span style=\"color: red;\">Inline style override</span>';\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('span')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should watch for inline style change","suites":["INLINE STYLES"],"updatePoint":{"line":30,"column":44},"line":30,"code":"    it('should watch for inline style change', async () => {\n        container.innerHTML = '<span style=\"color: red;\">Watch inline style</span>';\n        createOrUpdateDynamicTheme(theme, null, false);\n        const span = document.querySelector('span');\n        expect(getComputedStyle(span).color).toBe('rgb(255, 26, 26)');\n\n        span.style.color = 'green';\n        await timeout(0);\n        expect(getComputedStyle(span).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override only a single inline style property","suites":["INLINE STYLES"],"updatePoint":{"line":41,"column":59},"line":41,"code":"    it('should override only a single inline style property', async () => {\n        container.innerHTML = multiline(\n            '<style>.bg-gray { background: gray; }</style>',\n            '<span class=\"bg-gray\" style=\"color: red;\">Inline style override</span>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const span = container.querySelector('span');\n        expect(getComputedStyle(span).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(span).color).toBe('rgb(255, 26, 26)');\n\n        span.style.color = 'green';\n        await timeout(0);\n        expect(getComputedStyle(span).color).toBe('rgb(140, 255, 140)');\n        expect(getComputedStyle(span).backgroundColor).toBe('rgb(102, 102, 102)');\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should clean up the customProp after originial is gone","suites":["INLINE STYLES"],"updatePoint":{"line":57,"column":62},"line":57,"code":"    it('should clean up the customProp after originial is gone', async () => {\n        container.innerHTML = '<span style=\"color: red;\">Watch inline style</span>';\n        createOrUpdateDynamicTheme(theme, null, false);\n        const span = document.querySelector('span');\n        expect(span.getAttribute('style').startsWith('color: red; --darkreader-inline-color:')).toBeTrue();\n        expect(span.getAttribute('style').endsWith('#ff1a1a;')).toBeTrue();\n\n        span.style.color = '';\n        await timeout(0);\n        expect(span.getAttribute('style')).toBe('');\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"shouldn't touch rel=\"mask-icon\"","suites":["INLINE STYLES"],"updatePoint":{"line":69,"column":39},"line":69,"code":"    it(`shouldn't touch rel=\"mask-icon\"`, async () => {\n        container.innerHTML = '<link rel=\"mask-icon\" color=\"red\">';\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const maskIcon = document.querySelector('link[rel=\"mask-icon\"]');\n        expect(maskIcon.getAttribute('style')).toBe(null);\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"shouldn't touch a \"none\" value for fill","suites":["INLINE STYLES"],"updatePoint":{"line":77,"column":47},"line":77,"code":"    it(`shouldn't touch a \"none\" value for fill`, async () => {\n        container.innerHTML = `<svg> <rect width=\"100\" height=\"100\" fill=\"none\" /></svg>`;\n        container.innerHTML += `<style> rect[width][height] { fill: red }</style>`;\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const rect = container.querySelector('rect');\n        expect(getComputedStyle(rect).fill).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/inline-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override same-origin link","suites":["LINK STYLES"],"updatePoint":{"line":58,"column":40},"line":58,"code":"    it('should override same-origin link', async () => {\n        createStyleLink(`data:text/css;utf8,${encodeURIComponent(multiline(\n            'h1 { background: gray; }',\n            'h1 strong { color: red; }',\n        ))}`);\n        container.innerHTML = multiline(\n            '<h1>Link <strong>override</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(50);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override cross-origin link","suites":["LINK STYLES"],"updatePoint":{"line":74,"column":41},"line":74,"code":"    it('should override cross-origin link', async () => {\n        createCorsLink(multiline(\n            'h1 { background: gray; }',\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1><strong>Cross-origin</strong> link override</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override cross-origin imports in linked CSS","suites":["LINK STYLES"],"updatePoint":{"line":90,"column":58},"line":90,"code":"    it('should override cross-origin imports in linked CSS', async () => {\n        const importedCSS = 'h1 { background: gray; }';\n        const importedURL = getCSSEchoURL(importedCSS);\n        stubBackgroundFetchResponse(importedURL, importedCSS);\n        createCorsLink(multiline(\n            `@import \"${importedURL}\";`,\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1><strong>Cross-origin import</strong> link override</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override cross-origin imports in linked CSS with capital @import","suites":["LINK STYLES"],"updatePoint":{"line":109,"column":79},"line":109,"code":"    it('should override cross-origin imports in linked CSS with capital @import', async () => {\n        const importedCSS = 'h1 { background: gray; }';\n        const importedURL = getCSSEchoURL(importedCSS);\n        stubBackgroundFetchResponse(importedURL, importedCSS);\n        createCorsLink(multiline(\n            `@IMPORT \"${importedURL}\";`,\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1><strong>Cross-origin import</strong> link override</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override cross-origin link that has already been loaded","suites":["LINK STYLES"],"updatePoint":{"line":127,"column":70},"line":127,"code":"    it('should override cross-origin link that has already been loaded', async () => {\n        createCorsLink(multiline(\n            'h1 { background: gray; }',\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1>Loaded <strong>cross-origin</strong> link override</h1>',\n        );\n\n        await waitForLinkLoading(selectTestStyleLink());\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(128, 128, 128)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 0, 0)');\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should remove manager from disabled link","suites":["LINK STYLES"],"updatePoint":{"line":148,"column":48},"line":148,"code":"    it('should remove manager from disabled link', async () => {\n        const link = createStyleLink(`data:text/css;utf8,${encodeURIComponent(multiline(\n            'h1 { background: gray; }',\n            'h1 strong { color: red; }',\n        ))}`);\n        container.innerHTML = multiline(\n            '<h1>Link <strong>disabled</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(50);\n        expect(selectTestStyleLink().nextElementSibling.classList.contains(isSafari ? 'darkreader--cors' : 'darkreader--sync')).toBe(true);\n        link.disabled = true;\n        await timeout(0);\n        expect(selectTestStyleLink().nextElementSibling.classList.contains(isSafari ? 'darkreader--cors' : 'darkreader--sync')).toBe(false);\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"Shouldn't wait on link that won't be loaded","suites":["LINK STYLES"],"updatePoint":{"line":164,"column":51},"line":164,"code":"    it(\"Shouldn't wait on link that won't be loaded\", async () => {\n        const link = createStyleLink(null);\n        link.setAttribute('data-href', `data:text/css;utf8,${encodeURIComponent(multiline(\n            'h1 { background: green !important; }',\n            'h1 strong { color: orange !important; }',\n        ))}`);\n        container.innerHTML = multiline(\n            '<style>',\n            '   h1 { background: gray; }',\n            '</style>',\n            '<h1>Link <strong>loading with non-href attribute</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(50);\n        const h1 = document.querySelector('h1');\n        expect(getComputedStyle(h1).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(document.querySelector('.darkreader--fallback').textContent).toBe('');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle styles with @import \"...\" screen;","suites":["LINK STYLES"],"updatePoint":{"line":184,"column":55},"line":184,"code":"    it('should handle styles with @import \"...\" screen;', async () => {\n        const importedCSS = 'h1 { background: gray; }';\n        const importedURL = getCSSEchoURL(importedCSS);\n        stubBackgroundFetchResponse(importedURL, importedCSS);\n        createCorsLink(multiline(\n            `@import \"${importedURL}\" screen;`,\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1><strong>Cross-origin import</strong> link override</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle styles with invalid url(...)","suites":["LINK STYLES"],"updatePoint":{"line":203,"column":50},"line":203,"code":"    it('should handle styles with invalid url(...)', async () => {\n        const importedCSS = 'h1 { background-image: url(\"freecookies:3https://example.com\"); background-color: gray; }';\n        const importedURL = getCSSEchoURL(importedCSS);\n        stubBackgroundFetchResponse(importedURL, importedCSS);\n        stubBackgroundFetchResponse('freecookies:3https://example.com', '');\n        createCorsLink(multiline(\n            `@import \"${importedURL}\" screen;`,\n            'h1 strong { color: red; }',\n        ));\n        container.innerHTML = multiline(\n            '<h1><strong>Cross-origin import</strong> link override</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await waitForEvent('__darkreader__test__dynamicUpdateComplete');\n        await timeout(1000);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/link-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should not style blacklisted media","suites":["MEDIA QUERIES"],"updatePoint":{"line":24,"column":42},"line":24,"code":"    it('should not style blacklisted media', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { background: green; }',\n            '    h1 strong { color: orange; }',\n            '</style>',\n            '<style class=\"testcase-style-2\" media=\"print\">',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');\n        expect(document.querySelector('.testcase-style-2').nextElementSibling.classList.contains('darkreader--sync')).toBe(false);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should style lazyloaded media","suites":["MEDIA QUERIES"],"updatePoint":{"line":43,"column":37},"line":43,"code":"    it('should style lazyloaded media', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\" media=\"print\" onload=\"this.media=`screen`\">',\n            '    h1 { background: green; }',\n            '    h1 strong { color: orange; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(0);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');\n        expect(document.querySelector('.testcase-style').nextElementSibling.classList.contains('darkreader--sync')).toBe(true);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should check for CSS support","suites":["MEDIA QUERIES"],"updatePoint":{"line":60,"column":36},"line":60,"code":"    it('should check for CSS support', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    @supports (background: green) {',\n            '       h1 { background: green; }',\n            '    }',\n            '    @supports (color: orange) {',\n            '       h1 strong { color: orange; }',\n            '    }',\n            '    @supports (some-non-existing-prop: some-value) {',\n            '       body { background: pink; }',\n            '    }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');\n        expect(getComputedStyle(document.body).backgroundColor).toBe('rgb(0, 0, 0)');\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should check for CSS @media","suites":["MEDIA QUERIES"],"updatePoint":{"line":82,"column":35},"line":82,"code":"    it('should check for CSS @media', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    @media screen and (min-width: 2px) {',\n            '       h1 { background: green; }',\n            '    }',\n            '    @media screen and (min-width: 200000px) {',\n            '       h1 { background: orange; }',\n            '    }',\n            '</style>',\n            '<h1>Some test media query i guess</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect((document.querySelector('.testcase-style').nextElementSibling as HTMLStyleElement).sheet.cssRules.length).toBe(2);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should check for nested CSS @media","suites":["MEDIA QUERIES"],"updatePoint":{"line":100,"column":42},"line":100,"code":"    it('should check for nested CSS @media', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '   @media screen and (min-width: 2px) {',\n            '       @media screen and (min-width: 2px) {',\n            '           h1 { background: green; }',\n            '       }',\n            '   }',\n            '   @media screen and (min-width: 200000px) {',\n            '       h1 { background: orange; }',\n            '   }',\n            '</style>',\n            '<h1>Some test media query i guess</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect((document.querySelector('.testcase-style').nextElementSibling as HTMLStyleElement).sheet.cssRules.length).toBe(2);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should style print/media query","suites":["MEDIA QUERIES"],"updatePoint":{"line":120,"column":38},"line":120,"code":"    it('should style print/media query', () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { background: green; }',\n            '    h1 strong { color: orange; }',\n            '</style>',\n            '<style class=\"testcase-style-2\" media=\"print, screen and (max-width: 9999999px)\">',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uh media query :D</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n        expect(document.querySelector('.testcase-style-2').nextElementSibling.classList.contains('darkreader--sync')).toBe(true);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle same cssText but different media rule","suites":["MEDIA QUERIES"],"updatePoint":{"line":138,"column":59},"line":138,"code":"    it('should handle same cssText but different media rule', () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '   @media screen and (min-width: 200000000000000000000px) {',\n            '       h1 { background: green; }',\n            '   }',\n            '   @media screen and (min-width: 4px) {',\n            '       h1 { background: green; }',\n            '   }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should not style blacklisted media and handle uppercase media","suites":["MEDIA QUERIES"],"updatePoint":{"line":155,"column":69},"line":155,"code":"    it('should not style blacklisted media and handle uppercase media', () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { background: green; }',\n            '    h1 strong { color: orange; }',\n            '</style>',\n            '<style class=\"testcase-style-2\" media=\"Print\">',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');\n        expect(document.querySelector('.testcase-style-2').nextElementSibling.classList.contains('darkreader--sync')).toBe(false);\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle media query and print","suites":["MEDIA QUERIES"],"updatePoint":{"line":174,"column":43},"line":174,"code":"    it('should handle media query and print', () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '   @media (min-width: 2px), print {',\n            '       h1 { background: green; }',\n            '   }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n    });","file":"inject/dynamic/media-query.tests.ts","skipped":false,"dir":"tests"},{"name":"should add static overrides","suites":["SHADOW DOM"],"updatePoint":{"line":25,"column":35},"line":25,"code":"    it('should add static overrides', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"shadow-dom-wrapper\"></div>',\n        );\n        document.querySelector('.shadow-dom-wrapper').attachShadow({mode: 'open'});\n        createOrUpdateDynamicTheme(theme, null, false);\n        const shadowRoot = document.querySelector('.shadow-dom-wrapper').shadowRoot;\n        expect(shadowRoot.firstElementChild.classList.contains('darkreader--inline')).toBe(true);\n        expect(shadowRoot.firstElementChild.nextElementSibling.classList.contains('darkreader--override')).toBe(true);\n        expect(shadowRoot.firstElementChild.nextElementSibling.nextElementSibling.classList.contains('darkreader--invert')).toBe(true);\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should override styles","suites":["SHADOW DOM"],"updatePoint":{"line":37,"column":30},"line":37,"code":"    it('should override styles', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"shadow-dom-wrapper\"></div>',\n        );\n        const shadow = document.querySelector('.shadow-dom-wrapper').attachShadow({mode: 'open'});\n        const style = document.createElement('style');\n        style.classList.add('test-case-style');\n        shadow.appendChild(style);\n        style.sheet.insertRule('h1 { color: gray }');\n        style.sheet.insertRule('strong { color: red }');\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const shadowRoot = document.querySelector('.shadow-dom-wrapper').shadowRoot;\n        const testCase = shadowRoot.querySelector('.test-case-style');\n        expect(testCase.nextElementSibling.classList.contains('darkreader--sync')).toBe(true);\n        expect((testCase.nextElementSibling as HTMLStyleElement).sheet.cssRules.length).toBe(2);\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to DOM changes","suites":["SHADOW DOM"],"updatePoint":{"line":55,"column":35},"line":55,"code":"    it('should react to DOM changes', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"shadow-dom-wrapper\"></div>',\n        );\n        const shadow = document.querySelector('.shadow-dom-wrapper').attachShadow({mode: 'open'});\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        const style = document.createElement('style');\n        style.classList.add('test-case-style');\n        shadow.appendChild(style);\n        style.sheet.insertRule('h1 { color: gray }');\n        style.sheet.insertRule('strong { color: red }');\n\n        await timeout(0);\n        const shadowRoot = document.querySelector('.shadow-dom-wrapper').shadowRoot;\n        const testCase = shadowRoot.querySelector('.test-case-style');\n        expect(shadowRoot.firstElementChild.classList.contains('darkreader--inline')).toBe(true);\n        expect(shadowRoot.firstElementChild.nextElementSibling.classList.contains('darkreader--override')).toBe(true);\n        expect(testCase.nextElementSibling.classList.contains('darkreader--sync')).toBe(true);\n        expect((testCase.nextElementSibling as HTMLStyleElement).sheet.cssRules.length).toBe(2);\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should override inline styles","suites":["SHADOW DOM"],"updatePoint":{"line":77,"column":37},"line":77,"code":"    it('should override inline styles', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"shadow-dom-wrapper\"></div>',\n        );\n        const shadow = document.querySelector('.shadow-dom-wrapper').attachShadow({mode: 'open'});\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        const standardElement = document.createElement('p');\n        standardElement.style.color = 'red';\n        shadow.appendChild(standardElement);\n\n        await timeout(0);\n        const shadowRoot = document.querySelector('.shadow-dom-wrapper').shadowRoot;\n        expect(getComputedStyle(shadowRoot.querySelector('p')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle defined custom elements","suites":["SHADOW DOM"],"updatePoint":{"line":93,"column":45},"line":93,"code":"    it('should handle defined custom elements', async () => {\n        container.innerHTML = multiline(\n            '<custom-element>',\n            '</custom-element>',\n        );\n        class CustomElement extends HTMLElement {\n            constructor() {\n                super();\n                const shadowRoot = this.attachShadow({mode: 'open'});\n                const style = document.createElement('style');\n                style.textContent = 'p { color: pink }';\n                const paragraph = document.createElement('p');\n                paragraph.textContent = 'Some text content that should be pink.';\n\n                shadowRoot.append(style);\n                shadowRoot.append(paragraph);\n            }\n        }\n        customElements.define('custom-element', CustomElement);\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        const shadowRoot = document.querySelector('custom-element').shadowRoot;\n        expect(getComputedStyle(shadowRoot.querySelector('p')).color).toBe('rgb(255, 198, 208)');\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to defined custom elements","suites":["SHADOW DOM"],"updatePoint":{"line":118,"column":47},"line":118,"code":"    it('should react to defined custom elements', async () => {\n        container.innerHTML = multiline(\n            '<delayed-custom-element>',\n            '</delayed-custom-element>',\n        );\n        class DelayedCustomElement extends HTMLElement {\n            constructor() {\n                super();\n                const shadowRoot = this.attachShadow({mode: 'open'});\n                const style = document.createElement('style');\n                style.textContent = 'p { color: pink }';\n                const paragraph = document.createElement('p');\n                paragraph.textContent = 'Some text content that should be pink.';\n\n                shadowRoot.append(style);\n                shadowRoot.append(paragraph);\n            }\n        }\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        customElements.define('delayed-custom-element', DelayedCustomElement);\n        await timeout(0);\n        const shadowRoot = document.querySelector('delayed-custom-element').shadowRoot;\n        expect(getComputedStyle(shadowRoot.querySelector('p')).color).toBe('rgb(255, 198, 208)');\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should override styles","suites":["SHADOW DOM"],"updatePoint":{"line":144,"column":30},"line":144,"code":"    it('should override styles', async () => {\n        // Firefox by default doesn't enable the CSSStyleSheet constructor.\n        if (isFirefox || isSafari) {\n            return;\n        }\n\n        container.innerHTML = multiline(\n            '<div class=\"shadow-dom-wrapper\"></div>',\n        );\n\n        const newRule = new CSSStyleSheet();\n        newRule.insertRule(':host { --red: red }');\n\n        const shadow = document.querySelector('.shadow-dom-wrapper').attachShadow({mode: 'open'});\n        shadow.adoptedStyleSheets = [newRule];\n\n        const style = document.createElement('style');\n        style.classList.add('test-case-style');\n        shadow.appendChild(style);\n        style.sheet.insertRule('h1 { color: var(--red) }');\n\n        const h1 = document.createElement('h1');\n        shadow.appendChild(h1);\n\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const shadowRoot = document.querySelector('.shadow-dom-wrapper').shadowRoot;\n        const testCase = shadowRoot.querySelector('.test-case-style');\n        const darkendH1 = shadowRoot.querySelector('h1');\n        expect(testCase.nextElementSibling.classList.contains('darkreader--sync')).toBe(true);\n        expect((testCase.nextElementSibling as HTMLStyleElement).sheet.cssRules.length).toBe(1);\n        expect(shadowRoot.adoptedStyleSheets.length).toBe(2);\n        expect(getComputedStyle(darkendH1).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/shadow-dom.tests.ts","skipped":false,"dir":"tests"},{"name":"should fill CSSStyleSheet with overriden rules","suites":["STYLE ELEMENTS"],"updatePoint":{"line":25,"column":54},"line":25,"code":"    it('should fill CSSStyleSheet with overriden rules', () => {\n        const style = document.createElement('style');\n        style.textContent = 'body { background-color: white; } h1 { color: black; }';\n        container.append(style);\n\n        const modifier = createStyleSheetModifier();\n        const overrideStyle = document.createElement('style');\n        container.append(overrideStyle);\n        const override = overrideStyle.sheet;\n        modifier.modifySheet({\n            theme,\n            sourceCSSRules: style.sheet.cssRules,\n            ignoreImageAnalysis: [],\n            force: false,\n            prepareSheet: () => override,\n            isAsyncCancelled: () => false,\n        });\n\n        expect(override.cssRules.length).toBe(2);\n        expect((override.cssRules[0] as CSSStyleRule).selectorText).toBe('body');\n        expect((override.cssRules[0] as CSSStyleRule).style.getPropertyValue('background-color')).toBe('rgb(0, 0, 0)');\n        expect((override.cssRules[1] as CSSStyleRule).selectorText).toBe('h1');\n        expect((override.cssRules[1] as CSSStyleRule).style.getPropertyValue('color')).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override User Agent style","suites":["STYLE ELEMENTS"],"updatePoint":{"line":50,"column":40},"line":50,"code":"    it('should override User Agent style', async () => {\n        container.innerHTML = multiline(\n            '<span>Text</span>',\n            '<a href=\"#\">Link</a>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('span')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('a')).color).toBe('rgb(51, 145, 255)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override static style","suites":["STYLE ELEMENTS"],"updatePoint":{"line":62,"column":36},"line":62,"code":"    it('should override static style', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Style <strong>override</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override style with @import","suites":["STYLE ELEMENTS"],"updatePoint":{"line":77,"column":42},"line":77,"code":"    it('should override style with @import', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            `    @import \"data:text/css;utf8,${encodeURIComponent('h1 { background: gray; }')}\";`,\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Style <strong>with @import</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(50);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override style with @import\"...\"","suites":["STYLE ELEMENTS"],"updatePoint":{"line":94,"column":47},"line":94,"code":"    it('should override style with @import\"...\"', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            `    @import\"data:text/css;utf8,${encodeURIComponent('h1 { background: gray; }')}\";`,\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Style <strong>with @import\"...\"</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(50);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should restore override","suites":["STYLE ELEMENTS"],"updatePoint":{"line":111,"column":31},"line":111,"code":"    it('should restore override', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { color: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Style <strong>override</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(141, 141, 141)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n\n        const style = document.querySelector('.testcase-style');\n        style.nextSibling.remove();\n        await timeout(0);\n        expect((style.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync')).toBe(true);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(141, 141, 141)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should move override","suites":["STYLE ELEMENTS"],"updatePoint":{"line":131,"column":28},"line":131,"code":"    it('should move override', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Moving styles</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n\n        const style = document.querySelector('.testcase-style');\n        container.append(style);\n        await timeout(0);\n        expect((style.nextSibling as HTMLStyleElement).classList.contains('darkreader--sync')).toBe(true);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should remove override","suites":["STYLE ELEMENTS"],"updatePoint":{"line":151,"column":30},"line":151,"code":"    it('should remove override', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 { background: gray; }',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Some test foor...... <strong>Oh uhm removing styles :(</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const style = document.querySelector('.testcase-style');\n        const sibling = style.nextSibling;\n        style.remove();\n        await timeout(0);\n        expect(sibling.isConnected).toBe(false);\n        expect(document.querySelector('.darkreader--sync')).toBe(null);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to updated style","suites":["STYLE ELEMENTS"],"updatePoint":{"line":170,"column":37},"line":170,"code":"    it('should react to updated style', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\"></style>',\n            '<h1>Some test foor...... <strong>Oh uhm a pink background</strong></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const style: HTMLStyleElement = document.querySelector('.testcase-style');\n        style.sheet.insertRule('h1 { color: gray }');\n        style.sheet.insertRule('strong { color: red }');\n        style.sheet.insertRule('body { background-color: pink }');\n        await timeout(0);\n        expect((style.nextSibling as HTMLStyleElement).sheet.cssRules[0].cssText).toBe('body { background-color: rgb(50, 0, 9); }');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(141, 141, 141)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(document.body).backgroundColor).toBe('rgb(50, 0, 9)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should react on style text change","suites":["STYLE ELEMENTS"],"updatePoint":{"line":188,"column":41},"line":188,"code":"    it('should react on style text change', async () => {\n        container.innerHTML = multiline(\n            '<style class=\"testcase-style\">',\n            '    h1 strong { color: red; }',\n            '</style>',\n            '<h1>Style <strong>text change</strong></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n\n        document.querySelector('.testcase-style').textContent = 'h1 strong { color: green; }';\n        await timeout(0);\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should react to a new style","suites":["STYLE ELEMENTS"],"updatePoint":{"line":203,"column":35},"line":203,"code":"    it('should react to a new style', async () => {\n        container.innerHTML = multiline(\n            '<h1>Some test foor...... <strong>Oh uhm what?</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const style: HTMLStyleElement = document.createElement('style');\n        style.classList.add('testcase-style');\n        container.append(style);\n        style.sheet.insertRule('h1 { color: pink }');\n        style.sheet.insertRule('strong { color: orange }');\n\n        await timeout(0);\n        const newStyle: HTMLStyleElement = document.querySelector('.testcase-style');\n        const nextSibling = newStyle.nextSibling as HTMLStyleElement;\n        expect(nextSibling.sheet.cssRules.length).toBe(2);\n        expect(nextSibling.classList.contains('darkreader--sync')).toBe(true);\n        expect(getComputedStyle(document.querySelector('h1')).color).toBe('rgb(255, 198, 208)');\n        expect(getComputedStyle(document.querySelector('h1 strong')).color).toBe('rgb(255, 174, 26)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should restore override after container move","suites":["STYLE ELEMENTS"],"updatePoint":{"line":224,"column":52},"line":224,"code":"    it('should restore override after container move', async () => {\n        container.innerHTML = multiline(\n            '<div class=\"style-container\">',\n            '    <style class=\"testcase-style\">',\n            '        h1 { background: gray; }',\n            '        h1 { color: green; }',\n            '    </style>',\n            '</div>',\n            '<h1>Moving container</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n\n        const styleContainer = document.querySelector('.style-container');\n        const style = styleContainer.querySelector('.testcase-style');\n        const override = style.nextElementSibling as HTMLStyleElement;\n        container.append(styleContainer);\n        await timeout(0);\n        expect(style.nextElementSibling).toBe(override);\n        expect(override.sheet.cssRules.length).toBe(2);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/style-override.tests.ts","skipped":false,"dir":"tests"},{"name":"should override style with variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":44,"column":44},"line":44,"code":"    it('should override style with variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --bg: gray;',\n            '        --text: red;',\n            '    }',\n            '    h1 { background: var(--bg); }',\n            '    h1 strong { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should override style with variables(that contain spaces)","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":63,"column":65},"line":63,"code":"    it('should override style with variables(that contain spaces)', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --bg: gray;',\n            '        --text: red;',\n            '    }',\n            '    h1 { background: var( --bg ); }',\n            '    h1 strong { color: var( --text ); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should override style with variables (reverse order)","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":82,"column":60},"line":82,"code":"    it('should override style with variables (reverse order)', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: var(--bg); }',\n            '    h1 strong { color: var(--text); }',\n            '</style>',\n            '<style>',\n            '    :root {',\n            '        --bg: gray;',\n            '        --text: green;',\n            '    }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(102, 102, 102)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should skip undefined variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":103,"column":39},"line":103,"code":"    it('should skip undefined variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { background: var(--bg); }',\n            '    h1 strong { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1 strong')).color).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should use fallback variable value","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":118,"column":42},"line":118,"code":"    it('should use fallback variable value', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { color: var(--text, red); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not use fallback variable value","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":129,"column":46},"line":129,"code":"    it('should not use fallback variable value', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --text: green;',\n            '    }',\n            '    h1 { color: var(--text, red); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables referencing other variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":143,"column":59},"line":143,"code":"    it('should handle variables referencing other variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --alert: red;',\n            '        --text: var(--alert);',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables referencing other variables (reverse order)","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":158,"column":75},"line":158,"code":"    it('should handle variables referencing other variables (reverse order)', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --text: var(--alert);',\n            '        --alert: red;',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle shorthand background with deep color refs","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":173,"column":63},"line":173,"code":"    it('should handle shorthand background with deep color refs', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --red: red;',\n            '        --bg: var(--red);',\n            '    }',\n            '    h1 {',\n            '        background: var(--bg);',\n            '    }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle background with deep color refs (backwards)","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":190,"column":65},"line":190,"code":"    it('should handle background with deep color refs (backwards)', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background: var(--bg);',\n            '    }',\n            '    :root {',\n            '        --red: red;',\n            '        --bg: var(--red);',\n            '    }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle multi-type vars with deep color refs","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":207,"column":58},"line":207,"code":"    it('should handle multi-type vars with deep color refs', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background: var(--bg);',\n            '        color: var(--red);',\n            '    }',\n            '    :root {',\n            '        --red: red;',\n            '        --bg: var(--red);',\n            '    }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong></h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables having multiple types","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":226,"column":53},"line":226,"code":"    it('should handle variables having multiple types', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --dark: red;',\n            '        --light: green;',\n            '    }',\n            '    .dark {',\n            '        background-color: var(--dark);',\n            '        color: var(--light);',\n            '    }',\n            '    .light {',\n            '        background: var(--light);',\n            '        color: var(--dark);',\n            '    }',\n            '</style>',\n            '<h1 class=\"dark\">Dark background light text</h1>',\n            '<h1 class=\"light\">Light background dark text</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('.dark')).backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.dark')).color).toBe('rgb(140, 255, 140)');\n        expect(getComputedStyle(container.querySelector('.light')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('.light')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should use fallback when nested variables are missing","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":274,"column":61},"line":274,"code":"    it('should use fallback when nested variables are missing', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { color: var(--text, var(--alert, green)); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not freeze on cyclic references","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":285,"column":46},"line":285,"code":"    it('should not freeze on cyclic references', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --text: var(--text);',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not freeze on nested cyclic references","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":299,"column":53},"line":299,"code":"    it('should not freeze on nested cyclic references', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --alert: var(--text);',\n            '        --text: var(--alert);',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should react on variable change","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":314,"column":39},"line":314,"code":"    it('should react on variable change', async () => {\n        container.innerHTML = multiline(\n            '<style id=\"variables\">',\n            '    :root {',\n            '        --text: red;',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n\n        const styleElement = document.getElementById('variables') as HTMLStyleElement;\n        styleElement.textContent = ':root { --text: green; }';\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should use <html> element variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":335,"column":43},"line":335,"code":"    it('should use <html> element variables', async () => {\n        document.documentElement.setAttribute('style', '--text: red;');\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>CSS <strong>variables</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n\n        document.documentElement.setAttribute('style', '--text: green;');\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should consider variable selector","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":351,"column":41},"line":351,"code":"    it('should consider variable selector', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    .red {',\n            '        --text: red;',\n            '    }',\n            '    .green {',\n            '        --text: green;',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1 class=\"red\">Red CSS variable</h1>',\n            '<h1 class=\"green\">Green CSS variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('.red')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('.green')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle internal conversion of hex to RGB","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":370,"column":55},"line":370,"code":"    it('should handle internal conversion of hex to RGB', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '   :root {',\n            '       --bg: #fff;',\n            '       --text: #000;',\n            '   }',\n            '</style>',\n            '<style>',\n            '   h1 {',\n            '       background: var(--bg);',\n            '       color: var(--text);',\n            '   }',\n            '</style>',\n            '<h1>Dark <strong>Theme</strong>!</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables inside color values (constructed colors)","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":391,"column":72},"line":391,"code":"    it('should handle variables inside color values (constructed colors)', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --bg: 255, 255, 255;',\n            '        --text: 0, 0, 0;',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 {',\n            '        background: rgb(var(--bg));',\n            '        color: rgb(var(--text));',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should use fallback when variable inside a color not found","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":412,"column":66},"line":412,"code":"    it('should use fallback when variable inside a color not found', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background: rgb(var(--bg, 255, 0, 0));',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables in constructed colors that refer to other vars","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":425,"column":78},"line":425,"code":"    it('should handle variables in constructed colors that refer to other vars', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --v255: 255;',\n            '        --red: var(--v255), 0, 0;',\n            '        --bg: var(--unknown, var(--red));',\n            '        --text: var(--red);',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 {',\n            '        background: rgb(var(--bg));',\n            '        color: rgb(var(--text));',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables that refer to constructed colors","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":448,"column":64},"line":448,"code":"    it('should handle variables that refer to constructed colors', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --red: 255, 0, 0;',\n            '        --blue: 0, 0, 255;',\n            '        --rgb-blue: rgb(var(--blue));',\n            '        --bg: rgb(var(--red));',\n            '        --text: var(--rgb-blue);',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 {',\n            '        background: var(--bg);',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(51, 125, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables that refer to constructed colors asynchronously","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":472,"column":79},"line":472,"code":"    it('should handle variables that refer to constructed colors asynchronously', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --red: 255, 0, 0;',\n            '        --bg: rgb(var(--red));',\n            '    }',\n            '    h1 {',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            ':root {',\n            '    --blue: 0, 0, 255;',\n            '    --rgb-blue: rgb(var(--blue));',\n            '    --text: var(--rgb-blue);',\n            '}',\n            'h1 {',\n            '    background: var(--bg);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(51, 125, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables that are both contructed and usual colors","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":503,"column":73},"line":503,"code":"    it('should handle variables that are both contructed and usual colors', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --red: 255, 0, 0;',\n            '        --bg: green;',\n            '    }',\n            '    h1 {',\n            '        --bg: rgb(var(--red));',\n            '        background: var(--bg)',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle cyclic references in constructed colors","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":521,"column":61},"line":521,"code":"    it('should handle cyclic references in constructed colors', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --bg: var(--text);',\n            '        --text: var(--bg);',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 {',\n            '        background: rgb(var(--bg));',\n            '        color: rgb(var(--text));',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables inside border color values","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":542,"column":58},"line":542,"code":"    it('should handle variables inside border color values', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --red: 255, 0, 0;',\n            '    }',\n            '</style>',\n            '<style>',\n            '    h1 {',\n            '        border: 1px solid rgb(var(--red));',\n            '    }',\n            '</style>',\n            '<h1>Colors with variables inside</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n        if (isFirefox) {\n            expect(elementStyle.borderTopColor).toBe('rgb(179, 0, 0)');\n            expect(elementStyle.borderRightColor).toBe('rgb(179, 0, 0)');\n            expect(elementStyle.borderBottomColor).toBe('rgb(179, 0, 0)');\n            expect(elementStyle.borderLeftColor).toBe('rgb(179, 0, 0)');\n        } else {\n            expect(elementStyle.borderColor).toBe('rgb(179, 0, 0)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle media variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":568,"column":37},"line":568,"code":"    it('should handle media variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    @media screen and (min-width: 2px) {',\n            '        .red {',\n            '            --text: red;',\n            '        }',\n            '        .orange {',\n            '            --text: orange',\n            '        }',\n            '    }',\n            '    @media screen and (min-width: 2000000px) {',\n            '        .green {',\n            '            --text: green;',\n            '        }',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1 class=\"red\">Red CSS variable</h1>',\n            '<h1 class=\"green\">Green CSS variable</h1>',\n            '<h1 class=\"orange\">Orange CSS variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.red')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('.green')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('.orange')).color).toBe('rgb(255, 174, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle nested variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":597,"column":38},"line":597,"code":"    it('should handle nested variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    @media screen and (min-width: 2px) {',\n            '        @media screen and (min-width: 3px) {',\n            '            .red {',\n            '                --text: red;',\n            '            }',\n            '        }',\n            '    }',\n            '    @media screen and (min-width: 2px) {',\n            '        @media screen and (min-width: 2000000px) {',\n            '            .green {',\n            '                --text: green;',\n            '            }',\n            '        }',\n            '    }',\n            '    @media screen and (min-width: 2000000px) {',\n            '        @media screen and (min-width: 2px) {',\n            '            .orange {',\n            '                --text: orange;',\n            '            }',\n            '        }',\n            '    }',\n            '    h1 {',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1 class=\"red\">Red CSS variable</h1>',\n            '<h1 class=\"green\">Green CSS variable</h1>',\n            '<h1 class=\"orange\">Orange CSS variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container).backgroundColor).toBe('rgb(0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.red')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('.green')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('.orange')).color).toBe('rgb(255, 255, 255)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle media with the same selectors","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":636,"column":51},"line":636,"code":"    it('should handle media with the same selectors', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    @media screen and (min-width: 2px) {',\n            '        h1 {',\n            '            --text: green;',\n            '        }',\n            '    }',\n            '    @media screen and (max-width: 2px) {',\n            '        h1 {',\n            '            --text: red;',\n            '        }',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>Media with same selectors</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should preserve media after change","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":657,"column":42},"line":657,"code":"    it('should preserve media after change', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    @media screen and (min-width: 2px) {',\n            '        /* This media should be used */',\n            '        h1 {',\n            '            --text: green;',\n            '        }',\n            '    }',\n            '    @media screen and (max-width: 2px) {',\n            '        /* This media should not be used */',\n            '        h1 {',\n            '            --text: red;',\n            '        }',\n            '    }',\n            '    h1 { color: var(--text); }',\n            '</style>',\n            '<h1>Media after change</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle same selector with different variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":683,"column":60},"line":683,"code":"    it('should handle same selector with different variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    @media screen and (min-width: 2px) {',\n            '        h1 {',\n            '            --text: green;',\n            '        }',\n            '        h1 {',\n            '            --bg: red;',\n            '        }',\n            '    }',\n            '    h1 { color: var(--text); background-color: var(--bg); }',\n            '</style>',\n            '<h1>Media with same selectors</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should properly modify variables in light mode","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":703,"column":54},"line":703,"code":"    it('should properly modify variables in light mode', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --bg: white;',\n            '        --text: black;',\n            '    }',\n            '    h1 {',\n            '        background: var(--bg);',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1>Light scheme</h1>',\n        );\n        const lightTheme = {...theme, mode: 0, lightSchemeBackgroundColor: '#dddddd', lightSchemeTextColor: '#222222'};\n        createOrUpdateDynamicTheme(lightTheme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(221, 221, 221)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(34, 34, 34)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables inside values","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":723,"column":45},"line":723,"code":"    it('should handle variables inside values', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --border-color: #ff0000;',\n            '        --text: green;',\n            '    }',\n            '    h1 {',\n            '        border-bottom: 2px solid var(--border-color);',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1>Border with variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).borderBottomColor).toBe('rgb(179, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables that have variables inside","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":742,"column":58},"line":742,"code":"    it('should handle variables that have variables inside', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --dark-red: #ff0000;',\n            '        --border: 2px solid var(--dark-red);',\n            '        --text: green;',\n            '    }',\n            '    h1 {',\n            '        border: var(--border);',\n            '        color: var(--text);',\n            '    }',\n            '</style>',\n            '<h1>Border with variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).borderTopColor).toBe('rgb(179, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).borderBottomColor).toBe('rgb(179, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).borderLeftColor).toBe('rgb(179, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).borderRightColor).toBe('rgb(179, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle border color variables","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":765,"column":44},"line":765,"code":"    it('should handle border color variables', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --border-color: green;',\n            '    }',\n            '    h1 {',\n            '        border: 1px solid;',\n            '        border-color: var(--border-color);',\n            '    }',\n            '</style>',\n            '<h1>Border color with variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n        if (isFirefox) {\n            expect(elementStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(elementStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables with gradients","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":790,"column":46},"line":790,"code":"    it('should handle variables with gradients', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --text: red;',\n            '        --gradient: linear-gradient(red, white);',\n            '        --bg: green;',\n            '    }',\n            '    h1 {',\n            '        color: var(--text);',\n            '        background-color: var(--bg);',\n            '        background-image: var(--gradient);',\n            '    }',\n            '    h2 {',\n            '        background: var(--gradient);',\n            '    }',\n            '</style>',\n            '<h1>Weow Gradients</h1>',\n            '<h2>Gradient 2</h2>'\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).backgroundImage).toBe('linear-gradient(rgb(204, 0, 0), rgb(0, 0, 0))');\n        expect(getComputedStyle(container.querySelector('h2')).backgroundImage).toBe('linear-gradient(rgb(204, 0, 0), rgb(0, 0, 0))');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables with background images","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":817,"column":54},"line":817,"code":"    it('should handle variables with background images', async () => {\n        const darkIcon = multiline(\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 8 8\" width=\"8\" height=\"8\">',\n            '    <circle fill=\"black\" cx=\"4\" cy=\"4\" r=\"3\" />',\n            '</svg>',\n        );\n        const redCross = multiline(\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 8 8\" width=\"8\" height=\"8\">',\n            '    <path fill=\"red\" d=\"M3,1 h2 v2 h2 v2 h-2 v2 h-2 v-2 h-2 v-2 h2 z\" />',\n            '</svg>',\n        );\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            `        --icon: url(\"data:image/svg+xml;base64,${btoa(darkIcon)}\");`,\n            `        --red-cross: url(\"data:image/svg+xml;base64,${btoa(redCross)}\");`,\n            '        --bg: green;',\n            '    }',\n            '    .icon1 {',\n            '        background-color: var(--bg);',\n            '        background-image: var(--icon);',\n            '        background-repeat: no-repeat;',\n            '        background-size: 100%;',\n            '        display: inline-block;',\n            '        height: 1rem;',\n            '        width: 1rem;',\n            '    }',\n            '    .icon2 {',\n            '        background: no-repeat center/100% var(--icon);',\n            '        display: inline-block;',\n            '        height: 1rem;',\n            '        width: 1rem;',\n            '    }',\n            '    .icon3 {',\n            '        background: no-repeat center/100% var(--red-cross), no-repeat center/100% var(--icon);',\n            '        display: inline-block;',\n            '        height: 1rem;',\n            '        width: 1rem;',\n            '    }',\n            '</style>',\n            '<h1>',\n            '    <i class=\"icon1\"></i>',\n            '    <i class=\"icon2\"></i>',\n            '    <i class=\"icon3\"></i>',\n            '    Icons',\n            '</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        expect(getComputedStyle(container.querySelector('.icon1')).backgroundImage).toMatch(/^url\\(\"data:image\\/svg\\+xml;base64,.*\"\\)$/);\n        expect(getComputedStyle(container.querySelector('.icon2')).backgroundImage).toMatch(/^url\\(\"data:image\\/svg\\+xml;base64,.*\"\\)$/);\n        expect(getComputedStyle(container.querySelector('.icon3')).backgroundImage).toMatch(/^url\\(\"data:image\\/svg\\+xml;base64,.*\"\\), url\\(\"data:image\\/svg\\+xml;base64,.*\"\\)$/);\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variables with gradients and images","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":871,"column":57},"line":871,"code":"    it('should handle variables with gradients and images', async () => {\n        const darkIcon = multiline(\n            '<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 8 8\" width=\"8\" height=\"8\">',\n            '    <circle fill=\"black\" cx=\"4\" cy=\"4\" r=\"3\" />',\n            '</svg>',\n        );\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            `        --icon: url(\"data:image/svg+xml;base64,${btoa(darkIcon)}\");`,\n            '        --gradient: linear-gradient(red, white);',\n            '    }',\n            '    .icon {',\n            '        background: no-repeat center/100% var(--icon), var(--gradient);',\n            '        display: inline-block;',\n            '        height: 1rem;',\n            '        width: 1rem;',\n            '    }',\n            '</style>',\n            '<h1><i class=\"icon\"></i>Mixed background</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        await waitForEvent('__darkreader__test__asyncQueueComplete');\n        expect(getComputedStyle(container.querySelector('.icon')).backgroundImage).toMatch(/^url\\(\"data:image\\/svg\\+xml;base64,.*\"\\), linear-gradient\\(rgb\\(204, 0, 0\\), rgb\\(0, 0, 0\\)\\)$/);\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle asynchronous variable type resolution","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":897,"column":59},"line":897,"code":"    it('should handle asynchronous variable type resolution', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --color1: red;',\n            '        --color2: green;',\n            '    }',\n            '</style>',\n            '<h1>Asynchronous variables</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            'h1 {',\n            '    background: var(--color2);',\n            '    color: var(--color1);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle async resolution of multiple variable types","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":924,"column":65},"line":924,"code":"    it('should handle async resolution of multiple variable types', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --color: green;',\n            '    }',\n            '</style>',\n            '<h1>Asynchronous variables with multiple types</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            'h1 {',\n            '    background: var(--color);',\n            '    border: 1px solid var(--color);',\n            '    color: var(--color);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        const updatedStyle = getComputedStyle(container.querySelector('h1'));\n        expect(updatedStyle.backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(updatedStyle.color).toBe('rgb(140, 255, 140)');\n        if (isFirefox) {\n            expect(updatedStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(updatedStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variable type resolution when style changed","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":960,"column":65},"line":960,"code":"    it('should handle variable type resolution when style changed', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --color1: yellow;',\n            '        --color2: blue;',\n            '    }',\n            '</style>',\n            '<h1>Asynchronous variables</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n\n        const styleEl = container.querySelector('style');\n        styleEl.textContent = multiline(\n            ':root {',\n            '    --color1: red;',\n            '    --color2: green;',\n            '    --color3: blue;',\n            '}',\n        );\n        await timeout(0);\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            'h1 {',\n            '    background: var(--color2);',\n            '    color: var(--color1);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle variable type change","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":997,"column":42},"line":997,"code":"    it('should handle variable type change', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --color: green;',\n            '    }',\n            '    h1 {',\n            '        background: var(--color);',\n            '    }',\n            '</style>',\n            '<h1>Asynchronous variables</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(255, 255, 255)');\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            'h1 {',\n            '    color: var(--color);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('h1')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should rebuild dependant variable rule when type becomes known","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1025,"column":70},"line":1025,"code":"    it('should rebuild dependant variable rule when type becomes known', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background: var(--color);',\n            '    }',\n            '</style>',\n            '<h1>Asynchronous variables</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            ':root {',\n            '    --color: green;',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(50);\n        expect(getComputedStyle(container.querySelector('h1')).backgroundColor).toBe('rgb(0, 102, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not affect other declarations when variable type resolved","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1048,"column":72},"line":1048,"code":"    it('should not affect other declarations when variable type resolved', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    :root {',\n            '        --color1: red;',\n            '        --color2: green;',\n            '    }',\n            '</style>',\n            '<h1 class=\"color1\">Variables with color 1</h1>',\n            '<h1 class=\"color2\">Variables with color 2</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        expect(getComputedStyle(container.querySelector('.color1')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.color1')).color).toBe('rgb(255, 255, 255)');\n        expect(getComputedStyle(container.querySelector('.color2')).backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.color2')).color).toBe('rgb(255, 255, 255)');\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            '.color1 {',\n            '    background: var(--color1);',\n            '    color: var(--color1);',\n            '}',\n            '.color2 {',\n            '    background: var(--color2);',\n            '    color: var(--color2);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        expect(getComputedStyle(container.querySelector('.color1')).backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(getComputedStyle(container.querySelector('.color1')).color).toBe('rgb(255, 26, 26)');\n        expect(getComputedStyle(container.querySelector('.color2')).backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(getComputedStyle(container.querySelector('.color2')).color).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not affect other declarations when variable type resolved","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1084,"column":72},"line":1084,"code":"    it('should not affect other declarations when variable type resolved', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        --color-bg: red;',\n            '        border: green;',\n            '    }',\n            '    h1 {',\n            '        --color-text: green;',\n            '    }',\n            '</style>',\n            '<h1>Variables along with other declarations</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n        expect(elementStyle.backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(elementStyle.color).toBe('rgb(255, 255, 255)');\n        if (isFirefox) {\n            expect(elementStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(elementStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            'h1 {',\n            '    background-color: var(--color-bg);',\n            '    color: var(--color-text);',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(0);\n        const updatedStyle = getComputedStyle(container.querySelector('h1'));\n        expect(updatedStyle.backgroundColor).toBe('rgb(204, 0, 0)');\n        expect(updatedStyle.color).toBe('rgb(140, 255, 140)');\n        if (isFirefox) {\n            expect(updatedStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(updatedStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should not affect other declarations when dependency variable type resolved","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1132,"column":83},"line":1132,"code":"    it('should not affect other declarations when dependency variable type resolved', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background: var(--color);',\n            '        border: green;',\n            '    }',\n            '    h1 {',\n            '        color: red;',\n            '    }',\n            '</style>',\n            '<h1>Dependency variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n        expect(elementStyle.backgroundColor).toBe('rgba(0, 0, 0, 0)');\n        expect(elementStyle.color).toBe('rgb(255, 26, 26)');\n        if (isFirefox) {\n            expect(elementStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(elementStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(elementStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n\n        const anotherStyle = document.createElement('style');\n        anotherStyle.textContent = multiline(\n            ':root {',\n            '    --color: green;',\n            '}',\n        );\n        container.append(anotherStyle);\n        await timeout(50);\n        const updatedStyle = getComputedStyle(container.querySelector('h1'));\n        expect(updatedStyle.backgroundColor).toBe('rgb(0, 102, 0)');\n        expect(updatedStyle.color).toBe('rgb(255, 26, 26)');\n        if (isFirefox) {\n            expect(updatedStyle.borderTopColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderRightColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderBottomColor).toBe('rgb(0, 217, 0)');\n            expect(updatedStyle.borderLeftColor).toBe('rgb(0, 217, 0)');\n        } else {\n            expect(updatedStyle.borderColor).toBe('rgb(0, 217, 0)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should add variables to root after the variable type is discovered","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1179,"column":74},"line":1179,"code":"    it('should add variables to root after the variable type is discovered', async () => {\n        document.documentElement.setAttribute('style', '--text: red;');\n        container.innerHTML = multiline(\n            '<style class=\"testcase-sheet\">',\n            '</style>',\n            '<h1>Dependency variable</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n        const sheet = (document.querySelector('.testcase-sheet') as HTMLStyleElement).sheet;\n        sheet.insertRule('h1 { color: var(--text);');\n\n        await timeout(0);\n        expect(getComputedStyle(document.querySelector('h1')).color).toBe('rgb(255, 26, 26)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify the caret-color property","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1194,"column":46},"line":1194,"code":"    it('should modify the caret-color property', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    * {',\n            '        --caret-color: green;',\n            '    }',\n            '    h1 {',\n            '        caret-color: var(--caret-color);',\n            '    }',\n            '</style>',\n            '<h1>Caret Color</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(0);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n\n        expect(elementStyle.caretColor).toBe('rgb(140, 255, 140)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify the box-shadow actual color values in a variable","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1214,"column":70},"line":1214,"code":"    it('should modify the box-shadow actual color values in a variable', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        --offset: 8px;',\n            '    }',\n            '    h1 {',\n            '        box-shadow: calc(var(--offset)*-1 - 1px) 0 0 0 #fff',\n            '    }',\n            '</style>',\n            '<h1>COmplicated shit :(</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(0);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n\n        expect(elementStyle.boxShadow).toBe('rgb(0, 0, 0) -9px 0px 0px 0px');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"shouldn't modify the raw value of box-shadow when their is no color","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1234,"column":75},"line":1234,"code":"    it(`shouldn't modify the raw value of box-shadow when their is no color`, async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        --color-border-muted: green;',\n            '    }',\n            '    h1 {',\n            '        box-shadow: inset 0 -1px 0 var(--color-border-muted)',\n            '    }',\n            '</style>',\n            '<h1>COmplicated shit :(</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(0);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n\n        expect(elementStyle.boxShadow).toBe('rgb(0, 102, 0) 0px -1px 0px 0px inset');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should handle raw values within variable declarations and use proper replacement","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1254,"column":88},"line":1254,"code":"    it('should handle raw values within variable declarations and use proper replacement', async () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        border: 1px solid rgba(var(--color,240,240,240),1);',\n            '    }',\n            '    :root {',\n            '        --color: 123,123,123 !important;',\n            '    }',\n            '    div {',\n            '        --color: 0,0,0 !important;',\n            '    }',\n            '</style>',\n            '<h1>Raw values are spooky</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        await timeout(0);\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n\n        if (isFirefox) {\n            expect(elementStyle.borderTopColor).toBe('rgb(91, 91, 91)');\n            expect(elementStyle.borderRightColor).toBe('rgb(91, 91, 91)');\n            expect(elementStyle.borderBottomColor).toBe('rgb(91, 91, 91)');\n            expect(elementStyle.borderLeftColor).toBe('rgb(91, 91, 91)');\n        } else {\n            expect(elementStyle.borderColor).toBe('rgb(91, 91, 91)');\n        }\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"should modify inline variable","suites":["CSS VARIABLES OVERRIDE"],"updatePoint":{"line":1284,"column":37},"line":1284,"code":"    it('should modify inline variable', () => {\n        container.innerHTML = multiline(\n            '<style>',\n            '    h1 {',\n            '        background-color: var(--inline-var);',\n            '    }',\n            '</style>',\n            '<h1 style=\"--inline-var: red\">Raw values are spooky</h1>',\n        );\n        createOrUpdateDynamicTheme(theme, null, false);\n\n        const elementStyle = getComputedStyle(container.querySelector('h1'));\n        expect(elementStyle.backgroundColor).toBe('rgb(204, 0, 0)');\n    });","file":"inject/dynamic/variables.tests.ts","skipped":false,"dir":"tests"},{"name":"URL is enabled","suites":[],"updatePoint":{"line":5,"column":18},"line":5,"code":"it('URL is enabled', () => {\n    // Not invert listed\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['google.com'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['mail.google.com'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['mail.google.*'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['mail.google.*/mail'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['google.com/maps'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n\n    // Invert listed only\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['google.com'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['google.*/mail'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://mail.google.com/mail/u/0/',\n        {siteList: ['google.com/maps'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n\n    // Special URLs\n    expect(isURLEnabled(\n        'https://chrome.google.com/webstore',\n        {siteList: ['chrome.google.com'], siteListEnabled: [], applyToListedOnly: false, enableForProtectedPages: true} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://chrome.google.com/webstore',\n        {siteList: ['chrome.google.com'], siteListEnabled: [], applyToListedOnly: true, enableForProtectedPages: true} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://chrome.google.com/webstore',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false, enableForProtectedPages: false} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://chrome.google.com/webstore',\n        {siteList: ['chrome.google.com'], siteListEnabled: [], applyToListedOnly: false, enableForProtectedPages: true} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://microsoftedge.microsoft.com/addons',\n        {siteList: ['microsoftedge.microsoft.com'], siteListEnabled: [], applyToListedOnly: false, enableForProtectedPages: true} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://microsoftedge.microsoft.com/addons',\n        {siteList: ['microsoftedge.microsoft.com'], siteListEnabled: [], applyToListedOnly: true, enableForProtectedPages: true} as UserSettings,\n        {isProtected: true, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://duckduckgo.com',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false, enableForProtectedPages: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://darkreader.org/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://darkreader.org/',\n        {siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://www.google.com/file.pdf',\n        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://www.google.com/file.pdf',\n        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://www.google.com/file.pdf',\n        {enableForPDF: false, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://www.google.com/file.pdf/resource',\n        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://www.google.com/file.pdf/resource',\n        {enableForPDF: true, siteList: ['darkreader.org'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://www.google.com/very/good/hidden/folder/pdf#file.pdf',\n        {enableForPDF: true, siteList: ['https://www.google.com/very/good/hidden/folder/pdf#file.pdf'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://leetcode.com/problems/two-sum/',\n        {enableForPDF: false, siteList: ['leetcode.com/problems/'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://leetcode.com/problemset/all/',\n        {enableForPDF: false, siteList: ['leetcode.com/problems/'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n\n    // Dark theme detection\n    expect(isURLEnabled(\n        'https://github.com/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false, detectDarkTheme: true} as UserSettings,\n        {isProtected: false, isInDarkList: false, isDarkThemeDetected: true},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://github.com/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false, detectDarkTheme: false} as UserSettings,\n        {isProtected: false, isInDarkList: false, isDarkThemeDetected: true},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://github.com/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false, detectDarkTheme: true} as UserSettings,\n        {isProtected: false, isInDarkList: false, isDarkThemeDetected: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://github.com/',\n        {siteList: [], siteListEnabled: ['github.com'], applyToListedOnly: false, detectDarkTheme: true} as UserSettings,\n        {isProtected: false, isInDarkList: false, isDarkThemeDetected: true},\n    )).toBe(true);\n\n    // Test for PDF enabling\n    expect(isPDF(\n        'https://www.google.com/file.pdf'\n    )).toBe(true);\n    expect(isPDF(\n        'https://www.google.com/file.pdf?id=2'\n    )).toBe(true);\n    expect(isPDF(\n        'https://www.google.com/file.pdf/resource'\n    )).toBe(false);\n    expect(isPDF(\n        'https://www.google.com/resource?file=file.pdf'\n    )).toBe(false);\n    expect(isPDF(\n        'https://www.google.com/very/good/hidden/folder/pdf#file.pdf'\n    )).toBe(false);\n    expect(isPDF(\n        'https://fi.wikipedia.org/wiki/Tiedosto:ExtIPA_chart_(2015).pdf?uselang=en'\n    )).toBe(false);\n    expect(isPDF(\n        'https://commons.wikimedia.org/wiki/File:ExtIPA_chart_(2015).pdf'\n    )).toBe(false);\n    expect(isPDF(\n        'https://upload.wikimedia.org/wikipedia/commons/5/56/ExtIPA_chart_(2015).pdf'\n    )).toBe(true);\n\n    // IPV6 Testing\n    expect(isURLEnabled(\n        '[::1]:1337',\n        {siteList: ['google.com'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        '[::1]:8080',\n        {siteList: ['[::1]:8080'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toEqual(false);\n    expect(isURLEnabled(\n        '[::1]:8080',\n        {siteList: ['[::1]:8081'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toEqual(false);\n    expect(isURLEnabled(\n        '[::1]:8080',\n        {siteList: ['[::1]:8081'], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toEqual(true);\n    expect(isURLEnabled(\n        '[::1]:17',\n        {siteList: ['[::1]'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toEqual(false);\n    expect(isURLEnabled(\n        '[2001:4860:4860::8888]',\n        {siteList: ['[2001:4860:4860::8888]'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toEqual(true);\n    expect(isURLEnabled(\n        '[2001:4860:4860::8844]',\n        {siteList: ['[2001:4860:4860::8844]'], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toEqual(true);\n    expect(isURLEnabled(\n        '[2001:4860:4860::8844]',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toEqual(false);\n\n    // Default URL matches everything\n    expect(isURLMatched('http://example.com', '*')).toEqual(true);\n    expect(isURLMatched('https://example.com', '*')).toEqual(true);\n    expect(isURLMatched('file:///c/some_file.pdf', '*')).toEqual(true);\n    expect(isURLMatched('chrome://settings', '*')).toEqual(true);\n    expect(isURLMatched('chrome-extension://settings', '*')).toEqual(true);\n    expect(isURLMatched('edge://settings', '*')).toEqual(true);\n    expect(isURLMatched('brave://settings', '*')).toEqual(true);\n    expect(isURLMatched('kiwi://settings', '*')).toEqual(true);\n    expect(isURLMatched('about:blank', '*')).toEqual(true);\n    expect(isURLMatched('about:preferences', '*')).toEqual(true);\n    // TODO: fix isURLMatched and uncomment me\n    // expect(isURLMatched('[::1]', '*')).toEqual(true);\n    // expect(isURLMatched('[::1]:80', '*')).toEqual(true);\n    expect(isURLMatched('127.0.0.1', '*')).toEqual(true);\n    expect(isURLMatched('127.0.0.1:80', '*')).toEqual(true);\n    expect(isURLMatched('localhost', '*')).toEqual(true);\n\n    // Some URLs can have unescaped [] in query\n    expect(isURLMatched(\n        'google.co.uk/order.php?bar=[foo]',\n        'google.co.uk',\n    )).toEqual(true);\n    expect(isURLMatched(\n        '[2001:4860:4860::8844]/order.php?bar=foo',\n        '[2001:4860:4860::8844]',\n    )).toEqual(true);\n    expect(isURLMatched(\n        '[2001:4860:4860::8844]/order.php?bar=[foo]',\n        '[2001:4860:4860::8844]',\n    )).toEqual(true);\n    expect(isURLMatched(\n        'google.co.uk/order.php?bar=[foo]',\n        '[2001:4860:4860::8844]',\n    )).toEqual(false);\n    expect(isIPV6('file:///C:/[/test.html')).toEqual(false);\n    expect(isIPV6('file:///C:/[/test.html]')).toEqual(false);\n    expect(isIPV6('[2001:4860:4860::8844]')).toEqual(true);\n    expect(isIPV6('cplusplus.com/reference/vector/vector/operator[]/')).toEqual(false);\n\n    // Temporary Dark Sites list fix\n    expect(isURLEnabled(\n        'https://darkreader.org/',\n        {siteList: [], siteListEnabled: ['darkreader.org'], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://darkreader.org/',\n        {siteList: [], siteListEnabled: [], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(false);\n    expect(isURLEnabled(\n        'https://google.com/',\n        {siteList: [], siteListEnabled: ['darkreader.org'], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: false},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://netflix.com',\n        {enableForPDF: true, siteList: [''], siteListEnabled: ['netflix.com'], applyToListedOnly: true} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(true);\n    expect(isURLEnabled(\n        'https://netflix.com',\n        {enableForPDF: true, siteList: [''], siteListEnabled: ['netflix.com'], applyToListedOnly: false} as UserSettings,\n        {isProtected: false, isInDarkList: true},\n    )).toBe(true);\n});","file":"inject/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Get URL host or protocol","suites":[],"updatePoint":{"line":305,"column":28},"line":305,"code":"it('Get URL host or protocol', () => {\n    expect(getURLHostOrProtocol('https://www.google.com')).toBe('www.google.com');\n    expect(getURLHostOrProtocol('https://www.google.com/maps')).toBe('www.google.com');\n    expect(getURLHostOrProtocol('http://localhost:8080')).toBe('localhost:8080');\n    expect(getURLHostOrProtocol('about:blank')).toBe('about:');\n    expect(getURLHostOrProtocol('http://user:pass@www.example.org')).toBe('www.example.org');\n    expect(getURLHostOrProtocol('data:text/html,<html>Hello</html>')).toBe('data:');\n    expect(getURLHostOrProtocol('file:///Users/index.html')).toBe('/Users/index.html');\n});","file":"inject/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Absolute URL","suites":[],"updatePoint":{"line":315,"column":16},"line":315,"code":"it('Absolute URL', () => {\n    expect(getAbsoluteURL('https://www.google.com', 'image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com', '/image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path', '/image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('//www.google.com', '/image.jpg')).toBe(`${location.protocol}//www.google.com/image.jpg`);\n    expect(getAbsoluteURL('https://www.google.com', 'image.jpg?size=128')).toBe('https://www.google.com/image.jpg?size=128');\n    expect(getAbsoluteURL('https://www.google.com/path', 'image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path/', 'image.jpg')).toBe('https://www.google.com/path/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/long/path', '../image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/long/path/', '../image.jpg')).toBe('https://www.google.com/long/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/long/path/', '../another/image.jpg')).toBe('https://www.google.com/long/another/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path/page.html', 'image.jpg')).toBe('https://www.google.com/path/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path/page.html', '/image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com', '//www.google.com/path/image.jpg')).toBe(`${location.protocol}//www.google.com/path/image.jpg`);\n    expect(getAbsoluteURL('https://www.google.com', 'https://www.google.com/path/image.jpg')).toBe('https://www.google.com/path/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com', 'https://www.google.com/path/../another/image.jpg')).toBe('https://www.google.com/another/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path/page.html', 'image.jpg')).toBe('https://www.google.com/path/image.jpg');\n    expect(getAbsoluteURL('https://www.google.com/path/page.html', '../image.jpg')).toBe('https://www.google.com/image.jpg');\n    expect(getAbsoluteURL('path/index.html', 'image.jpg')).toBe(`${location.origin}/path/image.jpg`);\n    expect(getAbsoluteURL('path/index.html', '/image.jpg?size=128')).toBe(`${location.origin}/image.jpg?size=128`);\n});","file":"inject/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Fully qualified domain","suites":[],"updatePoint":{"line":337,"column":26},"line":337,"code":"it('Fully qualified domain', () => {\n    expect(isFullyQualifiedDomain('www.google.com')).toBe(true);\n    expect(isFullyQualifiedDomain('*.google.com')).toBe(false);\n});","file":"inject/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"should respond to SIGINT signals by exiting immediately","suites":["tasks/build-js.js"],"updatePoint":{"line":12,"column":63},"line":12,"code":"    it('should respond to SIGINT signals by exiting immediately', async () => {\n        expect.assertions(3);\n        const tmpDir: string = await mkdtemp(join(tmpdir(), 'darkreader'));\n        const wantToWaitNoMoreThan = 500;\n\n        // Execute build\n        // Give it a chance to reach compilation stage\n        const child = fork(buildModule, ['--debug'], {cwd: tmpDir, silent: true});\n\n        // Wait for \"clean\" step to complete\n        await watchStream(child.stdout).forMatch(/ clean \\(\\d+ms\\)/);\n        // Let \"bundle-js\" to get started\n        await timeout(500);\n\n        // Fire!\n        child.kill('SIGINT');\n\n        // Wait for close\n        await childClosed(child, {timeout: wantToWaitNoMoreThan});\n\n        expect(child.killed).toBeTrue();\n        expect(child.exitCode).toBeGreaterThan(0);\n\n        // By now, \"bundle-js\" step should not have completed normally\n        expect((child.stdout.read() || '')).not.toMatch(/ bundle-js \\(\\d+ms\\)/);\n    });","file":"project/build.tests.ts","skipped":false,"dir":"tests"},{"name":"should build successfully from an unexpected working directory","suites":["tasks/build.js"],"updatePoint":{"line":42,"column":70},"line":42,"code":"    it('should build successfully from an unexpected working directory', async () => {\n        const tmpDir: string = await mkdtemp(join(tmpdir(), 'darkreader'));\n\n        // Fire\n        const child = fork(buildModule, ['--debug', '--release', '--api'], {cwd: tmpDir, silent: true});\n\n        const {stdout} = await childClosed(child);\n        expect(stdout).toInclude('MISSION PASSED');\n        expect(child.exitCode).toBe(0);\n    }, 120000);","file":"project/build.tests.ts","skipped":false,"dir":"tests"},{"name":"should be informed by environment variables: $env","suites":["Karma config tests"],"line":43,"code":"    it.each(testCases)('should be informed by environment variables: $env', async ({env, wantEntries}) => {\n        const ciConfig: LocalConfig = {\n            ci: true, LOG_DISABLE, LOG_ERROR, LOG_WARN, LOG_INFO, LOG_DEBUG, set: () => {\n                return void 0;\n            },\n        };\n\n        // Fire\n        const got: ConfigOptions = configureKarma(ciConfig, env);\n\n        expect(got).toContainEntries(wantEntries);\n    });","file":"project/karma-conf.tests.ts","skipped":false,"dir":"tests"},{"name":"file should parse and resolve correctly: $tsconfig","suites":["TypeScript project config"],"line":25,"code":"    it.each(tsProjects)('file should parse and resolve correctly: $tsconfig', async ({tsconfig}) => {\n        // Parse config from temp dir instead of root dir\n        const cwd = await mkdtemp(join(tmpdir(), 'darkreader'));\n        const project = join(rootDir, tsconfig, 'tsconfig.json');\n\n        // Fire\n        const child = fork(tsc, ['--project', project, '--showConfig'], {silent: true, cwd});\n\n        const {response} = await childClosed(child, {serialization: 'json'});\n        expect(child.exitCode).toBe(ExitStatus.Success);\n        const config = ts.parseJsonConfigFileContent(response, ts.sys, project);\n        expect(config.raw).toMatchSnapshot();\n    }, 100000);","file":"project/tsconf.tests.ts","skipped":false,"dir":"tests"},{"name":"should compile without errors: $tsconfig","suites":["TypeScript project config"],"line":40,"code":"    it.each(tsProjects)('should compile without errors: $tsconfig', async ({tsconfig}) => {\n        // Compile config from temp dir instead of root dir\n        const cwd = await mkdtemp(join(tmpdir(), 'darkreader'));\n        const project = join(rootDir, tsconfig, 'tsconfig.json');\n\n        // Fire\n        const child = fork(tsc, ['--project', project, '--noEmit'], {silent: true, cwd});\n        await childClosed(child);\n        expect(child.exitCode).toBe(ExitStatus.Success);\n    }, 60000);","file":"project/tsconf.tests.ts","skipped":false,"dir":"tests"},{"name":"Dark Sites list","suites":[],"updatePoint":{"line":65,"column":21},"line":65,"code":"test('Dark Sites list', async () => {\n    const file = await readConfig('dark-sites.config');\n\n    // there is no \\r character\n    expect(file.indexOf('\\r')).toEqual(-1);\n\n    const sites = parseArray(file);\n\n    // is not empty\n    expect(sites.length).toBeGreaterThan(0);\n\n    // url patterns should have no protocol\n    expect(sites.every(isURLPatternValid)).toBe(true);\n\n    // sites are sorted alphabetically\n    expect(sites.slice().sort(compareURLPatterns)).toEqual(sites);\n\n    // sites are properly formatted\n    expect(throwIfDifferent(file, formatArray(sites), 'Dark Sites list format error')).not.toThrow();\n});","file":"unit/config/config.tests.ts","skipped":false,"dir":"tests"},{"name":"Dynamic Theme Fixes config","suites":[],"updatePoint":{"line":86,"column":32},"line":86,"code":"test('Dynamic Theme Fixes config', async () => {\n    const file = await readConfig('dynamic-theme-fixes.config');\n\n    // there is no \\r character\n    expect(file.indexOf('\\r')).toEqual(-1);\n\n    const fixes = parseDynamicThemeFixes(file);\n\n    // there is a common fix\n    expect(fixes[0].url[0]).toEqual('*');\n\n    // each fix has valid URL\n    expect(fixes.every(({url}) => url.every(isURLPatternValid))).toBe(true);\n\n    // fixes are sorted alphabetically\n    expect(fixes.map(({url}) => url[0])).toEqual(fixes.map(({url}) => url[0]).sort(compareURLPatterns));\n\n    // selectors should have no comma\n    const commaSelector = /\\,(?![^\\(|\\\"]*(\\)|\\\"))/;\n    expect(fixes.every(({invert, ignoreInlineStyle, ignoreImageAnalysis}) => (invert || []).concat(ignoreInlineStyle || []).concat(ignoreImageAnalysis || []).every((s) => !commaSelector.test(s)))).toBe(true);\n\n    // fixes are properly formatted\n    expect(throwIfDifferent(file, formatDynamicThemeFixes(fixes), 'Dynamic fixes format error')).not.toThrow();\n\n    // should parse empty config\n    expect(parseDynamicThemeFixes('')).toEqual([]);\n\n    // should skip unsupported commands\n    expect(parseDynamicThemeFixes([\n        'inbox.google.com',\n        'mail.google.com',\n        'INVERT', 'a', 'b',\n        'CSS', '.x { color: white !important; }',\n        'UNSUPPORTED', 'c', 'd',\n        '========',\n        'twitter.com',\n        'UNSUPPORTED', 'a', 'b',\n        'INVERT', 'c', 'd',\n        '========',\n        'wikipedia.org',\n        'IGNORE INLINE STYLE', 'a', 'b',\n        '========',\n        'duckduckgo.com',\n        'IGNORE IMAGE ANALYSIS', 'img[alt=\"Logo\"]', 'canvas',\n    ].join('\\n'))).toEqual([\n        {url: ['inbox.google.com', 'mail.google.com'], invert: ['a', 'b'], css: '.x { color: white !important; }'},\n        {url: ['twitter.com'], invert: ['c', 'd']},\n        {url: ['wikipedia.org'], ignoreInlineStyle: ['a', 'b']},\n        {url: ['duckduckgo.com'], ignoreImageAnalysis: ['img[alt=\"Logo\"]', 'canvas']},\n    ] as any);\n});","file":"unit/config/config.tests.ts","skipped":false,"dir":"tests"},{"name":"Inversion Fixes config","suites":[],"updatePoint":{"line":138,"column":28},"line":138,"code":"test('Inversion Fixes config', async () => {\n    const file = await readConfig('inversion-fixes.config');\n\n    // there is no \\r character\n    expect(file.indexOf('\\r')).toEqual(-1);\n\n    const fixes = parseInversionFixes(file);\n\n    // there is a common fix\n    expect(fixes[0].url[0]).toEqual('*');\n\n    // each fix has valid URL\n    expect(fixes.every(({url}) => url.every(isURLPatternValid))).toBe(true);\n\n    // fixes are sorted alphabetically\n    expect(fixes.map(({url}) => url[0])).toEqual(fixes.map(({url}) => url[0]).sort(compareURLPatterns));\n\n    // selectors should have no comma\n    expect(fixes.every(({invert, noinvert, removebg}) => (invert || []).concat(noinvert || []).concat(removebg || []).every((s) => s.indexOf(',') < 0))).toBe(true);\n\n    // fixes are properly formatted\n    expect(throwIfDifferent(file, formatInversionFixes(fixes), 'Inversion fixes format error')).not.toThrow();\n});","file":"unit/config/config.tests.ts","skipped":false,"dir":"tests"},{"name":"Static Themes config","suites":[],"updatePoint":{"line":162,"column":26},"line":162,"code":"test('Static Themes config', async () => {\n    const file = await readConfig('static-themes.config');\n\n    // there is no \\r character\n    expect(file.indexOf('\\r')).toEqual(-1);\n\n    const themes = parseStaticThemes(file);\n\n    // there is a common theme\n    expect(themes[0].url[0]).toEqual('*');\n\n    // each theme has valid URL\n    expect(themes.every(({url}) => url.every(isURLPatternValid))).toBe(true);\n\n    // themes are sorted alphabetically\n    expect(themes.map(({url}) => url[0])).toEqual(themes.map(({url}) => url[0]).sort(compareURLPatterns));\n\n    // selectors should have no comma\n    expect(themes.every((t) => (Object.keys(t) as Array<keyof StaticTheme>)\n        .filter((prop) => ['url', 'noCommon'].indexOf(prop) < 0)\n        .every((prop) => (t[prop] as string[])\n            .every((s) => s.indexOf(',') < 0)))).toBe(true);\n\n    // fixes are properly formatted\n    expect(throwIfDifferent(file, formatStaticThemes(themes), 'Static theme format error')).not.toThrow();\n});","file":"unit/config/config.tests.ts","skipped":false,"dir":"tests"},{"name":"Colorscheme config","suites":[],"updatePoint":{"line":189,"column":24},"line":189,"code":"test('Colorscheme config', async () => {\n    const file = await readConfig('color-schemes.drconf');\n\n    // there is no \\r character\n    expect(file.indexOf('\\r')).toEqual(-1);\n\n    const {result: schemes, error} = parseColorSchemeConfig(file);\n\n    // Their is no error\n    expect(error).toBeNull();\n\n    // There is a default Dark color scheme\n    expect(schemes.dark['Default']).toBeDefined();\n\n    // There is a default Light color scheme\n    expect(schemes.light['Default']).toBeDefined();\n\n    // Check formatting\n    expect(formatColorSchemeConfig(schemes)).toEqual(file);\n});","file":"unit/config/config.tests.ts","skipped":false,"dir":"tests"},{"name":"Locales","suites":[],"updatePoint":{"line":28,"column":13},"line":28,"code":"test('Locales', async () => {\n    const files = await readDir(rootPath('src/_locales'));\n    const enLocale = await readLocale('en.config');\n    const enLines = enLocale.split('\\n');\n    const locales: string[] = [];\n    for (const file of files) {\n        const locale = await readLocale(file);\n        locales.push(locale);\n    }\n\n    function compareLinesToEnLocale(predicate: (en: string, loc: string) => boolean) {\n        return locales.every((loc, j) => {\n            const lines = loc.split('\\n');\n            for (let i = 0; i < Math.min(lines.length, enLines.length); i++) {\n                if (!predicate(enLines[i], lines[i])) {\n                    console.error(`${files[j]}, line ${i + 1}`);\n                    return false;\n                }\n            }\n            return true;\n        });\n    }\n\n    // Line count is the same\n    expect(locales.every((loc) => loc.split('\\n').length === enLines.length)).toBe(true);\n\n    // Locale ends with new line\n    expect(locales.every((loc) => loc.endsWith('\\n')));\n\n    // Line spaces are the same\n    expect(compareLinesToEnLocale((en, loc) => !en === !loc)).toBe(true);\n\n    // Message codes are on the same positions\n    expect(compareLinesToEnLocale((en, loc) => !en.startsWith('@') || (en.startsWith('@') && en === loc))).toBe(true);\n\n    // No extra whitespace\n    expect(compareLinesToEnLocale((en, loc) => loc.trim() === loc)).toBe(true);\n});","file":"unit/config/locales.tests.ts","skipped":false,"dir":"tests"},{"name":"CSP should match","suites":["Check that CSP matches expected one"],"updatePoint":{"line":6,"column":24},"line":6,"code":"    it('CSP should match', async () => {\n        const file = join(__dirname, '../../../src/manifest-chrome-mv3.json');\n        const manifest: chrome.runtime.Manifest = JSON.parse(await readFile(file, {encoding: 'utf-8'}));\n        expect(manifest.content_security_policy).toEqual(prepareCSPMV3());\n    });","file":"unit/csp/csp.tests.ts","skipped":false,"dir":"tests"},{"name":"Index config","suites":[],"updatePoint":{"line":4,"column":18},"line":4,"code":"test('Index config', () => {\n    interface TestFix {\n        url: string[];\n        directive?: string;\n        multilineDirective?: string;\n        css?: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n        MULTILINEDIRECTIVE: 'multilineDirective',\n        CSS: 'css'\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hi',\n        '',\n        'MULTILINEDIRECTIVE',\n        'hello',\n        'world',\n        '',\n        '==================',\n        '',\n        'example.com',\n        '',\n        'CSS',\n        'div {',\n        '  color: green;',\n        '}'\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixes = getSitesFixesFor<TestFix>('example.com', config, index, options);\n    fixes.sort();\n    expect(fixes).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hi',\n            'multilineDirective':\n                'hello\\nworld'\n        }, {\n            'url': ['example.com'],\n            'css': 'div {\\n  color: green;\\n}'\n        }]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Empty config","suites":[],"updatePoint":{"line":59,"column":18},"line":59,"code":"test('Empty config', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        'invalid.example',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixesGeneric = getSitesFixesFor<TestFix>('example.com', config, index, options);\n    const fixesInvalid = getSitesFixesFor<TestFix>('invalid.example', config, index, options);\n    expect(fixesGeneric).toEqual([{\n        'url': ['*'],\n        'directive': 'hello world',\n    }]);\n    expect(fixesInvalid).toEqual(fixesGeneric);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Domain appearing in multiple records","suites":[],"updatePoint":{"line":97,"column":42},"line":97,"code":"test('Domain appearing in multiple records', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '*.example.net',\n        '',\n        'DIRECTIVE',\n        'one',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '*.example.net',\n        '',\n        'DIRECTIVE',\n        'two',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '*.example.net',\n        '',\n        'DIRECTIVE',\n        'three',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixesFQD = getSitesFixesFor<TestFix>('example.com', config, index, options);\n    const fixesWildcard = getSitesFixesFor<TestFix>('sub.example.net', config, index, options);\n    fixesFQD.sort();\n    expect(fixesFQD).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'one'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'two'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'three'\n        }\n    ]);\n    fixesWildcard.sort();\n    expect(fixesWildcard).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'one'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'two'\n        }, {\n            'url': ['example.com', '*.example.net'],\n            'directive': 'three'\n        }]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Domain appearing multiple times within the same record","suites":[],"updatePoint":{"line":181,"column":60},"line":181,"code":"test('Domain appearing multiple times within the same record', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '*.example.net',\n        'example.com',\n        '*.example.net',\n        '',\n        'DIRECTIVE',\n        'one',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixesFQD = getSitesFixesFor<TestFix>('example.com', config, index, options);\n    const fixesWildcard = getSitesFixesFor<TestFix>('sub.example.net', config, index, options);\n    fixesFQD.sort();\n    expect(fixesFQD).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': [\n                'example.com',\n                '*.example.net',\n                'example.com',\n                '*.example.net'\n            ],\n            'directive': 'one'\n        }\n    ]);\n    fixesWildcard.sort();\n    expect(fixesWildcard).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': [\n                'example.com',\n                '*.example.net',\n                'example.com',\n                '*.example.net'\n            ],\n            'directive': 'one'\n        }\n    ]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"BACKWARDS COMPATIBILITY: The generic fix appears first","suites":[],"updatePoint":{"line":250,"column":60},"line":250,"code":"test('BACKWARDS COMPATIBILITY: The generic fix appears first', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        '*.example.com',\n        '',\n        'DIRECTIVE',\n        'wildcard',\n        '',\n        '====================',\n        '',\n        'sub.example.com',\n        '',\n        'DIRECTIVE',\n        'sub',\n        '',\n        '====================',\n        '',\n        'long.sub.example.com',\n        '',\n        'DIRECTIVE',\n        'long',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixesFQD = getSitesFixesFor<TestFix>('long.sub.example.com', config, index, options);\n    expect(fixesFQD[0]).toEqual({\n        'url': ['*'],\n        'directive': 'hello world'\n    });\n    fixesFQD.sort();\n    expect(fixesFQD).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': ['long.sub.example.com'],\n            'directive': 'long'\n        }, {\n            'url': ['sub.example.com'],\n            'directive': 'sub'\n        }, {\n            'url': ['*.example.com'],\n            'directive': 'wildcard'\n        }\n    ]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Fixes appear only once","suites":[],"updatePoint":{"line":319,"column":28},"line":319,"code":"test('Fixes appear only once', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        '*.example.com',\n        'www.example.com',\n        '',\n        'DIRECTIVE',\n        'duplicate',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixes = getSitesFixesFor<TestFix>('www.example.com', config, index, options);\n    expect(fixes).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': [\n                '*.example.com',\n                'www.example.com'\n            ],\n            'directive': 'duplicate'\n        }\n    ]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"","suites":["Explicit wildcard domain patterns"],"updatePoint":{"line":380,"column":10},"line":380,"code":"    test('', () => {\n        const config = [\n            '*',\n            '',\n            'DIRECTIVE',\n            'hello world',\n            '',\n            '====================',\n            '',\n            '*.example.com',\n            '',\n            'DIRECTIVE',\n            'match',\n            ''\n        ].join('\\n');\n\n        const index = indexSitesFixesConfig<TestFix>(config);\n\n        const fixes = getSitesFixesFor<TestFix>('www.example.com', config, index, options);\n        expect(fixes).toEqual([\n            {\n                'url': ['*'],\n                'directive': 'hello world'\n            }, {\n                'url': [\n                    '*.example.com',\n                ],\n                'directive': 'match'\n            }\n        ]);\n    });","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Domain label in the wrong place","suites":["Explicit wildcard domain patterns"],"updatePoint":{"line":412,"column":41},"line":412,"code":"    test('Domain label in the wrong place', () => {\n        const config = [\n            '*',\n            '',\n            'DIRECTIVE',\n            'hello world',\n            '',\n            '====================',\n            '',\n            '*.example.com',\n            '',\n            'DIRECTIVE',\n            'no match',\n            '',\n            '====================',\n            '',\n            '*.lowspecificity.com',\n            '',\n            'DIRECTIVE',\n            'no match',\n            ''\n        ].join('\\n');\n\n        const index = indexSitesFixesConfig<TestFix>(config);\n\n        const fixes = getSitesFixesFor<TestFix>('example.other.com', config, index, options);\n        // Ensure that label 'example.com' does appear in the index\n        expect(index.domainLabels).toEqual({\n            '*': [0],\n            'example.com': [1],\n            'lowspecificity.com': [2]\n        });\n        expect(fixes).toEqual([{\n            'url': ['*'],\n            'directive': 'hello world'\n        }]);\n    });","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Clearly non-matching pattern","suites":["Backwards compatibility","Nonstandard patterns"],"updatePoint":{"line":453,"column":40},"line":453,"code":"        it('Clearly non-matching pattern', () => {\n            interface TestFix {\n                url: string[];\n                directive: string;\n            }\n\n            const directiveMap: { [key: string]: keyof TestFix } = {\n                DIRECTIVE: 'directive',\n            };\n\n            const config = [\n                '*',\n                '',\n                'DIRECTIVE',\n                'hello world',\n                '',\n                '====================',\n                '',\n                'example*.com',\n                '',\n                'DIRECTIVE',\n                'one',\n                ''\n            ].join('\\n');\n\n            const options: SitesFixesParserOptions<TestFix> = {\n                commands: Object.keys(directiveMap),\n                getCommandPropName: (command) => directiveMap[command],\n                parseCommandValue: (_, value) => value.trim(),\n            };\n            const index = indexSitesFixesConfig<TestFix>(config);\n\n            const fixes = getSitesFixesFor<TestFix>('other.net', config, index, options);\n            expect(fixes).toEqual([\n                {\n                    'url': ['*'],\n                    'directive': 'hello world'\n                }\n            ]);\n        });","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Legacy matching pattern","suites":["Backwards compatibility","Nonstandard patterns"],"updatePoint":{"line":494,"column":35},"line":494,"code":"        it('Legacy matching pattern', () => {\n            interface TestFix {\n                url: string[];\n                directive: string;\n            }\n\n            const directiveMap: { [key: string]: keyof TestFix } = {\n                DIRECTIVE: 'directive',\n            };\n\n            const config = [\n                '*',\n                '',\n                'DIRECTIVE',\n                'hello world',\n                '',\n                '====================',\n                '',\n                'example*',\n                '',\n                'DIRECTIVE',\n                'one',\n                ''\n            ].join('\\n');\n\n            const options: SitesFixesParserOptions<TestFix> = {\n                commands: Object.keys(directiveMap),\n                getCommandPropName: (command) => directiveMap[command],\n                parseCommandValue: (_, value) => value.trim(),\n            };\n            const index = indexSitesFixesConfig<TestFix>(config);\n\n            const fixes = getSitesFixesFor<TestFix>('example.com', config, index, options);\n            expect(fixes).toEqual([\n                {\n                    'url': ['*'],\n                    'directive': 'hello world'\n                },\n                {\n                    'url': ['example*'],\n                    'directive': 'one'\n                }\n            ]);\n\n            const fixes2 = getSitesFixesFor<TestFix>('example.deep.com', config, index, options);\n            expect(fixes2).toEqual([\n                {\n                    'url': ['*'],\n                    'directive': 'hello world'\n                },\n                {\n                    'url': ['example*'],\n                    'directive': 'one'\n                }\n            ]);\n\n            const fixes3 = getSitesFixesFor<TestFix>('nonexample.com', config, index, options);\n            expect(fixes3).toEqual([\n                {\n                    'url': ['*'],\n                    'directive': 'hello world'\n                }\n            ]);\n\n            const fixes4 = getSitesFixesFor<TestFix>('deep.example.com', config, index, options);\n            expect(fixes4).toEqual([\n                {\n                    'url': ['*'],\n                    'directive': 'hello world'\n                },\n                {\n                    'url': ['example*'],\n                    'directive': 'one'\n                }\n            ]);\n        });","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Implied wildcards","suites":["Backwards compatibility","Nonstandard patterns"],"updatePoint":{"line":573,"column":23},"line":573,"code":"test('Implied wildcards', () => {\n    interface TestFix {\n        url: string[];\n        directive: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '',\n        'DIRECTIVE',\n        'one',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixes = getSitesFixesFor<TestFix>('www.example.com', config, index, options);\n    expect(fixes).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': [\n                'example.com',\n            ],\n            'directive': 'one'\n        }\n    ]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"Base64 in CSS","suites":["Backwards compatibility","Nonstandard patterns"],"updatePoint":{"line":620,"column":19},"line":620,"code":"test('Base64 in CSS', () => {\n    interface TestFix {\n        url: string[];\n        directive?: string;\n        css?: string;\n    }\n\n    const directiveMap: { [key: string]: keyof TestFix } = {\n        DIRECTIVE: 'directive',\n        CSS: 'css',\n    };\n\n    const config = [\n        '*',\n        '',\n        'DIRECTIVE',\n        'hello world',\n        '',\n        '====================',\n        '',\n        'example.com',\n        '',\n        'CSS',\n        '.CodeMirror-merge-r-deleted, .CodeMirror-merge-l-deleted {',\n        \"    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAIAAAASFvFNAAAAFklEQVQImWO84ePDwMCQ8uEDEwMMAAA1TAO4kytpLAAAAABJRU5ErkJggg==') !important;\",\n        '}',\n        ''\n    ].join('\\n');\n\n    const options: SitesFixesParserOptions<TestFix> = {\n        commands: Object.keys(directiveMap),\n        getCommandPropName: (command) => directiveMap[command],\n        parseCommandValue: (_, value) => value.trim(),\n    };\n    const index = indexSitesFixesConfig<TestFix>(config);\n\n    const fixes = getSitesFixesFor<TestFix>('www.example.com', config, index, options);\n    expect(fixes).toEqual([\n        {\n            'url': ['*'],\n            'directive': 'hello world'\n        }, {\n            'url': [\n                'example.com',\n            ],\n            'css': [\n                '.CodeMirror-merge-r-deleted, .CodeMirror-merge-l-deleted {',\n                \"    background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAMAAAACCAIAAAASFvFNAAAAFklEQVQImWO84ePDwMCQ8uEDEwMMAAA1TAO4kytpLAAAAABJRU5ErkJggg==') !important;\",\n                '}',\n            ].join('\\n'),\n        }]);\n});","file":"unit/generators/utils/parse.tests.ts","skipped":false,"dir":"tests"},{"name":"If fix list is empty or invalid, findRelevantFix() returns null","suites":["Select fixes via findRelevantFix()"],"updatePoint":{"line":15,"column":71},"line":15,"code":"    it('If fix list is empty or invalid, findRelevantFix() returns null', () => {\n        expect(findRelevantFix('https://example.com', [])).toBe(null);\n        expect(findRelevantFix('https://example.com', 1 as any)).toBe(null);\n        expect(findRelevantFix('https://example.com', 'a' as any)).toBe(null);\n        expect(findRelevantFix('https://example.com', {} as any)).toBe(null);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"If no matching URL found, findRelevantFix() returns null","suites":["Select fixes via findRelevantFix()"],"updatePoint":{"line":22,"column":64},"line":22,"code":"    it('If no matching URL found, findRelevantFix() returns null', () => {\n        expect(findRelevantFix('https://example.com', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            }\n        ])).toBe(null);\n\n        expect(findRelevantFix('https://example.com', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'other.com',\n                    'some.net',\n                ],\n            }\n        ])).toBe(null);\n\n        expect(findRelevantFix('https://example.com', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/sub',\n                ],\n            }\n        ])).toBe(null);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"If multiple matching URL patterns found, select the most specific one","suites":["Select fixes via findRelevantFix()"],"updatePoint":{"line":58,"column":77},"line":58,"code":"    it('If multiple matching URL patterns found, select the most specific one', () => {\n        expect(findRelevantFix('https://example.com/sub', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com',\n                    'example.net',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/sub',\n                    'some.net',\n                ],\n            }\n        ])).toBe(2);\n\n        expect(findRelevantFix('https://example.com/1/2/3', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/1',\n                    'example.net',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/1/2',\n                    'example.net',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/1/2/3',\n                    'some.net',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/1/2/3/4',\n                    'some.net',\n                ],\n            }\n        ])).toBe(3);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"BUG COMPATIBILITY: If multiple matching URL patterns found, the most specific fix is determined by the length of first pattern","suites":["Select fixes via findRelevantFix()"],"updatePoint":{"line":116,"column":134},"line":116,"code":"    it('BUG COMPATIBILITY: If multiple matching URL patterns found, the most specific fix is determined by the length of first pattern', () => {\n        expect(findRelevantFix('https://example.com/exact/match', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'other.net',\n                    'example.com/exact/match',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'other.net/this/fix/is/selected',\n                    'example.com',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'other.net',\n                    'example.com/exact/match',\n                ],\n            },\n        ])).toBe(2);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"BUG COMPATIBILITY: If multiple matching URL patterns of the same length are found, select the first one","suites":["Select fixes via findRelevantFix()"],"updatePoint":{"line":146,"column":111},"line":146,"code":"    it('BUG COMPATIBILITY: If multiple matching URL patterns of the same length are found, select the first one', () => {\n        expect(findRelevantFix('https://example.com/exact/match', [\n            {\n                ...emptyFix,\n                url: ['*'],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/exact/match',\n                ],\n            },\n            {\n                ...emptyFix,\n                url: [\n                    'example.com/exact/match',\n                ],\n            },\n        ])).toBe(1);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Merges CSS","suites":["Construct single fix via combineFixes()"],"updatePoint":{"line":178,"column":18},"line":178,"code":"    it('Merges CSS', () => {\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                css: 'body { background: blue; }',\n            },\n            {\n                ...emptyFix,\n                url: ['example.com'],\n                css: 'h1 { color: yellow; }',\n            }\n        ])!.css).toBe(multiline(\n            'body { background: blue; }',\n            'h1 { color: yellow; }',\n        ));\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Merges invert","suites":["Construct single fix via combineFixes()"],"updatePoint":{"line":196,"column":21},"line":196,"code":"    it('Merges invert', () => {\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                invert: ['img'],\n            },\n            {\n                ...emptyFix,\n                invert: ['svg'],\n            }\n        ])!.invert).toStrictEqual(['img', 'svg']);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Merges ignoreImageAnalysis","suites":["Construct single fix via combineFixes()"],"updatePoint":{"line":210,"column":34},"line":210,"code":"    it('Merges ignoreImageAnalysis', () => {\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                ignoreImageAnalysis: ['img'],\n            },\n            {\n                ...emptyFix,\n                ignoreImageAnalysis: ['svg'],\n            }\n        ])!.ignoreImageAnalysis).toStrictEqual(['img', 'svg']);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Merges ignoreInlineStyle","suites":["Construct single fix via combineFixes()"],"updatePoint":{"line":224,"column":32},"line":224,"code":"    it('Merges ignoreInlineStyle', () => {\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                ignoreInlineStyle: ['img'],\n            },\n            {\n                ...emptyFix,\n                ignoreInlineStyle: ['svg'],\n            }\n        ])!.ignoreInlineStyle).toStrictEqual(['img', 'svg']);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"disableStyleSheetsProxy is true if it is true in at least one fix","suites":["Construct single fix via combineFixes()"],"updatePoint":{"line":238,"column":73},"line":238,"code":"    it('disableStyleSheetsProxy is true if it is true in at least one fix', () => {\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                disableStyleSheetsProxy: false,\n            },\n            {\n                ...emptyFix,\n            }\n        ])!.disableStyleSheetsProxy).toBe(false);\n\n        expect(combineFixes([\n            {\n                ...emptyFix,\n                url: ['*'],\n                disableStyleSheetsProxy: false,\n            },\n            {\n                ...emptyFix,\n                disableStyleSheetsProxy: true,\n            },\n            {\n                ...emptyFix,\n                disableStyleSheetsProxy: false,\n            }\n        ])!.disableStyleSheetsProxy).toBe(true);\n    });","file":"unit/inject/fixes.tests.ts","skipped":false,"dir":"tests"},{"name":"Color parsing","suites":[],"updatePoint":{"line":4,"column":19},"line":4,"code":"test('Color parsing', () => {\n    expect(parse('rgb(255,0,153)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255, 0, 153)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(100%,0%,60%)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(100%, 0%, 60%)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255 0 153)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n\n    expect(parse('rgb(255, 0, 153, 1)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255, 0, 153, 100%)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255 0 153 / 1)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255 0 153 / 100%)')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('rgb(255, 0, 153.6, 1)')).toEqual({r: 255, g: 0, b: 154, a: 1});\n    expect(parse('rgb(0 0 0/0.04)')).toEqual({r: 0, g: 0, b: 0, a: 0.04});\n    expect(parse('rgb(1e2, .5e1, .5e0, +.25e2%)')).toEqual({r: 100, g: 5, b: 1, a: 0.25});\n\n    expect(parse('rgba(51, 170, 51, .1)')).toEqual({r: 51, g: 170, b: 51, a: 0.1});\n    expect(parse('rgba(51, 170, 51, .4)')).toEqual({r: 51, g: 170, b: 51, a: 0.4});\n    expect(parse('rgba(51, 170, 51, .7)')).toEqual({r: 51, g: 170, b: 51, a: 0.7});\n    expect(parse('rgba(51, 170, 51, 1)')).toEqual({r: 51, g: 170, b: 51, a: 1});\n    expect(parse('rgba(51 170 51 / 0.4)')).toEqual({r: 51, g: 170, b: 51, a: 0.4});\n    expect(parse('rgba(51 170 51 / 40%)')).toEqual({r: 51, g: 170, b: 51, a: 0.4});\n    expect(parse('rgba(255, 0, 153.6, 1)')).toEqual({r: 255, g: 0, b: 154, a: 1});\n    expect(parse('rgba(1e2, .5e1, .5e0, +.25e2%)')).toEqual({r: 100, g: 5, b: 1, a: 0.25});\n\n    expect(parse('hsl(270,60%,70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n    expect(parse('hsl(270, 60%, 70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n    expect(parse('hsl(270 60% 70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n    expect(parse('hsl(270deg, 60%, 70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n    expect(parse('hsl(4.71239rad, 60%, 70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n    expect(parse('hsl(.75turn, 60%, 70%)')).toEqual({r: 179, g: 133, b: 224, a: 1});\n\n    expect(parse('hsl(270, 60%, 50%, .15)')).toEqual({r: 128, g: 51, b: 204, a: 0.15});\n    expect(parse('hsl(270, 60%, 50%, 15%)')).toEqual({r: 128, g: 51, b: 204, a: 0.15});\n    expect(parse('hsl(270 60% 50% / .15)')).toEqual({r: 128, g: 51, b: 204, a: 0.15});\n    expect(parse('hsl(270 60% 50% / 15%)')).toEqual({r: 128, g: 51, b: 204, a: 0.15});\n\n    expect(parse('hsla(240, 100%, 50%, .05)')).toEqual({r: 0, g: 0, b: 255, a: 0.05});\n    expect(parse('hsla(240, 100%, 50%, .4)')).toEqual({r: 0, g: 0, b: 255, a: 0.4});\n    expect(parse('hsla(240, 100%, 50%, .7)')).toEqual({r: 0, g: 0, b: 255, a: 0.7});\n    expect(parse('hsla(240, 100%, 50%, 1)')).toEqual({r: 0, g: 0, b: 255, a: 1});\n    expect(parse('hsla(240 100% 50% / .05)')).toEqual({r: 0, g: 0, b: 255, a: 0.05});\n    expect(parse('hsla(240 100% 50% / 5%)')).toEqual({r: 0, g: 0, b: 255, a: 0.05});\n\n    expect(parse('#f09')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('#F09')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('#ff0099')).toEqual({r: 255, g: 0, b: 153, a: 1});\n    expect(parse('#FF0099')).toEqual({r: 255, g: 0, b: 153, a: 1});\n\n    expect(parse('#3a30')).toEqual({r: 51, g: 170, b: 51, a: 0});\n    expect(parse('#3A3F')).toEqual({r: 51, g: 170, b: 51, a: 1});\n    expect(parse('#33aa3300')).toEqual({r: 51, g: 170, b: 51, a: 0});\n    expect(parse('#33AA3388')).toEqual({r: 51, g: 170, b: 51, a: 136 / 255});\n\n    expect(parse('rebeccapurple')).toEqual({r: 102, g: 51, b: 153, a: 1});\n\n    expect(parse('transparent')).toEqual({r: 0, g: 0, b: 0, a: 0});\n\n    expect(parse('InfoBackground')).toEqual({r: 251, g: 252, b: 197, a: 1});\n    expect(parse('-webkit-focus-ring-color')).toEqual({r: 229, g: 151, b: 0, a: 1});\n\n    expect(parse('sponge')).toBeNull();\n    expect(parse('hsl(0, 0%, 0%) rgb(0, 0, 0)')).toBeNull();\n    expect(parse('#hello')).toBeNull();\n});","file":"unit/utils/color.tests.ts","skipped":false,"dir":"tests"},{"name":"Stringify color","suites":[],"updatePoint":{"line":69,"column":21},"line":69,"code":"test('Stringify color', () => {\n    expect(rgbToString({r: 255, g: 0, b: 153})).toEqual('rgb(255, 0, 153)');\n    expect(rgbToString({r: 255, g: 0, b: 153, a: 1})).toEqual('rgb(255, 0, 153)');\n    expect(rgbToString({r: 255, g: 0, b: 153, a: 0.25003})).toEqual('rgba(255, 0, 153, 0.25)');\n\n    expect(rgbToHexString({r: 255, g: 0, b: 153})).toEqual('#ff0099');\n    expect(rgbToHexString({r: 255, g: 0, b: 153, a: 1})).toEqual('#ff0099');\n    expect(rgbToHexString({r: 255, g: 0, b: 153, a: 0.25003})).toEqual('#ff009940');\n\n    expect(hslToString({h: 270, s: 0.6, l: 0.7})).toEqual('hsl(270, 60%, 70%)');\n    expect(hslToString({h: 270, s: 0.6, l: 0.7, a: 1})).toEqual('hsl(270, 60%, 70%)');\n    expect(hslToString({h: 270.25, s: 0.5988, l: 0.702, a: 0.33333})).toEqual('hsla(270, 60%, 70%, 0.33)');\n    expect(hslToString({h: 270.25, s: 0.5988, l: 0.702, a: 0.00032})).toEqual('hsla(270, 60%, 70%, 0)');\n});","file":"unit/utils/color.tests.ts","skipped":false,"dir":"tests"},{"name":"Color conversion","suites":[],"updatePoint":{"line":84,"column":22},"line":84,"code":"test('Color conversion', () => {\n    expect(hslToRGB({h: 180, s: 1, l: 0.5, a: 0.25})).toEqual({r: 0, g: 255, b: 255, a: 0.25});\n    expect(hslToRGB({h: 0, s: 1, l: 0.25, a: 0.5})).toEqual({r: 128, g: 0, b: 0, a: 0.5});\n    expect(hslToRGB({h: 12, s: 0.78, l: 0.61})).toEqual({r: 233, g: 109, b: 78, a: 1});\n    expect(hslToRGB({h: 192, s: 0.57, l: 0.10})).toEqual({r: 11, g: 34, b: 40, a: 1});\n    expect(hslToRGB({h: 0, s: 0, l: 0.5})).toEqual({r: 128, g: 128, b: 128, a: 1});\n\n    const round = (color: HSLA) => Object.entries(color).reduce((c, [k, v]) => (c[k as keyof HSLA] = k === 'h' ? Math.round(v) : Math.round(v * 100) / 100, c), {} as HSLA);\n    expect(round(rgbToHSL({r: 0, g: 255, b: 255, a: 0.25}))).toEqual({h: 180, s: 1, l: 0.5, a: 0.25});\n    expect(round(rgbToHSL({r: 128, g: 0, b: 0, a: 0.5}))).toEqual({h: 0, s: 1, l: 0.25, a: 0.5});\n    expect(round(rgbToHSL({r: 233, g: 109, b: 78}))).toEqual({h: 12, s: 0.78, l: 0.61, a: 1});\n    expect(round(rgbToHSL({r: 11, g: 34, b: 40}))).toEqual({h: 192, s: 0.57, l: 0.10, a: 1});\n    expect(round(rgbToHSL({r: 161, g: 28, b: 61}))).toEqual({h: 345, s: 0.7, l: 0.37, a: 1});\n});","file":"unit/utils/color.tests.ts","skipped":false,"dir":"tests"},{"name":"Lower calc expressions","suites":[],"updatePoint":{"line":99,"column":28},"line":99,"code":"test('Lower calc expressions', () => {\n    expect(lowerCalcExpression('hsl(0, 0%, calc(95% - 3%))')).toEqual('hsl(0, 0%, 92%)');\n    expect(lowerCalcExpression('hsl(0, calc(25% + 12%), calc(95% - 3%))')).toEqual('hsl(0, 37%, 92%)');\n    expect(lowerCalcExpression('rgb(calc(216.75 + 153 * .15), calc(216.75 + 205 * .15), calc(216.75 + 255 * .15))')).toEqual('rgb(240, 248, 255)');\n});","file":"unit/utils/color.tests.ts","skipped":false,"dir":"tests"},{"name":"Scale","suites":[],"updatePoint":{"line":3,"column":11},"line":3,"code":"test('Scale', () => {\n    expect(scale(5, 0, 10, 0, 100)).toEqual(50);\n});","file":"unit/utils/math.tests.ts","skipped":false,"dir":"tests"},{"name":"Clamp","suites":[],"updatePoint":{"line":7,"column":11},"line":7,"code":"test('Clamp', () => {\n    expect(clamp(1, 2, 3)).toEqual(2);\n    expect(clamp(2, 1, 3)).toEqual(2);\n    expect(clamp(3, 1, 2)).toEqual(2);\n});","file":"unit/utils/math.tests.ts","skipped":false,"dir":"tests"},{"name":"Matrix multiplication","suites":[],"updatePoint":{"line":13,"column":27},"line":13,"code":"test('Matrix multiplication', () => {\n    expect(multiplyMatrices([[1]], [[2]])).toEqual([[2]]);\n    expect(multiplyMatrices([[1, 2, 3], [6, 5, 3]], [[1, 2], [7, 4], [6, 2]])).toEqual([[33, 16], [59, 38]]);\n});","file":"unit/utils/math.tests.ts","skipped":false,"dir":"tests"},{"name":"type gradients","suites":[],"updatePoint":{"line":3,"column":20},"line":3,"code":"test('type gradients', () => {\n    expect(parseGradient('linear-gradient(rgb(200))')).toEqual([{\n        typeGradient: 'linear-gradient',\n        match: 'rgb(200)',\n        offset: 17,\n        index: 0,\n        hasComma: false,\n    }]);\n    expect(parseGradient(`linear-gradient(217deg, rgba(255,0,0,.8), rgba(255,0,0,0) 70.71%),\n    linear-gradient(127deg, rgba(0,255,0,.8), rgba(0,255,0,0) 70.71%),\n    linear-gradient(336deg, rgba(0,0,255,.8), rgba(0,0,255,0) 70.71%);`)).toEqual([\n        {\n            offset: 17,\n            match: '217deg, rgba(255,0,0,.8), rgba(255,0,0,0) 70.71%',\n            hasComma: true,\n            index: 0,\n            typeGradient: 'linear-gradient',\n        },\n        {\n            typeGradient: 'linear-gradient',\n            match: '127deg, rgba(0,255,0,.8), rgba(0,255,0,0) 70.71%',\n            hasComma: true,\n            offset: 17,\n            index: 71,\n        },\n        {\n            typeGradient: 'linear-gradient',\n            match: '336deg, rgba(0,0,255,.8), rgba(0,0,255,0) 70.71%',\n            hasComma: false,\n            offset: 17,\n            index: 142\n        }\n    ]);\n    expect(parseGradient('radial-gradient(rgb(200))')).toEqual([{\n        typeGradient: 'radial-gradient',\n        match: 'rgb(200)',\n        index: 0,\n        offset: 17,\n        hasComma: false,\n\n    }]);\n\n    expect(parseGradient('repeating-linear-gradient(transparent, #4d9f0c 40px), repeating-linear-gradient(0.25turn, transparent, #3f87a6 20px);')).toEqual([\n        {\n            typeGradient: 'repeating-linear-gradient',\n            match: 'transparent, #4d9f0c 40px',\n            hasComma: true,\n            offset: 27,\n            index: 0,\n        },\n        {\n            typeGradient: 'repeating-linear-gradient',\n            match: '0.25turn, transparent, #3f87a6 20px',\n            hasComma: false,\n            index: 54,\n            offset: 27,\n        }\n    ]);\n});","file":"unit/utils/parsing.tests.ts","skipped":false,"dir":"tests"},{"name":"basic functionality","suites":["Promise barrier utility"],"updatePoint":{"line":5,"column":29},"line":5,"code":"    test('basic functionality', async () => {\n        const barrier = new PromiseBarrier();\n        const fn1 = jest.fn();\n        const fn2 = jest.fn();\n        (async () => {\n            fn1();\n            const result = await barrier.entry();\n            fn2(result);\n        })();\n        expect(fn1).toBeCalled();\n        expect(fn2).not.toBeCalled();\n\n        expect(barrier.isPending()).toBe(true);\n        expect(barrier.isFulfilled()).toBe(false);\n        expect(barrier.isRejected()).toBe(false);\n        await barrier.resolve(2);\n        expect(barrier.isFulfilled()).toBe(true);\n        expect(barrier.isPending()).toBe(false);\n        expect(barrier.isRejected()).toBe(false);\n        expect(fn1).toBeCalledTimes(1);\n        expect(fn2).toBeCalledWith(2);\n    });","file":"unit/utils/promise-barrier.tests.ts","skipped":false,"dir":"tests"},{"name":"awaiting for barrier after it was settled","suites":["Promise barrier utility"],"updatePoint":{"line":28,"column":51},"line":28,"code":"    test('awaiting for barrier after it was settled', async () => {\n        const barrierFulfilled = new PromiseBarrier();\n        expect(barrierFulfilled.isPending()).toBe(true);\n        expect(barrierFulfilled.isFulfilled()).toBe(false);\n        expect(barrierFulfilled.isRejected()).toBe(false);\n        const promise1 = barrierFulfilled.resolve('Hello World!');\n        expect(barrierFulfilled.isFulfilled()).toBe(true);\n        expect(barrierFulfilled.isPending()).toBe(false);\n        expect(barrierFulfilled.isRejected()).toBe(false);\n        const fn1 = jest.fn();\n        await (async () => fn1(await barrierFulfilled.entry()))();\n        await promise1;\n        expect(fn1).toBeCalledWith('Hello World!');\n\n        const barrierRejected = new PromiseBarrier();\n        const promise2 = barrierRejected.reject('rejection reason');\n        const fn2 = jest.fn();\n        await (async () => {\n            try {\n                await barrierRejected.entry();\n            } catch (e) {\n                fn2(e);\n            }\n        })();\n        await promise2;\n        expect(fn2).toBeCalledWith('rejection reason');\n    });","file":"unit/utils/promise-barrier.tests.ts","skipped":false,"dir":"tests"},{"name":"resolving multiple times","suites":["Promise barrier utility"],"updatePoint":{"line":56,"column":34},"line":56,"code":"    test('resolving multiple times', async () => {\n        const barrierFulfilled = new PromiseBarrier();\n        expect(barrierFulfilled.isPending()).toBe(true);\n        expect(barrierFulfilled.isFulfilled()).toBe(false);\n        expect(barrierFulfilled.isRejected()).toBe(false);\n        await barrierFulfilled.resolve('Hello World!');\n        expect(barrierFulfilled.isFulfilled()).toBe(true);\n        expect(barrierFulfilled.isPending()).toBe(false);\n        expect(barrierFulfilled.isRejected()).toBe(false);\n        await barrierFulfilled.resolve('Hello World 2!');\n        expect(barrierFulfilled.isFulfilled()).toBe(true);\n        expect(barrierFulfilled.isPending()).toBe(false);\n        expect(barrierFulfilled.isRejected()).toBe(false);\n\n        const fn1 = jest.fn();\n        await (async () => fn1(await barrierFulfilled.entry()))();\n\n        expect(fn1).toBeCalledWith('Hello World!');\n    });","file":"unit/utils/promise-barrier.tests.ts","skipped":false,"dir":"tests"},{"name":"rejecting multiple times","suites":["Promise barrier utility"],"updatePoint":{"line":76,"column":34},"line":76,"code":"    test('rejecting multiple times', async () => {\n        const barrierRejected = new PromiseBarrier();\n        expect(barrierRejected.isPending()).toBe(true);\n        expect(barrierRejected.isFulfilled()).toBe(false);\n        expect(barrierRejected.isRejected()).toBe(false);\n        await barrierRejected.reject('rejection reason');\n        expect(barrierRejected.isRejected()).toBe(true);\n        expect(barrierRejected.isPending()).toBe(false);\n        expect(barrierRejected.isFulfilled()).toBe(false);\n        await barrierRejected.reject('rejection reason 2');\n\n        const fn2 = jest.fn();\n        await (async () => {\n            try {\n                await barrierRejected.entry();\n            } catch (e) {\n                fn2(e);\n            }\n        })();\n\n        expect(fn2).toBeCalledWith('rejection reason');\n    });","file":"unit/utils/promise-barrier.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager basic functionality","suites":["State manager utility"],"updatePoint":{"line":41,"column":43},"line":41,"code":"    test('State manager basic functionality', async () => {\n        const key = 'key';\n        const storage: any = {\n            fromStorage: 'fromStorage',\n        };\n\n        const getMock = jest.fn();\n        const get = (storageKey: string, callback: any) => {\n            expect(storageKey).toEqual(key);\n            getMock();\n            callback({});\n        };\n\n        const setMock = jest.fn();\n        const set = (items: any, callback: () => void) => {\n            Object.assign(storage, items);\n            setMock();\n            callback();\n        };\n\n        const parent: any = {\n            noSync: true,\n            fromParent: 'fromParent',\n            fromStorage: undefined,\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            fromParent: 'fromDefault',\n            fromStorage: 'fromDefault'\n        }, {get, set}, noop, noop);\n\n        expect(getMock).not.toBeCalled();\n        expect(setMock).not.toBeCalled();\n        expect(parent).toEqual({\n            noSync: true,\n            fromParent: 'fromParent',\n            fromStorage: undefined,\n        });\n\n        await stateManager.loadState();\n        expect(getMock).toBeCalled();\n        expect(setMock).not.toBeCalled();\n        expect(parent).toEqual({\n            noSync: true,\n            fromParent: 'fromDefault',\n            fromStorage: 'fromDefault',\n        });\n\n        parent.other = 'another';\n        await stateManager.saveState();\n        expect(setMock).toBeCalled();\n        expect(storage[key]).toEqual({\n            fromParent: 'fromDefault',\n            fromStorage: 'fromDefault',\n        });\n        expect(parent).toEqual({\n            fromParent: 'fromDefault',\n            fromStorage: 'fromDefault',\n            noSync: true,\n            other: 'another',\n        });\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles multiple concurrent loadState() calls","suites":["State manager utility"],"updatePoint":{"line":104,"column":69},"line":104,"code":"    test('State manager handles multiple concurrent loadState() calls', async () => {\n        const key = 'key';\n\n        let getCount = 0;\n        let getCallback: (data: any) => void;\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            getCount++;\n            expect(storageKey).toEqual(key);\n            getCallback = callback;\n        };\n\n        const setMock = jest.fn();\n\n        const parent: any = {\n            noSync: true,\n            data: 'fromParent',\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            data: 'fromStorage',\n        }, {get, set: setMock}, noop, noop);\n\n        expect(setMock).not.toBeCalled();\n        expect(parent).toEqual({\n            noSync: true,\n            data: 'fromParent',\n        });\n\n        // Multiple calls to loadState() should result in a single call to c.s.l.get()\n        const promises = new PromiseWrapper();\n        for (let i = 0; i < 5; i++) {\n            promises.add(stateManager.loadState());\n        }\n        expect(getCount).toEqual(1);\n        expect(parent).toEqual({\n            noSync: true,\n            data: 'fromParent',\n        });\n        promises.all('pending');\n\n        expect(getCount).toEqual(1);\n\n        getCallback!({});\n\n        promises.all('pending');\n\n        await nextTick();\n        promises.all('resolved');\n        expect(getCount).toEqual(1);\n        expect(setMock).not.toBeCalled();\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles multiple concurrent saveState() calls","suites":["State manager utility"],"updatePoint":{"line":156,"column":69},"line":156,"code":"    test('State manager handles multiple concurrent saveState() calls', async () => {\n        const key = 'key';\n        const storage: any = {};\n\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            expect(storageKey).toEqual(key);\n            callback({[storageKey]: storage[storageKey]});\n        };\n\n        const resolveSet = () => setCallback();\n        let setCount = 0;\n        let setCallback: () => void;\n        const set = (items: any, callback: () => void) => {\n            setCount++;\n            setCallback = () => {\n                Object.assign(storage, items);\n                callback();\n            };\n        };\n\n        const parent: any = {\n            noSync: true,\n            count: 100,\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            count: 0,\n        }, {get, set}, noop, noop);\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 100,\n        });\n\n        await stateManager.loadState();\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 0,\n        });\n\n        // Multiple calls to loadState() should result in a single call to c.s.l.get()\n        const promises = new PromiseWrapper();\n        for (let i = 0; i < 5; i++) {\n            parent.count++;\n            promises.add(stateManager.saveState());\n        }\n        expect(setCount).toEqual(1);\n        expect(parent).toEqual({\n            noSync: true,\n            count: 5,\n        });\n        promises.all('pending');\n\n\n        // Resolve the first write\n        expect(setCount).toEqual(1);\n        resolveSet();\n        expect(setCount).toEqual(2);\n\n        promises.all('pending');\n\n        await nextTick();\n        promises.all('pending');\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 5,\n        });\n\n        // Resolve the second write\n        resolveSet();\n\n        expect(setCount).toEqual(2);\n        expect(storage).toEqual({\n            key: {\n                count: 5,\n            }\n        });\n\n        await nextTick();\n        promises.all('resolved');\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles multiple concurrent saveState() calls","suites":["State manager utility"],"updatePoint":{"line":240,"column":69},"line":240,"code":"    test('State manager handles multiple concurrent saveState() calls', async () => {\n        const key = 'key';\n        const storage: any = {};\n\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            expect(storageKey).toEqual(key);\n            callback({[storageKey]: storage[storageKey]});\n        };\n\n        const resolveSet = () => setCallback();\n        let setCount = 0;\n        let setCallback: () => void;\n        const set = (items: any, callback: () => void) => {\n            setCount++;\n            setCallback = () => {\n                Object.assign(storage, items);\n                callback();\n            };\n        };\n\n        const parent: any = {\n            noSync: true,\n            count: 100,\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            count: 0,\n        }, {get, set}, noop, noop);\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 100,\n        });\n\n        await stateManager.loadState();\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 0,\n        });\n\n        // Multiple calls to loadState() should result in a single call to c.s.l.get()\n        const promises = new PromiseWrapper();\n        for (let i = 0; i < 5; i++) {\n            parent.count++;\n            promises.add(stateManager.saveState());\n        }\n        expect(setCount).toEqual(1);\n        expect(parent).toEqual({\n            noSync: true,\n            count: 5,\n        });\n        promises.all('pending');\n\n\n        // Resolve the first write\n        expect(setCount).toEqual(1);\n        resolveSet();\n        expect(setCount).toEqual(2);\n\n        promises.all('pending');\n\n        // Wait for the next tick when all loadState promises resolve\n        await nextTick();\n        promises.all('pending');\n\n        expect(parent).toEqual({\n            noSync: true,\n            count: 5,\n        });\n\n        // Resolve the second write\n        resolveSet();\n        expect(setCount).toEqual(2);\n        expect(storage).toEqual({\n            key: {\n                count: 5,\n            }\n        });\n\n        await nextTick();\n        promises.all('resolved');\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles saveState() before loadState()","suites":["State manager utility"],"updatePoint":{"line":324,"column":62},"line":324,"code":"    test('State manager handles saveState() before loadState()', async () => {\n        const key = 'key';\n        const storage: any = {};\n\n        let getCount = 0;\n        let getCallback: () => void;\n        const resolveGet = () => getCallback();\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            expect(storageKey).toEqual(key);\n            getCount++;\n            getCallback = () => {\n                callback({[storageKey]: storage[storageKey]});\n            };\n        };\n\n        let setCount = 0;\n        const set = () => setCount++;\n\n        const parent: any = {\n            data: 'fromParent',\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            data: 'fromDefault',\n        }, {get, set}, noop, noop);\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n\n        const promise = new PromiseWrapper();\n        promise.add(stateManager.saveState());\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n\n        await nextTick();\n        promise.promises.forEach((state) => expect(state).toBe('pending'));\n\n        resolveGet();\n\n        await nextTick();\n        promise.promises.forEach((state) => expect(state).toBe('resolved'));\n\n        expect(parent).toEqual({\n            data: 'fromDefault',\n        });\n\n        await stateManager.loadState();\n\n        expect(parent).toEqual({\n            data: 'fromDefault'\n        });\n\n        expect(setCount).toEqual(0);\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles interleaved saveState() and loadState()","suites":["State manager utility"],"updatePoint":{"line":384,"column":71},"line":384,"code":"    test('State manager handles interleaved saveState() and loadState()', async () => {\n        const key = 'key';\n        const storage: any = {};\n\n        let getCount = 0;\n        let getCallback: () => void;\n        const resolveGet = () => getCallback();\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            expect(storageKey).toEqual(key);\n            getCount++;\n            getCallback = () => {\n                callback({[storageKey]: storage[storageKey]});\n            };\n        };\n\n        let setCount = 0;\n        let setCallback: () => void;\n        const resolveSet = () => setCallback();\n        const set = (items: any, callback: () => void) => {\n            setCount++;\n            setCallback = () => {\n                Object.assign(storage, items);\n                callback();\n            };\n        };\n\n        const parent: any = {\n            data: 'fromParent',\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            data: 'fromDefault',\n        }, {get, set}, noop, noop);\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n\n        const promises = new PromiseWrapper();\n        promises.add([\n            stateManager.loadState(),\n            stateManager.loadState(),\n            stateManager.saveState(),\n            stateManager.loadState(),\n            stateManager.loadState(),\n            stateManager.saveState(),\n            stateManager.saveState(),\n            stateManager.saveState(),\n        ]);\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n\n        await nextTick();\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n        promises.all('pending');\n\n        resolveGet();\n\n        await nextTick();\n        expect(parent).toEqual({\n            data: 'fromDefault',\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n        promises.all('resolved');\n\n        parent.data = 'new';\n        await stateManager.loadState();\n        expect(parent).toEqual({\n            data: 'new'\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n\n        const promises2 = new PromiseWrapper();\n        promises2.add([\n            stateManager.saveState(),\n            stateManager.loadState(),\n            stateManager.saveState(),\n            stateManager.loadState(),\n            stateManager.loadState(),\n            stateManager.saveState(),\n            stateManager.loadState(),\n            stateManager.saveState(),\n        ]);\n\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(1);\n\n        expect(parent).toEqual({\n            data: 'new'\n        });\n\n        resolveSet();\n\n        await nextTick();\n        expect(parent).toEqual({\n            data: 'new',\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(2);\n\n        resolveSet();\n\n        await nextTick();\n        promises2.all('resolved');\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"State manager handles onChanged during saveState() and loadState()","suites":["State manager utility"],"updatePoint":{"line":497,"column":76},"line":497,"code":"    test('State manager handles onChanged during saveState() and loadState()', async () => {\n        const key = 'key';\n        const storage: any = {};\n\n        let getCount = 0;\n        let getCallback: (() => void) | undefined;\n        const resolveGet = () => {\n            getCallback!();\n            getCallback = undefined;\n        };\n\n        const get = (storageKey: string, callback: (data: any) => void) => {\n            expect(storageKey).toEqual(key);\n            getCount++;\n            getCallback = () => {\n                callback({[storageKey]: storage[storageKey]});\n            };\n        };\n\n        let setCount = 0;\n        let setCallback: (() => void) | undefined;\n        const resolveSet = () => {\n            setCallback!();\n            setCallback = undefined;\n        };\n\n        const set = (items: any, callback: () => void) => {\n            setCount++;\n            setCallback = () => {\n                Object.assign(storage, items);\n                callback();\n            };\n        };\n\n        let onChangedListener: ((data: any) => void) | undefined;\n        const modifyInternalState = (data: any) => {\n            expect(onChangedListener).toBeTruthy();\n            const oldValue = storage[key];\n            storage[key] = data;\n            onChangedListener!({\n                [key]: {\n                    oldValue,\n                    newValue: data\n                }\n            });\n        };\n\n        const parent: any = {\n            data: 'fromParent',\n        };\n\n        const stateManager = new StateManagerImpl(key, parent, {\n            data: 'fromDefault',\n        }, {get, set}, (listener) => onChangedListener = listener, noop);\n\n        const c1 = jest.fn();\n        stateManager.addChangeListener(c1);\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n\n        const promises = new PromiseWrapper();\n        promises.add(stateManager.loadState());\n\n        expect(parent).toEqual({\n            data: 'fromParent',\n        });\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n\n        await nextTick();\n        expect(getCount).toEqual(1);\n        expect(setCount).toEqual(0);\n        promises.all('pending');\n\n        expect(c1).not.toBeCalled();\n\n        modifyInternalState({\n            data: 'fromStorageChange',\n        });\n\n        resolveGet();\n\n        await nextTick();\n        expect(c1).toBeCalled();\n        expect(parent).toEqual({\n            data: 'fromStorageChange',\n        });\n        expect(getCount).toEqual(2);\n        expect(setCount).toEqual(0);\n        promises.all('resolved');\n\n        expect(stateManager.getStateForTesting()).toEqual('Ready');\n\n        const c2 = jest.fn();\n        stateManager.addChangeListener(c2);\n\n        parent.data = 'new';\n        await stateManager.loadState();\n        expect(parent).toEqual({\n            data: 'new'\n        });\n        expect(getCount).toEqual(2);\n        expect(setCount).toEqual(0);\n        expect(stateManager.getStateForTesting()).toEqual('Ready');\n\n        const promises2 = new PromiseWrapper;\n        promises2.add(stateManager.saveState());\n\n        modifyInternalState({\n            data: 'fromStorageChange2',\n        });\n        expect(getCount).toEqual(2);\n        expect(setCount).toEqual(1);\n        promises2.all('pending');\n\n        // During data race the JS-world data does not get overwriten\n        expect(parent).toEqual({\n            data: 'new'\n        });\n\n        resolveSet();\n\n        await nextTick();\n        expect(parent).toEqual({\n            data: 'new',\n        });\n        expect(getCount).toEqual(3);\n        expect(setCount).toEqual(1);\n        promises2.all('pending');\n\n        expect(c2).not.toBeCalled();\n\n        resolveGet();\n\n        await nextTick();\n        expect(c2).toBeCalled();\n        expect(parent).toEqual({\n            data: 'new',\n        });\n        expect(getCount).toEqual(3);\n        expect(setCount).toEqual(1);\n        promises2.all('resolved');\n    });","file":"unit/utils/state-manager.tests.ts","skipped":false,"dir":"tests"},{"name":"CSS formatting","suites":[],"updatePoint":{"line":3,"column":20},"line":3,"code":"test('CSS formatting', () => {\n    expect(formatCSS('div { color: red; }'))\n        .toEqual([\n            'div {',\n            '    color: red;',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('div { color: red; } .list-item { background: rgb(0, 0, 0); color: white; }'))\n        .toEqual([\n            'div {',\n            '    color: red;',\n            '}',\n            '.list-item {',\n            '    background: rgb(0, 0, 0);',\n            '    color: white;',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('@media screen { div { color: red; } span { color: red; } } @media all { p { color: green; } }'))\n        .toEqual([\n            '@media screen {',\n            '    div {',\n            '        color: red;',\n            '    }',\n            '    span {',\n            '        color: red;',\n            '    }',\n            '}',\n            '@media all {',\n            '    p {',\n            '        color: green;',\n            '    }',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('div, span { background: green; color: red; }'))\n        .toEqual([\n            'div,',\n            'span {',\n            '    background: green;',\n            '    color: red;',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('@media print, screen and (min-width: 20rem) { div, span { background: green; color: red; } }'))\n        .toEqual([\n            '@media print,',\n            'screen and (min-width: 20rem) {',\n            '    div,',\n            '    span {',\n            '        background: green;',\n            '        color: red;',\n            '    }',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('.icon { background-image: url(data:image/gif;base64,XYZ); }'))\n        .toEqual([\n            '.icon {',\n            '    background-image: url(data:image/gif;base64,XYZ);',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('img[src*=\"a,b;c\"] { filter: invert(1); }'))\n        .toEqual([\n            'img[src*=\"a,b;c\"] {',\n            '    filter: invert(1);',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('img[src*=\"a,b;c\"] {\\n    filter: invert(1); \\n}'))\n        .toEqual([\n            'img[src*=\"a,b;c\"] {',\n            '    filter: invert(1);',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('div { } span { color: red; } button { }'))\n        .toEqual([\n            'span {',\n            '    color: red;',\n            '}',\n        ].join('\\n'));\n\n    expect(formatCSS('@media all { div { } span { color: red; } } @media all { div { } } @media all { button { color: green; } }'))\n        .toEqual([\n            '@media all {',\n            '    span {',\n            '        color: red;',\n            '    }',\n            '}',\n            '@media all {',\n            '    button {',\n            '        color: green;',\n            '    }',\n            '}',\n        ].join('\\n'));\n});","file":"unit/utils/text.tests.ts","skipped":false,"dir":"tests"},{"name":"Parenthesis Range","suites":[],"updatePoint":{"line":103,"column":23},"line":103,"code":"test('Parenthesis Range', () => {\n    expect(getParenthesesRange('missing')).toBe(null);\n    expect(getParenthesesRange('()')).toEqual({start: 0, end: 2});\n    expect(getParenthesesRange('rgb(0, 0, 0)')).toEqual({start: 3, end: 12});\n    expect(getParenthesesRange('rgb(0, 0, 0), rgb(0, 0, 0)')).toEqual({start: 3, end: 12});\n    expect(getParenthesesRange('rgb(0, 0, 0), rgb(0, 0, 0)', 12)).toEqual({start: 17, end: 26});\n    expect(getParenthesesRange('rgb(0, var(--x, var(--y)), 0)')).toEqual({start: 3, end: 29});\n    expect(getParenthesesRange('rgb(0, var(--x, var(--y)), 0)', 4)).toEqual({start: 10, end: 25});\n    expect(getParenthesesRange('rgb(0, var(--x, var(--y)), 0), rgb(0, 0, 0)')).toEqual({start: 3, end: 29});\n});","file":"unit/utils/text.tests.ts","skipped":false,"dir":"tests"},{"name":"Time interval","suites":[],"updatePoint":{"line":3,"column":19},"line":3,"code":"test('Time interval', () => {\n    // isInTimeIntervalLocal is time-zone dependent\n    expect(isInTimeIntervalLocal('9:00', '12:00', new Date(2018, 11, 4, 10))).toEqual(true);\n    expect(isInTimeIntervalLocal('10:00', '10:00', new Date(2018, 11, 4, 10))).toEqual(false);\n    expect(isInTimeIntervalLocal('10:00', '10:00', new Date(2018, 11, 4, 12))).toEqual(false);\n    expect(isInTimeIntervalLocal('10:00', '10:00', new Date(2018, 11, 4, 8))).toEqual(false);\n    expect(isInTimeIntervalLocal('9:00', '10:00', new Date(2018, 11, 4, 10))).toEqual(false);\n    expect(isInTimeIntervalLocal('9:01', '10:00', new Date(2018, 11, 4, 9, 2))).toEqual(true);\n    expect(isInTimeIntervalLocal('9:00', '10:01', new Date(2018, 11, 4, 10))).toEqual(true);\n    expect(isInTimeIntervalLocal('18:00', '12:00', new Date(2018, 11, 4, 10))).toEqual(true);\n    expect(isInTimeIntervalLocal('18:00', '9:00', new Date(2018, 11, 4, 10))).toEqual(false);\n    expect(isInTimeIntervalLocal('18:00', '9:00', new Date(2018, 11, 4, 22))).toEqual(true);\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Time interval prediction","suites":[],"updatePoint":{"line":17,"column":30},"line":17,"code":"test('Time interval prediction', () => {\n    // nextTimeInterval() returns time-zone dependent timestamp\n    expect(nextTimeInterval('9:00', '12:00', new Date(2018, 11, 4, 10))).toEqual(new Date(2018, 11, 4, 12).getTime());\n    expect(nextTimeInterval('10:00', '10:00', new Date(2018, 11, 4, 10))).toEqual(null);\n    expect(nextTimeInterval('10:00', '10:00', new Date(2018, 11, 4, 12))).toEqual(null);\n    expect(nextTimeInterval('10:00', '10:00', new Date(2018, 11, 4, 8))).toEqual(null);\n    expect(nextTimeInterval('9:00', '10:00', new Date(2018, 11, 4, 10))).toEqual(new Date(2018, 11, 5, 9).getTime());\n    expect(nextTimeInterval('9:01', '10:00', new Date(2018, 11, 4, 9, 2))).toEqual(new Date(2018, 11, 4, 10).getTime());\n    expect(nextTimeInterval('9:00', '10:01', new Date(2018, 11, 4, 10))).toEqual(new Date(2018, 11, 4, 10, 1).getTime());\n    expect(nextTimeInterval('18:00', '12:00', new Date(2018, 11, 4, 10))).toEqual(new Date(2018, 11, 4, 12).getTime());\n    expect(nextTimeInterval('18:00', '9:00', new Date(2018, 11, 4, 10))).toEqual(new Date(2018, 11, 4, 18).getTime());\n    expect(nextTimeInterval('18:00', '9:00', new Date(2018, 11, 4, 22))).toEqual(new Date(2018, 11, 5, 9).getTime());\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Time parse","suites":[],"updatePoint":{"line":31,"column":16},"line":31,"code":"test('Time parse', () => {\n    expect(parseTime('10:30')).toEqual([10, 30]);\n    expect(parseTime('10:30AM')).toEqual([10, 30]);\n    expect(parseTime('10:30 a.m.')).toEqual([10, 30]);\n    expect(parseTime('10:30PM')).toEqual([22, 30]);\n    expect(parseTime('10:30 p.m.')).toEqual([22, 30]);\n    expect(parseTime('0:30')).toEqual([0, 30]);\n    expect(parseTime('12:30am')).toEqual([0, 30]);\n    expect(parseTime('12:30pm')).toEqual([12, 30]);\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Duration","suites":[],"updatePoint":{"line":42,"column":14},"line":42,"code":"test('Duration', () => {\n    expect(getDuration({\n        seconds: 48,\n        minutes: 24,\n        hours: 8,\n        days: 3\n    })).toEqual(289488000);\n\n    expect(getDurationInMinutes({\n        seconds: 27,\n        minutes: 25,\n        hours: 5,\n        days: 7\n    })).toEqual(10405.45);\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Nigth check","suites":[],"updatePoint":{"line":58,"column":17},"line":58,"code":"test('Nigth check', () => {\n    const utcDate = (y: number, m: number, d: number, hh: number, mm: number) => new Date(Date.UTC(y, m, d, hh, mm));\n\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 0, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 5, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 7, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 12, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 18, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 20, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 0, utcDate(2019, 8, 9, 23, 59))).toEqual(true);\n\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 0, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 3, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 5, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 10, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 16, 0))).toEqual(false);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 18, 0))).toEqual(true);\n    expect(isNightAtLocation(52, 30, utcDate(2019, 8, 9, 23, 59))).toEqual(true);\n\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 0, 0))).toEqual(true);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 7, 0))).toEqual(true);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 9, 0))).toEqual(false);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 14, 0))).toEqual(false);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 20, 0))).toEqual(false);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 22, 0))).toEqual(true);\n    expect(isNightAtLocation(52, -30, utcDate(2019, 8, 9, 23, 59))).toEqual(true);\n\n    // Polar day and night\n    expect(isNightAtLocation(71, 0, utcDate(2019, 5, 15, 0, 0))).toEqual(false);\n    expect(isNightAtLocation(-71, 0, utcDate(2019, 5, 15, 0, 0))).toEqual(true);\n\n    // Places where sunset comes before sunrise (in UTC)\n    expect(isNightAtLocation(0, 180, utcDate(2019, 8, 9, 0, 0))).toEqual(false);\n    expect(isNightAtLocation(0, 180, utcDate(2019, 8, 9, 7, 0))).toEqual(true);\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Sunrise/sunset","suites":[],"updatePoint":{"line":94,"column":20},"line":94,"code":"test('Sunrise/sunset', () => {\n    const utcDate = (y: number, m: number, d: number, hh: number, mm: number) => new Date(Date.UTC(y, m, d, hh, mm));\n\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 0, 0))).toEqual(Date.UTC(2019, 8, 9, 5, 24, 2, 501));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 5, 0))).toEqual(Date.UTC(2019, 8, 9, 5, 24, 2, 501));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 7, 0))).toEqual(Date.UTC(2019, 8, 9, 18, 29, 46, 448));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 12, 0))).toEqual(Date.UTC(2019, 8, 9, 18, 29, 46, 448));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 18, 0))).toEqual(Date.UTC(2019, 8, 9, 18, 29, 46, 448));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 20, 0))).toEqual(Date.UTC(2019, 8, 10, 5, 24, 2, 501));\n    expect(nextTimeChangeAtLocation(52, 0, utcDate(2019, 8, 9, 23, 59))).toEqual(Date.UTC(2019, 8, 10, 5, 24, 2, 501));\n\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 0, 0))).toEqual(Date.UTC(2019, 8, 9, 3, 23, 54, 365));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 3, 0))).toEqual(Date.UTC(2019, 8, 9, 3, 23, 54, 365));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 5, 0))).toEqual(Date.UTC(2019, 8, 9, 16, 29, 58, 45));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 10, 0))).toEqual(Date.UTC(2019, 8, 9, 16, 29, 58, 45));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 16, 0))).toEqual(Date.UTC(2019, 8, 9, 16, 29, 58, 45));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 18, 0))).toEqual(Date.UTC(2019, 8, 10, 3, 23, 54, 365));\n    expect(nextTimeChangeAtLocation(52, 30, utcDate(2019, 8, 9, 23, 59))).toEqual(Date.UTC(2019, 8, 10, 3, 23, 54, 365));\n\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 0, 0))).toEqual(Date.UTC(2019, 8, 9, 7, 24, 10, 637));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 7, 0))).toEqual(Date.UTC(2019, 8, 9, 7, 24, 10, 637));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 9, 0))).toEqual(Date.UTC(2019, 8, 9, 20, 29, 34, 848));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 14, 0))).toEqual(Date.UTC(2019, 8, 9, 20, 29, 34, 848));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 20, 0))).toEqual(Date.UTC(2019, 8, 9, 20, 29, 34, 848));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 22, 0))).toEqual(Date.UTC(2019, 8, 10, 7, 24, 10, 637));\n    expect(nextTimeChangeAtLocation(52, -30, utcDate(2019, 8, 9, 23, 59))).toEqual(Date.UTC(2019, 8, 10, 7, 24, 10, 637));\n\n    // Polar day and night\n    expect(nextTimeChangeAtLocation(71, 0, utcDate(2019, 5, 15, 0, 0))).toEqual(Date.UTC(2019, 5, 16, 0, 0, 0, 0));\n    expect(nextTimeChangeAtLocation(-71, 0, utcDate(2019, 5, 15, 0, 0))).toEqual(Date.UTC(2019, 5, 16, 0, 0, 0, 0));\n\n    // Places where sunset comes before sunrise (in UTC)\n    expect(nextTimeChangeAtLocation(0, 180, utcDate(2019, 8, 9, 0, 0))).toEqual(Date.UTC(2019, 8, 9, 6, 0, 50, 152));\n    expect(nextTimeChangeAtLocation(0, 180, utcDate(2019, 8, 9, 7, 0))).toEqual(Date.UTC(2019, 8, 9, 17, 54, 18, 610));\n});","file":"unit/utils/time.tests.ts","skipped":false,"dir":"tests"},{"name":"Unique identifier generation (popyfilled)","suites":[],"updatePoint":{"line":4,"column":47},"line":4,"code":"test('Unique identifier generation (popyfilled)', () => {\n    if ('crypto' in globalThis) {\n        return;\n    }\n\n    // Make sure we are not messing up global context for somebody else\n    expect('crypto' in globalThis).toEqual(false);\n\n    // Create a shim for crypto API\n    // TODO: remove any cast once type declarations are updated\n    const shim1 = jest.fn();\n    globalThis.crypto = {\n        getRandomValues: (buffer: Uint8Array) => {\n            shim1();\n            return randomFillSync(buffer);\n        },\n    } as any;\n    const uid1 = generateUID();\n    expect(/^[a-f0-9]{32}$/.test(uid1)).toEqual(true);\n    expect(shim1).toHaveBeenCalled();\n\n    const shim2 = jest.fn();\n    globalThis.crypto = {\n        randomUUID: () => {\n            shim2();\n            return 'a19cc926-bf7f-4d5f-bf9c-202bc7a4c7c6';\n        },\n    } as any;\n    expect(generateUID()).toEqual('a19cc926bf7f4d5fbf9c202bc7a4c7c6');\n    expect(shim2).toHaveBeenCalled();\n\n    // eslint-disable-next-line\n    // @ts-ignore\n    delete globalThis.crypto;\n});","file":"unit/utils/uid.tests.ts","skipped":false,"dir":"tests"},{"name":"Unique identifier generation (NodeJS 19+)","suites":[],"updatePoint":{"line":40,"column":47},"line":40,"code":"test('Unique identifier generation (NodeJS 19+)', () => {\n    if (!('crypto' in globalThis)) {\n        return;\n    }\n\n    // Make sure crypto.randomUUID() is actually supported\n    expect('crypto' in globalThis && 'randomUUID' in crypto).toEqual(true);\n\n    const uid1 = generateUID();\n    expect(/^[a-f0-9]{32}$/.test(uid1)).toEqual(true);\n});","file":"unit/utils/uid.tests.ts","skipped":false,"dir":"tests"},{"name":"Fully qualified domain","suites":["Domain utilities"],"updatePoint":{"line":4,"column":32},"line":4,"code":"    test('Fully qualified domain', () => {\n        expect(isFullyQualifiedDomain('example.com')).toEqual(true);\n        expect(isFullyQualifiedDomain('xn--c1yn36f.com')).toEqual(true);\n        expect(isFullyQualifiedDomain('CaPiTaLiZaTiOn.com')).toEqual(true);\n        expect(isFullyQualifiedDomain('sub.long.example.com')).toEqual(true);\n        expect(isFullyQualifiedDomain('example.*')).toEqual(false);\n        expect(isFullyQualifiedDomain('..com')).toEqual(false);\n        expect(isFullyQualifiedDomain('some.*.com')).toEqual(false);\n    });","file":"unit/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Fully qualified domain wildcard","suites":["Domain utilities"],"updatePoint":{"line":14,"column":41},"line":14,"code":"    test('Fully qualified domain wildcard', () => {\n        expect(isFullyQualifiedDomainWildcard('example.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('xn--c1yn36f.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('CaPiTaLiZaTiOn.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('example.*.com')).toEqual(true);\n        expect(isFullyQualifiedDomainWildcard('*.xn--c1yn36f.com')).toEqual(true);\n        expect(isFullyQualifiedDomainWildcard('*.CaPiTaLiZaTiOn.com')).toEqual(true);\n        expect(isFullyQualifiedDomainWildcard('*.*.example.com')).toEqual(true);\n        expect(isFullyQualifiedDomainWildcard('*example.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('e*xample.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('**.com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('*..com')).toEqual(false);\n        expect(isFullyQualifiedDomainWildcard('.example.com')).toEqual(false);\n    });","file":"unit/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Fully qualified domain wildcard matching","suites":["Domain utilities"],"updatePoint":{"line":29,"column":50},"line":29,"code":"    test('Fully qualified domain wildcard matching', () => {\n        expect(fullyQualifiedDomainMatchesWildcard('example.com', 'example.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('*.com', 'example.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('other.example.com', 'other.com')).toEqual(false);\n        expect(fullyQualifiedDomainMatchesWildcard('example.*', 'example.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('*.com', 'xn--c1yn36f.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('*.com', 'CaPiTaLiZaTiOn.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('*.net', 'CaPiTaLiZaTiOn.com')).toEqual(false);\n\n        // Backwards compatibility\n        expect(fullyQualifiedDomainMatchesWildcard('example.com', 'sub.example.com')).toEqual(true);\n        expect(fullyQualifiedDomainMatchesWildcard('sub.example.com', 'example.com')).toEqual(false);\n    });","file":"unit/utils/url.tests.ts","skipped":false,"dir":"tests"},{"name":"Settings Validation","suites":[],"updatePoint":{"line":7,"column":25},"line":7,"code":"test('Settings Validation', () => {\n    const defaultTheme = JSON.parse(JSON.stringify(DEFAULT_THEME));\n    let themeValidation = validateTheme(defaultTheme);\n    expect(themeValidation.errors).toEqual([]);\n    expect(defaultTheme).toEqual(DEFAULT_THEME);\n\n    const partTheme = {\n        brightness: 125,\n        contrast: -50,\n    };\n    themeValidation = validateTheme(partTheme as any);\n    expect(themeValidation.errors.length).toBe(1);\n    expect(partTheme).toEqual({\n        brightness: 125,\n        contrast: DEFAULT_THEME.contrast,\n    });\n\n    const wonkyTheme = {\n        mode: 'dark',\n        brightness: 250,\n        contrast: -50,\n        grayscale: false,\n        sepia: 105,\n        useFont: 'ok',\n        fontFamily: '',\n        textStroke: 2,\n        engine: 'dymanic',\n        stylesheet: 3,\n        darkSchemeBackgroundColor: 'red',\n        darkSchemeTextColor: '#abc12x',\n        lightSchemeBackgroundColor: '',\n        lightSchemeTextColor: '#ffffff00',\n        scrollbarColor: false,\n        selectionColor: 'green',\n        styleSystemControls: null as boolean | null,\n        lightColorScheme: '',\n        darkColorScheme: false,\n        immediateModify: 1,\n    };\n    themeValidation = validateTheme(wonkyTheme as any);\n    expect(themeValidation.errors.length).toBeGreaterThan(0);\n    expect(wonkyTheme as any).toEqual(DEFAULT_THEME);\n\n    const defaultSet = JSON.parse(JSON.stringify(DEFAULT_SETTINGS));\n    let validation = validateSettings(defaultSet);\n    expect(validation.errors).toEqual([]);\n    expect(defaultSet).toEqual(DEFAULT_SETTINGS);\n\n    const wonkySet = {\n        enabled: '',\n        fetchNews: null as boolean | null,\n        theme: {\n            mode: 'dark',\n            brightness: 250,\n            contrast: -50,\n            grayscale: false,\n            sepia: 105,\n            useFont: 'ok',\n            fontFamily: '',\n            textStroke: 2,\n            engine: 'dymanic',\n            stylesheet: 3,\n            darkSchemeBackgroundColor: 'red',\n            darkSchemeTextColor: '#abc12x',\n            lightSchemeBackgroundColor: '',\n            lightSchemeTextColor: '#ffffff00',\n            scrollbarColor: false,\n            selectionColor: 'green',\n            styleSystemControls: null as boolean | null,\n            lightColorScheme: '',\n            darkColorScheme: false,\n            immediateModify: 1,\n        },\n        presets: [\n            {id: '', name: 'P1', urls: ['a.com'], theme: {brightness: 100}},\n            {id: 'p2', name: '', urls: ['a.com'], theme: {brightness: 100}},\n            {id: 'p3', name: 'P3', urls: [], theme: {brightness: 100}},\n            {id: 'p4', name: 'P4', urls: ['a.com'], theme: {brightness: -50}},\n            {id: 'p5', name: 'P5', urls: ['a.com'], theme: {brightness: 100}},\n            {id: 'p6', urls: ['a.com'], theme: {brightness: 100}},\n            {id: 'p7', name: 'P7', urls: ['a.com'], theme: null},\n            null,\n        ],\n        customThemes: [\n            {url: [] as any[], theme: {brightness: 100}},\n            {url: [''], theme: {brightness: 100}},\n            {url: ['a.com'], theme: {brightness: 100}},\n            {url: ['a.com'], theme: {brightness: -50}},\n            {url: ['a.com']},\n            {url: ['a.com'], theme: null},\n            null,\n        ],\n        siteList: ['a.com', '', 'b.com'],\n        siteListEnabled: {0: 'a.com', 1: 'b.com'},\n        applyToListedOnly: null as boolean | null,\n        changeBrowserTheme: 1,\n        syncSettings: null as boolean | null,\n        syncSitesFixes: 0,\n        automation: {\n            enabled: false,\n            behavior: 'OnOff',\n            mode: '',\n        },\n        time: {\n            activation: '10:00PM',\n            deactivation: '19:00',\n        },\n        location: {\n            latitude: 59,\n            longitude: '5.3',\n        },\n        previewNewDesign: '',\n        enableForPDF: null as boolean | null,\n        enableForProtectedPages: 'ok',\n        enableContextMenus: 'yes',\n        detectDarkTheme: 'no',\n    };\n    validation = validateSettings(wonkySet as any);\n    expect(validation.errors.length).toBeGreaterThan(0);\n    expect(wonkySet as any).toEqual({\n        ...DEFAULT_SETTINGS,\n        siteList: ['a.com', 'b.com'],\n        presets: [{id: 'p5', name: 'P5', urls: ['a.com'], theme: {brightness: 100}}],\n        customThemes: [{url: ['a.com'], theme: {brightness: 100}}],\n    });\n\n    const nullishSet = {\n        theme: null as any,\n        presets: null as any,\n        customThemes: null as any,\n        time: null as any,\n        location: null as any,\n    };\n    validation = validateSettings(nullishSet);\n    expect(validation.errors.length).toBe(5);\n    expect(nullishSet).toEqual({\n        theme: DEFAULT_THEME,\n        presets: DEFAULT_SETTINGS.presets,\n        customThemes: DEFAULT_SETTINGS.customThemes,\n        time: DEFAULT_SETTINGS.time,\n        location: DEFAULT_SETTINGS.location,\n    });\n\n    const validSet: UserSettings = {\n        enabled: true,\n        fetchNews: true,\n        theme: {\n            mode: 0,\n            brightness: 125,\n            contrast: 50,\n            grayscale: 25,\n            sepia: 5,\n            useFont: true,\n            fontFamily: 'Comic Sans',\n            textStroke: 0.5,\n            engine: ThemeEngine.dynamicTheme,\n            stylesheet: '.x { color: red; }',\n            darkSchemeBackgroundColor: '#abcdef',\n            darkSchemeTextColor: '#abc123',\n            lightSchemeBackgroundColor: '#ff0000',\n            lightSchemeTextColor: '#ffffff',\n            scrollbarColor: '',\n            selectionColor: 'auto',\n            styleSystemControls: false,\n            lightColorScheme: 'Lightness',\n            darkColorScheme: 'Darkness',\n            immediateModify: true,\n        },\n        presets: [\n            {id: 'p5', name: 'P5', urls: ['a.com'], theme: {brightness: 100} as Theme},\n        ],\n        customThemes: [\n            {url: ['a.com'], theme: {brightness: 100} as Theme},\n        ],\n        siteList: ['a.com', 'b.com'],\n        siteListEnabled: ['c.com'],\n        applyToListedOnly: true,\n        changeBrowserTheme: true,\n        syncSettings: false,\n        syncSitesFixes: true,\n        automation: {\n            enabled: true,\n            mode: AutomationMode.LOCATION,\n            behavior: 'OnOff',\n        },\n        time: {\n            activation: '18:00',\n            deactivation: '7:00',\n        },\n        location: {\n            latitude: 59,\n            longitude: 53,\n        },\n        previewNewDesign: true,\n        enableForPDF: false,\n        enableForProtectedPages: true,\n        enableContextMenus: true,\n        detectDarkTheme: true,\n    };\n    const validSetCopy = JSON.parse(JSON.stringify(validSet));\n    validation = validateSettings(validSet);\n    expect(validation.errors).toEqual([]);\n    expect(validSet).toEqual(validSetCopy);\n});","file":"unit/utils/validation.tests.ts","skipped":false,"dir":"tests"}]}