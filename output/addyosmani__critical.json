{"repo":"addyosmani/critical","url":"https://github.com/addyosmani/critical","branch":"master","configs":[{"package":"critical","lang":"js","dir":"test","framework":"jest","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"async map","suites":[],"updatePoint":{"line":4,"column":15,"index":299},"line":4,"code":"test('async map', async () => {\n  const afunc = async value => {\n    await waitRandom();\n    return value * value;\n  };\n  const func = value => value * value;\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const expected = array.map(value => func(value));\n  const result1 = await mapAsync(array, v => func(v));\n  const result2 = await mapAsync(array, v => afunc(v));\n  expect(result1).toEqual(expected);\n  expect(result2).toEqual(expected);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async map (default)","suites":[],"updatePoint":{"line":17,"column":25,"index":751},"line":17,"code":"test('async map (default)', async () => {\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const result = await mapAsync(array);\n  expect(result).toEqual(array);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async map (empty)","suites":[],"updatePoint":{"line":22,"column":23,"index":910},"line":22,"code":"test('async map (empty)', async () => {\n  const result = await mapAsync();\n  expect(result).toEqual([]);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async reduce","suites":[],"updatePoint":{"line":26,"column":18,"index":1014},"line":26,"code":"test('async reduce', async () => {\n  const afunc = async (res, value, index) => {\n    await waitRandom();\n    return [...res, value * index];\n  };\n  const func = (res, value, index) => [...res, value * index];\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const expected = array.reduce((res, value, index) => func(res, value, index), []);\n  const result1 = await reduceAsync([], array, func);\n  const result2 = await reduceAsync([], array, afunc);\n  expect(result1).toEqual(expected);\n  expect(result2).toEqual(expected);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async reduce (default)","suites":[],"updatePoint":{"line":39,"column":28,"index":1548},"line":39,"code":"test('async reduce (default)', async () => {\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const result = await reduceAsync(array);\n  expect(result).toEqual(array);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async reduce (empty)","suites":[],"updatePoint":{"line":44,"column":26,"index":1713},"line":44,"code":"test('async reduce (empty)', async () => {\n  const result = await reduceAsync();\n  expect(result).toEqual(undefined);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async filter","suites":[],"updatePoint":{"line":48,"column":18,"index":1827},"line":48,"code":"test('async filter', async () => {\n  const afunc = async value => {\n    await waitRandom();\n    return value % 2;\n  };\n  const func = value => value % 2;\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const expected = array.filter(value => func(value));\n  const result1 = await filterAsync(array, func);\n  const result2 = await filterAsync(array, afunc);\n  expect(result1).toEqual(expected);\n  expect(result2).toEqual(expected);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async filter (default)","suites":[],"updatePoint":{"line":61,"column":28,"index":2267},"line":61,"code":"test('async filter (default)', async () => {\n  const array = [1, 0, 3, false, 5, undefined, 7, null];\n  const result = await filterAsync(array);\n  expect(result).toEqual([1, 3, 5, 7]);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async filter (empty)","suites":[],"updatePoint":{"line":66,"column":26,"index":2454},"line":66,"code":"test('async filter (empty)', async () => {\n  const result = await filterAsync();\n  expect(result).toEqual([]);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"async forEach","suites":[],"updatePoint":{"line":70,"column":19,"index":2562},"line":70,"code":"test('async forEach', async () => {\n  const array = [1, 2, 3, 4, 5, 6, 7, 8];\n  const expected = [];\n  const result1 = [];\n  const result2 = [];\n  array.forEach(v => expected.push(v));\n  await forEachAsync(array, v => result1.push(v));\n  await forEachAsync(array, async v => {\n    await waitRandom();\n    result2.push(v);\n  });\n  expect(result1).toEqual(expected);\n  expect(result2).toEqual(expected);\n});","file":"array.test.js","skipped":false,"dir":"test"},{"name":"generate critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":75,"column":34,"index":2139},"line":75,"code":"  test('generate critical-path CSS', done => {\n    const expected = read('expected/generate-default.css');\n    const target = path.resolve('.critical.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default.html',\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"generate critical-path CSS from CSS files passed as Vinyl objects","suites":["generate (local)"],"updatePoint":{"line":86,"column":73,"index":2517},"line":86,"code":"  test('generate critical-path CSS from CSS files passed as Vinyl objects', done => {\n    const expected = read('expected/generate-default.css');\n    const target = path.resolve('.critical.css');\n    const stylesheets = ['fixtures/styles/main.css', 'fixtures/styles/bootstrap.css'].map(filePath => {\n      return new Vinyl({\n        cwd: '/',\n        base: '/fixtures/',\n        path: filePath,\n        contents: Buffer.from(fs.readFileSync(path.join(__dirname, filePath), 'utf8'), 'utf8')\n      });\n    });\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default-nostyle.html',\n      target,\n      css: stylesheets,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should throw an error on timeout","suites":["generate (local)"],"updatePoint":{"line":106,"column":40,"index":3206},"line":106,"code":"  test('should throw an error on timeout', done => {\n    const target = path.join(__dirname, '.include.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default.html',\n      penthouse: {\n        timeout: 1\n      },\n      target,\n      width: 1300,\n      height: 900\n    }, err => {\n      expect(err).toBeInstanceOf(Error);\n      done();\n    });\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should throw a usable error when no stylesheets are found","suites":["generate (local)"],"updatePoint":{"line":122,"column":65,"index":3601},"line":122,"code":"  test('should throw a usable error when no stylesheets are found', done => {\n    const target = path.join(__dirname, '.error.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'error.html',\n      penthouse: {\n        timeout: 1\n      },\n      target,\n      width: 1300,\n      height: 900\n    }, err => {\n      expect(err).toBeInstanceOf(Error);\n      fs.unlink(target, () => done());\n    });\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate critical-path CSS with query string in file name","suites":["generate (local)"],"updatePoint":{"line":138,"column":72,"index":4015},"line":138,"code":"  test('should generate critical-path CSS with query string in file name', done => {\n    const expected = read('expected/generate-default.css');\n    const target = path.resolve('.critical.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default-querystring.html',\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should ignore stylesheets blocked due to 403","suites":["generate (local)"],"updatePoint":{"line":149,"column":52,"index":4384},"line":149,"code":"  test('should ignore stylesheets blocked due to 403', done => {\n    const expected = '';\n    const target = path.resolve('.403.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: '403-css.html',\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should ignore stylesheets blocked due to 404","suites":["generate (local)"],"updatePoint":{"line":160,"column":52,"index":4692},"line":160,"code":"  test('should ignore stylesheets blocked due to 404', done => {\n    const expected = '';\n    const target = path.resolve('.404.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: '404-css.html',\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate multi-dimension critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":171,"column":57,"index":5005},"line":171,"code":"  test('should generate multi-dimension critical-path CSS', done => {\n    const expected = read('expected/generate-adaptive.css', 'utf8');\n    const target = path.resolve('.adaptive.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-adaptive.html',\n      target,\n      dimensions: [{\n        width: 100,\n        height: 70\n      }, {\n        width: 1000,\n        height: 70\n      }]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should consider inline styles","suites":["generate (local)"],"updatePoint":{"line":187,"column":37,"index":5440},"line":187,"code":"  test('should consider inline styles', done => {\n    const expected = read('expected/generate-adaptive.css', 'utf8');\n    const target = path.resolve('.adaptive-inline.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-adaptive-inline.html',\n      target,\n      dimensions: [{\n        width: 100,\n        height: 70\n      }, {\n        width: 1000,\n        height: 70\n      }]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should consider data uris in stylesheet hrefs","suites":["generate (local)"],"updatePoint":{"line":203,"column":53,"index":5905},"line":203,"code":"  test('should consider data uris in stylesheet hrefs', done => {\n    const expected = read('expected/generate-adaptive.css', 'utf8');\n    const target = path.resolve('.adaptive-base64.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-adaptive-base64.html',\n      target,\n      dimensions: [{\n        width: 100,\n        height: 70\n      }, {\n        width: 1000,\n        height: 70\n      }]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate minified critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":219,"column":50,"index":6367},"line":219,"code":"  test('should generate minified critical-path CSS', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.resolve('.critical.min.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default.html',\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate minified critical-path CSS successfully with external css file configured","suites":["generate (local)"],"updatePoint":{"line":230,"column":97,"index":6779},"line":230,"code":"  test('should generate minified critical-path CSS successfully with external css file configured', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.resolve('.nostyle.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default-nostyle.html',\n      css: ['fixtures/styles/main.css', 'fixtures/styles/bootstrap.css'],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline relative images","suites":["generate (local)"],"updatePoint":{"line":242,"column":37,"index":7208},"line":242,"code":"  test('should inline relative images', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.resolve('.image-relative.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline relative images from folder","suites":["generate (local)"],"updatePoint":{"line":255,"column":49,"index":7641},"line":255,"code":"  test('should inline relative images from folder', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.resolve('.image-relative.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'folder/generate-image.html',\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should rewrite relative images for html outside root","suites":["generate (local)"],"updatePoint":{"line":268,"column":60,"index":8092},"line":268,"code":"  test('should rewrite relative images for html outside root', done => {\n    const expected = read('expected/generate-image-relative.css');\n    const target = path.resolve('fixtures/folder/.image-relative.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'folder/generate-image.html',\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should rewrite relative images for html outside root with css file","suites":["generate (local)"],"updatePoint":{"line":281,"column":74,"index":8583},"line":281,"code":"  test('should rewrite relative images for html outside root with css file', done => {\n    const expected = read('expected/generate-image-relative-subfolder.css');\n    const target = path.resolve('fixtures/folder/subfolder/.image-relative-subfolder.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'folder/subfolder/generate-image-absolute.html',\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should rewrite relative images for html outside root destFolder option","suites":["generate (local)"],"updatePoint":{"line":293,"column":78,"index":9076},"line":293,"code":"  test('should rewrite relative images for html outside root destFolder option', done => {\n    const expected = read('expected/generate-image-relative-subfolder.css');\n    const target = path.resolve('.image-relative-subfolder.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'folder/subfolder/generate-image-absolute.html',\n      // destFolder: 'folder/subfolder',\n      // Dest: target,\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done, true));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should rewrite relative images for html inside root","suites":["generate (local)"],"updatePoint":{"line":306,"column":59,"index":9580},"line":306,"code":"  test('should rewrite relative images for html inside root', done => {\n    const expected = read('expected/generate-image-skip.css');\n    const target = path.resolve('.image-relative.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      // destFolder: '.',\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline absolute images","suites":["generate (local)"],"updatePoint":{"line":320,"column":37,"index":10033},"line":320,"code":"  test('should inline absolute images', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.resolve('.image-absolute.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/image-absolute.css'],\n      target,\n      // destFolder: '.',\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should skip to big images","suites":["generate (local)"],"updatePoint":{"line":334,"column":33,"index":10476},"line":334,"code":"  test('should skip to big images', done => {\n    const expected = read('expected/generate-image-big.css');\n    const target = path.resolve('.image-big.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/image-big.css'],\n      target,\n      // destFolder: '.',\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"considers \"inlineImages\" option","suites":["generate (local)"],"updatePoint":{"line":348,"column":39,"index":10919},"line":348,"code":"  test('considers \"inlineImages\" option', done => {\n    const expected = read('expected/generate-image-skip.css');\n    const target = path.resolve('.image-skip.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      // destFolder: '.',\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should not screw up win32 paths","suites":["generate (local)"],"updatePoint":{"line":362,"column":39,"index":11370},"line":362,"code":"  test('should not screw up win32 paths', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.resolve('.image.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-image.html',\n      css: ['fixtures/styles/some/path/image.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should respect pathPrefix","suites":["generate (local)"],"updatePoint":{"line":375,"column":33,"index":11779},"line":375,"code":"  test('should respect pathPrefix', done => {\n    const expected = read('expected/path-prefix.css');\n    const target = path.resolve('.path-prefix1.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'path-prefix.html',\n      css: ['fixtures/styles/path-prefix.css'],\n      target,\n      width: 1300,\n      height: 900\n      // pathPrefix: ''\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should detect pathPrefix","suites":["generate (local)"],"updatePoint":{"line":388,"column":32,"index":12182},"line":388,"code":"  test('should detect pathPrefix', done => {\n    const expected = read('expected/path-prefix.css');\n    const target = path.resolve('.path-prefix2.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'path-prefix.html',\n      css: ['fixtures/styles/path-prefix.css'],\n      target,\n      // destFolder: '.',\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline, if \"inline\" option is set","suites":["generate (local)"],"updatePoint":{"line":401,"column":61,"index":12616},"line":401,"code":"  test('should generate and inline, if \"inline\" option is set', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline1.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline.html',\n      // destFolder: '.',\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":412,"column":52,"index":12994},"line":412,"code":"  test('should generate and inline critical-path CSS', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline2.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline.html',\n      // destFolder: '.',\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline minified critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":423,"column":61,"index":13381},"line":423,"code":"  test('should generate and inline minified critical-path CSS', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline-minified3.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline.html',\n      // destFolder: '.',\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle multiple calls","suites":["generate (local)"],"updatePoint":{"line":434,"column":36,"index":13752},"line":434,"code":"  test('should handle multiple calls', done => {\n    const expected1 = read('expected/generateInline.html');\n    const expected2 = read('expected/generateInline-svg.html');\n    async.series({\n      first(cb) {\n        generate({\n          base: FIXTURES_DIR,\n          src: 'generateInline.html',\n          inline: true\n        }, cb);\n      },\n      second(cb) {\n        generate({\n          base: FIXTURES_DIR,\n          src: 'generateInline-svg.html',\n          inline: true\n        }, cb);\n      }\n    }, (err, results) => {\n      try {\n        expect(err).toBeFalsy();\n        expect(nn(results.first.html)).toBe(expected1);\n        expect(nn(results.second.html)).toBe(expected2);\n        done();\n      } catch (error) {\n        done(error);\n      }\n    });\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS ignoring remote stylesheets","suites":["generate (local)"],"updatePoint":{"line":463,"column":67,"index":14553},"line":463,"code":"  test('should inline critical-path CSS ignoring remote stylesheets', done => {\n    const expected = read('expected/generateInline-external-minified.html');\n    const target = path.resolve('.generateInline-external.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline-external.html',\n      inlineImages: false,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS with extract option ignoring remote stylesheets","suites":["generate (local)"],"updatePoint":{"line":474,"column":87,"index":14994},"line":474,"code":"  test('should inline critical-path CSS with extract option ignoring remote stylesheets', done => {\n    const expected = read('expected/generateInline-external-extract.html');\n    const target = path.resolve('.generateInline-external-extract.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline-external.html',\n      inlineImages: false,\n      extract: true,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS without screwing svg images ","suites":["generate (local)"],"updatePoint":{"line":486,"column":68,"index":15444},"line":486,"code":"  test('should inline critical-path CSS without screwing svg images ', done => {\n    const expected = read('expected/generateInline-svg.html');\n    const target = path.resolve('.generateInline-svg.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generateInline-svg.html',\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline and extract critical-path CSS","suites":["generate (local)"],"updatePoint":{"line":496,"column":51,"index":15798},"line":496,"code":"  test('should inline and extract critical-path CSS', done => {\n    const expected = read('expected/generateInline-extract.html');\n    const target = path.resolve('.generateInline-extract.html');\n    generate({\n      base: FIXTURES_DIR,\n      extract: true,\n      src: 'generateInline.html',\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline and extract critical-path CSS from html source","suites":["generate (local)"],"updatePoint":{"line":507,"column":68,"index":16194},"line":507,"code":"  test('should inline and extract critical-path CSS from html source', done => {\n    const expected = read('expected/generateInline-extract.html');\n    const target = path.resolve('.generateInline-extract-src.html');\n    generate({\n      base: FIXTURES_DIR,\n      extract: true,\n      html: read('fixtures/generateInline.html'),\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should consider \"ignore\" option","suites":["generate (local)"],"updatePoint":{"line":518,"column":39,"index":16581},"line":518,"code":"  test('should consider \"ignore\" option', done => {\n    const expected = read('expected/generate-ignore.css');\n    const target = path.resolve('.ignore.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default.html',\n      target,\n      ignore: ['@media', '.header', /jumbotron/],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle empty \"ignore\" array","suites":["generate (local)"],"updatePoint":{"line":530,"column":42,"index":16975},"line":530,"code":"  test('should handle empty \"ignore\" array', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.join(__dirname, '.ignore.min.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default.html',\n      target,\n      ignore: [],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle ignore \"@font-face\"","suites":["generate (local)"],"updatePoint":{"line":542,"column":41,"index":17355},"line":542,"code":"  test('should handle ignore \"@font-face\"', done => {\n    const expected = read('expected/generate-ignorefont.css', true);\n    const target = path.join(__dirname, '.ignorefont.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-ignorefont.html',\n      target,\n      ignore: ['@font-face'],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should keep styles defined by the `include` option","suites":["generate (local)"],"updatePoint":{"line":554,"column":58,"index":17770},"line":554,"code":"  test('should keep styles defined by the `include` option', done => {\n    const expected = read('fixtures/styles/include.css');\n    const target = path.join(__dirname, '.include.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'include.html',\n      include: [/someRule/],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"#192 - include option - generate","suites":["generate (local)"],"updatePoint":{"line":566,"column":40,"index":18140},"line":566,"code":"  test('#192 - include option - generate', done => {\n    const expected = read('expected/issue-192.css');\n    const target = path.join(__dirname, '.issue-192.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'issue-192.html',\n      css: ['fixtures/styles/issue-192.css'],\n      dimensions: [{\n        width: 320,\n        height: 480\n      }, {\n        width: 768,\n        height: 1024\n      }, {\n        width: 1280,\n        height: 960\n      }, {\n        width: 1920,\n        height: 1080\n      }],\n      extract: false,\n      ignore: ['@font-face', /url\\(/],\n      include: [/^\\.main-navigation.*$/, /^\\.hero-deck.*$/, /^\\.deck.*$/, /^\\.search-box.*$/],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should not complain about missing css if the css is passed via options","suites":["generate (local)"],"updatePoint":{"line":594,"column":78,"index":18948},"line":594,"code":"  test('should not complain about missing css if the css is passed via options', done => {\n    const expected = read('expected/generate-default-nostyle.css');\n    const target = path.join(__dirname, '.generate-default-nostyle.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default-nostyle.html',\n      css: ['fixtures/styles/bootstrap.css'],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should not complain about missing css if the css is passed via options (inline)","suites":["generate (local)"],"updatePoint":{"line":606,"column":87,"index":19426},"line":606,"code":"  test('should not complain about missing css if the css is passed via options (inline)', done => {\n    const expected = read('expected/generate-default-nostyle.html');\n    const target = path.join(__dirname, '.generate-default-nostyle.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'generate-default-nostyle.html',\n      css: ['fixtures/styles/bootstrap.css'],\n      target,\n      inline: true,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle PAGE_UNLOADED_DURING_EXECUTION error (inline)","suites":["generate (local)"],"updatePoint":{"line":619,"column":67,"index":19906},"line":619,"code":"  test('should handle PAGE_UNLOADED_DURING_EXECUTION error (inline)', done => {\n    const expected = read('fixtures/issue-314.html');\n    const target = path.join(__dirname, '.issue-314.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'issue-314.html',\n      css: ['fixtures/styles/bootstrap.css'],\n      target,\n      inline: true,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle PAGE_UNLOADED_DURING_EXECUTION error","suites":["generate (local)"],"line":632,"code":"  test.skip('should handle PAGE_UNLOADED_DURING_EXECUTION error', done => {","file":"blackbox.test.js","skipped":true,"dir":"test"},{"name":"external CSS with absolute url","suites":["generate (local)"],"line":647,"code":"  test.skip('external CSS with absolute url', done => {","file":"blackbox.test.js","skipped":true,"dir":"test"},{"name":"Correctly order css on multiple dimensions","suites":["generate (local)"],"updatePoint":{"line":659,"column":50,"index":21117},"line":659,"code":"  test('Correctly order css on multiple dimensions', done => {\n    const dimensions = [700, 600, 100, 200, 250, 150, 350, 400, 450, 500, 300, 550, 50].map(width => {\n      return {\n        width,\n        height: 1000\n      };\n    });\n    const expected = read('fixtures/styles/issue-415.css');\n    const target = path.join(__dirname, '.issue-415.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'issue-415.html',\n      target,\n      inline: false,\n      dimensions,\n      concurrency: 10\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"Ignore inlined stylesheets (disabled)","suites":["generate (local)"],"updatePoint":{"line":677,"column":45,"index":21664},"line":677,"code":"  test('Ignore inlined stylesheets (disabled)', done => {\n    const inlineStyles = '.test-selector{color:#00f}';\n    const target = path.join(__dirname, '.ignore-inlined-styles.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'ignoreInlinedStyles.html',\n      target,\n      ignoreInlinedStyles: false,\n      inline: false,\n      concurrency: 1\n    }, assertCritical(target, inlineStyles, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"Ignore inlined stylesheets (enabled)","suites":["generate (local)"],"updatePoint":{"line":689,"column":44,"index":22075},"line":689,"code":"  test('Ignore inlined stylesheets (enabled)', done => {\n    const target = path.join(__dirname, '.ignore-inlined-styles.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: 'ignoreInlinedStyles.html',\n      target,\n      ignoreInlinedStyles: true,\n      inline: false,\n      concurrency: 1\n    }, assertCritical(target, '', done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":702,"column":41,"index":22459},"line":702,"code":"  test('should generate critical-path CSS', done => {\n    const expected = read('expected/generate-default.css');\n    const target = path.join(__dirname, '.critical.css');\n    generate({\n      src: `http://localhost:${port}/generate-default.html`,\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate multi-dimension critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":712,"column":57,"index":22828},"line":712,"code":"  test('should generate multi-dimension critical-path CSS', done => {\n    const expected = read('expected/generate-adaptive.css', 'utf8');\n    const target = path.join(__dirname, '.adaptive.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-adaptive.html`,\n      target,\n      penthouse: {\n        timeout: 10_000\n      },\n      dimensions: [{\n        width: 100,\n        height: 70\n      }, {\n        width: 1000,\n        height: 70\n      }]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate minified critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":731,"column":50,"index":23361},"line":731,"code":"  test('should generate minified critical-path CSS', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.join(__dirname, '.critical.min.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-default.html`,\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate minified critical-path CSS successfully with external css file configured","suites":["generate (remote)"],"updatePoint":{"line":742,"column":97,"index":23806},"line":742,"code":"  test('should generate minified critical-path CSS successfully with external css file configured', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.join(__dirname, '.nostyle.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-default-nostyle.html`,\n      css: ['fixtures/styles/main.css', 'fixtures/styles/bootstrap.css'],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline relative images","suites":["generate (remote)"],"updatePoint":{"line":754,"column":37,"index":24268},"line":754,"code":"  test('should inline relative images', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.join(__dirname, '.image-relative.css');\n    try {\n      generate({\n        src: `http://localhost:${port}/generate-image.html`,\n        target,\n        width: 1300,\n        height: 900,\n        inlineImages: true\n      }, assertCritical(target, expected, done));\n    } catch (error) {\n      console.log(error);\n    }\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline relative images fetched over http","suites":["generate (remote)"],"updatePoint":{"line":769,"column":55,"index":24741},"line":769,"code":"  test('should inline relative images fetched over http', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.join(__dirname, '.image-relative.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n      //  assetPaths: [`http://localhost:${port}/`, `http://localhost:${port}/styles`]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline absolute images","suites":["generate (remote)"],"updatePoint":{"line":783,"column":37,"index":25282},"line":783,"code":"  test('should inline absolute images', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.join(__dirname, '.image-absolute.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/image-absolute.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline absolute images fetched over http","suites":["generate (remote)"],"updatePoint":{"line":796,"column":55,"index":25754},"line":796,"code":"  test('should inline absolute images fetched over http', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.join(__dirname, '.image-absolute.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/image-absolute.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n      // assetPaths: [`http://localhost:${port}/`, `http://localhost:${port}/styles`]\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should skip to big images","suites":["generate (remote)"],"updatePoint":{"line":810,"column":33,"index":26290},"line":810,"code":"  test('should skip to big images', done => {\n    const expected = read('expected/generate-image-big.css');\n    const target = path.join(__dirname, '.image-big.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/image-big.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"considers \"inlineImages\" option","suites":["generate (remote)"],"updatePoint":{"line":823,"column":39,"index":26740},"line":823,"code":"  test('considers \"inlineImages\" option', done => {\n    const expected = read('expected/generate-image-skip.css');\n    const target = path.join(__dirname, '.image-skip.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/image-relative.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: false\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should not screw up win32 paths","suites":["generate (remote)"],"updatePoint":{"line":836,"column":39,"index":27198},"line":836,"code":"  test('should not screw up win32 paths', done => {\n    const expected = read('expected/generate-image.css');\n    const target = path.join(__dirname, '.image.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-image.html`,\n      css: ['fixtures/styles/some/path/image.css'],\n      target,\n      width: 1300,\n      height: 900,\n      inlineImages: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should respect pathPrefix","suites":["generate (remote)"],"updatePoint":{"line":849,"column":33,"index":27640},"line":849,"code":"  test('should respect pathPrefix', done => {\n    const expected = read('expected/path-prefix.css');\n    const target = path.join(__dirname, '.path-prefix.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/path-prefix.html`,\n      css: ['fixtures/styles/path-prefix.css'],\n      target,\n      width: 1300,\n      height: 900\n      // Empty string most likely to candidate for failure if change in code results in checking option lazily,\n      // pathPrefix: ''\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should detect pathPrefix","suites":["generate (remote)"],"updatePoint":{"line":863,"column":32,"index":28187},"line":863,"code":"  test('should detect pathPrefix', done => {\n    const expected = read('expected/path-prefix.css');\n    const target = path.join(__dirname, '.path-prefix.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/path-prefix.html`,\n      css: ['fixtures/styles/path-prefix.css'],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline, if \"inline\" option is set","suites":["generate (remote)"],"updatePoint":{"line":875,"column":61,"index":28627},"line":875,"code":"  test('should generate and inline, if \"inline\" option is set', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline.html`,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":885,"column":52,"index":29003},"line":885,"code":"  test('should generate and inline critical-path CSS', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline.html`,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should generate and inline minified critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":895,"column":61,"index":29388},"line":895,"code":"  test('should generate and inline minified critical-path CSS', done => {\n    const expected = read('expected/generateInline.html');\n    const target = path.join(__dirname, '.generateInline.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline.html`,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle multiple calls","suites":["generate (remote)"],"updatePoint":{"line":905,"column":36,"index":29748},"line":905,"code":"  test('should handle multiple calls', done => {\n    const expected1 = read('expected/generateInline.html');\n    const expected2 = read('expected/generateInline.html');\n    async.series({\n      first(cb) {\n        generate({\n          base: FIXTURES_DIR,\n          src: `http://localhost:${port}/generateInline.html`,\n          inline: true\n        }, cb);\n      },\n      second(cb) {\n        generate({\n          base: FIXTURES_DIR,\n          src: `http://localhost:${port}/generateInline.html`,\n          inline: true\n        }, cb);\n      }\n    }, (err, results) => {\n      expect(err).toBeFalsy();\n      expect(nn(results.first.html)).toBe(expected1);\n      expect(nn(results.second.html)).toBe(expected2);\n      done(err);\n    });\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS handling remote stylesheets","suites":["generate (remote)"],"updatePoint":{"line":930,"column":67,"index":30521},"line":930,"code":"  test('should inline critical-path CSS handling remote stylesheets', done => {\n    const expected = read('expected/generateInline-external-minified2.html');\n    const target = path.join(__dirname, '.generateInline-external2.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline-external2.html`,\n      inlineImages: false,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS with extract option handling remote stylesheets","suites":["generate (remote)"],"updatePoint":{"line":941,"column":87,"index":30998},"line":941,"code":"  test('should inline critical-path CSS with extract option handling remote stylesheets', done => {\n    const expected = read('expected/generateInline-external-extract2.html');\n    const target = path.join(__dirname, '.generateInline-external-extract.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline-external2.html`,\n      inlineImages: false,\n      extract: true,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline critical-path CSS without screwing svg images ","suites":["generate (remote)"],"updatePoint":{"line":953,"column":68,"index":31483},"line":953,"code":"  test('should inline critical-path CSS without screwing svg images ', done => {\n    const expected = read('expected/generateInline-svg.html');\n    const target = path.join(__dirname, '.generateInline-svg.html');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generateInline-svg.html`,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should inline and extract critical-path CSS","suites":["generate (remote)"],"updatePoint":{"line":963,"column":51,"index":31870},"line":963,"code":"  test('should inline and extract critical-path CSS', done => {\n    const expected = read('expected/generateInline-extract.html');\n    const target = path.join(__dirname, '.generateInline-extract.html');\n    generate({\n      base: FIXTURES_DIR,\n      extract: true,\n      src: `http://localhost:${port}/generateInline.html`,\n      target,\n      inline: true\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should consider \"ignore\" option","suites":["generate (remote)"],"updatePoint":{"line":974,"column":39,"index":32270},"line":974,"code":"  test('should consider \"ignore\" option', done => {\n    const expected = read('expected/generate-ignore.css');\n    const target = path.join(__dirname, '.ignore.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-default.html`,\n      target,\n      ignore: ['@media', '.header', /jumbotron/],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle empty \"ignore\" array","suites":["generate (remote)"],"updatePoint":{"line":986,"column":42,"index":32697},"line":986,"code":"  test('should handle empty \"ignore\" array', done => {\n    const expected = read('expected/generate-default.css', true);\n    const target = path.join(__dirname, '.ignore.min.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-default.html`,\n      target,\n      ignore: [],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should handle ignore \"@font-face\"","suites":["generate (remote)"],"updatePoint":{"line":998,"column":41,"index":33102},"line":998,"code":"  test('should handle ignore \"@font-face\"', done => {\n    const expected = read('expected/generate-ignorefont.css', true);\n    const target = path.join(__dirname, '.ignorefont.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-ignorefont.html`,\n      target,\n      ignore: ['@font-face'],\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should keep styles defined by the `include` option","suites":["generate (remote)"],"updatePoint":{"line":1010,"column":58,"index":33542},"line":1010,"code":"  test('should keep styles defined by the `include` option', done => {\n    const expected = read('fixtures/styles/include.css');\n    const target = path.join(__dirname, '.include.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/include.html`,\n      include: [/someRule/],\n      target,\n      width: 1300,\n      height: 900\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should use the provided user agent to get the remote src","suites":["generate (remote)"],"updatePoint":{"line":1022,"column":64,"index":33961},"line":1022,"code":"  test('should use the provided user agent to get the remote src', done => {\n    const expected = read('expected/generate-default.css');\n    const target = path.join(__dirname, '.critical.css');\n    generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-default-useragent.html`,\n      include: [/someRule/],\n      target,\n      width: 1300,\n      height: 900,\n      userAgent: 'custom agent'\n    }, assertCritical(target, expected, done));\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"should use the provided request method to check for asset existance","suites":["generate (remote)"],"updatePoint":{"line":1035,"column":75,"index":34446},"line":1035,"code":"  test('should use the provided request method to check for asset existance', async () => {\n    const mockGet = jest.fn();\n    const mockHead = jest.fn();\n    nock(`http://localhost:${port}`, {\n      allowUnmocked: true\n    }).intercept('/styles/adaptive.css', 'GET').reply(200, mockGet).intercept('/styles/adaptive.css', 'HEAD').reply(200, mockHead);\n    await generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-adaptive.html`,\n      width: 1300,\n      height: 900,\n      request: {\n        method: 'get'\n      }\n    });\n    expect(mockGet).toHaveBeenCalled();\n    expect(mockHead).not.toHaveBeenCalled();\n    await generate({\n      base: FIXTURES_DIR,\n      src: `http://localhost:${port}/generate-adaptive.html`,\n      width: 1300,\n      height: 900\n    });\n    expect(mockHead).toHaveBeenCalled();\n  });","file":"blackbox.test.js","skipped":false,"dir":"test"},{"name":"Show error alongside help","suites":["CLI","acceptance"],"updatePoint":{"line":54,"column":35,"index":1711},"line":54,"code":"    test('Show error alongside help', async () => {\n      expect.assertions(3);\n      try {\n        await run(['not available']);\n      } catch (error) {\n        expect(error.stderr).toMatch('Error:');\n        expect(error.stderr).toMatch('Usage: critical');\n        expect(error.code).toBe(1);\n      }\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Return version","suites":["CLI","acceptance"],"updatePoint":{"line":64,"column":24,"index":2011},"line":64,"code":"    test('Return version', async () => {\n      const {\n        stdout,\n        stderr\n      } = await run(['--version']);\n      expect(stderr).toBeFalsy();\n      expect(stdout.trim()).toBe(version);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Take html file passed via parameter","suites":["CLI","acceptance"],"updatePoint":{"line":72,"column":45,"index":2239},"line":72,"code":"    test('Take html file passed via parameter', async () => {\n      const {\n        stdout,\n        stderr\n      } = await run(['fixtures/generate-default.html', '--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-default.css');\n      expect(stderr).toBeFalsy();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Take html file piped to critical","suites":["CLI","acceptance"],"updatePoint":{"line":81,"column":42,"index":2611},"line":81,"code":"    test('Take html file piped to critical', async () => {\n      const {\n        stdout,\n        stderr\n      } = await pipe(path.normalize('fixtures/generate-default.html'), ['--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-default.css');\n      expect(stderr).toMatch('Not rebasing assets for');\n      expect(stderr.code).toBeUndefined();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Pipe html file inside a folder to critical","suites":["CLI","acceptance"],"updatePoint":{"line":91,"column":52,"index":3076},"line":91,"code":"    test('Pipe html file inside a folder to critical', async () => {\n      const {\n        stdout,\n        stderr\n      } = await pipe(path.normalize('fixtures/folder/generate-default.html'), ['--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-default.css');\n      expect(stderr).toMatch('Not rebasing assets for');\n      expect(stderr.code).toBeUndefined();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Inline images to piped html file","suites":["CLI","acceptance"],"updatePoint":{"line":101,"column":42,"index":3538},"line":101,"code":"    test('Inline images to piped html file', async () => {\n      const {\n        stdout,\n        stderr\n      } = await pipe(path.normalize('fixtures/generate-image.html'), ['-c', 'fixtures/styles/image-relative.css', '--inlineImages', '--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-image.css');\n      expect(stderr).toBeFalsy();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Add an absolute image path to critical css if we can't determine document location","suites":["CLI","acceptance"],"updatePoint":{"line":110,"column":92,"index":4035},"line":110,"code":"    test(\"Add an absolute image path to critical css if we can't determine document location\", async () => {\n      const {\n        stdout,\n        stderr\n      } = await pipe(path.normalize('fixtures/folder/generate-image.html'), ['-c', 'fixtures/styles/image-relative.css', '--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-image-absolute.css');\n      expect(stderr).toBeFalsy();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Add absolute image paths on piped html without relative links","suites":["CLI","acceptance"],"updatePoint":{"line":119,"column":71,"index":4509},"line":119,"code":"    test('Add absolute image paths on piped html without relative links', async () => {\n      const {\n        stdout,\n        stderr\n      } = await pipe(path.normalize('fixtures/folder/subfolder/generate-image-absolute.html'), ['--base', 'fixtures', '--width', '1300', '--height', '900']);\n      const expected = await read('expected/generate-image-absolute.css');\n      expect(stderr).toBeFalsy();\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Exit with code 1 and show help","suites":["CLI","acceptance"],"updatePoint":{"line":128,"column":40,"index":4927},"line":128,"code":"    test('Exit with code 1 and show help', async () => {\n      expect.assertions(2);\n      try {\n        await run(['fixtures/not-exists.html']);\n      } catch (error) {\n        expect(error.code).toBe(1);\n        expect(error.stderr).toMatch('Usage:');\n      }\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Generate multi-dimension critical-path CSS using cli","suites":["CLI","acceptance"],"updatePoint":{"line":137,"column":62,"index":5219},"line":137,"code":"    test('Generate multi-dimension critical-path CSS using cli', async () => {\n      const {\n        stdout\n      } = await pipe(path.normalize('fixtures/generate-adaptive.html'), ['--base', 'fixtures', '--dimensions', '100x70', '--dimensions', '1000x70']);\n      const expected = await read('expected/generate-adaptive.css', 'utf8');\n      expect(nn(stdout)).toBe(expected);\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"pass the correct opts when using short opts","suites":["CLI","mocked"],"updatePoint":{"line":154,"column":53,"index":5783},"line":154,"code":"    test('pass the correct opts when using short opts', async () => {\n      const args = await getArgs(['fixtures/generate-default.html', '-c', 'css', '-w', '300', '-h', '400', '-e', '-i']);\n      expect(args).toMatchObject({\n        width: 300,\n        height: 400,\n        css: ['css'],\n        inline: true,\n        extract: true\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"pass the correct opts when using long opts","suites":["CLI","mocked"],"updatePoint":{"line":164,"column":52,"index":6133},"line":164,"code":"    test('pass the correct opts when using long opts', async () => {\n      const args = await getArgs(['fixtures/generate-default.html', '--css', 'css', '--width', '300', '--height', '400', '--ignore', 'ignore', '--include', '/include/', '--inline', '--extract', '--inlineImages', '1024', '--assetPaths', 'assetPath1', '--assetPaths', 'assetPath2', '--dimensions', '1300x800', '--dimensions', '640x480', '--dimensions', '1x2,3x4,5x6']);\n      expect(args).toMatchObject({\n        width: 300,\n        height: 400,\n        css: ['css'],\n        inline: true,\n        extract: true,\n        dimensions: [{\n          width: 1300,\n          height: 800\n        }, {\n          width: 640,\n          height: 480\n        }, {\n          width: 1,\n          height: 2\n        }, {\n          width: 3,\n          height: 4\n        }, {\n          width: 5,\n          height: 6\n        }]\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Set inline to false when prefixed with --no","suites":["CLI","mocked"],"updatePoint":{"line":190,"column":53,"index":7027},"line":190,"code":"    test('Set inline to false when prefixed with --no', async () => {\n      const args = await getArgs(['fixtures/generate-default.html', '--no-inline']);\n      expect(args).toMatchObject({\n        inline: false\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Set penthouse options prefixed with --penthouse-","suites":["CLI","mocked"],"updatePoint":{"line":196,"column":58,"index":7262},"line":196,"code":"    test('Set penthouse options prefixed with --penthouse-', async () => {\n      const args = await getArgs(['fixtures/generate-default.html', '--penthouse-strict', '--penthouse-timeout', '50000', '--penthouse-renderWaitTime', '300']);\n      expect(args).toMatchObject({\n        penthouse: {\n          strict: true,\n          timeout: 50_000,\n          renderWaitTime: 300\n        }\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Set request options prefixed with --request-","suites":["CLI","mocked"],"updatePoint":{"line":206,"column":54,"index":7659},"line":206,"code":"    test('Set request options prefixed with --request-', async () => {\n      const args = await getArgs(['fixtures/generate-default.html', '--request-method', 'get', '--no-request-followRedirect']);\n      expect(args).toMatchObject({\n        request: {\n          method: 'get',\n          followRedirect: false\n        }\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Handle shell expanded the glob","suites":["CLI","mocked"],"updatePoint":{"line":215,"column":40,"index":7983},"line":215,"code":"    test('Handle shell expanded the glob', async () => {\n      // simulate system glob\n      const css = await globby('fixtures/**/*.css');\n      const args = await getArgs(['fixtures/generate-default.html', '-c', ...css, '--target', 'test.css']);\n      expect(args).toMatchObject({\n        css,\n        target: 'test.css',\n        src: 'fixtures/generate-default.html'\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Handle glob","suites":["CLI","mocked"],"updatePoint":{"line":225,"column":21,"index":8352},"line":225,"code":"    test('Handle glob', async () => {\n      // simulate system glob\n      const args = await getArgs(['fixtures/generate-default.html', '-c', 'fixtures/**/*.css', '--target', 'test.css']);\n      expect(args).toMatchObject({\n        css: ['fixtures/**/*.css'],\n        target: 'test.css',\n        src: 'fixtures/generate-default.html'\n      });\n    });","file":"cli.test.js","skipped":false,"dir":"test"},{"name":"Throws ConfigError on invalid config","suites":[],"updatePoint":{"line":3,"column":42,"index":147},"line":3,"code":"test('Throws ConfigError on invalid config', () => {\n  expect(() => {\n    getOptions({\n      invalidParam: true\n    });\n  }).toThrow(ConfigError);\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Throws ConfigError on missing param","suites":[],"updatePoint":{"line":10,"column":41,"index":297},"line":10,"code":"test('Throws ConfigError on missing param', () => {\n  expect(() => {\n    getOptions({});\n  }).toThrow(ConfigError);\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Throws ConfigError when html & src are both set","suites":[],"updatePoint":{"line":15,"column":53,"index":429},"line":15,"code":"test('Throws ConfigError when html & src are both set', () => {\n  expect(() => {\n    getOptions({\n      html: '...',\n      src: '...'\n    });\n  }).toThrow(ConfigError);\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Throws ConfigError on empty required value","suites":[],"updatePoint":{"line":23,"column":48,"index":597},"line":23,"code":"test('Throws ConfigError on empty required value', () => {\n  expect(() => {\n    getOptions({\n      src: ''\n    });\n  }).toThrow(ConfigError);\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Returns config object","suites":[],"updatePoint":{"line":30,"column":27,"index":722},"line":30,"code":"test('Returns config object', () => {\n  const config = getOptions({\n    src: '...'\n  });\n  expect(config).toMatchObject({\n    src: '...',\n    width: DEFAULT.width,\n    height: DEFAULT.height,\n    maxImageFileSize: DEFAULT.maxImageFileSize,\n    strict: DEFAULT.strict,\n    extract: DEFAULT.extract,\n    concurrency: DEFAULT.concurrency,\n    inlineImages: DEFAULT.inlineImages,\n    include: DEFAULT.include,\n    inline: DEFAULT.inline,\n    dimensions: [{\n      width: DEFAULT.width,\n      height: DEFAULT.height\n    }],\n    penthouse: {\n      forceInclude: DEFAULT.include,\n      timeout: DEFAULT.timeout,\n      maxEmbeddedBase64Length: DEFAULT.maxImageFileSize\n    }\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Target config on passed string","suites":[],"updatePoint":{"line":56,"column":36,"index":1407},"line":56,"code":"test('Target config on passed string', () => {\n  expect(getOptions({\n    src: '...',\n    target: 'test.css'\n  })).toHaveProperty('target', {\n    css: 'test.css'\n  });\n  expect(getOptions({\n    src: '...',\n    target: 'test.html'\n  })).toHaveProperty('target', {\n    html: 'test.html'\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Inline config on passed boolean","suites":[],"updatePoint":{"line":70,"column":37,"index":1702},"line":70,"code":"test('Inline config on passed boolean', () => {\n  expect(getOptions({\n    src: '...',\n    inline: true,\n    base: 'BASE'\n  })).toHaveProperty('inline', {\n    basePath: 'BASE',\n    strategy: 'media'\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Inline config on passed object","suites":[],"updatePoint":{"line":80,"column":36,"index":1909},"line":80,"code":"test('Inline config on passed object', () => {\n  expect(getOptions({\n    src: '...',\n    inline: {\n      check: true\n    },\n    base: 'BASE'\n  })).toHaveProperty('inline', {\n    basePath: 'BASE',\n    check: true\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Penthouse config on passed object","suites":[],"updatePoint":{"line":92,"column":39,"index":2134},"line":92,"code":"test('Penthouse config on passed object', () => {\n  expect(getOptions({\n    src: '...',\n    penthouse: {\n      check: true\n    }\n  })).toHaveProperty('penthouse', {\n    forceInclude: DEFAULT.include,\n    timeout: DEFAULT.timeout,\n    maxEmbeddedBase64Length: DEFAULT.maxImageFileSize,\n    check: true\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Ignore config on passed array","suites":[],"updatePoint":{"line":105,"column":35,"index":2441},"line":105,"code":"test('Ignore config on passed array', () => {\n  expect(getOptions({\n    src: '...',\n    ignore: ['@font-face']\n  })).toHaveProperty('ignore', {\n    atrule: ['@font-face'],\n    rule: ['@font-face'],\n    decl: ['@font-face']\n  });\n});","file":"config.test.js","skipped":false,"dir":"test"},{"name":"Generate critical-path CSS","suites":[],"updatePoint":{"line":37,"column":32,"index":1087},"line":37,"code":"test('Generate critical-path CSS', async () => {\n  const css = read('expected/generate-default.css');\n  const html = read('fixtures/generate-default.html');\n  try {\n    const result = await create({\n      src: `http://localhost:${port}/generate-default.html`\n    });\n    expect(result.css).toBe(css);\n    expect(result.html).toBe(html);\n  } catch (error) {\n    expect(error).toBe(undefined);\n  }\n});","file":"core.test.js","skipped":false,"dir":"test"},{"name":"checkCssOption","suites":[],"updatePoint":{"line":44,"column":20,"index":1583},"line":44,"code":"test('checkCssOption', () => {\n  expect(checkCssOption(undefined)).toEqual(false);\n  expect(checkCssOption('')).toEqual(false);\n  expect(checkCssOption(false)).toEqual(false);\n  expect(checkCssOption([])).toEqual(false);\n  expect(checkCssOption(['abc'])).toEqual(true);\n  expect(checkCssOption('abc')).toEqual(true);\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Normalize paths","suites":[],"updatePoint":{"line":52,"column":21,"index":1905},"line":52,"code":"test('Normalize paths', () => {\n  const plattform = process.platform;\n  Object.defineProperty(process, 'platform', {\n    value: 'win32'\n  });\n  expect(normalizePath('foo\\\\bar')).toBe('foo/bar');\n  expect(normalizePath('C:\\\\images\\\\critical.png')).toBe('/images/critical.png');\n  expect(normalizePath(`http://localhost:${port}/styles/main.css`)).toBe(`http://localhost:${port}/styles/main.css`);\n  Object.defineProperty(process, 'platform', {\n    value: plattform\n  });\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Remote file detection","suites":[],"updatePoint":{"line":64,"column":27,"index":2384},"line":64,"code":"test('Remote file detection', () => {\n  const local = ['../test/foo.html', '/usr/tmp/bar'];\n  const remote = ['https://test.io/', '//test.io/styles/main.css'];\n  local.forEach(p => expect(isRemote(p)).toBe(false));\n  remote.forEach(p => expect(isRemote(p)).toBe(true));\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Error for file not found","suites":[],"updatePoint":{"line":70,"column":30,"index":2661},"line":70,"code":"test('Error for file not found', () => {\n  expect(vinylize({\n    filenpath: 'non-existant-file.html'\n  })).rejects.toThrow(FileNotFoundError);\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"fileExists","suites":[],"updatePoint":{"line":75,"column":16,"index":2794},"line":75,"code":"test('fileExists', async () => {\n  const tests = [{\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/head.html'),\n    expected: true\n  }, {\n    filepath: path.join(__dirname, 'fixtures/not-available'),\n    expected: false\n  }, {\n    filepath: `http://localhost:${port}/head.html`,\n    expected: true\n  }, {\n    filepath: `http://localhost:${port}/styles/main.css`,\n    expected: true\n  }, {\n    filepath: `http://localhost:${port}/styles/nope.css`,\n    expected: false\n  }];\n  expect.assertions(tests.length);\n  for (const {\n    filepath,\n    expected\n  } of tests) {\n    const result = await fileExists(filepath);\n    expect(result).toBe(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"joinPath","suites":[],"updatePoint":{"line":101,"column":14,"index":3463},"line":101,"code":"test('joinPath', () => {\n  const tests = [{\n    base: '/folder/subfolder/head',\n    part: 'test.html',\n    expected: '/folder/subfolder/head/test.html'\n  }, {\n    base: '/folder/subfolder/head',\n    part: '../../test.html',\n    expected: '/folder/test.html'\n  }, {\n    base: `http://localhost:${port}`,\n    part: '../../test.html',\n    expected: `http://localhost:${port}/test.html`\n  }, {\n    base: `http://localhost:${port}/a/b/c`,\n    part: '../../test.html',\n    expected: `http://localhost:${port}/test.html`\n  }, {\n    base: `http://localhost:${port}/a/b/c/d.html`,\n    part: 'test.html',\n    expected: `http://localhost:${port}/a/b/c/test.html`\n  }, {\n    base: `http://localhost:${port}/a/b/c/d.html`,\n    part: '../test.html',\n    expected: `http://localhost:${port}/a/b/test.html`\n  }];\n  expect.assertions(tests.length);\n  for (const {\n    base,\n    part,\n    expected\n  } of tests) {\n    const result = joinPath(base, part);\n    expect(normalizePath(result)).toBe(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"resolve","suites":[],"updatePoint":{"line":137,"column":13,"index":4457},"line":137,"code":"test('resolve', async () => {\n  const tests = [{\n    filepath: '/folder/subfolder/head.html',\n    paths: [__dirname, path.join(__dirname, 'fixtures'), `http://localhost:${port}`],\n    expected: path.join(__dirname, 'fixtures/folder/subfolder/head.html')\n  }, {\n    filepath: '/folder/subfolder/head.html',\n    paths: [__dirname, `http://localhost:${port}`, path.join(__dirname, 'fixtures/folder/subfolder/head.html')],\n    expected: `http://localhost:${port}/folder/subfolder/head.html`\n  }, {\n    filepath: '../styles/main.css',\n    paths: [__dirname, `http://localhost:${port}`, `http://localhost:${port}/folder/`, path.join(__dirname, 'fixtures/folder/subfolder/head.html')],\n    expected: `http://localhost:${port}/styles/main.css`\n  }];\n  expect.assertions(tests.length);\n  for (const {\n    filepath,\n    paths,\n    expected\n  } of tests) {\n    const result = await resolve(filepath, paths);\n    expect(result).toBe(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"resolve error","suites":[],"updatePoint":{"line":161,"column":19,"index":5403},"line":161,"code":"test('resolve error', () => {\n  const paths = [__dirname, `http://localhost:${port}`];\n  expect(resolve('non-existant-file.html', paths)).rejects.toThrow(FileNotFoundError);\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Vinylize local file","suites":[],"updatePoint":{"line":165,"column":25,"index":5587},"line":165,"code":"test('Vinylize local file', async () => {\n  const files = [path.join(__dirname, 'fixtures/folder/subfolder/head.html'), path.join(__dirname, 'fixtures/head.html')];\n  const contents = await Promise.all(files.map(f => readFileAsync(f)));\n  const result = await Promise.all(files.map(filepath => vinylize({\n    filepath\n  })));\n  expect.hasAssertions();\n  expect(result.length).toBe(files.length);\n  for (const [i, element] of result.entries()) {\n    expect(element.path).toBe(files[i]);\n    expect(element.remote).toBe(false);\n    expect(element.url).toBe(undefined);\n    expect(element.urlObj).toBe(undefined);\n    expect(element.contents.toString()).toBe(contents[i].toString());\n  }\n  return true;\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Vinylize remote file","suites":[],"updatePoint":{"line":182,"column":26,"index":6292},"line":182,"code":"test('Vinylize remote file', async () => {\n  const files = ['fixtures/folder/subfolder/head.html', 'fixtures/head.html', 'fixtures/styles/main.css', 'fixtures/images/critical.png'];\n  const contents = await Promise.all(files.map(f => readFileAsync(path.join(__dirname, f))));\n  const urls = files.map(f => f.replace(/^fixtures/, `http://localhost:${port}`));\n  const result = await Promise.all(urls.map(filepath => vinylize({\n    filepath\n  })));\n\n  // expect.assertions(files.length * 4 + 1);\n  expect(result.length).toBe(files.length);\n  for (const [i, element] of result.entries()) {\n    expect(element.remote).toBe(true);\n    expect(element.url).toBe(urls[i]);\n    expect(element.urlObj).toEqual(urlParse(urls[i]));\n    expect(element.contents.toString()).toBe(contents[i].toString());\n  }\n  expect.hasAssertions();\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Append stylesheets to vinyl","suites":[],"updatePoint":{"line":200,"column":33,"index":7123},"line":200,"code":"test('Append stylesheets to vinyl', async () => {\n  const files = ['fixtures/folder/subfolder/head.html', 'fixtures/folder/generate-default.html', 'fixtures/head.html', 'fixtures/styles/main.css', 'fixtures/images/critical.png'];\n  const vinyls = await Promise.all(files.map(f => vinylize({\n    filepath: path.join(__dirname, f)\n  })));\n  const result = vinyls.map(v => getStylesheetHrefs(v));\n  expect.assertions(files.length + 6);\n  expect(result.length).toBe(5);\n  result.forEach(stylesheets => expect(Array.isArray(stylesheets)).toBeTruthy());\n  expect(result[0].length).toBe(1);\n  expect(result[1].length).toBe(2);\n  expect(result[2].length).toBe(2);\n  expect(result[3].length).toBe(0);\n  expect(result[4].length).toBe(0);\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Append assets to vinyl","suites":[],"updatePoint":{"line":215,"column":28,"index":7850},"line":215,"code":"test('Append assets to vinyl', async () => {\n  const files = ['fixtures/folder/subfolder/head.html', 'fixtures/head.html', 'fixtures/styles/bootstrap.css', 'fixtures/styles/image-relative.css', 'fixtures/images/critical.png'];\n  const vinyls = await Promise.all(files.map(f => vinylize({\n    filepath: path.join(__dirname, f)\n  })));\n  const result = vinyls.map(v => getAssets(v));\n  expect.assertions(files.length + 6);\n  expect(result.length).toBe(5);\n  result.forEach(assets => expect(Array.isArray(assets)).toBeTruthy());\n  expect(result[0].length).toBe(0);\n  expect(result[1].length).toBe(0);\n  expect(result[2].length).toBe(5);\n  expect(result[3].length).toBe(1);\n  expect(result[4].length).toBe(0);\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Compute document base (with base option)","suites":[],"updatePoint":{"line":230,"column":46,"index":8578},"line":230,"code":"test('Compute document base (with base option)', async () => {\n  const vinyls = await Promise.all([{\n    filepath: `http://localhost:${port}/folder/generate-default.html`,\n    expected: '/folder'\n  }, {\n    filepath: `http://localhost:${port}/folder/head.html`,\n    expected: '/folder'\n  }, {\n    filepath: `http://localhost:${port}/generate-default.html`,\n    expected: '/'\n  }, {\n    filepath: `http://localhost:${port}/folder`,\n    expected: '/'\n  }, {\n    filepath: `http://localhost:${port}/folder/`,\n    expected: '/folder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/head.html'),\n    expected: '/folder/subfolder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/generate-default.html'),\n    expected: '/folder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/head.html'),\n    expected: '/'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/relative.html'),\n    expected: '/folder/subfolder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/relative.html'),\n    expected: '/folder'\n  }].map(f => vinylize(f).then(vinyl => ({\n    ...f,\n    vinyl\n  }))));\n  const files = vinyls.map(data => {\n    data.vinyl.stylesheets = getStylesheetHrefs(data.vinyl);\n    return data;\n  });\n  expect.hasAssertions();\n  for (const file of files) {\n    const filepath = await getDocumentPath(file.vinyl, {\n      base: path.join(__dirname, 'fixtures')\n    });\n    expect(path.dirname(filepath)).toBe(file.expected);\n  }\n  expect(stderr).not.toHaveBeenCalled();\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Compute document base (without base option)","suites":[],"updatePoint":{"line":278,"column":49,"index":10102},"line":278,"code":"test('Compute document base (without base option)', async () => {\n  const vinyls = await Promise.all([{\n    filepath: `http://localhost:${port}/folder`,\n    expected: '/'\n  }, {\n    filepath: `http://localhost:${port}/folder/`,\n    expected: '/folder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/head.html'),\n    expected: '/folder/subfolder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/generate-default.html'),\n    expected: '/folder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/head.html'),\n    expected: '/'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/relative.html'),\n    expected: '/folder/subfolder'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/relative.html'),\n    expected: '/folder'\n  }].map(f => vinylize(f).then(vinyl => ({\n    ...f,\n    vinyl\n  }))));\n  const files = vinyls.map(data => {\n    data.vinyl.stylesheets = getStylesheetHrefs(data.vinyl);\n    return data;\n  });\n  expect.hasAssertions();\n  for (const file of files) {\n    const filepath = await getDocumentPath(file.vinyl);\n    expect(path.dirname(filepath)).toBe(file.expected);\n    if (file.noBase) {\n      expect(stderr).toHaveBeenCalledWith(BASE_WARNING);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get document","suites":[],"updatePoint":{"line":317,"column":18,"index":11305},"line":317,"code":"test('Get document', async () => {\n  const file = path.join(__dirname, 'fixtures/folder/relative.html');\n  const vinyl = new Vinyl({\n    path: file,\n    contents: Buffer.from(read(file))\n  });\n  const tests = [{\n    filepath: `http://localhost:${port}/folder`,\n    expected: '/folder'\n  }, {\n    filepath: `http://localhost:${port}/folder/`,\n    expected: '/folder/index.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/head.html'),\n    expected: '/folder/subfolder/head.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/generate-default.html'),\n    expected: '/folder/generate-default.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/head.html'),\n    expected: '/head.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/relative.html'),\n    expected: '/folder/subfolder/relative.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/relative.html'),\n    expected: '/folder/relative.html'\n  }, {\n    filepath: 'folder/relative.html',\n    options: {\n      base: path.join(__dirname, 'fixtures')\n    },\n    expected: '/folder/relative.html'\n  }, {\n    filepath: vinyl,\n    options: {\n      base: path.join(__dirname, 'fixtures')\n    },\n    expected: '/folder/relative.html'\n  }];\n  expect.hasAssertions();\n  for (const testdata of tests) {\n    const {\n      filepath,\n      expected,\n      options\n    } = testdata;\n    const file = await getDocument(filepath, options);\n    expect(file.virtualPath).toBe(expected);\n    if (testdata.noBase) {\n      expect(stderr).toHaveBeenCalledWith(BASE_WARNING);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get document from source with rebase option","suites":[],"updatePoint":{"line":371,"column":49,"index":12932},"line":371,"code":"test('Get document from source with rebase option', async () => {\n  const base = path.join(__dirname, 'fixtures');\n  const tests = [{\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/head.html'),\n    expected: '/folder/subfolder/head.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/generate-default.html'),\n    expected: '/folder/generate-default.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/head.html'),\n    expected: '/head.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/subfolder/relative.html'),\n    expected: '/folder/subfolder/relative.html'\n  }, {\n    filepath: path.join(__dirname, 'fixtures/folder/relative.html'),\n    expected: '/folder/relative.html'\n  }];\n\n  // expect.assertions(tests.length + 1);\n  for (const testdata of tests) {\n    const {\n      filepath,\n      expected\n    } = testdata;\n    const rebase = {\n      to: `/${normalizePath(path.relative(base, filepath))}`\n    };\n    const source = await readFileAsync(filepath);\n    const file = await getDocumentFromSource(source, {\n      rebase,\n      base\n    });\n    expect(file.virtualPath).toBe(expected);\n  }\n  expect(stderr).not.toHaveBeenCalled();\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get document from source without path options","suites":[],"updatePoint":{"line":408,"column":51,"index":14122},"line":408,"code":"test('Get document from source without path options', async () => {\n  const filepath = path.join(__dirname, 'fixtures/folder/subfolder/head.html');\n  const source = await readFileAsync(filepath);\n  const css = path.join(__dirname, 'fixtures/styles/image-relative.css');\n  const file = await getDocumentFromSource(source, {\n    css\n  });\n  const styles = await readFileAsync(css, 'utf8');\n\n  // expect(file.path).toBe(undefined);\n  expect(file.css).toMatch(styles);\n  expect(stderr).toHaveBeenCalled();\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Compute base for stylesheets","suites":[],"updatePoint":{"line":421,"column":34,"index":14611},"line":421,"code":"test('Compute base for stylesheets', async () => {\n  const docs = await mapAsync([`http://localhost:${port}/generate-image.html`, path.join(__dirname, 'fixtures/folder/generate-image.html'), `http://localhost:${port}/folder/relative-different.html`, path.join(__dirname, 'fixtures/relative-different.html'), path.join(__dirname, 'fixtures/remote-different.html')], async filepath => {\n    const document = await vinylize({\n      filepath\n    });\n    document.stylesheets = await getStylesheetHrefs(document);\n    document.virtualPath = await getDocumentPath(document);\n    return document;\n  });\n  const tests = [{\n    filepath: `http://localhost:${port}/styles/image-relative.css`,\n    expected: ['/styles/image-relative.css', `http://localhost:${port}/styles/image-relative.css`, `/styles/image-relative.css`, `http://localhost:${port}/styles/image-relative.css`, `http://localhost:${port}/styles/image-relative.css`]\n  }, {\n    filepath: `http://127.0.0.1:${port}/styles/image-relative.css`,\n    expected: [`http://127.0.0.1:${port}/styles/image-relative.css`, `http://127.0.0.1:${port}/styles/image-relative.css`, `http://127.0.0.1:${port}/styles/image-relative.css`, `http://127.0.0.1:${port}/styles/image-relative.css`, `http://127.0.0.1:${port}/styles/image-relative.css`]\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    expected: ['/styles/image-relative.css', '/styles/image-relative.css', '/folder/styles/image-relative.css', '/styles/image-relative.css', 'http://www.cdn.somewhere/styles/image-relative.css']\n  }];\n  expect.assertions(docs.length * tests.length);\n  for (const [index, document] of docs.entries()) {\n    for (const testdata of tests) {\n      const {\n        filepath,\n        expected\n      } = testdata;\n      const file = await vinylize({\n        filepath\n      });\n      const result = await getStylesheetPath(document, file);\n      expect(result).toBe(expected[index]);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get styles","suites":[],"updatePoint":{"line":455,"column":16,"index":16545},"line":455,"code":"test('Get styles', async () => {\n  const docs = await mapAsync([`http://localhost:${port}/generate-image.html`, path.join(__dirname, 'fixtures/folder/generate-image.html')], filepath => getDocument(filepath));\n  const tests = [{\n    filepath: `http://localhost:${port}/styles/image-relative.css`,\n    expected: ['images/critical.png', `http://localhost:${port}/images/critical.png`]\n  }, {\n    filepath: `http://localhost:${port}/folder/subfolder/issue-216.css`,\n    expected: [`folder/fonts/fontawesome-webfont.woff`, `http://localhost:${port}/folder/fonts/fontawesome-webfont.woff`]\n  }, {\n    filepath: `http://127.0.0.1:${port}/styles/image-relative.css`,\n    expected: [`http://127.0.0.1:${port}/images/critical.png`, `http://127.0.0.1:${port}/images/critical.png`]\n  }, {\n    filepath: `http://127.0.0.1:${port}/folder/subfolder/issue-216.css`,\n    expected: [`http://127.0.0.1:${port}/folder/fonts/fontawesome-webfont.woff`, `http://127.0.0.1:${port}/folder/fonts/fontawesome-webfont.woff`]\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    expected: ['images/critical.png', '../images/critical.png']\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    options: {\n      rebase: {\n        from: '/styles/main.css',\n        to: '/index.html'\n      }\n    },\n    expected: ['images/critical.png', 'images/critical.png']\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    options: {\n      rebase: {\n        from: '/styles/main.css',\n        to: '/a/b/c/index.html'\n      }\n    },\n    expected: ['../../../images/critical.png', '../../../images/critical.png']\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    options: {\n      rebase: asset => `https://my-cdn.com${asset.absolutePath}`\n    },\n    expected: ['https://my-cdn.com/images/critical.png', 'https://my-cdn.com/images/critical.png']\n  }];\n  for (const [index, document] of docs.entries()) {\n    for (const testdata of tests) {\n      const {\n        filepath,\n        expected,\n        options = {}\n      } = testdata;\n      const file = await getStylesheet(document, filepath, {\n        base: path.join(__dirname, 'fixtures'),\n        ...options\n      });\n      expect(file.contents.toString()).toMatch(expected[index]);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get inline styles","suites":[],"updatePoint":{"line":512,"column":23,"index":18884},"line":512,"code":"test('Get inline styles', async () => {\n  const docs = await mapAsync([`http://localhost:${port}/generate-adaptive.html`, `http://localhost:${port}/generate-adaptive-inline.html`, path.join(__dirname, 'fixtures/generate-adaptive-inline.html')], filepath => getDocument(filepath));\n  const [expected, ...cssArray] = docs.map(doc => strip(doc.css));\n  for (const css of cssArray) {\n    expect(css).toMatch(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get styles with media attribute","suites":[],"updatePoint":{"line":519,"column":37,"index":19321},"line":519,"code":"test('Get styles with media attribute', async () => {\n  const docs = await mapAsync([`http://localhost:${port}/media-attr.html`, path.join(__dirname, 'fixtures/media-attr.html')], filepath => getDocument(filepath));\n  const expected = `@media (max-width: 1024px) { .header {\n    display: flex;\n} }`;\n  for (const document of docs) {\n    expect(document.css.toString()).toMatch(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get base64 styles","suites":[],"updatePoint":{"line":528,"column":23,"index":19703},"line":528,"code":"test('Get base64 styles', async () => {\n  const docs = await mapAsync([`http://localhost:${port}/generate-adaptive.html`, `http://localhost:${port}/generate-adaptive-base64.html`, path.join(__dirname, 'fixtures/generate-adaptive-base64.html')], filepath => getDocument(filepath));\n  const [expected, ...cssArray] = docs.map(doc => strip(doc.css));\n  for (const css of cssArray) {\n    expect(css).toMatch(expected);\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Get styles (without path)","suites":[],"updatePoint":{"line":535,"column":31,"index":20134},"line":535,"code":"test('Get styles (without path)', async () => {\n  const docs = await mapAsync([path.join(__dirname, 'fixtures/folder/generate-image.html'), path.join(__dirname, 'fixtures/relative-different.html'), path.join(__dirname, 'fixtures/remote-different.html')], file => readFileAsync(file));\n  const tests = [{\n    filepath: `http://localhost:${port}/styles/image-relative.css`,\n    expected: [`http://localhost:${port}/images/critical.png`, `http://localhost:${port}/images/critical.png`, `http://localhost:${port}/images/critical.png`]\n  }, {\n    filepath: `http://127.0.0.1:${port}/styles/image-relative.css`,\n    expected: [`http://127.0.0.1:${port}/images/critical.png`, `http://127.0.0.1:${port}/images/critical.png`, `http://127.0.0.1:${port}/images/critical.png`]\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    expected: [`'/images/critical.png'`, `'/images/critical.png'`, `'/images/critical.png'`]\n  }];\n  for (const [index, element] of docs.entries()) {\n    for (const testdata of tests) {\n      const {\n        filepath,\n        expected\n      } = testdata;\n      const document = await getDocumentFromSource(element, {\n        css: filepath\n      });\n      const file = await getStylesheet(document, filepath, {\n        base: path.join(__dirname, 'fixtures')\n      });\n      expect(file.contents.toString()).toMatch(expected[index]);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Does not rebase when rebase is disabled via option","suites":[],"updatePoint":{"line":563,"column":56,"index":21551},"line":563,"code":"test('Does not rebase when rebase is disabled via option', async () => {\n  const docs = await mapAsync([path.join(__dirname, 'fixtures/folder/generate-image.html'), path.join(__dirname, 'fixtures/relative-different.html'), path.join(__dirname, 'fixtures/remote-different.html')], file => readFileAsync(file));\n  const tests = [{\n    filepath: `http://localhost:${port}/styles/image-relative.css`,\n    expected: [`'../images/critical.png'`, `'../images/critical.png'`, `'../images/critical.png'`]\n  }, {\n    filepath: `http://127.0.0.1:${port}/styles/image-relative.css`,\n    expected: [`'../images/critical.png'`, `'../images/critical.png'`, `'../images/critical.png'`]\n  }, {\n    filepath: path.join(__dirname, 'fixtures/styles/image-relative.css'),\n    expected: [`'../images/critical.png'`, `'../images/critical.png'`, `'../images/critical.png'`]\n  }];\n  for (const [index, element] of docs.entries()) {\n    for (const testdata of tests) {\n      const {\n        filepath,\n        expected\n      } = testdata;\n      const document = await getDocumentFromSource(element, {\n        css: filepath\n      });\n      const file = await getStylesheet(document, filepath, {\n        base: path.join(__dirname, 'fixtures'),\n        rebase: false\n      });\n      expect(file.contents.toString()).toMatch(expected[index]);\n    }\n  }\n});","file":"file.test.js","skipped":false,"dir":"test"},{"name":"Handle errors with passed callback method","suites":[],"updatePoint":{"line":26,"column":47,"index":972},"line":26,"code":"test('Handle errors with passed callback method', done => {\n  const tmp = generate({}, (error, data) => {\n    expect(data).toBeFalsy();\n    expect(error).toBeInstanceOf(Error);\n    done();\n  });\n  expect(tmp).resolves.toBeUndefined();\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Call callback function with object containing html, css and uncritical props","suites":[],"updatePoint":{"line":34,"column":82,"index":1246},"line":34,"code":"test('Call callback function with object containing html, css and uncritical props', done => {\n  generate({\n    src: path.join(__dirname, 'fixtures/generate-default.html')\n  }, (error, data) => {\n    expect(error).toBeFalsy();\n    expect(data).toHaveProperty('css');\n    expect(data).toHaveProperty('html');\n    expect(data).toHaveProperty('uncritical');\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Write css target","suites":[],"updatePoint":{"line":45,"column":22,"index":1563},"line":45,"code":"test('Write css target', async () => {\n  const data = await generate({\n    src: path.join(__dirname, 'fixtures/generate-default.html'),\n    target: '.test.css'\n  });\n  expect(data).toHaveProperty('css');\n  expect(data).toHaveProperty('html');\n  expect(fs.existsSync('.test.css')).toBeTruthy();\n  const content = readAndRemove('.test.css');\n  expect(content).toBe(data.css);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Write html target","suites":[],"updatePoint":{"line":56,"column":23,"index":1942},"line":56,"code":"test('Write html target', async () => {\n  const data = await generate({\n    src: path.join(__dirname, 'fixtures/generate-default.html'),\n    target: '.test.html'\n  });\n  expect(data).toHaveProperty('css');\n  expect(data).toHaveProperty('html');\n  expect(fs.existsSync('.test.html')).toBeTruthy();\n  const content = readAndRemove('.test.html');\n  expect(content).toBe(data.html);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Write all targets","suites":[],"updatePoint":{"line":67,"column":23,"index":2325},"line":67,"code":"test('Write all targets', async () => {\n  const data = await generate({\n    src: path.join(__dirname, 'fixtures/generate-default.html'),\n    target: {\n      html: '.test.html',\n      css: '.test.css',\n      uncritical: '.uncritical.css'\n    }\n  });\n  expect(data).toHaveProperty('css');\n  expect(data).toHaveProperty('html');\n  expect(fs.existsSync('.test.css')).toBeTruthy();\n  expect(fs.existsSync('.uncritical.css')).toBeTruthy();\n  expect(fs.existsSync('.test.html')).toBeTruthy();\n  const html = readAndRemove('.test.html');\n  const css = readAndRemove('.test.css');\n  readAndRemove('.uncritical.css');\n  expect(html).toBe(data.html);\n  expect(css).toBe(data.css);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Write all targets relative to base","suites":[],"updatePoint":{"line":87,"column":40,"index":3016},"line":87,"code":"test('Write all targets relative to base', async () => {\n  const base = temporaryDirectory();\n  const getFile = f => path.join(base, f);\n  const data = await generate({\n    base,\n    src: path.join(__dirname, 'fixtures/generate-default.html'),\n    target: {\n      html: '.test.html',\n      css: '.test.css',\n      uncritical: '.uncritical.css'\n    }\n  });\n  expect(data).toHaveProperty('css');\n  expect(data).toHaveProperty('html');\n  expect(data).toHaveProperty('uncritical');\n  expect(fs.existsSync(getFile('.test.css'))).toBeTruthy();\n  expect(fs.existsSync(getFile('.uncritical.css'))).toBeTruthy();\n  expect(fs.existsSync(getFile('.test.html'))).toBeTruthy();\n  const html = readAndRemove(getFile('.test.html'));\n  const css = readAndRemove(getFile('.test.css'));\n  const uncritical = readAndRemove(getFile('.uncritical.css'));\n  expect(uncritical).toBe(data.uncritical);\n  expect(html).toBe(data.html);\n  expect(css).toBe(data.css);\n  try {\n    await unlinkAsync(base);\n  } catch {\n    // file not  there\n  }\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Write all targets respecting absolute paths","suites":[],"updatePoint":{"line":117,"column":49,"index":4044},"line":117,"code":"test('Write all targets respecting absolute paths', async () => {\n  const base = temporaryDirectory();\n  const fileBase = temporaryDirectory();\n  const getFile = f => path.join(fileBase, f);\n  const data = await generate({\n    base,\n    src: path.join(__dirname, 'fixtures/generate-default.html'),\n    target: {\n      html: getFile('.test.html'),\n      css: getFile('.test.css'),\n      uncritical: getFile('.uncritical.css')\n    }\n  });\n  expect(data).toHaveProperty('css');\n  expect(data).toHaveProperty('html');\n  expect(data).toHaveProperty('uncritical');\n  expect(fs.existsSync(getFile('.test.css'))).toBeTruthy();\n  expect(fs.existsSync(getFile('.uncritical.css'))).toBeTruthy();\n  expect(fs.existsSync(getFile('.test.html'))).toBeTruthy();\n  const html = readAndRemove(getFile('.test.html'));\n  const css = readAndRemove(getFile('.test.css'));\n  const uncritical = readAndRemove(getFile('.uncritical.css'));\n  expect(uncritical).toBe(data.uncritical);\n  expect(html).toBe(data.html);\n  expect(css).toBe(data.css);\n  try {\n    await unlinkAsync(base);\n    await unlinkAsync(fileBase);\n  } catch {\n    // file already deleted\n  }\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Reject with ConfigError on invalid config","suites":[],"updatePoint":{"line":149,"column":47,"index":5180},"line":149,"code":"test('Reject with ConfigError on invalid config', () => {\n  expect(generate({})).rejects.toThrow(ConfigError);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Throws FileNotFound error on missing file","suites":[],"updatePoint":{"line":152,"column":47,"index":5295},"line":152,"code":"test('Throws FileNotFound error on missing file', () => {\n  expect(generate({\n    src: 'not-found.html'\n  })).rejects.toThrow(FileNotFoundError);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Throws NoCssError error on empty styles in strict mode","suites":[],"updatePoint":{"line":157,"column":60,"index":5458},"line":157,"code":"test('Throws NoCssError error on empty styles in strict mode', () => {\n  expect(generate({\n    src: path.join(__dirname, 'fixtures/error.html'),\n    strict: true\n  })).rejects.toThrow(NoCssError);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Emit error on streamed file","suites":[],"updatePoint":{"line":163,"column":33,"index":5632},"line":163,"code":"test('Emit error on streamed file', done => {\n  const critical = stream({\n    base: path.join(__dirname, 'fixtures')\n  });\n  const fakeFilePath = path.join(__dirname, 'fixtures', 'generate-default.html');\n  expect.hasAssertions();\n  fs.createReadStream(fakeFilePath).pipe(vinylStream()).pipe(critical).on('data', () => done.fail(new Error('Should not emit data'))).on('error', ({\n    message\n  }) => {\n    expect(message).toBe('Streaming not supported');\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Throws PluginError on critical.stream error","suites":[],"updatePoint":{"line":176,"column":49,"index":6125},"line":176,"code":"test('Throws PluginError on critical.stream error', done => {\n  const critical = stream({\n    invalidOption: true\n  });\n  getVinyl('error.html').pipe(critical).on('data', () => done.fail(new Error('Should not emit data'))).on('error', error => {\n    expect(error).toBeInstanceOf(PluginError);\n    expect(error.plugin).toBe('critical');\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Support vinyl buffer streams and return critical css vinyl","suites":[],"updatePoint":{"line":186,"column":64,"index":6498},"line":186,"code":"test('Support vinyl buffer streams and return critical css vinyl', done => {\n  const critical = stream({\n    base: path.join(__dirname, 'fixtures')\n  });\n  getVinyl('generate-default.html').pipe(critical).on('data', data => {\n    expect(data).toBeTruthy();\n    expect(data).toBeInstanceOf(Vinyl);\n    expect(data.path).toMatch(/\\.css/);\n    done();\n  }).on('error', () => {\n    done.fail(new Error('Should not emit error'));\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Support vinyl buffer streams and returns html vinyl with inlined css","suites":[],"updatePoint":{"line":200,"column":74,"index":6955},"line":200,"code":"test('Support vinyl buffer streams and returns html vinyl with inlined css', done => {\n  const critical = stream({\n    base: path.join(__dirname, 'fixtures'),\n    inline: true\n  });\n  getVinyl('generate-default.html').pipe(critical).on('data', data => {\n    expect(data).toBeTruthy();\n    expect(data).toBeInstanceOf(Vinyl);\n    expect(data.path).toMatch(/\\.html/);\n    expect(data.contents.toString()).toMatch(/<style>/);\n    done();\n  }).on('error', () => {\n    done.fail(new Error('Should not emit error'));\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Return empty vinyl on empty vinyl","suites":[],"updatePoint":{"line":216,"column":39,"index":7453},"line":216,"code":"test('Return empty vinyl on empty vinyl', done => {\n  const critical = stream({\n    base: path.join(__dirname, 'fixtures')\n  });\n  getVinyl(false).pipe(critical).on('data', data => {\n    expect(data).toBeTruthy();\n    expect(data).toBeInstanceOf(Vinyl);\n    expect(data.isNull).toBeTruthy();\n    done();\n  }).on('error', () => {\n    done.fail(new Error('Should not emit error'));\n    done();\n  });\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"#192 - include option - stream","suites":[],"updatePoint":{"line":230,"column":36,"index":7852},"line":230,"code":"test('#192 - include option - stream', done => {\n  const critical = stream({\n    base: path.join(__dirname, 'fixtures'),\n    css: ['fixtures/styles/issue-192.css'],\n    extract: false,\n    ignore: ['@font-face', /url\\(/],\n    dimensions: [{\n      width: 320,\n      height: 480\n    }, {\n      width: 768,\n      height: 1024\n    }, {\n      width: 1280,\n      height: 960\n    }, {\n      width: 1920,\n      height: 1080\n    }],\n    include: [/^\\.main-navigation.*$/, /^\\.hero-deck.*$/, /^\\.deck.*$/, /^\\.search-box.*$/],\n    width: 1300,\n    height: 900\n  });\n  const expected = read('expected/issue-192.css');\n  getVinyl('issue-192.html').pipe(critical).pipe(streamAssert.length(1)).pipe(streamAssert.nth(0, d => {\n    expect(path.extname(d.path)).toBe('.css');\n    expect(nn(d.contents.toString('utf8'))).toBe(expected);\n  })).pipe(streamAssert.end(done));\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"should generate multi-dimension critical-path CSS in stream mode","suites":[],"updatePoint":{"line":259,"column":70,"index":8745},"line":259,"code":"test('should generate multi-dimension critical-path CSS in stream mode', done => {\n  const expected = read('expected/generate-adaptive.css', 'utf8');\n  const critical = stream({\n    base: 'fixtures/',\n    dimensions: [{\n      width: 100,\n      height: 70\n    }, {\n      width: 1000,\n      height: 70\n    }]\n  });\n  getVinyl('generate-adaptive.html').pipe(critical).pipe(streamAssert.length(1)).pipe(streamAssert.nth(0, d => {\n    expect(path.extname(d.path)).toBe('.css');\n    expect(nn(d.contents.toString('utf8'))).toBe(expected);\n  })).pipe(streamAssert.end(done));\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"issue 341","suites":[],"updatePoint":{"line":276,"column":15,"index":9263},"line":276,"code":"test('issue 341', async () => {\n  const expected = [];\n  const sources = [read('fixtures/generate-adaptive.html', 'utf8'), read('fixtures/generate-default.html', 'utf8'), read('fixtures/generate-image.html', 'utf8')];\n  const options = {\n    base: path.join(__dirname, 'fixtures'),\n    extract: false,\n    inline: false,\n    dimensions: [{\n      width: 100,\n      height: 70\n    }, {\n      width: 1000,\n      height: 70\n    }]\n  };\n\n  // first await all results regularly\n  expected[0] = await generate({\n    ...options,\n    html: sources[0]\n  });\n  expected[1] = await generate({\n    ...options,\n    html: sources[1]\n  });\n  expected[2] = await generate({\n    ...options,\n    html: sources[2]\n  });\n\n  // limit concurrency and run all processes in parallel\n  const promises = sources.map(html => generate({\n    ...options,\n    html,\n    concurrency: 2\n  }));\n  const results = await Promise.all(promises);\n  expect(results[0].css).toBe(expected[0].css);\n  expect(results[1].css).toBe(expected[1].css);\n  expect(results[2].css).toBe(expected[2].css);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Replace stylesheet on extract-target","suites":[],"updatePoint":{"line":317,"column":42,"index":10345},"line":317,"code":"test('Replace stylesheet on extract-target', async () => {\n  const target = path.join(__dirname, 'fixtures/styles/uncritical.css');\n  const result = await generate({\n    html: read('fixtures/generate-adaptive.html'),\n    base: path.join(__dirname, 'fixtures'),\n    target: {\n      uncritical: target\n    },\n    extract: true,\n    inline: true\n  });\n  const uncritical = readAndRemove(target);\n  expect(result.html).toMatch('\"/styles/uncritical.css\"');\n  expect(uncritical).toBe(result.uncritical);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Remove stylesheet on empty uncritical css","suites":[],"updatePoint":{"line":332,"column":47,"index":10852},"line":332,"code":"test('Remove stylesheet on empty uncritical css', async () => {\n  const result = await generate({\n    html: read('fixtures/issue-304.html'),\n    base: path.join(__dirname, 'fixtures'),\n    extract: true,\n    inline: true\n  });\n  expect(result.html).not.toMatch('<link');\n  expect(result.uncritical).toBe(result.uncritical);\n});","file":"index.test.js","skipped":false,"dir":"test"},{"name":"Use async cb result for inline.replaceStylesheets","suites":[],"updatePoint":{"line":342,"column":55,"index":11188},"line":342,"code":"test('Use async cb result for inline.replaceStylesheets', async () => {\n  const cb = () => Promise.resolve(['ab.css']);\n  const result = await generate({\n    html: read('fixtures/issue-304.html'),\n    base: path.join(__dirname, 'fixtures'),\n    extract: true,\n    inline: {\n      replaceStylesheets: cb\n    }\n  });\n  expect(result.html).toMatch('\"ab.css\"');\n  expect(result.uncritical).toBe(result.uncritical);\n});","file":"index.test.js","skipped":false,"dir":"test"}]}