{"repo":"lovell/sharp","url":"https://github.com/lovell/sharp","branch":"master","configs":[{"package":"sharp","lang":"js","dir":"test","framework":"mocha","pattern":"**/*.{js,ts}"}],"tests":[{"name":"Missing matrix","suites":["Affine transform","Invalid input"],"updatePoint":{"line":11,"column":22,"index":303},"line":11,"code":"    it('Missing matrix', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine();\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid 1d matrix","suites":["Affine transform","Invalid input"],"updatePoint":{"line":16,"column":25,"index":428},"line":16,"code":"    it('Invalid 1d matrix', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine(['123', 123, 123, 123]);\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid 2d matrix","suites":["Affine transform","Invalid input"],"updatePoint":{"line":21,"column":25,"index":575},"line":21,"code":"    it('Invalid 2d matrix', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[123, 123], [null, 123]]);\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid options parameter type","suites":["Affine transform","Invalid input"],"updatePoint":{"line":26,"column":38,"index":738},"line":26,"code":"    it('Invalid options parameter type', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[1, 0], [0, 1]], 'invalid options type');\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid background color","suites":["Affine transform","Invalid input"],"updatePoint":{"line":31,"column":32,"index":910},"line":31,"code":"    it('Invalid background color', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([4, 4, 4, 4], {\n          background: 'not a color'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid idx offset type","suites":["Affine transform","Invalid input"],"updatePoint":{"line":38,"column":31,"index":1102},"line":38,"code":"    it('Invalid idx offset type', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[4, 4], [4, 4]], {\n          idx: 'invalid idx type'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid idy offset type","suites":["Affine transform","Invalid input"],"updatePoint":{"line":45,"column":31,"index":1296},"line":45,"code":"    it('Invalid idy offset type', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([4, 4, 4, 4], {\n          idy: 'invalid idy type'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid odx offset type","suites":["Affine transform","Invalid input"],"updatePoint":{"line":52,"column":31,"index":1486},"line":52,"code":"    it('Invalid odx offset type', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[4, 4], [4, 4]], {\n          odx: 'invalid odx type'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid ody offset type","suites":["Affine transform","Invalid input"],"updatePoint":{"line":59,"column":31,"index":1680},"line":59,"code":"    it('Invalid ody offset type', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[4, 4], [4, 4]], {\n          ody: 'invalid ody type'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Invalid interpolator","suites":["Affine transform","Invalid input"],"updatePoint":{"line":66,"column":28,"index":1871},"line":66,"code":"    it('Invalid interpolator', () => {\n      assert.throws(() => {\n        sharp(fixtures.inputJpg).affine([[4, 4], [4, 4]], {\n          interpolator: 'cubic'\n        });\n      });\n    });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Applies identity matrix","suites":["Affine transform","Invalid input"],"updatePoint":{"line":74,"column":29,"index":2067},"line":74,"code":"  it('Applies identity matrix', done => {\n    const input = fixtures.inputJpg;\n    sharp(input).affine([[1, 0], [0, 1]]).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(input, data, done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Applies resize affine matrix","suites":["Affine transform","Invalid input"],"updatePoint":{"line":81,"column":34,"index":2308},"line":81,"code":"  it('Applies resize affine matrix', done => {\n    const input = fixtures.inputJpg;\n    const inputWidth = 2725;\n    const inputHeight = 2225;\n    sharp(input).affine([[0.2, 0], [0, 1.5]]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      fixtures.assertSimilar(input, data, done);\n      assert.strictEqual(info.width, Math.ceil(inputWidth * 0.2));\n      assert.strictEqual(info.height, Math.ceil(inputHeight * 1.5));\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Resizes and applies affine transform","suites":["Affine transform","Invalid input"],"updatePoint":{"line":92,"column":42,"index":2762},"line":92,"code":"  it('Resizes and applies affine transform', done => {\n    const input = fixtures.inputJpg;\n    sharp(input).resize(500, 500).affine([[0.5, 1], [1, 0.5]]).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(data, fixtures.expected('affine-resize-expected.jpg'), done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Extracts and applies affine transform","suites":["Affine transform","Invalid input"],"updatePoint":{"line":99,"column":43,"index":3075},"line":99,"code":"  it('Extracts and applies affine transform', done => {\n    sharp(fixtures.inputJpg).extract({\n      left: 300,\n      top: 300,\n      width: 600,\n      height: 600\n    }).affine([0.3, 0, -0.5, 0.3]).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(data, fixtures.expected('affine-extract-expected.jpg'), done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Rotates and applies affine transform","suites":["Affine transform","Invalid input"],"updatePoint":{"line":110,"column":42,"index":3431},"line":110,"code":"  it('Rotates and applies affine transform', done => {\n    sharp(fixtures.inputJpg320x240).rotate(90).affine([[-1.2, 0], [0, -1.2]]).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(data, fixtures.expected('affine-rotate-expected.jpg'), done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Extracts, rotates and applies affine transform","suites":["Affine transform","Invalid input"],"updatePoint":{"line":116,"column":52,"index":3731},"line":116,"code":"  it('Extracts, rotates and applies affine transform', done => {\n    sharp(fixtures.inputJpg).extract({\n      left: 1000,\n      top: 1000,\n      width: 200,\n      height: 200\n    }).rotate(45, {\n      background: 'blue'\n    }).affine([[2, 1], [2, -0.5]], {\n      background: 'red'\n    }).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('affine-extract-rotate-expected.jpg'), data, done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Applies affine transform with background color","suites":["Affine transform","Invalid input"],"updatePoint":{"line":131,"column":52,"index":4184},"line":131,"code":"  it('Applies affine transform with background color', done => {\n    sharp(fixtures.inputJpg320x240).rotate(180).affine([[-1.5, 1.2], [-1, 1]], {\n      background: 'red'\n    }).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('affine-background-expected.jpg'), data, done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Applies affine transform with background color and output offsets","suites":["Affine transform","Invalid input"],"updatePoint":{"line":139,"column":71,"index":4541},"line":139,"code":"  it('Applies affine transform with background color and output offsets', done => {\n    sharp(fixtures.inputJpg320x240).rotate(180).affine([[-2, 1.5], [-1, 2]], {\n      background: 'blue',\n      odx: 40,\n      ody: -100\n    }).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('affine-background-output-offsets-expected.jpg'), data, done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Applies affine transform with background color and all offsets","suites":["Affine transform","Invalid input"],"updatePoint":{"line":149,"column":68,"index":4941},"line":149,"code":"  it('Applies affine transform with background color and all offsets', done => {\n    sharp(fixtures.inputJpg320x240).rotate(180).affine([[-1.2, 1.8], [-1, 2]], {\n      background: 'yellow',\n      idx: 10,\n      idy: -40,\n      odx: 10,\n      ody: -50\n    }).toBuffer((err, data) => {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('affine-background-all-offsets-expected.jpg'), data, done);\n    });\n  });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Animated image rejects","suites":["Affine transform","Invalid input"],"updatePoint":{"line":161,"column":28,"index":5332},"line":161,"code":"  it('Animated image rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n    animated: true\n  }).affine([1, 1, 1, 1]).toBuffer(), /Affine is not supported for multi-page images/));","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Performs 2x upscale with  interpolation","suites":["Affine transform","Interpolations"],"updatePoint":{"line":169,"column":58,"index":5749},"line":169,"code":"      it(`Performs 2x upscale with ${interp} interpolation`, done => {\n        sharp(input).affine([[2, 0], [0, 2]], {\n          interpolator: sharp.interpolators[interp]\n        }).toBuffer((err, data, info) => {\n          if (err) throw err;\n          assert.strictEqual(info.width, Math.ceil(inputWidth * 2));\n          assert.strictEqual(info.height, Math.ceil(inputHeight * 2));\n          fixtures.assertSimilar(fixtures.expected(`affine-${sharp.interpolators[interp]}-2x-upscale-expected.jpg`), data, done);\n        });\n      });","file":"unit/affine.js","skipped":false,"dir":"test"},{"name":"Without proxy","suites":["HTTP agent"],"updatePoint":{"line":9,"column":19,"index":232},"line":9,"code":"  it('Without proxy', function () {\n    assert.strictEqual(null, agent());\n  });","file":"unit/agent.js","skipped":false,"dir":"test"},{"name":"HTTPS proxy with auth from HTTPS_PROXY","suites":["HTTP agent"],"updatePoint":{"line":12,"column":44,"index":338},"line":12,"code":"  it('HTTPS proxy with auth from HTTPS_PROXY', function () {\n    process.env.HTTPS_PROXY = 'https://user:pass@secure:123';\n    let logMsg = '';\n    const proxy = agent(msg => {\n      logMsg = msg;\n    });\n    delete process.env.HTTPS_PROXY;\n    assert.strictEqual('object', typeof proxy);\n    assert.strictEqual('secure', proxy.options.proxy.host);\n    assert.strictEqual(123, proxy.options.proxy.port);\n    assert.strictEqual('user:pass', proxy.options.proxy.proxyAuth);\n    assert.strictEqual(443, proxy.defaultPort);\n    assert.strictEqual(logMsg, 'Via proxy https://secure:123 with credentials');\n  });","file":"unit/agent.js","skipped":false,"dir":"test"},{"name":"HTTPS proxy with auth from HTTPS_PROXY using credentials containing special characters","suites":["HTTP agent"],"updatePoint":{"line":26,"column":92,"index":993},"line":26,"code":"  it('HTTPS proxy with auth from HTTPS_PROXY using credentials containing special characters', function () {\n    process.env.HTTPS_PROXY = 'https://user,:pass=@secure:789';\n    let logMsg = '';\n    const proxy = agent(msg => {\n      logMsg = msg;\n    });\n    delete process.env.HTTPS_PROXY;\n    assert.strictEqual('object', typeof proxy);\n    assert.strictEqual('secure', proxy.options.proxy.host);\n    assert.strictEqual(789, proxy.options.proxy.port);\n    assert.strictEqual('user,:pass=', proxy.options.proxy.proxyAuth);\n    assert.strictEqual(443, proxy.defaultPort);\n    assert.strictEqual(logMsg, 'Via proxy https://secure:789 with credentials');\n  });","file":"unit/agent.js","skipped":false,"dir":"test"},{"name":"HTTP proxy without auth from npm_config_proxy","suites":["HTTP agent"],"updatePoint":{"line":40,"column":51,"index":1611},"line":40,"code":"  it('HTTP proxy without auth from npm_config_proxy', function () {\n    process.env.npm_config_proxy = 'http://plaintext:456';\n    let logMsg = '';\n    const proxy = agent(msg => {\n      logMsg = msg;\n    });\n    delete process.env.npm_config_proxy;\n    assert.strictEqual('object', typeof proxy);\n    assert.strictEqual('plaintext', proxy.options.proxy.host);\n    assert.strictEqual(456, proxy.options.proxy.port);\n    assert.strictEqual(null, proxy.options.proxy.proxyAuth);\n    assert.strictEqual(443, proxy.defaultPort);\n    assert.strictEqual(logMsg, 'Via proxy http://plaintext:456 no credentials');\n  });","file":"unit/agent.js","skipped":false,"dir":"test"},{"name":"Flatten to black","suites":["Alpha transparency"],"updatePoint":{"line":10,"column":22,"index":275},"line":10,"code":"  it('Flatten to black', function (done) {\n    sharp(fixtures.inputPngWithTransparency).flatten().resize(400, 300).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(400, info.width);\n      assert.strictEqual(300, info.height);\n      fixtures.assertSimilar(fixtures.expected('flatten-black.jpg'), data, done);\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Flatten to RGB orange","suites":["Alpha transparency"],"updatePoint":{"line":18,"column":27,"index":642},"line":18,"code":"  it('Flatten to RGB orange', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(400, 300).flatten({\n      background: {\n        r: 255,\n        g: 102,\n        b: 0\n      }\n    }).jpeg({\n      chromaSubsampling: '4:4:4'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(400, info.width);\n      assert.strictEqual(300, info.height);\n      fixtures.assertSimilar(fixtures.expected('flatten-orange.jpg'), data, done);\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Flatten to CSS/hex orange","suites":["Alpha transparency"],"updatePoint":{"line":34,"column":31,"index":1141},"line":34,"code":"  it('Flatten to CSS/hex orange', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(400, 300).flatten({\n      background: '#ff6600'\n    }).jpeg({\n      chromaSubsampling: '4:4:4'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(400, info.width);\n      assert.strictEqual(300, info.height);\n      fixtures.assertSimilar(fixtures.expected('flatten-orange.jpg'), data, done);\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Flatten 16-bit PNG with transparency to orange","suites":["Alpha transparency"],"updatePoint":{"line":46,"column":52,"index":1616},"line":46,"code":"  it('Flatten 16-bit PNG with transparency to orange', function (done) {\n    const output = fixtures.path('output.flatten-rgb16-orange.jpg');\n    sharp(fixtures.inputPngWithTransparency16bit).flatten({\n      background: {\n        r: 255,\n        g: 102,\n        b: 0\n      }\n    }).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(32, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('flatten-rgb16-orange.jpg'), 10);\n      done();\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Do not flatten","suites":["Alpha transparency"],"updatePoint":{"line":63,"column":20,"index":2189},"line":63,"code":"  it('Do not flatten', function (done) {\n    sharp(fixtures.inputPngWithTransparency).flatten(false).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(4, info.channels);\n      done();\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Ignored for JPEG","suites":["Alpha transparency"],"updatePoint":{"line":71,"column":22,"index":2474},"line":71,"code":"  it('Ignored for JPEG', function (done) {\n    sharp(fixtures.inputJpg).flatten({\n      background: '#ff0000'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      done();\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Flatten with options but without colour does not throw","suites":["Alpha transparency"],"updatePoint":{"line":81,"column":60,"index":2812},"line":81,"code":"  it('Flatten with options but without colour does not throw', () => {\n    assert.doesNotThrow(() => {\n      sharp().flatten({});\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Flatten to invalid colour throws","suites":["Alpha transparency"],"updatePoint":{"line":86,"column":38,"index":2934},"line":86,"code":"  it('Flatten to invalid colour throws', () => {\n    assert.throws(() => {\n      sharp().flatten({\n        background: 1\n      });\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Enlargement with non-nearest neighbor interpolation shouldn’t cause dark edges","suites":["Alpha transparency"],"updatePoint":{"line":93,"column":84,"index":3125},"line":93,"code":"  it('Enlargement with non-nearest neighbor interpolation shouldn’t cause dark edges', function () {\n    const base = 'alpha-premultiply-enlargement-2048x1536-paper.png';\n    const actual = fixtures.path('output.' + base);\n    const expected = fixtures.expected(base);\n    return sharp(fixtures.inputPngAlphaPremultiplicationSmall).resize(2048, 1536).toFile(actual).then(function () {\n      fixtures.assertMaxColourDistance(actual, expected, 102);\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Reduction with non-nearest neighbor interpolation shouldn’t cause dark edges","suites":["Alpha transparency"],"updatePoint":{"line":101,"column":82,"index":3585},"line":101,"code":"  it('Reduction with non-nearest neighbor interpolation shouldn’t cause dark edges', function () {\n    const base = 'alpha-premultiply-reduction-1024x768-paper.png';\n    const actual = fixtures.path('output.' + base);\n    const expected = fixtures.expected(base);\n    return sharp(fixtures.inputPngAlphaPremultiplicationLarge).resize(1024, 768).toFile(actual).then(function () {\n      fixtures.assertMaxColourDistance(actual, expected, 102);\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Removes alpha from fixtures with transparency, ignores those without","suites":["Alpha transparency"],"updatePoint":{"line":109,"column":74,"index":4033},"line":109,"code":"  it('Removes alpha from fixtures with transparency, ignores those without', function () {\n    return Promise.all([fixtures.inputPngWithTransparency, fixtures.inputPngWithTransparency16bit, fixtures.inputWebPWithTransparency, fixtures.inputJpg, fixtures.inputPng, fixtures.inputWebP].map(function (input) {\n      return sharp(input).resize(10).removeAlpha().toBuffer({\n        resolveWithObject: true\n      }).then(function (result) {\n        assert.strictEqual(3, result.info.channels);\n      });\n    }));\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Ensures alpha from fixtures without transparency, ignores those with","suites":["Alpha transparency"],"updatePoint":{"line":118,"column":74,"index":4546},"line":118,"code":"  it('Ensures alpha from fixtures without transparency, ignores those with', function () {\n    return Promise.all([fixtures.inputPngWithTransparency, fixtures.inputPngWithTransparency16bit, fixtures.inputWebPWithTransparency, fixtures.inputJpg, fixtures.inputPng, fixtures.inputWebP].map(function (input) {\n      return sharp(input).resize(10).ensureAlpha().png().toBuffer({\n        resolveWithObject: true\n      }).then(function (result) {\n        assert.strictEqual(4, result.info.channels);\n      });\n    }));\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Valid ensureAlpha value used for alpha channel","suites":["Alpha transparency"],"updatePoint":{"line":127,"column":52,"index":5043},"line":127,"code":"  it('Valid ensureAlpha value used for alpha channel', async () => {\n    const background = {\n      r: 255,\n      g: 0,\n      b: 0\n    };\n    const [r, g, b, alpha] = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background\n      }\n    }).ensureAlpha(0.5).raw().toBuffer();\n    assert.deepStrictEqual({\n      r,\n      g,\n      b,\n      alpha\n    }, {\n      ...background,\n      alpha: 127\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"Invalid ensureAlpha value throws","suites":["Alpha transparency"],"updatePoint":{"line":151,"column":38,"index":5482},"line":151,"code":"  it('Invalid ensureAlpha value throws', async () => {\n    assert.throws(() => {\n      sharp().ensureAlpha('fail');\n    });\n  });","file":"unit/alpha.js","skipped":false,"dir":"test"},{"name":"called without options does not throw an error","suites":["AVIF"],"updatePoint":{"line":14,"column":52,"index":324},"line":14,"code":"  it('called without options does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().avif();\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"can convert AVIF to JPEG","suites":["AVIF"],"updatePoint":{"line":19,"column":30,"index":433},"line":19,"code":"  it('can convert AVIF to JPEG', async () => {\n    const data = await sharp(inputAvif).resize(32).jpeg().toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      channels: 3,\n      chromaSubsampling: '4:2:0',\n      density: 72,\n      depth: 'uchar',\n      format: 'jpeg',\n      hasAlpha: false,\n      hasProfile: false,\n      // 32 / (2048 / 858) = 13.40625\n      // Math.round(13.40625) = 13\n      height: 13,\n      isProgressive: false,\n      space: 'srgb',\n      width: 32\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"can convert JPEG to AVIF","suites":["AVIF"],"updatePoint":{"line":41,"column":30,"index":1003},"line":41,"code":"  it('can convert JPEG to AVIF', async () => {\n    const data = await sharp(inputJpg).resize(32).avif({\n      effort: 0\n    }).toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      channels: 3,\n      compression: 'av1',\n      depth: 'uchar',\n      format: 'heif',\n      hasAlpha: false,\n      hasProfile: false,\n      height: 26,\n      isProgressive: false,\n      pagePrimary: 0,\n      pages: 1,\n      space: 'srgb',\n      width: 32\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"can passthrough AVIF","suites":["AVIF"],"updatePoint":{"line":64,"column":26,"index":1529},"line":64,"code":"  it('can passthrough AVIF', async () => {\n    const data = await sharp(inputAvif).resize(32).toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      channels: 3,\n      compression: 'av1',\n      depth: 'uchar',\n      format: 'heif',\n      hasAlpha: false,\n      hasProfile: false,\n      height: 13,\n      isProgressive: false,\n      pagePrimary: 0,\n      pages: 1,\n      space: 'srgb',\n      width: 32\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"can convert animated GIF to non-animated AVIF","suites":["AVIF"],"updatePoint":{"line":85,"column":51,"index":2051},"line":85,"code":"  it('can convert animated GIF to non-animated AVIF', async () => {\n    const data = await sharp(inputGifAnimated, {\n      animated: true\n    }).resize(10).avif({\n      effort: 0\n    }).toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      channels: 4,\n      compression: 'av1',\n      depth: 'uchar',\n      format: 'heif',\n      hasAlpha: true,\n      hasProfile: false,\n      height: 300,\n      isProgressive: false,\n      pagePrimary: 0,\n      pages: 1,\n      space: 'srgb',\n      width: 10\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"should cast to uchar","suites":["AVIF"],"updatePoint":{"line":110,"column":26,"index":2615},"line":110,"code":"  it('should cast to uchar', async () => {\n    const data = await sharp(inputJpg).resize(32).sharpen().avif({\n      effort: 0\n    }).toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      channels: 3,\n      compression: 'av1',\n      depth: 'uchar',\n      format: 'heif',\n      hasAlpha: false,\n      hasProfile: false,\n      height: 26,\n      isProgressive: false,\n      pagePrimary: 0,\n      pages: 1,\n      space: 'srgb',\n      width: 32\n    });\n  });","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"Invalid width - too large","suites":["AVIF"],"updatePoint":{"line":133,"column":31,"index":3156},"line":133,"code":"  it('Invalid width - too large', async () => assert.rejects(() => sharp({\n    create: {\n      width: 16385,\n      height: 16,\n      channels: 3,\n      background: 'red'\n    }\n  }).avif().toBuffer(), /Processed image is too large for the HEIF format/));","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"Invalid height - too large","suites":["AVIF"],"updatePoint":{"line":141,"column":32,"index":3411},"line":141,"code":"  it('Invalid height - too large', async () => assert.rejects(() => sharp({\n    create: {\n      width: 16,\n      height: 16385,\n      channels: 3,\n      background: 'red'\n    }\n  }).avif().toBuffer(), /Processed image is too large for the HEIF format/));","file":"unit/avif.js","skipped":false,"dir":"test"},{"name":"sRGB image retains 3 channels","suites":["Bandbool per-channel boolean operations"],"updatePoint":{"line":21,"column":35,"index":830},"line":21,"code":"  it('sRGB image retains 3 channels', function (done) {\n    sharp(fixtures.inputJpg).bandbool('and').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(3, info.channels);\n      done();\n    });\n  });","file":"unit/bandbool.js","skipped":false,"dir":"test"},{"name":"Invalid operation","suites":["Bandbool per-channel boolean operations"],"updatePoint":{"line":28,"column":23,"index":1055},"line":28,"code":"  it('Invalid operation', function () {\n    assert.throws(function () {\n      sharp().bandbool('fail');\n    });\n  });","file":"unit/bandbool.js","skipped":false,"dir":"test"},{"name":"Missing operation","suites":["Bandbool per-channel boolean operations"],"updatePoint":{"line":33,"column":23,"index":1173},"line":33,"code":"  it('Missing operation', function () {\n    assert.throws(function () {\n      sharp().bandbool();\n    });\n  });","file":"unit/bandbool.js","skipped":false,"dir":"test"},{"name":"specific radius 1","suites":["Blur"],"updatePoint":{"line":10,"column":23,"index":262},"line":10,"code":"  it('specific radius 1', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).blur(1).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('blur-1.jpg'), data, done);\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"specific radius 10","suites":["Blur"],"updatePoint":{"line":19,"column":24,"index":648},"line":19,"code":"  it('specific radius 10', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).blur(10).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('blur-10.jpg'), data, done);\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"specific radius 0.3","suites":["Blur"],"updatePoint":{"line":28,"column":25,"index":1037},"line":28,"code":"  it('specific radius 0.3', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).blur(0.3).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('blur-0.3.jpg'), data, done);\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"mild blur","suites":["Blur"],"updatePoint":{"line":37,"column":15,"index":1418},"line":37,"code":"  it('mild blur', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).blur().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('blur-mild.jpg'), data, done);\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"invalid radius","suites":["Blur"],"updatePoint":{"line":46,"column":20,"index":1802},"line":46,"code":"  it('invalid radius', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).blur(0.1);\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"blurred image is smaller than non-blurred","suites":["Blur"],"updatePoint":{"line":51,"column":47,"index":1954},"line":51,"code":"  it('blurred image is smaller than non-blurred', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).blur(false).toBuffer(function (err, notBlurred, info) {\n      if (err) throw err;\n      assert.strictEqual(true, notBlurred.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(fixtures.inputJpg).resize(320, 240).blur(true).toBuffer(function (err, blurred, info) {\n        if (err) throw err;\n        assert.strictEqual(true, blurred.length > 0);\n        assert.strictEqual(true, blurred.length < notBlurred.length);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        done();\n      });\n    });\n  });","file":"unit/blur.js","skipped":false,"dir":"test"},{"name":"Invalid operation","suites":["Boolean operation between two images"],"updatePoint":{"line":43,"column":23,"index":1859},"line":43,"code":"  it('Invalid operation', function () {\n    assert.throws(function () {\n      sharp().boolean(fixtures.inputJpgBooleanTest, 'fail');\n    });\n  });","file":"unit/boolean.js","skipped":false,"dir":"test"},{"name":"Invalid operation, non-string","suites":["Boolean operation between two images"],"updatePoint":{"line":48,"column":35,"index":2018},"line":48,"code":"  it('Invalid operation, non-string', function () {\n    assert.throws(function () {\n      sharp().boolean(fixtures.inputJpgBooleanTest, null);\n    });\n  });","file":"unit/boolean.js","skipped":false,"dir":"test"},{"name":"Missing input","suites":["Boolean operation between two images"],"updatePoint":{"line":53,"column":19,"index":2159},"line":53,"code":"  it('Missing input', function () {\n    assert.throws(function () {\n      sharp().boolean();\n    });\n  });","file":"unit/boolean.js","skipped":false,"dir":"test"},{"name":"width 5 width 5 maxSlope 0","suites":["Clahe"],"updatePoint":{"line":10,"column":32,"index":275},"line":10,"code":"  it('width 5 width 5 maxSlope 0', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 5,\n      height: 5,\n      maxSlope: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-5-5-0.jpg'), data, {\n        threshold: 10\n      }, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 5 width 5 maxSlope 5","suites":["Clahe"],"updatePoint":{"line":23,"column":32,"index":666},"line":23,"code":"  it('width 5 width 5 maxSlope 5', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 5,\n      height: 5,\n      maxSlope: 5\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-5-5-5.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 11 width 25 maxSlope 14","suites":["Clahe"],"updatePoint":{"line":34,"column":35,"index":1027},"line":34,"code":"  it('width 11 width 25 maxSlope 14', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 11,\n      height: 25,\n      maxSlope: 14\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-11-25-14.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 50 width 50 maxSlope 0","suites":["Clahe"],"updatePoint":{"line":45,"column":34,"index":1393},"line":45,"code":"  it('width 50 width 50 maxSlope 0', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 50,\n      height: 50,\n      maxSlope: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-50-50-0.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 50 width 50 maxSlope 14","suites":["Clahe"],"updatePoint":{"line":56,"column":35,"index":1758},"line":56,"code":"  it('width 50 width 50 maxSlope 14', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 50,\n      height: 50,\n      maxSlope: 14\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-50-50-14.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 100 width 50 maxSlope 3","suites":["Clahe"],"updatePoint":{"line":67,"column":35,"index":2125},"line":67,"code":"  it('width 100 width 50 maxSlope 3', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 100,\n      height: 50,\n      maxSlope: 3\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-100-50-3.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"width 100 width 100 maxSlope 0","suites":["Clahe"],"updatePoint":{"line":78,"column":36,"index":2493},"line":78,"code":"  it('width 100 width 100 maxSlope 0', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 100,\n      height: 100,\n      maxSlope: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-100-100-0.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"invalid maxSlope","suites":["Clahe"],"updatePoint":{"line":89,"column":22,"index":2849},"line":89,"code":"  it('invalid maxSlope', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 100,\n        maxSlope: -5\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 100,\n        maxSlope: 110\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 100,\n        maxSlope: 5.5\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 100,\n        maxSlope: 'a string'\n      });\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"invalid width","suites":["Clahe"],"updatePoint":{"line":119,"column":19,"index":3525},"line":119,"code":"  it('invalid width', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100.5,\n        height: 100\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: -5,\n        height: 100\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: true,\n        height: 100\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 'string test',\n        height: 100\n      });\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"invalid height","suites":["Clahe"],"updatePoint":{"line":145,"column":20,"index":4116},"line":145,"code":"  it('invalid height', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 100.5\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: -5\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: true\n      });\n    });\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe({\n        width: 100,\n        height: 'string test'\n      });\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"invalid options object","suites":["Clahe"],"updatePoint":{"line":171,"column":28,"index":4715},"line":171,"code":"  it('invalid options object', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgClahe).clahe(100, 100, 5);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"uses default maxSlope of 3","suites":["Clahe"],"updatePoint":{"line":176,"column":32,"index":4866},"line":176,"code":"  it('uses default maxSlope of 3', function (done) {\n    sharp(fixtures.inputJpgClahe).clahe({\n      width: 100,\n      height: 50\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fixtures.assertSimilar(fixtures.expected('clahe-100-50-3.jpg'), data, done);\n    });\n  });","file":"unit/clahe.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to multiple Streams","suites":["Clone"],"updatePoint":{"line":17,"column":52,"index":430},"line":17,"code":"  it('Read from Stream and write to multiple Streams', function (done) {\n    let finishEventsExpected = 2;\n    // Output stream 1\n    const output1 = fixtures.path('output.multi-stream.1.jpg');\n    const writable1 = fs.createWriteStream(output1);\n    writable1.on('finish', function () {\n      sharp(output1).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fs.unlinkSync(output1);\n        finishEventsExpected--;\n        if (finishEventsExpected === 0) {\n          done();\n        }\n      });\n    });\n    // Output stream 2\n    const output2 = fixtures.path('output.multi-stream.2.jpg');\n    const writable2 = fs.createWriteStream(output2);\n    writable2.on('finish', function () {\n      sharp(output2).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(100, info.width);\n        assert.strictEqual(122, info.height);\n        fs.unlinkSync(output2);\n        finishEventsExpected--;\n        if (finishEventsExpected === 0) {\n          done();\n        }\n      });\n    });\n    // Create parent instance\n    const rotator = sharp().rotate(90);\n    // Cloned instances with differing dimensions\n    rotator.clone().resize(320, 240).pipe(writable1);\n    rotator.clone().resize(100, 122).pipe(writable2);\n    // Go\n    fs.createReadStream(fixtures.inputJpg).pipe(rotator);\n  });","file":"unit/clone.js","skipped":false,"dir":"test"},{"name":"Stream-based input attaches finish event listener to original","suites":["Clone"],"updatePoint":{"line":63,"column":67,"index":2180},"line":63,"code":"  it('Stream-based input attaches finish event listener to original', function () {\n    const original = sharp();\n    const clone = original.clone();\n    assert.strictEqual(1, original.listenerCount('finish'));\n    assert.strictEqual(0, clone.listenerCount('finish'));\n  });","file":"unit/clone.js","skipped":false,"dir":"test"},{"name":"Non Stream-based input does not attach finish event listeners","suites":["Clone"],"updatePoint":{"line":69,"column":67,"index":2455},"line":69,"code":"  it('Non Stream-based input does not attach finish event listeners', function () {\n    const original = sharp(fixtures.inputJpg);\n    const clone = original.clone();\n    assert.strictEqual(0, original.listenerCount('finish'));\n    assert.strictEqual(0, clone.listenerCount('finish'));\n  });","file":"unit/clone.js","skipped":false,"dir":"test"},{"name":"To greyscale","suites":["Colour space conversion"],"updatePoint":{"line":10,"column":18,"index":276},"line":10,"code":"  it('To greyscale', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).greyscale().toFile(fixtures.path('output.greyscale-gamma-0.0.jpg'), done);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"To greyscale with gamma correction","suites":["Colour space conversion"],"updatePoint":{"line":13,"column":40,"index":464},"line":13,"code":"  it('To greyscale with gamma correction', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).gamma().grayscale().toFile(fixtures.path('output.greyscale-gamma-2.2.jpg'), done);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Not to greyscale","suites":["Colour space conversion"],"updatePoint":{"line":16,"column":22,"index":642},"line":16,"code":"  it('Not to greyscale', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).greyscale(false).toFile(fixtures.path('output.greyscale-not.jpg'), done);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Greyscale with single channel output","suites":["Colour space conversion"],"updatePoint":{"line":19,"column":42,"index":831},"line":19,"code":"  it('Greyscale with single channel output', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).greyscale().toColourspace('b-w').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(1, info.channels);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('output.greyscale-single.jpg'), data, done);\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"From 1-bit TIFF to sRGB WebP","suites":["Colour space conversion"],"updatePoint":{"line":28,"column":34,"index":1266},"line":28,"code":"  it('From 1-bit TIFF to sRGB WebP', async () => {\n    const data = await sharp(fixtures.inputTiff).resize(8, 8).webp().toBuffer();\n    const {\n      format\n    } = await sharp(data).metadata();\n    assert.strictEqual(format, 'webp');\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"From CMYK to sRGB","suites":["Colour space conversion"],"updatePoint":{"line":35,"column":23,"index":1496},"line":35,"code":"  it('From CMYK to sRGB', function (done) {\n    sharp(fixtures.inputJpgWithCmykProfile).resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      done();\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"From CMYK to sRGB with white background, not yellow","suites":["Colour space conversion"],"updatePoint":{"line":44,"column":57,"index":1861},"line":44,"code":"  it('From CMYK to sRGB with white background, not yellow', function (done) {\n    sharp(fixtures.inputJpgWithCmykProfile).resize(320, 240, {\n      fit: sharp.fit.contain,\n      background: 'white'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('colourspace.cmyk.jpg'), data, done);\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"From profile-less CMYK to sRGB","suites":["Colour space conversion"],"updatePoint":{"line":56,"column":36,"index":2341},"line":56,"code":"  it('From profile-less CMYK to sRGB', function (done) {\n    sharp(fixtures.inputJpgWithCmykNoProfile).resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      fixtures.assertSimilar(fixtures.expected('colourspace.cmyk-without-profile.jpg'), data, done);\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Profile-less CMYK roundtrip","suites":["Colour space conversion"],"updatePoint":{"line":64,"column":33,"index":2722},"line":64,"code":"  it('Profile-less CMYK roundtrip', async () => {\n    const [c, m, y, k] = await sharp(fixtures.inputJpgWithCmykNoProfile).pipelineColourspace('cmyk').toColourspace('cmyk').raw().toBuffer();\n    assert.deepStrictEqual({\n      c,\n      m,\n      y,\n      k\n    }, {\n      c: 55,\n      m: 27,\n      y: 0,\n      k: 0\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"From sRGB with RGB16 pipeline, resize with gamma, to sRGB","suites":["Colour space conversion"],"updatePoint":{"line":78,"column":63,"index":3079},"line":78,"code":"  it('From sRGB with RGB16 pipeline, resize with gamma, to sRGB', function (done) {\n    sharp(fixtures.inputPngGradients).pipelineColourspace('rgb16').resize(320).gamma().toColourspace('srgb').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      fixtures.assertSimilar(fixtures.expected('colourspace-gradients-gamma-resize.png'), data, {\n        threshold: 0\n      }, done);\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Convert P3 to sRGB","suites":["Colour space conversion"],"updatePoint":{"line":87,"column":24,"index":3489},"line":87,"code":"  it('Convert P3 to sRGB', async () => {\n    const [r, g, b] = await sharp(fixtures.inputPngP3).raw().toBuffer();\n    assert.strictEqual(r, 255);\n    assert.strictEqual(g, 0);\n    assert.strictEqual(b, 0);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Passthrough P3","suites":["Colour space conversion"],"updatePoint":{"line":93,"column":20,"index":3697},"line":93,"code":"  it('Passthrough P3', async () => {\n    const [r, g, b] = await sharp(fixtures.inputPngP3).withMetadata({\n      icc: 'p3'\n    }).raw().toBuffer();\n    assert.strictEqual(r, 234);\n    assert.strictEqual(g, 51);\n    assert.strictEqual(b, 34);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Invalid pipelineColourspace input","suites":["Colour space conversion"],"updatePoint":{"line":101,"column":39,"index":3964},"line":101,"code":"  it('Invalid pipelineColourspace input', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).pipelineColorspace(null);\n    }, /Expected string for colourspace but received null of type object/);\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"Invalid toColourspace input","suites":["Colour space conversion"],"updatePoint":{"line":106,"column":33,"index":4185},"line":106,"code":"  it('Invalid toColourspace input', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).toColourspace(null);\n    });\n  });","file":"unit/colourspace.js","skipped":false,"dir":"test"},{"name":"blend ","suites":["composite"],"updatePoint":{"line":56,"column":22,"index":846},"line":56,"code":"    it(`blend ${blend}`, async () => {\n      const filename = `composite.blend.${blend}.png`;\n      const actual = fixtures.path(`output.${filename}`);\n      const expected = fixtures.expected(filename);\n      await sharp(redRect).composite([{\n        input: blueRect,\n        blend\n      }]).toFile(actual);\n      fixtures.assertMaxColourDistance(actual, expected);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"premultiplied true","suites":["composite"],"updatePoint":{"line":67,"column":24,"index":1229},"line":67,"code":"  it('premultiplied true', () => {\n    const filename = 'composite.premultiplied.png';\n    const below = fixtures.path(`input.below.${filename}`);\n    const above = fixtures.path(`input.above.${filename}`);\n    const actual = fixtures.path(`output.true.${filename}`);\n    const expected = fixtures.expected(`expected.true.${filename}`);\n    return sharp(below).composite([{\n      input: above,\n      blend: 'color-burn',\n      top: 0,\n      left: 0,\n      premultiplied: true\n    }]).toFile(actual).then(() => {\n      fixtures.assertMaxColourDistance(actual, expected);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"premultiplied false","suites":["composite"],"updatePoint":{"line":83,"column":25,"index":1814},"line":83,"code":"  it('premultiplied false', () => {\n    const filename = 'composite.premultiplied.png';\n    const below = fixtures.path(`input.below.${filename}`);\n    const above = fixtures.path(`input.above.${filename}`);\n    const actual = fixtures.path(`output.false.${filename}`);\n    const expected = fixtures.expected(`expected.false.${filename}`);\n    return sharp(below).composite([{\n      input: above,\n      blend: 'color-burn',\n      top: 0,\n      left: 0,\n      premultiplied: false\n    }]).toFile(actual).then(() => {\n      fixtures.assertMaxColourDistance(actual, expected);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"premultiplied absent","suites":["composite"],"updatePoint":{"line":99,"column":26,"index":2403},"line":99,"code":"  it('premultiplied absent', () => {\n    const filename = 'composite.premultiplied.png';\n    const below = fixtures.path(`input.below.${filename}`);\n    const above = fixtures.path(`input.above.${filename}`);\n    const actual = fixtures.path(`output.absent.${filename}`);\n    const expected = fixtures.expected(`expected.absent.${filename}`);\n    return sharp(below).composite([{\n      input: above,\n      blend: 'color-burn',\n      top: 0,\n      left: 0\n    }]).toFile(actual).then(() => {\n      fixtures.assertMaxColourDistance(actual, expected);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"multiple","suites":["composite"],"updatePoint":{"line":114,"column":14,"index":2954},"line":114,"code":"  it('multiple', async () => {\n    const filename = 'composite-multiple.png';\n    const actual = fixtures.path(`output.${filename}`);\n    const expected = fixtures.expected(filename);\n    await sharp(redRect).composite([{\n      input: blueRect,\n      gravity: 'northeast'\n    }, {\n      input: greenRect,\n      gravity: 'southwest'\n    }]).toFile(actual);\n    fixtures.assertMaxColourDistance(actual, expected);\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"zero offset","suites":["composite"],"updatePoint":{"line":127,"column":17,"index":3375},"line":127,"code":"  it('zero offset', done => {\n    sharp(fixtures.inputJpg).resize(80).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      top: 0,\n      left: 0\n    }]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('overlay-offset-0.jpg'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"offset and gravity","suites":["composite"],"updatePoint":{"line":139,"column":24,"index":3802},"line":139,"code":"  it('offset and gravity', done => {\n    sharp(fixtures.inputJpg).resize(80).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      left: 10,\n      top: 10,\n      gravity: 4\n    }]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('overlay-offset-with-gravity.jpg'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"negative offset and gravity","suites":["composite"],"updatePoint":{"line":152,"column":33,"index":4269},"line":152,"code":"  it('negative offset and gravity', done => {\n    sharp(fixtures.inputJpg).resize(400).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      left: -10,\n      top: -10,\n      gravity: 4\n    }]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('overlay-negative-offset-with-gravity.jpg'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"offset, gravity and tile","suites":["composite"],"updatePoint":{"line":165,"column":30,"index":4745},"line":165,"code":"  it('offset, gravity and tile', done => {\n    sharp(fixtures.inputJpg).resize(80).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      left: 10,\n      top: 10,\n      gravity: 4,\n      tile: true\n    }]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('overlay-offset-with-gravity-tile.jpg'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"offset and tile","suites":["composite"],"updatePoint":{"line":179,"column":21,"index":5223},"line":179,"code":"  it('offset and tile', done => {\n    sharp(fixtures.inputJpg).resize(80).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      left: 10,\n      top: 10,\n      tile: true\n    }]).toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('overlay-offset-with-tile.jpg'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"centre gravity should replicate correct number of tiles","suites":["composite"],"updatePoint":{"line":192,"column":61,"index":5715},"line":192,"code":"  it('centre gravity should replicate correct number of tiles', async () => {\n    const red = {\n      r: 255,\n      g: 0,\n      b: 0\n    };\n    const [r, g, b] = await sharp({\n      create: {\n        width: 40,\n        height: 40,\n        channels: 4,\n        background: red\n      }\n    }).composite([{\n      input: fixtures.inputPngWithTransparency16bit,\n      gravity: 'centre',\n      tile: true\n    }]).raw().toBuffer();\n    assert.deepStrictEqual({\n      r,\n      g,\n      b\n    }, red);\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"cutout via dest-in","suites":["composite"],"updatePoint":{"line":216,"column":24,"index":6177},"line":216,"code":"  it('cutout via dest-in', done => {\n    sharp(fixtures.inputJpg).resize(300, 300).composite([{\n      input: Buffer.from('<svg width=\"200\" height=\"200\"><rect x=\"0\" y=\"0\" width=\"200\" height=\"200\" rx=\"50\" ry=\"50\"/></svg>'),\n      density: 96,\n      blend: 'dest-in',\n      cutout: true\n    }]).png().toBuffer((err, data, info) => {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(300, info.width);\n      assert.strictEqual(300, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('composite-cutout.png'), data, done);\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"missing images","suites":["composite","validation"],"updatePoint":{"line":286,"column":22,"index":8942},"line":286,"code":"    it('missing images', () => {\n      assert.throws(() => {\n        sharp().composite();\n      }, /Expected array for images to composite but received undefined of type undefined/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid images","suites":["composite","validation"],"updatePoint":{"line":291,"column":22,"index":9133},"line":291,"code":"    it('invalid images', () => {\n      assert.throws(() => {\n        sharp().composite(['invalid']);\n      }, /Expected object for image to composite but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"missing input","suites":["composite","validation"],"updatePoint":{"line":296,"column":21,"index":9329},"line":296,"code":"    it('missing input', () => {\n      assert.throws(() => {\n        sharp().composite([{}]);\n      }, /Unsupported input/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid blend","suites":["composite","validation"],"updatePoint":{"line":301,"column":21,"index":9461},"line":301,"code":"    it('invalid blend', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          blend: 'invalid'\n        }]);\n      }, /Expected valid blend name for blend but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid tile","suites":["composite","validation"],"updatePoint":{"line":309,"column":20,"index":9707},"line":309,"code":"    it('invalid tile', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          tile: 'invalid'\n        }]);\n      }, /Expected boolean for tile but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid premultiplied","suites":["composite","validation"],"updatePoint":{"line":317,"column":29,"index":9951},"line":317,"code":"    it('invalid premultiplied', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          premultiplied: 'invalid'\n        }]);\n      }, /Expected boolean for premultiplied but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid left","suites":["composite","validation"],"updatePoint":{"line":325,"column":20,"index":10204},"line":325,"code":"    it('invalid left', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          left: 0.5\n        }]);\n      }, /Expected integer for left but received 0.5 of type number/);\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          left: 'invalid'\n        }]);\n      }, /Expected integer for left but received invalid of type string/);\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          left: 'invalid',\n          top: 10\n        }]);\n      }, /Expected integer for left but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid top","suites":["composite","validation"],"updatePoint":{"line":346,"column":19,"index":10839},"line":346,"code":"    it('invalid top', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          top: 0.5\n        }]);\n      }, /Expected integer for top but received 0.5 of type number/);\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          top: 'invalid'\n        }]);\n      }, /Expected integer for top but received invalid of type string/);\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          top: 'invalid',\n          left: 10\n        }]);\n      }, /Expected integer for top but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"left but no top","suites":["composite","validation"],"updatePoint":{"line":367,"column":23,"index":11473},"line":367,"code":"    it('left but no top', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          left: 1\n        }]);\n      }, /Expected both left and top to be set/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"top but no left","suites":["composite","validation"],"updatePoint":{"line":375,"column":23,"index":11678},"line":375,"code":"    it('top but no left', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          top: 1\n        }]);\n      }, /Expected both left and top to be set/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"invalid gravity","suites":["composite","validation"],"updatePoint":{"line":383,"column":23,"index":11882},"line":383,"code":"    it('invalid gravity', () => {\n      assert.throws(() => {\n        sharp().composite([{\n          input: 'test',\n          gravity: 'invalid'\n        }]);\n      }, /Expected valid gravity for gravity but received invalid of type string/);\n    });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"Allow offset beyond bottom/right edge","suites":["composite","validation"],"updatePoint":{"line":392,"column":43,"index":12158},"line":392,"code":"  it('Allow offset beyond bottom/right edge', async () => {\n    const red = {\n      r: 255,\n      g: 0,\n      b: 0\n    };\n    const blue = {\n      r: 0,\n      g: 0,\n      b: 255\n    };\n    const [r, g, b] = await sharp({\n      create: {\n        width: 2,\n        height: 2,\n        channels: 4,\n        background: red\n      }\n    }).composite([{\n      input: {\n        create: {\n          width: 2,\n          height: 2,\n          channels: 4,\n          background: blue\n        }\n      },\n      top: 1,\n      left: 1\n    }]).raw().toBuffer();\n    assert.deepStrictEqual(red, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"Ensure tiled composition works with resized fit=outside","suites":["composite","validation"],"updatePoint":{"line":428,"column":61,"index":12794},"line":428,"code":"  it('Ensure tiled composition works with resized fit=outside', async () => {\n    const {\n      info\n    } = await sharp({\n      create: {\n        width: 41,\n        height: 41,\n        channels: 3,\n        background: 'red'\n      }\n    }).resize({\n      width: 10,\n      height: 40,\n      fit: 'outside'\n    }).composite([{\n      input: {\n        create: {\n          width: 16,\n          height: 16,\n          channels: 3,\n          background: 'green'\n        }\n      },\n      tile: true\n    }]).toBuffer({\n      resolveWithObject: true\n    });\n    assert.strictEqual(info.width, 40);\n    assert.strictEqual(info.height, 40);\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"Ensure implict unpremultiply after resize but before composite","suites":["composite","validation"],"updatePoint":{"line":458,"column":68,"index":13435},"line":458,"code":"  it('Ensure implict unpremultiply after resize but before composite', async () => {\n    const [r, g, b, a] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 4,\n        background: 'saddlebrown'\n      }\n    }).resize({\n      width: 8\n    }).composite([{\n      input: Buffer.from([255, 255, 255, 128]),\n      raw: {\n        width: 1,\n        height: 1,\n        channels: 4\n      },\n      tile: true,\n      blend: 'dest-in'\n    }]).raw().toBuffer();\n    assert.strictEqual(r, 139);\n    assert.strictEqual(g, 69);\n    assert.strictEqual(b, 19);\n    assert.strictEqual(a, 128);\n  });","file":"unit/composite.js","skipped":false,"dir":"test"},{"name":"specific convolution kernel 1","suites":["Convolve"],"updatePoint":{"line":10,"column":35,"index":278},"line":10,"code":"  it('specific convolution kernel 1', function (done) {\n    sharp(fixtures.inputPngStripesV).convolve({\n      width: 3,\n      height: 3,\n      scale: 50,\n      offset: 0,\n      kernel: [10, 20, 10, 0, 0, 0, 10, 20, 10]\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('conv-1.png'), data, done);\n    });\n  });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"specific convolution kernel 2","suites":["Convolve"],"updatePoint":{"line":25,"column":35,"index":790},"line":25,"code":"  it('specific convolution kernel 2', function (done) {\n    sharp(fixtures.inputPngStripesH).convolve({\n      width: 3,\n      height: 3,\n      kernel: [1, 0, 1, 2, 0, 2, 1, 0, 1]\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('conv-2.png'), data, done);\n    });\n  });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"horizontal Sobel operator","suites":["Convolve"],"updatePoint":{"line":38,"column":31,"index":1258},"line":38,"code":"  it('horizontal Sobel operator', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).convolve({\n      width: 3,\n      height: 3,\n      kernel: [-1, 0, 1, -2, 0, 2, -1, 0, 1]\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('conv-sobel-horizontal.jpg'), data, done);\n    });\n  });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"missing","suites":["Convolve","invalid kernel specification"],"updatePoint":{"line":52,"column":15,"index":1795},"line":52,"code":"    it('missing', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).convolve({});\n      });\n    });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"incorrect data format","suites":["Convolve","invalid kernel specification"],"updatePoint":{"line":57,"column":29,"index":1940},"line":57,"code":"    it('incorrect data format', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).convolve({\n          width: 3,\n          height: 3,\n          kernel: [[1, 2, 3], [4, 5, 6], [7, 8, 9]]\n        });\n      });\n    });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"incorrect dimensions","suites":["Convolve","invalid kernel specification"],"updatePoint":{"line":66,"column":28,"index":2186},"line":66,"code":"    it('incorrect dimensions', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).convolve({\n          width: 3,\n          height: 4,\n          kernel: [1, 2, 3, 4, 5, 6, 7, 8, 9]\n        });\n      });\n    });","file":"unit/convolve.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":11,"column":12,"index":325},"line":11,"code":"    it('JPEG', function (done) {\n      sharp(fixtures.inputJpg).resize(120).extend(10).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(140, info.width);\n        assert.strictEqual(118, info.height);\n        fixtures.assertSimilar(fixtures.expected('extend-equal-single.jpg'), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"Animated WebP","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":19,"column":21,"index":686},"line":19,"code":"    it('Animated WebP', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(120).extend(10).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(140, info.width);\n        assert.strictEqual(140 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected('extend-equal-single.webp'), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"extends all sides with animated WebP ()","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":31,"column":60,"index":1204},"line":31,"code":"    it(`extends all sides with animated WebP (${extendWith})`, function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(120).extend({\n        extendWith: extendWith,\n        top: 40,\n        bottom: 40,\n        left: 40,\n        right: 40\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(200, info.width);\n        assert.strictEqual(200 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected(`extend-equal-${extendWith}.webp`), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"extend all sides equally with RGB ()","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":47,"column":57,"index":1763},"line":47,"code":"    it(`extend all sides equally with RGB (${extendWith})`, function (done) {\n      sharp(fixtures.inputJpg).resize(120).extend({\n        extendWith: extendWith,\n        top: 10,\n        bottom: 10,\n        left: 10,\n        right: 10,\n        background: {\n          r: 255,\n          g: 0,\n          b: 0\n        }\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(140, info.width);\n        assert.strictEqual(118, info.height);\n        fixtures.assertSimilar(fixtures.expected(`extend-equal-${extendWith}.jpg`), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"extend sides unequally with RGBA ()","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":66,"column":56,"index":2360},"line":66,"code":"    it(`extend sides unequally with RGBA (${extendWith})`, function (done) {\n      sharp(fixtures.inputPngWithTransparency16bit).resize(120).extend({\n        extendWith: extendWith,\n        top: 50,\n        left: 10,\n        right: 35,\n        background: {\n          r: 0,\n          g: 0,\n          b: 0,\n          alpha: 0\n        }\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(165, info.width);\n        assert.strictEqual(170, info.height);\n        fixtures.assertSimilar(fixtures.expected(`extend-unequal-${extendWith}.png`), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"PNG with 2 channels ()","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":85,"column":43,"index":2965},"line":85,"code":"    it(`PNG with 2 channels (${extendWith})`, function (done) {\n      sharp(fixtures.inputPngWithGreyAlpha).extend({\n        extendWith: extendWith,\n        top: 50,\n        bottom: 50,\n        left: 80,\n        right: 80,\n        background: 'transparent'\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(560, info.width);\n        assert.strictEqual(400, info.height);\n        assert.strictEqual(4, info.channels);\n        fixtures.assertSimilar(fixtures.expected(`extend-2channel-${extendWith}.png`), data, done);\n      });\n    });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"missing parameter fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":104,"column":29,"index":3643},"line":104,"code":"  it('missing parameter fails', function () {\n    assert.throws(function () {\n      sharp().extend();\n    });\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"negative fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":109,"column":20,"index":3750},"line":109,"code":"  it('negative fails', function () {\n    assert.throws(function () {\n      sharp().extend(-1);\n    });\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"invalid top fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":114,"column":23,"index":3862},"line":114,"code":"  it('invalid top fails', () => {\n    assert.throws(() => sharp().extend({\n      top: 'fail'\n    }), /Expected positive integer for top but received fail of type string/);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"invalid bottom fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":119,"column":26,"index":4043},"line":119,"code":"  it('invalid bottom fails', () => {\n    assert.throws(() => sharp().extend({\n      bottom: -1\n    }), /Expected positive integer for bottom but received -1 of type number/);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"invalid left fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":124,"column":24,"index":4222},"line":124,"code":"  it('invalid left fails', () => {\n    assert.throws(() => sharp().extend({\n      left: 0.1\n    }), /Expected positive integer for left but received 0.1 of type number/);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"invalid right fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":129,"column":25,"index":4400},"line":129,"code":"  it('invalid right fails', () => {\n    assert.throws(() => sharp().extend({\n      right: {}\n    }), /Expected positive integer for right but received \\[object Object\\] of type object/);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"invalid extendWith fails","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":134,"column":30,"index":4598},"line":134,"code":"  it('invalid extendWith fails', () => {\n    assert.throws(() => sharp().extend({\n      extendWith: 'invalid-value'\n    }), /Expected one of: background, copy, repeat, mirror for extendWith but received invalid-value of type string/);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"can set all edges apart from right","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":139,"column":40,"index":4849},"line":139,"code":"  it('can set all edges apart from right', () => {\n    assert.doesNotThrow(() => sharp().extend({\n      top: 1,\n      left: 2,\n      bottom: 3\n    }));\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"should add alpha channel before extending with a transparent Background","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":146,"column":77,"index":5044},"line":146,"code":"  it('should add alpha channel before extending with a transparent Background', function (done) {\n    sharp(fixtures.inputJpgWithLandscapeExif1).extend({\n      bottom: 10,\n      right: 10,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      }\n    }).toFormat(sharp.format.png).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(610, info.width);\n      assert.strictEqual(460, info.height);\n      fixtures.assertSimilar(fixtures.expected('addAlphaChanelBeforeExtend.png'), data, done);\n    });\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"Premultiply background when compositing","suites":["Extend","extend all sides equally via a single value"],"updatePoint":{"line":163,"column":45,"index":5582},"line":163,"code":"  it('Premultiply background when compositing', async () => {\n    const background = {\n      r: 191,\n      g: 25,\n      b: 66,\n      alpha: 0.8\n    };\n    const data = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 4,\n        background: '#fff0'\n      }\n    }).composite([{\n      input: {\n        create: {\n          width: 1,\n          height: 1,\n          channels: 4,\n          background\n        }\n      }\n    }]).extend({\n      left: 1,\n      background\n    }).raw().toBuffer();\n    assert.deepStrictEqual(Array.from(data), [191, 25, 66, 204, 191, 25, 66, 204]);\n  });","file":"unit/extend.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Partial image extraction"],"updatePoint":{"line":10,"column":10,"index":269},"line":10,"code":"  it('JPEG', function (done) {\n    sharp(fixtures.inputJpg).extract({\n      left: 2,\n      top: 2,\n      width: 20,\n      height: 20\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(20, info.width);\n      assert.strictEqual(20, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"PNG","suites":["Partial image extraction"],"updatePoint":{"line":23,"column":9,"index":647},"line":23,"code":"  it('PNG', function (done) {\n    sharp(fixtures.inputPng).extract({\n      left: 200,\n      top: 300,\n      width: 400,\n      height: 200\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(400, info.width);\n      assert.strictEqual(200, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract.png'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"WebP","suites":["Partial image extraction"],"updatePoint":{"line":36,"column":10,"index":1034},"line":36,"code":"  it('WebP', function (done) {\n    sharp(fixtures.inputWebP).extract({\n      left: 100,\n      top: 50,\n      width: 125,\n      height: 200\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(125, info.width);\n      assert.strictEqual(200, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract.webp'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Before resize","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":50,"column":21,"index":1475},"line":50,"code":"    it('Before resize', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).extract({\n        left: 0,\n        top: 30,\n        width: 80,\n        height: 20\n      }).resize(320, 80).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected('gravity-center-height.webp'), data, done);\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"After resize","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":65,"column":20,"index":1963},"line":65,"code":"    it('After resize', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(320, 320).extract({\n        left: 0,\n        top: 120,\n        width: 320,\n        height: 80\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected('gravity-center-height.webp'), data, done);\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"TIFF","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":81,"column":10,"index":2450},"line":81,"code":"  it('TIFF', function (done) {\n    sharp(fixtures.inputTiff).extract({\n      left: 34,\n      top: 63,\n      width: 341,\n      height: 529\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(341, info.width);\n      assert.strictEqual(529, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract.tiff'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Before resize","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":94,"column":19,"index":2846},"line":94,"code":"  it('Before resize', function (done) {\n    sharp(fixtures.inputJpg).extract({\n      left: 10,\n      top: 10,\n      width: 10,\n      height: 500\n    }).resize(100, 100).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(100, info.width);\n      assert.strictEqual(100, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-resize.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"After resize and crop","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":107,"column":27,"index":3271},"line":107,"code":"  it('After resize and crop', function (done) {\n    sharp(fixtures.inputJpg).resize(500, 500, {\n      position: sharp.gravity.north\n    }).extract({\n      left: 10,\n      top: 10,\n      width: 100,\n      height: 100\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(100, info.width);\n      assert.strictEqual(100, info.height);\n      fixtures.assertSimilar(fixtures.expected('resize-crop-extract.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Before and after resize and crop","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":122,"column":38,"index":3758},"line":122,"code":"  it('Before and after resize and crop', function (done) {\n    sharp(fixtures.inputJpg).extract({\n      left: 0,\n      top: 0,\n      width: 700,\n      height: 700\n    }).resize(500, 500, {\n      position: sharp.gravity.north\n    }).extract({\n      left: 10,\n      top: 10,\n      width: 100,\n      height: 100\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(100, info.width);\n      assert.strictEqual(100, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-resize-crop-extract.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Extract then rotate","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":142,"column":25,"index":4322},"line":142,"code":"  it('Extract then rotate', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).extract({\n      left: 20,\n      top: 10,\n      width: 380,\n      height: 280\n    }).rotate(90).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(280, info.width);\n      assert.strictEqual(380, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-rotate.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Rotate then extract","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":155,"column":25,"index":4760},"line":155,"code":"  it('Rotate then extract', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).rotate(90).extract({\n      left: 20,\n      top: 10,\n      width: 280,\n      height: 380\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(280, info.width);\n      assert.strictEqual(380, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-extract.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Extract then rotate then extract","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":168,"column":38,"index":5204},"line":168,"code":"  it('Extract then rotate then extract', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).extract({\n      left: 20,\n      top: 10,\n      width: 180,\n      height: 280\n    }).rotate(90).extract({\n      left: 20,\n      top: 10,\n      width: 200,\n      height: 100\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-rotate-extract.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Extract then rotate non-90 anagle","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":186,"column":39,"index":5741},"line":186,"code":"  it('Extract then rotate non-90 anagle', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).extract({\n      left: 20,\n      top: 10,\n      width: 380,\n      height: 280\n    }).rotate(45).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(467, info.width);\n      assert.strictEqual(467, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-rotate-45.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Rotate then extract non-90 angle","suites":["Partial image extraction","Animated WebP"],"updatePoint":{"line":199,"column":38,"index":6195},"line":199,"code":"  it('Rotate then extract non-90 angle', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).rotate(45).extract({\n      left: 20,\n      top: 10,\n      width: 380,\n      height: 280\n    }).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(380, info.width);\n      assert.strictEqual(280, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-extract-45.jpg'), data, done);\n    });\n  });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"String top","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":256,"column":20,"index":7884},"line":256,"code":"      it('String top', function () {\n        assert.throws(function () {\n          sharp(fixtures.inputJpg).extract('spoons', 10, 10, 10);\n        });\n      });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Non-integral left","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":261,"column":27,"index":8052},"line":261,"code":"      it('Non-integral left', function () {\n        assert.throws(function () {\n          sharp(fixtures.inputJpg).extract(10, 10.2, 10, 10);\n        });\n      });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Negative width - negative","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":266,"column":35,"index":8224},"line":266,"code":"      it('Negative width - negative', function () {\n        assert.throws(function () {\n          sharp(fixtures.inputJpg).extract(10, 10, -10, 10);\n        });\n      });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Null height","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":271,"column":21,"index":8381},"line":271,"code":"      it('Null height', function () {\n        assert.throws(function () {\n          sharp(fixtures.inputJpg).extract(10, 10, 10, null);\n        });\n      });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Undefined","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":277,"column":17,"index":8543},"line":277,"code":"    it('Undefined', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).extract();\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"String top","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":282,"column":18,"index":8674},"line":282,"code":"    it('String top', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).extract({\n          left: 10,\n          top: 'spoons',\n          width: 10,\n          height: 10\n        });\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Non-integral left","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":292,"column":25,"index":8910},"line":292,"code":"    it('Non-integral left', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).extract({\n          left: 10.2,\n          top: 10,\n          width: 10,\n          height: 10\n        });\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Negative width - negative","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":302,"column":33,"index":9150},"line":302,"code":"    it('Negative width - negative', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).extract({\n          left: 10,\n          top: 10,\n          width: -10,\n          height: 10\n        });\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Null height","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":312,"column":19,"index":9375},"line":312,"code":"    it('Null height', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).extract({\n          left: 10,\n          top: 10,\n          width: 10,\n          height: null\n        });\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Bad image area","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":322,"column":22,"index":9604},"line":322,"code":"    it('Bad image area', function (done) {\n      sharp(fixtures.inputJpg).extract({\n        left: 3000,\n        top: 10,\n        width: 10,\n        height: 10\n      }).toBuffer(function (err) {\n        assert(err instanceof Error);\n        assert.strictEqual(err.message, 'extract_area: bad extract area');\n        done();\n      });\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Multiple extract emits warning","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":334,"column":38,"index":9961},"line":334,"code":"    it('Multiple extract emits warning', () => {\n      let warningMessage = '';\n      const s = sharp();\n      s.on('warning', function (msg) {\n        warningMessage = msg;\n      });\n      const options = {\n        top: 0,\n        left: 0,\n        width: 1,\n        height: 1\n      };\n      s.extract(options).extract(options);\n      assert.strictEqual(warningMessage, '');\n      s.extract(options);\n      assert.strictEqual(warningMessage, 'ignoring previous extract options');\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Multiple rotate+extract emits warning","suites":["Partial image extraction","Invalid parameters","using the legacy extract(top,left,width,height) syntax"],"updatePoint":{"line":351,"column":45,"index":10456},"line":351,"code":"    it('Multiple rotate+extract emits warning', () => {\n      let warningMessage = '';\n      const s = sharp().rotate();\n      s.on('warning', function (msg) {\n        warningMessage = msg;\n      });\n      const options = {\n        top: 0,\n        left: 0,\n        width: 1,\n        height: 1\n      };\n      s.extract(options).extract(options);\n      assert.strictEqual(warningMessage, '');\n      s.extract(options);\n      assert.strictEqual(warningMessage, 'ignoring previous extract options');\n    });","file":"unit/extract.js","skipped":false,"dir":"test"},{"name":"Red channel","suites":["Image channel extraction"],"updatePoint":{"line":10,"column":17,"index":276},"line":10,"code":"  it('Red channel', function (done) {\n    sharp(fixtures.inputJpg).extractChannel('red').resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-red.jpg'), data, done);\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Green channel","suites":["Image channel extraction"],"updatePoint":{"line":18,"column":19,"index":629},"line":18,"code":"  it('Green channel', function (done) {\n    sharp(fixtures.inputJpg).extractChannel('green').resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-green.jpg'), data, done);\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Blue channel","suites":["Image channel extraction"],"updatePoint":{"line":26,"column":18,"index":985},"line":26,"code":"  it('Blue channel', function (done) {\n    sharp(fixtures.inputJpg).extractChannel('blue').resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-blue.jpg'), data, done);\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Blue channel by number","suites":["Image channel extraction"],"updatePoint":{"line":34,"column":28,"index":1349},"line":34,"code":"  it('Blue channel by number', function (done) {\n    sharp(fixtures.inputJpg).extractChannel(2).resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('extract-blue.jpg'), data, done);\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"With colorspace conversion","suites":["Image channel extraction"],"updatePoint":{"line":42,"column":32,"index":1712},"line":42,"code":"  it('With colorspace conversion', async () => {\n    const [chroma] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: 'red'\n      }\n    }).toColourspace('lch').extractChannel(1).toBuffer();\n    assert.strictEqual(chroma, 104);\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Alpha from 16-bit PNG","suites":["Image channel extraction"],"updatePoint":{"line":53,"column":27,"index":2000},"line":53,"code":"  it('Alpha from 16-bit PNG', function (done) {\n    const output = fixtures.path('output.extract-alpha-16bit.png');\n    sharp(fixtures.inputPngWithTransparency16bit).resize(16).extractChannel(3).toFile(output, function (err) {\n      if (err) throw err;\n      fixtures.assertMaxColourDistance(output, fixtures.expected('extract-alpha-16bit.png'));\n      done();\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Alpha from 2-channel input","suites":["Image channel extraction"],"updatePoint":{"line":61,"column":32,"index":2380},"line":61,"code":"  it('Alpha from 2-channel input', function (done) {\n    const output = fixtures.path('output.extract-alpha-2-channel.png');\n    sharp(fixtures.inputPngWithGreyAlpha).extractChannel('alpha').toColourspace('b-w').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(1, info.channels);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('extract-alpha-2-channel.png'));\n      done();\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Invalid channel number","suites":["Image channel extraction"],"updatePoint":{"line":70,"column":28,"index":2822},"line":70,"code":"  it('Invalid channel number', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).extractChannel(-1);\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"No arguments","suites":["Image channel extraction"],"updatePoint":{"line":75,"column":18,"index":2954},"line":75,"code":"  it('No arguments', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).extractChannel();\n    });\n  });","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"Non-existent channel","suites":["Image channel extraction"],"updatePoint":{"line":80,"column":26,"index":3092},"line":80,"code":"  it('Non-existent channel', async () => await assert.rejects(() => sharp({\n    create: {\n      width: 1,\n      height: 1,\n      channels: 3,\n      background: 'red'\n    }\n  }).extractChannel(3).toBuffer(), /Cannot extract channel 3 from image with channels 0-2/));","file":"unit/extractChannel.js","skipped":false,"dir":"test"},{"name":"handles truncated JPEG","suites":["failOn"],"updatePoint":{"line":11,"column":28,"index":292},"line":11,"code":"  it('handles truncated JPEG', function (done) {\n    sharp(fixtures.inputJpgTruncated, {\n      failOn: 'none'\n    }).resize(32, 24).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(24, info.height);\n      fixtures.assertSimilar(fixtures.expected('truncated.jpg'), data, done);\n    });\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"handles truncated PNG, emits warnings","suites":["failOn"],"updatePoint":{"line":22,"column":43,"index":727},"line":22,"code":"  it('handles truncated PNG, emits warnings', function (done) {\n    let isWarningEmitted = false;\n    sharp(fixtures.inputPngTruncated, {\n      failOn: 'none'\n    }).on('warning', function (warning) {\n      assert.ok(['read gave 2 warnings', 'not enough data', 'end of stream'].some(m => warning.includes(m)));\n      isWarningEmitted = true;\n    }).resize(32, 24).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, isWarningEmitted);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(24, info.height);\n      done();\n    });\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"throws for invalid options","suites":["failOn"],"updatePoint":{"line":38,"column":32,"index":1353},"line":38,"code":"  it('throws for invalid options', () => {\n    assert.throws(() => sharp({\n      failOn: 'zoinks'\n    }), /Expected one of: none, truncated, error, warning for failOn but received zoinks of type string/);\n    assert.throws(() => sharp({\n      failOn: 1\n    }), /Expected one of: none, truncated, error, warning for failOn but received 1 of type number/);\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"deprecated failOnError","suites":["failOn"],"updatePoint":{"line":46,"column":28,"index":1710},"line":46,"code":"  it('deprecated failOnError', () => {\n    assert.doesNotThrow(() => sharp({\n      failOnError: true\n    }));\n    assert.doesNotThrow(() => sharp({\n      failOnError: false\n    }));\n    assert.throws(() => sharp({\n      failOnError: 'zoinks'\n    }), /Expected boolean for failOnError but received zoinks of type string/);\n    assert.throws(() => sharp({\n      failOnError: 1\n    }), /Expected boolean for failOnError but received 1 of type number/);\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"returns errors to callback for truncated JPEG","suites":["failOn"],"updatePoint":{"line":60,"column":51,"index":2189},"line":60,"code":"  it('returns errors to callback for truncated JPEG', function (done) {\n    sharp(fixtures.inputJpgTruncated, {\n      failOn: 'truncated'\n    }).toBuffer(function (err, data, info) {\n      assert.ok(err.message.includes('VipsJpeg: Premature end of'), err);\n      assert.strictEqual(data, undefined);\n      assert.strictEqual(info, undefined);\n      done();\n    });\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"returns errors to callback for truncated PNG","suites":["failOn"],"updatePoint":{"line":70,"column":50,"index":2559},"line":70,"code":"  it('returns errors to callback for truncated PNG', function (done) {\n    sharp(fixtures.inputPngTruncated, {\n      failOn: 'truncated'\n    }).toBuffer(function (err, data, info) {\n      assert.ok(err.message.includes('read error'), err);\n      assert.strictEqual(data, undefined);\n      assert.strictEqual(info, undefined);\n      done();\n    });\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"rejects promises for truncated JPEG","suites":["failOn"],"updatePoint":{"line":80,"column":41,"index":2904},"line":80,"code":"  it('rejects promises for truncated JPEG', function (done) {\n    sharp(fixtures.inputJpgTruncated, {\n      failOn: 'error'\n    }).toBuffer().then(() => {\n      throw new Error('Expected rejection');\n    }).catch(err => {\n      done(err.message.includes('VipsJpeg: Premature end of') ? undefined : err);\n    });\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"handles stream-based input","suites":["failOn"],"updatePoint":{"line":89,"column":32,"index":3213},"line":89,"code":"  it('handles stream-based input', async () => {\n    const writable = sharp({\n      failOn: 'none'\n    }).resize(32, 24);\n    fs.createReadStream(fixtures.inputJpgTruncated).pipe(writable);\n    return writable.toBuffer();\n  });","file":"unit/failOn.js","skipped":false,"dir":"test"},{"name":"should throw an Error when images have a different number of channels","suites":["Test fixtures","assertMaxColourDistance"],"updatePoint":{"line":10,"column":77,"index":344},"line":10,"code":"    it('should throw an Error when images have a different number of channels', function () {\n      assert.throws(function () {\n        fixtures.assertMaxColourDistance(fixtures.inputPngOverlayLayer1, fixtures.inputJpg);\n      });\n    });","file":"unit/fixtures.js","skipped":false,"dir":"test"},{"name":"should throw an Error when images have different dimensions","suites":["Test fixtures","assertMaxColourDistance"],"updatePoint":{"line":15,"column":67,"index":573},"line":15,"code":"    it('should throw an Error when images have different dimensions', function () {\n      assert.throws(function () {\n        fixtures.assertMaxColourDistance(fixtures.inputJpg, fixtures.inputJpgWithExif);\n      });\n    });","file":"unit/fixtures.js","skipped":false,"dir":"test"},{"name":"should accept a zero threshold when comparing an image to itself","suites":["Test fixtures","assertMaxColourDistance"],"updatePoint":{"line":20,"column":72,"index":802},"line":20,"code":"    it('should accept a zero threshold when comparing an image to itself', function () {\n      const image = fixtures.inputPngOverlayLayer0;\n      fixtures.assertMaxColourDistance(image, image, 0);\n    });","file":"unit/fixtures.js","skipped":false,"dir":"test"},{"name":"should accept a numeric threshold for two different images","suites":["Test fixtures","assertMaxColourDistance"],"updatePoint":{"line":24,"column":66,"index":1002},"line":24,"code":"    it('should accept a numeric threshold for two different images', function () {\n      fixtures.assertMaxColourDistance(fixtures.inputPngOverlayLayer0, fixtures.inputPngOverlayLayer1, 100);\n    });","file":"unit/fixtures.js","skipped":false,"dir":"test"},{"name":"value of 0.0 (disabled)","suites":["Gamma correction"],"updatePoint":{"line":10,"column":29,"index":280},"line":10,"code":"  it('value of 0.0 (disabled)', function (done) {\n    sharp(fixtures.inputJpgWithGammaHoliness).resize(129, 111).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(129, info.width);\n      assert.strictEqual(111, info.height);\n      fixtures.assertSimilar(fixtures.expected('gamma-0.0.jpg'), data, {\n        threshold: 9\n      }, done);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"value of 2.2 (default)","suites":["Gamma correction"],"updatePoint":{"line":21,"column":28,"index":714},"line":21,"code":"  it('value of 2.2 (default)', function (done) {\n    sharp(fixtures.inputJpgWithGammaHoliness).resize(129, 111).gamma().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(129, info.width);\n      assert.strictEqual(111, info.height);\n      fixtures.assertSimilar(fixtures.expected('gamma-2.2.jpg'), data, done);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"value of 3.0","suites":["Gamma correction"],"updatePoint":{"line":30,"column":18,"index":1114},"line":30,"code":"  it('value of 3.0', function (done) {\n    sharp(fixtures.inputJpgWithGammaHoliness).resize(129, 111).gamma(3).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(129, info.width);\n      assert.strictEqual(111, info.height);\n      fixtures.assertSimilar(fixtures.expected('gamma-3.0.jpg'), data, {\n        threshold: 6\n      }, done);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"input value of 2.2, output value of 3.0","suites":["Gamma correction"],"updatePoint":{"line":41,"column":45,"index":1574},"line":41,"code":"  it('input value of 2.2, output value of 3.0', function (done) {\n    sharp(fixtures.inputJpgWithGammaHoliness).resize(129, 111).gamma(2.2, 3.0).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(129, info.width);\n      assert.strictEqual(111, info.height);\n      fixtures.assertSimilar(fixtures.expected('gamma-in-2.2-out-3.0.jpg'), data, {\n        threshold: 6\n      }, done);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"alpha transparency","suites":["Gamma correction"],"updatePoint":{"line":52,"column":24,"index":2031},"line":52,"code":"  it('alpha transparency', function (done) {\n    sharp(fixtures.inputPngOverlayLayer1).resize(320).gamma().jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      fixtures.assertSimilar(fixtures.expected('gamma-alpha.jpg'), data, done);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"invalid first parameter value","suites":["Gamma correction"],"updatePoint":{"line":60,"column":35,"index":2404},"line":60,"code":"  it('invalid first parameter value', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgWithGammaHoliness).gamma(4);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"invalid second parameter value","suites":["Gamma correction"],"updatePoint":{"line":65,"column":36,"index":2561},"line":65,"code":"  it('invalid second parameter value', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpgWithGammaHoliness).gamma(2.2, 4);\n    });\n  });","file":"unit/gamma.js","skipped":false,"dir":"test"},{"name":"GIF Buffer to JPEG Buffer","suites":["GIF input"],"updatePoint":{"line":11,"column":31,"index":295},"line":11,"code":"  it('GIF Buffer to JPEG Buffer', () => sharp(fs.readFileSync(fixtures.inputGif)).resize(8, 4).jpeg().toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(true, data.length > 0);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual('jpeg', info.format);\n    assert.strictEqual(8, info.width);\n    assert.strictEqual(4, info.height);\n  }));","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"2 channel GIF file to PNG Buffer","suites":["GIF input"],"updatePoint":{"line":23,"column":38,"index":711},"line":23,"code":"  it('2 channel GIF file to PNG Buffer', () => sharp(fixtures.inputGifGreyPlusAlpha).resize(8, 4).png().toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(true, data.length > 0);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual('png', info.format);\n    assert.strictEqual(8, info.width);\n    assert.strictEqual(4, info.height);\n    assert.strictEqual(4, info.channels);\n  }));","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"Animated GIF first page to PNG","suites":["GIF input"],"updatePoint":{"line":36,"column":36,"index":1161},"line":36,"code":"  it('Animated GIF first page to PNG', () => sharp(fixtures.inputGifAnimated).toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(true, data.length > 0);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual('gif', info.format);\n    assert.strictEqual(80, info.width);\n    assert.strictEqual(80, info.height);\n    assert.strictEqual(4, info.channels);\n  }));","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"Animated GIF all pages to PNG \"toilet roll\"","suites":["GIF input"],"updatePoint":{"line":49,"column":49,"index":1602},"line":49,"code":"  it('Animated GIF all pages to PNG \"toilet roll\"', () => sharp(fixtures.inputGifAnimated, {\n    pages: -1\n  }).toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(true, data.length > 0);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual('gif', info.format);\n    assert.strictEqual(80, info.width);\n    assert.strictEqual(2400, info.height);\n    assert.strictEqual(4, info.channels);\n  }));","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"GIF with reduced colours, no dither, low effort reduces file size","suites":["GIF input"],"updatePoint":{"line":64,"column":71,"index":2088},"line":64,"code":"  it('GIF with reduced colours, no dither, low effort reduces file size', async () => {\n    const original = await sharp(fixtures.inputJpg).resize(120, 80).gif().toBuffer();\n    const reduced = await sharp(fixtures.inputJpg).resize(120, 80).gif({\n      colours: 128,\n      dither: 0,\n      effort: 1\n    }).toBuffer();\n    assert.strictEqual(true, reduced.length < original.length);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"valid reuse","suites":["GIF input"],"updatePoint":{"line":73,"column":17,"index":2423},"line":73,"code":"  it('valid reuse', () => {\n    assert.doesNotThrow(() => sharp().gif({\n      reuse: true\n    }));\n    assert.doesNotThrow(() => sharp().gif({\n      reuse: false\n    }));\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid reuse throws","suites":["GIF input"],"updatePoint":{"line":81,"column":26,"index":2609},"line":81,"code":"  it('invalid reuse throws', () => {\n    assert.throws(() => sharp().gif({\n      reuse: -1\n    }), /Expected boolean for gifReuse but received -1 of type number/);\n    assert.throws(() => sharp().gif({\n      reuse: 'fail'\n    }), /Expected boolean for gifReuse but received fail of type string/);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"progressive changes file size","suites":["GIF input"],"updatePoint":{"line":89,"column":35,"index":2921},"line":89,"code":"  it('progressive changes file size', async () => {\n    const nonProgressive = await sharp(fixtures.inputGif).gif({\n      progressive: false\n    }).toBuffer();\n    const progressive = await sharp(fixtures.inputGif).gif({\n      progressive: true\n    }).toBuffer();\n    assert(nonProgressive.length !== progressive.length);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid progressive throws","suites":["GIF input"],"updatePoint":{"line":98,"column":32,"index":3246},"line":98,"code":"  it('invalid progressive throws', () => {\n    assert.throws(() => sharp().gif({\n      progressive: -1\n    }), /Expected boolean for gifProgressive but received -1 of type number/);\n    assert.throws(() => sharp().gif({\n      progressive: 'fail'\n    }), /Expected boolean for gifProgressive but received fail of type string/);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid loop throws","suites":["GIF input"],"updatePoint":{"line":106,"column":25,"index":3572},"line":106,"code":"  it('invalid loop throws', () => {\n    assert.throws(() => {\n      sharp().gif({\n        loop: -1\n      });\n    });\n    assert.throws(() => {\n      sharp().gif({\n        loop: 65536\n      });\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid delay throws","suites":["GIF input"],"updatePoint":{"line":118,"column":26,"index":3780},"line":118,"code":"  it('invalid delay throws', () => {\n    assert.throws(() => {\n      sharp().gif({\n        delay: -1\n      });\n    });\n    assert.throws(() => {\n      sharp().gif({\n        delay: [65536]\n      });\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid colour throws","suites":["GIF input"],"updatePoint":{"line":130,"column":27,"index":3993},"line":130,"code":"  it('invalid colour throws', () => {\n    assert.throws(() => {\n      sharp().gif({\n        colours: 1\n      });\n    });\n    assert.throws(() => {\n      sharp().gif({\n        colours: 'fail'\n      });\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid effort throws","suites":["GIF input"],"updatePoint":{"line":142,"column":27,"index":4208},"line":142,"code":"  it('invalid effort throws', () => {\n    assert.throws(() => {\n      sharp().gif({\n        effort: 0\n      });\n    });\n    assert.throws(() => {\n      sharp().gif({\n        effort: 'fail'\n      });\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid dither throws","suites":["GIF input"],"updatePoint":{"line":154,"column":27,"index":4421},"line":154,"code":"  it('invalid dither throws', () => {\n    assert.throws(() => {\n      sharp().gif({\n        dither: 1.1\n      });\n    });\n    assert.throws(() => {\n      sharp().gif({\n        effort: 'fail'\n      });\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid interFrameMaxError throws","suites":["GIF input"],"updatePoint":{"line":166,"column":39,"index":4648},"line":166,"code":"  it('invalid interFrameMaxError throws', () => {\n    assert.throws(() => sharp().gif({\n      interFrameMaxError: 33\n    }), /Expected number between 0.0 and 32.0 for interFrameMaxError but received 33 of type number/);\n    assert.throws(() => sharp().gif({\n      interFrameMaxError: 'fail'\n    }), /Expected number between 0.0 and 32.0 for interFrameMaxError but received fail of type string/);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"invalid interPaletteMaxError throws","suites":["GIF input"],"updatePoint":{"line":174,"column":41,"index":5052},"line":174,"code":"  it('invalid interPaletteMaxError throws', () => {\n    assert.throws(() => sharp().gif({\n      interPaletteMaxError: 257\n    }), /Expected number between 0.0 and 256.0 for interPaletteMaxError but received 257 of type number/);\n    assert.throws(() => sharp().gif({\n      interPaletteMaxError: 'fail'\n    }), /Expected number between 0.0 and 256.0 for interPaletteMaxError but received fail of type string/);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"should work with streams when only animated is set","suites":["GIF input"],"updatePoint":{"line":182,"column":56,"index":5483},"line":182,"code":"  it('should work with streams when only animated is set', function (done) {\n    fs.createReadStream(fixtures.inputGifAnimated).pipe(sharp({\n      animated: true\n    })).gif().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('gif', info.format);\n      fixtures.assertSimilar(fixtures.inputGifAnimated, data, done);\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"should work with streams when only pages is set","suites":["GIF input"],"updatePoint":{"line":192,"column":53,"index":5898},"line":192,"code":"  it('should work with streams when only pages is set', function (done) {\n    fs.createReadStream(fixtures.inputGifAnimated).pipe(sharp({\n      pages: -1\n    })).gif().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('gif', info.format);\n      fixtures.assertSimilar(fixtures.inputGifAnimated, data, done);\n    });\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"should optimise file size via interFrameMaxError","suites":["GIF input"],"updatePoint":{"line":202,"column":54,"index":6309},"line":202,"code":"  it('should optimise file size via interFrameMaxError', async () => {\n    const input = sharp(fixtures.inputGifAnimated, {\n      animated: true\n    });\n    const before = await input.gif({\n      interFrameMaxError: 0\n    }).toBuffer();\n    const after = await input.gif({\n      interFrameMaxError: 10\n    }).toBuffer();\n    assert.strict(before.length > after.length);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"should optimise file size via interPaletteMaxError","suites":["GIF input"],"updatePoint":{"line":214,"column":56,"index":6687},"line":214,"code":"  it('should optimise file size via interPaletteMaxError', async () => {\n    const input = sharp(fixtures.inputGifAnimated, {\n      animated: true\n    });\n    const before = await input.gif({\n      interPaletteMaxError: 0\n    }).toBuffer();\n    const after = await input.gif({\n      interPaletteMaxError: 100\n    }).toBuffer();\n    assert.strict(before.length > after.length);\n  });","file":"unit/gif.js","skipped":false,"dir":"test"},{"name":"called without options does not throw an error","suites":["HEIF"],"updatePoint":{"line":9,"column":52,"index":244},"line":9,"code":"  it('called without options does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif();\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"valid quality does not throw an error","suites":["HEIF"],"updatePoint":{"line":14,"column":43,"index":366},"line":14,"code":"  it('valid quality does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif({\n        quality: 80\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"invalid quality should throw an error","suites":["HEIF"],"updatePoint":{"line":21,"column":43,"index":517},"line":21,"code":"  it('invalid quality should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        quality: 101\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"non-numeric quality should throw an error","suites":["HEIF"],"updatePoint":{"line":28,"column":47,"index":667},"line":28,"code":"  it('non-numeric quality should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        quality: 'fail'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"valid lossless does not throw an error","suites":["HEIF"],"updatePoint":{"line":35,"column":44,"index":817},"line":35,"code":"  it('valid lossless does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif({\n        lossless: true\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"non-boolean lossless should throw an error","suites":["HEIF"],"updatePoint":{"line":42,"column":48,"index":976},"line":42,"code":"  it('non-boolean lossless should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        lossless: 'fail'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"valid compression does not throw an error","suites":["HEIF"],"updatePoint":{"line":49,"column":47,"index":1130},"line":49,"code":"  it('valid compression does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif({\n        compression: 'hevc'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"unknown compression should throw an error","suites":["HEIF"],"updatePoint":{"line":56,"column":47,"index":1293},"line":56,"code":"  it('unknown compression should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        compression: 'fail'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"invalid compression should throw an error","suites":["HEIF"],"updatePoint":{"line":63,"column":47,"index":1450},"line":63,"code":"  it('invalid compression should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        compression: 1\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"valid effort does not throw an error","suites":["HEIF"],"updatePoint":{"line":70,"column":42,"index":1597},"line":70,"code":"  it('valid effort does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif({\n        effort: 6\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"out of range effort should throw an error","suites":["HEIF"],"updatePoint":{"line":77,"column":47,"index":1750},"line":77,"code":"  it('out of range effort should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        effort: 10\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"invalid effort should throw an error","suites":["HEIF"],"updatePoint":{"line":84,"column":42,"index":1893},"line":84,"code":"  it('invalid effort should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        effort: 'fail'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"invalid chromaSubsampling should throw an error","suites":["HEIF"],"updatePoint":{"line":91,"column":53,"index":2051},"line":91,"code":"  it('invalid chromaSubsampling should throw an error', () => {\n    assert.throws(() => {\n      sharp().heif({\n        chromaSubsampling: 'fail'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"valid chromaSubsampling does not throw an error","suites":["HEIF"],"updatePoint":{"line":98,"column":53,"index":2220},"line":98,"code":"  it('valid chromaSubsampling does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().heif({\n        chromaSubsampling: '4:4:4'\n      });\n    });\n  });","file":"unit/heif.js","skipped":false,"dir":"test"},{"name":"Read from File and write to Stream","suites":["Input/output"],"updatePoint":{"line":19,"column":40,"index":502},"line":19,"code":"  it('Read from File and write to Stream', function (done) {\n    const writable = fs.createWriteStream(outputJpg);\n    writable.on('close', function () {\n      sharp(outputJpg).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fs.rm(outputJpg, done);\n      });\n    });\n    sharp(fixtures.inputJpg).resize(320, 240).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Buffer and write to Stream","suites":["Input/output"],"updatePoint":{"line":34,"column":42,"index":1108},"line":34,"code":"  it('Read from Buffer and write to Stream', function (done) {\n    const inputJpgBuffer = fs.readFileSync(fixtures.inputJpg);\n    const writable = fs.createWriteStream(outputJpg);\n    writable.on('close', function () {\n      sharp(outputJpg).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fs.rm(outputJpg, done);\n      });\n    });\n    sharp(inputJpgBuffer).resize(320, 240).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to File","suites":["Input/output"],"updatePoint":{"line":50,"column":40,"index":1772},"line":50,"code":"  it('Read from Stream and write to File', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const pipeline = sharp().resize(320, 240).toFile(outputJpg, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fs.rm(outputJpg, done);\n    });\n    readable.pipe(pipeline);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to Buffer","suites":["Input/output"],"updatePoint":{"line":62,"column":42,"index":2263},"line":62,"code":"  it('Read from Stream and write to Buffer', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const pipeline = sharp().resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual(data.length, info.size);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n    readable.pipe(pipeline);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to Buffer via Promise resolved with Buffer","suites":["Input/output"],"updatePoint":{"line":75,"column":75,"index":2820},"line":75,"code":"  it('Read from Stream and write to Buffer via Promise resolved with Buffer', function () {\n    const pipeline = sharp().resize(1, 1);\n    fs.createReadStream(fixtures.inputJpg).pipe(pipeline);\n    return pipeline.toBuffer({\n      resolveWithObject: false\n    }).then(function (data) {\n      assert.strictEqual(true, data instanceof Buffer);\n      assert.strictEqual(true, data.length > 0);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to Buffer via Promise resolved with Object","suites":["Input/output"],"updatePoint":{"line":85,"column":75,"index":3225},"line":85,"code":"  it('Read from Stream and write to Buffer via Promise resolved with Object', function () {\n    const pipeline = sharp().resize(1, 1);\n    fs.createReadStream(fixtures.inputJpg).pipe(pipeline);\n    return pipeline.toBuffer({\n      resolveWithObject: true\n    }).then(function (object) {\n      assert.strictEqual('object', typeof object);\n      assert.strictEqual('object', typeof object.info);\n      assert.strictEqual('jpeg', object.info.format);\n      assert.strictEqual(1, object.info.width);\n      assert.strictEqual(1, object.info.height);\n      assert.strictEqual(3, object.info.channels);\n      assert.strictEqual(true, object.data instanceof Buffer);\n      assert.strictEqual(true, object.data.length > 0);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from File and write to Buffer via Promise resolved with Buffer","suites":["Input/output"],"updatePoint":{"line":101,"column":73,"index":3952},"line":101,"code":"  it('Read from File and write to Buffer via Promise resolved with Buffer', function () {\n    return sharp(fixtures.inputJpg).resize(1, 1).toBuffer({\n      resolveWithObject: false\n    }).then(function (data) {\n      assert.strictEqual(true, data instanceof Buffer);\n      assert.strictEqual(true, data.length > 0);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from File and write to Buffer via Promise resolved with Object","suites":["Input/output"],"updatePoint":{"line":109,"column":73,"index":4282},"line":109,"code":"  it('Read from File and write to Buffer via Promise resolved with Object', function () {\n    return sharp(fixtures.inputJpg).resize(1, 1).toBuffer({\n      resolveWithObject: true\n    }).then(function (object) {\n      assert.strictEqual('object', typeof object);\n      assert.strictEqual('object', typeof object.info);\n      assert.strictEqual('jpeg', object.info.format);\n      assert.strictEqual(1, object.info.width);\n      assert.strictEqual(1, object.info.height);\n      assert.strictEqual(3, object.info.channels);\n      assert.strictEqual(true, object.data instanceof Buffer);\n      assert.strictEqual(true, object.data.length > 0);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Stream and write to Stream","suites":["Input/output"],"updatePoint":{"line":123,"column":42,"index":4905},"line":123,"code":"  it('Read from Stream and write to Stream', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const writable = fs.createWriteStream(outputJpg);\n    writable.on('close', function () {\n      sharp(outputJpg).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fs.rm(outputJpg, done);\n      });\n    });\n    const pipeline = sharp().resize(320, 240);\n    readable.pipe(pipeline).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from ArrayBuffer and write to Buffer","suites":["Input/output"],"updatePoint":{"line":140,"column":47,"index":5606},"line":140,"code":"  it('Read from ArrayBuffer and write to Buffer', async () => {\n    const uint8array = Uint8Array.from([255, 255, 255, 0, 0, 0]);\n    const arrayBuffer = new ArrayBuffer(uint8array.byteLength);\n    new Uint8Array(arrayBuffer).set(uint8array);\n    const {\n      data,\n      info\n    } = await sharp(arrayBuffer, {\n      raw: {\n        width: 2,\n        height: 1,\n        channels: 3\n      }\n    }).toBuffer({\n      resolveWithObject: true\n    });\n    assert.deepStrictEqual(uint8array, new Uint8Array(data));\n    assert.strictEqual(info.width, 2);\n    assert.strictEqual(info.height, 1);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Uint8Array and write to Buffer","suites":["Input/output"],"updatePoint":{"line":160,"column":46,"index":6199},"line":160,"code":"  it('Read from Uint8Array and write to Buffer', async () => {\n    const uint8array = Uint8Array.from([255, 255, 255, 0, 0, 0]);\n    const {\n      data,\n      info\n    } = await sharp(uint8array, {\n      raw: {\n        width: 2,\n        height: 1,\n        channels: 3\n      }\n    }).toBuffer({\n      resolveWithObject: true\n    });\n    assert.deepStrictEqual(uint8array, new Uint8Array(data));\n    assert.strictEqual(info.width, 2);\n    assert.strictEqual(info.height, 1);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Uint8ClampedArray and output to Buffer","suites":["Input/output"],"updatePoint":{"line":178,"column":54,"index":6686},"line":178,"code":"  it('Read from Uint8ClampedArray and output to Buffer', async () => {\n    // since a Uint8ClampedArray is the same as Uint8Array but clamps the values\n    // between 0-255 it seemed good to add this also\n    const uint8array = Uint8ClampedArray.from([255, 255, 255, 0, 0, 0]);\n    const {\n      data,\n      info\n    } = await sharp(uint8array, {\n      raw: {\n        width: 2,\n        height: 1,\n        channels: 3\n      }\n    }).toBuffer({\n      resolveWithObject: true\n    });\n    assert.deepStrictEqual(uint8array, new Uint8ClampedArray(data));\n    assert.strictEqual(info.width, 2);\n    assert.strictEqual(info.height, 1);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Read from Uint8ClampedArray with byteOffset and output to Buffer","suites":["Input/output"],"updatePoint":{"line":198,"column":70,"index":7337},"line":198,"code":"  it('Read from Uint8ClampedArray with byteOffset and output to Buffer', async () => {\n    // since a Uint8ClampedArray is the same as Uint8Array but clamps the values\n    // between 0-255 it seemed good to add this also\n    const uint8array = Uint8ClampedArray.from([0, 0, 0, 255, 255, 255, 0, 0, 0, 255, 255, 255]);\n    const uint8ArrayWithByteOffset = new Uint8ClampedArray(uint8array.buffer, 3, 6);\n    const {\n      data,\n      info\n    } = await sharp(uint8ArrayWithByteOffset, {\n      raw: {\n        width: 2,\n        height: 1,\n        channels: 3\n      }\n    }).toBuffer({\n      resolveWithObject: true\n    });\n    assert.deepStrictEqual(Uint8ClampedArray.from([255, 255, 255, 0, 0, 0]), new Uint8ClampedArray(data));\n    assert.strictEqual(info.width, 2);\n    assert.strictEqual(info.height, 1);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Stream should emit info event","suites":["Input/output"],"updatePoint":{"line":219,"column":35,"index":8114},"line":219,"code":"  it('Stream should emit info event', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const writable = fs.createWriteStream(outputJpg);\n    const pipeline = sharp().resize(320, 240);\n    let infoEventEmitted = false;\n    pipeline.on('info', function (info) {\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(3, info.channels);\n      infoEventEmitted = true;\n    });\n    writable.on('close', function () {\n      assert.strictEqual(true, infoEventEmitted);\n      fs.rm(outputJpg, done);\n    });\n    readable.pipe(pipeline).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Stream should emit close event","suites":["Input/output"],"updatePoint":{"line":237,"column":36,"index":8803},"line":237,"code":"  it('Stream should emit close event', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const writable = fs.createWriteStream(outputJpg);\n    const pipeline = sharp().resize(320, 240);\n    let closeEventEmitted = false;\n    pipeline.on('close', function () {\n      closeEventEmitted = true;\n    });\n    writable.on('close', function () {\n      assert.strictEqual(true, closeEventEmitted);\n      fs.rm(outputJpg, done);\n    });\n    readable.pipe(pipeline).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Handle Stream to Stream error ","suites":["Input/output"],"updatePoint":{"line":251,"column":36,"index":9314},"line":251,"code":"  it('Handle Stream to Stream error ', function (done) {\n    const pipeline = sharp().resize(320, 240);\n    let anErrorWasEmitted = false;\n    pipeline.on('error', function (err) {\n      anErrorWasEmitted = !!err;\n    }).on('end', function () {\n      assert(anErrorWasEmitted);\n      fs.rm(outputJpg, done);\n    });\n    const readableButNotAnImage = fs.createReadStream(__filename);\n    const writable = fs.createWriteStream(outputJpg);\n    readableButNotAnImage.pipe(pipeline).pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Handle File to Stream error","suites":["Input/output"],"updatePoint":{"line":264,"column":33,"index":9811},"line":264,"code":"  it('Handle File to Stream error', function (done) {\n    const readableButNotAnImage = sharp(__filename).resize(320, 240);\n    let anErrorWasEmitted = false;\n    readableButNotAnImage.on('error', function (err) {\n      anErrorWasEmitted = !!err;\n    }).on('end', function () {\n      assert(anErrorWasEmitted);\n      fs.rm(outputJpg, done);\n    });\n    const writable = fs.createWriteStream(outputJpg);\n    readableButNotAnImage.pipe(writable);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Readable side of Stream can start flowing after Writable side has finished","suites":["Input/output"],"updatePoint":{"line":276,"column":80,"index":10309},"line":276,"code":"  it('Readable side of Stream can start flowing after Writable side has finished', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const writable = fs.createWriteStream(outputJpg);\n    writable.on('close', function () {\n      sharp(outputJpg).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fs.rm(outputJpg, done);\n      });\n    });\n    const pipeline = sharp().resize(320, 240);\n    readable.pipe(pipeline);\n    pipeline.on('finish', function () {\n      pipeline.pipe(writable);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid sequential read option throws","suites":["Input/output"],"updatePoint":{"line":296,"column":43,"index":11070},"line":296,"code":"  it('Invalid sequential read option throws', () => {\n    assert.throws(() => {\n      sharp({\n        sequentialRead: 'fail'\n      });\n    }, /Expected boolean for sequentialRead but received fail of type string/);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Sequential read, force JPEG","suites":["Input/output"],"updatePoint":{"line":303,"column":33,"index":11281},"line":303,"code":"  it('Sequential read, force JPEG', () => sharp(fixtures.inputJpg, {\n    sequentialRead: true\n  }).resize(320, 240).toFormat(sharp.format.jpeg).toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(data.length > 0, true);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual(info.format, 'jpeg');\n    assert.strictEqual(info.width, 320);\n    assert.strictEqual(info.height, 240);\n  }));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Not sequential read, force JPEG","suites":["Input/output"],"updatePoint":{"line":317,"column":37,"index":11740},"line":317,"code":"  it('Not sequential read, force JPEG', () => sharp(fixtures.inputJpg, {\n    sequentialRead: false\n  }).resize(320, 240).toFormat('jpeg').toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(data.length > 0, true);\n    assert.strictEqual(data.length, info.size);\n    assert.strictEqual(info.format, 'jpeg');\n    assert.strictEqual(info.width, 320);\n    assert.strictEqual(info.height, 240);\n  }));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Support output to jpg format","suites":["Input/output"],"updatePoint":{"line":331,"column":34,"index":12186},"line":331,"code":"  it('Support output to jpg format', function (done) {\n    sharp(fixtures.inputPng).resize(320, 240).toFormat('jpg').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual(data.length, info.size);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Support output to tif format","suites":["Input/output"],"updatePoint":{"line":342,"column":34,"index":12628},"line":342,"code":"  it('Support output to tif format', function (done) {\n    sharp(fixtures.inputTiff).resize(320, 240).toFormat('tif').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual(data.length, info.size);\n      assert.strictEqual('tiff', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Allow use of toBuffer and toFile with same instance","suites":["Input/output"],"updatePoint":{"line":353,"column":57,"index":13094},"line":353,"code":"  it('Allow use of toBuffer and toFile with same instance', async () => {\n    const instance = sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    });\n    await instance.toFile(fixtures.path('output.jpg'));\n    const data = await instance.toBuffer();\n    assert.strictEqual(Buffer.isBuffer(data), true);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File","suites":["Input/output"],"updatePoint":{"line":366,"column":41,"index":13456},"line":366,"code":"  it('Fail when output File is input File', function (done) {\n    sharp(fixtures.inputJpg).toFile(fixtures.inputJpg, function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File via Promise","suites":["Input/output"],"updatePoint":{"line":373,"column":53,"index":13750},"line":373,"code":"  it('Fail when output File is input File via Promise', function (done) {\n    sharp(fixtures.inputJpg).toFile(fixtures.inputJpg).then(function (data) {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File (relative output, absolute input)","suites":["Input/output"],"updatePoint":{"line":383,"column":75,"index":14137},"line":383,"code":"  it('Fail when output File is input File (relative output, absolute input)', function (done) {\n    const relativePath = path.relative(process.cwd(), fixtures.inputJpg);\n    sharp(fixtures.inputJpg).toFile(relativePath, function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File via Promise (relative output, absolute input)","suites":["Input/output"],"updatePoint":{"line":391,"column":87,"index":14534},"line":391,"code":"  it('Fail when output File is input File via Promise (relative output, absolute input)', function (done) {\n    const relativePath = path.relative(process.cwd(), fixtures.inputJpg);\n    sharp(fixtures.inputJpg).toFile(relativePath).then(function (data) {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File (relative input, absolute output)","suites":["Input/output"],"updatePoint":{"line":402,"column":75,"index":14990},"line":402,"code":"  it('Fail when output File is input File (relative input, absolute output)', function (done) {\n    const relativePath = path.relative(process.cwd(), fixtures.inputJpg);\n    sharp(relativePath).toFile(fixtures.inputJpg, function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is input File via Promise (relative input, absolute output)","suites":["Input/output"],"updatePoint":{"line":410,"column":87,"index":15387},"line":410,"code":"  it('Fail when output File is input File via Promise (relative input, absolute output)', function (done) {\n    const relativePath = path.relative(process.cwd(), fixtures.inputJpg);\n    sharp(relativePath).toFile(fixtures.inputJpg).then(function (data) {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Cannot use same file for input and output', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is empty","suites":["Input/output"],"updatePoint":{"line":421,"column":36,"index":15804},"line":421,"code":"  it('Fail when output File is empty', function (done) {\n    sharp(fixtures.inputJpg).toFile('', function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Missing output file path', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when output File is empty via Promise","suites":["Input/output"],"updatePoint":{"line":428,"column":48,"index":16061},"line":428,"code":"  it('Fail when output File is empty via Promise', function (done) {\n    sharp(fixtures.inputJpg).toFile('').then(function (data) {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Missing output file path', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when input is invalid Buffer","suites":["Input/output"],"updatePoint":{"line":438,"column":39,"index":16380},"line":438,"code":"  it('Fail when input is invalid Buffer', function (done) {\n    sharp(Buffer.from([0x1, 0x2, 0x3, 0x4])).toBuffer().then(function () {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Input buffer contains unsupported image format', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fail when input file path is missing","suites":["Input/output"],"updatePoint":{"line":448,"column":42,"index":16736},"line":448,"code":"  it('Fail when input file path is missing', function (done) {\n    sharp('does-not-exist').toBuffer().then(function () {\n      assert(false);\n      done();\n    }).catch(function (err) {\n      assert(err instanceof Error);\n      assert.strictEqual('Input file is missing: does-not-exist', err.message);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Undefined","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":459,"column":17,"index":17096},"line":459,"code":"    it('Undefined', function () {\n      assert.throws(function () {\n        sharp(undefined);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Null","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":464,"column":12,"index":17203},"line":464,"code":"    it('Null', function () {\n      assert.throws(function () {\n        sharp(null);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Numeric","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":469,"column":15,"index":17308},"line":469,"code":"    it('Numeric', function () {\n      assert.throws(function () {\n        sharp(1);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Boolean","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":474,"column":15,"index":17410},"line":474,"code":"    it('Boolean', function () {\n      assert.throws(function () {\n        sharp(true);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Error Object","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":479,"column":20,"index":17520},"line":479,"code":"    it('Error Object', function () {\n      assert.throws(function () {\n        sharp(new Error());\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Promises/A+","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":485,"column":17,"index":17640},"line":485,"code":"  it('Promises/A+', function () {\n    return sharp(fixtures.inputJpg).resize(320, 240).toBuffer();\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid output format","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":488,"column":27,"index":17755},"line":488,"code":"  it('Invalid output format', function (done) {\n    let isValid = false;\n    try {\n      sharp().toFormat('zoinks');\n      isValid = true;\n    } catch (e) {}\n    assert(!isValid);\n    done();\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"File input with corrupt header fails gracefully","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":497,"column":53,"index":17979},"line":497,"code":"  it('File input with corrupt header fails gracefully', function (done) {\n    sharp(fixtures.inputJpgWithCorruptHeader).toBuffer(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Buffer input with corrupt header fails gracefully","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":503,"column":55,"index":18194},"line":503,"code":"  it('Buffer input with corrupt header fails gracefully', function (done) {\n    sharp(fs.readFileSync(fixtures.inputJpgWithCorruptHeader)).toBuffer(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Stream input with corrupt header fails gracefully","suites":["Input/output","Fail for unsupported input"],"updatePoint":{"line":509,"column":55,"index":18426},"line":509,"code":"  it('Stream input with corrupt header fails gracefully', function (done) {\n    const transformer = sharp();\n    transformer.toBuffer().then(function () {\n      done(new Error('Unexpectedly resolved Promise'));\n    }).catch(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n    fs.createReadStream(fixtures.inputJpgWithCorruptHeader).pipe(transformer);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Match JPEG input","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":521,"column":24,"index":18906},"line":521,"code":"    it('Match JPEG input', function (done) {\n      sharp(fixtures.inputJpg).resize(320, 80).toFile(outputZoinks, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual(true, info.size > 0);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        fs.rm(outputZoinks, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Match PNG input","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":531,"column":23,"index":19310},"line":531,"code":"    it('Match PNG input', function (done) {\n      sharp(fixtures.inputPng).resize(320, 80).toFile(outputZoinks, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual(true, info.size > 0);\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        fs.rm(outputZoinks, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Match WebP input","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":541,"column":24,"index":19714},"line":541,"code":"    it('Match WebP input', function (done) {\n      sharp(fixtures.inputWebP).resize(320, 80).toFile(outputZoinks, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual(true, info.size > 0);\n        assert.strictEqual('webp', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        fs.rm(outputZoinks, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Match TIFF input","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":551,"column":24,"index":20120},"line":551,"code":"    it('Match TIFF input', function (done) {\n      sharp(fixtures.inputTiff).resize(320, 80).toFile(outputZoinks, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual(true, info.size > 0);\n        assert.strictEqual('tiff', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        fs.rm(outputZoinks, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Force JPEG format for PNG input","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":561,"column":39,"index":20541},"line":561,"code":"    it('Force JPEG format for PNG input', function (done) {\n      sharp(fixtures.inputPng).resize(320, 80).jpeg().toFile(outputZoinks, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual(true, info.size > 0);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        fs.rm(outputZoinks, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Input and output formats match when not forcing","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":572,"column":53,"index":20988},"line":572,"code":"  it('Input and output formats match when not forcing', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).png({\n      compressionLevel: 1,\n      force: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Can force output format with output chaining","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":584,"column":50,"index":21390},"line":584,"code":"  it('Can force output format with output chaining', function () {\n    return sharp(fixtures.inputJpg).resize(320, 240).png({\n      force: true\n    }).jpeg({\n      force: false\n    }).toBuffer({\n      resolveWithObject: true\n    }).then(function (out) {\n      assert.strictEqual('png', out.info.format);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"toFormat=JPEG takes precedence over WebP extension","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":595,"column":56,"index":21714},"line":595,"code":"  it('toFormat=JPEG takes precedence over WebP extension', function (done) {\n    const outputWebP = fixtures.path('output.webp');\n    sharp(fixtures.inputPng).resize(8).jpeg().toFile(outputWebP, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      fs.rm(outputWebP, done);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"toFormat=WebP takes precedence over JPEG extension","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":603,"column":56,"index":22050},"line":603,"code":"  it('toFormat=WebP takes precedence over JPEG extension', function (done) {\n    sharp(fixtures.inputPng).resize(8).webp().toFile(outputJpg, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      done();\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Load Vips V file","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":610,"column":22,"index":22281},"line":610,"code":"  it('Load Vips V file', function (done) {\n    sharp(fixtures.inputV).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(70, info.width);\n      assert.strictEqual(60, info.height);\n      fixtures.assertSimilar(fixtures.expected('vfile.jpg'), data, done);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Save Vips V file","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":620,"column":22,"index":22691},"line":620,"code":"  it('Save Vips V file', function (done) {\n    const outputV = fixtures.path('output.v');\n    sharp(fixtures.inputJpg).extract({\n      left: 910,\n      top: 1105,\n      width: 70,\n      height: 60\n    }).toFile(outputV, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      assert.strictEqual('v', info.format);\n      assert.strictEqual(70, info.width);\n      assert.strictEqual(60, info.height);\n      fs.rm(outputV, done);\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"can ignore ICC profile","suites":["Input/output","Output filename with unknown extension"],"updatePoint":{"line":636,"column":28,"index":23184},"line":636,"code":"  it('can ignore ICC profile', async () => {\n    const [r1, g1, b1] = await sharp(fixtures.inputJpgWithPortraitExif5, {\n      ignoreIcc: true\n    }).extract({\n      width: 1,\n      height: 1,\n      top: 16,\n      left: 16\n    }).raw().toBuffer();\n    const [r2, g2, b2] = await sharp(fixtures.inputJpgWithPortraitExif5, {\n      ignoreIcc: false\n    }).extract({\n      width: 1,\n      height: 1,\n      top: 16,\n      left: 16\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r1,\n      g1,\n      b1,\n      r2,\n      g2,\n      b2\n    }, {\n      r1: 60,\n      r2: 77,\n      g1: 54,\n      g2: 69,\n      b1: 20,\n      b2: 25\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Valid","suites":["Input/output","Switch off safety limits for certain formats"],"updatePoint":{"line":670,"column":13,"index":23880},"line":670,"code":"    it('Valid', () => {\n      assert.doesNotThrow(() => {\n        sharp({\n          unlimited: true\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid","suites":["Input/output","Switch off safety limits for certain formats"],"updatePoint":{"line":677,"column":15,"index":24012},"line":677,"code":"    it('Invalid', () => {\n      assert.throws(() => {\n        sharp({\n          unlimited: -1\n        });\n      }, /Expected boolean for unlimited but received -1 of type number/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid fails - negative","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":686,"column":32,"index":24279},"line":686,"code":"    it('Invalid fails - negative', () => {\n      assert.throws(() => {\n        sharp({\n          limitInputPixels: -1\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid fails - float","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":693,"column":29,"index":24424},"line":693,"code":"    it('Invalid fails - float', () => {\n      assert.throws(() => {\n        sharp({\n          limitInputPixels: 12.3\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid fails - integer overflow","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":700,"column":40,"index":24582},"line":700,"code":"    it('Invalid fails - integer overflow', () => {\n      assert.throws(() => {\n        sharp({\n          limitInputPixels: Number.MAX_SAFE_INTEGER + 1\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid fails - string","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":707,"column":30,"index":24753},"line":707,"code":"    it('Invalid fails - string', () => {\n      assert.throws(() => {\n        sharp({\n          limitInputPixels: 'fail'\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Same size as input works","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":714,"column":32,"index":24905},"line":714,"code":"    it('Same size as input works', () => sharp(fixtures.inputJpg).metadata().then(({\n      width,\n      height\n    }) => sharp(fixtures.inputJpg, {\n      limitInputPixels: width * height\n    }).resize(2).toBuffer()));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Disabling limit works","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":720,"column":29,"index":25120},"line":720,"code":"    it('Disabling limit works', () => sharp(fixtures.inputJpgLarge, {\n      limitInputPixels: false\n    }).resize(2).toBuffer());","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Enabling default limit works and fails with a large image","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":723,"column":65,"index":25286},"line":723,"code":"    it('Enabling default limit works and fails with a large image', () => sharp(fixtures.inputJpgLarge, {\n      limitInputPixels: true\n    }).toBuffer().then(() => {\n      assert.fail('Expected to fail');\n    }).catch(err => {\n      assert.strictEqual(err.message, 'Input image exceeds pixel limit');\n    }));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Enabling default limit works and fails for an image with resolution higher than uint32 limit","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":730,"column":100,"index":25631},"line":730,"code":"    it('Enabling default limit works and fails for an image with resolution higher than uint32 limit', () => sharp(fixtures.inputPngUint32Limit, {\n      limitInputPixels: true\n    }).toBuffer().then(() => {\n      assert.fail('Expected to fail');\n    }).catch(err => {\n      assert.strictEqual(err.message, 'Input image exceeds pixel limit');\n    }));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Smaller than input fails","suites":["Input/output","Limit pixel count of input image"],"updatePoint":{"line":737,"column":32,"index":25914},"line":737,"code":"    it('Smaller than input fails', () => sharp(fixtures.inputJpg).metadata().then(({\n      width,\n      height\n    }) => sharp(fixtures.inputJpg, {\n      limitInputPixels: width * height - 1\n    }).toBuffer().then(() => {\n      assert.fail('Expected to fail');\n    }).catch(err => {\n      assert.strictEqual(err.message, 'Input image exceeds pixel limit');\n    })));","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Option-less","suites":["Input/output","Input options"],"updatePoint":{"line":749,"column":19,"index":26316},"line":749,"code":"    it('Option-less', function () {\n      sharp();\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Ignore unknown attribute","suites":["Input/output","Input options"],"updatePoint":{"line":752,"column":32,"index":26388},"line":752,"code":"    it('Ignore unknown attribute', function () {\n      sharp({\n        unknown: true\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"undefined with options fails","suites":["Input/output","Input options"],"updatePoint":{"line":757,"column":36,"index":26495},"line":757,"code":"    it('undefined with options fails', function () {\n      assert.throws(function () {\n        sharp(undefined, {});\n      }, /Unsupported input 'undefined' of type undefined when also providing options of type object/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"null with options fails","suites":["Input/output","Input options"],"updatePoint":{"line":762,"column":31,"index":26719},"line":762,"code":"    it('null with options fails', function () {\n      assert.throws(function () {\n        sharp(null, {});\n      }, /Unsupported input 'null' of type object when also providing options of type object/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Non-Object options fails","suites":["Input/output","Input options"],"updatePoint":{"line":767,"column":32,"index":26931},"line":767,"code":"    it('Non-Object options fails', function () {\n      assert.throws(function () {\n        sharp('test', 'zoinks');\n      }, /Invalid input options zoinks/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid density: string","suites":["Input/output","Input options"],"updatePoint":{"line":772,"column":31,"index":27096},"line":772,"code":"    it('Invalid density: string', function () {\n      assert.throws(function () {\n        sharp({\n          density: 'zoinks'\n        });\n      }, /Expected number between 1 and 100000 for density but received zoinks of type string/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid ignoreIcc: string","suites":["Input/output","Input options"],"updatePoint":{"line":779,"column":33,"index":27341},"line":779,"code":"    it('Invalid ignoreIcc: string', function () {\n      assert.throws(function () {\n        sharp({\n          ignoreIcc: 'zoinks'\n        });\n      }, /Expected boolean for ignoreIcc but received zoinks of type string/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Setting animated property updates pages property","suites":["Input/output","Input options"],"updatePoint":{"line":786,"column":56,"index":27593},"line":786,"code":"    it('Setting animated property updates pages property', function () {\n      assert.strictEqual(sharp({\n        animated: false\n      }).options.input.pages, 1);\n      assert.strictEqual(sharp({\n        animated: true\n      }).options.input.pages, -1);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid animated property throws","suites":["Input/output","Input options"],"updatePoint":{"line":794,"column":40,"index":27840},"line":794,"code":"    it('Invalid animated property throws', function () {\n      assert.throws(function () {\n        sharp({\n          animated: -1\n        });\n      }, /Expected boolean for animated but received -1 of type number/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid page property throws","suites":["Input/output","Input options"],"updatePoint":{"line":801,"column":36,"index":28060},"line":801,"code":"    it('Invalid page property throws', function () {\n      assert.throws(function () {\n        sharp({\n          page: -1\n        });\n      }, /Expected integer between 0 and 100000 for page but received -1 of type number/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid pages property throws","suites":["Input/output","Input options"],"updatePoint":{"line":808,"column":37,"index":28294},"line":808,"code":"    it('Invalid pages property throws', function () {\n      assert.throws(function () {\n        sharp({\n          pages: '1'\n        });\n      }, /Expected integer between -1 and 100000 for pages but received 1 of type string/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Valid level property","suites":["Input/output","Input options"],"updatePoint":{"line":815,"column":28,"index":28522},"line":815,"code":"    it('Valid level property', function () {\n      sharp({\n        level: 1\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid level property (string) throws","suites":["Input/output","Input options"],"updatePoint":{"line":820,"column":46,"index":28634},"line":820,"code":"    it('Invalid level property (string) throws', function () {\n      assert.throws(function () {\n        sharp({\n          level: '1'\n        });\n      }, /Expected integer between 0 and 256 for level but received 1 of type string/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid level property (negative) throws","suites":["Input/output","Input options"],"updatePoint":{"line":827,"column":48,"index":28878},"line":827,"code":"    it('Invalid level property (negative) throws', function () {\n      assert.throws(function () {\n        sharp({\n          level: -1\n        });\n      }, /Expected integer between 0 and 256 for level but received -1 of type number/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Valid subifd property","suites":["Input/output","Input options"],"updatePoint":{"line":834,"column":29,"index":29103},"line":834,"code":"    it('Valid subifd property', function () {\n      sharp({\n        subifd: 1\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid subifd property (string) throws","suites":["Input/output","Input options"],"updatePoint":{"line":839,"column":47,"index":29217},"line":839,"code":"    it('Invalid subifd property (string) throws', function () {\n      assert.throws(function () {\n        sharp({\n          subifd: '1'\n        });\n      }, /Expected integer between -1 and 100000 for subifd but received 1 of type string/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid subifd property (float) throws","suites":["Input/output","Input options"],"updatePoint":{"line":846,"column":46,"index":29465},"line":846,"code":"    it('Invalid subifd property (float) throws', function () {\n      assert.throws(function () {\n        sharp({\n          subifd: 1.2\n        });\n      }, /Expected integer between -1 and 100000 for subifd but received 1.2 of type number/);\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Fails when writing to missing directory","suites":["Input/output","Input options"],"updatePoint":{"line":854,"column":45,"index":29720},"line":854,"code":"  it('Fails when writing to missing directory', async () => {\n    const create = {\n      width: 8,\n      height: 8,\n      channels: 3,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0\n      }\n    };\n    await assert.rejects(() => sharp({\n      create\n    }).toFile('does-not-exist/out.jpg'), /unable to open for write/);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"RGB","suites":["Input/output","create new image"],"updatePoint":{"line":870,"column":11,"index":30070},"line":870,"code":"    it('RGB', function (done) {\n      const create = {\n        width: 10,\n        height: 20,\n        channels: 3,\n        background: {\n          r: 0,\n          g: 255,\n          b: 0\n        }\n      };\n      sharp({\n        create: create\n      }).jpeg().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(create.width, info.width);\n        assert.strictEqual(create.height, info.height);\n        assert.strictEqual(create.channels, info.channels);\n        assert.strictEqual('jpeg', info.format);\n        fixtures.assertSimilar(fixtures.expected('create-rgb.jpg'), data, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"RGBA","suites":["Input/output","create new image"],"updatePoint":{"line":892,"column":12,"index":30713},"line":892,"code":"    it('RGBA', function (done) {\n      const create = {\n        width: 20,\n        height: 10,\n        channels: 4,\n        background: {\n          r: 255,\n          g: 0,\n          b: 0,\n          alpha: 128\n        }\n      };\n      sharp({\n        create: create\n      }).png().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(create.width, info.width);\n        assert.strictEqual(create.height, info.height);\n        assert.strictEqual(create.channels, info.channels);\n        assert.strictEqual('png', info.format);\n        fixtures.assertSimilar(fixtures.expected('create-rgba.png'), data, done);\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Invalid channels","suites":["Input/output","create new image"],"updatePoint":{"line":915,"column":24,"index":31389},"line":915,"code":"    it('Invalid channels', function () {\n      const create = {\n        width: 10,\n        height: 20,\n        channels: 2,\n        background: {\n          r: 0,\n          g: 0,\n          b: 0\n        }\n      };\n      assert.throws(function () {\n        sharp({\n          create: create\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Missing background","suites":["Input/output","create new image"],"updatePoint":{"line":932,"column":26,"index":31708},"line":932,"code":"    it('Missing background', function () {\n      const create = {\n        width: 10,\n        height: 20,\n        channels: 3\n      };\n      assert.throws(function () {\n        sharp({\n          create: create\n        });\n      });\n    });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Queue length change events","suites":["Input/output","create new image"],"updatePoint":{"line":945,"column":32,"index":31959},"line":945,"code":"  it('Queue length change events', function (done) {\n    let eventCounter = 0;\n    const queueListener = function (queueLength) {\n      assert.strictEqual(true, queueLength === 0 || queueLength === 1);\n      eventCounter++;\n    };\n    sharp.queue.on('change', queueListener);\n    sharp(fixtures.inputJpg).resize(320, 240).toBuffer(function (err) {\n      process.nextTick(function () {\n        sharp.queue.removeListener('change', queueListener);\n        if (err) throw err;\n        assert.strictEqual(2, eventCounter);\n        done();\n      });\n    });\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Info event data","suites":["Input/output","create new image"],"updatePoint":{"line":961,"column":21,"index":32507},"line":961,"code":"  it('Info event data', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJPGBig);\n    const inPipeline = sharp().resize(840, 472).raw().on('info', function (info) {\n      assert.strictEqual(840, info.width);\n      assert.strictEqual(472, info.height);\n      assert.strictEqual(3, info.channels);\n    });\n    const badPipeline = sharp({\n      raw: {\n        width: 840,\n        height: 500,\n        channels: 3\n      }\n    }).toFormat('jpeg').toBuffer(function (err, data, info) {\n      assert.strictEqual(err.message.indexOf('memory area too small') > 0, true);\n      const readable = fs.createReadStream(fixtures.inputJPGBig);\n      const inPipeline = sharp().resize(840, 472).raw();\n      const goodPipeline = sharp({\n        raw: {\n          width: 840,\n          height: 472,\n          channels: 3\n        }\n      }).toFormat('jpeg').toBuffer(function (err, data, info) {\n        if (err) throw err;\n        done();\n      });\n      readable.pipe(inPipeline).pipe(goodPipeline);\n    });\n    readable.pipe(inPipeline).pipe(badPipeline);\n  });","file":"unit/io.js","skipped":false,"dir":"test"},{"name":"Grayscale to RGB, buffer","suites":["Image channel insertion"],"updatePoint":{"line":11,"column":30,"index":314},"line":11,"code":"  it('Grayscale to RGB, buffer', function (done) {\n    sharp(fixtures.inputPng) // gray -> red\n    .resize(320, 240).joinChannel(fixtures.inputPngTestJoinChannel) // new green channel\n    .joinChannel(fixtures.inputPngStripesH) // new blue channel\n    .toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-rgb.jpg'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Grayscale to RGB, file","suites":["Image channel insertion"],"updatePoint":{"line":23,"column":28,"index":858},"line":23,"code":"  it('Grayscale to RGB, file', function (done) {\n    sharp(fixtures.inputPng) // gray -> red\n    .resize(320, 240).joinChannel(fs.readFileSync(fixtures.inputPngTestJoinChannel)) // new green channel\n    .joinChannel(fs.readFileSync(fixtures.inputPngStripesH)) // new blue channel\n    .toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-rgb.jpg'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Grayscale to RGBA, buffer","suites":["Image channel insertion"],"updatePoint":{"line":35,"column":31,"index":1439},"line":35,"code":"  it('Grayscale to RGBA, buffer', function (done) {\n    sharp(fixtures.inputPng) // gray -> red\n    .resize(320, 240).joinChannel([fixtures.inputPngTestJoinChannel, fixtures.inputPngStripesH, fixtures.inputPngStripesV]) // new green + blue + alpha channel\n    .toColourspace(sharp.colourspace.srgb).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-rgba.png'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Grayscale to RGBA, file","suites":["Image channel insertion"],"updatePoint":{"line":46,"column":29,"index":2030},"line":46,"code":"  it('Grayscale to RGBA, file', function (done) {\n    sharp(fixtures.inputPng) // gray -> red\n    .resize(320, 240).joinChannel([fs.readFileSync(fixtures.inputPngTestJoinChannel),\n    // new green channel\n    fs.readFileSync(fixtures.inputPngStripesH),\n    // new blue channel\n    fs.readFileSync(fixtures.inputPngStripesV) // new alpha channel\n    ]).toColourspace('srgb').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-rgba.png'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Grayscale to CMYK, buffers","suites":["Image channel insertion"],"updatePoint":{"line":61,"column":32,"index":2701},"line":61,"code":"  it('Grayscale to CMYK, buffers', function (done) {\n    sharp(fixtures.inputPng) // gray -> magenta\n    .resize(320, 240).joinChannel([fs.readFileSync(fixtures.inputPngTestJoinChannel),\n    // new cyan channel\n    fs.readFileSync(fixtures.inputPngStripesH),\n    // new yellow channel\n    fs.readFileSync(fixtures.inputPngStripesV) // new black channel\n    ]).toColorspace('cmyk').toFormat('jpeg').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-cmyk.jpg'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Join raw buffers to RGB","suites":["Image channel insertion"],"updatePoint":{"line":76,"column":29,"index":3390},"line":76,"code":"  it('Join raw buffers to RGB', function (done) {\n    Promise.all([sharp(fixtures.inputPngTestJoinChannel).toColourspace('b-w').raw().toBuffer(), sharp(fixtures.inputPngStripesH).toColourspace('b-w').raw().toBuffer()]).then(function (buffers) {\n      sharp(fixtures.inputPng).resize(320, 240).joinChannel(buffers, {\n        raw: {\n          width: 320,\n          height: 240,\n          channels: 1\n        }\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        assert.strictEqual(3, info.channels);\n        fixtures.assertSimilar(fixtures.expected('joinChannel-rgb.jpg'), data, done);\n      });\n    }).catch(function (err) {\n      throw err;\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Grayscale to RGBA, files, two arrays","suites":["Image channel insertion"],"updatePoint":{"line":95,"column":42,"index":4180},"line":95,"code":"  it('Grayscale to RGBA, files, two arrays', function (done) {\n    sharp(fixtures.inputPng) // gray -> red\n    .resize(320, 240).joinChannel([fs.readFileSync(fixtures.inputPngTestJoinChannel)]) // new green channel\n    .joinChannel([fs.readFileSync(fixtures.inputPngStripesH),\n    // new blue channel\n    fs.readFileSync(fixtures.inputPngStripesV) // new alpha channel\n    ]).toColourspace('srgb').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('joinChannel-rgba.png'), data, done);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Invalid raw buffer description","suites":["Image channel insertion"],"updatePoint":{"line":109,"column":36,"index":4866},"line":109,"code":"  it('Invalid raw buffer description', function () {\n    assert.throws(function () {\n      sharp().joinChannel(fs.readFileSync(fixtures.inputPng), {\n        raw: {}\n      });\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"Invalid input","suites":["Image channel insertion"],"updatePoint":{"line":116,"column":19,"index":5038},"line":116,"code":"  it('Invalid input', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).joinChannel(1);\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"No arguments","suites":["Image channel insertion"],"updatePoint":{"line":121,"column":18,"index":5166},"line":121,"code":"  it('No arguments', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).joinChannel();\n    });\n  });","file":"unit/joinChannel.js","skipped":false,"dir":"test"},{"name":"JP2 output should fail due to missing OpenJPEG","suites":["JP2 output"],"updatePoint":{"line":12,"column":54,"index":360},"line":12,"code":"    it('JP2 output should fail due to missing OpenJPEG', () => assert.rejects(async () => sharp(fixtures.inputJpg).jp2().toBuffer(), /JP2 output requires libvips with support for OpenJPEG/));","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"JP2 file output should fail due to missing OpenJPEG","suites":["JP2 output"],"updatePoint":{"line":13,"column":59,"index":557},"line":13,"code":"    it('JP2 file output should fail due to missing OpenJPEG', () => assert.rejects(async () => sharp(fixtures.inputJpg).toFile('test.jp2'), /JP2 output requires libvips with support for OpenJPEG/));","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"File with JP2-like suffix should not fail due to missing OpenJPEG","suites":["JP2 output"],"updatePoint":{"line":14,"column":73,"index":770},"line":14,"code":"    it('File with JP2-like suffix should not fail due to missing OpenJPEG', () => {\n      const output = fixtures.path('output.failj2c');\n      return assert.doesNotReject(async () => sharp(fixtures.inputPngWithOneColor).toFile(output));\n    });","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"JP2 Buffer to PNG Buffer","suites":["JP2 output"],"updatePoint":{"line":19,"column":32,"index":986},"line":19,"code":"    it('JP2 Buffer to PNG Buffer', () => {\n      sharp(fs.readFileSync(fixtures.inputJp2)).resize(8, 15).png().toBuffer({\n        resolveWithObject: true\n      }).then(({\n        data,\n        info\n      }) => {\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(8, info.width);\n        assert.strictEqual(15, info.height);\n        assert.strictEqual(4, info.channels);\n      });\n    });","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"JP2 quality","suites":["JP2 output"],"updatePoint":{"line":34,"column":19,"index":1488},"line":34,"code":"    it('JP2 quality', function (done) {\n      sharp(fixtures.inputJp2).resize(320, 240).jp2({\n        quality: 70\n      }).toBuffer(function (err, buffer70) {\n        if (err) throw err;\n        sharp(fixtures.inputJp2).resize(320, 240).toBuffer(function (err, buffer80) {\n          if (err) throw err;\n          assert(buffer70.length < buffer80.length);\n          done();\n        });\n      });\n    });","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"Without chroma subsampling generates larger file","suites":["JP2 output"],"updatePoint":{"line":46,"column":56,"index":1929},"line":46,"code":"    it('Without chroma subsampling generates larger file', function (done) {\n      // First generate with chroma subsampling (default)\n      sharp(fixtures.inputJp2).resize(320, 240).jp2({\n        chromaSubsampling: '4:2:0'\n      }).toBuffer(function (err, withChromaSubsamplingData, withChromaSubsamplingInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withChromaSubsamplingData.length > 0);\n        assert.strictEqual(withChromaSubsamplingData.length, withChromaSubsamplingInfo.size);\n        assert.strictEqual('jp2', withChromaSubsamplingInfo.format);\n        assert.strictEqual(320, withChromaSubsamplingInfo.width);\n        assert.strictEqual(240, withChromaSubsamplingInfo.height);\n        // Then generate without\n        sharp(fixtures.inputJp2).resize(320, 240).jp2({\n          chromaSubsampling: '4:4:4'\n        }).toBuffer(function (err, withoutChromaSubsamplingData, withoutChromaSubsamplingInfo) {\n          if (err) throw err;\n          assert.strictEqual(true, withoutChromaSubsamplingData.length > 0);\n          assert.strictEqual(withoutChromaSubsamplingData.length, withoutChromaSubsamplingInfo.size);\n          assert.strictEqual('jp2', withoutChromaSubsamplingInfo.format);\n          assert.strictEqual(320, withoutChromaSubsamplingInfo.width);\n          assert.strictEqual(240, withoutChromaSubsamplingInfo.height);\n          assert.strictEqual(true, withChromaSubsamplingData.length <= withoutChromaSubsamplingData.length);\n          done();\n        });\n      });\n    });","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"Invalid JP2 chromaSubsampling value throws error","suites":["JP2 output"],"updatePoint":{"line":72,"column":56,"index":3444},"line":72,"code":"    it('Invalid JP2 chromaSubsampling value throws error', function () {\n      assert.throws(function () {\n        sharp().jpeg({\n          chromaSubsampling: '4:2:2'\n        });\n      });\n    });","file":"unit/jp2.js","skipped":false,"dir":"test"},{"name":"JPEG quality","suites":["JPEG"],"updatePoint":{"line":10,"column":18,"index":257},"line":10,"code":"  it('JPEG quality', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      quality: 70\n    }).toBuffer(function (err, buffer70) {\n      if (err) throw err;\n      sharp(fixtures.inputJpg).resize(320, 240).toBuffer(function (err, buffer80) {\n        if (err) throw err;\n        sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n          quality: 90\n        }).toBuffer(function (err, buffer90) {\n          if (err) throw err;\n          assert(buffer70.length < buffer80.length);\n          assert(buffer80.length < buffer90.length);\n          done();\n        });\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Progressive JPEG image","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":50,"column":28,"index":1457},"line":50,"code":"  it('Progressive JPEG image', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      progressive: false\n    }).toBuffer(function (err, nonProgressiveData, nonProgressiveInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, nonProgressiveData.length > 0);\n      assert.strictEqual(nonProgressiveData.length, nonProgressiveInfo.size);\n      assert.strictEqual('jpeg', nonProgressiveInfo.format);\n      assert.strictEqual(320, nonProgressiveInfo.width);\n      assert.strictEqual(240, nonProgressiveInfo.height);\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        progressive: true\n      }).toBuffer(function (err, progressiveData, progressiveInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, progressiveData.length > 0);\n        assert.strictEqual(progressiveData.length, progressiveInfo.size);\n        assert.strictEqual(false, progressiveData.length === nonProgressiveData.length);\n        assert.strictEqual('jpeg', progressiveInfo.format);\n        assert.strictEqual(320, progressiveInfo.width);\n        assert.strictEqual(240, progressiveInfo.height);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Without chroma subsampling generates larger file","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":74,"column":54,"index":2642},"line":74,"code":"  it('Without chroma subsampling generates larger file', function (done) {\n    // First generate with chroma subsampling (default)\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      chromaSubsampling: '4:2:0'\n    }).toBuffer(function (err, withChromaSubsamplingData, withChromaSubsamplingInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withChromaSubsamplingData.length > 0);\n      assert.strictEqual(withChromaSubsamplingData.length, withChromaSubsamplingInfo.size);\n      assert.strictEqual('jpeg', withChromaSubsamplingInfo.format);\n      assert.strictEqual(320, withChromaSubsamplingInfo.width);\n      assert.strictEqual(240, withChromaSubsamplingInfo.height);\n      // Then generate without\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        chromaSubsampling: '4:4:4'\n      }).toBuffer(function (err, withoutChromaSubsamplingData, withoutChromaSubsamplingInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withoutChromaSubsamplingData.length > 0);\n        assert.strictEqual(withoutChromaSubsamplingData.length, withoutChromaSubsamplingInfo.size);\n        assert.strictEqual('jpeg', withoutChromaSubsamplingInfo.format);\n        assert.strictEqual(320, withoutChromaSubsamplingInfo.width);\n        assert.strictEqual(240, withoutChromaSubsamplingInfo.height);\n        assert.strictEqual(true, withChromaSubsamplingData.length < withoutChromaSubsamplingData.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Invalid JPEG chromaSubsampling value throws error","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":100,"column":55,"index":4109},"line":100,"code":"  it('Invalid JPEG chromaSubsampling value throws error', function () {\n    assert.throws(function () {\n      sharp().jpeg({\n        chromaSubsampling: '4:2:2'\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Trellis quantisation","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":107,"column":26,"index":4264},"line":107,"code":"  it('Trellis quantisation', function (done) {\n    // First generate without\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      trellisQuantisation: false\n    }).toBuffer(function (err, withoutData, withoutInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withoutData.length > 0);\n      assert.strictEqual(withoutData.length, withoutInfo.size);\n      assert.strictEqual('jpeg', withoutInfo.format);\n      assert.strictEqual(320, withoutInfo.width);\n      assert.strictEqual(240, withoutInfo.height);\n      // Then generate with\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        trellisQuantization: true\n      }).toBuffer(function (err, withData, withInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withData.length > 0);\n        assert.strictEqual(withData.length, withInfo.size);\n        assert.strictEqual('jpeg', withInfo.format);\n        assert.strictEqual(320, withInfo.width);\n        assert.strictEqual(240, withInfo.height);\n        // Verify image is same (as mozjpeg may not be present) size or less\n        assert.strictEqual(true, withData.length <= withoutData.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Overshoot deringing","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":134,"column":25,"index":5443},"line":134,"code":"  it('Overshoot deringing', function (done) {\n    // First generate without\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      overshootDeringing: false\n    }).toBuffer(function (err, withoutData, withoutInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withoutData.length > 0);\n      assert.strictEqual(withoutData.length, withoutInfo.size);\n      assert.strictEqual('jpeg', withoutInfo.format);\n      assert.strictEqual(320, withoutInfo.width);\n      assert.strictEqual(240, withoutInfo.height);\n      // Then generate with\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        overshootDeringing: true\n      }).toBuffer(function (err, withData, withInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withData.length > 0);\n        assert.strictEqual(withData.length, withInfo.size);\n        assert.strictEqual('jpeg', withInfo.format);\n        assert.strictEqual(320, withInfo.width);\n        assert.strictEqual(240, withInfo.height);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Optimise scans generates different output length","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":159,"column":54,"index":6499},"line":159,"code":"  it('Optimise scans generates different output length', function (done) {\n    // First generate without\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      optimiseScans: false\n    }).toBuffer(function (err, withoutData, withoutInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withoutData.length > 0);\n      assert.strictEqual(withoutData.length, withoutInfo.size);\n      assert.strictEqual('jpeg', withoutInfo.format);\n      assert.strictEqual(320, withoutInfo.width);\n      assert.strictEqual(240, withoutInfo.height);\n      // Then generate with\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        optimizeScans: true\n      }).toBuffer(function (err, withData, withInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withData.length > 0);\n        assert.strictEqual(withData.length, withInfo.size);\n        assert.strictEqual('jpeg', withInfo.format);\n        assert.strictEqual(320, withInfo.width);\n        assert.strictEqual(240, withInfo.height);\n        // Verify image is of a different size (progressive output even without mozjpeg)\n        assert.notStrictEqual(withData.length, withoutData.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Optimise coding generates smaller output length","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":186,"column":53,"index":7701},"line":186,"code":"  it('Optimise coding generates smaller output length', function (done) {\n    // First generate with optimize coding enabled (default)\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg().toBuffer(function (err, withOptimiseCoding, withInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withOptimiseCoding.length > 0);\n      assert.strictEqual(withOptimiseCoding.length, withInfo.size);\n      assert.strictEqual('jpeg', withInfo.format);\n      assert.strictEqual(320, withInfo.width);\n      assert.strictEqual(240, withInfo.height);\n      // Then generate with coding disabled\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        optimizeCoding: false\n      }).toBuffer(function (err, withoutOptimiseCoding, withoutInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withoutOptimiseCoding.length > 0);\n        assert.strictEqual(withoutOptimiseCoding.length, withoutInfo.size);\n        assert.strictEqual('jpeg', withoutInfo.format);\n        assert.strictEqual(320, withoutInfo.width);\n        assert.strictEqual(240, withoutInfo.height);\n        // Verify optimised image is of a smaller size\n        assert.strictEqual(true, withOptimiseCoding.length < withoutOptimiseCoding.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Specifying quantisation table provides different JPEG","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":211,"column":59,"index":8974},"line":211,"code":"  it('Specifying quantisation table provides different JPEG', function (done) {\n    // First generate with default quantisation table\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      optimiseCoding: false\n    }).toBuffer(function (err, withDefaultQuantisationTable, withInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withDefaultQuantisationTable.length > 0);\n      assert.strictEqual(withDefaultQuantisationTable.length, withInfo.size);\n      assert.strictEqual('jpeg', withInfo.format);\n      assert.strictEqual(320, withInfo.width);\n      assert.strictEqual(240, withInfo.height);\n      // Then generate with different quantisation table\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        optimiseCoding: false,\n        quantisationTable: 3\n      }).toBuffer(function (err, withQuantTable3, withoutInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withQuantTable3.length > 0);\n        assert.strictEqual(withQuantTable3.length, withoutInfo.size);\n        assert.strictEqual('jpeg', withoutInfo.format);\n        assert.strictEqual(320, withoutInfo.width);\n        assert.strictEqual(240, withoutInfo.height);\n\n        // Verify image is same (as mozjpeg may not be present) size or less\n        assert.strictEqual(true, withQuantTable3.length <= withDefaultQuantisationTable.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Specifying quantization table provides different JPEG","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":240,"column":59,"index":10358},"line":240,"code":"  it('Specifying quantization table provides different JPEG', function (done) {\n    // First generate with default quantization table\n    sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n      optimiseCoding: false\n    }).toBuffer(function (err, withDefaultQuantizationTable, withInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, withDefaultQuantizationTable.length > 0);\n      assert.strictEqual(withDefaultQuantizationTable.length, withInfo.size);\n      assert.strictEqual('jpeg', withInfo.format);\n      assert.strictEqual(320, withInfo.width);\n      assert.strictEqual(240, withInfo.height);\n      // Then generate with different quantization table\n      sharp(fixtures.inputJpg).resize(320, 240).jpeg({\n        optimiseCoding: false,\n        quantizationTable: 3\n      }).toBuffer(function (err, withQuantTable3, withoutInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withQuantTable3.length > 0);\n        assert.strictEqual(withQuantTable3.length, withoutInfo.size);\n        assert.strictEqual('jpeg', withoutInfo.format);\n        assert.strictEqual(320, withoutInfo.width);\n        assert.strictEqual(240, withoutInfo.height);\n\n        // Verify image is same (as mozjpeg may not be present) size or less\n        assert.strictEqual(true, withQuantTable3.length <= withDefaultQuantizationTable.length);\n        done();\n      });\n    });\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Can use mozjpeg defaults","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":269,"column":30,"index":11713},"line":269,"code":"  it('Can use mozjpeg defaults', async () => {\n    const withoutData = await sharp(fixtures.inputJpg).resize(32, 24).jpeg({\n      mozjpeg: false\n    }).toBuffer();\n    const withoutMeta = await sharp(withoutData).metadata();\n    assert.strictEqual(false, withoutMeta.isProgressive);\n    const withData = await sharp(fixtures.inputJpg).resize(32, 24).jpeg({\n      mozjpeg: true\n    }).toBuffer();\n    const withMeta = await sharp(withData).metadata();\n    assert.strictEqual(true, withMeta.isProgressive);\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"Invalid mozjpeg value throws error","suites":["JPEG","Invalid JPEG quantisation table"],"updatePoint":{"line":281,"column":40,"index":12234},"line":281,"code":"  it('Invalid mozjpeg value throws error', () => {\n    assert.throws(() => sharp().jpeg({\n      mozjpeg: 'fail'\n    }));\n  });","file":"unit/jpeg.js","skipped":false,"dir":"test"},{"name":"called without options does not throw an error","suites":["JXL"],"updatePoint":{"line":9,"column":52,"index":243},"line":9,"code":"  it('called without options does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl();\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid distance does not throw an error","suites":["JXL"],"updatePoint":{"line":14,"column":44,"index":365},"line":14,"code":"  it('valid distance does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl({\n        distance: 2.3\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"invalid distance should throw an error","suites":["JXL"],"updatePoint":{"line":21,"column":44,"index":518},"line":21,"code":"  it('invalid distance should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        distance: 15.1\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"non-numeric distance should throw an error","suites":["JXL"],"updatePoint":{"line":28,"column":48,"index":670},"line":28,"code":"  it('non-numeric distance should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        distance: 'fail'\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid quality > 30 does not throw an error","suites":["JXL"],"updatePoint":{"line":35,"column":48,"index":824},"line":35,"code":"  it('valid quality > 30 does not throw an error', () => {\n    const s = sharp();\n    assert.doesNotThrow(() => {\n      s.jxl({\n        quality: 80\n      });\n    });\n    assert.strictEqual(s.options.jxlDistance, 1.9);\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid quality < 30 does not throw an error","suites":["JXL"],"updatePoint":{"line":44,"column":48,"index":1048},"line":44,"code":"  it('valid quality < 30 does not throw an error', () => {\n    const s = sharp();\n    assert.doesNotThrow(() => {\n      s.jxl({\n        quality: 20\n      });\n    });\n    assert.strictEqual(s.options.jxlDistance, 9.066666666666666);\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid quality does not throw an error","suites":["JXL"],"updatePoint":{"line":53,"column":43,"index":1281},"line":53,"code":"  it('valid quality does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl({\n        quality: 80\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"invalid quality should throw an error","suites":["JXL"],"updatePoint":{"line":60,"column":43,"index":1431},"line":60,"code":"  it('invalid quality should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        quality: 101\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"non-numeric quality should throw an error","suites":["JXL"],"updatePoint":{"line":67,"column":47,"index":1580},"line":67,"code":"  it('non-numeric quality should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        quality: 'fail'\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid decodingTier does not throw an error","suites":["JXL"],"updatePoint":{"line":74,"column":48,"index":1733},"line":74,"code":"  it('valid decodingTier does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl({\n        decodingTier: 2\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"invalid decodingTier should throw an error","suites":["JXL"],"updatePoint":{"line":81,"column":48,"index":1892},"line":81,"code":"  it('invalid decodingTier should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        decodingTier: 5\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"non-numeric decodingTier should throw an error","suites":["JXL"],"updatePoint":{"line":88,"column":52,"index":2049},"line":88,"code":"  it('non-numeric decodingTier should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        decodingTier: 'fail'\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid lossless does not throw an error","suites":["JXL"],"updatePoint":{"line":95,"column":44,"index":2203},"line":95,"code":"  it('valid lossless does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl({\n        lossless: true\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"non-boolean lossless should throw an error","suites":["JXL"],"updatePoint":{"line":102,"column":48,"index":2361},"line":102,"code":"  it('non-boolean lossless should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        lossless: 'fail'\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"valid effort does not throw an error","suites":["JXL"],"updatePoint":{"line":109,"column":42,"index":2509},"line":109,"code":"  it('valid effort does not throw an error', () => {\n    assert.doesNotThrow(() => {\n      sharp().jxl({\n        effort: 6\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"out of range effort should throw an error","suites":["JXL"],"updatePoint":{"line":116,"column":47,"index":2661},"line":116,"code":"  it('out of range effort should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        effort: 10\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"invalid effort should throw an error","suites":["JXL"],"updatePoint":{"line":123,"column":42,"index":2803},"line":123,"code":"  it('invalid effort should throw an error', () => {\n    assert.throws(() => {\n      sharp().jxl({\n        effort: 'fail'\n      });\n    });\n  });","file":"unit/jxl.js","skipped":false,"dir":"test"},{"name":"pkgConfigPath returns empty string","suites":["libvips binaries","Windows platform"],"updatePoint":{"line":26,"column":42,"index":729},"line":26,"code":"    it('pkgConfigPath returns empty string', function () {\n      assert.strictEqual('', libvips.pkgConfigPath());\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"globalLibvipsVersion returns empty string","suites":["libvips binaries","Windows platform"],"updatePoint":{"line":29,"column":49,"index":858},"line":29,"code":"    it('globalLibvipsVersion returns empty string', function () {\n      assert.strictEqual('', libvips.globalLibvipsVersion());\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"globalLibvipsVersion is always false","suites":["libvips binaries","Windows platform"],"updatePoint":{"line":32,"column":44,"index":989},"line":32,"code":"    it('globalLibvipsVersion is always false', function () {\n      assert.strictEqual(false, libvips.useGlobalLibvips());\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"pkgConfigPath returns a string","suites":["libvips binaries","non-Windows platforms"],"updatePoint":{"line":41,"column":38,"index":1258},"line":41,"code":"    it('pkgConfigPath returns a string', function () {\n      const pkgConfigPath = libvips.pkgConfigPath();\n      assert.strictEqual('string', typeof pkgConfigPath);\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"globalLibvipsVersion returns a string","suites":["libvips binaries","non-Windows platforms"],"updatePoint":{"line":45,"column":45,"index":1439},"line":45,"code":"    it('globalLibvipsVersion returns a string', function () {\n      const globalLibvipsVersion = libvips.globalLibvipsVersion();\n      assert.strictEqual('string', typeof globalLibvipsVersion);\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"globalLibvipsVersion returns a boolean","suites":["libvips binaries","non-Windows platforms"],"updatePoint":{"line":49,"column":46,"index":1642},"line":49,"code":"    it('globalLibvipsVersion returns a boolean', function () {\n      const useGlobalLibvips = libvips.useGlobalLibvips();\n      assert.strictEqual('boolean', typeof useGlobalLibvips);\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"minimumLibvipsVersion returns a valid semver","suites":["libvips binaries","platform agnostic"],"updatePoint":{"line":55,"column":52,"index":1892},"line":55,"code":"    it('minimumLibvipsVersion returns a valid semver', function () {\n      const minimumLibvipsVersion = libvips.minimumLibvipsVersion;\n      assert.strictEqual('string', typeof minimumLibvipsVersion);\n      assert.notStrictEqual(null, semver.valid(minimumLibvipsVersion));\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"hasVendoredLibvips returns a boolean","suites":["libvips binaries","platform agnostic"],"updatePoint":{"line":60,"column":44,"index":2166},"line":60,"code":"    it('hasVendoredLibvips returns a boolean', function () {\n      const hasVendoredLibvips = libvips.hasVendoredLibvips();\n      assert.strictEqual('boolean', typeof hasVendoredLibvips);\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"useGlobalLibvips can be ignored via an env var","suites":["libvips binaries","platform agnostic"],"updatePoint":{"line":64,"column":54,"index":2372},"line":64,"code":"    it('useGlobalLibvips can be ignored via an env var', function () {\n      process.env.SHARP_IGNORE_GLOBAL_LIBVIPS = 1;\n      const useGlobalLibvips = libvips.useGlobalLibvips();\n      assert.strictEqual(false, useGlobalLibvips);\n      delete process.env.SHARP_IGNORE_GLOBAL_LIBVIPS;\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"cachePath returns a valid path ending with _libvips","suites":["libvips binaries","platform agnostic"],"updatePoint":{"line":70,"column":59,"index":2671},"line":70,"code":"    it('cachePath returns a valid path ending with _libvips', function () {\n      const cachePath = libvips.cachePath();\n      assert.strictEqual('string', typeof cachePath);\n      assert.strictEqual('_libvips', cachePath.substr(-8));\n      assert.strictEqual(true, fs.existsSync(cachePath));\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"reads value from environment variable","suites":["libvips binaries","integrity"],"updatePoint":{"line":78,"column":45,"index":3002},"line":78,"code":"    it('reads value from environment variable', function () {\n      const prev = process.env.npm_package_config_integrity_platform_arch;\n      process.env.npm_package_config_integrity_platform_arch = 'sha512-test';\n      const integrity = libvips.integrity('platform-arch');\n      assert.strictEqual('sha512-test', integrity);\n      process.env.npm_package_config_integrity_platform_arch = prev;\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"reads value from package.json","suites":["libvips binaries","integrity"],"updatePoint":{"line":85,"column":37,"index":3398},"line":85,"code":"    it('reads value from package.json', function () {\n      const prev = process.env.npm_package_config_integrity_linux_x64;\n      delete process.env.npm_package_config_integrity_linux_x64;\n      const integrity = libvips.integrity('linux-x64');\n      assert.strictEqual('sha512-', integrity.substr(0, 7));\n      process.env.npm_package_config_integrity_linux_x64 = prev;\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"mkdirSync creates a directory","suites":["libvips binaries","safe directory creation"],"updatePoint":{"line":106,"column":37,"index":4065},"line":106,"code":"    it('mkdirSync creates a directory', function () {\n      const dirPath = 'createdDir';\n      libvips.mkdirSync(dirPath);\n      assert.strictEqual(true, fs.existsSync(dirPath));\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"mkdirSync does not throw error or overwrite an existing dir","suites":["libvips binaries","safe directory creation"],"updatePoint":{"line":111,"column":67,"index":4283},"line":111,"code":"    it('mkdirSync does not throw error or overwrite an existing dir', function () {\n      const dirPath = 'exampleDirA';\n      const nestedDirPath = 'exampleDirA/exampleDirB';\n      assert.strictEqual(true, fs.existsSync(dirPath));\n      libvips.mkdirSync(dirPath);\n      assert.strictEqual(true, fs.existsSync(dirPath));\n      assert.strictEqual(true, fs.existsSync(nestedDirPath));\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"logs an info message","suites":["libvips binaries","logger"],"updatePoint":{"line":127,"column":28,"index":4853},"line":127,"code":"    it('logs an info message', function (done) {\n      console.log = function (msg) {\n        assert.strictEqual(msg, 'sharp: progress');\n        done();\n      };\n      libvips.log('progress');\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"logs an error message","suites":["libvips binaries","logger"],"updatePoint":{"line":134,"column":29,"index":5056},"line":134,"code":"    it('logs an error message', function (done) {\n      console.error = function (msg) {\n        assert.strictEqual(msg, 'sharp: Installation error: problem');\n        done();\n      };\n      libvips.log(new Error('problem'));\n    });","file":"unit/libvips.js","skipped":false,"dir":"test"},{"name":"applies linear levels adjustment w/o alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":14,"column":51,"index":428},"line":14,"code":"  it('applies linear levels adjustment w/o alpha ch', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).linear(a, b).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('low-contrast-linear.jpg'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies slope level adjustment w/o alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":20,"column":49,"index":721},"line":20,"code":"  it('applies slope level adjustment w/o alpha ch', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).linear(a).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('low-contrast-slope.jpg'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies offset level adjustment w/o alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":26,"column":50,"index":1011},"line":26,"code":"  it('applies offset level adjustment w/o alpha ch', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).linear(null, b).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('low-contrast-offset.jpg'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies linear levels adjustment w alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":32,"column":49,"index":1307},"line":32,"code":"  it('applies linear levels adjustment w alpha ch', function (done) {\n    sharp(fixtures.inputPngOverlayLayer1).resize(240).linear(a, b).toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('alpha-layer-1-fill-linear.png'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies linear levels adjustment to 16-bit w alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":38,"column":59,"index":1620},"line":38,"code":"  it('applies linear levels adjustment to 16-bit w alpha ch', function (done) {\n    sharp(fixtures.inputPngWithTransparency16bit).linear(a, b).png({\n      compressionLevel: 0\n    }).toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('linear-16bit.png'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies slope level adjustment w alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":46,"column":47,"index":1943},"line":46,"code":"  it('applies slope level adjustment w alpha ch', function (done) {\n    sharp(fixtures.inputPngOverlayLayer1).resize(240).linear(a).toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('alpha-layer-1-fill-slope.png'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"applies offset level adjustment w alpha ch","suites":["Linear adjustment"],"updatePoint":{"line":52,"column":48,"index":2241},"line":52,"code":"  it('applies offset level adjustment w alpha ch', function (done) {\n    sharp(fixtures.inputPngOverlayLayer1).resize(240).linear(null, b).toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('alpha-layer-1-fill-offset.png'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"per channel level adjustment","suites":["Linear adjustment"],"updatePoint":{"line":58,"column":34,"index":2532},"line":58,"code":"  it('per channel level adjustment', function (done) {\n    sharp(fixtures.inputWebP).linear([0.25, 0.5, 0.75], [150, 100, 50]).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('linear-per-channel.jpg'), data, done);\n    });\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"output is integer, not float, RGB","suites":["Linear adjustment"],"updatePoint":{"line":64,"column":39,"index":2829},"line":64,"code":"  it('output is integer, not float, RGB', async () => {\n    const data = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: 'red'\n      }\n    }).linear(1, 0).tiff({\n      compression: 'none'\n    }).toBuffer();\n    const {\n      channels,\n      depth\n    } = await sharp(data).metadata();\n    assert.strictEqual(channels, 3);\n    assert.strictEqual(depth, 'uchar');\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"output is integer, not float, RGBA","suites":["Linear adjustment"],"updatePoint":{"line":82,"column":40,"index":3258},"line":82,"code":"  it('output is integer, not float, RGBA', async () => {\n    const data = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 4,\n        background: '#ff000077'\n      }\n    }).linear(1, 0).tiff({\n      compression: 'none'\n    }).toBuffer();\n    const {\n      channels,\n      depth\n    } = await sharp(data).metadata();\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"Invalid linear arguments","suites":["Linear adjustment"],"updatePoint":{"line":100,"column":30,"index":3683},"line":100,"code":"  it('Invalid linear arguments', function () {\n    assert.throws(() => sharp().linear('foo'), /Expected number or array of numbers for a but received foo of type string/);\n    assert.throws(() => sharp().linear(undefined, {\n      bar: 'baz'\n    }), /Expected number or array of numbers for b but received \\[object Object\\] of type object/);\n    assert.throws(() => sharp().linear([], [1]), /Expected number or array of numbers for a but received {2}of type object/);\n    assert.throws(() => sharp().linear([1, 2], [1]), /Expected a and b to be arrays of the same length/);\n    assert.throws(() => sharp().linear([1]), /Expected a and b to be arrays of the same length/);\n  });","file":"unit/linear.js","skipped":false,"dir":"test"},{"name":"1x1 window","suites":["Median filter"],"updatePoint":{"line":10,"column":16,"index":258},"line":10,"code":"  it('1x1 window', async () => {\n    const [r, g, b] = await sharp(fixtures.inputSvgSmallViewBox).median(1).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 0,\n      g: 0,\n      b: 0\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/median.js","skipped":false,"dir":"test"},{"name":"3x3 window","suites":["Median filter"],"updatePoint":{"line":22,"column":16,"index":497},"line":22,"code":"  it('3x3 window', async () => {\n    const [r, g, b] = await sharp(fixtures.inputSvgSmallViewBox).median(3).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 255,\n      g: 0,\n      b: 127\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/median.js","skipped":false,"dir":"test"},{"name":"7x7 window","suites":["Median filter"],"updatePoint":{"line":34,"column":16,"index":740},"line":34,"code":"  it('7x7 window', async () => {\n    const [r, g, b] = await sharp(fixtures.inputSvgSmallViewBox).median(7).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 255,\n      g: 19,\n      b: 146\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/median.js","skipped":false,"dir":"test"},{"name":"default window (3x3)","suites":["Median filter"],"updatePoint":{"line":46,"column":26,"index":994},"line":46,"code":"  it('default window (3x3)', async () => {\n    const [r, g, b] = await sharp(fixtures.inputSvgSmallViewBox).median().raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 255,\n      g: 0,\n      b: 127\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/median.js","skipped":false,"dir":"test"},{"name":"invalid radius","suites":["Median filter"],"updatePoint":{"line":58,"column":20,"index":1240},"line":58,"code":"  it('invalid radius', () => {\n    assert.throws(() => {\n      sharp().median(0.1);\n    });\n  });","file":"unit/median.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Image metadata"],"updatePoint":{"line":13,"column":10,"index":356},"line":13,"code":"  it('JPEG', function (done) {\n    sharp(fixtures.inputJpg).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2725, metadata.width);\n      assert.strictEqual(2225, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(true, ['undefined', 'number'].includes(typeof metadata.density));\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"JPEG with EXIF/ICC","suites":["Image metadata"],"updatePoint":{"line":34,"column":24,"index":1384},"line":34,"code":"  it('JPEG with EXIF/ICC', function (done) {\n    sharp(fixtures.inputJpgWithExif).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(450, metadata.width);\n      assert.strictEqual(600, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(72, metadata.density);\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(true, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual(8, metadata.orientation);\n      // EXIF\n      assert.strictEqual('object', typeof metadata.exif);\n      assert.strictEqual(true, metadata.exif instanceof Buffer);\n      const exif = exifReader(metadata.exif);\n      assert.strictEqual('object', typeof exif);\n      assert.strictEqual('object', typeof exif.image);\n      assert.strictEqual('number', typeof exif.image.XResolution);\n      // ICC\n      assert.strictEqual('object', typeof metadata.icc);\n      assert.strictEqual(true, metadata.icc instanceof Buffer);\n      const profile = icc.parse(metadata.icc);\n      assert.strictEqual('object', typeof profile);\n      assert.strictEqual('Generic RGB Profile', profile.description);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"JPEG with IPTC/XMP","suites":["Image metadata"],"updatePoint":{"line":66,"column":24,"index":2893},"line":66,"code":"  it('JPEG with IPTC/XMP', function (done) {\n    sharp(fixtures.inputJpgWithIptcAndXmp).metadata(function (err, metadata) {\n      if (err) throw err;\n      // IPTC\n      assert.strictEqual('object', typeof metadata.iptc);\n      assert.strictEqual(true, metadata.iptc instanceof Buffer);\n      assert.strictEqual(18250, metadata.iptc.byteLength);\n      assert.strictEqual(metadata.iptc.indexOf(Buffer.from('Photoshop')), 0);\n      // XMP\n      assert.strictEqual('object', typeof metadata.xmp);\n      assert.strictEqual(true, metadata.xmp instanceof Buffer);\n      assert.strictEqual(12466, metadata.xmp.byteLength);\n      assert.strictEqual(metadata.xmp.indexOf(Buffer.from('<?xpacket begin=\"')), 0);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"TIFF","suites":["Image metadata"],"updatePoint":{"line":82,"column":10,"index":3608},"line":82,"code":"  it('TIFF', function (done) {\n    sharp(fixtures.inputTiff).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('tiff', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2464, metadata.width);\n      assert.strictEqual(3248, metadata.height);\n      assert.strictEqual('b-w', metadata.space);\n      assert.strictEqual(1, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(300, metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual(1, metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      assert.strictEqual('inch', metadata.resolutionUnit);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Multipage TIFF","suites":["Image metadata"],"updatePoint":{"line":104,"column":20,"index":4643},"line":104,"code":"  it('Multipage TIFF', function (done) {\n    sharp(fixtures.inputTiffMultipage).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('tiff', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2464, metadata.width);\n      assert.strictEqual(3248, metadata.height);\n      assert.strictEqual('b-w', metadata.space);\n      assert.strictEqual(1, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(300, metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(2, metadata.pages);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual(1, metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"PNG","suites":["Image metadata"],"updatePoint":{"line":126,"column":9,"index":5662},"line":126,"code":"  it('PNG', function (done) {\n    sharp(fixtures.inputPng).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('png', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2809, metadata.width);\n      assert.strictEqual(2074, metadata.height);\n      assert.strictEqual('b-w', metadata.space);\n      assert.strictEqual(1, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(300, metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Transparent PNG","suites":["Image metadata"],"updatePoint":{"line":147,"column":21,"index":6654},"line":147,"code":"  it('Transparent PNG', function (done) {\n    sharp(fixtures.inputPngWithTransparency).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('png', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2048, metadata.width);\n      assert.strictEqual(1536, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(4, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(72, metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(true, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"WebP","suites":["Image metadata"],"updatePoint":{"line":168,"column":10,"index":7650},"line":168,"code":"  it('WebP', function (done) {\n    sharp(fixtures.inputWebP).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('webp', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(1024, metadata.width);\n      assert.strictEqual(772, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual('undefined', typeof metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Animated WebP","suites":["Image metadata"],"updatePoint":{"line":189,"column":19,"index":8657},"line":189,"code":"  it('Animated WebP', () => sharp(fixtures.inputWebPAnimated).metadata().then(({\n    format,\n    width,\n    height,\n    space,\n    channels,\n    depth,\n    isProgressive,\n    pages,\n    loop,\n    delay,\n    hasProfile,\n    hasAlpha\n  }) => {\n    assert.strictEqual(format, 'webp');\n    assert.strictEqual(width, 80);\n    assert.strictEqual(height, 80);\n    assert.strictEqual(space, 'srgb');\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n    assert.strictEqual(isProgressive, false);\n    assert.strictEqual(pages, 9);\n    assert.strictEqual(loop, 0);\n    assert.deepStrictEqual(delay, [120, 120, 90, 120, 120, 90, 120, 90, 30]);\n    assert.strictEqual(hasProfile, false);\n    assert.strictEqual(hasAlpha, true);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Animated WebP with all pages","suites":["Image metadata"],"updatePoint":{"line":216,"column":34,"index":9422},"line":216,"code":"  it('Animated WebP with all pages', () => sharp(fixtures.inputWebPAnimated, {\n    pages: -1\n  }).metadata().then(({\n    format,\n    width,\n    height,\n    space,\n    channels,\n    depth,\n    isProgressive,\n    pages,\n    pageHeight,\n    loop,\n    delay,\n    hasProfile,\n    hasAlpha\n  }) => {\n    assert.strictEqual(format, 'webp');\n    assert.strictEqual(width, 80);\n    assert.strictEqual(height, 720);\n    assert.strictEqual(space, 'srgb');\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n    assert.strictEqual(isProgressive, false);\n    assert.strictEqual(pages, 9);\n    assert.strictEqual(pageHeight, 80);\n    assert.strictEqual(loop, 0);\n    assert.deepStrictEqual(delay, [120, 120, 90, 120, 120, 90, 120, 90, 30]);\n    assert.strictEqual(hasProfile, false);\n    assert.strictEqual(hasAlpha, true);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Animated WebP with limited looping","suites":["Image metadata"],"updatePoint":{"line":247,"column":40,"index":10271},"line":247,"code":"  it('Animated WebP with limited looping', () => sharp(fixtures.inputWebPAnimatedLoop3).metadata().then(({\n    format,\n    width,\n    height,\n    space,\n    channels,\n    depth,\n    isProgressive,\n    pages,\n    loop,\n    delay,\n    hasProfile,\n    hasAlpha\n  }) => {\n    assert.strictEqual(format, 'webp');\n    assert.strictEqual(width, 370);\n    assert.strictEqual(height, 285);\n    assert.strictEqual(space, 'srgb');\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n    assert.strictEqual(isProgressive, false);\n    assert.strictEqual(pages, 10);\n    assert.strictEqual(loop, 3);\n    assert.deepStrictEqual(delay, [...Array(9).fill(3000), 15000]);\n    assert.strictEqual(hasProfile, false);\n    assert.strictEqual(hasAlpha, true);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"GIF","suites":["Image metadata"],"updatePoint":{"line":274,"column":9,"index":11009},"line":274,"code":"  it('GIF', function (done) {\n    sharp(fixtures.inputGif).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('gif', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(800, metadata.width);\n      assert.strictEqual(533, metadata.height);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual('undefined', typeof metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      assert.deepStrictEqual(metadata.background, {\n        r: 138,\n        g: 148,\n        b: 102\n      });\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"GIF grey+alpha","suites":["Image metadata"],"updatePoint":{"line":298,"column":20,"index":12021},"line":298,"code":"  it('GIF grey+alpha', function (done) {\n    sharp(fixtures.inputGifGreyPlusAlpha).metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('gif', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2, metadata.width);\n      assert.strictEqual(1, metadata.height);\n      assert.strictEqual(4, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual('undefined', typeof metadata.density);\n      assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Animated GIF","suites":["Image metadata"],"updatePoint":{"line":317,"column":18,"index":12931},"line":317,"code":"  it('Animated GIF', () => sharp(fixtures.inputGifAnimated).metadata().then(({\n    format,\n    width,\n    height,\n    space,\n    channels,\n    depth,\n    isProgressive,\n    pages,\n    loop,\n    delay,\n    background,\n    hasProfile,\n    hasAlpha\n  }) => {\n    assert.strictEqual(format, 'gif');\n    assert.strictEqual(width, 80);\n    assert.strictEqual(height, 80);\n    assert.strictEqual(space, 'srgb');\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n    assert.strictEqual(isProgressive, false);\n    assert.strictEqual(pages, 30);\n    assert.strictEqual(loop, 0);\n    assert.deepStrictEqual(delay, Array(30).fill(30));\n    assert.deepStrictEqual(background, {\n      r: 0,\n      g: 0,\n      b: 0\n    });\n    assert.strictEqual(hasProfile, false);\n    assert.strictEqual(hasAlpha, true);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Animated GIF with limited looping","suites":["Image metadata"],"updatePoint":{"line":350,"column":39,"index":13777},"line":350,"code":"  it('Animated GIF with limited looping', () => sharp(fixtures.inputGifAnimatedLoop3).metadata().then(({\n    format,\n    width,\n    height,\n    space,\n    channels,\n    depth,\n    isProgressive,\n    pages,\n    loop,\n    delay,\n    hasProfile,\n    hasAlpha\n  }) => {\n    assert.strictEqual(format, 'gif');\n    assert.strictEqual(width, 370);\n    assert.strictEqual(height, 285);\n    assert.strictEqual(space, 'srgb');\n    assert.strictEqual(channels, 4);\n    assert.strictEqual(depth, 'uchar');\n    assert.strictEqual(isProgressive, false);\n    assert.strictEqual(pages, 10);\n    assert.strictEqual(loop, 3);\n    assert.deepStrictEqual(delay, [...Array(9).fill(3000), 15000]);\n    assert.strictEqual(hasProfile, false);\n    assert.strictEqual(hasAlpha, true);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"vips","suites":["Image metadata"],"updatePoint":{"line":377,"column":10,"index":14514},"line":377,"code":"  it('vips', () => sharp(fixtures.inputV).metadata().then(metadata => {\n    assert.strictEqual('vips', metadata.format);\n    assert.strictEqual('undefined', typeof metadata.size);\n    assert.strictEqual(70, metadata.width);\n    assert.strictEqual(60, metadata.height);\n    assert.strictEqual(3, metadata.channels);\n    assert.strictEqual('uchar', metadata.depth);\n    assert.strictEqual(72, metadata.density);\n    assert.strictEqual('undefined', typeof metadata.chromaSubsampling);\n    assert.strictEqual(false, metadata.isProgressive);\n    assert.strictEqual(false, metadata.hasProfile);\n    assert.strictEqual(false, metadata.hasAlpha);\n    assert.strictEqual('undefined', typeof metadata.orientation);\n    assert.strictEqual('undefined', typeof metadata.exif);\n    assert.strictEqual('undefined', typeof metadata.icc);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"File in, Promise out","suites":["Image metadata"],"updatePoint":{"line":393,"column":26,"index":15359},"line":393,"code":"  it('File in, Promise out', function (done) {\n    sharp(fixtures.inputJpg).metadata().then(function (metadata) {\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2725, metadata.width);\n      assert.strictEqual(2225, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(true, ['undefined', 'number'].includes(typeof metadata.density));\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non-existent file in, Promise out","suites":["Image metadata"],"updatePoint":{"line":413,"column":39,"index":16378},"line":413,"code":"  it('Non-existent file in, Promise out', function (done) {\n    sharp('fail').metadata().then(function (metadata) {\n      throw new Error('Non-existent file');\n    }, function (err) {\n      assert.ok(!!err);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Stream in, Promise out","suites":["Image metadata"],"updatePoint":{"line":421,"column":28,"index":16603},"line":421,"code":"  it('Stream in, Promise out', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const pipeline = sharp();\n    pipeline.metadata().then(function (metadata) {\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual(829183, metadata.size);\n      assert.strictEqual(2725, metadata.width);\n      assert.strictEqual(2225, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(true, ['undefined', 'number'].includes(typeof metadata.density));\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    }).catch(done);\n    readable.pipe(pipeline);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Stream in, rejected Promise out","suites":["Image metadata"],"updatePoint":{"line":444,"column":37,"index":17724},"line":444,"code":"  it('Stream in, rejected Promise out', () => {\n    const pipeline = sharp();\n    fs.createReadStream(__filename).pipe(pipeline);\n    return pipeline.metadata().then(() => Promise.reject(new Error('Expected metadata to reject')), err => assert.strictEqual(err.message, 'Input buffer contains unsupported image format'));\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Stream in, finish event fires before metadata is requested","suites":["Image metadata"],"updatePoint":{"line":449,"column":64,"index":18078},"line":449,"code":"  it('Stream in, finish event fires before metadata is requested', done => {\n    const create = {\n      width: 1,\n      height: 1,\n      channels: 3,\n      background: 'red'\n    };\n    const image1 = sharp({\n      create\n    }).png().pipe(sharp());\n    const image2 = sharp({\n      create\n    }).png().pipe(sharp());\n    setTimeout(async () => {\n      const data1 = await image1.metadata();\n      assert.strictEqual('png', data1.format);\n      const data2 = await image2.metadata();\n      assert.strictEqual('png', data2.format);\n      done();\n    }, 500);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Stream","suites":["Image metadata"],"updatePoint":{"line":470,"column":12,"index":18589},"line":470,"code":"  it('Stream', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const pipeline = sharp().metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual(829183, metadata.size);\n      assert.strictEqual(2725, metadata.width);\n      assert.strictEqual(2225, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(true, ['undefined', 'number'].includes(typeof metadata.density));\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      done();\n    });\n    readable.pipe(pipeline);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Resize to half width using metadata","suites":["Image metadata"],"updatePoint":{"line":493,"column":41,"index":19712},"line":493,"code":"  it('Resize to half width using metadata', function (done) {\n    const image = sharp(fixtures.inputJpg);\n    image.metadata(function (err, metadata) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', metadata.format);\n      assert.strictEqual('undefined', typeof metadata.size);\n      assert.strictEqual(2725, metadata.width);\n      assert.strictEqual(2225, metadata.height);\n      assert.strictEqual('srgb', metadata.space);\n      assert.strictEqual(3, metadata.channels);\n      assert.strictEqual('uchar', metadata.depth);\n      assert.strictEqual(true, ['undefined', 'number'].includes(typeof metadata.density));\n      assert.strictEqual('4:2:0', metadata.chromaSubsampling);\n      assert.strictEqual(false, metadata.isProgressive);\n      assert.strictEqual(false, metadata.hasProfile);\n      assert.strictEqual(false, metadata.hasAlpha);\n      assert.strictEqual('undefined', typeof metadata.orientation);\n      assert.strictEqual('undefined', typeof metadata.exif);\n      assert.strictEqual('undefined', typeof metadata.icc);\n      image.resize(Math.floor(metadata.width / 2)).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual(1362, info.width);\n        assert.strictEqual(1112, info.height);\n        done();\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Keep EXIF metadata and add sRGB profile after a resize","suites":["Image metadata"],"updatePoint":{"line":521,"column":60,"index":21074},"line":521,"code":"  it('Keep EXIF metadata and add sRGB profile after a resize', function (done) {\n    sharp(fixtures.inputJpgWithExif).resize(320, 240).withMetadata().toBuffer(function (err, buffer) {\n      if (err) throw err;\n      sharp(buffer).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(true, metadata.hasProfile);\n        assert.strictEqual(8, metadata.orientation);\n        assert.strictEqual('object', typeof metadata.exif);\n        assert.strictEqual(true, metadata.exif instanceof Buffer);\n        // EXIF\n        const exif = exifReader(metadata.exif);\n        assert.strictEqual('object', typeof exif);\n        assert.strictEqual('object', typeof exif.image);\n        assert.strictEqual('number', typeof exif.image.XResolution);\n        // ICC\n        assert.strictEqual('object', typeof metadata.icc);\n        assert.strictEqual(true, metadata.icc instanceof Buffer);\n        const profile = icc.parse(metadata.icc);\n        assert.strictEqual('object', typeof profile);\n        assert.strictEqual('RGB', profile.colorSpace);\n        assert.strictEqual('Perceptual', profile.intent);\n        assert.strictEqual('Monitor', profile.deviceClass);\n        done();\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Apply CMYK output ICC profile","suites":["Image metadata"],"updatePoint":{"line":547,"column":35,"index":22275},"line":547,"code":"  it('Apply CMYK output ICC profile', function (done) {\n    const output = fixtures.path('output.icc-cmyk.jpg');\n    sharp(fixtures.inputJpg).resize(64).withMetadata({\n      icc: 'cmyk'\n    }).toFile(output, function (err) {\n      if (err) throw err;\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(true, metadata.hasProfile);\n        assert.strictEqual('cmyk', metadata.space);\n        assert.strictEqual(4, metadata.channels);\n        // ICC\n        assert.strictEqual('object', typeof metadata.icc);\n        assert.strictEqual(true, metadata.icc instanceof Buffer);\n        const profile = icc.parse(metadata.icc);\n        assert.strictEqual('object', typeof profile);\n        assert.strictEqual('CMYK', profile.colorSpace);\n        assert.strictEqual('Relative', profile.intent);\n        assert.strictEqual('Printer', profile.deviceClass);\n      });\n      fixtures.assertSimilar(output, fixtures.expected('icc-cmyk.jpg'), {\n        threshold: 1\n      }, done);\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Apply custom output ICC profile","suites":["Image metadata"],"updatePoint":{"line":572,"column":37,"index":23319},"line":572,"code":"  it('Apply custom output ICC profile', function (done) {\n    const output = fixtures.path('output.hilutite.jpg');\n    sharp(fixtures.inputJpg).resize(64).withMetadata({\n      icc: fixtures.path('hilutite.icm')\n    }).toFile(output, function (err, info) {\n      if (err) throw err;\n      fixtures.assertMaxColourDistance(output, fixtures.expected('hilutite.jpg'), 9);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Include metadata in output, enabled via empty object","suites":["Image metadata"],"updatePoint":{"line":582,"column":58,"index":23736},"line":582,"code":"  it('Include metadata in output, enabled via empty object', () => sharp(fixtures.inputJpgWithExif).withMetadata({}).toBuffer().then(buffer => sharp(buffer).metadata().then(metadata => {\n    assert.strictEqual(true, metadata.hasProfile);\n    assert.strictEqual(8, metadata.orientation);\n    assert.strictEqual('object', typeof metadata.exif);\n    assert.strictEqual(true, metadata.exif instanceof Buffer);\n    // EXIF\n    const exif = exifReader(metadata.exif);\n    assert.strictEqual('object', typeof exif);\n    assert.strictEqual('object', typeof exif.image);\n    assert.strictEqual('number', typeof exif.image.XResolution);\n    // ICC\n    assert.strictEqual('object', typeof metadata.icc);\n    assert.strictEqual(true, metadata.icc instanceof Buffer);\n    const profile = icc.parse(metadata.icc);\n    assert.strictEqual('object', typeof profile);\n    assert.strictEqual('RGB', profile.colorSpace);\n    assert.strictEqual('Perceptual', profile.intent);\n    assert.strictEqual('Monitor', profile.deviceClass);\n  })));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Remove EXIF metadata after a resize","suites":["Image metadata"],"updatePoint":{"line":601,"column":41,"index":24738},"line":601,"code":"  it('Remove EXIF metadata after a resize', function (done) {\n    sharp(fixtures.inputJpgWithExif).resize(320, 240).withMetadata(false).toBuffer(function (err, buffer) {\n      if (err) throw err;\n      sharp(buffer).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(false, metadata.hasProfile);\n        assert.strictEqual('undefined', typeof metadata.orientation);\n        assert.strictEqual('undefined', typeof metadata.exif);\n        assert.strictEqual('undefined', typeof metadata.icc);\n        done();\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Remove metadata from PNG output","suites":["Image metadata"],"updatePoint":{"line":614,"column":37,"index":25305},"line":614,"code":"  it('Remove metadata from PNG output', function (done) {\n    sharp(fixtures.inputJpgWithExif).png().toBuffer(function (err, buffer) {\n      if (err) throw err;\n      sharp(buffer).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(false, metadata.hasProfile);\n        assert.strictEqual('undefined', typeof metadata.orientation);\n        assert.strictEqual('undefined', typeof metadata.exif);\n        assert.strictEqual('undefined', typeof metadata.icc);\n        done();\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Add EXIF metadata to JPEG","suites":["Image metadata"],"updatePoint":{"line":627,"column":31,"index":25835},"line":627,"code":"  it('Add EXIF metadata to JPEG', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).jpeg().withMetadata({\n      exif: {\n        IFD0: {\n          Software: 'sharp'\n        },\n        IFD2: {\n          ExposureTime: '0.2'\n        }\n      }\n    }).toBuffer();\n    const {\n      exif\n    } = await sharp(data).metadata();\n    const parsedExif = exifReader(exif);\n    assert.strictEqual(parsedExif.image.Software, 'sharp');\n    assert.strictEqual(parsedExif.exif.ExposureTime, 0.2);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Set density of JPEG","suites":["Image metadata"],"updatePoint":{"line":652,"column":25,"index":26424},"line":652,"code":"  it('Set density of JPEG', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).withMetadata({\n      density: 300\n    }).jpeg().toBuffer();\n    const {\n      density\n    } = await sharp(data).metadata();\n    assert.strictEqual(density, 300);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Set density of PNG","suites":["Image metadata"],"updatePoint":{"line":668,"column":24,"index":26779},"line":668,"code":"  it('Set density of PNG', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).withMetadata({\n      density: 96\n    }).png().toBuffer();\n    const {\n      density\n    } = await sharp(data).metadata();\n    assert.strictEqual(density, 96);\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"chromaSubsampling 4:4:4:4 CMYK JPEG","suites":["Image metadata"],"updatePoint":{"line":684,"column":41,"index":27148},"line":684,"code":"  it('chromaSubsampling 4:4:4:4 CMYK JPEG', function () {\n    return sharp(fixtures.inputJpgWithCmykProfile).metadata().then(function (metadata) {\n      assert.strictEqual('4:4:4:4', metadata.chromaSubsampling);\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"chromaSubsampling 4:4:4 RGB JPEG","suites":["Image metadata"],"updatePoint":{"line":689,"column":38,"index":27371},"line":689,"code":"  it('chromaSubsampling 4:4:4 RGB JPEG', function () {\n    return sharp(fixtures.inputJpg).resize(10, 10).jpeg({\n      chromaSubsampling: '4:4:4'\n    }).toBuffer().then(function (data) {\n      return sharp(data).metadata().then(function (metadata) {\n        assert.strictEqual('4:4:4', metadata.chromaSubsampling);\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"isProgressive JPEG","suites":["Image metadata"],"updatePoint":{"line":698,"column":24,"index":27696},"line":698,"code":"  it('isProgressive JPEG', function () {\n    return sharp(fixtures.inputJpg).resize(10, 10).jpeg({\n      progressive: true\n    }).toBuffer().then(function (data) {\n      return sharp(data).metadata().then(function (metadata) {\n        assert.strictEqual(true, metadata.isProgressive);\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"isProgressive PNG","suites":["Image metadata"],"updatePoint":{"line":707,"column":23,"index":28004},"line":707,"code":"  it('isProgressive PNG', function () {\n    return sharp(fixtures.inputJpg).resize(10, 10).png({\n      progressive: true\n    }).toBuffer().then(function (data) {\n      return sharp(data).metadata().then(function (metadata) {\n        assert.strictEqual(true, metadata.isProgressive);\n      });\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"16-bit TIFF with TIFFTAG_PHOTOSHOP metadata","suites":["Image metadata"],"updatePoint":{"line":716,"column":49,"index":28337},"line":716,"code":"  it('16-bit TIFF with TIFFTAG_PHOTOSHOP metadata', () => sharp(fixtures.inputTifftagPhotoshop).metadata().then(metadata => {\n    assert.strictEqual(metadata.format, 'tiff');\n    assert.strictEqual(metadata.width, 317);\n    assert.strictEqual(metadata.height, 211);\n    assert.strictEqual(metadata.space, 'rgb16');\n    assert.strictEqual(metadata.channels, 3);\n    assert.strictEqual(typeof metadata.tifftagPhotoshop, 'object');\n    assert.strictEqual(metadata.tifftagPhotoshop instanceof Buffer, true);\n    assert.strictEqual(metadata.tifftagPhotoshop.length, 6634);\n  }));","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"AVIF","suites":["Image metadata"],"updatePoint":{"line":726,"column":10,"index":28873},"line":726,"code":"  it('AVIF', async () => {\n    const metadata = await sharp(fixtures.inputAvif).metadata();\n    assert.deepStrictEqual(metadata, {\n      format: 'heif',\n      width: 2048,\n      height: 858,\n      space: 'srgb',\n      channels: 3,\n      depth: 'uchar',\n      isProgressive: false,\n      pages: 1,\n      pagePrimary: 0,\n      compression: 'av1',\n      hasProfile: false,\n      hasAlpha: false\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"File input with corrupt header fails gracefully","suites":["Image metadata"],"updatePoint":{"line":743,"column":53,"index":29322},"line":743,"code":"  it('File input with corrupt header fails gracefully', function (done) {\n    sharp(fixtures.inputJpgWithCorruptHeader).metadata(function (err) {\n      assert.strictEqual(true, !!err);\n      assert.ok(err.message.includes('Input file has corrupt header: VipsJpeg: Premature end of'), err);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Buffer input with corrupt header fails gracefully","suites":["Image metadata"],"updatePoint":{"line":750,"column":55,"index":29642},"line":750,"code":"  it('Buffer input with corrupt header fails gracefully', function (done) {\n    sharp(fs.readFileSync(fixtures.inputJpgWithCorruptHeader)).metadata(function (err) {\n      assert.strictEqual(true, !!err);\n      assert.ok(err.message.includes('Input buffer has corrupt header: VipsJpeg: Premature end of'), err);\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Unsupported lossless JPEG passes underlying error message","suites":["Image metadata"],"updatePoint":{"line":757,"column":63,"index":29989},"line":757,"code":"  it('Unsupported lossless JPEG passes underlying error message', function (done) {\n    sharp(fixtures.inputJpgLossless).metadata(function (err) {\n      assert.strictEqual(true, !!err);\n      assert.strictEqual(true, /Input file has corrupt header: VipsJpeg: Unsupported JPEG process: SOF type 0xc3/.test(err.message));\n      done();\n    });\n  });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"String orientation","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":765,"column":26,"index":30360},"line":765,"code":"    it('String orientation', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          orientation: 'zoinks'\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Negative orientation","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":772,"column":28,"index":30532},"line":772,"code":"    it('Negative orientation', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          orientation: -1\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Zero orientation","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":779,"column":24,"index":30694},"line":779,"code":"    it('Zero orientation', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          orientation: 0\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Too large orientation","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":786,"column":29,"index":30860},"line":786,"code":"    it('Too large orientation', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          orientation: 9\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non-numeric density","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":793,"column":27,"index":31024},"line":793,"code":"    it('Non-numeric density', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          density: '1'\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Negative density","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":800,"column":24,"index":31183},"line":800,"code":"    it('Negative density', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          density: -1\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non string icc","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":807,"column":22,"index":31339},"line":807,"code":"    it('Non string icc', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          icc: true\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non object exif","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":814,"column":23,"index":31494},"line":814,"code":"    it('Non object exif', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          exif: false\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non string value in object exif","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":821,"column":39,"index":31667},"line":821,"code":"    it('Non string value in object exif', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          exif: {\n            ifd0: false\n          }\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"Non string value in nested object exif","suites":["Image metadata","Invalid withMetadata parameters"],"updatePoint":{"line":830,"column":46,"index":31879},"line":830,"code":"    it('Non string value in nested object exif', function () {\n      assert.throws(function () {\n        sharp().withMetadata({\n          exif: {\n            ifd0: {\n              fail: false\n            }\n          }\n        });\n      });\n    });","file":"unit/metadata.js","skipped":false,"dir":"test"},{"name":"should throw","suites":["Modulate","Invalid options"],"updatePoint":{"line":34,"column":22,"index":694},"line":34,"code":"      it('should throw', function () {\n        assert.throws(function () {\n          sharp(fixtures.inputJpg).modulate(options);\n        });\n      });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to hue-rotate","suites":["Modulate","Invalid options"],"updatePoint":{"line":41,"column":34,"index":871},"line":41,"code":"  it('should be able to hue-rotate', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      hue: 120\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 41,\n      g: 107,\n      b: 57\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to brighten","suites":["Modulate","Invalid options"],"updatePoint":{"line":66,"column":32,"index":1296},"line":66,"code":"  it('should be able to brighten', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      brightness: 2\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 255,\n      g: 173,\n      b: 168\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to darken","suites":["Modulate","Invalid options"],"updatePoint":{"line":91,"column":30,"index":1726},"line":91,"code":"  it('should be able to darken', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      brightness: 0.5\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 97,\n      g: 17,\n      b: 25\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to saturate","suites":["Modulate","Invalid options"],"updatePoint":{"line":116,"column":32,"index":2157},"line":116,"code":"  it('should be able to saturate', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      saturation: 2\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 198,\n      g: 0,\n      b: 43\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to desaturate","suites":["Modulate","Invalid options"],"updatePoint":{"line":141,"column":34,"index":2588},"line":141,"code":"  it('should be able to desaturate', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      saturation: 0.5\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 127,\n      g: 83,\n      b: 81\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to lighten","suites":["Modulate","Invalid options"],"updatePoint":{"line":166,"column":31,"index":3019},"line":166,"code":"  it('should be able to lighten', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      lightness: 10\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 182,\n      g: 93,\n      b: 92\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to modulate all channels","suites":["Modulate","Invalid options"],"updatePoint":{"line":191,"column":45,"index":3462},"line":191,"code":"  it('should be able to modulate all channels', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).modulate({\n      brightness: 2,\n      saturation: 0.5,\n      hue: 180\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 149,\n      g: 209,\n      b: 214\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should be able to use linear and modulate together","suites":["Modulate","Invalid options"],"updatePoint":{"line":218,"column":56,"index":3957},"line":218,"code":"  it('should be able to use linear and modulate together', async () => {\n    const contrast = 1.5;\n    const brightness = 0.5;\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 153,\n          g: 68,\n          b: 68\n        }\n      }\n    }).linear(contrast, -(128 * contrast) + 128).modulate({\n      brightness\n    }).raw().toBuffer();\n    assert.deepStrictEqual({\n      r: 81,\n      g: 0,\n      b: 0\n    }, {\n      r,\n      g,\n      b\n    });\n  });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"should hue rotate by  deg","suites":["Modulate","hue-rotate"],"updatePoint":{"line":247,"column":43,"index":4602},"line":247,"code":"      it(`should hue rotate by ${angle} deg`, async () => {\n        const base = `modulate-hue-angle-${angle}.png`;\n        const actual = fixtures.path(`output.${base}`);\n        const expected = fixtures.expected(base);\n        await sharp(fixtures.testPattern).resize(320).modulate({\n          hue: angle\n        }).png({\n          compressionLevel: 0\n        }).toFile(actual).then(() => {\n          fixtures.assertMaxColourDistance(actual, expected, 3);\n        });\n      });","file":"unit/modulate.js","skipped":false,"dir":"test"},{"name":"negate (jpeg)","suites":["Negate"],"updatePoint":{"line":10,"column":19,"index":260},"line":10,"code":"  it('negate (jpeg)', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate.jpg'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (png)","suites":["Negate"],"updatePoint":{"line":19,"column":18,"index":641},"line":19,"code":"  it('negate (png)', function (done) {\n    sharp(fixtures.inputPng).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (png, trans)","suites":["Negate"],"updatePoint":{"line":28,"column":25,"index":1028},"line":28,"code":"  it('negate (png, trans)', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-trans.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (png, alpha)","suites":["Negate"],"updatePoint":{"line":37,"column":25,"index":1437},"line":37,"code":"  it('negate (png, alpha)', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-alpha.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (webp)","suites":["Negate"],"updatePoint":{"line":46,"column":19,"index":1837},"line":46,"code":"  it('negate (webp)', function (done) {\n    sharp(fixtures.inputWebP).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate.webp'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (webp, trans)","suites":["Negate"],"updatePoint":{"line":55,"column":26,"index":2228},"line":55,"code":"  it('negate (webp, trans)', function (done) {\n    sharp(fixtures.inputWebPWithTransparency).resize(320, 240).negate().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-trans.webp'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (true)","suites":["Negate"],"updatePoint":{"line":64,"column":19,"index":2634},"line":64,"code":"  it('negate (true)', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).negate(true).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate.jpg'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate (false)","suites":["Negate"],"updatePoint":{"line":73,"column":20,"index":3021},"line":73,"code":"  it('negate (false)', function (done) {\n    const output = fixtures.path('output.unmodified-by-negate.png');\n    sharp(fixtures.inputJpgWithLowContrast).negate(false).toFile(output, function (err, info) {\n      if (err) throw err;\n      fixtures.assertMaxColourDistance(output, fixtures.inputJpgWithLowContrast, 0);\n      done();\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate ({alpha: true})","suites":["Negate"],"updatePoint":{"line":81,"column":28,"index":3374},"line":81,"code":"  it('negate ({alpha: true})', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).negate({\n      alpha: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate.jpg'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate non-alpha channels (png)","suites":["Negate"],"updatePoint":{"line":92,"column":37,"index":3799},"line":92,"code":"  it('negate non-alpha channels (png)', function (done) {\n    sharp(fixtures.inputPng).resize(320, 240).negate({\n      alpha: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-preserve-alpha.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate non-alpha channels (png, trans)","suites":["Negate"],"updatePoint":{"line":103,"column":44,"index":4246},"line":103,"code":"  it('negate non-alpha channels (png, trans)', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(320, 240).negate({\n      alpha: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-preserve-alpha-trans.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate non-alpha channels (png, alpha)","suites":["Negate"],"updatePoint":{"line":114,"column":44,"index":4715},"line":114,"code":"  it('negate non-alpha channels (png, alpha)', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).resize(320, 240).negate({\n      alpha: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-preserve-alpha-grey.png'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate non-alpha channels (webp)","suites":["Negate"],"updatePoint":{"line":125,"column":38,"index":5174},"line":125,"code":"  it('negate non-alpha channels (webp)', function (done) {\n    sharp(fixtures.inputWebP).resize(320, 240).negate({\n      alpha: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-preserve-alpha.webp'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate non-alpha channels (webp, trans)","suites":["Negate"],"updatePoint":{"line":136,"column":45,"index":5625},"line":136,"code":"  it('negate non-alpha channels (webp, trans)', function (done) {\n    sharp(fixtures.inputWebPWithTransparency).resize(320, 240).negate({\n      alpha: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('negate-preserve-alpha-trans.webp'), data, done);\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"negate create","suites":["Negate"],"updatePoint":{"line":147,"column":19,"index":6072},"line":147,"code":"  it('negate create', async () => {\n    const [r, g, b] = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: {\n          r: 10,\n          g: 20,\n          b: 30\n        }\n      }\n    }).negate().raw().toBuffer();\n    assert.deepStrictEqual({\n      r,\n      g,\n      b\n    }, {\n      r: 245,\n      g: 235,\n      b: 225\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"invalid alpha value","suites":["Negate"],"updatePoint":{"line":170,"column":25,"index":6467},"line":170,"code":"  it('invalid alpha value', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputWebPWithTransparency).negate({\n        alpha: 'non-bool'\n      });\n    });\n  });","file":"unit/negate.js","skipped":false,"dir":"test"},{"name":"generate single-channel gaussian noise","suites":["Gaussian noise"],"updatePoint":{"line":10,"column":44,"index":293},"line":10,"code":"  it('generate single-channel gaussian noise', function (done) {\n    const output = fixtures.path('output.noise-1-channel.png');\n    const noise = sharp({\n      create: {\n        width: 1024,\n        height: 768,\n        channels: 1,\n        // b-w\n        noise: {\n          type: 'gaussian',\n          mean: 128,\n          sigma: 30\n        }\n      }\n    }).toColourspace('b-w');\n    noise.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(1024, info.width);\n      assert.strictEqual(768, info.height);\n      assert.strictEqual(1, info.channels);\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual('b-w', metadata.space);\n        assert.strictEqual('uchar', metadata.depth);\n        done();\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"generate 3-channels gaussian noise","suites":["Gaussian noise"],"updatePoint":{"line":39,"column":40,"index":1151},"line":39,"code":"  it('generate 3-channels gaussian noise', function (done) {\n    const output = fixtures.path('output.noise-3-channels.png');\n    const noise = sharp({\n      create: {\n        width: 1024,\n        height: 768,\n        channels: 3,\n        // sRGB\n        noise: {\n          type: 'gaussian',\n          mean: 128,\n          sigma: 30\n        }\n      }\n    });\n    noise.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(1024, info.width);\n      assert.strictEqual(768, info.height);\n      assert.strictEqual(3, info.channels);\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual('srgb', metadata.space);\n        assert.strictEqual('uchar', metadata.depth);\n        done();\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"overlay 3-channels gaussian noise over image","suites":["Gaussian noise"],"updatePoint":{"line":68,"column":50,"index":2001},"line":68,"code":"  it('overlay 3-channels gaussian noise over image', function (done) {\n    const output = fixtures.path('output.noise-image.jpg');\n    const noise = sharp({\n      create: {\n        width: 320,\n        height: 240,\n        channels: 3,\n        noise: {\n          type: 'gaussian',\n          mean: 0,\n          sigma: 5\n        }\n      }\n    });\n    noise.toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(3, info.channels);\n      sharp(fixtures.inputJpg).resize(320, 240).composite([{\n        input: data,\n        blend: 'exclusion',\n        raw: {\n          width: info.width,\n          height: info.height,\n          channels: info.channels\n        }\n      }]).toFile(output, function (err, info) {\n        if (err) throw err;\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        assert.strictEqual(3, info.channels);\n        // perceptual hashing detects that images are the same (difference is <=1%)\n        fixtures.assertSimilar(output, fixtures.inputJpg, function (err) {\n          if (err) throw err;\n          done();\n        });\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"overlay strong single-channel (sRGB) gaussian noise with 25% transparency over transparent png image","suites":["Gaussian noise"],"updatePoint":{"line":107,"column":106,"index":3253},"line":107,"code":"  it('overlay strong single-channel (sRGB) gaussian noise with 25% transparency over transparent png image', function (done) {\n    const output = fixtures.path('output.noise-image-transparent.png');\n    const width = 320;\n    const height = 240;\n    const rawData = {\n      width,\n      height,\n      channels: 1\n    };\n    const noise = sharp({\n      create: {\n        width,\n        height,\n        channels: 1,\n        noise: {\n          type: 'gaussian',\n          mean: 200,\n          sigma: 30\n        }\n      }\n    });\n    noise.toColourspace('b-w').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(1, info.channels);\n      sharp(data, {\n        raw: rawData\n      }).joinChannel(data, {\n        raw: rawData\n      }) // r channel\n      .joinChannel(data, {\n        raw: rawData\n      }) // b channel\n      .joinChannel(Buffer.alloc(width * height, 64), {\n        raw: rawData\n      }) // alpha channel\n      .toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(4, info.channels);\n        sharp(fixtures.inputPngRGBWithAlpha).resize(width, height).composite([{\n          input: data,\n          blend: 'exclusion',\n          raw: {\n            width: info.width,\n            height: info.height,\n            channels: info.channels\n          }\n        }]).toFile(output, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('png', info.format);\n          assert.strictEqual(width, info.width);\n          assert.strictEqual(height, info.height);\n          assert.strictEqual(4, info.channels);\n          fixtures.assertSimilar(output, fixtures.inputPngRGBWithAlpha, {\n            threshold: 10\n          }, function (err) {\n            if (err) throw err;\n            done();\n          });\n        });\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"no create object properties specified","suites":["Gaussian noise"],"updatePoint":{"line":169,"column":43,"index":5031},"line":169,"code":"  it('no create object properties specified', function () {\n    assert.throws(function () {\n      sharp({\n        create: {}\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"invalid noise object","suites":["Gaussian noise"],"updatePoint":{"line":176,"column":26,"index":5163},"line":176,"code":"  it('invalid noise object', function () {\n    assert.throws(function () {\n      sharp({\n        create: {\n          width: 100,\n          height: 100,\n          channels: 3,\n          noise: 'gaussian'\n        }\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"unknown type of noise","suites":["Gaussian noise"],"updatePoint":{"line":188,"column":27,"index":5401},"line":188,"code":"  it('unknown type of noise', function () {\n    assert.throws(function () {\n      sharp({\n        create: {\n          width: 100,\n          height: 100,\n          channels: 3,\n          noise: {\n            type: 'unknown'\n          }\n        }\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"gaussian noise, invalid amount of channels","suites":["Gaussian noise"],"updatePoint":{"line":202,"column":48,"index":5691},"line":202,"code":"  it('gaussian noise, invalid amount of channels', function () {\n    assert.throws(function () {\n      sharp({\n        create: {\n          width: 100,\n          height: 100,\n          channels: 5,\n          noise: {\n            type: 'gaussian',\n            mean: 5,\n            sigma: 10\n          }\n        }\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"gaussian noise, invalid mean","suites":["Gaussian noise"],"updatePoint":{"line":218,"column":34,"index":6012},"line":218,"code":"  it('gaussian noise, invalid mean', function () {\n    assert.throws(function () {\n      sharp({\n        create: {\n          width: 100,\n          height: 100,\n          channels: 1,\n          noise: {\n            type: 'gaussian',\n            mean: -1.5,\n            sigma: 10\n          }\n        }\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"gaussian noise, invalid sigma","suites":["Gaussian noise"],"updatePoint":{"line":234,"column":35,"index":6337},"line":234,"code":"  it('gaussian noise, invalid sigma', function () {\n    assert.throws(function () {\n      sharp({\n        create: {\n          width: 100,\n          height: 100,\n          channels: 1,\n          noise: {\n            type: 'gaussian',\n            mean: 0,\n            sigma: -1.5\n          }\n        }\n      });\n    });\n  });","file":"unit/noise.js","skipped":false,"dir":"test"},{"name":"spreads rgb image values between 0 and 255","suites":["Normalization"],"updatePoint":{"line":20,"column":48,"index":557},"line":20,"code":"  it('spreads rgb image values between 0 and 255', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).normalise().raw().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assertNormalized(data);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"spreads grayscaled image values between 0 and 255","suites":["Normalization"],"updatePoint":{"line":27,"column":55,"index":817},"line":27,"code":"  it('spreads grayscaled image values between 0 and 255', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).greyscale().normalize().raw().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assertNormalized(data);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"stretches greyscale images with alpha channel","suites":["Normalization"],"updatePoint":{"line":34,"column":51,"index":1085},"line":34,"code":"  it('stretches greyscale images with alpha channel', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).normalise().raw().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assertNormalized(data);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"keeps an existing alpha channel","suites":["Normalization"],"updatePoint":{"line":41,"column":37,"index":1325},"line":41,"code":"  it('keeps an existing alpha channel', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(8, 8).normalize().toBuffer(function (err, data) {\n      if (err) throw err;\n      sharp(data).metadata(function (err, metadata) {\n        if (err) return done(err);\n        assert.strictEqual(4, metadata.channels);\n        assert.strictEqual(true, metadata.hasAlpha);\n        assert.strictEqual('srgb', metadata.space);\n        done();\n      });\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"keeps the alpha channel of greyscale images intact","suites":["Normalization"],"updatePoint":{"line":53,"column":56,"index":1814},"line":53,"code":"  it('keeps the alpha channel of greyscale images intact', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).resize(8, 8).normalise().toBuffer(function (err, data) {\n      if (err) throw err;\n      sharp(data).metadata(function (err, metadata) {\n        if (err) return done(err);\n        assert.strictEqual(true, metadata.hasAlpha);\n        assert.strictEqual(4, metadata.channels);\n        assert.strictEqual('srgb', metadata.space);\n        done();\n      });\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"does not alter images with only one color","suites":["Normalization"],"updatePoint":{"line":65,"column":47,"index":2291},"line":65,"code":"  it('does not alter images with only one color', function (done) {\n    const output = fixtures.path('output.unmodified-png-with-one-color.png');\n    sharp(fixtures.inputPngWithOneColor).normalize().toFile(output, function (err, info) {\n      if (err) done(err);\n      fixtures.assertMaxColourDistance(output, fixtures.inputPngWithOneColor, 0);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"works with 16-bit RGBA images","suites":["Normalization"],"updatePoint":{"line":73,"column":35,"index":2652},"line":73,"code":"  it('works with 16-bit RGBA images', function (done) {\n    sharp(fixtures.inputPngWithTransparency16bit).normalise().raw().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assertNormalized(data);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should handle luminance range","suites":["Normalization"],"updatePoint":{"line":80,"column":35,"index":2898},"line":80,"code":"  it('should handle luminance range', function (done) {\n    sharp(fixtures.inputJpgWithLowContrast).normalise({\n      lower: 10,\n      upper: 70\n    }).raw().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assertNormalized(data);\n      done();\n    });\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should allow lower without upper","suites":["Normalization"],"updatePoint":{"line":90,"column":38,"index":3181},"line":90,"code":"  it('should allow lower without upper', function () {\n    assert.doesNotThrow(() => sharp().normalize({\n      lower: 2\n    }));\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should allow upper without lower","suites":["Normalization"],"updatePoint":{"line":95,"column":38,"index":3316},"line":95,"code":"  it('should allow upper without lower', function () {\n    assert.doesNotThrow(() => sharp().normalize({\n      upper: 98\n    }));\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when lower is out of range","suites":["Normalization"],"updatePoint":{"line":100,"column":45,"index":3459},"line":100,"code":"  it('should throw when lower is out of range', function () {\n    assert.throws(() => sharp().normalise({\n      lower: -10\n    }), /Expected number between 0 and 99 for lower but received -10 of type number/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when upper is out of range","suites":["Normalization"],"updatePoint":{"line":105,"column":45,"index":3675},"line":105,"code":"  it('should throw when upper is out of range', function () {\n    assert.throws(() => sharp().normalise({\n      upper: 110\n    }), /Expected number between 1 and 100 for upper but received 110 of type number/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when lower is not a number","suites":["Normalization"],"updatePoint":{"line":110,"column":45,"index":3892},"line":110,"code":"  it('should throw when lower is not a number', function () {\n    assert.throws(() => sharp().normalise({\n      lower: 'fail'\n    }), /Expected number between 0 and 99 for lower but received fail of type string/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when upper is not a number","suites":["Normalization"],"updatePoint":{"line":115,"column":45,"index":4112},"line":115,"code":"  it('should throw when upper is not a number', function () {\n    assert.throws(() => sharp().normalise({\n      upper: 'fail'\n    }), /Expected number between 1 and 100 for upper but received fail of type string/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when the lower and upper are equal","suites":["Normalization"],"updatePoint":{"line":120,"column":53,"index":4341},"line":120,"code":"  it('should throw when the lower and upper are equal', function () {\n    assert.throws(() => sharp().normalise({\n      lower: 2,\n      upper: 2\n    }), /Expected lower to be less than upper for range but received 2 >= 2/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"should throw when the lower is greater than upper","suites":["Normalization"],"updatePoint":{"line":126,"column":55,"index":4573},"line":126,"code":"  it('should throw when the lower is greater than upper', function () {\n    assert.throws(() => sharp().normalise({\n      lower: 3,\n      upper: 2\n    }), /Expected lower to be less than upper for range but received 3 >= 2/);\n  });","file":"unit/normalize.js","skipped":false,"dir":"test"},{"name":"Can override arch with npm_config_arch","suites":["Platform-detection"],"updatePoint":{"line":9,"column":44,"index":271},"line":9,"code":"  it('Can override arch with npm_config_arch', function () {\n    process.env.npm_config_arch = 'test';\n    assert.strictEqual('test', platform().split('-')[1]);\n    delete process.env.npm_config_arch;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can override platform with npm_config_platform","suites":["Platform-detection"],"updatePoint":{"line":14,"column":52,"index":486},"line":14,"code":"  it('Can override platform with npm_config_platform', function () {\n    process.env.npm_config_platform = 'test';\n    assert.strictEqual('test', platform().split('-')[0]);\n    delete process.env.npm_config_platform;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can override ARM version via --arm-version","suites":["Platform-detection"],"updatePoint":{"line":19,"column":48,"index":705},"line":19,"code":"  it('Can override ARM version via --arm-version', function () {\n    process.env.npm_config_arch = 'arm';\n    process.env.npm_config_arm_version = 'test';\n    assert.strictEqual('armvtest', platform().split('-')[1]);\n    delete process.env.npm_config_arm_version;\n    delete process.env.npm_config_arch;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can override ARM64 version via --arm-version","suites":["Platform-detection"],"updatePoint":{"line":26,"column":50,"index":1017},"line":26,"code":"  it('Can override ARM64 version via --arm-version', function () {\n    process.env.npm_config_arch = 'arm64';\n    process.env.npm_config_arm_version = 'test';\n    assert.strictEqual('arm64vtest', platform().split('-')[1]);\n    delete process.env.npm_config_arm_version;\n    delete process.env.npm_config_arch;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can detect ARM version via process.config","suites":["Platform-detection"],"updatePoint":{"line":34,"column":49,"index":1378},"line":34,"code":"    it('Can detect ARM version via process.config', function () {\n      process.env.npm_config_arch = 'arm';\n      assert.strictEqual(`armv${process.config.variables.arm_version}`, platform().split('-')[1]);\n      delete process.env.npm_config_arch;\n    });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Defaults to ARMv6 for 32-bit","suites":["Platform-detection"],"updatePoint":{"line":41,"column":36,"index":1674},"line":41,"code":"    it('Defaults to ARMv6 for 32-bit', function () {\n      process.env.npm_config_arch = 'arm';\n      assert.strictEqual('armv6', platform().split('-')[1]);\n      delete process.env.npm_config_arch;\n    });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Defaults to ARMv8 for 64-bit","suites":["Platform-detection"],"updatePoint":{"line":47,"column":34,"index":1883},"line":47,"code":"  it('Defaults to ARMv8 for 64-bit', function () {\n    process.env.npm_config_arch = 'arm64';\n    assert.strictEqual('arm64v8', platform().split('-')[1]);\n    delete process.env.npm_config_arch;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can ensure version ARMv7 if electron version is present","suites":["Platform-detection"],"updatePoint":{"line":52,"column":61,"index":2111},"line":52,"code":"  it('Can ensure version ARMv7 if electron version is present', function () {\n    process.env.npm_config_arch = 'arm';\n    process.versions.electron = 'test';\n    assert.strictEqual('armv7', platform().split('-')[1]);\n    delete process.env.npm_config_arch;\n    delete process.versions.electron;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Can override libc if platform is linux","suites":["Platform-detection"],"updatePoint":{"line":59,"column":44,"index":2396},"line":59,"code":"  it('Can override libc if platform is linux', function () {\n    process.env.npm_config_platform = 'linux';\n    process.env.npm_config_libc = 'test';\n    assert.strictEqual('linuxtest', platform().split('-')[0]);\n    delete process.env.npm_config_platform;\n    delete process.env.npm_config_libc;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Handles libc value \"glibc\" as default linux","suites":["Platform-detection"],"updatePoint":{"line":66,"column":49,"index":2704},"line":66,"code":"  it('Handles libc value \"glibc\" as default linux', function () {\n    process.env.npm_config_platform = 'linux';\n    process.env.npm_config_libc = 'glibc';\n    assert.strictEqual('linux', platform().split('-')[0]);\n    delete process.env.npm_config_platform;\n    delete process.env.npm_config_libc;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"Discards libc value on non-linux platform","suites":["Platform-detection"],"updatePoint":{"line":73,"column":47,"index":3007},"line":73,"code":"  it('Discards libc value on non-linux platform', function () {\n    process.env.npm_config_platform = 'win32';\n    process.env.npm_config_libc = 'gnuwin32';\n    assert.strictEqual('win32', platform().split('-')[0]);\n    delete process.env.npm_config_platform;\n    delete process.env.npm_config_libc;\n  });","file":"unit/platform.js","skipped":false,"dir":"test"},{"name":"compression level is valid","suites":["PNG"],"updatePoint":{"line":11,"column":32,"index":296},"line":11,"code":"  it('compression level is valid', function () {\n    assert.doesNotThrow(function () {\n      sharp().png({\n        compressionLevel: 0\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"compression level is invalid","suites":["PNG"],"updatePoint":{"line":18,"column":34,"index":457},"line":18,"code":"  it('compression level is invalid', function () {\n    assert.throws(function () {\n      sharp().png({\n        compressionLevel: -1\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"default compressionLevel generates smaller file than compressionLevel=0","suites":["PNG"],"updatePoint":{"line":25,"column":77,"index":656},"line":25,"code":"  it('default compressionLevel generates smaller file than compressionLevel=0', function (done) {\n    // First generate with default compressionLevel\n    sharp(fixtures.inputPng).resize(320, 240).png().toBuffer(function (err, defaultData, defaultInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, defaultData.length > 0);\n      assert.strictEqual('png', defaultInfo.format);\n      // Then generate with compressionLevel=6\n      sharp(fixtures.inputPng).resize(320, 240).png({\n        compressionLevel: 0\n      }).toBuffer(function (err, largerData, largerInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, largerData.length > 0);\n        assert.strictEqual('png', largerInfo.format);\n        assert.strictEqual(true, defaultData.length < largerData.length);\n        done();\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"without adaptiveFiltering generates smaller file","suites":["PNG"],"updatePoint":{"line":43,"column":54,"index":1463},"line":43,"code":"  it('without adaptiveFiltering generates smaller file', function (done) {\n    // First generate with adaptive filtering\n    sharp(fixtures.inputPng).resize(320, 240).png({\n      adaptiveFiltering: true\n    }).toBuffer(function (err, adaptiveData, adaptiveInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, adaptiveData.length > 0);\n      assert.strictEqual(adaptiveData.length, adaptiveInfo.size);\n      assert.strictEqual('png', adaptiveInfo.format);\n      assert.strictEqual(320, adaptiveInfo.width);\n      assert.strictEqual(240, adaptiveInfo.height);\n      // Then generate without\n      sharp(fixtures.inputPng).resize(320, 240).png({\n        adaptiveFiltering: false\n      }).toBuffer(function (err, withoutAdaptiveData, withoutAdaptiveInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, withoutAdaptiveData.length > 0);\n        assert.strictEqual(withoutAdaptiveData.length, withoutAdaptiveInfo.size);\n        assert.strictEqual('png', withoutAdaptiveInfo.format);\n        assert.strictEqual(320, withoutAdaptiveInfo.width);\n        assert.strictEqual(240, withoutAdaptiveInfo.height);\n        assert.strictEqual(true, withoutAdaptiveData.length < adaptiveData.length);\n        done();\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG adaptiveFiltering value throws error","suites":["PNG"],"updatePoint":{"line":69,"column":54,"index":2712},"line":69,"code":"  it('Invalid PNG adaptiveFiltering value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        adaptiveFiltering: 1\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Progressive PNG image","suites":["PNG"],"updatePoint":{"line":76,"column":27,"index":2861},"line":76,"code":"  it('Progressive PNG image', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).png({\n      progressive: false\n    }).toBuffer(function (err, nonProgressiveData, nonProgressiveInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, nonProgressiveData.length > 0);\n      assert.strictEqual(nonProgressiveData.length, nonProgressiveInfo.size);\n      assert.strictEqual('png', nonProgressiveInfo.format);\n      assert.strictEqual(320, nonProgressiveInfo.width);\n      assert.strictEqual(240, nonProgressiveInfo.height);\n      sharp(nonProgressiveData).png({\n        progressive: true\n      }).toBuffer(function (err, progressiveData, progressiveInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, progressiveData.length > 0);\n        assert.strictEqual(progressiveData.length, progressiveInfo.size);\n        assert.strictEqual(true, progressiveData.length > nonProgressiveData.length);\n        assert.strictEqual('png', progressiveInfo.format);\n        assert.strictEqual(320, progressiveInfo.width);\n        assert.strictEqual(240, progressiveInfo.height);\n        done();\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"16-bit grey+alpha PNG identity transform","suites":["PNG"],"updatePoint":{"line":100,"column":46,"index":4015},"line":100,"code":"  it('16-bit grey+alpha PNG identity transform', function () {\n    const actual = fixtures.path('output.16-bit-grey-alpha-identity.png');\n    return sharp(fixtures.inputPng16BitGreyAlpha).toFile(actual).then(function () {\n      fixtures.assertMaxColourDistance(actual, fixtures.expected('16-bit-grey-alpha-identity.png'));\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"16-bit grey+alpha PNG roundtrip","suites":["PNG"],"updatePoint":{"line":106,"column":37,"index":4343},"line":106,"code":"  it('16-bit grey+alpha PNG roundtrip', async () => {\n    const after = await sharp(fixtures.inputPng16BitGreyAlpha).toColourspace('grey16').toBuffer();\n    const [alphaMeanBefore, alphaMeanAfter] = (await Promise.all([sharp(fixtures.inputPng16BitGreyAlpha).stats(), sharp(after).stats()])).map(stats => stats.channels[1].mean);\n    assert.strictEqual(alphaMeanAfter, alphaMeanBefore);\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"palette decode/encode roundtrip","suites":["PNG"],"updatePoint":{"line":111,"column":37,"index":4735},"line":111,"code":"  it('palette decode/encode roundtrip', async () => {\n    const data = await sharp(fixtures.inputPngPalette).png({\n      effort: 1,\n      palette: true\n    }).toBuffer();\n    const {\n      size,\n      ...metadata\n    } = await sharp(data).metadata();\n    assert.deepStrictEqual(metadata, {\n      format: 'png',\n      width: 68,\n      height: 68,\n      space: 'srgb',\n      channels: 3,\n      density: 72,\n      depth: 'uchar',\n      isProgressive: false,\n      paletteBitDepth: 8,\n      hasProfile: false,\n      hasAlpha: false\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Valid PNG libimagequant palette value does not throw error","suites":["PNG"],"updatePoint":{"line":134,"column":64,"index":5304},"line":134,"code":"  it('Valid PNG libimagequant palette value does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().png({\n        palette: false\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG libimagequant palette value throws error","suites":["PNG"],"updatePoint":{"line":141,"column":58,"index":5484},"line":141,"code":"  it('Invalid PNG libimagequant palette value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        palette: 'fail'\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Valid PNG libimagequant quality value produces image of same size or smaller","suites":["PNG"],"updatePoint":{"line":148,"column":82,"index":5683},"line":148,"code":"  it('Valid PNG libimagequant quality value produces image of same size or smaller', function () {\n    const inputPngBuffer = fs.readFileSync(fixtures.inputPng);\n    return Promise.all([sharp(inputPngBuffer).resize(10).png({\n      effort: 1,\n      quality: 80\n    }).toBuffer(), sharp(inputPngBuffer).resize(10).png({\n      effort: 1,\n      quality: 100\n    }).toBuffer()]).then(function (data) {\n      assert.strictEqual(true, data[0].length <= data[1].length);\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG libimagequant quality value throws error","suites":["PNG"],"updatePoint":{"line":160,"column":58,"index":6136},"line":160,"code":"  it('Invalid PNG libimagequant quality value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        quality: 101\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid effort value throws error","suites":["PNG"],"updatePoint":{"line":167,"column":39,"index":6289},"line":167,"code":"  it('Invalid effort value throws error', () => {\n    assert.throws(() => {\n      sharp().png({\n        effort: 0.1\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Valid PNG libimagequant colours value produces image of same size or smaller","suites":["PNG"],"updatePoint":{"line":174,"column":82,"index":6472},"line":174,"code":"  it('Valid PNG libimagequant colours value produces image of same size or smaller', function () {\n    const inputPngBuffer = fs.readFileSync(fixtures.inputPng);\n    return Promise.all([sharp(inputPngBuffer).resize(10).png({\n      colours: 100\n    }).toBuffer(), sharp(inputPngBuffer).resize(10).png({\n      colours: 200\n    }).toBuffer()]).then(function (data) {\n      assert.strictEqual(true, data[0].length <= data[1].length);\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG libimagequant colours value throws error","suites":["PNG"],"updatePoint":{"line":184,"column":58,"index":6892},"line":184,"code":"  it('Invalid PNG libimagequant colours value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        colours: -1\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG libimagequant colors value throws error","suites":["PNG"],"updatePoint":{"line":191,"column":57,"index":7062},"line":191,"code":"  it('Invalid PNG libimagequant colors value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        colors: 0.1\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Can set bitdepth of PNG without palette","suites":["PNG"],"updatePoint":{"line":198,"column":45,"index":7220},"line":198,"code":"  it('Can set bitdepth of PNG without palette', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).toColourspace('b-w').png({\n      colours: 2,\n      palette: false\n    }).toBuffer();\n    const {\n      channels,\n      paletteBitDepth,\n      size,\n      space\n    } = await sharp(data).metadata();\n    assert.strictEqual(channels, 1);\n    assert.strictEqual(paletteBitDepth, undefined);\n    assert.strictEqual(size, 89);\n    assert.strictEqual(space, 'b-w');\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Valid PNG libimagequant dither value produces image of same size or smaller","suites":["PNG"],"updatePoint":{"line":221,"column":81,"index":7829},"line":221,"code":"  it('Valid PNG libimagequant dither value produces image of same size or smaller', function () {\n    const inputPngBuffer = fs.readFileSync(fixtures.inputPng);\n    return Promise.all([sharp(inputPngBuffer).resize(10).png({\n      dither: 0.1\n    }).toBuffer(), sharp(inputPngBuffer).resize(10).png({\n      dither: 0.9\n    }).toBuffer()]).then(function (data) {\n      assert.strictEqual(true, data[0].length <= data[1].length);\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Invalid PNG libimagequant dither value throws error","suites":["PNG"],"updatePoint":{"line":231,"column":57,"index":8246},"line":231,"code":"  it('Invalid PNG libimagequant dither value throws error', function () {\n    assert.throws(function () {\n      sharp().png({\n        dither: 'fail'\n      });\n    });\n  });","file":"unit/png.js","skipped":false,"dir":"test"},{"name":"Empty data","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":11,"column":18,"index":311},"line":11,"code":"    it('Empty data', function () {\n      assert.throws(function () {\n        sharp(Buffer.from(''));\n      }, /empty/);\n      assert.throws(function () {\n        sharp(new ArrayBuffer(0));\n      }, /empty/);\n      assert.throws(function () {\n        sharp(new Uint8Array(0));\n      }, /empty/);\n      assert.throws(function () {\n        sharp(new Uint8ClampedArray(0));\n      }, /empty/);\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Missing options","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":25,"column":23,"index":713},"line":25,"code":"    it('Missing options', function () {\n      assert.throws(function () {\n        sharp({\n          raw: {}\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Incomplete options","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":32,"column":26,"index":854},"line":32,"code":"    it('Incomplete options', function () {\n      assert.throws(function () {\n        sharp({\n          raw: {\n            width: 1,\n            height: 1\n          }\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Invalid channels","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":42,"column":24,"index":1048},"line":42,"code":"    it('Invalid channels', function () {\n      assert.throws(function () {\n        sharp({\n          raw: {\n            width: 1,\n            height: 1,\n            channels: 5\n          }\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Invalid height","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":53,"column":22,"index":1265},"line":53,"code":"    it('Invalid height', function () {\n      assert.throws(function () {\n        sharp({\n          raw: {\n            width: 1,\n            height: 0,\n            channels: 4\n          }\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Invalid width","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":64,"column":21,"index":1481},"line":64,"code":"    it('Invalid width', function () {\n      assert.throws(function () {\n        sharp({\n          raw: {\n            width: 'zoinks',\n            height: 1,\n            channels: 4\n          }\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"RGB","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":75,"column":11,"index":1694},"line":75,"code":"    it('RGB', function (done) {\n      // Convert to raw pixel data\n      sharp(fixtures.inputJpg).resize(256).raw().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(256, info.width);\n        assert.strictEqual(209, info.height);\n        assert.strictEqual(3, info.channels);\n        // Convert back to JPEG\n        sharp(data, {\n          raw: {\n            width: info.width,\n            height: info.height,\n            channels: info.channels\n          }\n        }).jpeg().toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(256, info.width);\n          assert.strictEqual(209, info.height);\n          assert.strictEqual(3, info.channels);\n          fixtures.assertSimilar(fixtures.inputJpg, data, done);\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"RGBA","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":98,"column":12,"index":2521},"line":98,"code":"    it('RGBA', function (done) {\n      // Convert to raw pixel data\n      sharp(fixtures.inputPngOverlayLayer1).resize(256).raw().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(256, info.width);\n        assert.strictEqual(192, info.height);\n        assert.strictEqual(4, info.channels);\n        // Convert back to PNG\n        sharp(data, {\n          raw: {\n            width: info.width,\n            height: info.height,\n            channels: info.channels\n          }\n        }).png().toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(256, info.width);\n          assert.strictEqual(192, info.height);\n          assert.strictEqual(4, info.channels);\n          fixtures.assertSimilar(fixtures.inputPngOverlayLayer1, data, {\n            threshold: 7\n          }, done);\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"RGBA premultiplied","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":123,"column":26,"index":3426},"line":123,"code":"    it('RGBA premultiplied', function (done) {\n      // Convert to raw pixel data\n      sharp(fixtures.inputPngSolidAlpha).resize(256).raw().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(256, info.width);\n        assert.strictEqual(192, info.height);\n        assert.strictEqual(4, info.channels);\n        const originalData = Buffer.from(data);\n\n        // Premultiply image data\n        for (let i = 0; i < data.length; i += 4) {\n          const alpha = data[i + 3];\n          const norm = alpha / 255;\n          if (alpha < 255) {\n            data[i] = Math.round(data[i] * norm);\n            data[i + 1] = Math.round(data[i + 1] * norm);\n            data[i + 2] = Math.round(data[i + 2] * norm);\n          }\n        }\n\n        // Convert back to PNG\n        sharp(data, {\n          raw: {\n            width: info.width,\n            height: info.height,\n            channels: info.channels,\n            premultiplied: true\n          }\n        }).raw().toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(256, info.width);\n          assert.strictEqual(192, info.height);\n          assert.strictEqual(4, info.channels);\n          assert.equal(data.compare(originalData), 0, 'output buffer matches unpremultiplied input buffer');\n          done();\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"JPEG to raw Stream and back again","suites":["Raw pixel data","Raw pixel input"],"updatePoint":{"line":161,"column":41,"index":4810},"line":161,"code":"    it('JPEG to raw Stream and back again', function (done) {\n      const width = 32;\n      const height = 24;\n      const writable = sharp({\n        raw: {\n          width,\n          height,\n          channels: 3\n        }\n      });\n      writable.jpeg().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(32, info.width);\n        assert.strictEqual(24, info.height);\n        done();\n      });\n      sharp(fixtures.inputJpg).resize(width, height).raw().pipe(writable);\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"1 channel greyscale image","suites":["Raw pixel data","Output raw, uncompressed image data"],"updatePoint":{"line":182,"column":33,"index":5441},"line":182,"code":"    it('1 channel greyscale image', function (done) {\n      sharp(fixtures.inputJpg).greyscale().resize(32, 24).raw().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(32 * 24 * 1, info.size);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('raw', info.format);\n        assert.strictEqual(32, info.width);\n        assert.strictEqual(24, info.height);\n        assert.strictEqual(1, info.channels);\n        done();\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"3 channel colour image without transparency","suites":["Raw pixel data","Output raw, uncompressed image data"],"updatePoint":{"line":194,"column":51,"index":5964},"line":194,"code":"    it('3 channel colour image without transparency', function (done) {\n      sharp(fixtures.inputJpg).resize(32, 24).toFormat('raw').toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(32 * 24 * 3, info.size);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('raw', info.format);\n        assert.strictEqual(32, info.width);\n        assert.strictEqual(24, info.height);\n        done();\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"4 channel colour image with transparency","suites":["Raw pixel data","Output raw, uncompressed image data"],"updatePoint":{"line":205,"column":48,"index":6436},"line":205,"code":"    it('4 channel colour image with transparency', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(32, 24).toFormat(sharp.format.raw).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(32 * 24 * 4, info.size);\n        assert.strictEqual(data.length, info.size);\n        assert.strictEqual('raw', info.format);\n        assert.strictEqual(32, info.width);\n        assert.strictEqual(24, info.height);\n        done();\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Extract A from RGBA","suites":["Raw pixel data","Output raw, uncompressed image data"],"updatePoint":{"line":216,"column":27,"index":6914},"line":216,"code":"    it('Extract A from RGBA', () => sharp(fixtures.inputPngWithTransparency).resize(32, 24).extractChannel(3).toColourspace('b-w').raw().toBuffer({\n      resolveWithObject: true\n    }).then(({\n      info\n    }) => {\n      assert.strictEqual('raw', info.format);\n      assert.strictEqual(1, info.channels);\n      assert.strictEqual(32 * 24, info.size);\n    }));","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"Invalid depth","suites":["Raw pixel data","Raw pixel depths"],"updatePoint":{"line":227,"column":21,"index":7320},"line":227,"code":"    it('Invalid depth', function () {\n      assert.throws(function () {\n        sharp(Buffer.alloc(3), {\n          raw: {\n            width: 1,\n            height: 1,\n            channels: 3\n          }\n        }).raw({\n          depth: 'zoinks'\n        });\n      });\n    });","file":"unit/raw.js","skipped":false,"dir":"test"},{"name":"applies a sepia filter using recomb","suites":["Recomb"],"updatePoint":{"line":11,"column":41,"index":373},"line":11,"code":"  it('applies a sepia filter using recomb', function (done) {\n    const output = fixtures.path('output.recomb-sepia.jpg');\n    sharp(fixtures.inputJpgWithLandscapeExif1).recomb(sepia).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(600, info.width);\n      assert.strictEqual(450, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('Landscape_1-recomb-sepia.jpg'), 17);\n      done();\n    });\n  });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"applies a sepia filter using recomb to an PNG with Alpha","suites":["Recomb"],"updatePoint":{"line":22,"column":62,"index":907},"line":22,"code":"  it('applies a sepia filter using recomb to an PNG with Alpha', function (done) {\n    const output = fixtures.path('output.recomb-sepia.png');\n    sharp(fixtures.inputPngAlphaPremultiplicationSmall).recomb(sepia).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(1024, info.width);\n      assert.strictEqual(768, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('alpha-recomb-sepia.png'), 17);\n      done();\n    });\n  });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"recomb with a single channel input","suites":["Recomb"],"updatePoint":{"line":33,"column":40,"index":1422},"line":33,"code":"  it('recomb with a single channel input', async () => {\n    const {\n      info\n    } = await sharp(Buffer.alloc(64), {\n      raw: {\n        width: 8,\n        height: 8,\n        channels: 1\n      }\n    }).recomb(sepia).toBuffer({\n      resolveWithObject: true\n    });\n    assert.strictEqual(3, info.channels);\n  });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"applies a different sepia filter using recomb","suites":["Recomb"],"updatePoint":{"line":47,"column":51,"index":1749},"line":47,"code":"  it('applies a different sepia filter using recomb', function (done) {\n    const output = fixtures.path('output.recomb-sepia2.jpg');\n    sharp(fixtures.inputJpgWithLandscapeExif1).recomb([[0.393, 0.769, 0.189], [0.349, 0.686, 0.168], [0.272, 0.534, 0.131]]).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(600, info.width);\n      assert.strictEqual(450, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('Landscape_1-recomb-sepia2.jpg'), 17);\n      done();\n    });\n  });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"increases the saturation of the image","suites":["Recomb"],"updatePoint":{"line":58,"column":43,"index":2330},"line":58,"code":"  it('increases the saturation of the image', function (done) {\n    const saturationLevel = 1;\n    const output = fixtures.path('output.recomb-saturation.jpg');\n    sharp(fixtures.inputJpgWithLandscapeExif1).recomb([[saturationLevel + 1 - 0.2989, -0.587 * saturationLevel, -0.114 * saturationLevel], [-0.2989 * saturationLevel, saturationLevel + 1 - 0.587, -0.114 * saturationLevel], [-0.2989 * saturationLevel, -0.587 * saturationLevel, saturationLevel + 1 - 0.114]]).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(600, info.width);\n      assert.strictEqual(450, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('Landscape_1-recomb-saturation.jpg'), 37);\n      done();\n    });\n  });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"missing","suites":["Recomb","invalid matrix specification"],"updatePoint":{"line":71,"column":15,"index":3162},"line":71,"code":"    it('missing', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).recomb();\n      });\n    });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"incorrect flat data","suites":["Recomb","invalid matrix specification"],"updatePoint":{"line":76,"column":27,"index":3301},"line":76,"code":"    it('incorrect flat data', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).recomb([1, 2, 3, 4, 5, 6, 7, 8, 9]);\n      });\n    });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"incorrect sub size","suites":["Recomb","invalid matrix specification"],"updatePoint":{"line":81,"column":26,"index":3466},"line":81,"code":"    it('incorrect sub size', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).recomb([[1, 2, 3, 4], [5, 6, 7, 8], [1, 2, 9, 6]]);\n      });\n    });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"incorrect top size","suites":["Recomb","invalid matrix specification"],"updatePoint":{"line":86,"column":26,"index":3646},"line":86,"code":"    it('incorrect top size', function () {\n      assert.throws(function () {\n        sharp(fixtures.inputJpg).recomb([[1, 2, 3, 4], [5, 6, 7, 8]]);\n      });\n    });","file":"unit/recomb.js","skipped":false,"dir":"test"},{"name":"Allows specifying the position as a string","suites":["Resize fit=contain"],"updatePoint":{"line":10,"column":48,"index":301},"line":10,"code":"  it('Allows specifying the position as a string', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fit: 'contain',\n      position: 'center'\n    }).png().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('embed-3-into-3.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"JPEG within PNG, no alpha channel","suites":["Resize fit=contain"],"updatePoint":{"line":21,"column":39,"index":717},"line":21,"code":"  it('JPEG within PNG, no alpha channel', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fit: 'contain'\n    }).png().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-3-into-3.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"JPEG within WebP, to include alpha channel","suites":["Resize fit=contain"],"updatePoint":{"line":34,"column":48,"index":1255},"line":34,"code":"  it('JPEG within WebP, to include alpha channel', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fit: 'contain',\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      }\n    }).webp().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-3-into-4.webp'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"PNG with alpha channel","suites":["Resize fit=contain"],"updatePoint":{"line":53,"column":28,"index":1864},"line":53,"code":"  it('PNG with alpha channel', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(50, 50, {\n      fit: 'contain'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(50, info.width);\n      assert.strictEqual(50, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-4-into-4.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"16-bit PNG with alpha channel","suites":["Resize fit=contain"],"updatePoint":{"line":66,"column":35,"index":2395},"line":66,"code":"  it('16-bit PNG with alpha channel', function (done) {\n    sharp(fixtures.inputPngWithTransparency16bit).resize(32, 16, {\n      fit: 'contain'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(16, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-16bit.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"16-bit PNG with alpha channel onto RGBA","suites":["Resize fit=contain"],"updatePoint":{"line":79,"column":45,"index":2938},"line":79,"code":"  it('16-bit PNG with alpha channel onto RGBA', function (done) {\n    sharp(fixtures.inputPngWithTransparency16bit).resize(32, 16, {\n      fit: 'contain',\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      }\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(16, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-16bit-rgba.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"PNG with 2 channels","suites":["Resize fit=contain"],"updatePoint":{"line":98,"column":25,"index":3554},"line":98,"code":"  it('PNG with 2 channels', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).resize(32, 16, {\n      fit: 'contain',\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      }\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(16, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-2channel.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"TIFF in LAB colourspace onto RGBA background","suites":["Resize fit=contain"],"updatePoint":{"line":117,"column":50,"index":4185},"line":117,"code":"  it('TIFF in LAB colourspace onto RGBA background', function (done) {\n    sharp(fixtures.inputTiffCielab).resize(64, 128, {\n      fit: 'contain',\n      background: {\n        r: 255,\n        g: 102,\n        b: 0,\n        alpha: 0.5\n      }\n    }).png().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(64, info.width);\n      assert.strictEqual(128, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-lab-into-rgba.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Enlarge","suites":["Resize fit=contain"],"updatePoint":{"line":136,"column":13,"index":4792},"line":136,"code":"  it('Enlarge', function (done) {\n    sharp(fixtures.inputPngWithOneColor).resize(320, 240, {\n      fit: 'contain'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      assert.strictEqual(3, info.channels);\n      fixtures.assertSimilar(fixtures.expected('embed-enlarge.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Width only","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":150,"column":18,"index":5347},"line":150,"code":"    it('Width only', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(320, 240, {\n        fit: 'contain',\n        background: {\n          r: 255,\n          g: 0,\n          b: 0\n        }\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual('webp', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240 * 9, info.height);\n        assert.strictEqual(4, info.channels);\n        fixtures.assertSimilar(fixtures.expected('embed-animated-width.webp'), data, done);\n      });\n    });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Height only","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":170,"column":19,"index":6006},"line":170,"code":"    it('Height only', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(240, 320, {\n        fit: 'contain',\n        background: {\n          r: 255,\n          g: 0,\n          b: 0\n        }\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(true, data.length > 0);\n        assert.strictEqual('webp', info.format);\n        assert.strictEqual(240, info.width);\n        assert.strictEqual(320 * 9, info.height);\n        assert.strictEqual(4, info.channels);\n        fixtures.assertSimilar(fixtures.expected('embed-animated-height.webp'), data, done);\n      });\n    });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Invalid position values should fail","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":191,"column":41,"index":6694},"line":191,"code":"  it('Invalid position values should fail', function () {\n    [-1, 8.1, 9, 1000000, false, 'vallejo'].forEach(function (position) {\n      assert.throws(function () {\n        sharp().resize(null, null, {\n          fit: 'contain',\n          position\n        });\n      });\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":201,"column":29,"index":6966},"line":201,"code":"  it('Position horizontal top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a2-n.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal right top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":221,"column":35,"index":7618},"line":221,"code":"  it('Position horizontal right top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a3-ne.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal right","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":241,"column":31,"index":8273},"line":241,"code":"  it('Position horizontal right', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a4-e.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal right bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":261,"column":38,"index":8930},"line":261,"code":"  it('Position horizontal right bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a5-se.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":281,"column":32,"index":9589},"line":281,"code":"  it('Position horizontal bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a6-s.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal left bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":301,"column":37,"index":10246},"line":301,"code":"  it('Position horizontal left bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a7-sw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal left","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":321,"column":30,"index":10902},"line":321,"code":"  it('Position horizontal left', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a8-w.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal left top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":341,"column":34,"index":11554},"line":341,"code":"  it('Position horizontal left top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a1-nw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal north","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":361,"column":31,"index":12208},"line":361,"code":"  it('Position horizontal north', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.north\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a2-n.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal northeast","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":381,"column":35,"index":12874},"line":381,"code":"  it('Position horizontal northeast', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.northeast\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a3-ne.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal east","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":401,"column":30,"index":13540},"line":401,"code":"  it('Position horizontal east', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.east\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a4-e.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal southeast","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":421,"column":35,"index":14205},"line":421,"code":"  it('Position horizontal southeast', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.southeast\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a5-se.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal south","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":441,"column":31,"index":14872},"line":441,"code":"  it('Position horizontal south', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.south\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a6-s.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal southwest","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":461,"column":35,"index":15538},"line":461,"code":"  it('Position horizontal southwest', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.southwest\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a7-sw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal west","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":481,"column":30,"index":16204},"line":481,"code":"  it('Position horizontal west', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.west\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a8-w.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal northwest","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":501,"column":35,"index":16869},"line":501,"code":"  it('Position horizontal northwest', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.northwest\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a1-nw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position horizontal center","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":521,"column":32,"index":17537},"line":521,"code":"  it('Position horizontal center', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 100, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.center\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(100, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/a9-c.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":541,"column":27,"index":18196},"line":541,"code":"  it('Position vertical top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/2-n.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical right top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":561,"column":33,"index":18845},"line":561,"code":"  it('Position vertical right top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/3-ne.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical right","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":581,"column":29,"index":19497},"line":581,"code":"  it('Position vertical right', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/4-e.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical right bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":601,"column":36,"index":20151},"line":601,"code":"  it('Position vertical right bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'right bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/5-se.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":621,"column":30,"index":20807},"line":621,"code":"  it('Position vertical bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/6-s.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical left bottom","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":641,"column":35,"index":21461},"line":641,"code":"  it('Position vertical left bottom', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left bottom'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/7-sw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical left","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":661,"column":28,"index":22114},"line":661,"code":"  it('Position vertical left', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/8-w.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical left top","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":681,"column":32,"index":22763},"line":681,"code":"  it('Position vertical left top', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: 'left top'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/1-nw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical north","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":701,"column":29,"index":23414},"line":701,"code":"  it('Position vertical north', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.north\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/2-n.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical northeast","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":721,"column":33,"index":24077},"line":721,"code":"  it('Position vertical northeast', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.northeast\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/3-ne.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical east","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":741,"column":28,"index":24740},"line":741,"code":"  it('Position vertical east', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.east\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/4-e.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical southeast","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":761,"column":33,"index":25402},"line":761,"code":"  it('Position vertical southeast', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.southeast\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/5-se.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical south","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":781,"column":29,"index":26066},"line":781,"code":"  it('Position vertical south', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.south\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/6-s.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical southwest","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":801,"column":33,"index":26729},"line":801,"code":"  it('Position vertical southwest', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.southwest\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/7-sw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical west","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":821,"column":28,"index":27392},"line":821,"code":"  it('Position vertical west', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.west\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/8-w.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical northwest","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":841,"column":33,"index":28054},"line":841,"code":"  it('Position vertical northwest', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.northwest\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/1-nw.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Position vertical center","suites":["Resize fit=contain","Animated WebP"],"updatePoint":{"line":861,"column":30,"index":28719},"line":861,"code":"  it('Position vertical center', function (done) {\n    sharp(fixtures.inputPngEmbed).resize(200, 200, {\n      fit: sharp.fit.contain,\n      background: {\n        r: 0,\n        g: 0,\n        b: 0,\n        alpha: 0\n      },\n      position: sharp.gravity.center\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(200, info.width);\n      assert.strictEqual(200, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('./embedgravitybird/9-c.png'), data, done);\n    });\n  });","file":"unit/resize-contain.js","skipped":false,"dir":"test"},{"name":"Allows specifying the gravity as a string","suites":["Resize fit=cover"],"updatePoint":{"line":189,"column":47,"index":4744},"line":189,"code":"  it('Allows specifying the gravity as a string', function (done) {\n    sharp(fixtures.inputJpg).resize(80, 320, {\n      fit: sharp.fit.cover,\n      position: 'east'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(80, info.width);\n      assert.strictEqual(320, info.height);\n      fixtures.assertSimilar(fixtures.expected('gravity-east.jpg'), data, done);\n    });\n  });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Invalid position values fail","suites":["Resize fit=cover"],"updatePoint":{"line":200,"column":34,"index":5149},"line":200,"code":"  it('Invalid position values fail', function () {\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        fit: 'cover',\n        position: 9\n      });\n    }, /Expected valid position\\/gravity\\/strategy for position but received 9 of type number/);\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        fit: 'cover',\n        position: 1.1\n      });\n    }, /Expected valid position\\/gravity\\/strategy for position but received 1.1 of type number/);\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        fit: 'cover',\n        position: -1\n      });\n    }, /Expected valid position\\/gravity\\/strategy for position but received -1 of type number/);\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        fit: 'cover',\n        position: 'zoinks'\n      }).crop();\n    }, /Expected valid position\\/gravity\\/strategy for position but received zoinks of type string/);\n  });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Uses default value when none specified","suites":["Resize fit=cover"],"updatePoint":{"line":226,"column":44,"index":6105},"line":226,"code":"  it('Uses default value when none specified', function () {\n    assert.doesNotThrow(function () {\n      sharp().resize(null, null, {\n        fit: 'cover'\n      });\n    });\n  });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Skip crop when post-resize dimensions are at target","suites":["Resize fit=cover"],"updatePoint":{"line":233,"column":57,"index":6297},"line":233,"code":"  it('Skip crop when post-resize dimensions are at target', function () {\n    return sharp(fixtures.inputJpg).resize(1600, 1200).toBuffer().then(function (input) {\n      return sharp(input).resize(1110, null, {\n        fit: sharp.fit.cover,\n        position: sharp.strategy.attention\n      }).toBuffer({\n        resolveWithObject: true\n      }).then(function (result) {\n        assert.strictEqual(1110, result.info.width);\n        assert.strictEqual(832, result.info.height);\n        assert.strictEqual(undefined, result.info.cropOffsetLeft);\n        assert.strictEqual(undefined, result.info.cropOffsetTop);\n      });\n    });\n  });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Width only","suites":["Resize fit=cover","Animated WebP"],"updatePoint":{"line":249,"column":18,"index":6933},"line":249,"code":"    it('Width only', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(80, 320, {\n        fit: sharp.fit.cover\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(80, info.width);\n        assert.strictEqual(320 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected('gravity-center-width.webp'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Height only","suites":["Resize fit=cover","Animated WebP"],"updatePoint":{"line":261,"column":19,"index":7368},"line":261,"code":"    it('Height only', function (done) {\n      sharp(fixtures.inputWebPAnimated, {\n        pages: -1\n      }).resize(320, 80, {\n        fit: sharp.fit.cover\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80 * 9, info.height);\n        fixtures.assertSimilar(fixtures.expected('gravity-center-height.webp'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Resize fit=cover","Entropy-based strategy"],"updatePoint":{"line":275,"column":12,"index":7854},"line":275,"code":"    it('JPEG', function (done) {\n      sharp(fixtures.inputJpg).resize(80, 320, {\n        fit: 'cover',\n        position: sharp.strategy.entropy\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(3, info.channels);\n        assert.strictEqual(80, info.width);\n        assert.strictEqual(320, info.height);\n        assert.strictEqual(-117, info.cropOffsetLeft);\n        assert.strictEqual(0, info.cropOffsetTop);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy-entropy.jpg'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"PNG","suites":["Resize fit=cover","Entropy-based strategy"],"updatePoint":{"line":290,"column":11,"index":8474},"line":290,"code":"    it('PNG', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(320, 80, {\n        fit: 'cover',\n        position: sharp.strategy.entropy\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(4, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        assert.strictEqual(0, info.cropOffsetLeft);\n        assert.strictEqual(-80, info.cropOffsetTop);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy.png'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"supports the strategy passed as a string","suites":["Resize fit=cover","Entropy-based strategy"],"updatePoint":{"line":305,"column":48,"index":9137},"line":305,"code":"    it('supports the strategy passed as a string', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(320, 80, {\n        fit: 'cover',\n        position: 'entropy'\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(4, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        assert.strictEqual(0, info.cropOffsetLeft);\n        assert.strictEqual(-80, info.cropOffsetTop);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy.png'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Animated image rejects","suites":["Resize fit=cover","Entropy-based strategy"],"updatePoint":{"line":320,"column":30,"index":9769},"line":320,"code":"    it('Animated image rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n      animated: true\n    }).resize({\n      width: 100,\n      height: 8,\n      position: sharp.strategy.entropy\n    }).toBuffer(), /Resize strategy is not supported for multi-page images/));","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Resize fit=cover","Attention strategy"],"updatePoint":{"line":329,"column":12,"index":10089},"line":329,"code":"    it('JPEG', function (done) {\n      sharp(fixtures.inputJpg).resize(80, 320, {\n        fit: 'cover',\n        position: sharp.strategy.attention\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(3, info.channels);\n        assert.strictEqual(80, info.width);\n        assert.strictEqual(320, info.height);\n        assert.strictEqual(-107, info.cropOffsetLeft);\n        assert.strictEqual(0, info.cropOffsetTop);\n        assert.strictEqual(588, info.attentionX);\n        assert.strictEqual(640, info.attentionY);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy-attention.jpg'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"PNG","suites":["Resize fit=cover","Attention strategy"],"updatePoint":{"line":346,"column":11,"index":10813},"line":346,"code":"    it('PNG', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(320, 80, {\n        fit: 'cover',\n        position: sharp.strategy.attention\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(4, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        assert.strictEqual(0, info.cropOffsetLeft);\n        assert.strictEqual(0, info.cropOffsetTop);\n        assert.strictEqual(0, info.attentionX);\n        assert.strictEqual(0, info.attentionY);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy.png'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"WebP","suites":["Resize fit=cover","Attention strategy"],"updatePoint":{"line":363,"column":12,"index":11536},"line":363,"code":"    it('WebP', function (done) {\n      sharp(fixtures.inputWebP).resize(320, 80, {\n        fit: 'cover',\n        position: sharp.strategy.attention\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('webp', info.format);\n        assert.strictEqual(3, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        assert.strictEqual(0, info.cropOffsetLeft);\n        assert.strictEqual(-161, info.cropOffsetTop);\n        assert.strictEqual(288, info.attentionX);\n        assert.strictEqual(745, info.attentionY);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy.webp'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"supports the strategy passed as a string","suites":["Resize fit=cover","Attention strategy"],"updatePoint":{"line":380,"column":48,"index":12289},"line":380,"code":"    it('supports the strategy passed as a string', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(320, 80, {\n        fit: 'cover',\n        position: 'attention'\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(4, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(80, info.height);\n        assert.strictEqual(0, info.cropOffsetLeft);\n        assert.strictEqual(0, info.cropOffsetTop);\n        fixtures.assertSimilar(fixtures.expected('crop-strategy.png'), data, done);\n      });\n    });","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Animated image rejects","suites":["Resize fit=cover","Attention strategy"],"updatePoint":{"line":395,"column":30,"index":12921},"line":395,"code":"    it('Animated image rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n      animated: true\n    }).resize({\n      width: 100,\n      height: 8,\n      position: sharp.strategy.attention\n    }).toBuffer(), /Resize strategy is not supported for multi-page images/));","file":"unit/resize-cover.js","skipped":false,"dir":"test"},{"name":"Exact crop","suites":["Resize dimensions"],"updatePoint":{"line":10,"column":16,"index":268},"line":10,"code":"  it('Exact crop', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Fixed width","suites":["Resize dimensions"],"updatePoint":{"line":20,"column":17,"index":627},"line":20,"code":"  it('Fixed width', function (done) {\n    sharp(fixtures.inputJpg).resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Fixed height","suites":["Resize dimensions"],"updatePoint":{"line":30,"column":18,"index":982},"line":30,"code":"  it('Fixed height', function (done) {\n    sharp(fixtures.inputJpg).resize(null, 320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(392, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Identity transform","suites":["Resize dimensions"],"updatePoint":{"line":40,"column":24,"index":1349},"line":40,"code":"  it('Identity transform', function (done) {\n    sharp(fixtures.inputJpg).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Upscale","suites":["Resize dimensions"],"updatePoint":{"line":50,"column":13,"index":1689},"line":50,"code":"  it('Upscale', function (done) {\n    sharp(fixtures.inputJpg).resize(3000).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3000, info.width);\n      assert.strictEqual(2450, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid width - NaN","suites":["Resize dimensions"],"updatePoint":{"line":60,"column":25,"index":2054},"line":60,"code":"  it('Invalid width - NaN', function () {\n    assert.throws(function () {\n      sharp().resize('spoons', 240);\n    }, /Expected positive integer for width but received spoons of type string/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid height - NaN","suites":["Resize dimensions"],"updatePoint":{"line":65,"column":26,"index":2254},"line":65,"code":"  it('Invalid height - NaN', function () {\n    assert.throws(function () {\n      sharp().resize(320, 'spoons');\n    }, /Expected positive integer for height but received spoons of type string/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid width - float","suites":["Resize dimensions"],"updatePoint":{"line":70,"column":27,"index":2456},"line":70,"code":"  it('Invalid width - float', function () {\n    assert.throws(function () {\n      sharp().resize(1.5, 240);\n    }, /Expected positive integer for width but received 1.5 of type number/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid height - float","suites":["Resize dimensions"],"updatePoint":{"line":75,"column":28,"index":2650},"line":75,"code":"  it('Invalid height - float', function () {\n    assert.throws(function () {\n      sharp().resize(320, 1.5);\n    }, /Expected positive integer for height but received 1.5 of type number/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid width - via options","suites":["Resize dimensions"],"updatePoint":{"line":80,"column":33,"index":2850},"line":80,"code":"  it('Invalid width - via options', () => {\n    assert.throws(() => {\n      sharp().resize({\n        width: 1.5,\n        height: 240\n      });\n    }, /Expected positive integer for width but received 1.5 of type number/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid height - via options","suites":["Resize dimensions"],"updatePoint":{"line":88,"column":34,"index":3079},"line":88,"code":"  it('Invalid height - via options', () => {\n    assert.throws(() => {\n      sharp().resize({\n        width: 320,\n        height: 1.5\n      });\n    }, /Expected positive integer for height but received 1.5 of type number/);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid width - too large","suites":["Resize dimensions"],"updatePoint":{"line":96,"column":31,"index":3306},"line":96,"code":"  it('Invalid width - too large', function (done) {\n    sharp(fixtures.inputJpg).resize(0x4000, 1).webp().toBuffer(function (err) {\n      assert.strictEqual(true, err instanceof Error);\n      assert.strictEqual('Processed image is too large for the WebP format', err.message);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Invalid height - too large","suites":["Resize dimensions"],"updatePoint":{"line":103,"column":32,"index":3612},"line":103,"code":"  it('Invalid height - too large', function (done) {\n    sharp(fixtures.inputJpg).resize(1, 0x4000).webp().toBuffer(function (err) {\n      assert.strictEqual(true, err instanceof Error);\n      assert.strictEqual('Processed image is too large for the WebP format', err.message);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Webp resize then extract large image","suites":["Resize dimensions"],"updatePoint":{"line":110,"column":42,"index":3928},"line":110,"code":"  it('Webp resize then extract large image', function (done) {\n    sharp(fixtures.inputWebP).resize(0x4000, 0x4000).extract({\n      top: 0x2000,\n      left: 0x2000,\n      width: 256,\n      height: 256\n    }).webp().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(256, info.width);\n      assert.strictEqual(256, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"WebP shrink-on-load rounds to zero, ensure recalculation is correct","suites":["Resize dimensions"],"updatePoint":{"line":124,"column":73,"index":4400},"line":124,"code":"  it('WebP shrink-on-load rounds to zero, ensure recalculation is correct', function (done) {\n    sharp(fixtures.inputJpg).resize(1080, 607).webp().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(1080, info.width);\n      assert.strictEqual(607, info.height);\n      sharp(data).resize(233, 131).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('webp', info.format);\n        assert.strictEqual(233, info.width);\n        assert.strictEqual(131, info.height);\n        done();\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"JPEG shrink-on-load with 90 degree rotation, ensure recalculation is correct","suites":["Resize dimensions"],"updatePoint":{"line":139,"column":82,"index":5037},"line":139,"code":"  it('JPEG shrink-on-load with 90 degree rotation, ensure recalculation is correct', function (done) {\n    sharp(fixtures.inputJpg).resize(1920, 1280).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(1920, info.width);\n      assert.strictEqual(1280, info.height);\n      sharp(data).rotate(90).resize(533, 800).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(533, info.width);\n        assert.strictEqual(800, info.height);\n        done();\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"TIFF embed known to cause rounding errors","suites":["Resize dimensions"],"updatePoint":{"line":152,"column":47,"index":5549},"line":152,"code":"  it('TIFF embed known to cause rounding errors', function (done) {\n    sharp(fixtures.inputTiff).resize(240, 320, {\n      fit: sharp.fit.contain\n    }).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(240, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"TIFF known to cause rounding errors","suites":["Resize dimensions"],"updatePoint":{"line":164,"column":41,"index":5978},"line":164,"code":"  it('TIFF known to cause rounding errors', function (done) {\n    sharp(fixtures.inputTiff).resize(240, 320).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(240, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=inside, portrait","suites":["Resize dimensions"],"updatePoint":{"line":174,"column":26,"index":6354},"line":174,"code":"  it('fit=inside, portrait', function (done) {\n    sharp(fixtures.inputTiff).resize(320, 320, {\n      fit: sharp.fit.inside\n    }).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(243, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=outside, portrait","suites":["Resize dimensions"],"updatePoint":{"line":186,"column":27,"index":6768},"line":186,"code":"  it('fit=outside, portrait', function (done) {\n    sharp(fixtures.inputTiff).resize(320, 320, {\n      fit: sharp.fit.outside\n    }).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(422, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=inside, landscape","suites":["Resize dimensions"],"updatePoint":{"line":198,"column":27,"index":7183},"line":198,"code":"  it('fit=inside, landscape', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 320, {\n      fit: sharp.fit.inside\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=outside, landscape","suites":["Resize dimensions"],"updatePoint":{"line":210,"column":28,"index":7590},"line":210,"code":"  it('fit=outside, landscape', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 320, {\n      fit: sharp.fit.outside\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(392, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=inside, provide only one dimension","suites":["Resize dimensions"],"updatePoint":{"line":222,"column":44,"index":8014},"line":222,"code":"  it('fit=inside, provide only one dimension', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 320,\n      fit: sharp.fit.inside\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=outside, provide only one dimension","suites":["Resize dimensions"],"updatePoint":{"line":235,"column":45,"index":8446},"line":235,"code":"  it('fit=outside, provide only one dimension', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 320,\n      fit: sharp.fit.outside\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do not enlarge when input width is already less than output width","suites":["Resize dimensions"],"updatePoint":{"line":248,"column":71,"index":8905},"line":248,"code":"  it('Do not enlarge when input width is already less than output width', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 2800,\n      withoutEnlargement: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do not enlarge when input height is already less than output height","suites":["Resize dimensions"],"updatePoint":{"line":261,"column":73,"index":9371},"line":261,"code":"  it('Do not enlarge when input height is already less than output height', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      height: 2300,\n      withoutEnlargement: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do crop when fit = cover and withoutEnlargement = true and width >= outputWidth, and height < outputHeight","suites":["Resize dimensions"],"updatePoint":{"line":274,"column":112,"index":9877},"line":274,"code":"  it('Do crop when fit = cover and withoutEnlargement = true and width >= outputWidth, and height < outputHeight', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 3000,\n      height: 1000,\n      withoutEnlargement: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(1000, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do crop when fit = cover and withoutEnlargement = true and width < outputWidth, and height >= outputHeight","suites":["Resize dimensions"],"updatePoint":{"line":288,"column":112,"index":10402},"line":288,"code":"  it('Do crop when fit = cover and withoutEnlargement = true and width < outputWidth, and height >= outputHeight', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 1500,\n      height: 2226,\n      withoutEnlargement: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(1500, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do enlarge when input width is less than output width","suites":["Resize dimensions"],"updatePoint":{"line":302,"column":59,"index":10874},"line":302,"code":"  it('Do enlarge when input width is less than output width', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 2800,\n      withoutEnlargement: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2800, info.width);\n      assert.strictEqual(2286, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do enlarge when input width is less than output width","suites":["Resize dimensions"],"updatePoint":{"line":315,"column":59,"index":11327},"line":315,"code":"  it('Do enlarge when input width is less than output width', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 2800,\n      withoutReduction: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2800, info.width);\n      assert.strictEqual(2286, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do enlarge when input height is less than output height","suites":["Resize dimensions"],"updatePoint":{"line":328,"column":61,"index":11779},"line":328,"code":"  it('Do enlarge when input height is less than output height', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      height: 2300,\n      withoutReduction: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2817, info.width);\n      assert.strictEqual(2300, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do enlarge when input width is less than output width","suites":["Resize dimensions"],"updatePoint":{"line":341,"column":59,"index":12230},"line":341,"code":"  it('Do enlarge when input width is less than output width', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 2800,\n      withoutReduction: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2800, info.width);\n      assert.strictEqual(2286, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do not resize when both withoutEnlargement and withoutReduction are true","suites":["Resize dimensions"],"updatePoint":{"line":354,"column":78,"index":12700},"line":354,"code":"  it('Do not resize when both withoutEnlargement and withoutReduction are true', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 320, {\n      fit: 'fill',\n      withoutEnlargement: true,\n      withoutReduction: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do not reduce size when fit = outside and withoutReduction are true and height > outputHeight and width > outputWidth","suites":["Resize dimensions"],"updatePoint":{"line":368,"column":123,"index":13256},"line":368,"code":"  it('Do not reduce size when fit = outside and withoutReduction are true and height > outputHeight and width > outputWidth', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 320, {\n      fit: 'outside',\n      withoutReduction: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Do resize when fit = outside and withoutReduction are true and input height > height and input width > width ","suites":["Resize dimensions"],"updatePoint":{"line":381,"column":115,"index":13775},"line":381,"code":"  it('Do resize when fit = outside and withoutReduction are true and input height > height and input width > width ', function (done) {\n    sharp(fixtures.inputJpg).resize(3000, 3000, {\n      fit: 'outside',\n      withoutReduction: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3674, info.width);\n      assert.strictEqual(3000, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, downscale width and height","suites":["Resize dimensions"],"updatePoint":{"line":394,"column":42,"index":14223},"line":394,"code":"  it('fit=fill, downscale width and height', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 320, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, downscale width","suites":["Resize dimensions"],"updatePoint":{"line":406,"column":31,"index":14623},"line":406,"code":"  it('fit=fill, downscale width', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      width: 320,\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, downscale height","suites":["Resize dimensions"],"updatePoint":{"line":419,"column":32,"index":15033},"line":419,"code":"  it('fit=fill, downscale height', function (done) {\n    sharp(fixtures.inputJpg).resize({\n      height: 320,\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, upscale width and height","suites":["Resize dimensions"],"updatePoint":{"line":432,"column":40,"index":15452},"line":432,"code":"  it('fit=fill, upscale width and height', function (done) {\n    sharp(fixtures.inputJpg).resize(3000, 3000, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3000, info.width);\n      assert.strictEqual(3000, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, upscale width","suites":["Resize dimensions"],"updatePoint":{"line":444,"column":29,"index":15854},"line":444,"code":"  it('fit=fill, upscale width', function (done) {\n    sharp(fixtures.inputJpg).resize(3000, null, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3000, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, upscale height","suites":["Resize dimensions"],"updatePoint":{"line":456,"column":30,"index":16257},"line":456,"code":"  it('fit=fill, upscale height', function (done) {\n    sharp(fixtures.inputJpg).resize(null, 3000, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(3000, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, downscale width, upscale height","suites":["Resize dimensions"],"updatePoint":{"line":468,"column":47,"index":16677},"line":468,"code":"  it('fit=fill, downscale width, upscale height', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 3000, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(3000, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, upscale width, downscale height","suites":["Resize dimensions"],"updatePoint":{"line":480,"column":47,"index":17095},"line":480,"code":"  it('fit=fill, upscale width, downscale height', function (done) {\n    sharp(fixtures.inputJpg).resize(3000, 320, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(3000, info.width);\n      assert.strictEqual(320, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fit=fill, identity transform","suites":["Resize dimensions"],"updatePoint":{"line":492,"column":34,"index":17500},"line":492,"code":"  it('fit=fill, identity transform', function (done) {\n    sharp(fixtures.inputJpg).resize(null, null, {\n      fit: 'fill'\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(2725, info.width);\n      assert.strictEqual(2225, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Dimensions that result in differing even shrinks on each axis","suites":["Resize dimensions"],"updatePoint":{"line":504,"column":67,"index":17940},"line":504,"code":"  it('Dimensions that result in differing even shrinks on each axis', function (done) {\n    sharp(fixtures.inputJpg).resize(645, 399).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(645, info.width);\n      assert.strictEqual(399, info.height);\n      sharp(data).resize(150, 100).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(150, info.width);\n        assert.strictEqual(100, info.height);\n        fixtures.assertSimilar(fixtures.expected('resize-diff-shrink-even.jpg'), data, done);\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Dimensions that result in differing odd shrinks on each axis","suites":["Resize dimensions"],"updatePoint":{"line":517,"column":66,"index":18534},"line":517,"code":"  it('Dimensions that result in differing odd shrinks on each axis', function (done) {\n    return sharp(fixtures.inputJpg).resize(600, 399).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(600, info.width);\n      assert.strictEqual(399, info.height);\n      sharp(data).resize(200).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(200, info.width);\n        assert.strictEqual(133, info.height);\n        fixtures.assertSimilar(fixtures.expected('resize-diff-shrink-odd.jpg'), data, done);\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"fastShrinkOnLoad:  does not causes image shifts","suites":["Resize dimensions"],"updatePoint":{"line":531,"column":63,"index":19169},"line":531,"code":"    it(`fastShrinkOnLoad: ${value} does not causes image shifts`, function (done) {\n      sharp(fixtures.inputJpgCenteredImage).resize(9, 8, {\n        fastShrinkOnLoad: value\n      }).png().toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual(9, info.width);\n        assert.strictEqual(8, info.height);\n        fixtures.assertSimilar(fixtures.expected('fast-shrink-on-load.png'), data, done);\n      });\n    });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"kernel ","suites":["Resize dimensions"],"updatePoint":{"line":543,"column":24,"index":19729},"line":543,"code":"    it(`kernel ${kernel}`, function (done) {\n      sharp(fixtures.inputJpg).resize(320, null, {\n        kernel: kernel\n      }).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        fixtures.assertSimilar(fixtures.inputJpg, data, done);\n      });\n    });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"nearest upsampling with integral factor","suites":["Resize dimensions"],"updatePoint":{"line":554,"column":45,"index":20125},"line":554,"code":"  it('nearest upsampling with integral factor', function (done) {\n    sharp(fixtures.inputTiff8BitDepth).resize(210, 210, {\n      kernel: 'nearest'\n    }).png().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(210, info.width);\n      assert.strictEqual(210, info.height);\n      done();\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Ensure shortest edge (height) is at least 1 pixel","suites":["Resize dimensions"],"updatePoint":{"line":564,"column":55,"index":20475},"line":564,"code":"  it('Ensure shortest edge (height) is at least 1 pixel', function () {\n    return sharp({\n      create: {\n        width: 10,\n        height: 2,\n        channels: 3,\n        background: 'red'\n      }\n    }).resize(2).toBuffer({\n      resolveWithObject: true\n    }).then(function (output) {\n      assert.strictEqual(2, output.info.width);\n      assert.strictEqual(1, output.info.height);\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Ensure shortest edge (width) is at least 1 pixel","suites":["Resize dimensions"],"updatePoint":{"line":579,"column":54,"index":20875},"line":579,"code":"  it('Ensure shortest edge (width) is at least 1 pixel', function () {\n    return sharp({\n      create: {\n        width: 2,\n        height: 10,\n        channels: 3,\n        background: 'red'\n      }\n    }).resize(null, 2).toBuffer({\n      resolveWithObject: true\n    }).then(function (output) {\n      assert.strictEqual(1, output.info.width);\n      assert.strictEqual(2, output.info.height);\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Ensure embedded shortest edge (height) is at least 1 pixel","suites":["Resize dimensions"],"updatePoint":{"line":594,"column":64,"index":21291},"line":594,"code":"  it('Ensure embedded shortest edge (height) is at least 1 pixel', function () {\n    return sharp({\n      create: {\n        width: 200,\n        height: 1,\n        channels: 3,\n        background: 'red'\n      }\n    }).resize({\n      width: 50,\n      height: 50,\n      fit: sharp.fit.contain\n    }).toBuffer({\n      resolveWithObject: true\n    }).then(function (output) {\n      assert.strictEqual(50, output.info.width);\n      assert.strictEqual(50, output.info.height);\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Ensure embedded shortest edge (width) is at least 1 pixel","suites":["Resize dimensions"],"updatePoint":{"line":613,"column":63,"index":21773},"line":613,"code":"  it('Ensure embedded shortest edge (width) is at least 1 pixel', function () {\n    return sharp({\n      create: {\n        width: 1,\n        height: 200,\n        channels: 3,\n        background: 'red'\n      }\n    }).resize({\n      width: 50,\n      height: 50,\n      fit: sharp.fit.contain\n    }).toBuffer({\n      resolveWithObject: true\n    }).then(function (output) {\n      assert.strictEqual(50, output.info.width);\n      assert.strictEqual(50, output.info.height);\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Skip shrink-on-load where one dimension <4px","suites":["Resize dimensions"],"updatePoint":{"line":632,"column":50,"index":22242},"line":632,"code":"  it('Skip shrink-on-load where one dimension <4px', async () => {\n    const jpeg = await sharp({\n      create: {\n        width: 100,\n        height: 3,\n        channels: 3,\n        background: 'red'\n      }\n    }).jpeg().toBuffer();\n    const {\n      info\n    } = await sharp(jpeg).resize(8).toBuffer({\n      resolveWithObject: true\n    });\n    assert.strictEqual(info.width, 8);\n    assert.strictEqual(info.height, 1);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Skip JPEG shrink-on-load for known libjpeg rounding errors","suites":["Resize dimensions"],"updatePoint":{"line":649,"column":64,"index":22683},"line":649,"code":"  it('Skip JPEG shrink-on-load for known libjpeg rounding errors', async () => {\n    const input = await sharp({\n      create: {\n        width: 1000,\n        height: 667,\n        channels: 3,\n        background: 'red'\n      }\n    }).jpeg().toBuffer();\n    const output = await sharp(input).resize({\n      width: 500\n    }).toBuffer();\n    const {\n      width,\n      height\n    } = await sharp(output).metadata();\n    assert.strictEqual(width, 500);\n    assert.strictEqual(height, 334);\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"unknown kernel throws","suites":["Resize dimensions"],"updatePoint":{"line":668,"column":27,"index":23138},"line":668,"code":"  it('unknown kernel throws', function () {\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        kernel: 'unknown'\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"unknown fit throws","suites":["Resize dimensions"],"updatePoint":{"line":675,"column":24,"index":23296},"line":675,"code":"  it('unknown fit throws', function () {\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        fit: 'unknown'\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"unknown position throws","suites":["Resize dimensions"],"updatePoint":{"line":682,"column":29,"index":23456},"line":682,"code":"  it('unknown position throws', function () {\n    assert.throws(function () {\n      sharp().resize(null, null, {\n        position: 'unknown'\n      });\n    });\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Multiple resize emits warning","suites":["Resize dimensions"],"updatePoint":{"line":689,"column":35,"index":23627},"line":689,"code":"  it('Multiple resize emits warning', () => {\n    let warningMessage = '';\n    const s = sharp();\n    s.on('warning', function (msg) {\n      warningMessage = msg;\n    });\n    s.resize(1);\n    assert.strictEqual(warningMessage, '');\n    s.resize(2);\n    assert.strictEqual(warningMessage, 'ignoring previous resize options');\n  });","file":"unit/resize.js","skipped":false,"dir":"test"},{"name":"Auto-rotate  image with EXIF Orientation ","suites":["Rotation"],"updatePoint":{"line":14,"column":75,"index":596},"line":14,"code":"      it(`Auto-rotate ${orientation} image with EXIF Orientation ${exifTag}`, function (done) {\n        const [expectedWidth, expectedHeight] = orientation === 'Landscape' ? [600, 450] : [450, 600];\n        sharp(input).rotate().toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(info.width, expectedWidth);\n          assert.strictEqual(info.height, expectedHeight);\n          fixtures.assertSimilar(expectedOutput, data, done);\n        });\n      });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Auto-rotate then resize  image with EXIF Orientation ","suites":["Rotation"],"updatePoint":{"line":23,"column":87,"index":1105},"line":23,"code":"      it(`Auto-rotate then resize ${orientation} image with EXIF Orientation ${exifTag}`, function (done) {\n        const [expectedWidth, expectedHeight] = orientation === 'Landscape' ? [320, 240] : [320, 427];\n        sharp(input).rotate().resize({\n          width: 320\n        }).toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(info.width, expectedWidth);\n          assert.strictEqual(info.height, expectedHeight);\n          fixtures.assertSimilar(expectedOutput, data, done);\n        });\n      });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Resize then auto-rotate  image with EXIF Orientation ","suites":["Rotation"],"updatePoint":{"line":34,"column":87,"index":1655},"line":34,"code":"      it(`Resize then auto-rotate ${orientation} image with EXIF Orientation ${exifTag}`, function (done) {\n        const [expectedWidth, expectedHeight] = orientation === 'Landscape' ? exifTag < 5 ? [320, 240] : [320, 240] : [320, 427];\n        sharp(input).resize({\n          width: 320\n        }).rotate().toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual(info.width, expectedWidth);\n          assert.strictEqual(info.height, expectedHeight);\n          fixtures.assertSimilar(expectedOutput, data, done);\n        });\n      });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 30 degrees with semi-transparent background","suites":["Rotation"],"updatePoint":{"line":47,"column":59,"index":2218},"line":47,"code":"  it('Rotate by 30 degrees with semi-transparent background', function (done) {\n    sharp(fixtures.inputJpg).resize(320).rotate(30, {\n      background: {\n        r: 255,\n        g: 0,\n        b: 0,\n        alpha: 0.5\n      }\n    }).png().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(408, info.width);\n      assert.strictEqual(386, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-transparent-bg.png'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 30 degrees with solid background","suites":["Rotation"],"updatePoint":{"line":63,"column":48,"index":2746},"line":63,"code":"  it('Rotate by 30 degrees with solid background', function (done) {\n    sharp(fixtures.inputJpg).resize(320).rotate(30, {\n      background: {\n        r: 255,\n        g: 0,\n        b: 0\n      }\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(408, info.width);\n      assert.strictEqual(386, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-solid-bg.jpg'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 90 degrees, respecting output input size","suites":["Rotation"],"updatePoint":{"line":78,"column":56,"index":3251},"line":78,"code":"  it('Rotate by 90 degrees, respecting output input size', function (done) {\n    sharp(fixtures.inputJpg).rotate(90).resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Resize then rotate by 30 degrees, respecting output input size","suites":["Rotation"],"updatePoint":{"line":88,"column":68,"index":3672},"line":88,"code":"  it('Resize then rotate by 30 degrees, respecting output input size', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).rotate(30).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(397, info.width);\n      assert.strictEqual(368, info.height);\n      done();\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 270 degrees, square output ignoring aspect ratio","suites":["Rotation"],"updatePoint":{"line":128,"column":64,"index":5263},"line":128,"code":"  it('Rotate by 270 degrees, square output ignoring aspect ratio', function (done) {\n    sharp(fixtures.inputJpg).resize(240, 240, {\n      fit: sharp.fit.fill\n    }).rotate(270).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(240, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(240, metadata.width);\n        assert.strictEqual(240, metadata.height);\n        done();\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 315 degrees, square output ignoring aspect ratio","suites":["Rotation"],"updatePoint":{"line":143,"column":64,"index":5813},"line":143,"code":"  it('Rotate by 315 degrees, square output ignoring aspect ratio', function (done) {\n    sharp(fixtures.inputJpg).resize(240, 240, {\n      fit: sharp.fit.fill\n    }).rotate(315).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(339, info.width);\n      assert.strictEqual(339, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(339, metadata.width);\n        assert.strictEqual(339, metadata.height);\n        done();\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 270 degrees, rectangular output ignoring aspect ratio","suites":["Rotation"],"updatePoint":{"line":158,"column":69,"index":6368},"line":158,"code":"  it('Rotate by 270 degrees, rectangular output ignoring aspect ratio', function (done) {\n    sharp(fixtures.inputJpg).rotate(270).resize(320, 240, {\n      fit: sharp.fit.fill\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(320, metadata.width);\n        assert.strictEqual(240, metadata.height);\n        done();\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate by 30 degrees, rectangular output ignoring aspect ratio","suites":["Rotation"],"updatePoint":{"line":173,"column":68,"index":6922},"line":173,"code":"  it('Rotate by 30 degrees, rectangular output ignoring aspect ratio', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fit: sharp.fit.fill\n    }).rotate(30).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(397, info.width);\n      assert.strictEqual(368, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(397, metadata.width);\n        assert.strictEqual(368, metadata.height);\n        done();\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Input image has Orientation EXIF tag but do not rotate output","suites":["Rotation"],"updatePoint":{"line":188,"column":67,"index":7474},"line":188,"code":"  it('Input image has Orientation EXIF tag but do not rotate output', function (done) {\n    sharp(fixtures.inputJpgWithExif).resize(320).withMetadata().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(427, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(8, metadata.orientation);\n        done();\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Input image has Orientation EXIF tag value of 8 (270 degrees), auto-rotate","suites":["Rotation"],"updatePoint":{"line":202,"column":80,"index":8061},"line":202,"code":"  it('Input image has Orientation EXIF tag value of 8 (270 degrees), auto-rotate', function (done) {\n    sharp(fixtures.inputJpgWithExif).rotate().resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('exif-8.jpg'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Override EXIF Orientation tag metadata after auto-rotate","suites":["Rotation"],"updatePoint":{"line":211,"column":62,"index":8489},"line":211,"code":"  it('Override EXIF Orientation tag metadata after auto-rotate', function (done) {\n    sharp(fixtures.inputJpgWithExif).rotate().resize(320).withMetadata({\n      orientation: 3\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(3, metadata.orientation);\n        fixtures.assertSimilar(fixtures.expected('exif-8.jpg'), data, done);\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Input image has Orientation EXIF tag value of 5 (270 degrees + flip), auto-rotate","suites":["Rotation"],"updatePoint":{"line":226,"column":87,"index":9132},"line":226,"code":"  it('Input image has Orientation EXIF tag value of 5 (270 degrees + flip), auto-rotate', function (done) {\n    sharp(fixtures.inputJpgWithExifMirroring).rotate().resize(320).withMetadata().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(1, metadata.orientation);\n        fixtures.assertSimilar(fixtures.expected('exif-5.jpg'), data, done);\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Attempt to auto-rotate using image that has no EXIF","suites":["Rotation"],"updatePoint":{"line":239,"column":57,"index":9726},"line":239,"code":"  it('Attempt to auto-rotate using image that has no EXIF', function (done) {\n    sharp(fixtures.inputJpg).rotate().resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      done();\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Attempt to auto-rotate image format without EXIF support","suites":["Rotation"],"updatePoint":{"line":249,"column":62,"index":10134},"line":249,"code":"  it('Attempt to auto-rotate image format without EXIF support', function (done) {\n    sharp(fixtures.inputPng).rotate().resize(320).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(236, info.height);\n      done();\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Rotate with a string argument, should fail","suites":["Rotation"],"updatePoint":{"line":259,"column":48,"index":10535},"line":259,"code":"  it('Rotate with a string argument, should fail', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).rotate('not-a-number');\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Animated image rotate-then-extract rejects","suites":["Rotation"],"updatePoint":{"line":264,"column":48,"index":10701},"line":264,"code":"  it('Animated image rotate-then-extract rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n    animated: true\n  }).rotate(1).extract({\n    top: 1,\n    left: 1,\n    width: 10,\n    height: 10\n  }).toBuffer(), /Rotate is not supported for multi-page images/));","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Animated image extract-then-rotate rejects","suites":["Rotation"],"updatePoint":{"line":272,"column":48,"index":10981},"line":272,"code":"  it('Animated image extract-then-rotate rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n    animated: true\n  }).extract({\n    top: 1,\n    left: 1,\n    width: 10,\n    height: 10\n  }).rotate(1).toBuffer(), /Rotate is not supported for multi-page images/));","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Multiple rotate emits warning","suites":["Rotation"],"updatePoint":{"line":280,"column":35,"index":11248},"line":280,"code":"  it('Multiple rotate emits warning', () => {\n    let warningMessage = '';\n    const s = sharp();\n    s.on('warning', function (msg) {\n      warningMessage = msg;\n    });\n    s.rotate();\n    assert.strictEqual(warningMessage, '');\n    s.rotate();\n    assert.strictEqual(warningMessage, 'ignoring previous rotate options');\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Flip - vertical","suites":["Rotation"],"updatePoint":{"line":291,"column":21,"index":11563},"line":291,"code":"  it('Flip - vertical', function (done) {\n    sharp(fixtures.inputJpg).resize(320).flip().withMetadata().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(1, metadata.orientation);\n        fixtures.assertSimilar(fixtures.expected('flip.jpg'), data, done);\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Flop - horizontal","suites":["Rotation"],"updatePoint":{"line":304,"column":23,"index":12102},"line":304,"code":"  it('Flop - horizontal', function (done) {\n    sharp(fixtures.inputJpg).resize(320).flop().withMetadata().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      sharp(data).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(1, metadata.orientation);\n        fixtures.assertSimilar(fixtures.expected('flop.jpg'), data, done);\n      });\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Flip and flop","suites":["Rotation"],"updatePoint":{"line":317,"column":19,"index":12637},"line":317,"code":"  it('Flip and flop', function (done) {\n    sharp(fixtures.inputJpg).resize(320).flop().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      fixtures.assertSimilar(fixtures.expected('flip-and-flop.jpg'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Neither flip nor flop","suites":["Rotation"],"updatePoint":{"line":326,"column":27,"index":13027},"line":326,"code":"  it('Neither flip nor flop', function (done) {\n    sharp(fixtures.inputJpg).resize(320).flip(false).flop(false).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(261, info.height);\n      fixtures.assertSimilar(fixtures.inputJpg, data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Auto-rotate and flip","suites":["Rotation"],"updatePoint":{"line":335,"column":26,"index":13412},"line":335,"code":"  it('Auto-rotate and flip', function (done) {\n    sharp(fixtures.inputJpgWithExif).rotate().flip().resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-and-flip.jpg'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Auto-rotate and flop","suites":["Rotation"],"updatePoint":{"line":344,"column":26,"index":13820},"line":344,"code":"  it('Auto-rotate and flop', function (done) {\n    sharp(fixtures.inputJpgWithExif).rotate().flop().resize(320).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('rotate-and-flop.jpg'), data, done);\n    });\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Auto-rotate and shrink-on-load","suites":["Rotation"],"updatePoint":{"line":353,"column":36,"index":14238},"line":353,"code":"  it('Auto-rotate and shrink-on-load', async () => {\n    const [r, g, b] = await sharp(fixtures.inputJpgWithLandscapeExif3).rotate().resize(8).raw().toBuffer();\n    assert.strictEqual(r, 60);\n    assert.strictEqual(g, 73);\n    assert.strictEqual(b, 52);\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Flip and rotate ordering","suites":["Rotation"],"updatePoint":{"line":359,"column":30,"index":14492},"line":359,"code":"  it('Flip and rotate ordering', async () => {\n    const [r, g, b] = await sharp(fixtures.inputJpgWithPortraitExif5).flip().rotate(90).raw().toBuffer();\n    assert.strictEqual(r, 55);\n    assert.strictEqual(g, 65);\n    assert.strictEqual(b, 31);\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Flip, rotate and resize ordering","suites":["Rotation"],"updatePoint":{"line":365,"column":38,"index":14752},"line":365,"code":"  it('Flip, rotate and resize ordering', async () => {\n    const [r, g, b] = await sharp(fixtures.inputJpgWithPortraitExif5).flip().rotate(90).resize(449).raw().toBuffer();\n    assert.strictEqual(r, 54);\n    assert.strictEqual(g, 64);\n    assert.strictEqual(b, 30);\n  });","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"Resize after affine-based rotation does not overcompute","suites":["Rotation"],"updatePoint":{"line":371,"column":61,"index":15047},"line":371,"code":"  it('Resize after affine-based rotation does not overcompute', async () => sharp({\n    create: {\n      width: 4640,\n      height: 2610,\n      channels: 3,\n      background: 'black'\n    }\n  }).rotate(28).resize({\n    width: 640,\n    height: 360\n  }).raw().timeout({\n    seconds: 5\n  }).toBuffer());","file":"unit/rotate.js","skipped":false,"dir":"test"},{"name":"specific radius 10 (sigma 6)","suites":["Sharpen"],"updatePoint":{"line":10,"column":34,"index":276},"line":10,"code":"  it('specific radius 10 (sigma 6)', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen(6).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('sharpen-10.jpg'), data, done);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"specific radius 3 (sigma 1.5) and levels 0.5, 2.5","suites":["Sharpen"],"updatePoint":{"line":19,"column":55,"index":700},"line":19,"code":"  it('specific radius 3 (sigma 1.5) and levels 0.5, 2.5', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen(1.5, 0.5, 2.5).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('sharpen-3-0.5-2.5.jpg'), data, done);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"specific radius 5 (sigma 3.5) and levels 2, 4","suites":["Sharpen"],"updatePoint":{"line":28,"column":51,"index":1139},"line":28,"code":"  it('specific radius 5 (sigma 3.5) and levels 2, 4', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen(3.5, 2, 4).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('sharpen-5-2-4.jpg'), data, done);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"sigma=3.5, m1=2, m2=4","suites":["Sharpen"],"updatePoint":{"line":37,"column":27,"index":1546},"line":37,"code":"  it('sigma=3.5, m1=2, m2=4', done => {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen({\n      sigma: 3.5,\n      m1: 2,\n      m2: 4\n    }).toBuffer().then(data => fixtures.assertSimilar(fixtures.expected('sharpen-5-2-4.jpg'), data, done));\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"sigma=3.5, m1=2, m2=4, x1=2, y2=5, y3=25","suites":["Sharpen"],"updatePoint":{"line":44,"column":46,"index":1818},"line":44,"code":"  it('sigma=3.5, m1=2, m2=4, x1=2, y2=5, y3=25', done => {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen({\n      sigma: 3.5,\n      m1: 2,\n      m2: 4,\n      x1: 2,\n      y2: 5,\n      y3: 25\n    }).toBuffer().then(data => fixtures.assertSimilar(fixtures.expected('sharpen-5-2-4.jpg'), data, done));\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"specific radius/levels with alpha channel","suites":["Sharpen"],"updatePoint":{"line":55,"column":49,"index":2180},"line":55,"code":"    it('specific radius/levels with alpha channel', function (done) {\n      sharp(fixtures.inputPngWithTransparency).resize(320, 240).sharpen(5, 4, 8).toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(4, info.channels);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        fixtures.assertSimilar(fixtures.expected('sharpen-rgba.png'), data, done);\n      });\n    });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"mild sharpen","suites":["Sharpen"],"updatePoint":{"line":66,"column":18,"index":2656},"line":66,"code":"  it('mild sharpen', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('sharpen-mild.jpg'), data, done);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid sigma","suites":["Sharpen"],"updatePoint":{"line":75,"column":19,"index":3045},"line":75,"code":"  it('invalid sigma', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).sharpen(-1.5);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid flat","suites":["Sharpen"],"updatePoint":{"line":80,"column":18,"index":3172},"line":80,"code":"  it('invalid flat', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).sharpen(1, -1);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid jagged","suites":["Sharpen"],"updatePoint":{"line":85,"column":20,"index":3302},"line":85,"code":"  it('invalid jagged', function () {\n    assert.throws(function () {\n      sharp(fixtures.inputJpg).sharpen(1, 1, -1);\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.sigma","suites":["Sharpen"],"updatePoint":{"line":90,"column":27,"index":3442},"line":90,"code":"  it('invalid options.sigma', () => assert.throws(() => sharp().sharpen({\n    sigma: -1\n  }), /Expected number between 0\\.000001 and 10 for options\\.sigma but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.m1","suites":["Sharpen"],"updatePoint":{"line":93,"column":24,"index":3629},"line":93,"code":"  it('invalid options.m1', () => assert.throws(() => sharp().sharpen({\n    sigma: 1,\n    m1: -1\n  }), /Expected number between 0 and 1000000 for options\\.m1 but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.m2","suites":["Sharpen"],"updatePoint":{"line":97,"column":24,"index":3821},"line":97,"code":"  it('invalid options.m2', () => assert.throws(() => sharp().sharpen({\n    sigma: 1,\n    m2: -1\n  }), /Expected number between 0 and 1000000 for options\\.m2 but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.x1","suites":["Sharpen"],"updatePoint":{"line":101,"column":24,"index":4013},"line":101,"code":"  it('invalid options.x1', () => assert.throws(() => sharp().sharpen({\n    sigma: 1,\n    x1: -1\n  }), /Expected number between 0 and 1000000 for options\\.x1 but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.y2","suites":["Sharpen"],"updatePoint":{"line":105,"column":24,"index":4205},"line":105,"code":"  it('invalid options.y2', () => assert.throws(() => sharp().sharpen({\n    sigma: 1,\n    y2: -1\n  }), /Expected number between 0 and 1000000 for options\\.y2 but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"invalid options.y3","suites":["Sharpen"],"updatePoint":{"line":109,"column":24,"index":4397},"line":109,"code":"  it('invalid options.y3', () => assert.throws(() => sharp().sharpen({\n    sigma: 1,\n    y3: -1\n  }), /Expected number between 0 and 1000000 for options\\.y3 but received -1 of type number/));","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"sharpened image is larger than non-sharpened","suites":["Sharpen"],"updatePoint":{"line":113,"column":50,"index":4615},"line":113,"code":"  it('sharpened image is larger than non-sharpened', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).sharpen(false).toBuffer(function (err, notSharpened, info) {\n      if (err) throw err;\n      assert.strictEqual(true, notSharpened.length > 0);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      sharp(fixtures.inputJpg).resize(320, 240).sharpen(true).toBuffer(function (err, sharpened, info) {\n        if (err) throw err;\n        assert.strictEqual(true, sharpened.length > 0);\n        assert.strictEqual(true, sharpened.length > notSharpened.length);\n        assert.strictEqual('jpeg', info.format);\n        assert.strictEqual(320, info.width);\n        assert.strictEqual(240, info.height);\n        done();\n      });\n    });\n  });","file":"unit/sharpen.js","skipped":false,"dir":"test"},{"name":"JPEG","suites":["Image Stats"],"updatePoint":{"line":23,"column":10,"index":604},"line":23,"code":"  it('JPEG', function (done) {\n    sharp(fixtures.inputJpg).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 7.319914765248541));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 0.7883011147075762));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(40, r);\n      assert.strictEqual(40, g);\n      assert.strictEqual(40, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 615101275));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 83061892917));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 101.44954540768993));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 58.373870588815414));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 462824115));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 47083677255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 76.33425255128337));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 44.03023262954866));\n      assert.strictEqual(true, isInteger(stats.channels[1].minX));\n      assert.strictEqual(true, isInRange(stats.channels[1].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].minY));\n      assert.strictEqual(true, isInRange(stats.channels[1].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxY, 0, 2725));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(255, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 372986756));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 32151543524));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 61.51724663436759));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 38.96702865090125));\n      assert.strictEqual(true, isInteger(stats.channels[2].minX));\n      assert.strictEqual(true, isInRange(stats.channels[2].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].minY));\n      assert.strictEqual(true, isInRange(stats.channels[2].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxY, 0, 2725));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"PNG without transparency","suites":["Image Stats"],"updatePoint":{"line":88,"column":30,"index":4397},"line":88,"code":"  it('PNG without transparency', function (done) {\n    sharp(fixtures.inputPng).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 0.3409031108021736));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 9.111356137722868));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(248, r);\n      assert.strictEqual(248, g);\n      assert.strictEqual(248, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 1391368230));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 354798898650));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 238.8259925648822));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 62.15121915523771));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2809));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2074));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2809));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2074));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"PNG with transparency","suites":["Image Stats"],"updatePoint":{"line":121,"column":27,"index":6035},"line":121,"code":"  it('PNG with transparency', function (done) {\n    sharp(fixtures.inputPngWithTransparency).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(false, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 0.06778064835816622));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 2.522916068931278));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(248, r);\n      assert.strictEqual(248, g);\n      assert.strictEqual(248, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 795678795));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 202898092725));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 252.9394769668579));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 22.829537532816));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 1536));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 1536));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 795678795));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 202898092725));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 252.9394769668579));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 22.829537532816));\n      assert.strictEqual(true, isInteger(stats.channels[1].minX));\n      assert.strictEqual(true, isInRange(stats.channels[1].minX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[1].minY));\n      assert.strictEqual(true, isInRange(stats.channels[1].minY, 0, 1536));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxY, 0, 1536));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(255, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 795678795));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 202898092725));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 252.9394769668579));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 22.829537532816));\n      assert.strictEqual(true, isInteger(stats.channels[2].minX));\n      assert.strictEqual(true, isInRange(stats.channels[2].minX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[2].minY));\n      assert.strictEqual(true, isInRange(stats.channels[2].minY, 0, 1536));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxY, 0, 1536));\n\n      // alpha channel\n      assert.strictEqual(0, stats.channels[3].min);\n      assert.strictEqual(255, stats.channels[3].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].sum, 5549142));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].squaresSum, 1333571132));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].mean, 1.7640247344970703));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].stdev, 20.51387814157297));\n      assert.strictEqual(true, isInteger(stats.channels[3].minX));\n      assert.strictEqual(true, isInRange(stats.channels[3].minX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[3].minY));\n      assert.strictEqual(true, isInRange(stats.channels[3].minY, 0, 1536));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxX, 0, 2048));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxY, 0, 1536));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"PNG fully transparent","suites":["Image Stats"],"updatePoint":{"line":202,"column":27,"index":10917},"line":202,"code":"  it('PNG fully transparent', function (done) {\n    sharp(fixtures.inputPngCompleteTransparency).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(false, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 0));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 0));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(72, r);\n      assert.strictEqual(104, g);\n      assert.strictEqual(72, b);\n\n      // alpha channel\n      assert.strictEqual(0, stats.channels[3].min);\n      assert.strictEqual(0, stats.channels[3].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].sum, 0));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].squaresSum, 0));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].mean, 0));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].stdev, 0));\n      assert.strictEqual(true, isInteger(stats.channels[3].minX));\n      assert.strictEqual(true, isInRange(stats.channels[3].minX, 0, 300));\n      assert.strictEqual(true, isInteger(stats.channels[3].minY));\n      assert.strictEqual(true, isInRange(stats.channels[3].minY, 0, 300));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxX, 0, 300));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxY, 0, 300));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Tiff","suites":["Image Stats"],"updatePoint":{"line":235,"column":10,"index":12468},"line":235,"code":"  it('Tiff', function (done) {\n    sharp(fixtures.inputTiff).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 0.3851250782608986));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 10.312521863719589));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(248, r);\n      assert.strictEqual(248, g);\n      assert.strictEqual(248, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 1887266220));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 481252886100));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 235.81772349417824));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 67.25712856093298));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2464));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 3248));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2464));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 3248));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"WebP","suites":["Image Stats"],"updatePoint":{"line":268,"column":10,"index":14092},"line":268,"code":"  it('WebP', function (done) {\n    sharp(fixtures.inputWebP).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 7.51758075132966));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 9.959951636662941));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(40, r);\n      assert.strictEqual(136, g);\n      assert.strictEqual(200, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(true, isInRange(stats.channels[0].max, 254, 255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 83291370));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 11379783198));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 105.36169496842616));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 57.39412151419967));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 772));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 772));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(true, isInRange(stats.channels[1].max, 254, 255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 120877425));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 20774687595));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 152.9072025279307));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 53.84143349689916));\n      assert.strictEqual(true, isInteger(stats.channels[1].minX));\n      assert.strictEqual(true, isInRange(stats.channels[1].minX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[1].minY));\n      assert.strictEqual(true, isInRange(stats.channels[1].minY, 0, 772));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxY, 0, 772));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(true, isInRange(stats.channels[2].max, 254, 255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 138938859));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 28449125593));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 175.75450711423252));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 71.39929031070358));\n      assert.strictEqual(true, isInteger(stats.channels[2].minX));\n      assert.strictEqual(true, isInRange(stats.channels[2].minX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[2].minY));\n      assert.strictEqual(true, isInRange(stats.channels[2].minY, 0, 772));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxX, 0, 1024));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxY, 0, 772));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"GIF","suites":["Image Stats"],"updatePoint":{"line":333,"column":9,"index":17924},"line":333,"code":"  it('GIF', function (done) {\n    sharp(fixtures.inputGif).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 6.087309412541799));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 2.9250574456255682));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(120, r);\n      assert.strictEqual(136, g);\n      assert.strictEqual(88, b);\n\n      // red channel\n      assert.strictEqual(35, stats.channels[0].min);\n      assert.strictEqual(254, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 56088385));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 8002132113));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 131.53936444652908));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 38.26389131415863));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 533));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 533));\n\n      // green channel\n      assert.strictEqual(43, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 58612156));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 8548344254));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 137.45815196998123));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 33.955424103758205));\n      assert.strictEqual(true, isInteger(stats.channels[1].minX));\n      assert.strictEqual(true, isInRange(stats.channels[1].minX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[1].minY));\n      assert.strictEqual(true, isInRange(stats.channels[1].minY, 0, 533));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxY, 0, 533));\n\n      // blue channel\n      assert.strictEqual(51, stats.channels[2].min);\n      assert.strictEqual(254, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 49628525));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 6450556071));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 116.38959896810506));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 39.7669551046809));\n      assert.strictEqual(true, isInteger(stats.channels[2].minX));\n      assert.strictEqual(true, isInRange(stats.channels[2].minX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[2].minY));\n      assert.strictEqual(true, isInRange(stats.channels[2].minY, 0, 533));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxX, 0, 800));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxY, 0, 533));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Grayscale GIF with alpha","suites":["Image Stats"],"updatePoint":{"line":398,"column":30,"index":21705},"line":398,"code":"  it('Grayscale GIF with alpha', function (done) {\n    sharp(fixtures.inputGifGreyPlusAlpha).stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(false, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 1));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 15.870619016486861));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(8, r);\n      assert.strictEqual(8, g);\n      assert.strictEqual(8, b);\n\n      // gray channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(101, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 101));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 10201));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 50.5));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 71.4177848998413));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 1));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 1));\n\n      // alpha channel\n      assert.strictEqual(0, stats.channels[3].min);\n      assert.strictEqual(255, stats.channels[3].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].sum, 255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].squaresSum, 65025));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].mean, 127.5));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[3].stdev, 180.31222920256963));\n      assert.strictEqual(true, isInteger(stats.channels[3].minX));\n      assert.strictEqual(true, isInRange(stats.channels[3].minX, 0, 2));\n      assert.strictEqual(true, isInteger(stats.channels[3].minY));\n      assert.strictEqual(true, isInRange(stats.channels[3].minY, 0, 1));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxX, 0, 2));\n      assert.strictEqual(true, isInteger(stats.channels[3].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[3].maxY, 0, 1));\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"CMYK input without profile","suites":["Image Stats"],"updatePoint":{"line":447,"column":32,"index":24344},"line":447,"code":"  it('CMYK input without profile', () => sharp(fixtures.inputJpgWithCmykNoProfile).stats().then(stats => {\n    assert.strictEqual(4, stats.channels.length);\n    assert.strictEqual(true, stats.isOpaque);\n  }));","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Dominant colour","suites":["Image Stats"],"updatePoint":{"line":451,"column":21,"index":24543},"line":451,"code":"  it('Dominant colour', () => sharp(fixtures.inputJpgBooleanTest).stats().then(({\n    dominant\n  }) => {\n    const {\n      r,\n      g,\n      b\n    } = dominant;\n    assert.strictEqual(r, 8);\n    assert.strictEqual(g, 136);\n    assert.strictEqual(b, 248);\n  }));","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Entropy and sharpness of 1x1 input are zero","suites":["Image Stats"],"updatePoint":{"line":463,"column":49,"index":24833},"line":463,"code":"  it('Entropy and sharpness of 1x1 input are zero', async () => {\n    const {\n      entropy,\n      sharpness\n    } = await sharp({\n      create: {\n        width: 1,\n        height: 1,\n        channels: 3,\n        background: 'red'\n      }\n    }).stats();\n    assert.strictEqual(entropy, 0);\n    assert.strictEqual(sharpness, 0);\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Stream in, Callback out","suites":["Image Stats"],"updatePoint":{"line":478,"column":29,"index":25148},"line":478,"code":"  it('Stream in, Callback out', function (done) {\n    const readable = fs.createReadStream(fixtures.inputJpg);\n    const pipeline = sharp().stats(function (err, stats) {\n      if (err) throw err;\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 7.319914765248541));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 0.788301114707569));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(40, r);\n      assert.strictEqual(40, g);\n      assert.strictEqual(40, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 615101275));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 83061892917));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 101.44954540768993));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 58.373870588815414));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 462824115));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 47083677255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 76.33425255128337));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 44.03023262954866));\n      assert.strictEqual(true, isInteger(stats.channels[1].minX));\n      assert.strictEqual(true, isInRange(stats.channels[1].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].minY));\n      assert.strictEqual(true, isInRange(stats.channels[1].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[1].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[1].maxY, 0, 2725));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(255, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 372986756));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 32151543524));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 61.51724663436759));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 38.96702865090125));\n      assert.strictEqual(true, isInteger(stats.channels[2].minX));\n      assert.strictEqual(true, isInRange(stats.channels[2].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].minY));\n      assert.strictEqual(true, isInRange(stats.channels[2].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[2].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[2].maxY, 0, 2725));\n      done();\n    });\n    readable.pipe(pipeline);\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Stream in, Promise out","suites":["Image Stats"],"updatePoint":{"line":545,"column":28,"index":29028},"line":545,"code":"  it('Stream in, Promise out', function () {\n    const pipeline = sharp();\n    fs.createReadStream(fixtures.inputJpg).pipe(pipeline);\n    return pipeline.stats().then(function (stats) {\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 7.319914765248541));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 0.788301114707569));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(40, r);\n      assert.strictEqual(40, g);\n      assert.strictEqual(40, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 615101275));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 83061892917));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 101.44954540768993));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 58.373870588815414));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 462824115));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 47083677255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 76.33425255128337));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 44.03023262954866));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(255, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 372986756));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 32151543524));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 61.51724663436759));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 38.96702865090125));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n    }).catch(function (err) {\n      throw err;\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"File in, Promise out","suites":["Image Stats"],"updatePoint":{"line":612,"column":26,"index":32901},"line":612,"code":"  it('File in, Promise out', function () {\n    return sharp(fixtures.inputJpg).stats().then(function (stats) {\n      assert.strictEqual(true, stats.isOpaque);\n      assert.strictEqual(true, isInAcceptableRange(stats.entropy, 7.319914765248541));\n      assert.strictEqual(true, isInAcceptableRange(stats.sharpness, 0.788301114707569));\n      const {\n        r,\n        g,\n        b\n      } = stats.dominant;\n      assert.strictEqual(40, r);\n      assert.strictEqual(40, g);\n      assert.strictEqual(40, b);\n\n      // red channel\n      assert.strictEqual(0, stats.channels[0].min);\n      assert.strictEqual(255, stats.channels[0].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].sum, 615101275));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].squaresSum, 83061892917));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].mean, 101.44954540768993));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[0].stdev, 58.373870588815414));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // green channel\n      assert.strictEqual(0, stats.channels[1].min);\n      assert.strictEqual(255, stats.channels[1].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].sum, 462824115));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].squaresSum, 47083677255));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].mean, 76.33425255128337));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[1].stdev, 44.03023262954866));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n\n      // blue channel\n      assert.strictEqual(0, stats.channels[2].min);\n      assert.strictEqual(255, stats.channels[2].max);\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].sum, 372986756));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].squaresSum, 32151543524));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].mean, 61.51724663436759));\n      assert.strictEqual(true, isInAcceptableRange(stats.channels[2].stdev, 38.96702865090125));\n      assert.strictEqual(true, isInteger(stats.channels[0].minX));\n      assert.strictEqual(true, isInRange(stats.channels[0].minX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].minY));\n      assert.strictEqual(true, isInRange(stats.channels[0].minY, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxX));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxX, 0, 2725));\n      assert.strictEqual(true, isInteger(stats.channels[0].maxY));\n      assert.strictEqual(true, isInRange(stats.channels[0].maxY, 0, 2725));\n    }).catch(function (err) {\n      throw err;\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Blurred image has lower sharpness than original","suites":["Image Stats"],"updatePoint":{"line":677,"column":53,"index":36728},"line":677,"code":"  it('Blurred image has lower sharpness than original', () => {\n    const original = sharp(fixtures.inputJpg).stats();\n    const blurred = sharp(fixtures.inputJpg).blur().toBuffer().then(blur => sharp(blur).stats());\n    return Promise.all([original, blurred]).then(([original, blurred]) => {\n      assert.strictEqual(true, isInAcceptableRange(original.sharpness, 0.7883011147075476));\n      assert.strictEqual(true, isInAcceptableRange(blurred.sharpness, 0.4791559805997398));\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"File input with corrupt header fails gracefully","suites":["Image Stats"],"updatePoint":{"line":685,"column":53,"index":37220},"line":685,"code":"  it('File input with corrupt header fails gracefully', function (done) {\n    sharp(fixtures.inputJpgWithCorruptHeader).stats(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"File input with corrupt header fails gracefully, Promise out","suites":["Image Stats"],"updatePoint":{"line":691,"column":66,"index":37443},"line":691,"code":"  it('File input with corrupt header fails gracefully, Promise out', function () {\n    return sharp(fixtures.inputJpgWithCorruptHeader).stats().then(function (stats) {\n      throw new Error('Corrupt Header file');\n    }).catch(function (err) {\n      assert.ok(!!err);\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"File input with corrupt header fails gracefully, Stream In, Promise Out","suites":["Image Stats"],"updatePoint":{"line":698,"column":77,"index":37736},"line":698,"code":"  it('File input with corrupt header fails gracefully, Stream In, Promise Out', function () {\n    const pipeline = sharp();\n    fs.createReadStream(fixtures.inputJpgWithCorruptHeader).pipe(pipeline);\n    return pipeline.stats().then(function (stats) {\n      throw new Error('Corrupt Header file');\n    }).catch(function (err) {\n      assert.ok(!!err);\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Buffer input with corrupt header fails gracefully","suites":["Image Stats"],"updatePoint":{"line":707,"column":55,"index":38080},"line":707,"code":"  it('Buffer input with corrupt header fails gracefully', function (done) {\n    sharp(fs.readFileSync(fixtures.inputJpgWithCorruptHeader)).stats(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Non-existent file in, Promise out","suites":["Image Stats"],"updatePoint":{"line":713,"column":39,"index":38293},"line":713,"code":"  it('Non-existent file in, Promise out', function (done) {\n    sharp('fail').stats().then(function (stats) {\n      throw new Error('Non-existent file');\n    }, function (err) {\n      assert.ok(!!err);\n      done();\n    });\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Sequential read option is ignored","suites":["Image Stats"],"updatePoint":{"line":721,"column":39,"index":38523},"line":721,"code":"  it('Sequential read option is ignored', async () => {\n    const {\n      isOpaque\n    } = await sharp(fixtures.inputJpg, {\n      sequentialRead: true\n    }).stats();\n    assert.strictEqual(isOpaque, true);\n  });","file":"unit/stats.js","skipped":false,"dir":"test"},{"name":"Convert SVG to PNG at default 72DPI","suites":["SVG input"],"updatePoint":{"line":11,"column":41,"index":311},"line":11,"code":"  it('Convert SVG to PNG at default 72DPI', function (done) {\n    sharp(fixtures.inputSvg).resize(1024).extract({\n      left: 290,\n      top: 760,\n      width: 40,\n      height: 40\n    }).toFormat('png').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(40, info.width);\n      assert.strictEqual(40, info.height);\n      fixtures.assertSimilar(fixtures.expected('svg72.png'), data, function (err) {\n        if (err) throw err;\n        sharp(data).metadata(function (err, info) {\n          if (err) throw err;\n          assert.strictEqual(72, info.density);\n          done();\n        });\n      });\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Convert SVG to PNG at 1200DPI","suites":["SVG input"],"updatePoint":{"line":32,"column":35,"index":1000},"line":32,"code":"  it('Convert SVG to PNG at 1200DPI', function (done) {\n    sharp(fixtures.inputSvg, {\n      density: 1200\n    }).resize(1024).extract({\n      left: 290,\n      top: 760,\n      width: 40,\n      height: 40\n    }).toFormat('png').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(40, info.width);\n      assert.strictEqual(40, info.height);\n      fixtures.assertSimilar(fixtures.expected('svg1200.png'), data, function (err) {\n        if (err) throw err;\n        sharp(data).metadata(function (err, info) {\n          if (err) throw err;\n          assert.strictEqual(1200, info.density);\n          done();\n        });\n      });\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Convert SVG to PNG at DPI larger than 2400","suites":["SVG input"],"updatePoint":{"line":55,"column":48,"index":1735},"line":55,"code":"  it('Convert SVG to PNG at DPI larger than 2400', function (done) {\n    const size = 1024;\n    sharp(fixtures.inputSvgSmallViewBox).metadata(function (err, metadata) {\n      if (err) throw err;\n      const density = size / Math.max(metadata.width, metadata.height) * metadata.density;\n      sharp(fixtures.inputSvgSmallViewBox, {\n        density\n      }).resize(size).toFormat('png').toBuffer(function (err, data, info) {\n        if (err) throw err;\n        assert.strictEqual('png', info.format);\n        assert.strictEqual(size, info.width);\n        assert.strictEqual(size, info.height);\n        fixtures.assertSimilar(fixtures.expected('circle.png'), data, function (err) {\n          if (err) throw err;\n          sharp(data).metadata(function (err, info) {\n            if (err) throw err;\n            assert.strictEqual(9216, info.density);\n            done();\n          });\n        });\n      });\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Convert SVG to PNG utilizing scale-on-load","suites":["SVG input"],"updatePoint":{"line":78,"column":48,"index":2652},"line":78,"code":"  it('Convert SVG to PNG utilizing scale-on-load', function (done) {\n    const size = 1024;\n    sharp(fixtures.inputSvgSmallViewBox).resize(size).toFormat('png').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(size, info.width);\n      assert.strictEqual(size, info.height);\n      fixtures.assertSimilar(fixtures.expected('circle.png'), data, function (err) {\n        if (err) throw err;\n        sharp(data).metadata(function (err, info) {\n          if (err) throw err;\n          assert.strictEqual(72, info.density);\n          done();\n        });\n      });\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Convert SVG to PNG at 14.4DPI","suites":["SVG input"],"updatePoint":{"line":95,"column":35,"index":3297},"line":95,"code":"  it('Convert SVG to PNG at 14.4DPI', function (done) {\n    sharp(fixtures.inputSvg, {\n      density: 14.4\n    }).toFormat('png').toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(20, info.width);\n      assert.strictEqual(20, info.height);\n      fixtures.assertSimilar(fixtures.expected('svg14.4.png'), data, function (err) {\n        if (err) throw err;\n        done();\n      });\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Convert SVG with embedded images to PNG, respecting dimensions, autoconvert to PNG","suites":["SVG input"],"updatePoint":{"line":109,"column":88,"index":3829},"line":109,"code":"  it('Convert SVG with embedded images to PNG, respecting dimensions, autoconvert to PNG', function (done) {\n    sharp(fixtures.inputSvgWithEmbeddedImages).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(480, info.width);\n      assert.strictEqual(360, info.height);\n      assert.strictEqual(4, info.channels);\n      fixtures.assertSimilar(fixtures.expected('svg-embedded.png'), data, done);\n    });\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Converts SVG with truncated embedded PNG","suites":["SVG input"],"updatePoint":{"line":119,"column":46,"index":4279},"line":119,"code":"  it('Converts SVG with truncated embedded PNG', async () => {\n    const truncatedPng = fs.readFileSync(fixtures.inputPngTruncated).toString('base64');\n    const svg = `<?xml version=\"1.0\" encoding=\"UTF-8\"?>\n      <svg width=\"294\" height=\"240\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n        <image width=\"294\" height=\"240\" xlink:href=\"data:image/png;base64,${truncatedPng}\"/>\n      </svg>`;\n    const {\n      info\n    } = await sharp(Buffer.from(svg)).toBuffer({\n      resolveWithObject: true\n    });\n    assert.strictEqual(info.format, 'png');\n    assert.strictEqual(info.width, 294);\n    assert.strictEqual(info.height, 240);\n    assert.strictEqual(info.channels, 4);\n  });","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Fails to render SVG larger than 32767x32767","suites":["SVG input"],"updatePoint":{"line":135,"column":49,"index":4998},"line":135,"code":"  it('Fails to render SVG larger than 32767x32767', () => assert.rejects(() => sharp(Buffer.from('<svg width=\"32768\" height=\"1\" />')).toBuffer(), /Input SVG image exceeds 32767x32767 pixel limit/));","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Fails to render scaled SVG larger than 32767x32767","suites":["SVG input"],"updatePoint":{"line":136,"column":56,"index":5204},"line":136,"code":"  it('Fails to render scaled SVG larger than 32767x32767', () => assert.rejects(() => sharp(Buffer.from('<svg width=\"32767\" height=\"1\" />')).resize(32768).toBuffer(), /Input SVG image will exceed 32767x32767 pixel limit when scaled/));","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"Detects SVG passed as a string","suites":["SVG input"],"updatePoint":{"line":137,"column":36,"index":5420},"line":137,"code":"  it('Detects SVG passed as a string', () => assert.rejects(() => sharp('<svg></svg>').toBuffer(), /Input file is missing, did you mean/));","file":"unit/svg.js","skipped":false,"dir":"test"},{"name":"text with default values","suites":["Text to image"],"updatePoint":{"line":11,"column":30,"index":297},"line":11,"code":"  it('text with default values', async () => {\n    const output = fixtures.path('output.text-default.png');\n    const text = sharp({\n      text: {\n        text: 'Hello, world !'\n      }\n    });\n    const info = await text.png().toFile(output);\n    assert.strictEqual('png', info.format);\n    assert.strictEqual(3, info.channels);\n    assert.strictEqual(false, info.premultiplied);\n    assert.ok(info.width > 10);\n    assert.ok(info.height > 8);\n    const metadata = await sharp(output).metadata();\n    assert.strictEqual('uchar', metadata.depth);\n    assert.strictEqual('srgb', metadata.space);\n    assert.strictEqual(72, metadata.density);\n    const stats = await sharp(output).stats();\n    assert.strictEqual(0, stats.channels[0].min);\n    assert.strictEqual(255, stats.channels[0].max);\n    assert.strictEqual(0, stats.channels[1].min);\n    assert.strictEqual(255, stats.channels[1].max);\n    assert.strictEqual(0, stats.channels[2].min);\n    assert.strictEqual(255, stats.channels[2].max);\n    assert.ok(info.textAutofitDpi > 0);\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"text with width and height","suites":["Text to image"],"updatePoint":{"line":37,"column":32,"index":1339},"line":37,"code":"  it('text with width and height', function (done) {\n    const output = fixtures.path('output.text-width-height.png');\n    const maxWidth = 500;\n    const maxHeight = 500;\n    const text = sharp({\n      text: {\n        text: 'Hello, world!',\n        width: maxWidth,\n        height: maxHeight\n      }\n    });\n    text.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(3, info.channels);\n      assert.ok(info.width <= maxWidth);\n      assert.ok(info.height <= maxHeight);\n      assert.ok(info.textAutofitDpi > 0);\n      done();\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"text with dpi","suites":["Text to image"],"updatePoint":{"line":58,"column":19,"index":1952},"line":58,"code":"  it('text with dpi', function (done) {\n    const output = fixtures.path('output.text-dpi.png');\n    const dpi = 300;\n    const text = sharp({\n      text: {\n        text: 'Hello, world!',\n        dpi: dpi\n      }\n    });\n    text.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(dpi, metadata.density);\n        done();\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"text with color and pango markup","suites":["Text to image"],"updatePoint":{"line":77,"column":38,"index":2486},"line":77,"code":"  it('text with color and pango markup', function (done) {\n    const output = fixtures.path('output.text-color-pango.png');\n    const dpi = 300;\n    const text = sharp({\n      text: {\n        text: '<span foreground=\"red\" font=\"100\">red</span><span font=\"50\" background=\"cyan\">blue</span>',\n        rgba: true,\n        dpi: dpi\n      }\n    });\n    text.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(4, info.channels);\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual(dpi, metadata.density);\n        assert.strictEqual('uchar', metadata.depth);\n        assert.strictEqual(true, metadata.hasAlpha);\n        done();\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"text with font","suites":["Text to image"],"updatePoint":{"line":100,"column":20,"index":3256},"line":100,"code":"  it('text with font', function (done) {\n    const output = fixtures.path('output.text-with-font.png');\n    const text = sharp({\n      text: {\n        text: 'Hello, world!',\n        font: 'sans 100'\n      }\n    });\n    text.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(3, info.channels);\n      assert.ok(info.width > 30);\n      assert.ok(info.height > 10);\n      done();\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"text with justify and composite","suites":["Text to image"],"updatePoint":{"line":117,"column":37,"index":3748},"line":117,"code":"  it('text with justify and composite', done => {\n    const output = fixtures.path('output.text-composite.png');\n    const width = 500;\n    const dpi = 300;\n    const text = sharp(fixtures.inputJpg).resize(width).composite([{\n      input: {\n        text: {\n          text: '<span foreground=\"#ffff00\">Watermark</span> <span foreground=\"white\"><i>is cool</i></span>',\n          width: 300,\n          height: 300,\n          justify: true,\n          align: 'right',\n          spacing: 50,\n          rgba: true\n        }\n      },\n      gravity: 'northeast'\n    }, {\n      input: {\n        text: {\n          text: '<span background=\"cyan\">cool</span>',\n          font: 'sans 30',\n          dpi: dpi,\n          rgba: true\n        }\n      },\n      left: 30,\n      top: 250\n    }]);\n    text.toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(4, info.channels);\n      assert.strictEqual(width, info.width);\n      assert.strictEqual(true, info.premultiplied);\n      sharp(output).metadata(function (err, metadata) {\n        if (err) throw err;\n        assert.strictEqual('srgb', metadata.space);\n        assert.strictEqual('uchar', metadata.depth);\n        assert.strictEqual(true, metadata.hasAlpha);\n        done();\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad text input","suites":["Text to image"],"updatePoint":{"line":161,"column":20,"index":5048},"line":161,"code":"  it('bad text input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {}\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"fontfile input","suites":["Text to image"],"updatePoint":{"line":168,"column":20,"index":5172},"line":168,"code":"  it('fontfile input', function () {\n    assert.doesNotThrow(function () {\n      sharp({\n        text: {\n          text: 'text',\n          fontfile: 'UnknownFont.ttf'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad font input","suites":["Text to image"],"updatePoint":{"line":178,"column":20,"index":5373},"line":178,"code":"  it('bad font input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          font: 12\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad fontfile input","suites":["Text to image"],"updatePoint":{"line":188,"column":24,"index":5553},"line":188,"code":"  it('bad fontfile input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          fontfile: true\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad width input","suites":["Text to image"],"updatePoint":{"line":198,"column":21,"index":5736},"line":198,"code":"  it('bad width input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          width: 'bad'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad height input","suites":["Text to image"],"updatePoint":{"line":208,"column":22,"index":5918},"line":208,"code":"  it('bad height input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          height: 'bad'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad align input","suites":["Text to image"],"updatePoint":{"line":218,"column":21,"index":6100},"line":218,"code":"  it('bad align input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          align: 'unknown'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad justify input","suites":["Text to image"],"updatePoint":{"line":228,"column":23,"index":6287},"line":228,"code":"  it('bad justify input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          justify: 'unknown'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad dpi input","suites":["Text to image"],"updatePoint":{"line":238,"column":19,"index":6472},"line":238,"code":"  it('bad dpi input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          dpi: -10\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad rgba input","suites":["Text to image"],"updatePoint":{"line":248,"column":20,"index":6648},"line":248,"code":"  it('bad rgba input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          rgba: -10\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"bad spacing input","suites":["Text to image"],"updatePoint":{"line":258,"column":23,"index":6828},"line":258,"code":"  it('bad spacing input', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          spacing: 'number expected'\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"only height or dpi not both","suites":["Text to image"],"updatePoint":{"line":268,"column":33,"index":7035},"line":268,"code":"  it('only height or dpi not both', function () {\n    assert.throws(function () {\n      sharp({\n        text: {\n          text: 'text',\n          height: 400,\n          dpi: 100\n        }\n      });\n    });\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"valid wrap throws","suites":["Text to image"],"updatePoint":{"line":279,"column":23,"index":7237},"line":279,"code":"  it('valid wrap throws', () => {\n    assert.doesNotThrow(() => sharp({\n      text: {\n        text: 'text',\n        wrap: 'none'\n      }\n    }));\n    assert.doesNotThrow(() => sharp({\n      text: {\n        text: 'text',\n        wrap: 'wordChar'\n      }\n    }));\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"invalid wrap throws","suites":["Text to image"],"updatePoint":{"line":293,"column":25,"index":7507},"line":293,"code":"  it('invalid wrap throws', () => {\n    assert.throws(() => sharp({\n      text: {\n        text: 'text',\n        wrap: 1\n      }\n    }), /Expected one of: word, char, wordChar, none for text\\.wrap but received 1 of type number/);\n    assert.throws(() => sharp({\n      text: {\n        text: 'text',\n        wrap: false\n      }\n    }), /Expected one of: word, char, wordChar, none for text\\.wrap but received false of type boolean/);\n    assert.throws(() => sharp({\n      text: {\n        text: 'text',\n        wrap: 'invalid'\n      }\n    }), /Expected one of: word, char, wordChar, none for text\\.wrap but received invalid of type string/);\n  });","file":"unit/text.js","skipped":false,"dir":"test"},{"name":"threshold 1 jpeg","suites":["Threshold"],"updatePoint":{"line":10,"column":22,"index":266},"line":10,"code":"  it('threshold 1 jpeg', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(1).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-1.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold 40 jpeg","suites":["Threshold"],"updatePoint":{"line":19,"column":23,"index":661},"line":19,"code":"  it('threshold 40 jpeg', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(40).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-40.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold 128","suites":["Threshold"],"updatePoint":{"line":28,"column":19,"index":1054},"line":28,"code":"  it('threshold 128', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(128).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold true (=128)","suites":["Threshold"],"updatePoint":{"line":37,"column":27,"index":1457},"line":37,"code":"  it('threshold true (=128)', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(true).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold false (=0)","suites":["Threshold"],"updatePoint":{"line":46,"column":26,"index":1860},"line":46,"code":"  it('threshold false (=0)', function (done) {\n    sharp(fixtures.inputJpg).threshold(false).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.inputJpg, data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold grayscale: true (=128)","suites":["Threshold"],"updatePoint":{"line":52,"column":38,"index":2104},"line":52,"code":"  it('threshold grayscale: true (=128)', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(128, {\n      grayscale: true\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold default jpeg","suites":["Threshold"],"updatePoint":{"line":63,"column":28,"index":2539},"line":63,"code":"  it('threshold default jpeg', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold default png transparency","suites":["Threshold"],"updatePoint":{"line":72,"column":40,"index":2952},"line":72,"code":"  it('threshold default png transparency', function (done) {\n    sharp(fixtures.inputPngWithTransparency).resize(320, 240).threshold().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128-transparency.png'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold default png alpha","suites":["Threshold"],"updatePoint":{"line":81,"column":33,"index":3386},"line":81,"code":"  it('threshold default png alpha', function (done) {\n    sharp(fixtures.inputPngWithGreyAlpha).resize(320, 240).threshold().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-128-alpha.png'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"threshold default webp transparency","suites":["Threshold"],"updatePoint":{"line":90,"column":41,"index":3818},"line":90,"code":"  it('threshold default webp transparency', function (done) {\n    sharp(fixtures.inputWebPWithTransparency).threshold().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('webp', info.format);\n      fixtures.assertSimilar(fixtures.expected('threshold-128-transparency.webp'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"color threshold","suites":["Threshold"],"updatePoint":{"line":97,"column":21,"index":4139},"line":97,"code":"  it('color threshold', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).threshold(128, {\n      grayscale: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertSimilar(fixtures.expected('threshold-color-128.jpg'), data, done);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"invalid threshold -1","suites":["Threshold"],"updatePoint":{"line":108,"column":26,"index":4579},"line":108,"code":"  it('invalid threshold -1', function () {\n    assert.throws(function () {\n      sharp().threshold(-1);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"invalid threshold 256","suites":["Threshold"],"updatePoint":{"line":113,"column":27,"index":4698},"line":113,"code":"  it('invalid threshold 256', function () {\n    assert.throws(function () {\n      sharp().threshold(256);\n    });\n  });","file":"unit/threshold.js","skipped":false,"dir":"test"},{"name":"Load TIFF from Buffer","suites":["TIFF"],"updatePoint":{"line":12,"column":27,"index":341},"line":12,"code":"  it('Load TIFF from Buffer', function (done) {\n    const inputTiffBuffer = fs.readFileSync(fixtures.inputTiff);\n    sharp(inputTiffBuffer).resize(320, 240).jpeg().toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual(data.length, info.size);\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Load multi-page TIFF from file","suites":["TIFF"],"updatePoint":{"line":24,"column":36,"index":839},"line":24,"code":"  it('Load multi-page TIFF from file', function (done) {\n    sharp(fixtures.inputTiffMultipage) // defaults to page 0\n    .jpeg().toBuffer(function (err, defaultData, defaultInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, defaultData.length > 0);\n      assert.strictEqual(defaultData.length, defaultInfo.size);\n      assert.strictEqual('jpeg', defaultInfo.format);\n      sharp(fixtures.inputTiffMultipage, {\n        page: 1\n      }) // 50%-scale copy of page 0\n      .jpeg().toBuffer(function (err, scaledData, scaledInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, scaledData.length > 0);\n        assert.strictEqual(scaledData.length, scaledInfo.size);\n        assert.strictEqual('jpeg', scaledInfo.format);\n        assert.strictEqual(defaultInfo.width, scaledInfo.width * 2);\n        assert.strictEqual(defaultInfo.height, scaledInfo.height * 2);\n        done();\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Load multi-page TIFF from Buffer","suites":["TIFF"],"updatePoint":{"line":45,"column":38,"index":1767},"line":45,"code":"  it('Load multi-page TIFF from Buffer', function (done) {\n    const inputTiffBuffer = fs.readFileSync(fixtures.inputTiffMultipage);\n    sharp(inputTiffBuffer) // defaults to page 0\n    .jpeg().toBuffer(function (err, defaultData, defaultInfo) {\n      if (err) throw err;\n      assert.strictEqual(true, defaultData.length > 0);\n      assert.strictEqual(defaultData.length, defaultInfo.size);\n      assert.strictEqual('jpeg', defaultInfo.format);\n      sharp(inputTiffBuffer, {\n        page: 1\n      }) // 50%-scale copy of page 0\n      .jpeg().toBuffer(function (err, scaledData, scaledInfo) {\n        if (err) throw err;\n        assert.strictEqual(true, scaledData.length > 0);\n        assert.strictEqual(scaledData.length, scaledInfo.size);\n        assert.strictEqual('jpeg', scaledInfo.format);\n        assert.strictEqual(defaultInfo.width, scaledInfo.width * 2);\n        assert.strictEqual(defaultInfo.height, scaledInfo.height * 2);\n        done();\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Save TIFF to Buffer","suites":["TIFF"],"updatePoint":{"line":67,"column":25,"index":2732},"line":67,"code":"  it('Save TIFF to Buffer', function (done) {\n    sharp(fixtures.inputTiff).resize(320, 240).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual(data.length, info.size);\n      assert.strictEqual('tiff', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Increasing TIFF quality increases file size","suites":["TIFF"],"updatePoint":{"line":78,"column":49,"index":3174},"line":78,"code":"  it('Increasing TIFF quality increases file size', () => sharp(fixtures.inputJpgWithLandscapeExif1).resize(320, 240).tiff({\n    quality: 40\n  }).toBuffer().then(tiff40 => sharp(fixtures.inputJpgWithLandscapeExif1).resize(320, 240).tiff({\n    quality: 90\n  }).toBuffer().then(tiff90 => assert.strictEqual(true, tiff40.length < tiff90.length))));","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF quality throws error","suites":["TIFF"],"updatePoint":{"line":83,"column":39,"index":3510},"line":83,"code":"  it('Invalid TIFF quality throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        quality: 101\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Missing TIFF quality does not throw error","suites":["TIFF"],"updatePoint":{"line":90,"column":47,"index":3672},"line":90,"code":"  it('Missing TIFF quality does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff();\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Not squashing TIFF to a bit depth of 1 should not change the file size","suites":["TIFF"],"updatePoint":{"line":95,"column":76,"index":3839},"line":95,"code":"  it('Not squashing TIFF to a bit depth of 1 should not change the file size', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiff8BitDepth).size;\n    sharp(fixtures.inputTiff8BitDepth).toColourspace('b-w') // can only squash 1 band uchar images\n    .tiff({\n      bitdepth: 8,\n      compression: 'none',\n      predictor: 'none'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert.strictEqual(startSize, info.size);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Squashing TIFF to a bit depth of 1 should significantly reduce file size","suites":["TIFF"],"updatePoint":{"line":109,"column":78,"index":4397},"line":109,"code":"  it('Squashing TIFF to a bit depth of 1 should significantly reduce file size', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiff8BitDepth).size;\n    sharp(fixtures.inputTiff8BitDepth).toColourspace('b-w') // can only squash 1 band uchar images\n    .tiff({\n      bitdepth: 1,\n      compression: 'none',\n      predictor: 'none'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size < startSize / 2);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF bitdepth value throws error","suites":["TIFF"],"updatePoint":{"line":123,"column":46,"index":4916},"line":123,"code":"  it('Invalid TIFF bitdepth value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        bitdepth: 3\n      });\n    }, /Error: Expected 1, 2, 4 or 8 for bitdepth but received 3 of type number/);\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF setting xres and yres on file","suites":["TIFF"],"updatePoint":{"line":130,"column":40,"index":5145},"line":130,"code":"  it('TIFF setting xres and yres on file', () => sharp(fixtures.inputTiff).resize(8, 8).tiff({\n    xres: 1000,\n    yres: 1000\n  }).toFile(outputTiff).then(() => sharp(outputTiff).metadata().then(({\n    density\n  }) => {\n    assert.strictEqual(25400, density);\n    return fs.promises.rm(outputTiff);\n  })));","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF setting xres and yres on buffer","suites":["TIFF"],"updatePoint":{"line":139,"column":42,"index":5454},"line":139,"code":"  it('TIFF setting xres and yres on buffer', () => sharp(fixtures.inputTiff).resize(8, 8).tiff({\n    xres: 1000,\n    yres: 1000\n  }).toBuffer().then(data => sharp(data).metadata().then(({\n    density\n  }) => {\n    assert.strictEqual(25400, density);\n  })));","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF imputes xres and yres from withMetadataDensity if not explicitly provided","suites":["TIFF"],"updatePoint":{"line":147,"column":84,"index":5754},"line":147,"code":"  it('TIFF imputes xres and yres from withMetadataDensity if not explicitly provided', async () => {\n    const data = await sharp(fixtures.inputTiff).resize(8, 8).tiff().withMetadata({\n      density: 600\n    }).toBuffer();\n    const {\n      density\n    } = await sharp(data).metadata();\n    assert.strictEqual(600, density);\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF uses xres and yres over withMetadataDensity if explicitly provided","suites":["TIFF"],"updatePoint":{"line":156,"column":77,"index":6078},"line":156,"code":"  it('TIFF uses xres and yres over withMetadataDensity if explicitly provided', async () => {\n    const data = await sharp(fixtures.inputTiff).resize(8, 8).tiff({\n      xres: 1000,\n      yres: 1000\n    }).withMetadata({\n      density: 600\n    }).toBuffer();\n    const {\n      density\n    } = await sharp(data).metadata();\n    assert.strictEqual(25400, density);\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid xres value should throw an error","suites":["TIFF"],"updatePoint":{"line":168,"column":51,"index":6420},"line":168,"code":"  it('TIFF invalid xres value should throw an error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        xres: '1000.0'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid yres value should throw an error","suites":["TIFF"],"updatePoint":{"line":175,"column":51,"index":6588},"line":175,"code":"  it('TIFF invalid yres value should throw an error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        yres: '1000.0'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF lzw compression with horizontal predictor shrinks test file","suites":["TIFF"],"updatePoint":{"line":182,"column":70,"index":6775},"line":182,"code":"  it('TIFF lzw compression with horizontal predictor shrinks test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'lzw',\n      predictor: 'horizontal'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert.strictEqual(3, info.channels);\n      assert(info.size < startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF LZW RGBA toFile","suites":["TIFF"],"updatePoint":{"line":195,"column":26,"index":7241},"line":195,"code":"  it('TIFF LZW RGBA toFile', () => sharp({\n    create: {\n      width: 1,\n      height: 1,\n      channels: 4,\n      background: 'red'\n    }\n  }).tiff({\n    compression: 'lzw'\n  }).toFile(outputTiff).then(info => {\n    assert.strictEqual(4, info.channels);\n  }));","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF LZW RGBA toBuffer","suites":["TIFF"],"updatePoint":{"line":207,"column":28,"index":7505},"line":207,"code":"  it('TIFF LZW RGBA toBuffer', () => sharp({\n    create: {\n      width: 1,\n      height: 1,\n      channels: 4,\n      background: 'red'\n    }\n  }).tiff({\n    compression: 'lzw'\n  }).toBuffer({\n    resolveWithObject: true\n  }).then(({\n    info\n  }) => {\n    assert.strictEqual(4, info.channels);\n  }));","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF ccittfax4 compression shrinks b-w test file","suites":["TIFF"],"updatePoint":{"line":223,"column":54,"index":7832},"line":223,"code":"  it('TIFF ccittfax4 compression shrinks b-w test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiff).size;\n    sharp(fixtures.inputTiff).toColourspace('b-w').tiff({\n      bitdepth: 1,\n      compression: 'ccittfax4'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size < startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF resolutionUnit of inch (default)","suites":["TIFF"],"updatePoint":{"line":235,"column":43,"index":8262},"line":235,"code":"  it('TIFF resolutionUnit of inch (default)', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).tiff().toBuffer();\n    const {\n      resolutionUnit\n    } = await sharp(data).metadata();\n    assert.strictEqual(resolutionUnit, 'inch');\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF resolutionUnit of inch","suites":["TIFF"],"updatePoint":{"line":249,"column":33,"index":8602},"line":249,"code":"  it('TIFF resolutionUnit of inch', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).tiff({\n      resolutionUnit: 'inch'\n    }).toBuffer();\n    const {\n      resolutionUnit\n    } = await sharp(data).metadata();\n    assert.strictEqual(resolutionUnit, 'inch');\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF resolutionUnit of cm","suites":["TIFF"],"updatePoint":{"line":265,"column":31,"index":8976},"line":265,"code":"  it('TIFF resolutionUnit of cm', async () => {\n    const data = await sharp({\n      create: {\n        width: 8,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).tiff({\n      resolutionUnit: 'cm'\n    }).toBuffer();\n    const {\n      resolutionUnit\n    } = await sharp(data).metadata();\n    assert.strictEqual(resolutionUnit, 'cm');\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF deflate compression with horizontal predictor shrinks test file","suites":["TIFF"],"updatePoint":{"line":281,"column":74,"index":9389},"line":281,"code":"  it('TIFF deflate compression with horizontal predictor shrinks test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'deflate',\n      predictor: 'horizontal'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size < startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF deflate compression with float predictor shrinks test file","suites":["TIFF"],"updatePoint":{"line":293,"column":69,"index":9858},"line":293,"code":"  it('TIFF deflate compression with float predictor shrinks test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'deflate',\n      predictor: 'float'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(startSize > info.size);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF deflate compression without predictor shrinks test file","suites":["TIFF"],"updatePoint":{"line":305,"column":66,"index":10319},"line":305,"code":"  it('TIFF deflate compression without predictor shrinks test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'deflate',\n      predictor: 'none'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size < startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF jpeg compression shrinks test file","suites":["TIFF"],"updatePoint":{"line":317,"column":45,"index":10758},"line":317,"code":"  it('TIFF jpeg compression shrinks test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'jpeg'\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size < startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF none compression does not throw error","suites":["TIFF"],"updatePoint":{"line":328,"column":48,"index":11172},"line":328,"code":"  it('TIFF none compression does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        compression: 'none'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF lzw compression does not throw error","suites":["TIFF"],"updatePoint":{"line":335,"column":47,"index":11347},"line":335,"code":"  it('TIFF lzw compression does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        compression: 'lzw'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF deflate compression does not throw error","suites":["TIFF"],"updatePoint":{"line":342,"column":51,"index":11525},"line":342,"code":"  it('TIFF deflate compression does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        compression: 'deflate'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid compression option throws","suites":["TIFF"],"updatePoint":{"line":349,"column":44,"index":11700},"line":349,"code":"  it('TIFF invalid compression option throws', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        compression: 0\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid compression option throws","suites":["TIFF"],"updatePoint":{"line":356,"column":44,"index":11861},"line":356,"code":"  it('TIFF invalid compression option throws', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        compression: 'a'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid predictor option throws","suites":["TIFF"],"updatePoint":{"line":363,"column":42,"index":12022},"line":363,"code":"  it('TIFF invalid predictor option throws', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        predictor: 'a'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF invalid resolutionUnit option throws","suites":["TIFF"],"updatePoint":{"line":370,"column":47,"index":12186},"line":370,"code":"  it('TIFF invalid resolutionUnit option throws', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        resolutionUnit: 'none'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF horizontal predictor does not throw error","suites":["TIFF"],"updatePoint":{"line":377,"column":52,"index":12363},"line":377,"code":"  it('TIFF horizontal predictor does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        predictor: 'horizontal'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF float predictor does not throw error","suites":["TIFF"],"updatePoint":{"line":384,"column":47,"index":12542},"line":384,"code":"  it('TIFF float predictor does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        predictor: 'float'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF none predictor does not throw error","suites":["TIFF"],"updatePoint":{"line":391,"column":46,"index":12715},"line":391,"code":"  it('TIFF none predictor does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        predictor: 'none'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF tiled pyramid image without compression enlarges test file","suites":["TIFF"],"updatePoint":{"line":398,"column":69,"index":12910},"line":398,"code":"  it('TIFF tiled pyramid image without compression enlarges test file', function (done) {\n    const startSize = fs.statSync(fixtures.inputTiffUncompressed).size;\n    sharp(fixtures.inputTiffUncompressed).tiff({\n      compression: 'none',\n      pyramid: true,\n      tile: true,\n      tileHeight: 256,\n      tileWidth: 256\n    }).toFile(outputTiff, (err, info) => {\n      if (err) throw err;\n      assert.strictEqual('tiff', info.format);\n      assert(info.size > startSize);\n      fs.rm(outputTiff, done);\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF pyramid true value does not throw error","suites":["TIFF"],"updatePoint":{"line":413,"column":50,"index":13410},"line":413,"code":"  it('TIFF pyramid true value does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        pyramid: true\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF pyramid value throws error","suites":["TIFF"],"updatePoint":{"line":420,"column":45,"index":13577},"line":420,"code":"  it('Invalid TIFF pyramid value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        pyramid: 'true'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF tile value throws error","suites":["TIFF"],"updatePoint":{"line":427,"column":42,"index":13737},"line":427,"code":"  it('Invalid TIFF tile value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        tile: 'true'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF tile true value does not throw error","suites":["TIFF"],"updatePoint":{"line":434,"column":47,"index":13899},"line":434,"code":"  it('TIFF tile true value does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        tile: true\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Valid TIFF tileHeight value does not throw error","suites":["TIFF"],"updatePoint":{"line":441,"column":54,"index":14072},"line":441,"code":"  it('Valid TIFF tileHeight value does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        tileHeight: 512\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Valid TIFF tileWidth value does not throw error","suites":["TIFF"],"updatePoint":{"line":448,"column":53,"index":14249},"line":448,"code":"  it('Valid TIFF tileWidth value does not throw error', function () {\n    assert.doesNotThrow(function () {\n      sharp().tiff({\n        tileWidth: 512\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF tileHeight value throws error","suites":["TIFF"],"updatePoint":{"line":455,"column":48,"index":14420},"line":455,"code":"  it('Invalid TIFF tileHeight value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        tileHeight: '256'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF tileWidth value throws error","suites":["TIFF"],"updatePoint":{"line":462,"column":47,"index":14587},"line":462,"code":"  it('Invalid TIFF tileWidth value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        tileWidth: '256'\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF tileHeight value throws error","suites":["TIFF"],"updatePoint":{"line":469,"column":48,"index":14754},"line":469,"code":"  it('Invalid TIFF tileHeight value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        tileHeight: 0\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Invalid TIFF tileWidth value throws error","suites":["TIFF"],"updatePoint":{"line":476,"column":47,"index":14917},"line":476,"code":"  it('Invalid TIFF tileWidth value throws error', function () {\n    assert.throws(function () {\n      sharp().tiff({\n        tileWidth: 0\n      });\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF file input with invalid page fails gracefully","suites":["TIFF"],"updatePoint":{"line":483,"column":56,"index":15088},"line":483,"code":"  it('TIFF file input with invalid page fails gracefully', function (done) {\n    sharp(fixtures.inputTiffMultipage, {\n      page: 2\n    }).toBuffer(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"TIFF buffer input with invalid page fails gracefully","suites":["TIFF"],"updatePoint":{"line":491,"column":58,"index":15322},"line":491,"code":"  it('TIFF buffer input with invalid page fails gracefully', function (done) {\n    sharp(fs.readFileSync(fixtures.inputTiffMultipage), {\n      page: 2\n    }).toBuffer(function (err) {\n      assert.strictEqual(true, !!err);\n      done();\n    });\n  });","file":"unit/tiff.js","skipped":false,"dir":"test"},{"name":"Valid size values pass","suites":["Tile"],"updatePoint":{"line":120,"column":28,"index":4570},"line":120,"code":"  it('Valid size values pass', function () {\n    [1, 8192].forEach(function (size) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          size: size\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid size values fail","suites":["Tile"],"updatePoint":{"line":129,"column":30,"index":4777},"line":129,"code":"  it('Invalid size values fail', function () {\n    ['zoinks', 1.1, -1, 0, 8193].forEach(function (size) {\n      assert.throws(function () {\n        sharp().tile({\n          size: size\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid overlap values pass","suites":["Tile"],"updatePoint":{"line":138,"column":31,"index":4998},"line":138,"code":"  it('Valid overlap values pass', function () {\n    [0, 8192].forEach(function (overlap) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          size: 8192,\n          overlap: overlap\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid overlap values fail","suites":["Tile"],"updatePoint":{"line":148,"column":33,"index":5239},"line":148,"code":"  it('Invalid overlap values fail', function () {\n    ['zoinks', 1.1, -1, 8193].forEach(function (overlap) {\n      assert.throws(function () {\n        sharp().tile({\n          overlap: overlap\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid container values pass","suites":["Tile"],"updatePoint":{"line":157,"column":33,"index":5468},"line":157,"code":"  it('Valid container values pass', function () {\n    ['fs', 'zip'].forEach(function (container) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          container: container\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid container values fail","suites":["Tile"],"updatePoint":{"line":166,"column":35,"index":5699},"line":166,"code":"  it('Invalid container values fail', function () {\n    ['zoinks', 1].forEach(function (container) {\n      assert.throws(function () {\n        sharp().tile({\n          container: container\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid layout values pass","suites":["Tile"],"updatePoint":{"line":175,"column":30,"index":5919},"line":175,"code":"  it('Valid layout values pass', function () {\n    ['dz', 'google', 'zoomify'].forEach(function (layout) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          layout: layout\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid layout values fail","suites":["Tile"],"updatePoint":{"line":184,"column":32,"index":6152},"line":184,"code":"  it('Invalid layout values fail', function () {\n    ['zoinks', 1].forEach(function (layout) {\n      assert.throws(function () {\n        sharp().tile({\n          layout: layout\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid formats pass","suites":["Tile"],"updatePoint":{"line":193,"column":24,"index":6357},"line":193,"code":"  it('Valid formats pass', function () {\n    ['jpeg', 'png', 'webp'].forEach(function (format) {\n      assert.doesNotThrow(function () {\n        sharp().toFormat(format).tile();\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid formats fail","suites":["Tile"],"updatePoint":{"line":200,"column":26,"index":6561},"line":200,"code":"  it('Invalid formats fail', function () {\n    ['tiff', 'raw'].forEach(function (format) {\n      assert.throws(function () {\n        sharp().toFormat(format).tile();\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid depths pass","suites":["Tile"],"updatePoint":{"line":207,"column":23,"index":6748},"line":207,"code":"  it('Valid depths pass', function () {\n    ['onepixel', 'onetile', 'one'].forEach(function (depth) {\n      assert.doesNotThrow(() => sharp().tile({\n        depth\n      }));\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid depths fail","suites":["Tile"],"updatePoint":{"line":214,"column":25,"index":6938},"line":214,"code":"  it('Invalid depths fail', function () {\n    ['depth', 1].forEach(function (depth) {\n      assert.throws(() => sharp().tile({\n        depth\n      }), /Expected one of: onepixel, onetile, one for depth but received/);\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Prevent larger overlap than default size","suites":["Tile"],"updatePoint":{"line":221,"column":46,"index":7191},"line":221,"code":"  it('Prevent larger overlap than default size', function () {\n    assert.throws(function () {\n      sharp().tile({\n        overlap: 257\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Prevent larger overlap than provided size","suites":["Tile"],"updatePoint":{"line":228,"column":47,"index":7353},"line":228,"code":"  it('Prevent larger overlap than provided size', function () {\n    assert.throws(function () {\n      sharp().tile({\n        size: 512,\n        overlap: 513\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid rotation angle values pass","suites":["Tile"],"updatePoint":{"line":236,"column":38,"index":7525},"line":236,"code":"  it('Valid rotation angle values pass', function () {\n    [90, 270, -90].forEach(function (angle) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          angle: angle\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid rotation angle values fail","suites":["Tile"],"updatePoint":{"line":245,"column":40,"index":7750},"line":245,"code":"  it('Invalid rotation angle values fail', function () {\n    ['zoinks', 1.1, -1, 27].forEach(function (angle) {\n      assert.throws(function () {\n        sharp().tile({\n          angle: angle\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid skipBlanks threshold values pass","suites":["Tile"],"updatePoint":{"line":254,"column":44,"index":7982},"line":254,"code":"  it('Valid skipBlanks threshold values pass', function () {\n    [-1, 0, 255, 65535].forEach(function (skipBlanksThreshold) {\n      assert.doesNotThrow(function () {\n        sharp().tile({\n          skipBlanks: skipBlanksThreshold\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"InvalidskipBlanks threshold values fail","suites":["Tile"],"updatePoint":{"line":263,"column":45,"index":8250},"line":263,"code":"  it('InvalidskipBlanks threshold values fail', function () {\n    ['zoinks', -2, 65536].forEach(function (skipBlanksThreshold) {\n      assert.throws(function () {\n        sharp().tile({\n          skipBlanks: skipBlanksThreshold\n        });\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid center parameter value passes","suites":["Tile"],"updatePoint":{"line":272,"column":41,"index":8510},"line":272,"code":"  it('Valid center parameter value passes', function () {\n    assert.doesNotThrow(() => sharp().tile({\n      center: true\n    }));\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid centre parameter value fails","suites":["Tile"],"updatePoint":{"line":277,"column":42,"index":8648},"line":277,"code":"  it('Invalid centre parameter value fails', function () {\n    assert.throws(() => sharp().tile({\n      centre: 'true'\n    }), /Expected boolean for tileCentre but received true of type string/);\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid id parameter value passes","suites":["Tile"],"updatePoint":{"line":282,"column":37,"index":8845},"line":282,"code":"  it('Valid id parameter value passes', function () {\n    assert.doesNotThrow(function () {\n      sharp().tile({\n        id: 'test'\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid id parameter value fails","suites":["Tile"],"updatePoint":{"line":289,"column":38,"index":9002},"line":289,"code":"  it('Invalid id parameter value fails', function () {\n    assert.throws(function () {\n      sharp().tile({\n        id: true\n      });\n    });\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Valid basename parameter value passes","suites":["Tile"],"updatePoint":{"line":296,"column":43,"index":9156},"line":296,"code":"  it('Valid basename parameter value passes', function () {\n    assert.doesNotThrow(() => sharp().tile({\n      basename: 'pass'\n    }));\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Invalid basename parameter value fails","suites":["Tile"],"updatePoint":{"line":301,"column":44,"index":9300},"line":301,"code":"  it('Invalid basename parameter value fails', function () {\n    assert.throws(() => sharp().tile({\n      basename: true\n    }), /Expected string for basename but received/);\n  });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout","suites":["Tile"],"updatePoint":{"line":307,"column":24,"index":9498},"line":307,"code":"    it('Deep Zoom layout', function (done) {\n      const directory = fixtures.path('output.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).toFile(fixtures.path('output.dzi'), function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('undefined', typeof info.size);\n          assertDeepZoomTiles(directory, 256, 13, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with custom size+overlap","suites":["Tile"],"updatePoint":{"line":323,"column":49,"index":10163},"line":323,"code":"    it('Deep Zoom layout with custom size+overlap', function (done) {\n      const directory = fixtures.path('output.512.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 512,\n          overlap: 16\n        }).toFile(fixtures.path('output.512.dzi'), function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('undefined', typeof info.size);\n          assertDeepZoomTiles(directory, 512 + 2 * 16, 13, function () {\n            assertTileOverlap(directory, 512, done);\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with custom size+angle","suites":["Tile"],"updatePoint":{"line":344,"column":47,"index":10978},"line":344,"code":"    it('Deep Zoom layout with custom size+angle', function (done) {\n      const directory = fixtures.path('output.512_90.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 512,\n          angle: 90\n        }).toFile(fixtures.path('output.512_90.dzi'), function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('undefined', typeof info.size);\n          assertDeepZoomTiles(directory, 512, 13, done);\n          // Verifies tiles in 10th level are rotated\n          const tile = path.join(directory, '10', '0_1.jpeg');\n          // verify that the width and height correspond to the rotated image\n          // expected are w=512 and h=170 for the 0_1.jpeg.\n          // if a 0 angle is supplied to the .tile function\n          // the expected values are w=170 and h=512 for the 1_0.jpeg\n          sharp(tile).metadata(function (err, metadata) {\n            if (err) {\n              throw err;\n            } else {\n              assert.strictEqual(true, metadata.width === 512);\n              assert.strictEqual(true, metadata.height === 170);\n            }\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with depth of one","suites":["Tile"],"updatePoint":{"line":377,"column":42,"index":12378},"line":377,"code":"    it('Deep Zoom layout with depth of one', function (done) {\n      const directory = fixtures.path('output.512_depth_one.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 512,\n          depth: 'one'\n        }).toFile(fixtures.path('output.512_depth_one.dzi'), function (err, info) {\n          if (err) throw err;\n          // Verify only one depth generated\n          assertDeepZoomTiles(directory, 512, 1, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with depth of onepixel","suites":["Tile"],"updatePoint":{"line":392,"column":47,"index":12920},"line":392,"code":"    it('Deep Zoom layout with depth of onepixel', function (done) {\n      const directory = fixtures.path('output.512_depth_onepixel.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 512,\n          depth: 'onepixel'\n        }).toFile(fixtures.path('output.512_depth_onepixel.dzi'), function (err, info) {\n          if (err) throw err;\n          // Verify only one depth generated\n          assertDeepZoomTiles(directory, 512, 13, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with depth of onetile","suites":["Tile"],"updatePoint":{"line":407,"column":46,"index":13477},"line":407,"code":"    it('Deep Zoom layout with depth of onetile', function (done) {\n      const directory = fixtures.path('output.256_depth_onetile.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 256,\n          depth: 'onetile'\n        }).toFile(fixtures.path('output.256_depth_onetile.dzi'), function (err, info) {\n          if (err) throw err;\n          // Verify only one depth generated\n          assertDeepZoomTiles(directory, 256, 5, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Deep Zoom layout with skipBlanks","suites":["Tile"],"updatePoint":{"line":422,"column":40,"index":14024},"line":422,"code":"    it('Deep Zoom layout with skipBlanks', function (done) {\n      const directory = fixtures.path('output.256_skip_blanks.dzi_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpgOverlayLayer2).tile({\n          size: 256,\n          skipBlanks: 0\n        }).toFile(fixtures.path('output.256_skip_blanks.dzi'), function (err, info) {\n          if (err) throw err;\n          // assert them 0_0.jpeg doesn't exist because it's a white tile\n          const whiteTilePath = path.join(directory, '11', '0_0.jpeg');\n          assert.strictEqual(fs.existsSync(whiteTilePath), false, 'Tile should not exist');\n          // Verify only one depth generated\n          assertDeepZoomTiles(directory, 256, 12, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Zoomify layout","suites":["Tile"],"updatePoint":{"line":440,"column":22,"index":14798},"line":440,"code":"    it('Zoomify layout', function (done) {\n      const directory = fixtures.path('output.zoomify.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          layout: 'zoomify'\n        }).toFile(fixtures.path('output.zoomify.dzi'), function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fs.stat(path.join(directory, 'ImageProperties.xml'), function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            done();\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Zoomify layout with depth one","suites":["Tile"],"updatePoint":{"line":463,"column":37,"index":15705},"line":463,"code":"    it('Zoomify layout with depth one', function (done) {\n      const directory = fixtures.path('output.zoomify.depth_one.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 256,\n          layout: 'zoomify',\n          depth: 'one'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertZoomifyTiles(directory, 256, 1, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Zoomify layout with depth onetile","suites":["Tile"],"updatePoint":{"line":483,"column":41,"index":16442},"line":483,"code":"    it('Zoomify layout with depth onetile', function (done) {\n      const directory = fixtures.path('output.zoomify.depth_onetile.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 256,\n          layout: 'zoomify',\n          depth: 'onetile'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertZoomifyTiles(directory, 256, 5, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Zoomify layout with depth onepixel","suites":["Tile"],"updatePoint":{"line":503,"column":42,"index":17188},"line":503,"code":"    it('Zoomify layout with depth onepixel', function (done) {\n      const directory = fixtures.path('output.zoomify.depth_onepixel.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          size: 256,\n          layout: 'zoomify',\n          depth: 'onepixel'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertZoomifyTiles(directory, 256, 13, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Zoomify layout with skip blanks","suites":["Tile"],"updatePoint":{"line":523,"column":39,"index":17934},"line":523,"code":"    it('Zoomify layout with skip blanks', function (done) {\n      const directory = fixtures.path('output.zoomify.skipBlanks.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpgOverlayLayer2).tile({\n          size: 256,\n          layout: 'zoomify',\n          skipBlanks: 0\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          // assert them 0_0.jpeg doesn't exist because it's a white tile\n          const whiteTilePath = path.join(directory, 'TileGroup0', '2-0-0.jpg');\n          assert.strictEqual(fs.existsSync(whiteTilePath), false, 'Tile should not exist');\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2048, info.width);\n          assert.strictEqual(1536, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertZoomifyTiles(directory, 256, 4, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout","suites":["Tile"],"updatePoint":{"line":546,"column":21,"index":18913},"line":546,"code":"    it('Google layout', function (done) {\n      const directory = fixtures.path('output.google.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fs.stat(path.join(directory, '0', '0', '0.jpg'), function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            done();\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with jpeg format","suites":["Tile"],"updatePoint":{"line":569,"column":38,"index":19789},"line":569,"code":"    it('Google layout with jpeg format', function (done) {\n      const directory = fixtures.path('output.jpg.google.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).jpeg({\n          quality: 1\n        }).tile({\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          const sample = path.join(directory, '0', '0', '0.jpg');\n          sharp(sample).metadata(function (err, metadata) {\n            if (err) throw err;\n            assert.strictEqual('jpeg', metadata.format);\n            assert.strictEqual('srgb', metadata.space);\n            assert.strictEqual(3, metadata.channels);\n            assert.strictEqual(false, metadata.hasProfile);\n            assert.strictEqual(false, metadata.hasAlpha);\n            assert.strictEqual(256, metadata.width);\n            assert.strictEqual(256, metadata.height);\n            fs.stat(sample, function (err, stat) {\n              if (err) throw err;\n              assert.strictEqual(true, stat.size < 2000);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with png format","suites":["Tile"],"updatePoint":{"line":604,"column":37,"index":21198},"line":604,"code":"    it('Google layout with png format', function (done) {\n      const directory = fixtures.path('output.png.google.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).png({\n          compressionLevel: 0\n        }).tile({\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          const sample = path.join(directory, '0', '0', '0.png');\n          sharp(sample).metadata(function (err, metadata) {\n            if (err) throw err;\n            assert.strictEqual('png', metadata.format);\n            assert.strictEqual('srgb', metadata.space);\n            assert.strictEqual(3, metadata.channels);\n            assert.strictEqual(false, metadata.hasProfile);\n            assert.strictEqual(false, metadata.hasAlpha);\n            assert.strictEqual(256, metadata.width);\n            assert.strictEqual(256, metadata.height);\n            fs.stat(sample, function (err, stat) {\n              if (err) throw err;\n              assert.strictEqual(true, stat.size > 44000);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with webp format","suites":["Tile"],"updatePoint":{"line":639,"column":38,"index":22616},"line":639,"code":"    it('Google layout with webp format', function (done) {\n      const directory = fixtures.path('output.webp.google.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).webp({\n          quality: 1,\n          effort: 0\n        }).tile({\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          const sample = path.join(directory, '0', '0', '0.webp');\n          sharp(sample).metadata(function (err, metadata) {\n            if (err) throw err;\n            assert.strictEqual('webp', metadata.format);\n            assert.strictEqual('srgb', metadata.space);\n            assert.strictEqual(3, metadata.channels);\n            assert.strictEqual(false, metadata.hasProfile);\n            assert.strictEqual(false, metadata.hasAlpha);\n            assert.strictEqual(256, metadata.width);\n            assert.strictEqual(256, metadata.height);\n            fs.stat(sample, function (err, stat) {\n              if (err) throw err;\n              assert.strictEqual(true, stat.size < 2000);\n              done();\n            });\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with depth one","suites":["Tile"],"updatePoint":{"line":675,"column":36,"index":24047},"line":675,"code":"    it('Google layout with depth one', function (done) {\n      const directory = fixtures.path('output.google_depth_one.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          layout: 'google',\n          depth: 'one',\n          size: 256\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertGoogleTiles(directory, 256, 1, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with depth onepixel","suites":["Tile"],"updatePoint":{"line":695,"column":41,"index":24781},"line":695,"code":"    it('Google layout with depth onepixel', function (done) {\n      const directory = fixtures.path('output.google_depth_onepixel.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          layout: 'google',\n          depth: 'onepixel',\n          size: 256\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertGoogleTiles(directory, 256, 13, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with depth onetile","suites":["Tile"],"updatePoint":{"line":715,"column":40,"index":25525},"line":715,"code":"    it('Google layout with depth onetile', function (done) {\n      const directory = fixtures.path('output.google_depth_onetile.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          layout: 'google',\n          depth: 'onetile',\n          size: 256\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertGoogleTiles(directory, 256, 5, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with default skip Blanks","suites":["Tile"],"updatePoint":{"line":735,"column":46,"index":26272},"line":735,"code":"    it('Google layout with default skip Blanks', function (done) {\n      const directory = fixtures.path('output.google_depth_skipBlanks.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputPng).tile({\n          layout: 'google',\n          size: 256\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          const whiteTilePath = path.join(directory, '4', '8', '0.jpg');\n          assert.strictEqual(fs.existsSync(whiteTilePath), false, 'Tile should not exist');\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2809, info.width);\n          assert.strictEqual(2074, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          assertGoogleTiles(directory, 256, 5, done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with center image in tile","suites":["Tile"],"updatePoint":{"line":756,"column":47,"index":27160},"line":756,"code":"    it('Google layout with center image in tile', function (done) {\n      const directory = fixtures.path('output.google_center.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          center: true,\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fixtures.assertSimilar(fixtures.expected('tile_centered.jpg'), fs.readFileSync(path.join(directory, '0', '0', '0.jpg')), done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Google layout with center image in tile centre","suites":["Tile"],"updatePoint":{"line":775,"column":54,"index":27967},"line":775,"code":"    it('Google layout with center image in tile centre', function (done) {\n      const directory = fixtures.path('output.google_center.dzi');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          centre: true,\n          layout: 'google'\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fixtures.assertSimilar(fixtures.expected('tile_centered.jpg'), fs.readFileSync(path.join(directory, '0', '0', '0.jpg')), done);\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"IIIFv2 layout","suites":["Tile"],"updatePoint":{"line":794,"column":21,"index":28741},"line":794,"code":"    it('IIIFv2 layout', function (done) {\n      const name = 'output.iiif.info';\n      const directory = fixtures.path(name);\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        const id = 'https://sharp.test.com/iiif';\n        sharp(fixtures.inputJpg).tile({\n          layout: 'iiif',\n          id\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          const infoJson = require(path.join(directory, 'info.json'));\n          assert.strictEqual('http://iiif.io/api/image/2/context.json', infoJson['@context']);\n          assert.strictEqual(`${id}/${name}`, infoJson['@id']);\n          fs.stat(path.join(directory, '0,0,256,256', '256,', '0', 'default.jpg'), function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            done();\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"IIIFv3 layout","suites":["Tile"],"updatePoint":{"line":823,"column":21,"index":29940},"line":823,"code":"    it('IIIFv3 layout', function (done) {\n      const name = 'output.iiif3.info';\n      const directory = fixtures.path(name);\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        const id = 'https://sharp.test.com/iiif3';\n        sharp(fixtures.inputJpg).tile({\n          layout: 'iiif3',\n          id\n        }).toFile(directory, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          const infoJson = require(path.join(directory, 'info.json'));\n          assert.strictEqual('http://iiif.io/api/image/3/context.json', infoJson['@context']);\n          assert.strictEqual('ImageService3', infoJson.type);\n          assert.strictEqual(`${id}/${name}`, infoJson.id);\n          fs.stat(path.join(directory, '0,0,256,256', '256,256', '0', 'default.jpg'), function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            done();\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Write to ZIP container using file extension","suites":["Tile"],"updatePoint":{"line":853,"column":51,"index":31233},"line":853,"code":"    it('Write to ZIP container using file extension', function (done) {\n      const container = fixtures.path('output.dz.container.zip');\n      const extractTo = fixtures.path('output.dz.container');\n      const directory = path.join(extractTo, 'output.dz.container_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).toFile(container, function (err, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fs.stat(container, function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            extractZip(container, {\n              dir: extractTo\n            }).then(() => {\n              assertDeepZoomTiles(directory, 256, 13, done);\n            }).catch(done);\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Write to ZIP container using container tile option","suites":["Tile"],"updatePoint":{"line":880,"column":58,"index":32359},"line":880,"code":"    it('Write to ZIP container using container tile option', function (done) {\n      const container = fixtures.path('output.dz.containeropt.zip');\n      const extractTo = fixtures.path('output.dz.containeropt');\n      const directory = path.join(extractTo, 'output.dz.containeropt_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          container: 'zip'\n        }).toFile(container, function (err, info) {\n          // Vips overrides .dzi extension to .zip used by container var below\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fs.stat(container, function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            extractZip(container, {\n              dir: extractTo\n            }).then(() => {\n              assertDeepZoomTiles(directory, 256, 13, done);\n            }).catch(done);\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Write ZIP container to Buffer","suites":["Tile"],"updatePoint":{"line":910,"column":37,"index":33597},"line":910,"code":"    it('Write ZIP container to Buffer', function (done) {\n      const container = fixtures.path('output.dz.tiles.zip');\n      const extractTo = fixtures.path('output.dz.tiles');\n      const directory = path.join(extractTo, 'output.dz.tiles_files');\n      fs.rm(directory, {\n        recursive: true\n      }, function () {\n        sharp(fixtures.inputJpg).tile({\n          basename: 'output.dz.tiles'\n        }).toBuffer(function (err, data, info) {\n          if (err) throw err;\n          assert.strictEqual('dz', info.format);\n          assert.strictEqual(2725, info.width);\n          assert.strictEqual(2225, info.height);\n          assert.strictEqual(3, info.channels);\n          assert.strictEqual('number', typeof info.size);\n          fs.writeFileSync(container, data);\n          fs.stat(container, function (err, stat) {\n            if (err) throw err;\n            assert.strictEqual(true, stat.isFile());\n            assert.strictEqual(true, stat.size > 0);\n            extractZip(container, {\n              dir: extractTo\n            }).then(() => {\n              assertDeepZoomTiles(directory, 256, 13, done);\n            }).catch(done);\n          });\n        });\n      });\n    });","file":"unit/tile.js","skipped":false,"dir":"test"},{"name":"Will timeout after 1s when performing slow blur operation","suites":["Timeout"],"updatePoint":{"line":10,"column":63,"index":305},"line":10,"code":"  it('Will timeout after 1s when performing slow blur operation', () => assert.rejects(() => sharp(fixtures.inputJpg).blur(100).timeout({\n    seconds: 1\n  }).toBuffer(), /timeout: [0-9]+% complete/));","file":"unit/timeout.js","skipped":false,"dir":"test"},{"name":"invalid object","suites":["Timeout"],"updatePoint":{"line":13,"column":20,"index":463},"line":13,"code":"  it('invalid object', () => assert.throws(() => sharp().timeout('fail'), /Expected object for options but received fail of type string/));","file":"unit/timeout.js","skipped":false,"dir":"test"},{"name":"invalid seconds","suites":["Timeout"],"updatePoint":{"line":14,"column":21,"index":604},"line":14,"code":"  it('invalid seconds', () => assert.throws(() => sharp().timeout({\n    seconds: 'fail'\n  }), /Expected integer between 0 and 3600 for seconds but received fail of type string/));","file":"unit/timeout.js","skipped":false,"dir":"test"},{"name":"tints rgb image red","suites":["Tint"],"updatePoint":{"line":10,"column":25,"index":264},"line":10,"code":"  it('tints rgb image red', function (done) {\n    const output = fixtures.path('output.tint-red.jpg');\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#FF0000').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-red.jpg'), 18);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints rgb image green","suites":["Tint"],"updatePoint":{"line":21,"column":27,"index":696},"line":21,"code":"  it('tints rgb image green', function (done) {\n    const output = fixtures.path('output.tint-green.jpg');\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#00FF00').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-green.jpg'), 27);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints rgb image blue","suites":["Tint"],"updatePoint":{"line":32,"column":26,"index":1131},"line":32,"code":"  it('tints rgb image blue', function (done) {\n    const output = fixtures.path('output.tint-blue.jpg');\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#0000FF').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-blue.jpg'), 14);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints rgb image with sepia tone","suites":["Tint"],"updatePoint":{"line":43,"column":37,"index":1575},"line":43,"code":"  it('tints rgb image with sepia tone', function (done) {\n    const output = fixtures.path('output.tint-sepia.jpg');\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#704214').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-sepia.jpg'), 10);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints rgb image with sepia tone with rgb colour","suites":["Tint"],"updatePoint":{"line":55,"column":53,"index":2077},"line":55,"code":"  it('tints rgb image with sepia tone with rgb colour', function (done) {\n    const output = fixtures.path('output.tint-sepia.jpg');\n    sharp(fixtures.inputJpg).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint([112, 66, 20]).toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-sepia.jpg'), 10);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints rgb image with alpha channel","suites":["Tint"],"updatePoint":{"line":67,"column":40,"index":2570},"line":67,"code":"  it('tints rgb image with alpha channel', function (done) {\n    const output = fixtures.path('output.tint-alpha.png');\n    sharp(fixtures.inputPngRGBWithAlpha).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#704214').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-alpha.png'), 10);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"tints cmyk image red","suites":["Tint"],"updatePoint":{"line":79,"column":26,"index":3057},"line":79,"code":"  it('tints cmyk image red', function (done) {\n    const output = fixtures.path('output.tint-cmyk.jpg');\n    sharp(fixtures.inputJpgWithCmykProfile).resize(320, 240, {\n      fastShrinkOnLoad: false\n    }).tint('#FF0000').toFile(output, function (err, info) {\n      if (err) throw err;\n      assert.strictEqual(true, info.size > 0);\n      fixtures.assertMaxColourDistance(output, fixtures.expected('tint-cmyk.jpg'), 15);\n      done();\n    });\n  });","file":"unit/tint.js","skipped":false,"dir":"test"},{"name":"reusing same sharp object does not reset previously passed parameters to toBuffer","suites":["toBuffer"],"updatePoint":{"line":10,"column":87,"index":324},"line":10,"code":"  it('reusing same sharp object does not reset previously passed parameters to toBuffer', async () => {\n    const image = sharp(fixtures.inputJpg);\n    const obj = await image.toBuffer({\n      resolveWithObject: true\n    });\n    assert.strictEqual(typeof obj, 'object');\n    assert.strictEqual(typeof obj.info, 'object');\n    assert.strictEqual(Buffer.isBuffer(obj.data), true);\n    const data = await image.toBuffer();\n    assert.strictEqual(Buffer.isBuffer(data), true);\n  });","file":"unit/toBuffer.js","skipped":false,"dir":"test"},{"name":"correctly process animated webp with height > 16383","suites":["toBuffer"],"updatePoint":{"line":21,"column":57,"index":773},"line":21,"code":"  it('correctly process animated webp with height > 16383', async () => {\n    const data = await sharp(fixtures.inputWebPAnimatedBigHeight, {\n      animated: true\n    }).toBuffer();\n    assert.strictEqual(Buffer.isBuffer(data), true);\n  });","file":"unit/toBuffer.js","skipped":false,"dir":"test"},{"name":"accepts upper case characters as format parameter (string)","suites":["toFormat"],"updatePoint":{"line":10,"column":64,"index":301},"line":10,"code":"  it('accepts upper case characters as format parameter (string)', async () => {\n    const data = await sharp(fixtures.inputJpg).resize(8, 8).toFormat('PNG').toBuffer();\n    const {\n      format\n    } = await sharp(data).metadata();\n    assert.strictEqual(format, 'png');\n  });","file":"unit/toFormat.js","skipped":false,"dir":"test"},{"name":"accepts upper case characters as format parameter (object)","suites":["toFormat"],"updatePoint":{"line":17,"column":64,"index":579},"line":17,"code":"  it('accepts upper case characters as format parameter (object)', async () => {\n    const data = await sharp(fixtures.inputJpg).resize(8, 8).toFormat({\n      id: 'PNG'\n    }).toBuffer();\n    const {\n      format\n    } = await sharp(data).metadata();\n    assert.strictEqual(format, 'png');\n  });","file":"unit/toFormat.js","skipped":false,"dir":"test"},{"name":"Skip shrink-on-load","suites":["Trim borders"],"updatePoint":{"line":11,"column":25,"index":321},"line":11,"code":"  it('Skip shrink-on-load', function (done) {\n    const expected = fixtures.expected('alpha-layer-2-trim-resize.jpg');\n    sharp(fixtures.inputJpgOverlayLayer2).trim().resize({\n      width: 300,\n      fastShrinkOnLoad: false\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual('jpeg', info.format);\n      assert.strictEqual(300, info.width);\n      assert.strictEqual(true, inRange(info.trimOffsetLeft, -873, -870));\n      assert.strictEqual(-554, info.trimOffsetTop);\n      fixtures.assertSimilar(expected, data, done);\n    });\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Single colour PNG where alpha channel provides the image","suites":["Trim borders"],"updatePoint":{"line":25,"column":62,"index":936},"line":25,"code":"  it('Single colour PNG where alpha channel provides the image', () => sharp(fixtures.inputPngImageInAlpha).trim().toBuffer({\n    resolveWithObject: true\n  }).then(({\n    data,\n    info\n  }) => {\n    assert.strictEqual(true, data.length > 0);\n    assert.strictEqual('png', info.format);\n    assert.strictEqual(916, info.width);\n    assert.strictEqual(137, info.height);\n    assert.strictEqual(4, info.channels);\n    assert.strictEqual(-6, info.trimOffsetLeft);\n    assert.strictEqual(-20, info.trimOffsetTop);\n  }));","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"16-bit PNG with alpha channel","suites":["Trim borders"],"updatePoint":{"line":39,"column":35,"index":1426},"line":39,"code":"  it('16-bit PNG with alpha channel', function (done) {\n    sharp(fixtures.inputPngWithTransparency16bit).resize(32, 32).trim(20).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('png', info.format);\n      assert.strictEqual(32, info.width);\n      assert.strictEqual(32, info.height);\n      assert.strictEqual(4, info.channels);\n      assert.strictEqual(-2, info.trimOffsetLeft);\n      assert.strictEqual(-2, info.trimOffsetTop);\n      fixtures.assertSimilar(fixtures.expected('trim-16bit-rgba.png'), data, done);\n    });\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Attempt to trim 2x2 pixel image fails","suites":["Trim borders"],"updatePoint":{"line":52,"column":43,"index":2051},"line":52,"code":"  it('Attempt to trim 2x2 pixel image fails', function (done) {\n    sharp({\n      create: {\n        width: 2,\n        height: 2,\n        channels: 3,\n        background: 'red'\n      }\n    }).trim().toBuffer().then(() => {\n      done(new Error('Expected an error'));\n    }).catch(err => {\n      assert.strictEqual('Image to trim must be at least 3x3 pixels', err.message);\n      done();\n    }).catch(done);\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Should rotate before trim","suites":["Trim borders"],"updatePoint":{"line":67,"column":31,"index":2451},"line":67,"code":"  it('Should rotate before trim', () => sharp({\n    create: {\n      width: 20,\n      height: 30,\n      channels: 3,\n      background: 'white'\n    }\n  }).rotate(30).png().toBuffer().then(rotated30 => sharp(rotated30).rotate(-30).trim(128).toBuffer({\n    resolveWithObject: true\n  }).then(({\n    info\n  }) => {\n    assert.strictEqual(20, info.width);\n    assert.strictEqual(31, info.height);\n    assert.strictEqual(-8, info.trimOffsetTop);\n    assert.strictEqual(-13, info.trimOffsetLeft);\n  })));","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Animated image rejects","suites":["Trim borders"],"updatePoint":{"line":84,"column":28,"index":2944},"line":84,"code":"  it('Animated image rejects', () => assert.rejects(() => sharp(fixtures.inputGifAnimated, {\n    animated: true\n  }).trim().toBuffer(), /Trim is not supported for multi-page images/));","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Ensure trim uses bounding box of alpha and non-alpha channels","suites":["Trim borders"],"updatePoint":{"line":87,"column":67,"index":3168},"line":87,"code":"  it('Ensure trim uses bounding box of alpha and non-alpha channels', async () => {\n    const {\n      info\n    } = await sharp(fixtures.inputPngTrimIncludeAlpha).trim().toBuffer({\n      resolveWithObject: true\n    });\n    const {\n      width,\n      height,\n      trimOffsetTop,\n      trimOffsetLeft\n    } = info;\n    assert.strictEqual(width, 179);\n    assert.strictEqual(height, 123);\n    assert.strictEqual(trimOffsetTop, -44);\n    assert.strictEqual(trimOffsetLeft, -13);\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Ensure greyscale image can be trimmed","suites":["Trim borders"],"updatePoint":{"line":104,"column":43,"index":3625},"line":104,"code":"  it('Ensure greyscale image can be trimmed', async () => {\n    const greyscale = await sharp({\n      create: {\n        width: 16,\n        height: 8,\n        channels: 3,\n        background: 'silver'\n      }\n    }).extend({\n      left: 12,\n      right: 24,\n      background: 'gray'\n    }).toColourspace('b-w').png({\n      compressionLevel: 0\n    }).toBuffer();\n    const {\n      info\n    } = await sharp(greyscale).trim().raw().toBuffer({\n      resolveWithObject: true\n    });\n    const {\n      width,\n      height,\n      trimOffsetTop,\n      trimOffsetLeft\n    } = info;\n    assert.strictEqual(width, 16);\n    assert.strictEqual(height, 8);\n    assert.strictEqual(trimOffsetTop, 0);\n    assert.strictEqual(trimOffsetLeft, -12);\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Ensure CMYK image can be trimmed","suites":["Trim borders"],"updatePoint":{"line":135,"column":38,"index":4355},"line":135,"code":"  it('Ensure CMYK image can be trimmed', async () => {\n    const cmyk = await sharp({\n      create: {\n        width: 16,\n        height: 8,\n        channels: 3,\n        background: 'red'\n      }\n    }).extend({\n      left: 12,\n      right: 24,\n      background: 'blue'\n    }).toColourspace('cmyk').jpeg().toBuffer();\n    const {\n      info\n    } = await sharp(cmyk).trim().raw().toBuffer({\n      resolveWithObject: true\n    });\n    const {\n      width,\n      height,\n      trimOffsetTop,\n      trimOffsetLeft\n    } = info;\n    assert.strictEqual(width, 16);\n    assert.strictEqual(height, 8);\n    assert.strictEqual(trimOffsetTop, 0);\n    assert.strictEqual(trimOffsetLeft, -12);\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Ensure trim of image with all pixels same is no-op","suites":["Trim borders"],"updatePoint":{"line":164,"column":56,"index":5059},"line":164,"code":"  it('Ensure trim of image with all pixels same is no-op', async () => {\n    const {\n      info\n    } = await sharp({\n      create: {\n        width: 5,\n        height: 5,\n        channels: 3,\n        background: 'red'\n      }\n    }).trim().toBuffer({\n      resolveWithObject: true\n    });\n    const {\n      width,\n      height,\n      trimOffsetTop,\n      trimOffsetLeft\n    } = info;\n    assert.strictEqual(width, 5);\n    assert.strictEqual(height, 5);\n    assert.strictEqual(trimOffsetTop, 0);\n    assert.strictEqual(trimOffsetLeft, 0);\n  });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Doesn't trim at all","suites":["Trim borders","Specific background colour"],"updatePoint":{"line":234,"column":28,"index":7120},"line":234,"code":"    it('Doesn\\'t trim at all', async () => {\n      const {\n        info\n      } = await sharp(fixtures.inputPngTrimSpecificColour).trim('yellow').toBuffer({\n        resolveWithObject: true\n      });\n      const {\n        width,\n        height,\n        trimOffsetTop,\n        trimOffsetLeft\n      } = info;\n      assert.strictEqual(width, 900);\n      assert.strictEqual(height, 600);\n      assert.strictEqual(trimOffsetTop, 0);\n      assert.strictEqual(trimOffsetLeft, 0);\n    });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Only trims the bottom","suites":["Trim borders","Specific background colour"],"updatePoint":{"line":251,"column":29,"index":7601},"line":251,"code":"    it('Only trims the bottom', async () => {\n      const {\n        info\n      } = await sharp(fixtures.inputPngTrimSpecificColour).trim('#21468B').toBuffer({\n        resolveWithObject: true\n      });\n      const {\n        width,\n        height,\n        trimOffsetTop,\n        trimOffsetLeft\n      } = info;\n      assert.strictEqual(width, 900);\n      assert.strictEqual(height, 401);\n      assert.strictEqual(trimOffsetTop, 0);\n      assert.strictEqual(trimOffsetLeft, 0);\n    });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Only trims the bottom, in 16-bit","suites":["Trim borders","Specific background colour"],"updatePoint":{"line":268,"column":40,"index":8094},"line":268,"code":"    it('Only trims the bottom, in 16-bit', async () => {\n      const {\n        info\n      } = await sharp(fixtures.inputPngTrimSpecificColour16bit).trim('#21468B').toBuffer({\n        resolveWithObject: true\n      });\n      const {\n        width,\n        height,\n        trimOffsetTop,\n        trimOffsetLeft\n      } = info;\n      assert.strictEqual(width, 900);\n      assert.strictEqual(height, 401);\n      assert.strictEqual(trimOffsetTop, 0);\n      assert.strictEqual(trimOffsetLeft, 0);\n    });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"Only trims the bottom, including alpha","suites":["Trim borders","Specific background colour"],"updatePoint":{"line":285,"column":46,"index":8598},"line":285,"code":"    it('Only trims the bottom, including alpha', async () => {\n      const {\n        info\n      } = await sharp(fixtures.inputPngTrimSpecificColourIncludeAlpha).trim('#21468B80').toBuffer({\n        resolveWithObject: true\n      });\n      const {\n        width,\n        height,\n        trimOffsetTop,\n        trimOffsetLeft\n      } = info;\n      assert.strictEqual(width, 900);\n      assert.strictEqual(height, 401);\n      assert.strictEqual(trimOffsetTop, 0);\n      assert.strictEqual(trimOffsetLeft, 0);\n    });","file":"unit/trim.js","skipped":false,"dir":"test"},{"name":"unflatten white background","suites":["Unflatten"],"updatePoint":{"line":9,"column":32,"index":242},"line":9,"code":"  it('unflatten white background', function (done) {\n    sharp(fixtures.inputPng).unflatten().toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('unflatten-white-transparent.png'), data, {\n        threshold: 0\n      }, done);\n    });\n  });","file":"unit/unflatten.js","skipped":false,"dir":"test"},{"name":"unflatten transparent image","suites":["Unflatten"],"updatePoint":{"line":17,"column":33,"index":537},"line":17,"code":"  it('unflatten transparent image', function (done) {\n    sharp(fixtures.inputPngTrimSpecificColourIncludeAlpha).unflatten().toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('unflatten-flag-white-transparent.png'), data, {\n        threshold: 0\n      }, done);\n    });\n  });","file":"unit/unflatten.js","skipped":false,"dir":"test"},{"name":"unflatten using threshold","suites":["Unflatten"],"updatePoint":{"line":25,"column":31,"index":865},"line":25,"code":"  it('unflatten using threshold', function (done) {\n    sharp(fixtures.inputPngPalette).unflatten().threshold(128, {\n      grayscale: false\n    }).toBuffer(function (err, data) {\n      if (err) throw err;\n      fixtures.assertSimilar(fixtures.expected('unflatten-swiss.png'), data, {\n        threshold: 1\n      }, done);\n    });\n  });","file":"unit/unflatten.js","skipped":false,"dir":"test"},{"name":"Can be disabled","suites":["Utilities","Cache"],"updatePoint":{"line":11,"column":23,"index":294},"line":11,"code":"    it('Can be disabled', function () {\n      sharp.cache(false);\n      const cache = sharp.cache(false);\n      assert.strictEqual(cache.memory.current, 0);\n      assert.strictEqual(cache.memory.max, 0);\n      assert.strictEqual(typeof cache.memory.high, 'number');\n      assert.strictEqual(cache.files.current, 0);\n      assert.strictEqual(cache.files.max, 0);\n      assert.strictEqual(cache.items.current, 0);\n      assert.strictEqual(cache.items.max, 0);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can be enabled with defaults","suites":["Utilities","Cache"],"updatePoint":{"line":22,"column":36,"index":773},"line":22,"code":"    it('Can be enabled with defaults', function () {\n      const cache = sharp.cache(true);\n      assert.strictEqual(cache.memory.max, 50);\n      assert.strictEqual(cache.files.max, 20);\n      assert.strictEqual(cache.items.max, 100);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can be set to zero","suites":["Utilities","Cache"],"updatePoint":{"line":28,"column":26,"index":1006},"line":28,"code":"    it('Can be set to zero', function () {\n      const cache = sharp.cache({\n        memory: 0,\n        files: 0,\n        items: 0\n      });\n      assert.strictEqual(cache.memory.max, 0);\n      assert.strictEqual(cache.files.max, 0);\n      assert.strictEqual(cache.items.max, 0);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can be set to a maximum of 10MB, 100 files and 1000 items","suites":["Utilities","Cache"],"updatePoint":{"line":38,"column":65,"index":1333},"line":38,"code":"    it('Can be set to a maximum of 10MB, 100 files and 1000 items', function () {\n      const cache = sharp.cache({\n        memory: 10,\n        files: 100,\n        items: 1000\n      });\n      assert.strictEqual(cache.memory.max, 10);\n      assert.strictEqual(cache.files.max, 100);\n      assert.strictEqual(cache.items.max, 1000);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Ignores invalid values","suites":["Utilities","Cache"],"updatePoint":{"line":48,"column":30,"index":1637},"line":48,"code":"    it('Ignores invalid values', function () {\n      sharp.cache(true);\n      const cache = sharp.cache('spoons');\n      assert.strictEqual(cache.memory.max, 50);\n      assert.strictEqual(cache.files.max, 20);\n      assert.strictEqual(cache.items.max, 100);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can be set to use 16 threads","suites":["Utilities","Concurrency"],"updatePoint":{"line":57,"column":36,"index":1955},"line":57,"code":"    it('Can be set to use 16 threads', function () {\n      sharp.concurrency(16);\n      assert.strictEqual(16, sharp.concurrency());\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can be reset to default","suites":["Utilities","Concurrency"],"updatePoint":{"line":61,"column":31,"index":2091},"line":61,"code":"    it('Can be reset to default', function () {\n      sharp.concurrency(0);\n      assert.strictEqual(true, sharp.concurrency() > 0);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Ignores invalid values","suites":["Utilities","Concurrency"],"updatePoint":{"line":65,"column":30,"index":2231},"line":65,"code":"    it('Ignores invalid values', function () {\n      const defaultConcurrency = sharp.concurrency();\n      sharp.concurrency('spoons');\n      assert.strictEqual(defaultConcurrency, sharp.concurrency());\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Have zero value at rest","suites":["Utilities","Counters"],"updatePoint":{"line":72,"column":31,"index":2486},"line":72,"code":"    it('Have zero value at rest', done => {\n      queueMicrotask(() => {\n        const counters = sharp.counters();\n        assert.strictEqual(0, counters.queue);\n        assert.strictEqual(0, counters.process);\n        done();\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can get current state","suites":["Utilities","SIMD"],"updatePoint":{"line":82,"column":29,"index":2769},"line":82,"code":"    it('Can get current state', function () {\n      const simd = sharp.simd();\n      assert.strictEqual(typeof simd, 'boolean');\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can disable","suites":["Utilities","SIMD"],"updatePoint":{"line":86,"column":19,"index":2896},"line":86,"code":"    it('Can disable', function () {\n      const simd = sharp.simd(false);\n      assert.strictEqual(simd, false);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can attempt to enable","suites":["Utilities","SIMD"],"updatePoint":{"line":90,"column":29,"index":3027},"line":90,"code":"    it('Can attempt to enable', function () {\n      const simd = sharp.simd(true);\n      assert.strictEqual(typeof simd, 'boolean');\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Contains expected attributes","suites":["Utilities","Format"],"updatePoint":{"line":96,"column":36,"index":3216},"line":96,"code":"    it('Contains expected attributes', function () {\n      assert.strictEqual('object', typeof sharp.format);\n      Object.keys(sharp.format).forEach(function (format) {\n        assert.strictEqual(true, 'id' in sharp.format[format]);\n        assert.strictEqual(format, sharp.format[format].id);\n        ['input', 'output'].forEach(function (direction) {\n          assert.strictEqual(true, direction in sharp.format[format]);\n          assert.strictEqual('object', typeof sharp.format[format][direction]);\n          assert.strictEqual(true, [3, 4].includes(Object.keys(sharp.format[format][direction]).length));\n          assert.strictEqual(true, 'file' in sharp.format[format][direction]);\n          assert.strictEqual(true, 'buffer' in sharp.format[format][direction]);\n          assert.strictEqual(true, 'stream' in sharp.format[format][direction]);\n          assert.strictEqual('boolean', typeof sharp.format[format][direction].file);\n          assert.strictEqual('boolean', typeof sharp.format[format][direction].buffer);\n          assert.strictEqual('boolean', typeof sharp.format[format][direction].stream);\n        });\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Raw file=false, buffer=true, stream=true","suites":["Utilities","Format"],"updatePoint":{"line":114,"column":48,"index":4372},"line":114,"code":"    it('Raw file=false, buffer=true, stream=true', function () {\n      ['input', 'output'].forEach(function (direction) {\n        assert.strictEqual(false, sharp.format.raw[direction].file);\n        assert.strictEqual(true, sharp.format.raw[direction].buffer);\n        assert.strictEqual(true, sharp.format.raw[direction].stream);\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"vips format supports filesystem only","suites":["Utilities","Format"],"updatePoint":{"line":121,"column":44,"index":4717},"line":121,"code":"    it('vips format supports filesystem only', function () {\n      ['input', 'output'].forEach(function (direction) {\n        assert.strictEqual(true, sharp.format.vips[direction].file);\n        assert.strictEqual(false, sharp.format.vips[direction].buffer);\n        assert.strictEqual(false, sharp.format.vips[direction].stream);\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"input fileSuffix","suites":["Utilities","Format"],"updatePoint":{"line":128,"column":24,"index":5046},"line":128,"code":"    it('input fileSuffix', function () {\n      assert.deepStrictEqual(['.jpg', '.jpeg', '.jpe'], sharp.format.jpeg.input.fileSuffix);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"output alias","suites":["Utilities","Format"],"updatePoint":{"line":131,"column":20,"index":5184},"line":131,"code":"    it('output alias', function () {\n      assert.deepStrictEqual(['jpe', 'jpg'], sharp.format.jpeg.output.alias);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Contains expected attributes","suites":["Utilities","Versions"],"updatePoint":{"line":136,"column":36,"index":5366},"line":136,"code":"    it('Contains expected attributes', function () {\n      assert.strictEqual('object', typeof sharp.versions);\n      assert(semver.valid(sharp.versions.vips));\n      assert(semver.valid(sharp.versions.sharp));\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Contains expected attributes","suites":["Utilities","Vendor"],"updatePoint":{"line":143,"column":36,"index":5626},"line":143,"code":"    it('Contains expected attributes', function () {\n      assert.strictEqual('object', typeof sharp.vendor);\n      assert.strictEqual('string', typeof sharp.vendor.current);\n      assert.strictEqual(true, Array.isArray(sharp.vendor.installed));\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can block a named operation","suites":["Utilities","Block"],"updatePoint":{"line":150,"column":35,"index":5913},"line":150,"code":"    it('Can block a named operation', () => {\n      sharp.block({\n        operation: ['test']\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Can unblock a named operation","suites":["Utilities","Block"],"updatePoint":{"line":155,"column":37,"index":6027},"line":155,"code":"    it('Can unblock a named operation', () => {\n      sharp.unblock({\n        operation: ['test']\n      });\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Invalid block operation throws","suites":["Utilities","Block"],"updatePoint":{"line":160,"column":38,"index":6144},"line":160,"code":"    it('Invalid block operation throws', () => {\n      assert.throws(() => sharp.block(1), /Expected object for options but received 1 of type number/);\n      assert.throws(() => sharp.block({}), /Expected Array<string> for operation but received undefined of type undefined/);\n      assert.throws(() => sharp.block({\n        operation: 'fail'\n      }), /Expected Array<string> for operation but received fail of type string/);\n      assert.throws(() => sharp.block({\n        operation: ['maybe', false]\n      }), /Expected Array<string> for operation but received maybe,false of type object/);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"Invalid unblock operation throws","suites":["Utilities","Block"],"updatePoint":{"line":170,"column":40,"index":6749},"line":170,"code":"    it('Invalid unblock operation throws', () => {\n      assert.throws(() => sharp.unblock(1), /Expected object for options but received 1 of type number/);\n      assert.throws(() => sharp.unblock({}), /Expected Array<string> for operation but received undefined of type undefined/);\n      assert.throws(() => sharp.unblock({\n        operation: 'fail'\n      }), /Expected Array<string> for operation but received fail of type string/);\n      assert.throws(() => sharp.unblock({\n        operation: ['maybe', false]\n      }), /Expected Array<string> for operation but received maybe,false of type object/);\n    });","file":"unit/util.js","skipped":false,"dir":"test"},{"name":"WebP output","suites":["WebP"],"updatePoint":{"line":11,"column":17,"index":282},"line":11,"code":"  it('WebP output', function (done) {\n    sharp(fixtures.inputJpg).resize(320, 240).toFormat(sharp.format.webp).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      assert.strictEqual(320, info.width);\n      assert.strictEqual(240, info.height);\n      done();\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"Invalid WebP quality throws error","suites":["WebP"],"updatePoint":{"line":21,"column":39,"index":691},"line":21,"code":"  it('Invalid WebP quality throws error', function () {\n    assert.throws(function () {\n      sharp().webp({\n        quality: 101\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"Invalid WebP alpha quality throws error","suites":["WebP"],"updatePoint":{"line":28,"column":45,"index":851},"line":28,"code":"  it('Invalid WebP alpha quality throws error', function () {\n    assert.throws(function () {\n      sharp().webp({\n        alphaQuality: 101\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should work for webp alpha quality","suites":["WebP"],"updatePoint":{"line":35,"column":40,"index":1011},"line":35,"code":"  it('should work for webp alpha quality', function (done) {\n    sharp(fixtures.inputPngAlphaPremultiplicationSmall).webp({\n      alphaQuality: 80,\n      effort: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      fixtures.assertSimilar(fixtures.expected('webp-alpha-80.webp'), data, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should work for webp lossless","suites":["WebP"],"updatePoint":{"line":46,"column":35,"index":1434},"line":46,"code":"  it('should work for webp lossless', function (done) {\n    sharp(fixtures.inputPngAlphaPremultiplicationSmall).webp({\n      lossless: true,\n      effort: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      fixtures.assertSimilar(fixtures.expected('webp-lossless.webp'), data, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should work for webp near-lossless","suites":["WebP"],"updatePoint":{"line":57,"column":40,"index":1860},"line":57,"code":"  it('should work for webp near-lossless', function (done) {\n    sharp(fixtures.inputPngAlphaPremultiplicationSmall).webp({\n      nearLossless: true,\n      quality: 50,\n      effort: 0\n    }).toBuffer(function (err50, data50, info50) {\n      if (err50) throw err50;\n      assert.strictEqual(true, data50.length > 0);\n      assert.strictEqual('webp', info50.format);\n      fixtures.assertSimilar(fixtures.expected('webp-near-lossless-50.webp'), data50, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should use near-lossless when both lossless and nearLossless are specified","suites":["WebP"],"updatePoint":{"line":69,"column":80,"index":2373},"line":69,"code":"  it('should use near-lossless when both lossless and nearLossless are specified', function (done) {\n    sharp(fixtures.inputPngAlphaPremultiplicationSmall).webp({\n      nearLossless: true,\n      quality: 50,\n      lossless: true,\n      effort: 0\n    }).toBuffer(function (err50, data50, info50) {\n      if (err50) throw err50;\n      assert.strictEqual(true, data50.length > 0);\n      assert.strictEqual('webp', info50.format);\n      fixtures.assertSimilar(fixtures.expected('webp-near-lossless-50.webp'), data50, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should produce a larger file size using smartSubsample","suites":["WebP"],"updatePoint":{"line":82,"column":60,"index":2888},"line":82,"code":"  it('should produce a larger file size using smartSubsample', () => sharp(fixtures.inputJpg).resize(320, 240).webp({\n    smartSubsample: false\n  }).toBuffer().then(withoutSmartSubsample => sharp(fixtures.inputJpg).resize(320, 240).webp({\n    smartSubsample: true\n  }).toBuffer().then(withSmartSubsample => {\n    assert.strictEqual(true, withSmartSubsample.length > withoutSmartSubsample.length);\n  })));","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid smartSubsample throws","suites":["WebP"],"updatePoint":{"line":89,"column":35,"index":3268},"line":89,"code":"  it('invalid smartSubsample throws', () => {\n    assert.throws(() => {\n      sharp().webp({\n        smartSubsample: 1\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should produce a different file size with specific preset","suites":["WebP"],"updatePoint":{"line":96,"column":63,"index":3439},"line":96,"code":"  it('should produce a different file size with specific preset', () => sharp(fixtures.inputJpg).resize(320, 240).webp({\n    preset: 'default'\n  }).toBuffer().then(presetDefault => sharp(fixtures.inputJpg).resize(320, 240).webp({\n    preset: 'picture'\n  }).toBuffer().then(presetPicture => {\n    assert.notStrictEqual(presetDefault.length, presetPicture.length);\n  })));","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid preset throws","suites":["WebP"],"updatePoint":{"line":103,"column":27,"index":3774},"line":103,"code":"  it('invalid preset throws', () => {\n    assert.throws(() => sharp().webp({\n      preset: 'fail'\n    }), /Expected one of: default, photo, picture, drawing, icon, text for preset but received fail of type string/);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should produce a smaller file size with increased effort","suites":["WebP"],"updatePoint":{"line":108,"column":62,"index":4031},"line":108,"code":"  it('should produce a smaller file size with increased effort', () => sharp(fixtures.inputJpg).resize(320, 240).webp().toBuffer().then(effort4 => sharp(fixtures.inputJpg).resize(320, 240).webp({\n    effort: 6\n  }).toBuffer().then(effort6 => {\n    assert.strictEqual(true, effort4.length > effort6.length);\n  })));","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should produce different file size with/out shrink-on-load","suites":["WebP"],"updatePoint":{"line":113,"column":64,"index":4348},"line":113,"code":"  it('should produce different file size with/out shrink-on-load', async () => {\n    const [shrunk, resized] = await Promise.all([sharp(fixtures.inputWebP).resize({\n      width: 16\n    }).toBuffer(), sharp(fixtures.inputWebP).resize({\n      width: 16,\n      fastShrinkOnLoad: false,\n      kernel: 'nearest'\n    }).toBuffer()]);\n    assert.notStrictEqual(shrunk.length, resized.length);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid effort throws","suites":["WebP"],"updatePoint":{"line":123,"column":27,"index":4703},"line":123,"code":"  it('invalid effort throws', () => {\n    assert.throws(() => {\n      sharp().webp({\n        effort: true\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"out of range effort throws","suites":["WebP"],"updatePoint":{"line":130,"column":32,"index":4838},"line":130,"code":"  it('out of range effort throws', () => {\n    assert.throws(() => {\n      sharp().webp({\n        effort: -1\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should set effort to 0","suites":["WebP"],"updatePoint":{"line":137,"column":28,"index":4967},"line":137,"code":"  it('should set effort to 0', () => {\n    const effort = sharp().webp({\n      effort: 0\n    }).options.webpEffort;\n    assert.strictEqual(effort, 0);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"valid minSize","suites":["WebP"],"updatePoint":{"line":143,"column":19,"index":5115},"line":143,"code":"  it('valid minSize', () => {\n    assert.doesNotThrow(() => sharp().webp({\n      minSize: true\n    }));\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid minSize throws","suites":["WebP"],"updatePoint":{"line":148,"column":28,"index":5234},"line":148,"code":"  it('invalid minSize throws', () => {\n    assert.throws(() => sharp().webp({\n      minSize: 1\n    }), /Expected boolean for webpMinSize but received 1 of type number/);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"valid mixed","suites":["WebP"],"updatePoint":{"line":153,"column":17,"index":5399},"line":153,"code":"  it('valid mixed', () => {\n    assert.doesNotThrow(() => sharp().webp({\n      mixed: true\n    }));\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid mixed throws","suites":["WebP"],"updatePoint":{"line":158,"column":26,"index":5514},"line":158,"code":"  it('invalid mixed throws', () => {\n    assert.throws(() => sharp().webp({\n      mixed: 'fail'\n    }), /Expected boolean for webpMixed but received fail of type string/);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid loop throws","suites":["WebP"],"updatePoint":{"line":163,"column":25,"index":5691},"line":163,"code":"  it('invalid loop throws', () => {\n    assert.throws(() => {\n      sharp().webp({\n        loop: -1\n      });\n    });\n    assert.throws(() => {\n      sharp().webp({\n        loop: 65536\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"invalid delay throws","suites":["WebP"],"updatePoint":{"line":175,"column":26,"index":5901},"line":175,"code":"  it('invalid delay throws', () => {\n    assert.throws(() => {\n      sharp().webp({\n        delay: -1\n      });\n    });\n    assert.throws(() => {\n      sharp().webp({\n        delay: [65536]\n      });\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should repeat a single delay for all frames","suites":["WebP"],"updatePoint":{"line":187,"column":49,"index":6138},"line":187,"code":"  it('should repeat a single delay for all frames', async () => {\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).webp({\n      delay: 100\n    }).toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.deepStrictEqual(updated.delay, Array(updated.pages).fill(100));\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should limit animation loop","suites":["WebP"],"updatePoint":{"line":197,"column":33,"index":6459},"line":197,"code":"  it('should limit animation loop', async () => {\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).webp({\n      loop: 3\n    }).toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.strictEqual(updated.loop, 3);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should change delay between frames","suites":["WebP"],"updatePoint":{"line":207,"column":40,"index":6750},"line":207,"code":"  it('should change delay between frames', async () => {\n    const original = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).metadata();\n    const expectedDelay = [...Array(original.pages).fill(40)];\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).webp({\n      delay: expectedDelay\n    }).toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.deepStrictEqual(updated.delay, expectedDelay);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should preserve delay between frames","suites":["WebP"],"updatePoint":{"line":221,"column":42,"index":7234},"line":221,"code":"  it('should preserve delay between frames', async () => {\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).webp().toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.deepStrictEqual(updated.delay, [120, 120, 90, 120, 120, 90, 120, 90, 30]);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should work with streams when only animated is set","suites":["WebP"],"updatePoint":{"line":229,"column":56,"index":7565},"line":229,"code":"  it('should work with streams when only animated is set', function (done) {\n    fs.createReadStream(fixtures.inputWebPAnimated).pipe(sharp({\n      animated: true\n    })).webp({\n      lossless: true,\n      effort: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      fixtures.assertSimilar(fixtures.inputWebPAnimated, data, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should work with streams when only pages is set","suites":["WebP"],"updatePoint":{"line":242,"column":53,"index":8029},"line":242,"code":"  it('should work with streams when only pages is set', function (done) {\n    fs.createReadStream(fixtures.inputWebPAnimated).pipe(sharp({\n      pages: -1\n    })).webp({\n      lossless: true,\n      effort: 0\n    }).toBuffer(function (err, data, info) {\n      if (err) throw err;\n      assert.strictEqual(true, data.length > 0);\n      assert.strictEqual('webp', info.format);\n      fixtures.assertSimilar(fixtures.inputWebPAnimated, data, done);\n    });\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should resize animated image to page height","suites":["WebP"],"updatePoint":{"line":255,"column":49,"index":8484},"line":255,"code":"  it('should resize animated image to page height', async () => {\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      pages: -1\n    }).resize({\n      height: 570\n    }).webp({\n      effort: 0\n    }).toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.strictEqual(updated.height, 570 * 9);\n    assert.strictEqual(updated.pageHeight, 570);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"},{"name":"should take page parameter into account when animated is set","suites":["WebP"],"updatePoint":{"line":268,"column":66,"index":8894},"line":268,"code":"  it('should take page parameter into account when animated is set', async () => {\n    const updated = await sharp(fixtures.inputWebPAnimated, {\n      animated: true,\n      page: 2\n    }).resize({\n      height: 570\n    }).webp({\n      effort: 0\n    }).toBuffer().then(data => sharp(data, {\n      pages: -1\n    }).metadata());\n    assert.strictEqual(updated.height, 570 * 7);\n    assert.strictEqual(updated.pageHeight, 570);\n  });","file":"unit/webp.js","skipped":false,"dir":"test"}]}