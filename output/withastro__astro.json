{"repo":"withastro/astro","url":"https://github.com/withastro/astro","branch":"main","configs":[{"package":"astro","lang":"js","dir":"packages/astro/test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"},{"package":"create-astro","lang":"js","dir":"packages/create-astro/test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"HTML and CSS scoped correctly","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":36,"column":39,"index":1211},"line":36,"code":"      it('HTML and CSS scoped correctly', async () => {\n        const el1 = $('#dynamic-class');\n        const el2 = $('#dynamic-vis');\n        const classes = $('#class').attr('class').split(' ');\n        const scopedClass = classes.find(name => /^astro-[A-Za-z0-9-]+/.test(name));\n\n        // 1. check HTML\n        expect(el1.attr('class')).to.equal(`blue ${scopedClass}`);\n        expect(el2.attr('class')).to.equal(`visible ${scopedClass}`);\n\n        // 2. check CSS\n        const expected = `.blue:where(.${scopedClass}){color:#b0e0e6}.color\\\\:blue:where(.${scopedClass}){color:#b0e0e6}.visible:where(.${scopedClass}){display:block}`;\n        expect(bundledCSS).to.include(expected);\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Generated link tags are void elements","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":50,"column":47,"index":1918},"line":50,"code":"      it('Generated link tags are void elements', async () => {\n        expect(html).to.not.include('</link>');\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"No <style> skips scoping","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":53,"column":34,"index":2027},"line":53,"code":"      it('No <style> skips scoping', async () => {\n        // Astro component without <style> should not include scoped class\n        expect($('#no-scope').attr('class')).to.equal(undefined);\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Child inheritance","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":57,"column":27,"index":2222},"line":57,"code":"      it('Child inheritance', async () => {\n        expect($('#passed-in').attr('class')).to.match(/outer astro-[A-Z0-9]+ astro-[A-Z0-9]+/);\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using hydrated components adds astro-island styles","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":60,"column":60,"index":2406},"line":60,"code":"      it('Using hydrated components adds astro-island styles', async () => {\n        const inline = $('style').html();\n        expect(inline).to.include('display:contents');\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"sass\">","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":64,"column":29,"index":2559},"line":64,"code":"      it('<style lang=\"sass\">', async () => {\n        expect(bundledCSS).to.match(new RegExp('h1\\\\:where\\\\(.astro-[^{]*{color:#90ee90}'));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"scss\">","suites":["CSS","build","Astro Styles"],"updatePoint":{"line":67,"column":29,"index":2708},"line":67,"code":"      it('<style lang=\"scss\">', async () => {\n        expect(bundledCSS).to.match(new RegExp('h1\\\\:where\\\\(.astro-[^{]*{color:#ff69b4}'));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".css","suites":["CSS","build","Styles in src/"],"updatePoint":{"line":72,"column":14,"index":2889},"line":72,"code":"      it('.css', async () => {\n        expect(bundledCSS).to.match(new RegExp('.linked-css[^{]*{color:gold'));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".sass","suites":["CSS","build","Styles in src/"],"updatePoint":{"line":75,"column":15,"index":3011},"line":75,"code":"      it('.sass', async () => {\n        expect(bundledCSS).to.match(new RegExp('.linked-sass[^{]*{color:#789'));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".scss","suites":["CSS","build","Styles in src/"],"updatePoint":{"line":78,"column":15,"index":3134},"line":78,"code":"      it('.scss', async () => {\n        expect(bundledCSS).to.match(new RegExp('.linked-scss[^{]*{color:#6b8e23'));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".css","suites":["CSS","build","JSX"],"updatePoint":{"line":83,"column":14,"index":3295},"line":83,"code":"      it('.css', async () => {\n        const el = $('#react-css');\n        // 1. check HTML\n        expect(el.attr('class')).to.include('react-title');\n        // 2. check CSS\n        expect(bundledCSS).to.include('.react-title');\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".module.css","suites":["CSS","build","JSX"],"updatePoint":{"line":90,"column":21,"index":3543},"line":90,"code":"      it('.module.css', async () => {\n        const el = $('#react-module-css');\n        const classes = el.attr('class').split(' ');\n        const moduleClass = classes.find(name => /^_title_[A-Za-z0-9-_]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include(moduleClass);\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.${moduleClass}[^{]*{font-family:fantasy`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".sass","suites":["CSS","build","JSX"],"updatePoint":{"line":101,"column":15,"index":3970},"line":101,"code":"      it('.sass', async () => {\n        const el = $('#react-sass');\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('react-sass-title');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.react-sass-title[^{]*{font-family:fantasy`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".scss","suites":["CSS","build","JSX"],"updatePoint":{"line":110,"column":15,"index":4260},"line":110,"code":"      it('.scss', async () => {\n        const el = $('#react-scss');\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('react-scss-title');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.react-scss-title[^{]*{font-family:fantasy`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".module.sass","suites":["CSS","build","JSX"],"updatePoint":{"line":119,"column":22,"index":4557},"line":119,"code":"      it('.module.sass', async () => {\n        const el = $('#react-module-sass');\n        const classes = el.attr('class').split(' ');\n        const moduleClass = classes.find(name => /^_title_[A-Za-z0-9-_]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include(moduleClass);\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.${moduleClass}[^{]*{font-family:fantasy`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".module.scss","suites":["CSS","build","JSX"],"updatePoint":{"line":130,"column":22,"index":4992},"line":130,"code":"      it('.module.scss', async () => {\n        const el = $('#react-module-scss');\n        const classes = el.attr('class').split(' ');\n        const moduleClass = classes.find(name => /^_title_[A-Za-z0-9-_]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include(moduleClass);\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.${moduleClass}[^{]*{font-family:fantasy`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style>","suites":["CSS","build","Vue"],"updatePoint":{"line":143,"column":17,"index":5458},"line":143,"code":"      it('<style>', async () => {\n        const el = $('#vue-css');\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('vue-css');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.vue-css[^{]*{font-family:cursive`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style scoped>","suites":["CSS","build","Vue"],"updatePoint":{"line":152,"column":24,"index":5736},"line":152,"code":"      it('<style scoped>', async () => {\n        const el = $('#vue-scoped');\n\n        // find data-v-* attribute (how Vue CSS scoping works)\n        const {\n          attribs\n        } = el.get(0);\n        const scopeId = Object.keys(attribs).find(k => k.startsWith('data-v-'));\n        expect(scopeId).to.be.ok;\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('vue-scoped');\n\n        // 2. check CSS\n        expect(bundledCSS).to.include(`.vue-scoped[${scopeId}]`);\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style module>","suites":["CSS","build","Vue"],"updatePoint":{"line":168,"column":24,"index":6236},"line":168,"code":"      it('<style module>', async () => {\n        const el = $('#vue-modules');\n        const classes = el.attr('class').split(' ');\n        const moduleClass = classes.find(name => /^_title_[A-Za-z0-9-_]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include(moduleClass);\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.${moduleClass}[^{]*{font-family:cursive`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"sass\">","suites":["CSS","build","Vue"],"updatePoint":{"line":179,"column":29,"index":6672},"line":179,"code":"      it('<style lang=\"sass\">', async () => {\n        const el = $('#vue-sass');\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('vue-sass');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.vue-sass[^{]*{font-family:cursive`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"scss\">","suites":["CSS","build","Vue"],"updatePoint":{"line":188,"column":29,"index":6958},"line":188,"code":"      it('<style lang=\"scss\">', async () => {\n        const el = $('#vue-scss');\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('vue-scss');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.vue-scss[^{]*{font-family:cursive`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style>","suites":["CSS","build","Svelte"],"updatePoint":{"line":199,"column":17,"index":7271},"line":199,"code":"      it('<style>', async () => {\n        const el = $('#svelte-css');\n        const classes = el.attr('class').split(' ');\n        const scopedClass = classes.find(name => name !== 'svelte-css' && /^svelte-[A-Za-z0-9-]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('svelte-css');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.svelte-css.${scopedClass}[^{]*{font-family:ComicSansMS`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"sass\">","suites":["CSS","build","Svelte"],"updatePoint":{"line":210,"column":29,"index":7746},"line":210,"code":"      it('<style lang=\"sass\">', async () => {\n        const el = $('#svelte-sass');\n        const classes = el.attr('class').split(' ');\n        const scopedClass = classes.find(name => name !== 'svelte-sass' && /^svelte-[A-Za-z0-9-]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('svelte-sass');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.svelte-sass.${scopedClass}[^{]*{font-family:ComicSansMS`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<style lang=\"scss\">","suites":["CSS","build","Svelte"],"updatePoint":{"line":221,"column":29,"index":8225},"line":221,"code":"      it('<style lang=\"scss\">', async () => {\n        const el = $('#svelte-scss');\n        const classes = el.attr('class').split(' ');\n        const scopedClass = classes.find(name => name !== 'svelte-scss' && /^svelte-[A-Za-z0-9-]+/.test(name));\n\n        // 1. check HTML\n        expect(el.attr('class')).to.include('svelte-scss');\n\n        // 2. check CSS\n        expect(bundledCSS).to.match(new RegExp(`.svelte-scss.${scopedClass}[^{]*{font-family:ComicSansMS`));\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".css?raw return a string","suites":["CSS","build","Vite features"],"updatePoint":{"line":234,"column":34,"index":8755},"line":234,"code":"      it('.css?raw return a string', () => {\n        const el = $('#css-raw');\n        expect(el.text()).to.equal('.foo {color: red;}');\n      });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves CSS in public/","suites":["CSS","dev"],"updatePoint":{"line":253,"column":31,"index":9313},"line":253,"code":"    it('resolves CSS in public/', async () => {\n      const href = $('link[href=\"/global.css\"]').attr('href');\n      expect((await fixture.fetch(href)).status).to.equal(200);\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolved imported CSS with ?url","suites":["CSS","dev"],"line":262,"code":"    it.skip('resolved imported CSS with ?url', async () => {","file":"0-css.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"resolves ESM style imports","suites":["CSS","dev"],"updatePoint":{"line":267,"column":34,"index":9954},"line":267,"code":"    it('resolves ESM style imports', async () => {\n      const allInjectedStyles = $('style').text().replace(/\\s*/g, '');\n      expect(allInjectedStyles, 'styles/imported-url.css').to.contain('.imported{');\n      expect(allInjectedStyles, 'styles/imported-url.sass').to.contain('.imported-sass{');\n      expect(allInjectedStyles, 'styles/imported-url.scss').to.contain('.imported-scss{');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves Astro styles","suites":["CSS","dev"],"updatePoint":{"line":273,"column":29,"index":10346},"line":273,"code":"    it('resolves Astro styles', async () => {\n      const allInjectedStyles = $('style').text();\n      expect(allInjectedStyles).to.contain('.linked-css:where(.astro-');\n      expect(allInjectedStyles).to.contain('.linked-sass:where(.astro-');\n      expect(allInjectedStyles).to.contain('.linked-scss:where(.astro-');\n      expect(allInjectedStyles).to.contain('.wrapper:where(.astro-');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves Styles from React","suites":["CSS","dev"],"updatePoint":{"line":280,"column":34,"index":10747},"line":280,"code":"    it('resolves Styles from React', async () => {\n      const styles = ['ReactModules.module.css', 'ReactModules.module.scss', 'ReactModules.module.sass'];\n      for (const style of styles) {\n        const href = $(`link[href$=\"${style}\"]`).attr('href');\n        expect((await fixture.fetch(href)).status, style).to.equal(200);\n      }\n      const allInjectedStyles = $('style').text().replace(/\\s*/g, '');\n      expect(allInjectedStyles).to.contain('.react-title{');\n      expect(allInjectedStyles).to.contain('.react-sass-title{');\n      expect(allInjectedStyles).to.contain('.react-scss-title{');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves CSS from Svelte","suites":["CSS","dev"],"updatePoint":{"line":291,"column":32,"index":11354},"line":291,"code":"    it('resolves CSS from Svelte', async () => {\n      const allInjectedStyles = $('style').text();\n      expect(allInjectedStyles).to.contain('.svelte-css');\n      expect(allInjectedStyles).to.contain('.svelte-sass');\n      expect(allInjectedStyles).to.contain('.svelte-scss');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves CSS from Vue","suites":["CSS","dev"],"updatePoint":{"line":297,"column":29,"index":11638},"line":297,"code":"    it('resolves CSS from Vue', async () => {\n      const styles = ['VueModules.vue?vue&type=style&index=0&lang.module.scss'];\n      for (const style of styles) {\n        const href = $(`link[href$=\"${style}\"]`).attr('href');\n        expect((await fixture.fetch(href)).status, style).to.equal(200);\n      }\n      const allInjectedStyles = $('style').text().replace(/\\s*/g, '');\n      expect(allInjectedStyles).to.contain('.vue-css{');\n      expect(allInjectedStyles).to.contain('.vue-sass{');\n      expect(allInjectedStyles).to.contain('.vue-scss{');\n      expect(allInjectedStyles).to.contain('.vue-scoped[data-v-');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"remove unused styles from client:load components","suites":["CSS","dev"],"updatePoint":{"line":309,"column":56,"index":12291},"line":309,"code":"    it('remove unused styles from client:load components', async () => {\n      const bundledAssets = await fixture.readdir('./_astro');\n      // SvelteDynamic styles is already included in the main page css asset\n      const unusedCssAsset = bundledAssets.find(asset => /SvelteDynamic\\..*\\.css/.test(asset));\n      expect(unusedCssAsset, 'Found unused style ' + unusedCssAsset).to.be.undefined;\n      let foundVitePreloadCSS = false;\n      const bundledJS = await fixture.glob('**/*.?(m)js');\n      for (const filename of bundledJS) {\n        const content = await fixture.readFile(filename);\n        if (content.match(/ReactDynamic\\..*\\.css/)) {\n          foundVitePreloadCSS = filename;\n        }\n      }\n      expect(foundVitePreloadCSS).to.equal(false, 'Should not have found a preload for the dynamic CSS');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":".css?raw return a string","suites":["CSS","dev"],"updatePoint":{"line":324,"column":32,"index":13088},"line":324,"code":"    it('.css?raw return a string', () => {\n      const el = $('#css-raw');\n      expect(el.text()).to.equal('.foo {color: red;}');\n    });","file":"0-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can load client components","suites":["Aliases with tsconfig.json","dev"],"updatePoint":{"line":20,"column":34,"index":549},"line":20,"code":"    it('can load client components', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n\n      // Should render aliased element\n      expect($('#client').text()).to.equal('test');\n      const scripts = $('script').toArray();\n      expect(scripts.length).to.be.greaterThan(0);\n    });","file":"alias-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can load client components","suites":["Aliases","dev"],"updatePoint":{"line":20,"column":34,"index":521},"line":20,"code":"    it('can load client components', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n\n      // Should render aliased element\n      expect($('#client').text()).to.equal('test');\n      const scripts = $('script').toArray();\n      expect(scripts.length).to.be.greaterThan(0);\n    });","file":"alias.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can load client components","suites":["Aliases","build"],"updatePoint":{"line":34,"column":34,"index":969},"line":34,"code":"    it('can load client components', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n\n      // Should render aliased element\n      expect($('#client').text()).to.equal('test');\n      const scripts = $('script').toArray();\n      expect(scripts.length).to.be.greaterThan(0);\n    });","file":"alias.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can use aliases and relative in same project","suites":["Aliases","build"],"updatePoint":{"line":43,"column":52,"index":1328},"line":43,"code":"    it('can use aliases and relative in same project', async () => {\n      const html = await fixture.readFile('/two/index.html');\n      const $ = cheerio.load(html);\n\n      // Should render aliased element\n      expect($('#client').text()).to.equal('test');\n      const scripts = $('script').toArray();\n      expect(scripts.length).to.be.greaterThan(0);\n    });","file":"alias.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"two argument supported","suites":["API routes","Deprecated API"],"updatePoint":{"line":13,"column":30,"index":375},"line":13,"code":"    it('two argument supported', async () => {\n      const one = JSON.parse(await fixture.readFile('/old-api/twoarg/one.json'));\n      expect(one).to.deep.equal({\n        param: 'one',\n        pathname: '/old-api/twoarg/one.json'\n      });\n      const two = JSON.parse(await fixture.readFile('/old-api/twoarg/two.json'));\n      expect(two).to.deep.equal({\n        param: 'two',\n        pathname: '/old-api/twoarg/two.json'\n      });\n    });","file":"api-routes.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"param first argument is supported","suites":["API routes","Deprecated API"],"updatePoint":{"line":25,"column":41,"index":827},"line":25,"code":"    it('param first argument is supported', async () => {\n      const one = JSON.parse(await fixture.readFile('/old-api/onearg/one.json'));\n      expect(one).to.deep.equal({\n        param: 'one'\n      });\n    });","file":"api-routes.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Receives a context argument","suites":["API routes","1.0 API"],"updatePoint":{"line":33,"column":35,"index":1070},"line":33,"code":"    it('Receives a context argument', async () => {\n      const one = JSON.parse(await fixture.readFile('/context/data/one.json'));\n      expect(one).to.deep.equal({\n        param: 'one',\n        pathname: '/context/data/one.json'\n      });\n    });","file":"api-routes.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be returned from a response","suites":["API routes","Binary data"],"updatePoint":{"line":42,"column":39,"index":1363},"line":42,"code":"    it('can be returned from a response', async () => {\n      const dat = await fixture.readFile('/binary.dat', null);\n      expect(dat.length).to.equal(1);\n      expect(dat[0]).to.equal(0xff);\n    });","file":"api-routes.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not include the site's subpath","suites":["Asset URL resolution in build","With site and base","with site"],"updatePoint":{"line":16,"column":45,"index":565},"line":16,"code":"      it(\"does not include the site's subpath\", async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        const href = $('link[rel=stylesheet]').attr('href');\n        expect(href.startsWith('/sub/path/')).to.equal(false);\n      });","file":"asset-url-base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not include the site's subpath","suites":["Asset URL resolution in build","With site and base","with site and base"],"updatePoint":{"line":32,"column":45,"index":1155},"line":32,"code":"      it(\"does not include the site's subpath\", async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        const href = $('link[rel=stylesheet]').attr('href');\n        expect(href.startsWith('/sub/path/')).to.equal(false);\n      });","file":"asset-url-base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does include the base subpath","suites":["Asset URL resolution in build","With site and base","with site and base"],"updatePoint":{"line":38,"column":39,"index":1443},"line":38,"code":"      it('does include the base subpath', async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        const href = $('link[rel=stylesheet]').attr('href');\n        expect(href.startsWith('/another/base/')).to.equal(true);\n      });","file":"asset-url-base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"built the base image","suites":["Assets"],"updatePoint":{"line":18,"column":26,"index":474},"line":18,"code":"  it('built the base image', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const imgPath = $('img').attr('src');\n    const data = await fixture.readFile(imgPath);\n    expect(!!data).to.equal(true);\n  });","file":"astro-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"built the 2x image","suites":["Assets"],"updatePoint":{"line":25,"column":24,"index":738},"line":25,"code":"  it('built the 2x image', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const srcset = $('img').attr('srcset');\n    const candidates = matchSrcset(srcset);\n    const match = candidates.find(a => a.density === 2);\n    const data = await fixture.readFile(match.url);\n    expect(!!data).to.equal(true);\n  });","file":"astro-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"built the 3x image","suites":["Assets"],"updatePoint":{"line":34,"column":24,"index":1107},"line":34,"code":"  it('built the 3x image', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const srcset = $('img').attr('srcset');\n    const candidates = matchSrcset(srcset);\n    const match = candidates.find(a => a.density === 3);\n    const data = await fixture.readFile(match.url);\n    expect(!!data).to.equal(true);\n  });","file":"astro-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"built image from an import specifier","suites":["Assets"],"updatePoint":{"line":43,"column":42,"index":1494},"line":43,"code":"  it('built image from an import specifier', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const src = $('#import-no-url').attr('src');\n    const data = await fixture.readFile(src);\n    expect(!!data).to.equal(true);\n  });","file":"astro-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"built image from an import specifier using ?url","suites":["Assets"],"updatePoint":{"line":50,"column":53,"index":1790},"line":50,"code":"  it('built image from an import specifier using ?url', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const src = $('#import-url').attr('src');\n    const data = await fixture.readFile(src);\n    expect(!!data).to.equal(true);\n  });","file":"astro-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes attributes to elements as expected","suites":["Attributes"],"updatePoint":{"line":12,"column":47,"index":350},"line":12,"code":"  it('Passes attributes to elements as expected', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const attrs = {\n      'false-str': {\n        attribute: 'attr',\n        value: 'false'\n      },\n      'true-str': {\n        attribute: 'attr',\n        value: 'true'\n      },\n      false: {\n        attribute: 'attr',\n        value: undefined\n      },\n      true: {\n        attribute: 'attr',\n        value: 'true'\n      },\n      empty: {\n        attribute: 'attr',\n        value: ''\n      },\n      null: {\n        attribute: 'attr',\n        value: undefined\n      },\n      undefined: {\n        attribute: 'attr',\n        value: undefined\n      },\n      'html-boolean': {\n        attribute: 'async',\n        value: 'async'\n      },\n      'html-boolean-true': {\n        attribute: 'async',\n        value: 'async'\n      },\n      'html-boolean-false': {\n        attribute: 'async',\n        value: undefined\n      },\n      'html-enum': {\n        attribute: 'draggable',\n        value: 'true'\n      },\n      'html-enum-true': {\n        attribute: 'draggable',\n        value: 'true'\n      },\n      'html-enum-false': {\n        attribute: 'draggable',\n        value: 'false'\n      }\n    };\n    for (const id of Object.keys(attrs)) {\n      const {\n        attribute,\n        value\n      } = attrs[id];\n      const attr = $(`#${id}`).attr(attribute);\n      expect(attr).to.equal(value);\n    }\n  });","file":"astro-attrs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes boolean attributes to components as expected","suites":["Attributes"],"updatePoint":{"line":78,"column":57,"index":1806},"line":78,"code":"  it('Passes boolean attributes to components as expected', async () => {\n    const html = await fixture.readFile('/component/index.html');\n    const $ = cheerio.load(html);\n    expect($('#true').attr('attr')).to.equal('attr-true');\n    expect($('#true').attr('type')).to.equal('boolean');\n    expect($('#false').attr('attr')).to.equal('attr-false');\n    expect($('#false').attr('type')).to.equal('boolean');\n  });","file":"astro-attrs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes namespaced attributes as expected","suites":["Attributes"],"updatePoint":{"line":86,"column":46,"index":2210},"line":86,"code":"  it('Passes namespaced attributes as expected', async () => {\n    const html = await fixture.readFile('/namespaced/index.html');\n    const $ = cheerio.load(html);\n    expect($('div').attr('xmlns:happy')).to.equal('https://example.com/schemas/happy');\n    expect($('img').attr('happy:smile')).to.equal('sweet');\n  });","file":"astro-attrs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes namespaced attributes to components as expected","suites":["Attributes"],"updatePoint":{"line":92,"column":60,"index":2542},"line":92,"code":"  it('Passes namespaced attributes to components as expected', async () => {\n    const html = await fixture.readFile('/namespaced-component/index.html');\n    const $ = cheerio.load(html);\n    expect($('span').attr('on:click')).to.deep.equal('(event) => console.log(event)');\n  });","file":"astro-attrs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load page","suites":["Astro basics","build"],"updatePoint":{"line":20,"column":21,"index":542},"line":20,"code":"    it('Can load page', async () => {\n      const html = await fixture.readFile(`/index.html`);\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Hello world!');\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Correctly serializes boolean attributes","suites":["Astro basics","build"],"updatePoint":{"line":25,"column":47,"index":763},"line":25,"code":"    it('Correctly serializes boolean attributes', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').attr('data-something')).to.equal('');\n      expect($('h2').attr('not-data-ok')).to.equal('');\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Selector with an empty body","suites":["Astro basics","build"],"updatePoint":{"line":31,"column":35,"index":1032},"line":31,"code":"    it('Selector with an empty body', async () => {\n      const html = await fixture.readFile('/empty-class/index.html');\n      const $ = cheerio.load(html);\n      expect($('.author')).to.have.lengthOf(1);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows forward-slashes in mustache tags (#407)","suites":["Astro basics","build"],"updatePoint":{"line":36,"column":54,"index":1265},"line":36,"code":"    it('Allows forward-slashes in mustache tags (#407)', async () => {\n      const html = await fixture.readFile('/forward-slash/index.html');\n      const $ = cheerio.load(html);\n      expect($('a[href=\"/post/one\"]')).to.have.lengthOf(1);\n      expect($('a[href=\"/post/two\"]')).to.have.lengthOf(1);\n      expect($('a[href=\"/post/three\"]')).to.have.lengthOf(1);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows spread attributes (#521)","suites":["Astro basics","build"],"updatePoint":{"line":43,"column":39,"index":1619},"line":43,"code":"    it('Allows spread attributes (#521)', async () => {\n      const html = await fixture.readFile('/spread/index.html');\n      const $ = cheerio.load(html);\n      expect($('#spread-leading')).to.have.lengthOf(1);\n      expect($('#spread-leading').attr('a')).to.equal('0');\n      expect($('#spread-leading').attr('b')).to.equal('1');\n      expect($('#spread-leading').attr('c')).to.equal('2');\n      expect($('#spread-trailing')).to.have.lengthOf(1);\n      expect($('#spread-trailing').attr('a')).to.equal('0');\n      expect($('#spread-trailing').attr('b')).to.equal('1');\n      expect($('#spread-trailing').attr('c')).to.equal('2');\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows spread attributes with TypeScript (#521)","suites":["Astro basics","build"],"updatePoint":{"line":55,"column":55,"index":2276},"line":55,"code":"    it('Allows spread attributes with TypeScript (#521)', async () => {\n      const html = await fixture.readFile('/spread/index.html');\n      const $ = cheerio.load(html);\n      expect($('#spread-ts')).to.have.lengthOf(1);\n      expect($('#spread-ts').attr('a')).to.equal('0');\n      expect($('#spread-ts').attr('b')).to.equal('1');\n      expect($('#spread-ts').attr('c')).to.equal('2');\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows scoped classes with spread","suites":["Astro basics","build"],"updatePoint":{"line":63,"column":41,"index":2659},"line":63,"code":"    it('Allows scoped classes with spread', async () => {\n      const html = await fixture.readFile('/spread-scope/index.html');\n      const $ = cheerio.load(html);\n      expect($('#spread-plain')).to.have.lengthOf(1);\n      expect($('#spread-plain').attr('class')).to.match(/astro-.*/);\n      expect($('#spread-class')).to.have.lengthOf(1);\n      expect($('#spread-class').attr('class')).to.match(/astro-.*/);\n      expect($('#spread-class-list')).to.have.lengthOf(1);\n      expect($('#spread-class-list').attr('class')).to.match(/astro-.*/);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows using the Fragment element to be used","suites":["Astro basics","build"],"updatePoint":{"line":73,"column":52,"index":3222},"line":73,"code":"    it('Allows using the Fragment element to be used', async () => {\n      const html = await fixture.readFile('/fragment/index.html');\n      const $ = cheerio.load(html);\n\n      // will be 1 if element rendered correctly\n      expect($('#one')).to.have.lengthOf(1);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"supports special chars in filename","suites":["Astro basics","build"],"updatePoint":{"line":80,"column":42,"index":3487},"line":80,"code":"    it('supports special chars in filename', async () => {\n      // will have already erred by now, but add test anyway\n      expect(await fixture.readFile('/special-“characters” -in-file/index.html')).to.be.ok;\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Supports void elements whose name is a string (#2062)","suites":["Astro basics","build"],"updatePoint":{"line":85,"column":59,"index":3730},"line":85,"code":"  it('Supports void elements whose name is a string (#2062)', async () => {\n    const html = await fixture.readFile('/input/index.html');\n    const $ = cheerio.load(html);\n\n    // <Input />\n    expect($('body > :nth-child(1)').prop('outerHTML')).to.equal('<input>');\n\n    // <Input type=\"password\" />\n    expect($('body > :nth-child(2)').prop('outerHTML')).to.equal('<input type=\"password\">');\n\n    // <Input type=\"text\" />\n    expect($('body > :nth-child(3)').prop('outerHTML')).to.equal('<input type=\"text\">');\n\n    // <Input type=\"select\"><option>option</option></Input>\n    expect($('body > :nth-child(4)').prop('outerHTML')).to.equal('<select><option>option</option></select>');\n\n    // <Input type=\"textarea\">textarea</Input>\n    expect($('body > :nth-child(5)').prop('outerHTML')).to.equal('<textarea>textarea</textarea>');\n  });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns 200 for valid URLs","suites":["Astro basics","preview"],"updatePoint":{"line":105,"column":34,"index":4572},"line":105,"code":"    it('returns 200 for valid URLs', async () => {\n      const result = await fixture.fetch('/');\n      expect(result.status).to.equal(200);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns 404 for invalid URLs","suites":["Astro basics","preview"],"updatePoint":{"line":109,"column":36,"index":4723},"line":109,"code":"    it('returns 404 for invalid URLs', async () => {\n      const result = await fixture.fetch('/bad-url');\n      expect(result.status).to.equal(404);\n    });","file":"astro-basic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes string children to framework components","suites":["Component children"],"updatePoint":{"line":12,"column":52,"index":360},"line":12,"code":"  it('Passes string children to framework components', async () => {\n    const html = await fixture.readFile('/strings/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can pass text to Preact components\n    const $preact = $('#preact');\n    expect($preact.text().trim()).to.equal('Hello world');\n\n    // test 2: Can pass text to Vue components\n    const $vue = $('#vue');\n    expect($vue.text().trim()).to.equal('Hello world');\n\n    // test 3: Can pass text to Svelte components\n    const $svelte = $('#svelte');\n    expect($svelte.text().trim()).to.equal('Hello world');\n  });","file":"astro-children.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes markup children to framework components","suites":["Component children"],"updatePoint":{"line":28,"column":52,"index":953},"line":28,"code":"  it('Passes markup children to framework components', async () => {\n    const html = await fixture.readFile('/markup/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can pass markup to Preact components\n    const $preact = $('#preact h1');\n    expect($preact.text().trim()).to.equal('Hello world');\n\n    // test 2: Can pass markup to Vue components\n    const $vue = $('#vue h1');\n    expect($vue.text().trim()).to.equal('Hello world');\n\n    // test 3: Can pass markup to Svelte components\n    const $svelte = $('#svelte h1');\n    expect($svelte.text().trim()).to.equal('Hello world');\n  });","file":"astro-children.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes multiple children to framework components","suites":["Component children"],"updatePoint":{"line":44,"column":54,"index":1562},"line":44,"code":"  it('Passes multiple children to framework components', async () => {\n    const html = await fixture.readFile('/multiple/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can pass multiple children to Preact components\n    const $preact = $('#preact');\n    expect($preact.children()).to.have.lengthOf(2);\n    expect($preact.children(':first-child').text().trim()).to.equal('Hello world');\n    expect($preact.children(':last-child').text().trim()).to.equal('Goodbye world');\n\n    // test 2: Can pass multiple children to Vue components\n    const $vue = $('#vue');\n    expect($vue.children()).to.have.lengthOf(2);\n    expect($vue.children(':first-child').text().trim()).to.equal('Hello world');\n    expect($vue.children(':last-child').text().trim()).to.equal('Goodbye world');\n\n    // test 3: Can pass multiple children to Svelte components\n    const $svelte = $('#svelte');\n    expect($svelte.children()).to.have.lengthOf(2);\n    expect($svelte.children(':first-child').text().trim()).to.equal('Hello world');\n    expect($svelte.children(':last-child').text().trim()).to.equal('Goodbye world');\n  });","file":"astro-children.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders a template when children are not rendered for client components","suites":["Component children"],"updatePoint":{"line":66,"column":77,"index":2700},"line":66,"code":"  it('Renders a template when children are not rendered for client components', async () => {\n    const html = await fixture.readFile('/no-render/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: If SSR only, no children are rendered.\n    expect($('#ssr-only').children()).to.have.lengthOf(0);\n\n    // test 2: If client, and no children are rendered, a template is.\n    expect($('#client').parent().children()).to.have.lengthOf(2, 'rendered the client component and a template');\n    expect($('#client').parent().find('template[data-astro-template]')).to.have.lengthOf(1, 'Found 1 template');\n\n    // test 3: If client, and children are rendered, no template is.\n    expect($('#client-render').parent().children()).to.have.lengthOf(1);\n    expect($('#client-render').parent().find('template')).to.have.lengthOf(0);\n\n    // test 4: If client and no children are provided, no template is.\n    expect($('#client-no-children').parent().children()).to.have.lengthOf(1);\n    expect($('#client-no-children').parent().find('template')).to.have.lengthOf(0);\n  });","file":"astro-children.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes class:list attributes as expected to elements","suites":["Class List"],"updatePoint":{"line":12,"column":58,"index":366},"line":12,"code":"  it('Passes class:list attributes as expected to elements', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('[class=\"test control\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test expression\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test true\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test truthy\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test set\"]')).to.have.lengthOf(1);\n    expect($('[class=\"hello goodbye world friend\"]')).to.have.lengthOf(1);\n    expect($('[class=\"foo baz\"]')).to.have.lengthOf(1);\n    expect($('span:not([class])')).to.have.lengthOf(1);\n    expect($('.false, .noshow1, .noshow2, .noshow3, .noshow4')).to.have.lengthOf(0);\n  });","file":"astro-class-list.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes class:list attributes as expected to components","suites":["Class List"],"updatePoint":{"line":25,"column":60,"index":1111},"line":25,"code":"  it('Passes class:list attributes as expected to components', async () => {\n    const html = await fixture.readFile('/component/index.html');\n    const $ = cheerio.load(html);\n    expect($('[class=\"test control\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test expression\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test true\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test truthy\"]')).to.have.lengthOf(1);\n    expect($('[class=\"test set\"]')).to.have.lengthOf(1);\n    expect($('[class=\"hello goodbye world friend\"]')).to.have.lengthOf(1);\n    expect($('[class=\"foo baz\"]')).to.have.lengthOf(1);\n    expect($('span:not([class])')).to.have.lengthOf(1);\n  });","file":"astro-class-list.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:only hydrator","suites":["Client only components"],"updatePoint":{"line":13,"column":44,"index":418},"line":13,"code":"  it('Loads pages using client:only hydrator', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: <astro-island> is empty\n    expect($('astro-island').html()).to.equal('');\n\n    // test 2: svelte renderer is on the page\n    expect($('astro-island').attr('renderer-url')).to.be.ok;\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the CSS to the page","suites":["Client only components"],"updatePoint":{"line":23,"column":30,"index":759},"line":23,"code":"  it('Adds the CSS to the page', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n    const href = $('link[rel=stylesheet]').attr('href');\n    const css = await fixture.readFile(href);\n    expect(css).to.match(/yellowgreen/, 'Svelte styles are added');\n    expect(css).to.match(/Courier New/, 'Global styles are added');\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the CSS to the page - standalone svelte component","suites":["Client only components"],"updatePoint":{"line":31,"column":60,"index":1170},"line":31,"code":"  it('Adds the CSS to the page - standalone svelte component', async () => {\n    const html = await fixture.readFile('/persistent-counter-standalone/index.html');\n    const $ = cheerioLoad(html);\n    expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1);\n    const href = $('link[rel=stylesheet]').attr('href');\n    const css = await fixture.readFile(href);\n    expect(css).to.match(/tomato/, 'Svelte styles are added');\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes CSS from components that use CSS modules","suites":["Client only components"],"updatePoint":{"line":39,"column":55,"index":1599},"line":39,"code":"  it('Includes CSS from components that use CSS modules', async () => {\n    const html = await fixture.readFile('/css-modules/index.html');\n    const $ = cheerioLoad(html);\n    expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1);\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes CSS from package components","suites":["Client only components"],"updatePoint":{"line":44,"column":42,"index":1826},"line":44,"code":"  it('Includes CSS from package components', async () => {\n    const html = await fixture.readFile('/pkg/index.html');\n    const $ = cheerioLoad(html);\n    expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1);\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:only hydrator","suites":["Client only components subpath"],"updatePoint":{"line":60,"column":44,"index":2312},"line":60,"code":"  it('Loads pages using client:only hydrator', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: <astro-island> is empty\n    expect($('astro-island').html()).to.equal('');\n\n    // test 2: svelte renderer is on the page\n    expect($('astro-island').attr('renderer-url')).to.be.ok;\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the CSS to the page","suites":["Client only components subpath"],"updatePoint":{"line":70,"column":30,"index":2653},"line":70,"code":"  it('Adds the CSS to the page', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n    const href = $('link[rel=stylesheet]').attr('href');\n    const css = await fixture.readFile(href.replace(/\\/blog/, ''));\n    expect(css).to.match(/yellowgreen/, 'Svelte styles are added');\n    expect(css).to.match(/Courier New/, 'Global styles are added');\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the CSS to the page for TSX components","suites":["Client only components subpath"],"updatePoint":{"line":78,"column":49,"index":3075},"line":78,"code":"  it('Adds the CSS to the page for TSX components', async () => {\n    const html = await fixture.readFile('/tsx-no-extension/index.html');\n    const $ = cheerioLoad(html);\n    const href = $('link[rel=stylesheet]').attr('href');\n    const css = await fixture.readFile(href.replace(/\\/blog/, ''));\n    expect(css).to.match(/purple/, 'Global styles from tsx component are added');\n  });","file":"astro-client-only.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should treeshake FooComponent","suites":["Component bundling"],"updatePoint":{"line":11,"column":35,"index":317},"line":11,"code":"  it('should treeshake FooComponent', async () => {\n    const astroChunkDir = await fixture.readdir('/_astro');\n    const manyComponentsChunkName = astroChunkDir.find(chunk => chunk.startsWith('ManyComponents'));\n    const manyComponentsChunkContent = await fixture.readFile(`/_astro/${manyComponentsChunkName}`);\n    expect(manyComponentsChunkContent).to.not.include('FooComponent');\n  });","file":"astro-component-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code> without lang or theme","suites":["<Code>"],"updatePoint":{"line":12,"column":34,"index":336},"line":12,"code":"  it('<Code> without lang or theme', async () => {\n    let html = await fixture.readFile('/no-lang/index.html');\n    const $ = cheerio.load(html);\n    expect($('pre')).to.have.lengthOf(1);\n    expect($('pre').attr('style')).to.equal('background-color: #0d1117; overflow-x: auto;', 'applies default and overflow');\n    expect($('pre > code')).to.have.lengthOf(1);\n\n    // test: contains some generated spans\n    expect($('pre > code span').length).to.be.greaterThan(1);\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code lang=\"...\">","suites":["<Code>"],"updatePoint":{"line":22,"column":23,"index":800},"line":22,"code":"  it('<Code lang=\"...\">', async () => {\n    let html = await fixture.readFile('/basic/index.html');\n    const $ = cheerio.load(html);\n    expect($('pre')).to.have.lengthOf(1);\n    expect($('pre').attr('class'), 'astro-code');\n    expect($('pre > code')).to.have.lengthOf(1);\n    // test: contains many generated spans\n    expect($('pre > code span').length).to.be.greaterThanOrEqual(6);\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code theme=\"...\">","suites":["<Code>"],"updatePoint":{"line":31,"column":24,"index":1194},"line":31,"code":"  it('<Code theme=\"...\">', async () => {\n    let html = await fixture.readFile('/custom-theme/index.html');\n    const $ = cheerio.load(html);\n    expect($('pre')).to.have.lengthOf(1);\n    expect($('pre').attr('class')).to.equal('astro-code');\n    expect($('pre').attr('style')).to.equal('background-color: #2e3440ff; overflow-x: auto;', 'applies custom theme');\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code wrap>","suites":["<Code>"],"updatePoint":{"line":38,"column":17,"index":1555},"line":38,"code":"  it('<Code wrap>', async () => {\n    {\n      let html = await fixture.readFile('/wrap-true/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(1);\n      // test: applies wrap overflow\n      expect($('pre').attr('style')).to.equal('background-color: #0d1117; overflow-x: auto; white-space: pre-wrap; word-wrap: break-word;');\n    }\n    {\n      let html = await fixture.readFile('/wrap-false/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(1);\n      // test: applies wrap overflow\n      expect($('pre').attr('style')).to.equal('background-color: #0d1117; overflow-x: auto;');\n    }\n    {\n      let html = await fixture.readFile('/wrap-null/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(1);\n      // test: applies wrap overflow\n      expect($('pre').attr('style')).to.equal('background-color: #0d1117');\n    }\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code lang=\"...\" theme=\"css-variables\">","suites":["<Code>"],"updatePoint":{"line":61,"column":45,"index":2521},"line":61,"code":"  it('<Code lang=\"...\" theme=\"css-variables\">', async () => {\n    let html = await fixture.readFile('/css-theme/index.html');\n    const $ = cheerio.load(html);\n    expect($('pre')).to.have.lengthOf(1);\n    expect($('pre').attr('class')).to.equal('astro-code');\n    expect($('pre, pre span').map((i, f) => f.attribs ? f.attribs.style : 'no style found').toArray()).to.deep.equal(['background-color: var(--astro-code-color-background); overflow-x: auto;', 'color: var(--astro-code-token-constant)', 'color: var(--astro-code-token-function)', 'color: var(--astro-code-color-text)', 'color: var(--astro-code-token-string-expression)', 'color: var(--astro-code-color-text)']);\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"<Code> with custom theme and lang","suites":["<Code>"],"updatePoint":{"line":68,"column":39,"index":3193},"line":68,"code":"  it('<Code> with custom theme and lang', async () => {\n    let html = await fixture.readFile('/imported/index.html');\n    const $ = cheerio.load(html);\n    expect($('#theme > pre')).to.have.lengthOf(1);\n    expect($('#theme > pre').attr('style'), 'background-color: #FDFDFE; overflow-x: auto;');\n    expect($('#lang > pre')).to.have.lengthOf(1);\n    expect($('#lang > pre > code span').length).to.equal(3);\n  });","file":"astro-component-code.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is able to get cookies from the request","suites":["Astro.cookies","Development"],"updatePoint":{"line":24,"column":47,"index":719},"line":24,"code":"    it('is able to get cookies from the request', async () => {\n      const response = await fixture.fetch('/get-json', {\n        headers: {\n          cookie: `prefs=${encodeURIComponent(JSON.stringify({\n            mode: 'light'\n          }))}`\n        }\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('dd').text()).to.equal('light');\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can set the cookie value","suites":["Astro.cookies","Development"],"updatePoint":{"line":37,"column":32,"index":1149},"line":37,"code":"    it('can set the cookie value', async () => {\n      const response = await fixture.fetch('/set-value', {\n        method: 'POST'\n      });\n      expect(response.status).to.equal(200);\n      // Bug in 18.14.1 where `set-cookie` will not be defined\n      // Should be fixed in 18.14.2\n      if (process.versions.node !== '18.14.1') {\n        expect(response.headers.has('set-cookie')).to.equal(true);\n      }\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is able to get cookies from the request","suites":["Astro.cookies","Production"],"updatePoint":{"line":60,"column":47,"index":1953},"line":60,"code":"    it('is able to get cookies from the request', async () => {\n      const response = await fetchResponse('/get-json', {\n        headers: {\n          cookie: `prefs=${encodeURIComponent(JSON.stringify({\n            mode: 'light'\n          }))}`\n        }\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('dd').text()).to.equal('light');\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can set the cookie value","suites":["Astro.cookies","Production"],"updatePoint":{"line":73,"column":32,"index":2383},"line":73,"code":"    it('can set the cookie value', async () => {\n      const response = await fetchResponse('/set-value', {\n        method: 'POST'\n      });\n      expect(response.status).to.equal(200);\n      let headers = Array.from(app.setCookieHeaders(response));\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.match(/Expires/);\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Early returning a Response still includes set headers","suites":["Astro.cookies","Production"],"updatePoint":{"line":82,"column":61,"index":2761},"line":82,"code":"    it('Early returning a Response still includes set headers', async () => {\n      const response = await fetchResponse('/early-return', {\n        headers: {\n          cookie: `prefs=${encodeURIComponent(JSON.stringify({\n            mode: 'light'\n          }))}`\n        }\n      });\n      expect(response.status).to.equal(302);\n      let headers = Array.from(app.setCookieHeaders(response));\n      expect(headers).to.have.a.lengthOf(1);\n      let raw = headers[0].slice(6);\n      let data = JSON.parse(decodeURIComponent(raw));\n      expect(data).to.be.an('object');\n      expect(data.mode).to.equal('dark');\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"API route can get and set cookies","suites":["Astro.cookies","Production"],"updatePoint":{"line":98,"column":41,"index":3359},"line":98,"code":"    it('API route can get and set cookies', async () => {\n      const response = await fetchResponse('/set-prefs', {\n        method: 'POST',\n        headers: {\n          cookie: `prefs=${encodeURIComponent(JSON.stringify({\n            mode: 'light'\n          }))}`\n        }\n      });\n      expect(response.status).to.equal(302);\n      let headers = Array.from(app.setCookieHeaders(response));\n      expect(headers).to.have.a.lengthOf(1);\n      let raw = headers[0].slice(6);\n      let data = JSON.parse(decodeURIComponent(raw));\n      expect(data).to.be.an('object');\n      expect(data.mode).to.equal('dark');\n    });","file":"astro-cookies.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Bundles CSS","suites":["CSS Bundling","defaults"],"updatePoint":{"line":26,"column":19,"index":1034},"line":26,"code":"    it('Bundles CSS', async () => {\n      const builtCSS = new Set();\n\n      // for all HTML files…\n      for (const [filepath, css] of Object.entries(EXPECTED_CSS)) {\n        const html = await fixture.readFile(filepath);\n        const $ = cheerio.load(html);\n\n        // test 1: assert new bundled CSS is present\n        for (const href of css) {\n          const link = $(`link[rel=\"stylesheet\"][href^=\"${href}\"]`);\n          expect(link.length).to.be.greaterThanOrEqual(1);\n          const outHref = link.attr('href');\n          builtCSS.add(outHref.startsWith('../') ? outHref.slice(2) : outHref);\n        }\n\n        // test 2: assert old CSS was removed\n        for (const href of UNEXPECTED_CSS) {\n          const link = $(`link[rel=\"stylesheet\"][href=\"${href}\"]`);\n          expect(link).to.have.lengthOf(0);\n        }\n\n        // test 3: assert all bundled CSS was built and contains CSS\n        for (const url of builtCSS.keys()) {\n          const bundledCss = await fixture.readFile(url);\n          expect(bundledCss).to.be.ok;\n        }\n      }\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"there are 4 css files","suites":["CSS Bundling","defaults"],"updatePoint":{"line":55,"column":29,"index":2108},"line":55,"code":"    it('there are 4 css files', async () => {\n      const dir = await fixture.readdir('/_astro');\n      expect(dir).to.have.a.lengthOf(4);\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"CSS includes hashes","suites":["CSS Bundling","defaults"],"updatePoint":{"line":59,"column":27,"index":2253},"line":59,"code":"    it('CSS includes hashes', async () => {\n      const [firstFound] = await fixture.readdir('/_astro');\n      expect(firstFound).to.match(/[a-z]+\\.[0-9a-z]{8}\\.css/);\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"there are 4 css files","suites":["CSS Bundling","using custom assetFileNames config"],"updatePoint":{"line":83,"column":29,"index":2928},"line":83,"code":"    it('there are 4 css files', async () => {\n      const dir = await fixture.readdir('/assets');\n      expect(dir).to.have.a.lengthOf(4);\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"CSS does not include hashes","suites":["CSS Bundling","using custom assetFileNames config"],"updatePoint":{"line":87,"column":35,"index":3081},"line":87,"code":"    it('CSS does not include hashes', async () => {\n      const [firstFound] = await fixture.readdir('/assets');\n      expect(firstFound).to.not.match(/[a-z]+\\.[0-9a-z]{8}\\.css/);\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"there are 2 index named CSS files","suites":["CSS Bundling","using custom assetFileNames config"],"updatePoint":{"line":91,"column":41,"index":3275},"line":91,"code":"    it('there are 2 index named CSS files', async () => {\n      const dir = await fixture.readdir('/assets');\n      const indexNamedFiles = dir.filter(name => name.startsWith('index'));\n      expect(indexNamedFiles).to.have.a.lengthOf(2);\n    });","file":"astro-css-bundling.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns custom headers for valid URLs","suites":["Astro dev headers","dev"],"updatePoint":{"line":23,"column":45,"index":554},"line":23,"code":"    it('returns custom headers for valid URLs', async () => {\n      const result = await fixture.fetch('/');\n      expect(result.status).to.equal(200);\n      expect(Object.fromEntries(result.headers)).to.include(headers);\n    });","file":"astro-dev-headers.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not return custom headers for invalid URLs","suites":["Astro dev headers","dev"],"updatePoint":{"line":28,"column":55,"index":794},"line":28,"code":"    it('does not return custom headers for invalid URLs', async () => {\n      const result = await fixture.fetch('/bad-url');\n      expect(result.status).to.equal(404);\n      expect(Object.fromEntries(result.headers)).not.to.include(headers);\n    });","file":"astro-dev-headers.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes define:vars to script elements","suites":["Directives"],"updatePoint":{"line":12,"column":43,"index":351},"line":12,"code":"  it('Passes define:vars to script elements', async () => {\n    const html = await fixture.readFile('/define-vars/index.html');\n    const $ = cheerio.load(html);\n    expect($('script')).to.have.lengthOf(3);\n    let i = 0;\n    for (const script of $('script').toArray()) {\n      // Wrap script in scope ({}) to avoid redeclaration errors\n      expect($(script).text().startsWith('(function(){')).to.equal(true);\n      expect($(script).text().endsWith('})();')).to.equal(true);\n      if (i < 2) {\n        // Inline defined variables\n        expect($(script).toString()).to.include('const foo = \"bar\"');\n      } else {\n        // Convert invalid keys to valid identifiers\n        expect($(script).toString()).to.include('const dashCase = \"bar\"');\n      }\n      i++;\n    }\n  });","file":"astro-directives.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes define:vars to style elements","suites":["Directives"],"updatePoint":{"line":31,"column":42,"index":1125},"line":31,"code":"  it('Passes define:vars to style elements', async () => {\n    const html = await fixture.readFile('/define-vars/index.html');\n    const $ = cheerio.load(html);\n\n    // All styles should be bundled\n    expect($('style')).to.have.lengthOf(0);\n\n    // Inject style attribute on top-level element in page\n    expect($('html').attr('style').toString()).to.include('--bg: white;');\n    expect($('html').attr('style').toString()).to.include('--fg: black;');\n\n    // Inject style attribute on top-level elements in component\n    expect($('h1').attr('style').toString()).to.include('--textColor: red;');\n  });","file":"astro-directives.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"set:html","suites":["Directives"],"updatePoint":{"line":45,"column":14,"index":1699},"line":45,"code":"  it('set:html', async () => {\n    const html = await fixture.readFile('/set-html/index.html');\n    const $ = cheerio.load(html);\n    expect($('#text')).to.have.lengthOf(1);\n    expect($('#text').text()).to.equal('a');\n    expect($('#zero')).to.have.lengthOf(1);\n    expect($('#zero').text()).to.equal('0');\n    expect($('#number')).to.have.lengthOf(1);\n    expect($('#number').text()).to.equal('1');\n    expect($('#undefined')).to.have.lengthOf(1);\n    expect($('#undefined').text()).to.equal('');\n    expect($('#null')).to.have.lengthOf(1);\n    expect($('#null').text()).to.equal('');\n    expect($('#false')).to.have.lengthOf(1);\n    expect($('#false').text()).to.equal('');\n    expect($('#true')).to.have.lengthOf(1);\n    expect($('#true').text()).to.equal('true');\n  });","file":"astro-directives.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Automatically prepends the standards mode doctype","suites":["Doctype"],"updatePoint":{"line":12,"column":55,"index":351},"line":12,"code":"  it('Automatically prepends the standards mode doctype', async () => {\n    const html = await fixture.readFile('/prepend/index.html');\n\n    // test that Doctype always included\n    expect(html).to.match(/^<!DOCTYPE html>/i);\n  });","file":"astro-doctype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"No attributes added when doctype is provided by user","suites":["Doctype"],"updatePoint":{"line":18,"column":58,"index":586},"line":18,"code":"  it('No attributes added when doctype is provided by user', async () => {\n    const html = await fixture.readFile('/provided/index.html');\n\n    // test that Doctype always included\n    expect(html).to.match(/^<!DOCTYPE html>/i);\n  });","file":"astro-doctype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Preserves user provided doctype","suites":["Doctype"],"line":24,"code":"  it.skip('Preserves user provided doctype', async () => {","file":"astro-doctype.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"User provided doctype is case insensitive","suites":["Doctype"],"updatePoint":{"line":30,"column":47,"index":1141},"line":30,"code":"  it('User provided doctype is case insensitive', async () => {\n    const html = await fixture.readFile('/capital/index.html');\n\n    // test 1: Doctype left alone\n    expect(html).to.match(/^<!DOCTYPE html>/i);\n\n    // test 2: no closing tag\n    expect(html).not.to.match(/<\\/!DOCTYPE>/i);\n  });","file":"astro-doctype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Doctype can be provided in a layout","suites":["Doctype"],"line":39,"code":"  it.skip('Doctype can be provided in a layout', async () => {","file":"astro-doctype.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"Doctype is added in a layout without one","suites":["Doctype"],"updatePoint":{"line":49,"column":46,"index":1783},"line":49,"code":"  it('Doctype is added in a layout without one', async () => {\n    const html = await fixture.readFile('/in-layout-no-doctype/index.html');\n\n    // test that doctype is at the front\n    expect(html).to.match(/^<!DOCTYPE html>/i);\n  });","file":"astro-doctype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Doctype is added in a layout used with markdown pages","suites":["Doctype"],"updatePoint":{"line":55,"column":59,"index":2032},"line":55,"code":"  it('Doctype is added in a layout used with markdown pages', async () => {\n    const html = await fixture.readFile('/in-layout-article/index.html');\n\n    // test 1: doctype is at the front\n    expect(html).to.match(/^<!DOCTYPE html>/i);\n\n    // test 2: A link inside of the head\n    const $ = cheerio.load(html);\n    expect($('head link')).to.have.lengthOf(1);\n  });","file":"astro-doctype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads packages that only run code in client","suites":["Dynamic components"],"updatePoint":{"line":12,"column":49,"index":356},"line":12,"code":"  it('Loads packages that only run code in client', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('script').length).to.eq(1);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:media hydrator","suites":["Dynamic components"],"updatePoint":{"line":17,"column":45,"index":555},"line":17,"code":"  it('Loads pages using client:media hydrator', async () => {\n    const root = new URL('http://example.com/media/index.html');\n    const html = await fixture.readFile('/media/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: static value rendered\n    expect($('script').length).to.equal(1);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:only hydrator","suites":["Dynamic components"],"updatePoint":{"line":25,"column":44,"index":865},"line":25,"code":"  it('Loads pages using client:only hydrator', async () => {\n    const html = await fixture.readFile('/client-only/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: <astro-island> is empty.\n    expect($('astro-island').html()).to.equal('');\n    // test 2: component url\n    const href = $('astro-island').attr('component-url');\n    expect(href).to.include(`/PersistentCounter`);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads packages that only run code in client","suites":["Dynamic components subpath"],"updatePoint":{"line":46,"column":49,"index":1526},"line":46,"code":"  it('Loads packages that only run code in client', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('script').length).to.eq(1);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:media hydrator","suites":["Dynamic components subpath"],"updatePoint":{"line":51,"column":45,"index":1725},"line":51,"code":"  it('Loads pages using client:media hydrator', async () => {\n    const html = await fixture.readFile('/media/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: static value rendered\n    expect($('script').length).to.equal(1);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Loads pages using client:only hydrator","suites":["Dynamic components subpath"],"updatePoint":{"line":58,"column":44,"index":1970},"line":58,"code":"  it('Loads pages using client:only hydrator', async () => {\n    const html = await fixture.readFile('/client-only/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: <astro-island> is empty.\n    expect($('astro-island').html()).to.equal('');\n    // test 2: has component url\n    const attr = $('astro-island').attr('component-url');\n    expect(attr).to.include(`blog/_astro/PersistentCounter`);\n  });","file":"astro-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"builds without throwing","suites":["Environment Variables","Build"],"updatePoint":{"line":16,"column":31,"index":449},"line":16,"code":"    it('builds without throwing', async () => {\n      expect(true).to.equal(true);\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render public env and private env","suites":["Environment Variables","Build"],"updatePoint":{"line":19,"column":46,"index":555},"line":19,"code":"    it('does render public env and private env', async () => {\n      let indexHtml = await fixture.readFile('/index.html');\n      expect(indexHtml).to.include('CLUB_33');\n      expect(indexHtml).to.include('BLUE_BAYOU');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render destructured public env and private env","suites":["Environment Variables","Build"],"updatePoint":{"line":24,"column":59,"index":797},"line":24,"code":"    it('does render destructured public env and private env', async () => {\n      let indexHtml = await fixture.readFile('/destructured/index.html');\n      expect(indexHtml).to.include('CLUB_33');\n      expect(indexHtml).to.include('BLUE_BAYOU');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render builtin SITE env","suites":["Environment Variables","Build"],"updatePoint":{"line":29,"column":36,"index":1029},"line":29,"code":"    it('does render builtin SITE env', async () => {\n      let indexHtml = await fixture.readFile('/index.html');\n      expect(indexHtml).to.include('http://example.com');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render destructured builtin SITE env","suites":["Environment Variables","Build"],"updatePoint":{"line":33,"column":49,"index":1222},"line":33,"code":"    it('does render destructured builtin SITE env', async () => {\n      let indexHtml = await fixture.readFile('/destructured/index.html');\n      expect(indexHtml).to.include('http://example.com');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render builtin BASE_URL env","suites":["Environment Variables","Build"],"updatePoint":{"line":37,"column":40,"index":1419},"line":37,"code":"    it('does render builtin BASE_URL env', async () => {\n      let indexHtml = await fixture.readFile('/index.html');\n      expect(indexHtml).to.include('/blog');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes public env in client-side JS","suites":["Environment Variables","Build"],"updatePoint":{"line":41,"column":45,"index":1595},"line":41,"code":"    it('includes public env in client-side JS', async () => {\n      let dirs = await fixture.readdir('/_astro');\n      console.log(dirs);\n      let found = false;\n\n      // Look in all of the .js files to see if the public env is inlined.\n      // Testing this way prevents hardcoding expected js files.\n      // If we find it in any of them that's good enough to know its working.\n      await Promise.all(dirs.map(async path => {\n        if (path.endsWith('.js')) {\n          let js = await fixture.readFile(`/_astro/${path}`);\n          if (js.includes('BLUE_BAYOU')) {\n            found = true;\n          }\n        }\n      }));\n      expect(found).to.equal(true, 'found the public env variable in the JS build');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not include private env in client-side JS","suites":["Environment Variables","Build"],"updatePoint":{"line":59,"column":54,"index":2328},"line":59,"code":"    it('does not include private env in client-side JS', async () => {\n      let dirs = await fixture.readdir('/');\n      let found = false;\n\n      // Look in all of the .js files to see if the public env is inlined.\n      // Testing this way prevents hardcoding expected js files.\n      // If we find it in any of them that's good enough to know it's NOT working.\n      await Promise.all(dirs.map(async path => {\n        if (path.endsWith('.js')) {\n          let js = await fixture.readFile(`/${path}`);\n          if (js.includes('CLUB_33')) {\n            found = true;\n          }\n        }\n      }));\n      expect(found).to.equal(false, 'found the private env variable in the JS build');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render builtin BASE_URL env","suites":["Environment Variables","Development"],"updatePoint":{"line":86,"column":40,"index":3269},"line":86,"code":"    it('does render builtin BASE_URL env', async () => {\n      let res = await fixture.fetch('/blog/');\n      expect(res.status).to.equal(200);\n      let indexHtml = await res.text();\n      let $ = cheerio.load(indexHtml);\n      expect($('#base-url').text()).to.equal('/blog/');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does render destructured builtin SITE env","suites":["Environment Variables","Development"],"updatePoint":{"line":93,"column":49,"index":3565},"line":93,"code":"    it('does render destructured builtin SITE env', async () => {\n      let res = await fixture.fetch('/blog/destructured/');\n      expect(res.status).to.equal(200);\n      let indexHtml = await res.text();\n      let $ = cheerio.load(indexHtml);\n      expect($('#base-url').text()).to.equal('/blog/');\n    });","file":"astro-envs.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load page","suites":["Expressions"],"updatePoint":{"line":12,"column":19,"index":316},"line":12,"code":"  it('Can load page', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    for (let col of ['red', 'yellow', 'blue']) {\n      expect($('#' + col)).to.have.lengthOf(1);\n    }\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Ignores characters inside of strings","suites":["Expressions"],"updatePoint":{"line":19,"column":42,"index":574},"line":19,"code":"  it('Ignores characters inside of strings', async () => {\n    const html = await fixture.readFile('/strings/index.html');\n    const $ = cheerio.load(html);\n    for (let col of ['red', 'yellow', 'blue']) {\n      expect($('#' + col)).to.have.lengthOf(1);\n    }\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Ignores characters inside of line comments","suites":["Expressions"],"updatePoint":{"line":26,"column":48,"index":846},"line":26,"code":"  it('Ignores characters inside of line comments', async () => {\n    const html = await fixture.readFile('/line-comments/index.html');\n    const $ = cheerio.load(html);\n    for (let col of ['red', 'yellow', 'blue']) {\n      expect($('#' + col)).to.have.lengthOf(1);\n    }\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Ignores characters inside of multiline comments","suites":["Expressions"],"updatePoint":{"line":33,"column":53,"index":1129},"line":33,"code":"  it('Ignores characters inside of multiline comments', async () => {\n    const html = await fixture.readFile('/multiline-comments/index.html');\n    const $ = cheerio.load(html);\n    for (let col of ['red', 'yellow', 'blue']) {\n      expect($('#' + col)).to.have.lengthOf(1);\n    }\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows multiple JSX children in mustache","suites":["Expressions"],"updatePoint":{"line":40,"column":46,"index":1410},"line":40,"code":"  it('Allows multiple JSX children in mustache', async () => {\n    const html = await fixture.readFile('/multiple-children/index.html');\n    expect(html).to.include('#f');\n    expect(html).not.to.include('#t');\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows <> Fragments in expressions","suites":["Expressions"],"updatePoint":{"line":45,"column":40,"index":1621},"line":45,"code":"  it('Allows <> Fragments in expressions', async () => {\n    const html = await fixture.readFile('/multiple-children/index.html');\n    const $ = cheerio.load(html);\n    expect($('#fragment').children()).to.have.lengthOf(3);\n    expect($('#fragment').children('#a')).to.have.lengthOf(1);\n    expect($('#fragment').children('#b')).to.have.lengthOf(1);\n    expect($('#fragment').children('#c')).to.have.lengthOf(1);\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not render falsy values using &&","suites":["Expressions"],"updatePoint":{"line":53,"column":43,"index":2043},"line":53,"code":"  it('Does not render falsy values using &&', async () => {\n    const html = await fixture.readFile('/falsy/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Expected {true && <span id=\"true\" />} to render\n    expect($('#true')).to.have.lengthOf(1);\n\n    // test 2: Expected {0 && \"VALUE\"} to render \"0\"\n    expect($('#zero').text()).to.equal('0');\n\n    // test 3: Expected {false && <span id=\"false\" />} not to render\n    expect($('#false')).to.have.lengthOf(0);\n\n    // test 4: Expected {null && <span id=\"null\" />} not to render\n    expect($('#null')).to.have.lengthOf(0);\n\n    // test 5: Expected {undefined && <span id=\"undefined\" />} not to render\n    expect($('#undefined')).to.have.lengthOf(0);\n\n    // Inside of a component\n\n    // test 6: Expected {true && <span id=\"true\" />} to render\n    expect($('#frag-true')).to.have.lengthOf(1);\n\n    // test 7: Expected {false && <span id=\"false\" />} not to render\n    expect($('#frag-false')).to.have.lengthOf(0);\n\n    // test 8: Expected {null && <span id=\"null\" />} not to render\n    expect($('#frag-null')).to.have.lengthOf(0);\n\n    // test 9: Expected {undefined && <span id=\"undefined\" />} not to render\n    expect($('#frag-undefined')).to.have.lengthOf(0);\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Escapes HTML by default","suites":["Expressions"],"updatePoint":{"line":86,"column":29,"index":3264},"line":86,"code":"  it('Escapes HTML by default', async () => {\n    const html = await fixture.readFile('/escape/index.html');\n    const $ = cheerio.load(html);\n    expect($('body').children()).to.have.lengthOf(2);\n    expect($('body').html()).to.include('&lt;script&gt;console.log(\"pwnd\")&lt;/script&gt;');\n    expect($('#trusted')).to.have.lengthOf(1);\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not double-escape HTML","suites":["Expressions"],"updatePoint":{"line":93,"column":33,"index":3611},"line":93,"code":"  it('Does not double-escape HTML', async () => {\n    const html = await fixture.readFile('/escape/index.html');\n    const $ = cheerio.load(html);\n    expect($('#single-escape').html()).to.equal('Astro &amp; Vite');\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Handles switch statements","suites":["Expressions"],"updatePoint":{"line":98,"column":31,"index":3831},"line":98,"code":"  it('Handles switch statements', async () => {\n    const html = await fixture.readFile('/switch/index.html');\n    const $ = cheerio.load(html);\n    expect($('#red').length).to.equal(0);\n    expect($('#yellow').length).to.equal(1);\n    expect($('#blue').length).to.equal(0);\n  });","file":"astro-expr.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is skipped","suites":[],"line":22,"code":"it.skip('is skipped', () => {});","file":"astro-external-files.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"Shows static content","suites":["Dynamic component fallback"],"updatePoint":{"line":12,"column":26,"index":341},"line":12,"code":"  it('Shows static content', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#fallback').text()).to.equal('static');\n  });","file":"astro-fallback.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Defines Astro.generator","suites":["Astro generator","build"],"updatePoint":{"line":13,"column":31,"index":365},"line":13,"code":"    it('Defines Astro.generator', async () => {\n      const html = await fixture.readFile(`/index.html`);\n      const $ = cheerio.load(html);\n      expect($('meta[name=\"generator\"]').attr('content')).to.match(/^Astro v/);\n    });","file":"astro-generator.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is only called once during build","suites":["getStaticPaths - build calls"],"updatePoint":{"line":15,"column":38,"index":523},"line":15,"code":"  it('is only called once during build', () => {\n    // useless expect; if build() throws in setup then this test fails\n    expect(true).to.equal(true);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"only calls getStaticPaths once","suites":["getStaticPaths - dev calls"],"updatePoint":{"line":34,"column":36,"index":1093},"line":34,"code":"  it('only calls getStaticPaths once', async () => {\n    let res = await fixture.fetch('/a');\n    expect(res.status).to.equal(200);\n    res = await fixture.fetch('/b');\n    expect(res.status).to.equal(200);\n    res = await fixture.fetch('/c');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - named params","suites":["getStaticPaths - 404 behavior"],"updatePoint":{"line":57,"column":57,"index":1818},"line":57,"code":"  it('resolves 200 on matching static path - named params', async () => {\n    const res = await fixture.fetch('/pizza/provolone-sausage');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 404 on pattern match without static path - named params","suites":["getStaticPaths - 404 behavior"],"updatePoint":{"line":61,"column":70,"index":2014},"line":61,"code":"  it('resolves 404 on pattern match without static path - named params', async () => {\n    const res = await fixture.fetch('/pizza/provolone-pineapple');\n    expect(res.status).to.equal(404);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - rest params","suites":["getStaticPaths - 404 behavior"],"updatePoint":{"line":65,"column":56,"index":2198},"line":65,"code":"  it('resolves 200 on matching static path - rest params', async () => {\n    const res = await fixture.fetch('/pizza/grimaldis/new-york');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 404 on pattern match without static path - rest params","suites":["getStaticPaths - 404 behavior"],"updatePoint":{"line":69,"column":69,"index":2394},"line":69,"code":"  it('resolves 404 on pattern match without static path - rest params', async () => {\n    const res = await fixture.fetch('/pizza/pizza-hut');\n    expect(res.status).to.equal(404);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on nested array parameters","suites":["getStaticPaths - route params type validation"],"updatePoint":{"line":87,"column":45,"index":2989},"line":87,"code":"  it('resolves 200 on nested array parameters', async () => {\n    const res = await fixture.fetch('/nested-arrays/slug1');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - string params","suites":["getStaticPaths - route params type validation"],"updatePoint":{"line":91,"column":58,"index":3169},"line":91,"code":"  it('resolves 200 on matching static path - string params', async () => {\n    // route provided with { params: { year: \"2022\", slug: \"post-2\" }}\n    const res = await fixture.fetch('/blog/2022/post-1');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - numeric params","suites":["getStaticPaths - route params type validation"],"updatePoint":{"line":96,"column":59,"index":3418},"line":96,"code":"  it('resolves 200 on matching static path - numeric params', async () => {\n    // route provided with { params: { year: 2022, slug: \"post-2\" }}\n    const res = await fixture.fetch('/blog/2022/post-2');\n    expect(res.status).to.equal(200);\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static paths","suites":["getStaticPaths - numeric route params"],"updatePoint":{"line":117,"column":43,"index":4114},"line":117,"code":"  it('resolves 200 on matching static paths', async () => {\n    // routes params provided for pages /posts/1, /posts/2, and /posts/3\n    for (const page of [1, 2, 3]) {\n      let res = await fixture.fetch(`/posts/${page}`);\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const canonical = $('link[rel=canonical]');\n      expect(canonical.attr('href')).to.equal(`https://mysite.dev/posts/${page}`, `doesn't trim the /${page} route param`);\n    }\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Sets the current pathname","suites":["getStaticPaths - Astro.url"],"updatePoint":{"line":141,"column":31,"index":5033},"line":141,"code":"  it('Sets the current pathname', async () => {\n    const html = await fixture.readFile('/food/tacos/index.html');\n    const $ = cheerio.load(html);\n    expect($('#url').text()).to.equal('/food/tacos/');\n  });","file":"astro-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.request.url","suites":["Astro Global","dev"],"updatePoint":{"line":21,"column":25,"index":549},"line":21,"code":"    it('Astro.request.url', async () => {\n      const res = await await fixture.fetch('/blog/?foo=42');\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      expect($('#pathname').text()).to.equal('/blog/');\n      expect($('#searchparams').text()).to.equal('{}');\n      expect($('#child-pathname').text()).to.equal('/blog/');\n      expect($('#nested-child-pathname').text()).to.equal('/blog/');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.glob() returned `url` metadata of each markdown file extensions DOES NOT include the extension","suites":["Astro Global","dev"],"updatePoint":{"line":31,"column":108,"index":1100},"line":31,"code":"    it('Astro.glob() returned `url` metadata of each markdown file extensions DOES NOT include the extension', async () => {\n      const html = await fixture.fetch('/blog/omit-markdown-extensions/').then(res => res.text());\n      const $ = cheerio.load(html);\n      expect($('[data-any-url-contains-extension]').data('any-url-contains-extension')).to.equal(false);\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.request.url","suites":["Astro Global","build"],"updatePoint":{"line":41,"column":25,"index":1486},"line":41,"code":"    it('Astro.request.url', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#pathname').text()).to.equal('/blog/');\n      expect($('#searchparams').text()).to.equal('{}');\n      expect($('#child-pathname').text()).to.equal('/blog/');\n      expect($('#nested-child-pathname').text()).to.equal('/blog/');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.site","suites":["Astro Global","build"],"updatePoint":{"line":49,"column":18,"index":1866},"line":49,"code":"    it('Astro.site', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#site').attr('href')).to.equal('https://mysite.dev/blog/');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.glob() correctly returns an array of all posts","suites":["Astro Global","build"],"updatePoint":{"line":54,"column":60,"index":2121},"line":54,"code":"    it('Astro.glob() correctly returns an array of all posts', async () => {\n      const html = await fixture.readFile('/posts/1/index.html');\n      const $ = cheerio.load(html);\n      expect($('.post-url').attr('href')).to.equal('/blog/post/post-2');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.glob() correctly returns meta info for MD and Astro files","suites":["Astro Global","build"],"updatePoint":{"line":59,"column":71,"index":2392},"line":59,"code":"    it('Astro.glob() correctly returns meta info for MD and Astro files', async () => {\n      const html = await fixture.readFile('/glob/index.html');\n      const $ = cheerio.load(html);\n      expect($('[data-file]').length).to.equal(8);\n      expect($('.post-url[href]').length).to.equal(8);\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.request.url","suites":["Astro Global Defaults","dev"],"updatePoint":{"line":85,"column":25,"index":3136},"line":85,"code":"    it('Astro.request.url', async () => {\n      expect($('#pathname').text()).to.equal('');\n      expect($('#searchparams').text()).to.equal('');\n      expect($('#child-pathname').text()).to.equal('');\n      expect($('#nested-child-pathname').text()).to.equal('');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.request.url","suites":["Astro Global Defaults","build"],"updatePoint":{"line":96,"column":25,"index":3505},"line":96,"code":"    it('Astro.request.url', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#pathname').text()).to.equal('/');\n      expect($('#searchparams').text()).to.equal('{}');\n      expect($('#child-pathname').text()).to.equal('/');\n      expect($('#nested-child-pathname').text()).to.equal('/');\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Astro.site","suites":["Astro Global Defaults","build"],"updatePoint":{"line":104,"column":18,"index":3870},"line":104,"code":"    it('Astro.site', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#site').attr('href')).to.equal(undefined);\n    });","file":"astro-global.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Styles are appended to the head and not the body","suites":["Head in its own component"],"updatePoint":{"line":14,"column":54,"index":421},"line":14,"code":"  it('Styles are appended to the head and not the body', async () => {\n    let html = await fixture.readFile('/head-own-component/index.html');\n    let $ = cheerio.load(html);\n    expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1, 'one stylesheet overall');\n    expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1, 'stylesheet is in the head');\n  });","file":"astro-head.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not render the draft post","suites":["Astro Markdown with draft posts disabled"],"updatePoint":{"line":12,"column":36,"index":373},"line":12,"code":"  it('Does not render the draft post', async () => {\n    let renderedDraft = false;\n    try {\n      await fixture.readFile('/wip/index.html');\n      renderedDraft = true;\n    } catch (err) {\n      expect(err.code).to.equal('ENOENT');\n    }\n    expect(renderedDraft).to.equal(false, 'Rendered a draft post');\n  });","file":"astro-markdown-drafts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders the draft post","suites":["Astro Markdown with draft posts enabled"],"updatePoint":{"line":34,"column":28,"index":952},"line":34,"code":"  it('Renders the draft post', async () => {\n    const html = await fixture.readFile('/wip/index.html');\n    const $ = cheerio.load(html);\n    expect($('h1').length).to.be.ok;\n    expect($('h1').text()).to.equal('WIP');\n  });","file":"astro-markdown-drafts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"remark supports custom vfile data - get title","suites":["Astro Markdown - frontmatter injection"],"updatePoint":{"line":12,"column":51,"index":400},"line":12,"code":"  it('remark supports custom vfile data - get title', async () => {\n    const frontmatterByPage = JSON.parse(await fixture.readFile('/glob.json'));\n    const titles = frontmatterByPage.map((frontmatter = {}) => frontmatter.title);\n    expect(titles).to.contain('Page 1');\n    expect(titles).to.contain('Page 2');\n  });","file":"astro-markdown-frontmatter-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"rehype supports custom vfile data - reading time","suites":["Astro Markdown - frontmatter injection"],"updatePoint":{"line":18,"column":54,"index":722},"line":18,"code":"  it('rehype supports custom vfile data - reading time', async () => {\n    const frontmatterByPage = JSON.parse(await fixture.readFile('/glob.json'));\n    const readingTimes = frontmatterByPage.map((frontmatter = {}) => frontmatter.injectedReadingTime);\n    expect(readingTimes.length).to.be.greaterThan(0);\n    for (let readingTime of readingTimes) {\n      expect(readingTime).to.not.be.null;\n      expect(readingTime.text).match(/^\\d+ min read/);\n    }\n  });","file":"astro-markdown-frontmatter-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"allow user frontmatter mutation","suites":["Astro Markdown - frontmatter injection"],"updatePoint":{"line":27,"column":37,"index":1166},"line":27,"code":"  it('allow user frontmatter mutation', async () => {\n    const frontmatterByPage = JSON.parse(await fixture.readFile('/glob.json'));\n    const descriptions = frontmatterByPage.map((frontmatter = {}) => frontmatter.description);\n    expect(descriptions).to.contain('Processed by remarkDescription plugin: Page 1 description');\n    expect(descriptions).to.contain('Processed by remarkDescription plugin: Page 2 description');\n  });","file":"astro-markdown-frontmatter-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can render markdown with plugins","suites":["Astro Markdown plugins"],"updatePoint":{"line":25,"column":38,"index":668},"line":25,"code":"  it('Can render markdown with plugins', async () => {\n    const fixture = await buildFixture({\n      markdown: {\n        remarkPlugins: ['remark-code-titles', ['rehype-autolink-headings', {\n          behavior: 'prepend'\n        }]],\n        rehypePlugins: ['rehype-slug', ['rehype-toc', {\n          headings: ['h2', 'h3']\n        }], [addClasses, {\n          'h1,h2,h3': 'title'\n        }]]\n      }\n    });\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Added a TOC\n    expect($('.toc')).to.have.lengthOf(1);\n\n    // test 2: Added .title to h1\n    expect($('#hello-world').hasClass('title')).to.equal(true);\n  });","file":"astro-markdown-plugins.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Still applies default plugins when user plugins are provided","suites":["Astro Markdown plugins"],"updatePoint":{"line":49,"column":66,"index":1449},"line":49,"code":"  it('Still applies default plugins when user plugins are provided', async () => {\n    const fixture = await buildFixture({\n      markdown: {\n        remarkPlugins: [remarkExamplePlugin],\n        rehypePlugins: [[addClasses, {\n          'h1,h2,h3': 'title'\n        }]]\n      }\n    });\n    const gfmHtml = await fixture.readFile('/with-gfm/index.html');\n    const $1 = cheerio.load(gfmHtml);\n    expect($1('a[href=\"https://example.com\"]')).to.have.lengthOf(1);\n    const smartypantsHtml = await fixture.readFile('/with-smartypants/index.html');\n    const $2 = cheerio.load(smartypantsHtml);\n    expect($2('p').html()).to.equal('“Smartypants” is — awesome');\n    testRemark(gfmHtml);\n    testRehype(gfmHtml, '#github-flavored-markdown-test');\n  });","file":"astro-markdown-plugins.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Handles GFM when gfm = ","suites":["Astro Markdown plugins"],"updatePoint":{"line":68,"column":37,"index":2204},"line":68,"code":"    it(`Handles GFM when gfm = ${gfm}`, async () => {\n      const fixture = await buildFixture({\n        markdown: {\n          remarkPlugins: [remarkExamplePlugin],\n          rehypePlugins: [[addClasses, {\n            'h1,h2,h3': 'title'\n          }]],\n          gfm\n        }\n      });\n      const html = await fixture.readFile('/with-gfm/index.html');\n      const $ = cheerio.load(html);\n\n      // test 1: GFM autolink applied correctly\n      if (gfm === true) {\n        expect($('a[href=\"https://example.com\"]')).to.have.lengthOf(1);\n      } else {\n        expect($('a[href=\"https://example.com\"]')).to.have.lengthOf(0);\n      }\n      testRemark(html);\n      testRehype(html, '#github-flavored-markdown-test');\n    });","file":"astro-markdown-plugins.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Handles SmartyPants when smartypants = ","suites":["Astro Markdown plugins"],"updatePoint":{"line":92,"column":61,"index":2999},"line":92,"code":"    it(`Handles SmartyPants when smartypants = ${smartypants}`, async () => {\n      const fixture = await buildFixture({\n        markdown: {\n          remarkPlugins: [remarkExamplePlugin],\n          rehypePlugins: [[addClasses, {\n            'h1,h2,h3': 'title'\n          }]],\n          smartypants\n        }\n      });\n      const html = await fixture.readFile('/with-smartypants/index.html');\n      const $ = cheerio.load(html);\n\n      // test 1: GFM autolink applied correctly\n      if (smartypants === true) {\n        expect($('p').html()).to.equal('“Smartypants” is — awesome');\n      } else {\n        expect($('p').html()).to.equal('\"Smartypants\" is -- awesome');\n      }\n      testRemark(html);\n      testRehype(html, '#smartypants-test');\n    });","file":"astro-markdown-plugins.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders footnotes with default English labels","suites":["Astro Markdown without remark-rehype config"],"updatePoint":{"line":12,"column":51,"index":397},"line":12,"code":"  it('Renders footnotes with default English labels', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#footnote-label').text()).to.equal('Footnotes');\n    expect($('.data-footnote-backref').first().attr('aria-label')).to.equal('Back to content');\n  });","file":"astro-markdown-remarkRehype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders footnotes with values from the configuration","suites":["Astro Markdown with remark-rehype config"],"updatePoint":{"line":33,"column":58,"index":1110},"line":33,"code":"  it('Renders footnotes with values from the configuration', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#footnote-label').text()).to.equal('Catatan kaki');\n    expect($('.data-footnote-backref').first().attr('aria-label')).to.equal('Kembali ke konten');\n  });","file":"astro-markdown-remarkRehype.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can render markdown with shiki","suites":["Astro Markdown Shiki","Render shiki"],"updatePoint":{"line":13,"column":38,"index":410},"line":13,"code":"    it('Can render markdown with shiki', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n\n      // There should be no HTML from Prism\n      expect($('.token')).to.have.lengthOf(0);\n      expect($('pre')).to.have.lengthOf(2);\n      expect($('pre').hasClass('astro-code')).to.equal(true);\n      expect($('pre').attr().style).to.equal('background-color: #0d1117; overflow-x: auto;');\n    });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can render diff syntax with \"user-select: none\"","suites":["Astro Markdown Shiki","Render shiki"],"updatePoint":{"line":23,"column":55,"index":876},"line":23,"code":"    it('Can render diff syntax with \"user-select: none\"', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const diffBlockHtml = $('pre').last().html();\n      expect(diffBlockHtml).to.contain(`<span style=\"user-select: none;\">+</span>`);\n      expect(diffBlockHtml).to.contain(`<span style=\"user-select: none;\">-</span>`);\n    });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","Themes","Integrated theme"],"updatePoint":{"line":40,"column":23,"index":1528},"line":40,"code":"      it('Markdown file', async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        expect($('pre')).to.have.lengthOf(1);\n        expect($('pre').hasClass('astro-code')).to.equal(true);\n        expect($('pre').attr().style).to.equal('background-color: #ffffff; overflow-x: auto;');\n      });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","Themes","Custom theme"],"updatePoint":{"line":56,"column":23,"index":2135},"line":56,"code":"      it('Markdown file', async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        expect($('pre')).to.have.lengthOf(1);\n        expect($('pre').hasClass('astro-code')).to.equal(true);\n        expect($('pre').attr().style).to.equal('background-color: #FDFDFE; overflow-x: auto;');\n      });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","Custom langs"],"updatePoint":{"line":73,"column":21,"index":2716},"line":73,"code":"    it('Markdown file', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const segments = $('.line').get(6).children;\n      expect(segments).to.have.lengthOf(3);\n      expect(segments[0].attribs.style).to.be.equal('color: #C9D1D9');\n      expect(segments[1].attribs.style).to.be.equal('color: #79C0FF');\n      expect(segments[2].attribs.style).to.be.equal('color: #C9D1D9');\n      const unknownLang = $('.line').last().html();\n      expect(unknownLang).to.be.equal('<span style=\"color: #c9d1d9\">This language does not exist</span>');\n    });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","Wrap","wrap = true"],"updatePoint":{"line":95,"column":23,"index":3706},"line":95,"code":"      it('Markdown file', async () => {\n        const html = await fixture.readFile('/index.html');\n        const $ = cheerio.load(html);\n        expect($('pre')).to.have.lengthOf(1);\n        expect($('pre').attr('style')).to.equal(style);\n      });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","wrap = false"],"updatePoint":{"line":112,"column":21,"index":4254},"line":112,"code":"    it('Markdown file', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(1);\n      expect($('pre').attr('style')).to.equal(style);\n    });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Markdown file","suites":["Astro Markdown Shiki","wrap = null"],"updatePoint":{"line":128,"column":21,"index":4763},"line":128,"code":"    it('Markdown file', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(1);\n      expect($('pre').attr('style')).to.equal(style);\n    });","file":"astro-markdown-shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: always","suites":["Astro Markdown URL","With subpath"],"updatePoint":{"line":7,"column":29,"index":285},"line":7,"code":"    it('trailingSlash: always', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/with-subpath-always/', import.meta.url),\n        base: '/my-cool-base',\n        trailingSlash: 'always'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl + '/');\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: never","suites":["Astro Markdown URL","With subpath"],"updatePoint":{"line":19,"column":28,"index":780},"line":19,"code":"    it('trailingSlash: never', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/with-subpath-never/', import.meta.url),\n        base: '/my-cool-base',\n        trailingSlash: 'never'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl);\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: ignore","suites":["Astro Markdown URL","With subpath"],"updatePoint":{"line":31,"column":29,"index":1268},"line":31,"code":"    it('trailingSlash: ignore', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/with-subpath-ignore/', import.meta.url),\n        base: '/my-cool-base',\n        trailingSlash: 'ignore'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl);\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: always","suites":["Astro Markdown URL","Without subpath"],"updatePoint":{"line":46,"column":29,"index":1856},"line":46,"code":"    it('trailingSlash: always', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/without-subpath-always/', import.meta.url),\n        trailingSlash: 'always'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl + '/');\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: never","suites":["Astro Markdown URL","Without subpath"],"updatePoint":{"line":57,"column":28,"index":2323},"line":57,"code":"    it('trailingSlash: never', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/without-subpath-never/', import.meta.url),\n        trailingSlash: 'never'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl);\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"trailingSlash: ignore","suites":["Astro Markdown URL","Without subpath"],"updatePoint":{"line":68,"column":29,"index":2783},"line":68,"code":"    it('trailingSlash: ignore', async () => {\n      let fixture = await loadFixture({\n        root: './fixtures/astro-markdown-url/',\n        outDir: new URL('./fixtures/astro-markdown-url/without-subpath-ignore/', import.meta.url),\n        trailingSlash: 'ignore'\n      });\n      await fixture.build();\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#url').attr('href')).to.equal(baseUrl);\n    });","file":"astro-markdown-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Exposes raw markdown content","suites":["Astro Markdown"],"updatePoint":{"line":13,"column":34,"index":389},"line":13,"code":"  it('Exposes raw markdown content', async () => {\n    const {\n      raw\n    } = JSON.parse(await fixture.readFile('/raw-content.json'));\n    expect(fixLineEndings(raw).trim()).to.equal(`# Basic page\\n\\nLets make sure raw and compiled content look right!`);\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Exposes compiled HTML content","suites":["Astro Markdown"],"updatePoint":{"line":19,"column":35,"index":654},"line":19,"code":"  it('Exposes compiled HTML content', async () => {\n    const {\n      compiled\n    } = JSON.parse(await fixture.readFile('/raw-content.json'));\n    expect(fixLineEndings(compiled).trim()).to.equal(`<h1 id=\"basic-page\">Basic page</h1>\\n<p>Lets make sure raw and compiled content look right!</p>`);\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"handles Shiki","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":26,"column":21,"index":991},"line":26,"code":"    it('handles Shiki', async () => {\n      const html = await fixture.readFile('/code-in-md/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre.astro-code').length).to.not.equal(0);\n    });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"handles Prism","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":31,"column":21,"index":1200},"line":31,"code":"    it('handles Prism', async () => {\n      const prismFixture = await loadFixture({\n        root: FIXTURE_ROOT,\n        markdown: {\n          syntaxHighlight: 'prism'\n        }\n      });\n      await prismFixture.build();\n      const html = await prismFixture.readFile('/code-in-md/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre.language-html').length).to.not.equal(0);\n    });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes frontmatter to layout via \"content\" and \"frontmatter\" props","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":44,"column":72,"index":1658},"line":44,"code":"  it('Passes frontmatter to layout via \"content\" and \"frontmatter\" props', async () => {\n    const html = await fixture.readFile('/with-layout/index.html');\n    const $ = cheerio.load(html);\n    const contentTitle = $('[data-content-title]');\n    const frontmatterTitle = $('[data-frontmatter-title]');\n    expect(contentTitle.text()).to.equal('With layout');\n    expect(frontmatterTitle.text()).to.equal('With layout');\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes headings to layout via \"headings\" prop","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":52,"column":51,"index":2064},"line":52,"code":"  it('Passes headings to layout via \"headings\" prop', async () => {\n    const html = await fixture.readFile('/with-layout/index.html');\n    const $ = cheerio.load(html);\n    const headingSlugs = [...$('body').find('[data-headings] > li')].map(el => $(el).text());\n    expect(headingSlugs.length).to.be.greaterThan(0);\n    expect(headingSlugs).to.contain('section-1');\n    expect(headingSlugs).to.contain('section-2');\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes compiled content to layout via \"compiledContent\" prop","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":60,"column":66,"index":2503},"line":60,"code":"  it('Passes compiled content to layout via \"compiledContent\" prop', async () => {\n    const html = await fixture.readFile('/with-layout/index.html');\n    const $ = cheerio.load(html);\n    const compiledContent = $('[data-compiled-content]');\n    expect(fixLineEndings(compiledContent.text()).trim()).to.equal(`<h2 id=\"section-1\">Section 1</h2>\\n<h2 id=\"section-2\">Section 2</h2>`);\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes raw content to layout via \"rawContent\" prop","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":66,"column":56,"index":2882},"line":66,"code":"  it('Passes raw content to layout via \"rawContent\" prop', async () => {\n    const html = await fixture.readFile('/with-layout/index.html');\n    const $ = cheerio.load(html);\n    const rawContent = $('[data-raw-content]');\n    expect(fixLineEndings(rawContent.text()).trim()).to.equal(`## Section 1\\n\\n## Section 2`);\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Exposes getHeadings() on glob imports","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":72,"column":43,"index":3193},"line":72,"code":"  it('Exposes getHeadings() on glob imports', async () => {\n    const {\n      headings\n    } = JSON.parse(await fixture.readFile('/headings-glob.json'));\n    const headingSlugs = headings.map(heading => heading?.slug);\n    expect(headingSlugs).to.contain('section-1');\n    expect(headingSlugs).to.contain('section-2');\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"passes \"file\" and \"url\" to layout","suites":["Astro Markdown","syntax highlighting"],"updatePoint":{"line":80,"column":39,"index":3514},"line":80,"code":"  it('passes \"file\" and \"url\" to layout', async () => {\n    const html = await fixture.readFile('/with-layout/index.html');\n    const $ = cheerio.load(html);\n    const frontmatterFile = $('[data-frontmatter-file]')?.text();\n    const frontmatterUrl = $('[data-frontmatter-url]')?.text();\n    const file = $('[data-file]')?.text();\n    const url = $('[data-url]')?.text();\n    expect(frontmatterFile?.endsWith('with-layout.md')).to.equal(true, '\"file\" prop does not end with correct path or is undefined');\n    expect(frontmatterUrl).to.equal('/with-layout');\n    expect(file).to.equal(frontmatterFile);\n    expect(url).to.equal(frontmatterUrl);\n  });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows referencing import.meta.env in content","suites":["Astro Markdown","Vite env vars (#3412)"],"updatePoint":{"line":93,"column":53,"index":4223},"line":93,"code":"    it('Allows referencing import.meta.env in content', async () => {\n      const html = await fixture.readFile('/vite-env-vars/index.html');\n      const $ = cheerio.load(html);\n\n      // test 1: referencing an existing var name\n      expect($('code').eq(0).text()).to.equal('import.meta.env.SITE');\n      expect($('li').eq(0).text()).to.equal('import.meta.env.SITE');\n      expect($('code').eq(3).text()).to.contain('site: import.meta.env.SITE');\n\n      // // test 2: referencing a non-existing var name\n      expect($('code').eq(1).text()).to.equal('import.meta.env.TITLE');\n      expect($('li').eq(1).text()).to.equal('import.meta.env.TITLE');\n      expect($('code').eq(3).text()).to.contain('title: import.meta.env.TITLE');\n\n      // // test 3: referencing `import.meta.env` itself (without any var name)\n      expect($('code').eq(2).text()).to.equal('import.meta.env');\n      expect($('li').eq(2).text()).to.equal('import.meta.env');\n      expect($('code').eq(3).text()).to.contain('// Use Vite env vars with import.meta.env');\n    });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows referencing import.meta.env in frontmatter","suites":["Astro Markdown","Vite env vars (#3412)"],"updatePoint":{"line":112,"column":57,"index":5268},"line":112,"code":"    it('Allows referencing import.meta.env in frontmatter', async () => {\n      const {\n        title = ''\n      } = JSON.parse(await fixture.readFile('/vite-env-vars-glob.json'));\n      expect(title).to.contain('import.meta.env.SITE');\n      expect(title).to.contain('import.meta.env.TITLE');\n    });","file":"astro-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not work from a page","suites":["Not returning responses"],"updatePoint":{"line":18,"column":31,"index":483},"line":18,"code":"  it('Does not work from a page', async () => {\n    try {\n      await fixture.build();\n    } catch (e) {\n      expect(e).to.be.instanceOf(Error, 'Only instance of Response can be returned from an Astro file');\n      return null;\n    }\n    assert.fail('Should have thrown an error');\n  });","file":"astro-not-response.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes style attributes as expected to elements","suites":["Object style"],"updatePoint":{"line":12,"column":53,"index":365},"line":12,"code":"  it('Passes style attributes as expected to elements', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('[style=\"background-color:green\"]')).to.have.lengthOf(1);\n    expect($('[style=\"background-color:red\"]')).to.have.lengthOf(1);\n    expect($('[style=\"background-color:blue\"]')).to.have.lengthOf(1);\n    expect($(`[style='background-image:url(\"a\")']`)).to.have.lengthOf(1);\n  });","file":"astro-object-style.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Passes style attributes as expected to components","suites":["Object style"],"updatePoint":{"line":20,"column":55,"index":817},"line":20,"code":"  it('Passes style attributes as expected to components', async () => {\n    const html = await fixture.readFile('/component/index.html');\n    const $ = cheerio.load(html);\n    expect($('[style=\"background-color:green\"]')).to.have.lengthOf(1);\n    expect($('[style=\"background-color:red\"]')).to.have.lengthOf(1);\n    expect($('[style=\"background-color:blue\"]')).to.have.lengthOf(1);\n    expect($(`[style='background-image:url(\"a\")']`)).to.have.lengthOf(1);\n  });","file":"astro-object-style.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"outputs","suites":["build format"],"updatePoint":{"line":14,"column":13,"index":335},"line":14,"code":"  it('outputs', async () => {\n    expect(await fixture.readFile('/client.html')).to.be.ok;\n    expect(await fixture.readFile('/nested-md.html')).to.be.ok;\n    expect(await fixture.readFile('/nested-astro.html')).to.be.ok;\n  });","file":"astro-pageDirectoryUrl.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can find page with \"index\" at the end file name","suites":["Pages","Build"],"updatePoint":{"line":16,"column":55,"index":448},"line":16,"code":"    it('Can find page with \"index\" at the end file name', async () => {\n      const html = await fixture.readFile('/posts/name-with-index/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Name with index');\n    });","file":"astro-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can find page with quotes in file name","suites":["Pages","Build"],"updatePoint":{"line":21,"column":46,"index":693},"line":21,"code":"    it('Can find page with quotes in file name', async () => {\n      const html = await fixture.readFile(\"/quotes'-work-too/index.html\");\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Quotes work too');\n    });","file":"astro-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to load md pages","suites":["Pages","Development"],"updatePoint":{"line":36,"column":32,"index":1148},"line":36,"code":"    it('Is able to load md pages', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n      expect($('#testing').length).to.be.greaterThan(0);\n    });","file":"astro-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct prev url in root spread","suites":["Pagination root"],"updatePoint":{"line":14,"column":37,"index":412},"line":14,"code":"  it('correct prev url in root spread', async () => {\n    const prevMap = {\n      '/4/': '/3',\n      '/3/': '/2',\n      '/2/': '/',\n      '/': undefined\n    };\n    await Promise.all(Object.entries(prevMap).map(async ([curr, prev]) => {\n      const html = await fixture.readFile(curr + 'index.html');\n      const $ = cheerio.load(html);\n      expect($('#prev').attr('href')).to.equal(prev);\n    }));\n  });","file":"astro-pagination-root-spread.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"optional root page","suites":["Pagination"],"updatePoint":{"line":14,"column":24,"index":382},"line":14,"code":"  it('optional root page', async () => {\n    for (const file of ['/posts/optional-root-page/index.html', '/posts/optional-root-page/2/index.html', '/posts/optional-root-page/3/index.html']) {\n      expect(await fixture.readFile(file)).to.be.ok;\n    }\n  });","file":"astro-pagination.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"named root page","suites":["Pagination"],"updatePoint":{"line":19,"column":21,"index":636},"line":19,"code":"  it('named root page', async () => {\n    for (const file of ['/posts/named-root-page/1/index.html', '/posts/named-root-page/2/index.html', '/posts/named-root-page/3/index.html']) {\n      expect(await fixture.readFile(file)).to.be.ok;\n    }\n  });","file":"astro-pagination.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"multiple params","suites":["Pagination"],"updatePoint":{"line":24,"column":21,"index":883},"line":24,"code":"  it('multiple params', async () => {\n    const params = [{\n      color: 'red',\n      p: '1'\n    }, {\n      color: 'blue',\n      p: '1'\n    }, {\n      color: 'blue',\n      p: '2'\n    }];\n    await Promise.all(params.map(async ({\n      color,\n      p\n    }, idx) => {\n      const html = await fixture.readFile(`/posts/${color}/${p}/index.html`);\n      const $ = cheerio.load(html);\n      expect($('#page-param').text()).to.equal(p);\n      expect($('#currentPage').text()).to.equal(p);\n      expect($('#filter').text()).to.equal(color);\n      const prevHref = $('#prev').attr('href');\n      const nextHref = $('#next').attr('href');\n      if (color === 'red') {\n        expect(prevHref).to.be.undefined;\n        expect(nextHref).to.be.undefined;\n      }\n      if (color === 'blue' && p === '1') {\n        expect(prevHref).to.be.undefined;\n        expect(nextHref).to.equal('/posts/blue/2');\n      }\n      if (color === 'blue' && p === '2') {\n        expect(prevHref).to.equal('/posts/blue/1');\n        expect(nextHref).to.be.undefined;\n      }\n    }));\n  });","file":"astro-pagination.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"injects Astro styles and scripts","suites":["Partial HTML"],"updatePoint":{"line":16,"column":38,"index":444},"line":16,"code":"  it('injects Astro styles and scripts', async () => {\n    const html = await fixture.fetch('/astro').then(res => res.text());\n    const $ = cheerio.load(html);\n\n    // test 1: Doctype first\n    expect(html).to.match(/^<!DOCTYPE html/);\n\n    // test 2: correct CSS present\n    const allInjectedStyles = $('style').text();\n    expect(allInjectedStyles).to.match(/\\:where\\(\\.astro-[^{]+{color:red}/);\n  });","file":"astro-partial-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"injects framework styles","suites":["Partial HTML"],"updatePoint":{"line":27,"column":30,"index":841},"line":27,"code":"  it('injects framework styles', async () => {\n    const html = await fixture.fetch('/jsx').then(res => res.text());\n    const $ = cheerio.load(html);\n\n    // test 1: Doctype first\n    expect(html).to.match(/^<!DOCTYPE html/);\n\n    // test 2: link tag present\n    const allInjectedStyles = $('style').text().replace(/\\s*/g, '');\n    expect(allInjectedStyles).to.match(/h1{color:red;}/);\n  });","file":"astro-partial-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"pages with a head, injection happens inside","suites":["Partial HTML"],"updatePoint":{"line":38,"column":49,"index":1253},"line":38,"code":"  it('pages with a head, injection happens inside', async () => {\n    const html = await fixture.fetch('/with-head').then(res => res.text());\n    const $ = cheerio.load(html);\n    expect($('style')).to.have.lengthOf(1);\n  });","file":"astro-partial-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns custom headers for valid URLs","suites":["Astro preview headers","preview"],"updatePoint":{"line":25,"column":45,"index":635},"line":25,"code":"    it('returns custom headers for valid URLs', async () => {\n      const result = await fixture.fetch('/');\n      expect(result.status).to.equal(200);\n      expect(Object.fromEntries(result.headers)).to.include(headers);\n    });","file":"astro-preview-headers.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not return custom headers for invalid URLs","suites":["Astro preview headers","preview"],"updatePoint":{"line":30,"column":55,"index":875},"line":30,"code":"    it('does not return custom headers for invalid URLs', async () => {\n      const result = await fixture.fetch('/bad-url');\n      expect(result.status).to.equal(404);\n      expect(Object.fromEntries(result.headers)).not.to.include(headers);\n    });","file":"astro-preview-headers.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"css and js files do not get bundled","suites":["Public"],"updatePoint":{"line":11,"column":41,"index":299},"line":11,"code":"  it('css and js files do not get bundled', async () => {\n    let indexHtml = await fixture.readFile('/index.html');\n    expect(indexHtml).to.include('<script src=\"/example.js\"></script>');\n    expect(indexHtml).to.include('<link href=\"/example.css\" rel=\"stylesheet\">');\n    expect(indexHtml).to.include('<img src=\"/images/twitter.png\">');\n  });","file":"astro-public.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works from a page","suites":["Returning responses"],"updatePoint":{"line":19,"column":23,"index":506},"line":19,"code":"  it('Works from a page', async () => {\n    let response = await fixture.fetch('/not-found');\n    expect(response.status).to.equal(404);\n  });","file":"astro-response.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Moves external scripts up","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":19,"column":33,"index":530},"line":19,"code":"    it('Moves external scripts up', async () => {\n      const html = await fixture.readFile('/external/index.html');\n      const $ = cheerio.load(html);\n      expect($('head script[type=\"module\"]:not([src=\"/regular_script.js\"])')).to.have.lengthOf(1);\n      expect($('body script')).to.have.lengthOf(0);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Moves inline scripts up","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":25,"column":31,"index":840},"line":25,"code":"    it('Moves inline scripts up', async () => {\n      const html = await fixture.readFile('/inline/index.html');\n      const $ = cheerio.load(html);\n      expect($('head script[type=\"module\"]')).to.have.lengthOf(1);\n      expect($('body script')).to.have.lengthOf(0);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Inline page builds the scripts to a single bundle","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":31,"column":57,"index":1142},"line":31,"code":"    it('Inline page builds the scripts to a single bundle', async () => {\n      // Inline page\n      let inline = await fixture.readFile('/inline/index.html');\n      let $ = cheerio.load(inline);\n      let $el = $('script');\n\n      // test 1: Just one entry module\n      expect($el).to.have.lengthOf(1);\n      const src = $el.attr('src');\n      const inlineEntryJS = await fixture.readFile(src);\n\n      // test 3: the JS exists\n      expect(inlineEntryJS).to.be.ok;\n\n      // test 4: Inline imported JS is included\n      expect(inlineEntryJS).to.contain('I AM IMPORTED INLINE', 'The inline imported JS is included in the bundle');\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Inline scripts that are shared by multiple pages create chunks, and aren't inlined into the HTML","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":48,"column":104,"index":1828},"line":48,"code":"    it(\"Inline scripts that are shared by multiple pages create chunks, and aren't inlined into the HTML\", async () => {\n      let html = await fixture.readFile('/inline-shared-one/index.html');\n      let $ = cheerio.load(html);\n      expect($('script')).to.have.lengthOf(1);\n      expect($('script').attr('src')).to.not.equal(undefined);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"External page using non-hoist scripts that are modules are built standalone","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":54,"column":83,"index":2154},"line":54,"code":"    it('External page using non-hoist scripts that are modules are built standalone', async () => {\n      let external = await fixture.readFile('/external-no-hoist/index.html');\n      let $ = cheerio.load(external);\n\n      // test 1: there is 1 scripts\n      expect($('script')).to.have.lengthOf(1);\n\n      // test 2: inside assets\n      let entryURL = $('script').attr('src');\n      expect(entryURL.includes('_astro/')).to.equal(true);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"External page using non-hoist scripts that are not modules are built standalone","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":65,"column":87,"index":2603},"line":65,"code":"    it('External page using non-hoist scripts that are not modules are built standalone', async () => {\n      let external = await fixture.readFile('/external-no-hoist-classic/index.html');\n      let $ = cheerio.load(external);\n\n      // test 1: there is 1 scripts\n      expect($('script')).to.have.lengthOf(1);\n\n      // test 2: inside assets\n      let entryURL = $('script').attr('src');\n      expect(entryURL.includes('_astro/')).to.equal(true);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Scripts added via Astro.glob are hoisted","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":76,"column":48,"index":3021},"line":76,"code":"    it('Scripts added via Astro.glob are hoisted', async () => {\n      let glob = await fixture.readFile('/glob/index.html');\n      let $ = cheerio.load(glob);\n      expect($('script[type=\"module\"]').length).to.be.greaterThan(0);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Styles imported by hoisted scripts are included on the page","suites":["Scripts (hoisted and not)","Build"],"updatePoint":{"line":81,"column":67,"index":3278},"line":81,"code":"    it('Styles imported by hoisted scripts are included on the page', async () => {\n      let html = await fixture.readFile('/with-styles/index.html');\n      let $ = cheerio.load(html);\n\n      // Imported styles + tailwind\n      expect($('link[rel=stylesheet]')).to.have.a.lengthOf(2);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"External page builds the hoisted scripts to a single bundle","suites":["Scripts (hoisted and not)","Build","Inlining"],"updatePoint":{"line":98,"column":69,"index":3903},"line":98,"code":"      it('External page builds the hoisted scripts to a single bundle', async () => {\n        let external = await fixture.readFile('/external/index.html');\n        let $ = cheerio.load(external);\n\n        // test 1: there are two scripts\n        expect($('script')).to.have.lengthOf(2);\n        let el = $('script').get(1);\n        expect($(el).attr('src')).to.equal(undefined, 'This should have been inlined');\n        let externalEntryJS = $(el).text();\n\n        // test 2: the JS exists\n        expect(externalEntryJS).to.be.ok;\n      });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Scripts added via Astro.glob are hoisted","suites":["Scripts (hoisted and not)","Dev"],"updatePoint":{"line":132,"column":48,"index":4927},"line":132,"code":"    it('Scripts added via Astro.glob are hoisted', async () => {\n      let res = await fixture.fetch('/glob');\n      let html = await res.text();\n      let $ = cheerio.load(html);\n      let found = 0;\n      let moduleScripts = $('[type=module]');\n      moduleScripts.each((i, el) => {\n        if ($(el).attr('src').includes('Glob/GlobComponent.astro?astro&type=script&index=0&lang.ts')) {\n          found++;\n        }\n      });\n      expect(found).to.equal(1);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using injectScript does not interfere","suites":["Scripts (hoisted and not)","Dev"],"updatePoint":{"line":145,"column":45,"index":5393},"line":145,"code":"    it('Using injectScript does not interfere', async () => {\n      let res = await fixture.fetch('/inline-in-page');\n      let html = await res.text();\n      let $ = cheerio.load(html);\n      let found = 0;\n      let moduleScripts = $('[type=module]');\n      moduleScripts.each((i, el) => {\n        if ($(el).attr('src').includes('?astro&type=script&index=0&lang.ts')) {\n          found++;\n        }\n      });\n      expect(found).to.equal(1);\n    });","file":"astro-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Tags of dynamic tags works","suites":["Slots with client: directives"],"updatePoint":{"line":13,"column":32,"index":407},"line":13,"code":"  it('Tags of dynamic tags works', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('script')).to.have.a.lengthOf(1);\n  });","file":"astro-slot-with-client.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Hidden nested slots see their hydration scripts hoisted","suites":["Nested Slots"],"updatePoint":{"line":12,"column":61,"index":367},"line":12,"code":"  it('Hidden nested slots see their hydration scripts hoisted', async () => {\n    const html = await fixture.readFile('/hidden-nested/index.html');\n    const $ = cheerio.load(html);\n    expect($('script')).to.have.a.lengthOf(1, 'script rendered');\n    const scriptInTemplate = $($('template')[0].children[0]).find('script');\n    expect(scriptInTemplate).to.have.a.lengthOf(0, 'script defined outside of the inner template');\n  });","file":"astro-slots-nested.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots rendered via Astro.slots.render have the hydration script","suites":["Nested Slots"],"updatePoint":{"line":19,"column":69,"index":806},"line":19,"code":"  it('Slots rendered via Astro.slots.render have the hydration script', async () => {\n    const html = await fixture.readFile('/component-slot/index.html');\n    const $ = cheerio.load(html);\n    expect($('script')).to.have.a.lengthOf(1, 'script rendered');\n  });","file":"astro-slots-nested.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Basic named slots work","suites":["Slots"],"updatePoint":{"line":12,"column":28,"index":320},"line":12,"code":"  it('Basic named slots work', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#a').text().trim()).to.equal('A');\n    expect($('#b').text().trim()).to.equal('B');\n    expect($('#c').text().trim()).to.equal('C');\n    expect($('#default').text().trim()).to.equal('Default');\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Dynamic named slots work","suites":["Slots"],"updatePoint":{"line":20,"column":30,"index":671},"line":20,"code":"  it('Dynamic named slots work', async () => {\n    const html = await fixture.readFile('/dynamic/index.html');\n    const $ = cheerio.load(html);\n    expect($('#a').text().trim()).to.equal('A');\n    expect($('#b').text().trim()).to.equal('B');\n    expect($('#c').text().trim()).to.equal('C');\n    expect($('#default').text().trim()).to.equal('Default');\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Conditional named slots work","suites":["Slots"],"updatePoint":{"line":28,"column":34,"index":1034},"line":28,"code":"  it('Conditional named slots work', async () => {\n    const html = await fixture.readFile('/conditional/index.html');\n    const $ = cheerio.load(html);\n    expect($('#a').text().trim()).to.equal('A');\n    expect($('#b').text().trim()).to.equal('B');\n    expect($('#c').text().trim()).to.equal('C');\n    expect($('#default').text().trim()).to.equal('Default');\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots render fallback content by default","suites":["Slots"],"updatePoint":{"line":36,"column":46,"index":1413},"line":36,"code":"  it('Slots render fallback content by default', async () => {\n    const html = await fixture.readFile('/fallback/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default')).to.have.lengthOf(1);\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots override fallback content","suites":["Slots"],"updatePoint":{"line":41,"column":37,"index":1619},"line":41,"code":"  it('Slots override fallback content', async () => {\n    const html = await fixture.readFile('/fallback-override/index.html');\n    const $ = cheerio.load(html);\n    expect($('#override')).to.have.lengthOf(1);\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots work with multiple elements","suites":["Slots"],"updatePoint":{"line":46,"column":39,"index":1837},"line":46,"code":"  it('Slots work with multiple elements', async () => {\n    const html = await fixture.readFile('/multiple/index.html');\n    const $ = cheerio.load(html);\n    expect($('#a').text().trim()).to.equal('ABC');\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots work on Components","suites":["Slots"],"updatePoint":{"line":51,"column":30,"index":2040},"line":51,"code":"  it('Slots work on Components', async () => {\n    const html = await fixture.readFile('/component/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: #a renders\n    expect($('#a')).to.have.lengthOf(1);\n\n    // test 2: Slotted component into #a\n    expect($('#a').children('astro-component')).to.have.lengthOf(1);\n\n    // test 3: Slotted component into default slot\n    expect($('#default').children('astro-component')).to.have.lengthOf(1);\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots API work on Components","suites":["Slots"],"updatePoint":{"line":64,"column":34,"index":2503},"line":64,"code":"  it('Slots API work on Components', async () => {\n    // IDs will exist whether the slots are filled or not\n    {\n      const html = await fixture.readFile('/slottedapi-default/index.html');\n      const $ = cheerio.load(html);\n      expect($('#a')).to.have.lengthOf(1);\n      expect($('#b')).to.have.lengthOf(1);\n      expect($('#c')).to.have.lengthOf(1);\n      expect($('#default')).to.have.lengthOf(1);\n    }\n\n    // IDs will not exist because the slots are not filled\n    {\n      const html = await fixture.readFile('/slottedapi-empty/index.html');\n      const $ = cheerio.load(html);\n      expect($('#a')).to.have.lengthOf(0);\n      expect($('#b')).to.have.lengthOf(0);\n      expect($('#c')).to.have.lengthOf(0);\n      expect($('#default')).to.have.lengthOf(0);\n    }\n\n    // IDs will exist because the slots are filled\n    {\n      const html = await fixture.readFile('/slottedapi-filled/index.html');\n      const $ = cheerio.load(html);\n      expect($('#a')).to.have.lengthOf(1);\n      expect($('#b')).to.have.lengthOf(1);\n      expect($('#c')).to.have.lengthOf(1);\n      expect($('#default')).to.have.lengthOf(0); // the default slot is not filled\n    }\n\n    // Default ID will exist because the default slot is filled\n    {\n      const html = await fixture.readFile('/slottedapi-default-filled/index.html');\n      const $ = cheerio.load(html);\n      expect($('#a')).to.have.lengthOf(0);\n      expect($('#b')).to.have.lengthOf(0);\n      expect($('#c')).to.have.lengthOf(0);\n      expect($('#default')).to.have.lengthOf(1); // the default slot is filled\n    }\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Slots.render() API","suites":["Slots"],"updatePoint":{"line":106,"column":24,"index":4066},"line":106,"code":"  it('Slots.render() API', async () => {\n    // Simple imperative slot render\n    {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render')).to.have.lengthOf(1);\n      expect($('#render').text()).to.equal('render');\n    }\n\n    // Child function render without args\n    {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render-fn')).to.have.lengthOf(1);\n      expect($('#render-fn').text()).to.equal('render-fn');\n    }\n\n    // Child function render with args\n    {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render-args')).to.have.lengthOf(1);\n      expect($('#render-args span')).to.have.lengthOf(1);\n      expect($('#render-args').text()).to.equal('render-args');\n    }\n  });","file":"astro-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Writes types to `.astro`","suites":["astro sync"],"updatePoint":{"line":11,"column":30,"index":303},"line":11,"code":"  it('Writes types to `.astro`', async () => {\n    let writtenFiles = {};\n    const fsMock = {\n      ...fs,\n      promises: {\n        ...fs.promises,\n        async writeFile(path, contents) {\n          writtenFiles[path] = contents;\n        }\n      }\n    };\n    await fixture.sync({\n      fs: fsMock\n    });\n    const expectedTypesFile = new URL('.astro/types.d.ts', fixture.config.root).href;\n    expect(writtenFiles).to.haveOwnProperty(expectedTypesFile);\n    // smoke test `astro check` asserts whether content types pass.\n    expect(writtenFiles[expectedTypesFile]).to.include(`declare module 'astro:content' {`, 'Types file does not include `astro:content` module declaration');\n  });","file":"astro-sync.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds type reference to `src/env.d.ts`","suites":["astro sync"],"updatePoint":{"line":30,"column":43,"index":1006},"line":30,"code":"  it('Adds type reference to `src/env.d.ts`', async () => {\n    let writtenFiles = {};\n    const typesEnvPath = new URL('env.d.ts', fixture.config.srcDir).href;\n    const fsMock = {\n      ...fs,\n      existsSync(path, ...args) {\n        if (path.toString() === typesEnvPath) {\n          return true;\n        }\n        return fs.existsSync(path, ...args);\n      },\n      promises: {\n        ...fs.promises,\n        async readFile(path, ...args) {\n          if (path.toString() === typesEnvPath) {\n            return `/// <reference path=\"astro/client\" />`;\n          } else {\n            return fs.promises.readFile(path, ...args);\n          }\n        },\n        async writeFile(path, contents) {\n          writtenFiles[path] = contents;\n        }\n      }\n    };\n    await fixture.sync({\n      fs: fsMock\n    });\n    expect(writtenFiles, 'Did not try to update env.d.ts file.').to.haveOwnProperty(typesEnvPath);\n    expect(writtenFiles[typesEnvPath]).to.include(`/// <reference path=\"../.astro/types.d.ts\" />`);\n  });","file":"astro-sync.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Writes `src/env.d.ts` if none exists","suites":["astro sync"],"updatePoint":{"line":61,"column":42,"index":2022},"line":61,"code":"  it('Writes `src/env.d.ts` if none exists', async () => {\n    let writtenFiles = {};\n    const typesEnvPath = new URL('env.d.ts', fixture.config.srcDir).href;\n    const fsMock = {\n      ...fs,\n      existsSync(path, ...args) {\n        if (path.toString() === typesEnvPath) {\n          return false;\n        }\n        return fs.existsSync(path, ...args);\n      },\n      promises: {\n        ...fs.promises,\n        async writeFile(path, contents) {\n          writtenFiles[path] = contents;\n        }\n      }\n    };\n    await fixture.sync({\n      fs: fsMock\n    });\n    expect(writtenFiles, 'Did not try to write env.d.ts file.').to.haveOwnProperty(typesEnvPath);\n    expect(writtenFiles[typesEnvPath]).to.include(`/// <reference types=\"astro/client\" />`);\n    expect(writtenFiles[typesEnvPath]).to.include(`/// <reference path=\"../.astro/types.d.ts\" />`);\n  });","file":"astro-sync.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is included in the astro-island","suites":["Astro Scripts before-hydration","SSG","Is used by an integration","Development"],"updatePoint":{"line":35,"column":43,"index":1201},"line":35,"code":"        it('Is included in the astro-island', async () => {\n          let res = await fixture.fetch('/');\n          let html = await res.text();\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(1);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is included in the astro-island","suites":["Astro Scripts before-hydration","SSG","Is used by an integration","Build"],"updatePoint":{"line":46,"column":43,"index":1589},"line":46,"code":"        it('Is included in the astro-island', async () => {\n          let html = await fixture.readFile('/index.html');\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(1);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does include before-hydration-url on the astro-island","suites":["Astro Scripts before-hydration","SSG","Is not used by an integration","Development"],"updatePoint":{"line":70,"column":65,"index":2421},"line":70,"code":"        it('Does include before-hydration-url on the astro-island', async () => {\n          let res = await fixture.fetch('/');\n          let html = await res.text();\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(1);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not include before-hydration-url on the astro-island","suites":["Astro Scripts before-hydration","SSG","Is not used by an integration","Build"],"updatePoint":{"line":81,"column":69,"index":2835},"line":81,"code":"        it('Does not include before-hydration-url on the astro-island', async () => {\n          let html = await fixture.readFile('/index.html');\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(0);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is included in the astro-island","suites":["Astro Scripts before-hydration","SSR","Is used by an integration","Prod"],"updatePoint":{"line":114,"column":43,"index":3871},"line":114,"code":"        it('Is included in the astro-island', async () => {\n          let app = await fixture.loadTestAdapterApp();\n          let request = new Request('http://example.com/');\n          let response = await app.render(request);\n          let html = await response.text();\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(1);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not include before-hydration-url on the astro-island","suites":["Astro Scripts before-hydration","SSR","Is not used by an integration","Build"],"updatePoint":{"line":138,"column":69,"index":4741},"line":138,"code":"        it('Does not include before-hydration-url on the astro-island', async () => {\n          let app = await fixture.loadTestAdapterApp();\n          let request = new Request('http://example.com/');\n          let response = await app.render(request);\n          let html = await response.text();\n          let $ = cheerio.load(html);\n          expect($('astro-island[before-hydration-url]')).has.a.lengthOf(0);\n        });","file":"before-hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Populates /_astro directory","suites":["build assets (static)","with default configuration"],"updatePoint":{"line":17,"column":35,"index":599},"line":17,"code":"    it('Populates /_astro directory', async () => {\n      let files = await fixture.readdir('/_astro');\n      expect(files.length).to.be.greaterThan(0);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Defaults to flat /_astro output","suites":["build assets (static)","with default configuration"],"updatePoint":{"line":21,"column":39,"index":764},"line":21,"code":"    it('Defaults to flat /_astro output', async () => {\n      let files = await fixture.readdir('/_astro');\n      for (const file of files) {\n        expect(file.slice(1)).to.not.contain('/');\n      }\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits CSS assets to /_astro","suites":["build assets (static)","with default configuration"],"updatePoint":{"line":27,"column":35,"index":969},"line":27,"code":"    it('emits CSS assets to /_astro', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      expect($('link[href$=\".css\"]').attr('href')).to.match(/^\\/_astro\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits JS assets to /_astro","suites":["build assets (static)","with default configuration"],"updatePoint":{"line":32,"column":34,"index":1194},"line":32,"code":"    it('emits JS assets to /_astro', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      const island = $('astro-island');\n      expect(island.length).to.eq(1);\n      expect(island.attr('component-url')).to.match(/^\\/_astro\\//);\n      expect(island.attr('renderer-url')).to.match(/^\\/_astro\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Populates /custom-assets directory","suites":["build assets (static)","with custom configuration"],"updatePoint":{"line":54,"column":42,"index":1930},"line":54,"code":"    it('Populates /custom-assets directory', async () => {\n      let files = await fixture.readdir('/custom-assets');\n      expect(files.length).to.be.greaterThan(0);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits CSS assets to /custom-assets","suites":["build assets (static)","with custom configuration"],"updatePoint":{"line":58,"column":42,"index":2105},"line":58,"code":"    it('emits CSS assets to /custom-assets', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      expect($('link[href$=\".css\"]').attr('href')).to.match(/^\\/custom-assets\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits JS assets to /custom-assets","suites":["build assets (static)","with custom configuration"],"updatePoint":{"line":63,"column":41,"index":2344},"line":63,"code":"    it('emits JS assets to /custom-assets', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      const island = $('astro-island');\n      expect(island.length).to.eq(1);\n      expect(island.attr('component-url')).to.match(/^\\/custom-assets\\//);\n      expect(island.attr('renderer-url')).to.match(/^\\/custom-assets\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Populates /_astro directory","suites":["build assets (server)","with default configuration"],"updatePoint":{"line":85,"column":35,"index":3104},"line":85,"code":"    it('Populates /_astro directory', async () => {\n      let files = await fixture.readdir('/_astro');\n      expect(files.length).to.be.greaterThan(0);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Defaults to flat /_astro output","suites":["build assets (server)","with default configuration"],"updatePoint":{"line":89,"column":39,"index":3269},"line":89,"code":"    it('Defaults to flat /_astro output', async () => {\n      let files = await fixture.readdir('/_astro');\n      for (const file of files) {\n        expect(file.slice(1)).to.not.contain('/');\n      }\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits CSS assets to /_astro","suites":["build assets (server)","with default configuration"],"updatePoint":{"line":95,"column":35,"index":3474},"line":95,"code":"    it('emits CSS assets to /_astro', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      expect($('link[href$=\".css\"]').attr('href')).to.match(/^\\/_astro\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits JS assets to /_astro","suites":["build assets (server)","with default configuration"],"updatePoint":{"line":100,"column":34,"index":3699},"line":100,"code":"    it('emits JS assets to /_astro', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      const island = $('astro-island');\n      expect(island.length).to.eq(1);\n      expect(island.attr('component-url')).to.match(/^\\/_astro\\//);\n      expect(island.attr('renderer-url')).to.match(/^\\/_astro\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Populates /custom-assets directory","suites":["build assets (server)","with custom configuration"],"updatePoint":{"line":123,"column":42,"index":4467},"line":123,"code":"    it('Populates /custom-assets directory', async () => {\n      let files = await fixture.readdir('/custom-assets');\n      expect(files.length).to.be.greaterThan(0);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits CSS assets to /custom-assets","suites":["build assets (server)","with custom configuration"],"updatePoint":{"line":127,"column":42,"index":4642},"line":127,"code":"    it('emits CSS assets to /custom-assets', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      expect($('link[href$=\".css\"]').attr('href')).to.match(/^\\/custom-assets\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"emits JS assets to /custom-assets","suites":["build assets (server)","with custom configuration"],"updatePoint":{"line":132,"column":41,"index":4881},"line":132,"code":"    it('emits JS assets to /custom-assets', async () => {\n      let html = await fixture.readFile('/index.html');\n      let $ = cheerio.load(html);\n      const island = $('astro-island');\n      expect(island.length).to.eq(1);\n      expect(island.attr('component-url')).to.match(/^\\/custom-assets\\//);\n      expect(island.attr('renderer-url')).to.match(/^\\/custom-assets\\//);\n    });","file":"build-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro","suites":["astro cli"],"updatePoint":{"line":14,"column":11,"index":635},"line":14,"code":"  it('astro', async () => {\n    const proc = await cli();\n    expect(proc.exitCode).to.equal(0);\n  });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro check --watch reports errors on modified files","suites":["astro cli"],"line":20,"code":"  it.skip('astro check --watch reports errors on modified files', async () => {","file":"cli.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"astro --version","suites":["astro cli"],"updatePoint":{"line":64,"column":21,"index":2303},"line":64,"code":"  it('astro --version', async () => {\n    const pkgURL = new URL('../package.json', import.meta.url);\n    const pkgVersion = await fs.readFile(pkgURL, 'utf8').then(data => JSON.parse(data).version);\n    const proc = await cli('--version');\n    expect(proc.stdout).to.include(pkgVersion);\n  });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro check no errors","suites":["astro cli"],"updatePoint":{"line":70,"column":27,"index":2603},"line":70,"code":"  it('astro check no errors', async () => {\n    let proc = undefined;\n    const projectRootURL = new URL('./fixtures/astro-check-no-errors/', import.meta.url);\n    try {\n      proc = await cli('check', '--root', fileURLToPath(projectRootURL));\n    } catch (err) {}\n    expect(proc?.stdout).to.include('0 errors');\n  }).timeout(35000);","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro check has errors","suites":["astro cli"],"updatePoint":{"line":78,"column":28,"index":2939},"line":78,"code":"  it('astro check has errors', async () => {\n    let stdout = undefined;\n    const projectRootURL = new URL('./fixtures/astro-check-errors/', import.meta.url);\n\n    // When `astro check` finds errors, it returns an error code. As such, we need to wrap this\n    // in a try/catch because otherwise Mocha will always report this test as a fail\n    try {\n      await cli('check', '--root', fileURLToPath(projectRootURL));\n    } catch (err) {\n      stdout = err.toString();\n    }\n    expect(stdout).to.include('1 error');\n  }).timeout(35000);","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro dev welcome","suites":["astro cli"],"updatePoint":{"line":91,"column":23,"index":3473},"line":91,"code":"  it('astro dev welcome', async () => {\n    const pkgURL = new URL('../package.json', import.meta.url);\n    const pkgVersion = await fs.readFile(pkgURL, 'utf8').then(data => JSON.parse(data).version);\n    const projectRootURL = new URL('./fixtures/astro-basic/', import.meta.url);\n    const proc = cli('dev', '--root', fileURLToPath(projectRootURL));\n    const {\n      messages\n    } = await parseCliDevStart(proc);\n    expect(messages[0]).to.contain('astro');\n    expect(messages[0]).to.contain(pkgVersion);\n    expect(messages[0]).to.contain('started in');\n  });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro    - network log","suites":["astro cli"],"updatePoint":{"line":106,"column":63,"index":4234},"line":106,"code":"      it(`astro ${cmd} ${flag} ${flagValue ?? ''} - network log`, async () => {\n        const {\n          local,\n          network\n        } = await cliServerLogSetupWithFixture(flagValue ? [flag, flagValue] : [flag], cmd);\n        expect(local).to.not.be.undefined;\n        expect(network).to.not.be.undefined;\n        const localURL = new URL(local);\n        const networkURL = new URL(network);\n        expect(localURL.hostname).to.be.oneOf(['localhost', '127.0.0.1'], `Expected local URL to be on localhost`);\n\n        // Note: our tests run in parallel so this could be 3000+!\n        expect(Number.parseInt(localURL.port)).to.be.greaterThanOrEqual(3000, `Expected Port to be >= 3000`);\n        expect(networkURL.port).to.be.equal(localURL.port, `Expected local and network ports to be equal`);\n        expect(isIPv4(networkURL.hostname)).to.be.equal(true, `Expected network URL to respect --host flag`);\n      });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro    - host to expose","suites":["astro cli"],"updatePoint":{"line":125,"column":60,"index":5256},"line":125,"code":"      it(`astro ${cmd} ${flag} ${flagValue} - host to expose`, async () => {\n        const {\n          local,\n          network\n        } = await cliServerLogSetupWithFixture([flag, flagValue], cmd);\n        expect(local).to.not.be.undefined;\n        expect(network).to.not.be.undefined;\n        const localURL = new URL(local);\n        expect(localURL.hostname).to.be.oneOf(['localhost', '127.0.0.1'], `Expected local URL to be on localhost`);\n        expect(() => new URL(networkURL)).to.throw();\n      });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro    - no network log","suites":["astro cli"],"updatePoint":{"line":139,"column":60,"index":5910},"line":139,"code":"      it(`astro ${cmd} ${flag} ${flagValue} - no network log`, async () => {\n        const {\n          local,\n          network\n        } = await cliServerLogSetupWithFixture([flag, flagValue], cmd);\n        expect(local).to.not.be.undefined;\n        expect(network).to.be.undefined;\n        const localURL = new URL(local);\n        expect(localURL.hostname).to.be.oneOf(['localhost', '127.0.0.1'], `Expected local URL to be on localhost`);\n      });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"astro does NOT throw on \"\" locales","suites":["astro cli i18n"],"updatePoint":{"line":155,"column":51,"index":6508},"line":155,"code":"    it(`astro does NOT throw on \"${locale}\" locales`, async () => {\n      const projectRootURL = new URL('./fixtures/astro-basic/', import.meta.url);\n      let error = null;\n      try {\n        const proc = cli('dev', '--root', fileURLToPath(projectRootURL), {\n          env: {\n            LANG: locale\n          }\n        });\n        await parseCliDevStart(proc);\n      } catch (e) {\n        console.log(e);\n        error = e.message;\n      }\n      expect(error).to.be.null;\n    });","file":"cli.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can get the address","suites":["Astro.clientAddress","SSR","Production"],"updatePoint":{"line":21,"column":29,"index":671},"line":21,"code":"      it('Can get the address', async () => {\n        const app = await fixture.loadTestAdapterApp();\n        const request = new Request('http://example.com/');\n        const response = await app.render(request);\n        const html = await response.text();\n        const $ = cheerio.load(html);\n        expect($('#address').text()).to.equal('0.0.0.0');\n      });","file":"client-address.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Gets the address","suites":["Astro.clientAddress","SSR","Development"],"updatePoint":{"line":39,"column":26,"index":1308},"line":39,"code":"      it('Gets the address', async () => {\n        let res = await fixture.fetch('/');\n        expect(res.status).to.equal(200);\n        let html = await res.text();\n        let $ = cheerio.load(html);\n        let address = $('#address');\n\n        // Just checking that something is here. Not specifying address as it\n        // might differ per machine.\n        expect(address.length).to.be.greaterThan(0);\n      });","file":"client-address.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Gets an error message","suites":["Astro.clientAddress","SSR adapter not implemented"],"updatePoint":{"line":65,"column":29,"index":2112},"line":65,"code":"    it('Gets an error message', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/');\n      const response = await app.render(request);\n      expect(response.status).to.equal(500);\n    });","file":"client-address.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws during generation","suites":["Astro.clientAddress","SSG","Build"],"updatePoint":{"line":82,"column":34,"index":2655},"line":82,"code":"      it('throws during generation', async () => {\n        try {\n          await fixture.build();\n          expect(false).to.equal(true, 'Build should not have completed');\n        } catch (err) {\n          expect(err.message).to.match(/Astro\\.clientAddress/, 'Error message mentions Astro.clientAddress');\n        }\n      });","file":"client-address.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is not accessible","suites":["Astro.clientAddress","SSG","Development"],"updatePoint":{"line":107,"column":27,"index":3432},"line":107,"code":"      it('is not accessible', async () => {\n        let res = await fixture.fetch('/');\n        expect(res.status).to.equal(500);\n      });","file":"client-address.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Debug component styles are not included in the page","suites":["Code component"],"updatePoint":{"line":13,"column":57,"index":409},"line":13,"code":"  it('Debug component styles are not included in the page', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    expect($('link[rel=stylesheet]')).to.have.a.lengthOf(0, 'No styles should be built');\n    expect($('style')).to.have.a.lengthOf(0);\n  });","file":"code-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is:raw attribute not serialized","suites":["Code component"],"updatePoint":{"line":19,"column":37,"index":691},"line":19,"code":"  it('is:raw attribute not serialized', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    expect($('pre').attr('is:raw')).to.equal(undefined);\n  });","file":"code-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Built .astro pages","suites":["Component Libraries","build"],"updatePoint":{"line":34,"column":26,"index":1070},"line":34,"code":"    it('Built .astro pages', async () => {\n      let html = await fixture.readFile('/with-astro/index.html');\n      expect(html).to.be.a('string');\n      html = await fixture.readFile('/with-react/index.html');\n      expect(html).to.be.a('string');\n      html = await fixture.readFile('/internal-hydration/index.html');\n      expect(html).to.be.a('string');\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with .astro components","suites":["Component Libraries","build"],"updatePoint":{"line":42,"column":36,"index":1446},"line":42,"code":"    it('Works with .astro components', async () => {\n      const html = await fixture.readFile('/with-astro/index.html');\n      const $ = cheerioLoad(html);\n      expect($('button').text()).to.equal('Click me', \"Rendered the component's slot\");\n      const findEvidence = createFindEvidence(/border-radius:( )*1rem/);\n      expect(await findEvidence('with-astro/index.html')).to.equal(true, \"Included the .astro component's <style>\");\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with react components","suites":["Component Libraries","build"],"updatePoint":{"line":49,"column":35,"index":1888},"line":49,"code":"    it('Works with react components', async () => {\n      const html = await fixture.readFile('/with-react/index.html');\n      const $ = cheerioLoad(html);\n      expect($('#react-static').text()).to.equal('Hello static!', 'Rendered the static component');\n      expect($('#react-idle').text()).to.equal('Hello idle!', 'Rendered the client hydrated component');\n      expect($('astro-island[uid]')).to.have.lengthOf(1, 'Included one hydration island');\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with components hydrated internally","suites":["Component Libraries","build"],"updatePoint":{"line":56,"column":49,"index":2362},"line":56,"code":"    it('Works with components hydrated internally', async () => {\n      const html = await fixture.readFile('/internal-hydration/index.html');\n      const $ = cheerioLoad(html);\n      expect($('.counter').length).to.equal(1, 'Rendered the svelte counter');\n      expect($('.counter-message').text().trim()).to.equal('Hello, Svelte!', \"rendered the counter's slot\");\n      expect($('astro-island[uid]')).to.have.lengthOf(1, 'Included one hydration island');\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with .astro components","suites":["Component Libraries","dev"],"updatePoint":{"line":95,"column":36,"index":3849},"line":95,"code":"    it('Works with .astro components', async () => {\n      const html = await fixture.fetch('/with-astro/').then(res => res.text());\n      const $ = cheerioLoad(html);\n      expect($('button').text()).to.equal('Click me', \"Rendered the component's slot\");\n      const findEvidence = createFindEvidence(/border-radius:( )*1rem/);\n      expect(await findEvidence('/with-astro/')).to.equal(true, \"Included the .astro component's <style>\");\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with react components","suites":["Component Libraries","dev"],"updatePoint":{"line":102,"column":35,"index":4293},"line":102,"code":"    it('Works with react components', async () => {\n      const html = await fixture.fetch('/with-react/').then(res => res.text());\n      const $ = cheerioLoad(html);\n      expect($('#react-static').text()).to.equal('Hello static!', 'Rendered the static component');\n      expect($('#react-idle').text()).to.equal('Hello idle!', 'Rendered the client hydrated component');\n      expect($('astro-island[uid]')).to.have.lengthOf(1, 'Included one hydration island');\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with components hydrated internally","suites":["Component Libraries","dev"],"updatePoint":{"line":109,"column":49,"index":4778},"line":109,"code":"    it('Works with components hydrated internally', async () => {\n      const html = await fixture.fetch('/internal-hydration/').then(res => res.text());\n      const $ = cheerioLoad(html);\n      expect($('.counter').length).to.equal(1, 'Rendered the svelte counter');\n      expect($('.counter-message').text().trim()).to.equal('Hello, Svelte!', \"rendered the counter's slot\");\n      expect($('astro-island[uid]')).to.have.lengthOf(1, 'Included one hydration island');\n    });","file":"component-library.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds an SSR-able app","suites":["AstroConfig - config.output","output: 'server'","deploy config provided"],"updatePoint":{"line":19,"column":32,"index":698},"line":19,"code":"      it('Builds an SSR-able app', async () => {\n        const app = await fixture.loadTestAdapterApp();\n        const request = new Request('http://example.com/');\n        const response = await app.render(request);\n        expect(response.status).to.equal(200);\n        expect(response.headers.get('content-type')).to.equal('text/html');\n        const html = await response.text();\n        expect(html.length).to.be.greaterThan(0);\n      });","file":"config-mode.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Throws during the build","suites":["AstroConfig - config.output","output: 'server'","deploy config omitted"],"updatePoint":{"line":39,"column":33,"index":1493},"line":39,"code":"      it('Throws during the build', async () => {\n        let built = false;\n        try {\n          await fixture.build();\n          built = true;\n        } catch (err) {\n          expect(err).to.be.an.instanceOf(Error);\n          expect(err.message).to.match(/without an adapter/);\n        }\n        expect(built).to.equal(false, 'Should not have built');\n      });","file":"config-mode.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds to static HTML","suites":["AstroConfig - config.output","output: 'static'","Output config omitted"],"updatePoint":{"line":64,"column":31,"index":2285},"line":64,"code":"      it('Builds to static HTML', async () => {\n        let html;\n        try {\n          html = await fixture.readFile('/index.html');\n        } catch (err) {\n          expect(false).to.equal(true, 'Couldnt find the file, which mean it did not build.');\n        }\n        expect(html.length).to.be.greaterThan(0);\n      });","file":"config-mode.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.build.cssTarget is respected","suites":["CSS","build"],"updatePoint":{"line":28,"column":41,"index":823},"line":28,"code":"    it('vite.build.cssTarget is respected', async () => {\n      expect(bundledCSS).to.match(new RegExp('.class\\\\:where\\\\(.astro-[^{]*{top:0;right:0;bottom:0;left:0}'));\n    });","file":"config-vite-css-target.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows overriding bundle naming options in the build","suites":["Vite Config"],"updatePoint":{"line":12,"column":58,"index":362},"line":12,"code":"  it('Allows overriding bundle naming options in the build', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('link').attr('href')).to.match(/\\/assets\\/testing-[a-z0-9]+\\.css/);\n  });","file":"config-vite.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes CSS for rendered entry","suites":["Content Collections - render()","Build - SSG"],"updatePoint":{"line":16,"column":39,"index":575},"line":16,"code":"    it('Includes CSS for rendered entry', async () => {\n      const html = await fixture.readFile('/launch-week/index.html');\n      const $ = cheerio.load(html);\n\n      // Renders content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Includes styles\n      expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Excludes CSS for non-rendered entries","suites":["Content Collections - render()","Build - SSG"],"updatePoint":{"line":26,"column":45,"index":914},"line":26,"code":"    it('Excludes CSS for non-rendered entries', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n\n      // Excludes styles\n      expect($('link[rel=stylesheet]')).to.have.a.lengthOf(0);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes component scripts for rendered entry","suites":["Content Collections - render()","Build - SSG"],"updatePoint":{"line":33,"column":53,"index":1175},"line":33,"code":"    it('Includes component scripts for rendered entry', async () => {\n      const html = await fixture.readFile('/launch-week-component-scripts/index.html');\n      const $ = cheerio.load(html);\n      const allScripts = $('head > script[type=\"module\"]');\n      expect(allScripts).to.have.length;\n\n      // Includes hoisted script\n      expect([...allScripts].find(script => $(script).attr('src')?.includes('WithScripts')), '`WithScripts.astro` hoisted script missing from head.').to.not.be.undefined;\n\n      // Includes inline script\n      expect($('script[data-is-inline]')).to.have.a.lengthOf(1);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Excludes component scripts for non-rendered entries","suites":["Content Collections - render()","Build - SSG"],"updatePoint":{"line":45,"column":59,"index":1787},"line":45,"code":"    it('Excludes component scripts for non-rendered entries', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const allScripts = $('head > script[type=\"module\"]');\n\n      // Excludes hoisted script\n      expect([...allScripts].find(script => $(script).text().includes('document.querySelector(\"#update-me\")')), '`WithScripts.astro` hoisted script included unexpectedly.').to.be.undefined;\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Applies MDX components export","suites":["Content Collections - render()","Build - SSG"],"updatePoint":{"line":53,"column":37,"index":2227},"line":53,"code":"    it('Applies MDX components export', async () => {\n      const html = await fixture.readFile('/launch-week-components-export/index.html');\n      const $ = cheerio.load(html);\n      const h2 = $('h2');\n      expect(h2).to.have.a.lengthOf(1);\n      expect(h2.attr('data-components-export-applied')).to.equal('true');\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes CSS for rendered entry","suites":["Content Collections - render()","Build - SSR"],"updatePoint":{"line":72,"column":39,"index":2864},"line":72,"code":"    it('Includes CSS for rendered entry', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/launch-week');\n      const response = await app.render(request);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n\n      // Renders content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Includes styles\n      expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Exclude CSS for non-rendered entries","suites":["Content Collections - render()","Build - SSR"],"updatePoint":{"line":85,"column":44,"index":3347},"line":85,"code":"    it('Exclude CSS for non-rendered entries', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/');\n      const response = await app.render(request);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n\n      // Includes styles\n      expect($('link[rel=stylesheet]')).to.have.a.lengthOf(0);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Applies MDX components export","suites":["Content Collections - render()","Build - SSR"],"updatePoint":{"line":95,"column":37,"index":3738},"line":95,"code":"    it('Applies MDX components export', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/launch-week-components-export');\n      const response = await app.render(request);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      const h2 = $('h2');\n      expect(h2).to.have.a.lengthOf(1);\n      expect(h2.attr('data-components-export-applied')).to.equal('true');\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes CSS for rendered entry","suites":["Content Collections - render()","Dev - SSG"],"updatePoint":{"line":119,"column":39,"index":4562},"line":119,"code":"    it('Includes CSS for rendered entry', async () => {\n      const response = await fixture.fetch('/launch-week', {\n        method: 'GET'\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n\n      // Renders content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Includes styles\n      expect($('head > style')).to.have.a.lengthOf(1);\n      expect($('head > style').text()).to.include(\"font-family: 'Comic Sans MS'\");\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes component scripts for rendered entry","suites":["Content Collections - render()","Dev - SSG"],"updatePoint":{"line":134,"column":53,"index":5094},"line":134,"code":"    it('Includes component scripts for rendered entry', async () => {\n      const response = await fixture.fetch('/launch-week-component-scripts', {\n        method: 'GET'\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      const allScripts = $('head > script[src]');\n      expect(allScripts).to.have.length;\n\n      // Includes hoisted script\n      expect([...allScripts].find(script => script.attribs.src.includes('WithScripts.astro')), '`WithScripts.astro` hoisted script missing from head.').to.not.be.undefined;\n\n      // Includes inline script\n      expect($('script[data-is-inline]')).to.have.a.lengthOf(1);\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Applies MDX components export","suites":["Content Collections - render()","Dev - SSG"],"updatePoint":{"line":150,"column":37,"index":5786},"line":150,"code":"    it('Applies MDX components export', async () => {\n      const response = await fixture.fetch('/launch-week-components-export', {\n        method: 'GET'\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      const h2 = $('h2');\n      expect(h2).to.have.a.lengthOf(1);\n      expect(h2.attr('data-components-export-applied')).to.equal('true');\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Supports layout prop with recursive getCollection() call","suites":["Content Collections - render()","Dev - SSG"],"updatePoint":{"line":161,"column":64,"index":6249},"line":161,"code":"    it('Supports layout prop with recursive getCollection() call', async () => {\n      const response = await fixture.fetch('/with-layout-prop', {\n        method: 'GET'\n      });\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      const body = $('body');\n      expect(body.attr('data-layout-prop')).to.equal('true');\n      const h1 = $('h1');\n      expect(h1).to.have.a.lengthOf(1);\n      expect(h1.text()).to.equal('With Layout Prop');\n      const h2 = $('h2');\n      expect(h2).to.have.a.lengthOf(1);\n      expect(h2.text()).to.equal('Content with a layout prop');\n    });","file":"content-collections-render.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `without config` collection","suites":["Content Collections","Query","Collection"],"updatePoint":{"line":22,"column":45,"index":750},"line":22,"code":"      it('Returns `without config` collection', async () => {\n        expect(json).to.haveOwnProperty('withoutConfig');\n        expect(Array.isArray(json.withoutConfig)).to.equal(true);\n        const ids = json.withoutConfig.map(item => item.id);\n        expect(ids).to.deep.equal(['columbia.md', 'endeavour.md', 'enterprise.md',\n        // Spaces allowed in IDs\n        'promo/launch week.mdx']);\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Handles spaces in `without config` slugs","suites":["Content Collections","Query","Collection"],"updatePoint":{"line":30,"column":50,"index":1163},"line":30,"code":"      it('Handles spaces in `without config` slugs', async () => {\n        expect(json).to.haveOwnProperty('withoutConfig');\n        expect(Array.isArray(json.withoutConfig)).to.equal(true);\n        const slugs = json.withoutConfig.map(item => item.slug);\n        expect(slugs).to.deep.equal(['columbia', 'endeavour', 'enterprise',\n        // \"launch week.mdx\" is converted to \"launch-week.mdx\"\n        'promo/launch-week']);\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with schema` collection","suites":["Content Collections","Query","Collection"],"updatePoint":{"line":38,"column":42,"index":1591},"line":38,"code":"      it('Returns `with schema` collection', async () => {\n        expect(json).to.haveOwnProperty('withSchemaConfig');\n        expect(Array.isArray(json.withSchemaConfig)).to.equal(true);\n        const ids = json.withSchemaConfig.map(item => item.id);\n        const publishedDates = json.withSchemaConfig.map(item => item.data.publishedAt);\n        expect(ids).to.deep.equal(['one.md', 'three.md', 'two.md']);\n        expect(publishedDates.every(date => date instanceof Date)).to.equal(true, 'Not all publishedAt dates are Date objects');\n        expect(publishedDates.map(date => date.toISOString())).to.deep.equal(['2021-01-01T00:00:00.000Z', '2021-01-03T00:00:00.000Z', '2021-01-02T00:00:00.000Z']);\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with custom slugs` collection","suites":["Content Collections","Query","Collection"],"updatePoint":{"line":47,"column":48,"index":2311},"line":47,"code":"      it('Returns `with custom slugs` collection', async () => {\n        expect(json).to.haveOwnProperty('withSlugConfig');\n        expect(Array.isArray(json.withSlugConfig)).to.equal(true);\n        const slugs = json.withSlugConfig.map(item => item.slug);\n        expect(slugs).to.deep.equal(['fancy-one', 'excellent-three', 'interesting-two']);\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with union schema` collection","suites":["Content Collections","Query","Collection"],"updatePoint":{"line":53,"column":48,"index":2668},"line":53,"code":"      it('Returns `with union schema` collection', async () => {\n        expect(json).to.haveOwnProperty('withUnionSchema');\n        expect(Array.isArray(json.withUnionSchema)).to.equal(true);\n        const post = json.withUnionSchema.find(item => item.id === 'post.md');\n        expect(post).to.not.be.undefined;\n        expect(post.data).to.deep.equal({\n          type: 'post',\n          title: 'My Post',\n          description: 'This is my post'\n        });\n        const newsletter = json.withUnionSchema.find(item => item.id === 'newsletter.md');\n        expect(newsletter).to.not.be.undefined;\n        expect(newsletter.data).to.deep.equal({\n          type: 'newsletter',\n          subject: 'My Newsletter'\n        });\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `without config` collection entry","suites":["Content Collections","Query","Entry"],"updatePoint":{"line":77,"column":51,"index":3601},"line":77,"code":"      it('Returns `without config` collection entry', async () => {\n        expect(json).to.haveOwnProperty('columbiaWithoutConfig');\n        expect(json.columbiaWithoutConfig.id).to.equal('columbia.md');\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with schema` collection entry","suites":["Content Collections","Query","Entry"],"updatePoint":{"line":81,"column":48,"index":3813},"line":81,"code":"      it('Returns `with schema` collection entry', async () => {\n        expect(json).to.haveOwnProperty('oneWithSchemaConfig');\n        expect(json.oneWithSchemaConfig.id).to.equal('one.md');\n        expect(json.oneWithSchemaConfig.data.publishedAt instanceof Date).to.equal(true);\n        expect(json.oneWithSchemaConfig.data.publishedAt.toISOString()).to.equal('2021-01-01T00:00:00.000Z');\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with custom slugs` collection entry","suites":["Content Collections","Query","Entry"],"updatePoint":{"line":87,"column":54,"index":4222},"line":87,"code":"      it('Returns `with custom slugs` collection entry', async () => {\n        expect(json).to.haveOwnProperty('twoWithSlugConfig');\n        expect(json.twoWithSlugConfig.slug).to.equal('interesting-two');\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns `with union schema` collection entry","suites":["Content Collections","Query","Entry"],"updatePoint":{"line":91,"column":54,"index":4438},"line":91,"code":"      it('Returns `with union schema` collection entry', async () => {\n        expect(json).to.haveOwnProperty('postWithUnionSchema');\n        expect(json.postWithUnionSchema.id).to.equal('post.md');\n        expect(json.postWithUnionSchema.data).to.deep.equal({\n          type: 'post',\n          title: 'My Post',\n          description: 'This is my post'\n        });\n      });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Generates expected pages","suites":["Content Collections","Static paths integration"],"updatePoint":{"line":132,"column":32,"index":5575},"line":132,"code":"    it('Generates expected pages', async () => {\n      for (const slug in blogSlugToContents) {\n        expect(fixture.pathExists(`/posts/${slug}`)).to.equal(true);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders titles","suites":["Content Collections","Static paths integration"],"updatePoint":{"line":137,"column":22,"index":5746},"line":137,"code":"    it('Renders titles', async () => {\n      for (const slug in blogSlugToContents) {\n        const post = await fixture.readFile(`/posts/${slug}/index.html`);\n        const $ = cheerio.load(post);\n        expect($('h1').text()).to.equal(blogSlugToContents[slug].title);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders content","suites":["Content Collections","Static paths integration"],"updatePoint":{"line":144,"column":23,"index":6034},"line":144,"code":"    it('Renders content', async () => {\n      for (const slug in blogSlugToContents) {\n        const post = await fixture.readFile(`/posts/${slug}/index.html`);\n        const $ = cheerio.load(post);\n        expect($(blogSlugToContents[slug].element).text().trim()).to.equal(blogSlugToContents[slug].content);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not throw","suites":["Content Collections","With spaces in path"],"updatePoint":{"line":153,"column":22,"index":6406},"line":153,"code":"    it('Does not throw', async () => {\n      const fixture = await loadFixture({\n        root: './fixtures/content with spaces in folder name/'\n      });\n      let error = null;\n      try {\n        await fixture.build();\n      } catch (e) {\n        error = e.message;\n      }\n      expect(error).to.be.null;\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Errors when frontmatter doesn't match schema","suites":["Content Collections","With config.mjs"],"updatePoint":{"line":167,"column":52,"index":6796},"line":167,"code":"    it(\"Errors when frontmatter doesn't match schema\", async () => {\n      const fixture = await loadFixture({\n        root: './fixtures/content-collections-with-config-mjs/'\n      });\n      let error;\n      try {\n        await fixture.build();\n      } catch (e) {\n        error = e.message;\n      }\n      expect(error).to.include('**title**: Expected type `\"string\"`, received \"number\"');\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Throws the right error","suites":["Content Collections","With empty markdown file"],"updatePoint":{"line":181,"column":30,"index":7225},"line":181,"code":"    it('Throws the right error', async () => {\n      const fixture = await loadFixture({\n        root: './fixtures/content-collections-empty-md-file/'\n      });\n      let error;\n      try {\n        await fixture.build();\n      } catch (e) {\n        error = e.message;\n      }\n      expect(error).to.include('**title**: Required');\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Responds 200 for expected pages","suites":["Content Collections","SSR integration"],"updatePoint":{"line":208,"column":39,"index":7987},"line":208,"code":"    it('Responds 200 for expected pages', async () => {\n      for (const slug in blogSlugToContents) {\n        const request = new Request('http://example.com/posts/' + slug);\n        const response = await app.render(request);\n        expect(response.status).to.equal(200);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders titles","suites":["Content Collections","SSR integration"],"updatePoint":{"line":215,"column":22,"index":8261},"line":215,"code":"    it('Renders titles', async () => {\n      for (const slug in blogSlugToContents) {\n        const request = new Request('http://example.com/posts/' + slug);\n        const response = await app.render(request);\n        const body = await response.text();\n        const $ = cheerio.load(body);\n        expect($('h1').text()).to.equal(blogSlugToContents[slug].title);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders content","suites":["Content Collections","SSR integration"],"updatePoint":{"line":224,"column":23,"index":8644},"line":224,"code":"    it('Renders content', async () => {\n      for (const slug in blogSlugToContents) {\n        const request = new Request('http://example.com/posts/' + slug);\n        const response = await app.render(request);\n        const body = await response.text();\n        const $ = cheerio.load(body);\n        expect($(blogSlugToContents[slug].element).text().trim()).to.equal(blogSlugToContents[slug].content);\n      }\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes base in links","suites":["Content Collections","Base configuration"],"updatePoint":{"line":242,"column":30,"index":9296},"line":242,"code":"    it('Includes base in links', async () => {\n      const html = await fixture.readFile('/docs/index.html');\n      const $ = cheerio.load(html);\n      expect($('link').attr('href')).to.satisfies(a => a.startsWith('/docs'));\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes base in hoisted scripts","suites":["Content Collections","Base configuration"],"updatePoint":{"line":247,"column":40,"index":9539},"line":247,"code":"    it('Includes base in hoisted scripts', async () => {\n      const html = await fixture.readFile('/docs/index.html');\n      const $ = cheerio.load(html);\n      expect($('script').attr('src')).to.satisfies(a => a.startsWith('/docs'));\n    });","file":"content-collections.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the <img> tag","suites":["astro:image","dev","basics"],"updatePoint":{"line":45,"column":28,"index":1287},"line":45,"code":"      it('Adds the <img> tag', () => {\n        let $img = $('#local img');\n        expect($img).to.have.a.lengthOf(1);\n        expect($img.attr('src').startsWith('/_image')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes loading and decoding attributes","suites":["astro:image","dev","basics"],"updatePoint":{"line":50,"column":50,"index":1509},"line":50,"code":"      it('includes loading and decoding attributes', () => {\n        let $img = $('#local img');\n        expect(!!$img.attr('loading')).to.equal(true);\n        expect(!!$img.attr('decoding')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has width and height - no dimensions set","suites":["astro:image","dev","basics"],"updatePoint":{"line":55,"column":50,"index":1727},"line":55,"code":"      it('has width and height - no dimensions set', () => {\n        let $img = $('#local img');\n        expect($img.attr('width')).to.equal('207');\n        expect($img.attr('height')).to.equal('243');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper width and height - only width","suites":["astro:image","dev","basics"],"updatePoint":{"line":60,"column":50,"index":1939},"line":60,"code":"      it('has proper width and height - only width', () => {\n        let $img = $('#local-width img');\n        expect($img.attr('width')).to.equal('350');\n        expect($img.attr('height')).to.equal('411');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper width and height - only height","suites":["astro:image","dev","basics"],"updatePoint":{"line":65,"column":51,"index":2158},"line":65,"code":"      it('has proper width and height - only height', () => {\n        let $img = $('#local-height img');\n        expect($img.attr('width')).to.equal('170');\n        expect($img.attr('height')).to.equal('200');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper width and height - has both width and height","suites":["astro:image","dev","basics"],"updatePoint":{"line":70,"column":65,"index":2392},"line":70,"code":"      it('has proper width and height - has both width and height', () => {\n        let $img = $('#local-both img');\n        expect($img.attr('width')).to.equal('300');\n        expect($img.attr('height')).to.equal('400');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes the provided alt","suites":["astro:image","dev","basics"],"updatePoint":{"line":75,"column":35,"index":2594},"line":75,"code":"      it('includes the provided alt', () => {\n        let $img = $('#local img');\n        expect($img.attr('alt')).to.equal('a penguin');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"middleware loads the file","suites":["astro:image","dev","basics"],"updatePoint":{"line":79,"column":35,"index":2742},"line":79,"code":"      it('middleware loads the file', async () => {\n        let $img = $('#local img');\n        let src = $img.attr('src');\n        let res = await fixture.fetch(src);\n        expect(res.status).to.equal(200);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns proper content-type","suites":["astro:image","dev","basics"],"updatePoint":{"line":85,"column":37,"index":2964},"line":85,"code":"      it('returns proper content-type', async () => {\n        let $img = $('#local img');\n        let src = $img.attr('src');\n        let res = await fixture.fetch(src);\n        expect(res.headers.get('content-type')).to.equal('image/webp');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"errors on unsupported formats","suites":["astro:image","dev","basics"],"updatePoint":{"line":91,"column":39,"index":3218},"line":91,"code":"      it('errors on unsupported formats', async () => {\n        logs.length = 0;\n        let res = await fixture.fetch('/unsupported-format');\n        await res.text();\n        expect(logs).to.have.a.lengthOf(1);\n        expect(logs[0].message).to.contain('Received unsupported format');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes the provided alt","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":107,"column":37,"index":3762},"line":107,"code":"        it('includes the provided alt', async () => {\n          let $img = $('#remote img');\n          expect($img.attr('alt')).to.equal('fred');\n        });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes loading and decoding attributes","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":111,"column":52,"index":3935},"line":111,"code":"        it('includes loading and decoding attributes', () => {\n          let $img = $('#remote img');\n          expect(!!$img.attr('loading')).to.equal(true);\n          expect(!!$img.attr('decoding')).to.equal(true);\n        });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes width and height attributes","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":116,"column":48,"index":4160},"line":116,"code":"        it('includes width and height attributes', () => {\n          let $img = $('#remote img');\n          expect(!!$img.attr('width')).to.equal(true);\n          expect(!!$img.attr('height')).to.equal(true);\n        });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"support data: URI","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":121,"column":29,"index":4362},"line":121,"code":"        it('support data: URI', () => {\n          let $img = $('#data-uri img');\n          expect($img.attr('src')).to.equal('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA0AAAANCAYAAABy6+R8AAAAAXNSR0IArs4c6QAAAIRlWElmTU0AKgAAAAgABQESAAMAAAABAAEAAAEaAAUAAAABAAAASgEbAAUAAAABAAAAUgEoAAMAAAABAAIAAIdpAAQAAAABAAAAWgAAAAAAAABIAAAAAQAAAEgAAAABAAOgAQADAAAAAQABAACgAgAEAAAAAQAAAA2gAwAEAAAAAQAAAA0AAAAAWvB1rQAAAAlwSFlzAAALEwAACxMBAJqcGAAAAVlpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IlhNUCBDb3JlIDYuMC4wIj4KICAgPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4KICAgICAgPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIKICAgICAgICAgICAgeG1sbnM6dGlmZj0iaHR0cDovL25zLmFkb2JlLmNvbS90aWZmLzEuMC8iPgogICAgICAgICA8dGlmZjpPcmllbnRhdGlvbj4xPC90aWZmOk9yaWVudGF0aW9uPgogICAgICA8L3JkZjpEZXNjcmlwdGlvbj4KICAgPC9yZGY6UkRGPgo8L3g6eG1wbWV0YT4KGV7hBwAAAWJJREFUKBVtUDEsQ1EUve+1/SItKYMIkYpF06GJdGAwNFFGkxBEYupssRm6EpvJbpVoYhRd6FBikDSxYECsBpG25D/nvP/+p+Ik551z73v33feuyA/izq5CL8ET8ALcBolYIP+vd0ibX/yAT7uj2qkVzwWzUBa0nbacbkKJHi5dlYhXmARYeAS+MwCWA5FPqKIP/9IH/wiygMru5y5mcRYkPHYKP7gAPw4SDbCjRXMgRBJctM4t4ROriM2QSpmkeOtub6YfMYrZvelykbD1sxJVg+6AfKqURRKQLfA4JvoVWgIjDMNlGLVKZxNRFsZsoHGAgREZHKPlJEi2t7if3r2KKS9nVOo0rtNZ3yR7M/VGTqTy5Y4o/scWHBbKfIq0/eZ+x3850OZpaTTxlu/4D3ssuA72uxrYS2rFYjh+aRbmb24LpTVu1IqVKG8P/lmUEaNMxeh6fmquOhkMBE8JJ2yPfwPjdVhiDbiX6AAAAABJRU5ErkJggg==');\n          expect(!!$img.attr('width')).to.equal(true);\n          expect(!!$img.attr('height')).to.equal(true);\n        });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"support images from public","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":127,"column":38,"index":5910},"line":127,"code":"        it('support images from public', () => {\n          let $img = $('#public img');\n          expect($img.attr('src')).to.equal('/penguin3.jpg');\n          expect(!!$img.attr('width')).to.equal(true);\n          expect(!!$img.attr('height')).to.equal(true);\n        });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"error if no width and height","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":134,"column":38,"index":6193},"line":134,"code":"      it('error if no width and height', async () => {\n        logs.length = 0;\n        let res = await fixture.fetch('/remote-error-no-dimensions');\n        await res.text();\n        expect(logs).to.have.a.lengthOf(1);\n        expect(logs[0].message).to.contain('Missing width and height attributes');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"error if no height","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":141,"column":28,"index":6496},"line":141,"code":"      it('error if no height', async () => {\n        logs.length = 0;\n        let res = await fixture.fetch('/remote-error-no-height');\n        await res.text();\n        expect(logs).to.have.a.lengthOf(1);\n        expect(logs[0].message).to.contain('Missing height attribute');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"supports aliases","suites":["astro:image","dev","remote","working"],"updatePoint":{"line":148,"column":26,"index":6782},"line":148,"code":"      it('supports aliases', async () => {\n        let res = await fixture.fetch('/alias');\n        let html = await res.text();\n        let $ = cheerio.load(html);\n        let $img = $('img');\n        expect($img).to.have.a.lengthOf(1);\n        expect($img.attr('src').includes('penguin1.jpg')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the <img> tag","suites":["astro:image","dev","markdown"],"updatePoint":{"line":164,"column":28,"index":7314},"line":164,"code":"      it('Adds the <img> tag', () => {\n        let $img = $('img');\n        expect($img).to.have.a.lengthOf(1);\n\n        // Verbose test for the full URL to make sure the image went through the full pipeline\n        expect($img.attr('src')).to.equal('/_image?href=%2Fsrc%2Fassets%2Fpenguin1.jpg%3ForigWidth%3D207%26origHeight%3D243%26origFormat%3Djpg&f=webp');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has width and height attributes","suites":["astro:image","dev","markdown"],"updatePoint":{"line":171,"column":41,"index":7698},"line":171,"code":"      it('has width and height attributes', () => {\n        let $img = $('img');\n        expect(!!$img.attr('width')).to.equal(true);\n        expect(!!$img.attr('height')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Supports aliased paths","suites":["astro:image","dev","markdown"],"updatePoint":{"line":176,"column":32,"index":7887},"line":176,"code":"      it('Supports aliased paths', async () => {\n        let res = await fixture.fetch('/aliasMarkdown');\n        let html = await res.text();\n        $ = cheerio.load(html);\n        let $img = $('img');\n        expect($img.attr('src').startsWith('/_image')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly handles remote images","suites":["astro:image","dev","markdown"],"updatePoint":{"line":183,"column":40,"index":8180},"line":183,"code":"      it('properly handles remote images', async () => {\n        let res = await fixture.fetch('/httpImage');\n        let html = await res.text();\n        $ = cheerio.load(html);\n        let $img = $('img');\n        expect($img).to.have.a.lengthOf(2);\n        const remoteUrls = ['https://example.com/image.png', '/image.png'];\n        $img.each((index, element) => {\n          expect(element.attribs['src']).to.equal(remoteUrls[index]);\n        });\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the <img> tag","suites":["astro:image","dev","getImage"],"updatePoint":{"line":202,"column":28,"index":8841},"line":202,"code":"      it('Adds the <img> tag', () => {\n        let $img = $('img');\n        expect($img).to.have.a.lengthOf(1);\n        expect($img.attr('src').startsWith('/_image')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes the provided alt","suites":["astro:image","dev","getImage"],"updatePoint":{"line":207,"column":35,"index":9041},"line":207,"code":"      it('includes the provided alt', () => {\n        let $img = $('img');\n        expect($img.attr('alt')).to.equal('a penguin');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Adds the <img> tags","suites":["astro:image","dev","content collections"],"updatePoint":{"line":219,"column":29,"index":9399},"line":219,"code":"      it('Adds the <img> tags', () => {\n        let $img = $('img');\n        expect($img).to.have.a.lengthOf(4);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper source for directly used image","suites":["astro:image","dev","content collections"],"updatePoint":{"line":223,"column":51,"index":9544},"line":223,"code":"      it('has proper source for directly used image', () => {\n        let $img = $('#direct-image img');\n        expect($img.attr('src').startsWith('/src/')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper attributes for optimized image through getImage","suites":["astro:image","dev","content collections"],"updatePoint":{"line":227,"column":68,"index":9745},"line":227,"code":"      it('has proper attributes for optimized image through getImage', () => {\n        let $img = $('#optimized-image-get-image img');\n        expect($img.attr('src').startsWith('/_image')).to.equal(true);\n        expect($img.attr('width')).to.equal('207');\n        expect($img.attr('height')).to.equal('243');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has proper attributes for optimized image through Image component","suites":["astro:image","dev","content collections"],"updatePoint":{"line":233,"column":75,"index":10073},"line":233,"code":"      it('has proper attributes for optimized image through Image component', () => {\n        let $img = $('#optimized-image-component img');\n        expect($img.attr('src').startsWith('/_image')).to.equal(true);\n        expect($img.attr('width')).to.equal('207');\n        expect($img.attr('height')).to.equal('243');\n        expect($img.attr('alt')).to.equal('A penguin!');\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly handles nested images","suites":["astro:image","dev","content collections"],"updatePoint":{"line":240,"column":40,"index":10423},"line":240,"code":"      it('properly handles nested images', () => {\n        let $img = $('#nested-image img');\n        expect($img.attr('src').startsWith('/src/')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not have a file url","suites":["astro:image","dev","regular img tag"],"updatePoint":{"line":253,"column":34,"index":10871},"line":253,"code":"      it('does not have a file url', async () => {\n        expect($('img').attr('src').startsWith('file://')).to.equal(false);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes /src in the path","suites":["astro:image","dev","regular img tag"],"updatePoint":{"line":256,"column":35,"index":11009},"line":256,"code":"      it('includes /src in the path', async () => {\n        expect($('img').attr('src').startsWith('/src')).to.equal(true);\n      });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly error when getImage's first parameter isn't filled","suites":["astro:image","proper errors"],"updatePoint":{"line":289,"column":67,"index":11934},"line":289,"code":"    it(\"properly error when getImage's first parameter isn't filled\", async () => {\n      logs.length = 0;\n      let res = await fixture.fetch('/get-image-empty');\n      await res.text();\n      expect(logs).to.have.a.lengthOf(1);\n      expect(logs[0].message).to.contain('Expected getImage() parameter');\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly error when src is undefined","suites":["astro:image","proper errors"],"line":298,"code":"    it.skip('properly error when src is undefined', async () => {","file":"core-image.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"properly error image in Markdown frontmatter is not found","suites":["astro:image","proper errors"],"updatePoint":{"line":305,"column":65,"index":12609},"line":305,"code":"    it('properly error image in Markdown frontmatter is not found', async () => {\n      logs.length = 0;\n      let res = await fixture.fetch('/blog/one');\n      const text = await res.text();\n      expect(logs).to.have.a.lengthOf(1);\n      expect(logs[0].message).to.contain('does not exist. Is the path correct?');\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly error image in Markdown content is not found","suites":["astro:image","proper errors"],"updatePoint":{"line":312,"column":61,"index":12929},"line":312,"code":"    it('properly error image in Markdown content is not found', async () => {\n      logs.length = 0;\n      let res = await fixture.fetch('/post');\n      const text = await res.text();\n      expect(logs).to.have.a.lengthOf(1);\n      expect(logs[0].message).to.contain('Could not find requested image');\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has base path prefix when using the Image component","suites":["astro:image","support base option correctly"],"updatePoint":{"line":331,"column":59,"index":13528},"line":331,"code":"    it('has base path prefix when using the Image component', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const src = $('#local img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      expect(src.startsWith('/blog')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has base path prefix when using getImage","suites":["astro:image","support base option correctly"],"updatePoint":{"line":338,"column":48,"index":13839},"line":338,"code":"    it('has base path prefix when using getImage', async () => {\n      const html = await fixture.readFile('/get-image/index.html');\n      const $ = cheerio.load(html);\n      const src = $('img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      expect(src.startsWith('/blog')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has base path prefix when using image directly","suites":["astro:image","support base option correctly"],"updatePoint":{"line":345,"column":54,"index":14159},"line":345,"code":"    it('has base path prefix when using image directly', async () => {\n      const html = await fixture.readFile('/direct/index.html');\n      const $ = cheerio.load(html);\n      const src = $('img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      expect(src.startsWith('/blog')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has base path prefix in Markdown","suites":["astro:image","support base option correctly"],"updatePoint":{"line":352,"column":40,"index":14462},"line":352,"code":"    it('has base path prefix in Markdown', async () => {\n      const html = await fixture.readFile('/post/index.html');\n      const $ = cheerio.load(html);\n      const src = $('img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      expect(src.startsWith('/blog')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has base path prefix in Content Collection frontmatter","suites":["astro:image","support base option correctly"],"updatePoint":{"line":359,"column":62,"index":14785},"line":359,"code":"    it('has base path prefix in Content Collection frontmatter', async () => {\n      const html = await fixture.readFile('/blog/one/index.html');\n      const $ = cheerio.load(html);\n      const src = $('img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      expect(src.startsWith('/blog')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"writes out images to dist folder","suites":["astro:image","build ssg"],"updatePoint":{"line":377,"column":40,"index":15337},"line":377,"code":"    it('writes out images to dist folder', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const src = $('#local img').attr('src');\n      expect(src.length).to.be.greaterThan(0);\n      const data = await fixture.readFile(src, null);\n      expect(data).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"writes out images to dist folder with proper extension if no format was passed","suites":["astro:image","build ssg"],"updatePoint":{"line":385,"column":86,"index":15738},"line":385,"code":"    it('writes out images to dist folder with proper extension if no format was passed', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const src = $('#local img').attr('src');\n      expect(src.endsWith('.webp')).to.be.true;\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"getImage() usage also written","suites":["astro:image","build ssg"],"updatePoint":{"line":391,"column":37,"index":15989},"line":391,"code":"    it('getImage() usage also written', async () => {\n      const html = await fixture.readFile('/get-image/index.html');\n      const $ = cheerio.load(html);\n      let $img = $('img');\n\n      // <img> tag\n      expect($img).to.have.a.lengthOf(1);\n      expect($img.attr('alt')).to.equal('a penguin');\n\n      // image itself\n      const src = $img.attr('src');\n      const data = await fixture.readFile(src, null);\n      expect(data).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"markdown images are written","suites":["astro:image","build ssg"],"updatePoint":{"line":405,"column":35,"index":16457},"line":405,"code":"    it('markdown images are written', async () => {\n      const html = await fixture.readFile('/post/index.html');\n      const $ = cheerio.load(html);\n      let $img = $('img');\n\n      // <img> tag\n      expect($img).to.have.a.lengthOf(1);\n      expect($img.attr('alt')).to.equal('My article cover');\n\n      // image itself\n      const src = $img.attr('src');\n      const data = await fixture.readFile(src, null);\n      expect(data).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"aliased images are written","suites":["astro:image","build ssg"],"updatePoint":{"line":419,"column":34,"index":16926},"line":419,"code":"    it('aliased images are written', async () => {\n      const html = await fixture.readFile('/alias/index.html');\n      const $ = cheerio.load(html);\n      let $img = $('img');\n\n      // <img> tag\n      expect($img).to.have.a.lengthOf(1);\n      expect($img.attr('alt')).to.equal('A penguin!');\n\n      // image itself\n      const src = $img.attr('src');\n      const data = await fixture.readFile(src, null);\n      expect(data).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"aliased images in Markdown are written","suites":["astro:image","build ssg"],"updatePoint":{"line":433,"column":46,"index":17402},"line":433,"code":"    it('aliased images in Markdown are written', async () => {\n      const html = await fixture.readFile('/aliasMarkdown/index.html');\n      const $ = cheerio.load(html);\n      let $img = $('img');\n\n      // <img> tag\n      expect($img).to.have.a.lengthOf(1);\n      expect($img.attr('alt')).to.equal('A penguin');\n\n      // image itself\n      const src = $img.attr('src');\n      const data = await fixture.readFile(src, null);\n      expect(data).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"output files for content collections images","suites":["astro:image","build ssg"],"updatePoint":{"line":447,"column":51,"index":17890},"line":447,"code":"    it('output files for content collections images', async () => {\n      const html = await fixture.readFile('/blog/one/index.html');\n      const $ = cheerio.load(html);\n      let $img = $('img');\n      expect($img).to.have.a.lengthOf(2);\n      const srcdirect = $('#direct-image img').attr('src');\n      const datadirect = await fixture.readFile(srcdirect, null);\n      expect(datadirect).to.be.an.instanceOf(Buffer);\n      const srcnested = $('#nested-image img').attr('src');\n      const datanested = await fixture.readFile(srcnested, null);\n      expect(datanested).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"quality attribute produces a different file","suites":["astro:image","build ssg"],"updatePoint":{"line":459,"column":51,"index":18498},"line":459,"code":"    it('quality attribute produces a different file', async () => {\n      const html = await fixture.readFile('/quality/index.html');\n      const $ = cheerio.load(html);\n      expect($('#no-quality img').attr('src')).to.not.equal($('#quality-low img').attr('src'));\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"quality can be a number between 0-100","suites":["astro:image","build ssg"],"updatePoint":{"line":464,"column":45,"index":18766},"line":464,"code":"    it('quality can be a number between 0-100', async () => {\n      const html = await fixture.readFile('/quality/index.html');\n      const $ = cheerio.load(html);\n      expect($('#no-quality img').attr('src')).to.not.equal($('#quality-num img').attr('src'));\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"format attribute produces a different file","suites":["astro:image","build ssg"],"updatePoint":{"line":469,"column":50,"index":19039},"line":469,"code":"    it('format attribute produces a different file', async () => {\n      const html = await fixture.readFile('/format/index.html');\n      const $ = cheerio.load(html);\n      expect($('#no-format img').attr('src')).to.not.equal($('#format-avif img').attr('src'));\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"dynamic route images are built at response time","suites":["astro:image","prod ssr"],"line":492,"code":"    it.skip('dynamic route images are built at response time', async () => {","file":"core-image.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"prerendered routes images are built","suites":["astro:image","prod ssr"],"updatePoint":{"line":504,"column":43,"index":20435},"line":504,"code":"    it('prerendered routes images are built', async () => {\n      const html = await fixture.readFile('/client/prerender/index.html');\n      const $ = cheerio.load(html);\n      const src = $('img').attr('src');\n      const imgData = await fixture.readFile('/client' + src, null);\n      expect(imgData).to.be.an.instanceOf(Buffer);\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"custom service implements getHTMLAttributes","suites":["astro:image","custom service"],"updatePoint":{"line":527,"column":51,"index":21246},"line":527,"code":"    it('custom service implements getHTMLAttributes', async () => {\n      const response = await fixture.fetch('/');\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('#local img').attr('data-service')).to.equal('my-custom-service');\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"custom service works in Markdown","suites":["astro:image","custom service"],"updatePoint":{"line":533,"column":40,"index":21520},"line":533,"code":"    it('custom service works in Markdown', async () => {\n      const response = await fixture.fetch('/post');\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('img').attr('data-service')).to.equal('my-custom-service');\n    });","file":"core-image.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Bundled CSS does not have __VITE_ASSET__","suites":["Assets in CSS"],"updatePoint":{"line":31,"column":46,"index":803},"line":31,"code":"  it('Bundled CSS does not have __VITE_ASSET__', async () => {\n    let css = await getCSSForPage('/one/index.html');\n    expect(css).to.not.contain('__VITE_ASSET__');\n    css = await getCSSForPage('/two/index.html');\n    expect(css).to.not.contain('__VITE_ASSET__');\n  });","file":"css-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Pages contain only their own CSS","suites":["Assets in CSS"],"updatePoint":{"line":37,"column":38,"index":1068},"line":37,"code":"  it('Pages contain only their own CSS', async () => {\n    let css = await getCSSForPage('/one/index.html');\n    expect(getAllMatches(/font-face/g, css)).to.equal(1);\n    css = await getCSSForPage('/two/index.html');\n    expect(getAllMatches(/font-face/g, css)).to.equal(1);\n  });","file":"css-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"?inline is imported as a string","suites":["Importing raw/inlined CSS","Build"],"updatePoint":{"line":15,"column":39,"index":413},"line":15,"code":"    it('?inline is imported as a string', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#inline').text()).to.contain('tomato');\n      expect($('link[rel=stylesheet]')).to.have.lengthOf(1);\n      expect($('style')).to.have.lengthOf(0);\n    });","file":"css-inline.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"?raw is imported as a string","suites":["Importing raw/inlined CSS","Build"],"updatePoint":{"line":22,"column":36,"index":731},"line":22,"code":"    it('?raw is imported as a string', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#raw').text()).to.contain('plum');\n      expect($('link[rel=stylesheet]')).to.have.lengthOf(1);\n      expect($('style')).to.have.lengthOf(0);\n    });","file":"css-inline.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"?inline is imported as string and doesn't make css bundled ","suites":["Importing raw/inlined CSS","Dev"],"updatePoint":{"line":39,"column":67,"index":1323},"line":39,"code":"    it(\"?inline is imported as string and doesn't make css bundled \", async () => {\n      const response = await fixture.fetch('/');\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('#inline').text()).to.contain('tomato');\n      expect($('link[rel=stylesheet]')).to.have.lengthOf(0);\n      expect($('style')).to.have.lengthOf(1);\n    });","file":"css-inline.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"?raw is imported as a string and doesn't make css bundled","suites":["Importing raw/inlined CSS","Dev"],"updatePoint":{"line":47,"column":65,"index":1703},"line":47,"code":"    it(\"?raw is imported as a string and doesn't make css bundled\", async () => {\n      const response = await fixture.fetch('/');\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('#raw').text()).to.contain('plum');\n      expect($('link[rel=stylesheet]')).to.have.lengthOf(0);\n      expect($('style')).to.have.lengthOf(1);\n    });","file":"css-inline.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"loads styles correctly","suites":["vite.build.cssCodeSplit: false"],"updatePoint":{"line":13,"column":28,"index":399},"line":13,"code":"  it('loads styles correctly', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    const cssHref = $('link[rel=stylesheet][href^=/_astro/]').attr('href');\n    expect(cssHref).to.match(/\\/_astro\\/style\\..*?\\.css/);\n  });","file":"css-no-code-split.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Page level CSS is defined lower in the page","suites":["CSS ordering - import order","Development"],"updatePoint":{"line":56,"column":51,"index":1309},"line":56,"code":"    it('Page level CSS is defined lower in the page', async () => {\n      let res = await fixture.fetch('/');\n      let html = await res.text();\n      let [style1, style2] = getStyles(html);\n      expect(style1).to.include('green');\n      expect(style2).to.include('salmon');\n    });","file":"css-order-import.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"import order is depth-first","suites":["CSS ordering - import order","Development"],"updatePoint":{"line":63,"column":35,"index":1577},"line":63,"code":"    it('import order is depth-first', async () => {\n      let res = await fixture.fetch('/component/');\n      let html = await res.text();\n      let [style1, style2, style3] = getStyles(html);\n      expect(style1).to.include('burlywood');\n      expect(style2).to.include('aliceblue');\n      expect(style3).to.include('whitesmoke');\n    });","file":"css-order-import.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Page level CSS is defined lower in the page","suites":["CSS ordering - import order","Production"],"updatePoint":{"line":76,"column":51,"index":2034},"line":76,"code":"    it('Page level CSS is defined lower in the page', async () => {\n      let html = await fixture.readFile('/index.html');\n      const content = await Promise.all(getLinks(html).map(href => getLinkContent(href)));\n      const [{\n        css\n      }] = content;\n      let idx1 = css.indexOf('salmon');\n      let idx2 = css.indexOf('green');\n      expect(idx1).to.be.greaterThan(idx2, 'Page level CSS should be placed after imported CSS');\n    });","file":"css-order-import.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"import order is depth-first","suites":["CSS ordering - import order","Production"],"updatePoint":{"line":86,"column":35,"index":2465},"line":86,"code":"    it('import order is depth-first', async () => {\n      let html = await fixture.readFile('/component/index.html');\n      const content = await Promise.all(getLinks(html).map(href => getLinkContent(href)));\n      const [{\n        css\n      }] = content;\n      let idx1 = css.indexOf('whitesmoke');\n      let idx2 = css.indexOf('aliceblue');\n      let idx3 = css.indexOf('burlywood');\n      expect(idx1).to.be.greaterThan(idx2);\n      expect(idx2).to.be.greaterThan(idx3);\n    });","file":"css-order-import.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"dynamic imports taken into account","suites":["CSS ordering - import order","Dynamic import"],"updatePoint":{"line":108,"column":42,"index":3236},"line":108,"code":"    it('dynamic imports taken into account', async () => {\n      let html = await fixture.readFile('/one/index.html');\n      const content = await Promise.all(getLinks(html).map(href => getLinkContent(href, fixture)));\n      let [link1, link2] = content;\n      expect(link1.css).to.contain('aliceblue');\n      expect(link2.css).to.contain('yellow');\n    });","file":"css-order-import.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Page level CSS is defined lower in the page","suites":["CSS ordering - import order with layouts","Production"],"updatePoint":{"line":43,"column":51,"index":990},"line":43,"code":"    it('Page level CSS is defined lower in the page', async () => {\n      let html = await fixture.readFile('/index.html');\n      const content = await Promise.all(getLinks(html).map(href => getLinkContent(href)));\n      let specialButtonCSS = -1;\n      let globalCSS = -1;\n      for (let i = 0; i < content.length; i++) {\n        if (content[i].css.indexOf('.SpecialButton') !== -1) {\n          specialButtonCSS = i;\n        } else if (content[i].css.indexOf('green') !== -1) {\n          globalCSS = i;\n        }\n      }\n      expect(globalCSS).to.equal(0, 'global css sorted on top');\n      expect(specialButtonCSS).to.equal(1, 'component level css sorted last');\n    });","file":"css-order-layout.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is in the same order for output: server and static","suites":["CSS production ordering","SSG and SSR parity"],"updatePoint":{"line":61,"column":58,"index":1843},"line":61,"code":"    it('is in the same order for output: server and static', async () => {\n      const staticContent = staticCSS.map(o => o.css);\n      const serverContent = serverCSS.map(o => o.css);\n      expect(staticContent).to.deep.equal(serverContent);\n    });","file":"css-order.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Page level CSS is defined lower in the page","suites":["CSS production ordering","Page vs. Shared CSS"],"updatePoint":{"line":76,"column":51,"index":2348},"line":76,"code":"    it('Page level CSS is defined lower in the page', async () => {\n      let html = await fixture.readFile('/two/index.html');\n      const content = await Promise.all(getLinks(html).map(href => getLinkContent(fixture, href)));\n      expect(content).to.have.a.lengthOf(3, 'there are 3 stylesheets');\n      const [, sharedStyles, pageStyles] = content;\n      expect(sharedStyles.css).to.match(/red/);\n      expect(pageStyles.css).to.match(/#00f/);\n    });","file":"css-order.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"CSS injected by injectScript comes first because of import order","suites":["CSS production ordering","Page vs. Shared CSS"],"updatePoint":{"line":84,"column":72,"index":2824},"line":84,"code":"    it('CSS injected by injectScript comes first because of import order', async () => {\n      let oneHtml = await fixture.readFile('/one/index.html');\n      let twoHtml = await fixture.readFile('/two/index.html');\n      let threeHtml = await fixture.readFile('/three/index.html');\n      for (const html of [oneHtml, twoHtml, threeHtml]) {\n        const content = await Promise.all(getLinks(html).map(href => getLinkContent(fixture, href)));\n        const [first] = content;\n        expect(first.css).to.include('green', 'Came from the injected script');\n      }\n    });","file":"css-order.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders /","suites":["Custom 404 Markdown","dev"],"updatePoint":{"line":20,"column":17,"index":499},"line":20,"code":"    it('renders /', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Home');\n    });","file":"custom-404-md.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders 404 for /abc","suites":["Custom 404 Markdown","dev"],"updatePoint":{"line":25,"column":28,"index":698},"line":25,"code":"    it('renders 404 for /abc', async () => {\n      const html = await fixture.fetch('/a').then(res => res.text());\n      $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Page not found');\n    });","file":"custom-404-md.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders /","suites":["Custom 404","dev"],"updatePoint":{"line":21,"column":17,"index":521},"line":21,"code":"    it('renders /', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Home');\n    });","file":"custom-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders 404 for /a","suites":["Custom 404","dev"],"updatePoint":{"line":26,"column":26,"index":718},"line":26,"code":"    it('renders 404 for /a', async () => {\n      const html = await fixture.fetch('/a').then(res => res.text());\n      $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Page not found');\n      expect($('p').text()).to.equal('/a');\n    });","file":"custom-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Work as constructors","suites":["Custom Elements"],"updatePoint":{"line":15,"column":26,"index":401},"line":15,"code":"  it('Work as constructors', async () => {\n    const html = await fixture.readFile('/ctr/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: Element rendered\n    expect($('my-element')).to.have.lengthOf(1);\n\n    // test 2: shadow rendered\n    expect($('my-element template[shadowroot=open][shadowrootmode=open]')).to.have.lengthOf(1);\n  });","file":"custom-elements.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with exported tagName","suites":["Custom Elements"],"updatePoint":{"line":25,"column":33,"index":760},"line":25,"code":"  it('Works with exported tagName', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: Element rendered\n    expect($('my-element')).to.have.lengthOf(1);\n\n    // test 2: shadow rendered\n    expect($('my-element template[shadowroot=open][shadowrootmode=open]')).to.have.lengthOf(1);\n  });","file":"custom-elements.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Hydration works with exported tagName","suites":["Custom Elements"],"line":35,"code":"  it.skip('Hydration works with exported tagName', async () => {","file":"custom-elements.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"Custom elements not claimed by renderer are rendered as regular HTML","suites":["Custom Elements"],"updatePoint":{"line":50,"column":74,"index":1670},"line":50,"code":"  it('Custom elements not claimed by renderer are rendered as regular HTML', async () => {\n    const html = await fixture.readFile('/nossr/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: Rendered the client-only element\n    expect($('client-element')).to.have.lengthOf(1);\n    // No children\n    expect($('client-element').text()).to.equal('');\n  });","file":"custom-elements.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can import a client-only element that is nested in JSX","suites":["Custom Elements"],"updatePoint":{"line":59,"column":60,"index":2022},"line":59,"code":"  it('Can import a client-only element that is nested in JSX', async () => {\n    const html = await fixture.readFile('/nested/index.html');\n    const $ = cheerioLoad(html);\n\n    // test 1: Element rendered\n    expect($('client-only-element')).to.have.lengthOf(1);\n  });","file":"custom-elements.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works in markdown pages","suites":["<Debug />"],"updatePoint":{"line":23,"column":29,"index":609},"line":23,"code":"  it('Works in markdown pages', async () => {\n    const response = await fixture.fetch('/posts/first');\n    expect(response.status).to.equal(200);\n  });","file":"debug-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /","suites":["Development Routing","No site config"],"updatePoint":{"line":18,"column":26,"index":559},"line":18,"code":"    it('200 when loading /', async () => {\n      const response = await fixture.fetch('/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when adding search params","suites":["Development Routing","No site config"],"updatePoint":{"line":22,"column":37,"index":715},"line":22,"code":"    it('200 when adding search params', async () => {\n      const response = await fixture.fetch('/?foo=bar');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading non-root page","suites":["Development Routing","No site config"],"updatePoint":{"line":26,"column":38,"index":880},"line":26,"code":"    it('200 when loading non-root page', async () => {\n      const response = await fixture.fetch('/another');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Development Routing","No site config"],"updatePoint":{"line":30,"column":38,"index":1044},"line":30,"code":"    it('200 when loading dynamic route', async () => {\n      const response = await fixture.fetch('/1');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Development Routing","No site config"],"updatePoint":{"line":34,"column":46,"index":1210},"line":34,"code":"    it('404 when loading invalid dynamic route', async () => {\n      const response = await fixture.fetch('/2');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"500 when redirecting in SSG mode","suites":["Development Routing","No site config"],"updatePoint":{"line":38,"column":40,"index":1370},"line":38,"code":"    it('500 when redirecting in SSG mode', async () => {\n      const response = await fixture.fetch('/redirect');\n      expect(response.status).to.equal(500);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /","suites":["Development Routing","No subpath used"],"updatePoint":{"line":59,"column":26,"index":2023},"line":59,"code":"    it('200 when loading /', async () => {\n      const response = await fixture.fetch('/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading non-root page","suites":["Development Routing","No subpath used"],"updatePoint":{"line":63,"column":38,"index":2180},"line":63,"code":"    it('200 when loading non-root page', async () => {\n      const response = await fixture.fetch('/another');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Development Routing","No subpath used"],"updatePoint":{"line":67,"column":38,"index":2344},"line":67,"code":"    it('200 when loading dynamic route', async () => {\n      const response = await fixture.fetch('/1');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Development Routing","No subpath used"],"updatePoint":{"line":71,"column":46,"index":2510},"line":71,"code":"    it('404 when loading invalid dynamic route', async () => {\n      const response = await fixture.fetch('/2');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":93,"column":26,"index":3190},"line":93,"code":"    it('404 when loading /', async () => {\n      const response = await fixture.fetch('/');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":97,"column":37,"index":3346},"line":97,"code":"    it('200 when loading subpath root', async () => {\n      const response = await fixture.fetch('/blog/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":101,"column":60,"index":3530},"line":101,"code":"    it('404 when loading subpath root without trailing slash', async () => {\n      const response = await fixture.fetch('/blog');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":105,"column":55,"index":3708},"line":105,"code":"    it('200 when loading another page with subpath used', async () => {\n      const response = await fixture.fetch('/blog/another/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":109,"column":38,"index":3878},"line":109,"code":"    it('200 when loading dynamic route', async () => {\n      const response = await fixture.fetch('/blog/1/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Development Routing","Subpath with trailing slash"],"updatePoint":{"line":113,"column":46,"index":4050},"line":113,"code":"    it('404 when loading invalid dynamic route', async () => {\n      const response = await fixture.fetch('/blog/2/');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":134,"column":26,"index":4703},"line":134,"code":"    it('404 when loading /', async () => {\n      const response = await fixture.fetch('/');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":138,"column":57,"index":4879},"line":138,"code":"    it('200 when loading subpath root with trailing slash', async () => {\n      const response = await fixture.fetch('/blog/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":142,"column":60,"index":5063},"line":142,"code":"    it('404 when loading subpath root without trailing slash', async () => {\n      const response = await fixture.fetch('/blog');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":146,"column":55,"index":5241},"line":146,"code":"    it('200 when loading another page with subpath used', async () => {\n      const response = await fixture.fetch('/blog/another/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":150,"column":38,"index":5411},"line":150,"code":"    it('200 when loading dynamic route', async () => {\n      const response = await fixture.fetch('/blog/1/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Development Routing","Subpath without trailing slash"],"updatePoint":{"line":154,"column":46,"index":5583},"line":154,"code":"    it('404 when loading invalid dynamic route', async () => {\n      const response = await fixture.fetch('/blog/2/');\n      expect(response.status).to.equal(404);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /home.json","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":174,"column":35,"index":6203},"line":174,"code":"    it('200 when loading /home.json', async () => {\n      const response = await fixture.fetch('/home.json');\n      expect(response.status).to.equal(200);\n      const body = await response.text().then(text => JSON.parse(text));\n      expect(body.title).to.equal('home');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /thing1.json","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":180,"column":37,"index":6484},"line":180,"code":"    it('200 when loading /thing1.json', async () => {\n      const response = await fixture.fetch('/thing1.json');\n      expect(response.status).to.equal(200);\n      const body = await response.text().then(text => JSON.parse(text));\n      expect(body.slug).to.equal('thing1');\n      expect(body.title).to.equal('[slug]');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /thing2.json","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":187,"column":37,"index":6813},"line":187,"code":"    it('200 when loading /thing2.json', async () => {\n      const response = await fixture.fetch('/thing2.json');\n      expect(response.status).to.equal(200);\n      const body = await response.text().then(text => JSON.parse(text));\n      expect(body.slug).to.equal('thing2');\n      expect(body.title).to.equal('[slug]');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /data/thing3.json","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":194,"column":42,"index":7147},"line":194,"code":"    it('200 when loading /data/thing3.json', async () => {\n      const response = await fixture.fetch('/data/thing3.json');\n      expect(response.status).to.equal(200);\n      const body = await response.text().then(text => JSON.parse(text));\n      expect(body.slug).to.equal('thing3');\n      expect(body.title).to.equal('data [slug]');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /data/thing4.json","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":201,"column":42,"index":7491},"line":201,"code":"    it('200 when loading /data/thing4.json', async () => {\n      const response = await fixture.fetch('/data/thing4.json');\n      expect(response.status).to.equal(200);\n      const body = await response.text().then(text => JSON.parse(text));\n      expect(body.slug).to.equal('thing4');\n      expect(body.title).to.equal('data [slug]');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct MIME type when loading /home.json (static route)","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":208,"column":64,"index":7857},"line":208,"code":"    it('correct MIME type when loading /home.json (static route)', async () => {\n      const response = await fixture.fetch('/home.json');\n      expect(response.headers.get('content-type')).to.match(/application\\/json/);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct MIME type when loading /thing1.json (dynamic route)","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":212,"column":67,"index":8089},"line":212,"code":"    it('correct MIME type when loading /thing1.json (dynamic route)', async () => {\n      const response = await fixture.fetch('/thing1.json');\n      expect(response.headers.get('content-type')).to.match(/application\\/json/);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct MIME type when loading /images/static.svg (static image)","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":216,"column":72,"index":8328},"line":216,"code":"    it('correct MIME type when loading /images/static.svg (static image)', async () => {\n      const response = await fixture.fetch('/images/static.svg');\n      expect(response.headers.get('content-type')).to.match(/image\\/svg\\+xml/);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct MIME type when loading /images/1.svg (dynamic image)","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":220,"column":68,"index":8567},"line":220,"code":"    it('correct MIME type when loading /images/1.svg (dynamic image)', async () => {\n      const response = await fixture.fetch('/images/1.svg');\n      expect(response.headers.get('content-type')).to.match(/image\\/svg\\+xml/);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"correct encoding when loading /images/hex.ts","suites":["Development Routing","Endpoint routes"],"updatePoint":{"line":224,"column":52,"index":8785},"line":224,"code":"    it('correct encoding when loading /images/hex.ts', async () => {\n      const response = await fixture.fetch('/images/hex');\n      const body = await response.arrayBuffer();\n      const hex = Buffer.from(body).toString('hex', 0, 4);\n\n      // Check if we have a PNG\n      expect(hex).to.equal('89504e47');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /index.html","suites":["Development Routing","file format routing"],"updatePoint":{"line":251,"column":36,"index":9601},"line":251,"code":"    it('200 when loading /index.html', async () => {\n      const response = await fixture.fetch('/index.html');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /","suites":["Development Routing","file format routing"],"updatePoint":{"line":255,"column":26,"index":9756},"line":255,"code":"    it('200 when loading /', async () => {\n      const response = await fixture.fetch('/');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /another.html","suites":["Development Routing","file format routing"],"updatePoint":{"line":259,"column":38,"index":9913},"line":259,"code":"    it('200 when loading /another.html', async () => {\n      const response = await fixture.fetch('/another.html');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /another","suites":["Development Routing","file format routing"],"updatePoint":{"line":263,"column":33,"index":10077},"line":263,"code":"    it('200 when loading /another', async () => {\n      const response = await fixture.fetch('/another');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /1.html","suites":["Development Routing","file format routing"],"updatePoint":{"line":267,"column":32,"index":10235},"line":267,"code":"    it('200 when loading /1.html', async () => {\n      const response = await fixture.fetch('/1.html');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /1","suites":["Development Routing","file format routing"],"updatePoint":{"line":271,"column":27,"index":10387},"line":271,"code":"    it('200 when loading /1', async () => {\n      const response = await fixture.fetch('/1');\n      expect(response.status).to.equal(200);\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /html-ext/1","suites":["Development Routing","file format routing"],"updatePoint":{"line":275,"column":36,"index":10543},"line":275,"code":"    it('200 when loading /html-ext/1', async () => {\n      const response = await fixture.fetch('/html-ext/1');\n      expect(response.status).to.equal(200);\n      expect(await response.text()).includes('none: 1');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /html-ext/1.html","suites":["Development Routing","file format routing"],"updatePoint":{"line":280,"column":41,"index":10770},"line":280,"code":"    it('200 when loading /html-ext/1.html', async () => {\n      const response = await fixture.fetch('/html-ext/1.html');\n      expect(response.status).to.equal(200);\n      expect(await response.text()).includes('html: 1');\n    });","file":"dev-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Throws an error when you attempt to build","suites":["outDir set to project root"],"updatePoint":{"line":20,"column":47,"index":513},"line":20,"code":"  it('Throws an error when you attempt to build', async () => {\n    expect(error).to.be.an.instanceOf(Error);\n    expect(error.message).to.match(/outDir cannot be the root folder/);\n  });","file":"dont-delete-root.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Files have not been deleted","suites":["outDir set to project root"],"updatePoint":{"line":24,"column":33,"index":687},"line":24,"code":"  it('Files have not been deleted', async () => {\n    const expectedFiles = ['package.json', 'astro.config.mjs', 'src/pages/index.astro'];\n    for (const rel of expectedFiles) {\n      const root = new URL('./fixtures/dont-delete-me/', import.meta.url);\n      const url = new URL('./' + rel, root);\n      const stats = await fs.promises.stat(url);\n      expect(stats).to.not.be.undefined;\n    }\n  });","file":"dont-delete-root.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Outputs a slug of undefined as the index.html","suites":["build.format=file with dynamic routes"],"updatePoint":{"line":16,"column":51,"index":482},"line":16,"code":"  it('Outputs a slug of undefined as the index.html', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('Astro Store');\n  });","file":"dynamic-route-build-file.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders correctly","suites":["vite.build.rollupOptions.entryFileNames"],"updatePoint":{"line":12,"column":23,"index":353},"line":12,"code":"  it('Renders correctly', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#hello')).to.have.a.lengthOf(1);\n  });","file":"entry-file-names.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Outputs a client module that was specified by the config","suites":["vite.build.rollupOptions.entryFileNames"],"updatePoint":{"line":17,"column":62,"index":575},"line":17,"code":"  it('Outputs a client module that was specified by the config', async () => {\n    const js = await fixture.readFile('/assets/js/Hello.js');\n    expect(js).to.be.a('string');\n    expect(js.length).to.be.greaterThan(0);\n  });","file":"entry-file-names.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not crash the dev server","suites":["Errors in JavaScript"],"updatePoint":{"line":19,"column":35,"index":535},"line":19,"code":"  it('Does not crash the dev server', async () => {\n    let res = await fixture.fetch('/');\n    let html = await res.text();\n    expect(html).to.include('ReferenceError');\n    res = await fixture.fetch('/');\n    await res.text();\n    expect(html).to.include('ReferenceError');\n  });","file":"error-bad-js.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes the file where the error happened","suites":["Errors information in build"],"updatePoint":{"line":6,"column":48,"index":238},"line":6,"code":"  it('includes the file where the error happened', async () => {\n    fixture = await loadFixture({\n      root: './fixtures/error-build-location'\n    });\n    let errorContent;\n    try {\n      await fixture.build();\n    } catch (e) {\n      errorContent = e;\n    }\n    expect(errorContent.id).to.equal('src/pages/index.astro');\n  });","file":"error-build-location.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not crash the dev server","suites":["Can handle errors that are not instanceof Error"],"updatePoint":{"line":18,"column":35,"index":529},"line":18,"code":"  it('Does not crash the dev server', async () => {\n    let res = await fixture.fetch('/');\n    let html = await res.text();\n    expect(html).to.include('Error');\n    res = await fixture.fetch('/');\n    await res.text();\n    expect(html).to.include('Error');\n  });","file":"error-non-error.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"All top-level keys added","suites":["Events","eventCliSession()"],"updatePoint":{"line":7,"column":32,"index":311},"line":7,"code":"    it('All top-level keys added', () => {\n      const config = {\n        root: 1,\n        srcDir: 2,\n        publicDir: 3,\n        outDir: 4,\n        site: 5,\n        base: 6,\n        trailingSlash: 7,\n        experimental: 8\n      };\n      const expected = Object.keys(config);\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).to.deep.equal(expected);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"configKeys includes format","suites":["Events","eventCliSession()"],"updatePoint":{"line":26,"column":34,"index":770},"line":26,"code":"    it('configKeys includes format', () => {\n      const config = {\n        srcDir: 1,\n        build: {\n          format: 'file'\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).to.deep.equal(['srcDir', 'build', 'build.format']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"config.build.format","suites":["Events","eventCliSession()"],"updatePoint":{"line":40,"column":27,"index":1115},"line":40,"code":"    it('config.build.format', () => {\n      const config = {\n        srcDir: 1,\n        build: {\n          format: 'file'\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.config.build.format).to.equal('file');\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"configKeys includes server props","suites":["Events","eventCliSession()"],"updatePoint":{"line":54,"column":40,"index":1448},"line":54,"code":"    it('configKeys includes server props', () => {\n      const config = {\n        srcDir: 1,\n        server: {\n          host: 'example.com',\n          port: 8033\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).to.deep.equal(['srcDir', 'server', 'server.host', 'server.port']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"configKeys is deep","suites":["Events","eventCliSession()"],"updatePoint":{"line":69,"column":26,"index":1835},"line":69,"code":"    it('configKeys is deep', () => {\n      const config = {\n        publicDir: 1,\n        markdown: {\n          drafts: true,\n          shikiConfig: {\n            lang: 1,\n            theme: 2,\n            wrap: 3\n          },\n          syntaxHighlight: 'shiki',\n          remarkPlugins: [],\n          rehypePlugins: []\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).to.deep.equal(['publicDir', 'markdown', 'markdown.drafts', 'markdown.shikiConfig', 'markdown.shikiConfig.lang', 'markdown.shikiConfig.theme', 'markdown.shikiConfig.wrap', 'markdown.syntaxHighlight', 'markdown.remarkPlugins', 'markdown.rehypePlugins']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"syntaxHighlight","suites":["Events","eventCliSession()"],"updatePoint":{"line":91,"column":23,"index":2576},"line":91,"code":"    it('syntaxHighlight', () => {\n      const config = {\n        markdown: {\n          syntaxHighlight: 'shiki'\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.config.markdown.syntaxHighlight).to.equal('shiki');\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"top-level vite keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":104,"column":40,"index":2916},"line":104,"code":"    it('top-level vite keys are captured', async () => {\n      const config = {\n        root: 'some/thing',\n        vite: {\n          css: {\n            modules: []\n          },\n          base: 'a',\n          mode: 'b',\n          define: {\n            a: 'b'\n          },\n          publicDir: 'some/dir'\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['root', 'vite', 'vite.css', 'vite.css.modules', 'vite.base', 'vite.mode', 'vite.define', 'vite.publicDir']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.resolve keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":126,"column":38,"index":3513},"line":126,"code":"    it('vite.resolve keys are captured', async () => {\n      const config = {\n        vite: {\n          resolve: {\n            alias: {\n              a: 'b'\n            },\n            dedupe: ['one', 'two']\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.resolve', 'vite.resolve.alias', 'vite.resolve.dedupe']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.css keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":144,"column":34,"index":3985},"line":144,"code":"    it('vite.css keys are captured', async () => {\n      const config = {\n        vite: {\n          resolve: {\n            dedupe: ['one', 'two']\n          },\n          css: {\n            modules: [],\n            postcss: {}\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.resolve', 'vite.resolve.dedupe', 'vite.css', 'vite.css.modules', 'vite.css.postcss']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.server keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":163,"column":37,"index":4512},"line":163,"code":"    it('vite.server keys are captured', async () => {\n      const config = {\n        vite: {\n          server: {\n            host: 'example.com',\n            open: true,\n            fs: {\n              strict: true,\n              allow: ['a', 'b']\n            }\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.server', 'vite.server.host', 'vite.server.open', 'vite.server.fs', 'vite.server.fs.strict', 'vite.server.fs.allow']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.build keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":183,"column":36,"index":5103},"line":183,"code":"    it('vite.build keys are captured', async () => {\n      const config = {\n        vite: {\n          build: {\n            target: 'one',\n            outDir: 'some/dir',\n            cssTarget: {\n              one: 'two'\n            }\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.build', 'vite.build.target', 'vite.build.outDir', 'vite.build.cssTarget']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.preview keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":202,"column":38,"index":5627},"line":202,"code":"    it('vite.preview keys are captured', async () => {\n      const config = {\n        vite: {\n          preview: {\n            host: 'example.com',\n            port: 8080,\n            another: {\n              a: 'b'\n            }\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.preview', 'vite.preview.host', 'vite.preview.port', 'vite.preview.another']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.optimizeDeps keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":221,"column":43,"index":6152},"line":221,"code":"    it('vite.optimizeDeps keys are captured', async () => {\n      const config = {\n        vite: {\n          optimizeDeps: {\n            entries: ['one', 'two'],\n            exclude: ['secret', 'name']\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.optimizeDeps', 'vite.optimizeDeps.entries', 'vite.optimizeDeps.exclude']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.ssr keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":237,"column":34,"index":6632},"line":237,"code":"    it('vite.ssr keys are captured', async () => {\n      const config = {\n        vite: {\n          ssr: {\n            external: ['a'],\n            target: {\n              one: 'two'\n            }\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.ssr', 'vite.ssr.external', 'vite.ssr.target']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"vite.worker keys are captured","suites":["Events","eventCliSession()"],"updatePoint":{"line":255,"column":37,"index":7092},"line":255,"code":"    it('vite.worker keys are captured', async () => {\n      const config = {\n        vite: {\n          worker: {\n            format: {\n              a: 'b'\n            },\n            plugins: ['a', 'b']\n          }\n        }\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.configKeys).is.deep.equal(['vite', 'vite.worker', 'vite.worker.format', 'vite.worker.plugins']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"falsy integrations","suites":["Events","eventCliSession()"],"updatePoint":{"line":273,"column":26,"index":7552},"line":273,"code":"    it('falsy integrations', () => {\n      const config = {\n        srcDir: 1,\n        integrations: [null, undefined, false]\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config);\n      expect(payload.config.integrations.length).to.equal(0);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes cli flags in payload","suites":["Events","eventCliSession()"],"updatePoint":{"line":285,"column":37,"index":7879},"line":285,"code":"    it('includes cli flags in payload', () => {\n      const config = {};\n      const flags = {\n        root: 'root',\n        site: 'http://example.com',\n        host: true,\n        port: 8080,\n        config: 'path/to/config.mjs',\n        experimentalSsr: true,\n        experimentalIntegrations: true,\n        drafts: true\n      };\n      const [{\n        payload\n      }] = events.eventCliSession({\n        cliCommand: 'dev'\n      }, config, flags);\n      expect(payload.flags).to.deep.equal(['root', 'site', 'host', 'port', 'config', 'experimentalSsr', 'experimentalIntegrations', 'drafts']);\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns the expected event and payload","suites":["Events","eventConfigError()"],"updatePoint":{"line":306,"column":46,"index":8537},"line":306,"code":"    it('returns the expected event and payload', () => {\n      const [event] = events.eventConfigError({\n        err: {\n          issues: [{\n            path: ['a', 'b', 'c']\n          }, {\n            path: ['d', 'e', 'f']\n          }]\n        },\n        cmd: 'COMMAND_NAME',\n        isFatal: true\n      });\n      expect(event).to.deep.equal({\n        eventName: 'ASTRO_CLI_ERROR',\n        payload: {\n          code: AstroErrorData.UnknownConfigError.code,\n          name: 'ZodError',\n          isFatal: true,\n          isConfig: true,\n          cliCommand: 'COMMAND_NAME',\n          configErrorPaths: ['a.b.c', 'd.e.f']\n        }\n      });\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns the expected event payload with a detailed error object","suites":["Events","eventError()"],"updatePoint":{"line":332,"column":71,"index":9253},"line":332,"code":"    it('returns the expected event payload with a detailed error object', () => {\n      const errorWithFullMetadata = new Error('TEST ERROR MESSAGE');\n      errorWithFullMetadata.code = 1234;\n      errorWithFullMetadata.plugin = 'TEST PLUGIN';\n      const [event] = events.eventError({\n        err: errorWithFullMetadata,\n        cmd: 'COMMAND_NAME',\n        isFatal: true\n      });\n      expect(event).to.deep.equal({\n        eventName: 'ASTRO_CLI_ERROR',\n        payload: {\n          code: 1234,\n          plugin: 'TEST PLUGIN',\n          name: 'Error',\n          isFatal: true,\n          cliCommand: 'COMMAND_NAME',\n          anonymousMessageHint: 'TEST ERROR MESSAGE'\n        }\n      });\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns the expected event payload for AstroError","suites":["Events","eventError()"],"updatePoint":{"line":353,"column":57,"index":9939},"line":353,"code":"    it('returns the expected event payload for AstroError', () => {\n      const [event] = events.eventError({\n        err: new AstroError({\n          ...AstroErrorData.ClientAddressNotAvailable,\n          message: AstroErrorData.ClientAddressNotAvailable.message('mysuperadapter')\n        }),\n        cmd: 'COMMAND_NAME',\n        isFatal: false\n      });\n      expect(event).to.deep.equal({\n        eventName: 'ASTRO_CLI_ERROR',\n        payload: {\n          anonymousMessageHint: '`Astro.clientAddress` is not available in the `ADAPTER_NAME` adapter. File an issue with the adapter to add support.',\n          cliCommand: 'COMMAND_NAME',\n          code: 3002,\n          isFatal: false,\n          name: 'ClientAddressNotAvailable',\n          plugin: undefined\n        }\n      });\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns the expected event payload with a generic error","suites":["Events","eventError()"],"updatePoint":{"line":374,"column":63,"index":10732},"line":374,"code":"    it('returns the expected event payload with a generic error', () => {\n      const [event] = events.eventError({\n        err: new Error('TEST ERROR MESSAGE'),\n        cmd: 'COMMAND_NAME',\n        isFatal: false\n      });\n      expect(event).to.deep.equal({\n        eventName: 'ASTRO_CLI_ERROR',\n        payload: {\n          code: AstroErrorData.UnknownError.code,\n          name: 'Error',\n          plugin: undefined,\n          isFatal: false,\n          cliCommand: 'COMMAND_NAME',\n          anonymousMessageHint: 'TEST ERROR MESSAGE'\n        }\n      });\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly creates anonymousMessageHint from a basic error message","suites":["Events","eventError()"],"updatePoint":{"line":392,"column":72,"index":11307},"line":392,"code":"    it('properly creates anonymousMessageHint from a basic error message', () => {\n      const [event] = events.eventError({\n        err: new Error('TEST ERROR MESSAGE: Sensitive data is \"/Users/MYNAME/foo.astro\"'),\n        cmd: 'COMMAND_NAME',\n        name: 'Error',\n        isFatal: true\n      });\n      expect(event.payload.anonymousMessageHint).to.equal('TEST ERROR MESSAGE');\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly exclude stack traces from anonymousMessageHint","suites":["Events","eventError()"],"updatePoint":{"line":401,"column":63,"index":11687},"line":401,"code":"    it('properly exclude stack traces from anonymousMessageHint', () => {\n      // Some libraries/frameworks returns stack traces in the error message, make sure we don't include that in the anonymousMessageHint\n      const [event] = events.eventError({\n        err: new Error(`[postcss] /home/projects/github-ssfd5p/src/components/Counter.css:3:15: Missed semicolon\n    at Input.error (file:///home/projects/github-ssfd5p/node_modules/postcss/lib/input.js:148:16)\n    at Parser.checkMissedSemicolon (file:///home/projects/github-ssfd5p/node_modules/postcss/lib/parser.js:596:22)\n    at Parser.decl (file:///home/projects/github-ssfd5p/node_modules/postcss/lib/parser.js:279:12)\n    at Parser.other (file:///home/projects/github-ssfd5p/node_modules/postcss/lib/parser.js:128:18)\n    at Parser.parse (file:///home/projects/github-ssfd5p/node_modules/postcss/lib/parser.js:72:16)`),\n        cmd: 'COMMAND_NAME',\n        name: 'Error',\n        isFatal: true\n      });\n      expect(event.payload.anonymousMessageHint).to.be.undefined;\n    });","file":"events.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is available in Astro pages","suites":["Global Fetch"],"updatePoint":{"line":12,"column":33,"index":326},"line":12,"code":"  it('Is available in Astro pages', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#astro-page').text()).to.equal('function', 'Fetch supported in .astro page');\n  });","file":"fetch.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is available in Astro components","suites":["Global Fetch"],"updatePoint":{"line":17,"column":38,"index":569},"line":17,"code":"  it('Is available in Astro components', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#astro-component').text()).to.equal('function', 'Fetch supported in .astro components');\n  });","file":"fetch.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is available in non-Astro components","suites":["Global Fetch"],"updatePoint":{"line":22,"column":42,"index":827},"line":22,"code":"  it('Is available in non-Astro components', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#jsx').text()).to.equal('function', 'Fetch supported in .jsx');\n    expect($('#svelte').text()).to.equal('function', 'Fetch supported in .svelte');\n    expect($('#vue').text()).to.equal('function', 'Fetch supported in .vue');\n  });","file":"fetch.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Respects existing code","suites":["Global Fetch"],"updatePoint":{"line":29,"column":28,"index":1208},"line":29,"code":"  it('Respects existing code', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#already-imported').text()).to.equal('function', 'Existing fetch imports respected');\n    expect($('#custom-declaration').text()).to.equal('number', 'Custom fetch declarations respected');\n  });","file":"fetch.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be imported in frontmatter","suites":["@fontsource/* packages"],"updatePoint":{"line":12,"column":36,"index":352},"line":12,"code":"  it('can be imported in frontmatter', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const assetPath = $('link').attr('href');\n    const css = await fixture.readFile(assetPath);\n    expect(css).to.contain('Montserrat');\n  });","file":"fontsource.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes index page","suites":["getStaticPaths with trailingSlash: ignore"],"updatePoint":{"line":13,"column":25,"index":399},"line":13,"code":"  it('includes index page', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('Page 1');\n  });","file":"get-static-paths-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes paginated page","suites":["getStaticPaths with trailingSlash: ignore"],"updatePoint":{"line":18,"column":29,"index":584},"line":18,"code":"  it('includes paginated page', async () => {\n    let html = await fixture.readFile('/2/index.html');\n    let $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('Page 2');\n  });","file":"get-static-paths-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"It includes styles from child components","suites":["Astro.glob on pages/ directory"],"updatePoint":{"line":12,"column":46,"index":366},"line":12,"code":"  it('It includes styles from child components', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    expect($('link[rel=stylesheet]')).to.have.a.lengthOf(1);\n  });","file":"glob-pages-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"only injects head content once","suites":["Head injection","build","Markdown"],"updatePoint":{"line":17,"column":40,"index":488},"line":17,"code":"      it('only injects head content once', async () => {\n        const html = await fixture.readFile(`/index.html`);\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using slots within slots","suites":["Head injection","build","Astro components"],"updatePoint":{"line":24,"column":34,"index":766},"line":24,"code":"      it('Using slots within slots', async () => {\n        const html = await fixture.readFile('/with-slot-in-slot/index.html');\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1);\n        expect($('body link[rel=stylesheet]')).to.have.a.lengthOf(0);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using slots with Astro.slots.render()","suites":["Head injection","build","Astro components"],"updatePoint":{"line":30,"column":47,"index":1096},"line":30,"code":"      it('Using slots with Astro.slots.render()', async () => {\n        const html = await fixture.readFile('/with-slot-render/index.html');\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1);\n        expect($('body link[rel=stylesheet]')).to.have.a.lengthOf(0);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using slots within slots using Astro.slots.render()","suites":["Head injection","build","Astro components"],"updatePoint":{"line":36,"column":61,"index":1439},"line":36,"code":"      it('Using slots within slots using Astro.slots.render()', async () => {\n        const html = await fixture.readFile('/with-slot-in-render-slot/index.html');\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(2);\n        expect($('body link[rel=stylesheet]')).to.have.a.lengthOf(0);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using slots in Astro.slots.render() inside head buffering","suites":["Head injection","build","Astro components"],"updatePoint":{"line":42,"column":67,"index":1796},"line":42,"code":"      it('Using slots in Astro.slots.render() inside head buffering', async () => {\n        const html = await fixture.readFile('/with-render-slot-in-head-buffer/index.html');\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(2);\n        expect($('body link[rel=stylesheet]')).to.have.a.lengthOf(0);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using slots with Astro.slots.render() (layout)","suites":["Head injection","build","Astro components"],"updatePoint":{"line":48,"column":56,"index":2149},"line":48,"code":"      it('Using slots with Astro.slots.render() (layout)', async () => {\n        const html = await fixture.readFile('/with-slot-render2/index.html');\n        const $ = cheerio.load(html);\n        expect($('head link[rel=stylesheet]')).to.have.a.lengthOf(1);\n        expect($('body link[rel=stylesheet]')).to.have.a.lengthOf(0);\n      });","file":"head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Component","build"],"updatePoint":{"line":15,"column":13,"index":380},"line":15,"code":"    it('works', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const h1 = $('h1');\n      const foo = $('#foo');\n      expect(h1.text()).to.equal('Hello component!');\n      expect(foo.text()).to.equal('bar');\n    });","file":"html-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Component","dev"],"updatePoint":{"line":32,"column":13,"index":859},"line":32,"code":"    it('works', async () => {\n      const res = await fixture.fetch('/');\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const h1 = $('h1');\n      const foo = $('#foo');\n      expect(h1.text()).to.equal('Hello component!');\n      expect(foo.text()).to.equal('bar');\n    });","file":"html-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Escape","build"],"updatePoint":{"line":15,"column":13,"index":374},"line":15,"code":"    it('works', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const div = $('div');\n      expect(div.text()).to.equal('${foo}');\n      const span = $('span');\n      expect(span.attr('${attr}')).to.equal('');\n      const ce = $('custom-element');\n      expect(ce.attr('x-data')).to.equal('`${test}`');\n      const script = $('script');\n      expect(script.text()).to.equal('console.log(`hello ${\"world\"}!`)');\n    });","file":"html-escape.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Escape","dev"],"updatePoint":{"line":36,"column":13,"index":1055},"line":36,"code":"    it('works', async () => {\n      const res = await fixture.fetch('/');\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const div = $('div');\n      expect(div.text()).to.equal('${foo}');\n      const span = $('span');\n      expect(span.attr('${attr}')).to.equal('');\n      const ce = $('custom-element');\n      expect(ce.attr('x-data')).to.equal('`${test}`');\n      const script = $('script');\n      expect(script.text()).to.equal('console.log(`hello ${\"world\"}!`)');\n    });","file":"html-escape.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Page","build"],"updatePoint":{"line":15,"column":13,"index":370},"line":15,"code":"    it('works', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const h1 = $('h1');\n      expect(h1.text()).to.equal('Hello page!');\n    });","file":"html-page.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Page","dev"],"updatePoint":{"line":30,"column":13,"index":773},"line":30,"code":"    it('works', async () => {\n      const res = await fixture.fetch('/');\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const h1 = $('h1');\n      expect(h1.text()).to.equal('Hello page!');\n    });","file":"html-page.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Slots","build"],"updatePoint":{"line":15,"column":13,"index":372},"line":15,"code":"    it('works', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const slotDefault = $('#default');\n      expect(slotDefault.text()).to.equal('Default');\n      const a = $('#a');\n      expect(a.text().trim()).to.equal('A');\n      const b = $('#b');\n      expect(b.text().trim()).to.equal('B');\n      const c = $('#c');\n      expect(c.text().trim()).to.equal('C');\n      const inline = $('#inline');\n      expect(inline.html()).to.equal('<slot is:inline=\"\"></slot>');\n    });","file":"html-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["HTML Slots","dev"],"updatePoint":{"line":38,"column":13,"index":1108},"line":38,"code":"    it('works', async () => {\n      const res = await fixture.fetch('/');\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const slotDefault = $('#default');\n      expect(slotDefault.text()).to.equal('Default');\n      const a = $('#a');\n      expect(a.text().trim()).to.equal('A');\n      const b = $('#b');\n      expect(b.text().trim()).to.equal('B');\n      const c = $('#c');\n      expect(c.text().trim()).to.equal('C');\n      const inline = $('#inline');\n      expect(inline.html()).to.equal('<slot is:inline=\"\"></slot>');\n    });","file":"html-slots.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Places the hydration script before the first island","suites":["Hydration script ordering"],"updatePoint":{"line":12,"column":57,"index":377},"line":12,"code":"  it('Places the hydration script before the first island', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n\n    // First, let's make sure all islands rendered (or test is bad)\n    expect($('astro-island')).to.have.a.lengthOf(3);\n\n    // Now let's make sure the hydration script is placed before the first component\n    let firstIsland = $($('astro-island').get(0));\n    let prevSibling = firstIsland.prev();\n    expect(prevSibling.prop('tagName')).to.equal('SCRIPT');\n\n    // Sanity check that we're only rendering them once.\n    expect($('style')).to.have.a.lengthOf(1, 'hydration style added once');\n    expect($('script')).to.have.a.lengthOf(1, 'only one hydration script needed');\n  });","file":"hydration-race.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in .astro files","suites":["Using .js extension on .ts file"],"updatePoint":{"line":13,"column":27,"index":399},"line":13,"code":"  it('works in .astro files', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('bar');\n  });","file":"import-ts-with-js.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"supports .mjs files","suites":["Integration addPageExtension"],"updatePoint":{"line":13,"column":25,"index":407},"line":13,"code":"  it('supports .mjs files', async () => {\n    const html = await fixture.readFile('/test/index.html');\n    const $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('Hello world!');\n  });","file":"integration-add-page-extension.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load simple JSX components","suites":["jsx-runtime"],"updatePoint":{"line":12,"column":36,"index":326},"line":12,"code":"  it('Can load simple JSX components', async () => {\n    const html = await fixture.readFile('/component/index.html');\n    const $ = cheerio.load(html);\n    expect($('#basic').text()).to.equal('Basic');\n    expect($('#named').text()).to.equal('Named');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Preact component inside Astro JSX","suites":["jsx-runtime"],"updatePoint":{"line":18,"column":48,"index":597},"line":18,"code":"  it('Can load Preact component inside Astro JSX', async () => {\n    const html = await fixture.readFile('/frameworks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#has-preact #preact').length).to.equal(1);\n    expect($('#preact').text()).to.include('Preact');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load React component inside Astro JSX","suites":["jsx-runtime"],"updatePoint":{"line":24,"column":47,"index":879},"line":24,"code":"  it('Can load React component inside Astro JSX', async () => {\n    const html = await fixture.readFile('/frameworks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#has-react #react').length).to.equal(1);\n    expect($('#react').text()).to.include('React');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Solid component inside Astro JSX","suites":["jsx-runtime"],"updatePoint":{"line":30,"column":47,"index":1157},"line":30,"code":"  it('Can load Solid component inside Astro JSX', async () => {\n    const html = await fixture.readFile('/frameworks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#has-solid #solid').length).to.equal(1);\n    expect($('#solid').text()).to.include('Solid');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Svelte component inside Astro JSX","suites":["jsx-runtime"],"updatePoint":{"line":36,"column":48,"index":1436},"line":36,"code":"  it('Can load Svelte component inside Astro JSX', async () => {\n    const html = await fixture.readFile('/frameworks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#has-svelte #svelte').length).to.equal(1);\n    expect($('#svelte').text()).to.include('Svelte');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Vue component inside Astro JSX","suites":["jsx-runtime"],"updatePoint":{"line":42,"column":45,"index":1716},"line":42,"code":"  it('Can load Vue component inside Astro JSX', async () => {\n    const html = await fixture.readFile('/frameworks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#has-vue #vue').length).to.equal(1);\n    expect($('#vue').text()).to.include('Vue');\n  });","file":"jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders styles only once","suites":["Lazily imported layouts"],"updatePoint":{"line":13,"column":30,"index":388},"line":13,"code":"  it('Renders styles only once', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('link')).to.have.a.lengthOf(1);\n  });","file":"lazy-layout.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders a custom element by Constructor","suites":["LitElement test"],"updatePoint":{"line":19,"column":45,"index":618},"line":19,"code":"  it('Renders a custom element by Constructor', async () => {\n    // @lit-labs/ssr/ requires Node 13.9 or higher\n    if (NODE_VERSION < 13.9) {\n      return;\n    }\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: attributes rendered – non reactive properties\n    expect($('#default').attr('foo')).to.equal('bar');\n\n    // test 2: shadow rendered\n    expect($('#default').html()).to.include(`<div>Testing...</div>`);\n\n    // test 3: string reactive property set\n    expect(stripExpressionMarkers($('#default').html())).to.include(`<div id=\"str\">initialized</div>`);\n\n    // test 4: boolean reactive property correctly set\n    // <my-element bool=\"false\"> Lit will equate to true because it uses\n    // this.hasAttribute to determine its value\n    expect(stripExpressionMarkers($('#default').html())).to.include(`<div id=\"bool\">B</div>`);\n\n    // test 5: object reactive property set\n    // by default objects will be stringified to [object Object]\n    expect(stripExpressionMarkers($('#default').html())).to.include(`<div id=\"data\">data: 1</div>`);\n\n    // test 6: reactive properties are not rendered as attributes\n    expect($('#default').attr('obj')).to.equal(undefined);\n    expect($('#default').attr('bool')).to.equal(undefined);\n    expect($('#default').attr('str')).to.equal(undefined);\n\n    // test 7: reflected reactive props are rendered as attributes\n    expect($('#default').attr('reflectedbool')).to.equal('');\n    expect($('#default').attr('reflected-str')).to.equal('default reflected string');\n    expect($('#default').attr('reflected-str-prop')).to.equal('initialized reflected');\n  });","file":"lit-element.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Sets defer-hydration on element only when necessary","suites":["LitElement test"],"updatePoint":{"line":55,"column":57,"index":2290},"line":55,"code":"  it('Sets defer-hydration on element only when necessary', async () => {\n    // @lit-labs/ssr/ requires Node 13.9 or higher\n    if (NODE_VERSION < 13.9) {\n      return;\n    }\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: reflected reactive props are rendered as attributes\n    expect($('#non-deferred').attr('count')).to.equal('10');\n\n    // test 2: non-reactive props are set as attributes\n    expect($('#non-deferred').attr('foo')).to.equal('bar');\n\n    // test 3: components with only reflected reactive props set are not\n    // deferred because their state can be completely serialized via attributes\n    expect($('#non-deferred').attr('defer-hydration')).to.equal(undefined);\n\n    // test 4: components with non-reflected reactive props set are deferred because\n    // their state needs to be synced with the server on the client.\n    expect($('#default').attr('defer-hydration')).to.equal('');\n  });","file":"lit-element.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Correctly passes child slots","suites":["LitElement test"],"updatePoint":{"line":77,"column":34,"index":3234},"line":77,"code":"  it('Correctly passes child slots', async () => {\n    // @lit-labs/ssr/ requires Node 13.9 or higher\n    if (NODE_VERSION < 13.9) {\n      return;\n    }\n    const html = await fixture.readFile('/slots/index.html');\n    const $ = cheerio.load(html);\n    const $rootMyElement = $('#root');\n    const $slottedMyElement = $('#slotted');\n    const $slottedSlottedMyElement = $('#slotted-slotted');\n    expect($('#default').length).to.equal(3);\n\n    // Root my-element\n    expect($rootMyElement.children('.default').length).to.equal(2);\n    expect($rootMyElement.children('.default').eq(1).text()).to.equal('my-element default 2');\n    expect($rootMyElement.children('[slot=\"named\"]').length).to.equal(4);\n    expect($rootMyElement.children('[slot=\"named\"]').eq(1).text()).to.equal('my-element named 2');\n    expect($rootMyElement.children('[slot=\"named\"]').eq(2).attr('id')).to.equal('list');\n    expect($rootMyElement.children('[slot=\"named\"]').eq(3).attr('id')).to.equal('slotted');\n\n    // Slotted my-element first level\n    expect($slottedMyElement.children('.default').length).to.equal(1);\n    expect($slottedMyElement.children('.default').eq(0).text()).to.equal('slotted my-element default');\n    expect($slottedMyElement.children('[slot=\"named\"]').length).to.equal(3);\n    expect($slottedMyElement.children('[slot=\"named\"]').eq(1).text()).to.equal('slotted my-element named 2');\n    expect($slottedMyElement.children('[slot=\"named\"]').eq(2).attr('id')).to.equal('slotted-slotted');\n\n    // Slotted my-element second level\n    expect($slottedSlottedMyElement.children('.default').length).to.equal(2);\n    expect($slottedSlottedMyElement.children('.default').eq(1).text()).to.equal('slotted slotted my-element default 2');\n    expect($slottedSlottedMyElement.children('[slot=\"named\"]').length).to.equal(2);\n    expect($slottedSlottedMyElement.children('[slot=\"named\"]').eq(1).text()).to.equal('slotted slotted my-element named 2');\n  });","file":"lit-element.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to build when behind getStaticPaths","suites":["LitElement test"],"updatePoint":{"line":110,"column":49,"index":5187},"line":110,"code":"  it('Is able to build when behind getStaticPaths', async () => {\n    const dynamicPage = await fixture.readFile('/1/index.html');\n    expect(dynamicPage.length).to.be.greaterThan(0);\n  });","file":"lit-element.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a markdown page with the `.markdown` extension","suites":["Markdown tests","Build"],"updatePoint":{"line":16,"column":63,"index":472},"line":16,"code":"    it('Can load a markdown page with the `.markdown` extension', async () => {\n      const html = await fixture.readFile('/dot-markdown-page/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').html()).to.equal('Page with alternative .markdown extension');\n      expect($('p').html()).to.equal('Hope this loads fine 🤞');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a markdown page with the `.mdwn` extension","suites":["Markdown tests","Build"],"updatePoint":{"line":22,"column":59,"index":817},"line":22,"code":"    it('Can load a markdown page with the `.mdwn` extension', async () => {\n      const html = await fixture.readFile('/dot-mdwn-page/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').html()).to.equal('Page with alternative .mdwn extension');\n      expect($('p').html()).to.equal('Hope this loads fine 🤞');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a markdown page with the `.mkdn` extension","suites":["Markdown tests","Build"],"updatePoint":{"line":28,"column":59,"index":1154},"line":28,"code":"    it('Can load a markdown page with the `.mkdn` extension', async () => {\n      const html = await fixture.readFile('/dot-mkdn-page/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').html()).to.equal('Page with alternative .mkdn extension');\n      expect($('p').html()).to.equal('Hope this loads fine 🤞');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a markdown page with the `.mdown` extension","suites":["Markdown tests","Build"],"updatePoint":{"line":34,"column":60,"index":1492},"line":34,"code":"    it('Can load a markdown page with the `.mdown` extension', async () => {\n      const html = await fixture.readFile('/dot-mdown-page/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').html()).to.equal('Page with alternative .mdown extension');\n      expect($('p').html()).to.equal('Hope this loads fine 🤞');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a markdown page with the `.mkd` extension","suites":["Markdown tests","Build"],"updatePoint":{"line":40,"column":58,"index":1830},"line":40,"code":"    it('Can load a markdown page with the `.mkd` extension', async () => {\n      const html = await fixture.readFile('/dot-mkd-page/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').html()).to.equal('Page with alternative .mkd extension');\n      expect($('p').html()).to.equal('Hope this loads fine 🤞');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a simple markdown page with Astro","suites":["Markdown tests","Build"],"updatePoint":{"line":46,"column":50,"index":2156},"line":46,"code":"    it('Can load a simple markdown page with Astro', async () => {\n      const html = await fixture.readFile('/post/index.html');\n      const $ = cheerio.load(html);\n      expect($('p').first().text()).to.equal('Hello world!');\n      expect($('#first').text()).to.equal('Some content');\n      expect($('#interesting-topic').text()).to.equal('Interesting Topic');\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a realworld markdown page with Astro","suites":["Markdown tests","Build"],"updatePoint":{"line":53,"column":53,"index":2530},"line":53,"code":"    it('Can load a realworld markdown page with Astro', async () => {\n      const html = await fixture.readFile('/realworld/index.html');\n      const $ = cheerio.load(html);\n      expect($('pre')).to.have.lengthOf(7);\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not unescape entities","suites":["Markdown tests","Build"],"updatePoint":{"line":58,"column":34,"index":2737},"line":58,"code":"    it('Does not unescape entities', async () => {\n      const html = await fixture.readFile('/entities/index.html');\n      expect(html).to.match(new RegExp('&#x3C;i>This should NOT be italic&#x3C;/i>'));\n    });","file":"markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"when the first throws but the second does not, use the second renderer","suites":["Multiple renderers"],"updatePoint":{"line":13,"column":76,"index":436},"line":13,"code":"  it('when the first throws but the second does not, use the second renderer', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#component')).to.have.a.lengthOf(1);\n  });","file":"multiple-renderers.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load page","suites":["Non-ASCII Path Test","build"],"updatePoint":{"line":13,"column":21,"index":361},"line":13,"code":"    it('Can load page', async () => {\n      const html = await fixture.readFile(`/index.html`);\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('测试 OK');\n    });","file":"non-ascii-path.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should match contents","suites":["Non-HTML Pages","json"],"updatePoint":{"line":12,"column":29,"index":324},"line":12,"code":"    it('should match contents', async () => {\n      const json = JSON.parse(await fixture.readFile('/about.json'));\n      expect(json).to.have.property('name', 'Astro');\n      expect(json).to.have.property('url', 'https://astro.build/');\n    });","file":"non-html-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should not have had its encoding mangled","suites":["Non-HTML Pages","png"],"updatePoint":{"line":19,"column":48,"index":621},"line":19,"code":"    it('should not have had its encoding mangled', async () => {\n      const buffer = await fixture.readFile('/placeholder.png', 'base64');\n\n      // Sanity check the first byte\n      const hex = Buffer.from(buffer, 'base64').toString('hex');\n      const firstHexByte = hex.slice(0, 2);\n      // If we accidentally utf8 encode the png, the first byte (in hex) will be 'c2'\n      expect(firstHexByte).to.not.equal('c2');\n      // and if correctly encoded in binary, it should be '89'\n      expect(firstHexByte).to.equal('89');\n\n      // Make sure the whole buffer (in base64) matches this snapshot\n      expect(buffer).to.equal('iVBORw0KGgoAAAANSUhEUgAAAGQAAACWCAYAAAAouC1GAAAD10lEQVR4Xu3ZbW4iMRCE4c1RuP+ZEEfZFZHIAgHGH9Xtsv3m94yx6qHaM+HrfD7//cOfTQJfgNhYfG8EEC8PQMw8AAHELQGz/XCGAGKWgNl2aAggZgmYbYeGAGKWgNl2aAggZgmYbYeGAGKWgNl2aAggZgmYbYeGAGKWgNl2aAggZgmYbYeGAGKWgNl2aAggZgmYbYeGAGKWgNl2aAggZgmYbWe6hpxOp6oIL5dL1fWjL54CpBbhXagz4FiDqCCegZxhLEGiIGaAsQPJwrjhuLXFBiQbwrUtFiCjMZzaMhzEBcMFZSiIG4YDyjAQV4zRKENA3DFGoqSDzIIxCgWQgn9eZb6rpILM1o57qyyUNJCZMTLHFyAFI2s5kBXakYWS0hBAymsYDrISRkZLACn/8j5cGfXUFQqyYjuiWwJIY0Out0W0JAxk5XZEtgQQGtKRgOGt6rEV0pAdxlXU2AKks3U0pDPAiNuVKDREIGQNstP5EXGOyBsCSF/lAOnL7/tuRpYgRPUSKhQaIpIBRBSkahlAVEmK1gFEFKRqGUuQHR951e8i0kMdkP6+SUGu29kVxXJkAUJD+hMQrUBDREGqlgFElaRgHRXGdSsc6oAIEjBbgoYAUpfAbu8i1g3Z7V1EiRFyqANSN02er5Y/Zd0+YJexNUVDdmmJGiNsZAHSPrbCRtYOKFM1ZHWQCIzQkbX64Q5I+1iW3xmFkdKQFUcXIPLvePuCkRhpDVmpJcuArIASjZHakNmfujIwAKk4SpYFmXF0ZWEMachsoysTYyjIDE3JxhgO4owyAsMCxBFlFIYNiBPKSAxAnh57R2PYgLj9/j4SJvQXw5L3LjeM+z2PgBkG4gzx/EXKhEkHmQliRFvSQGaFyEZJAVkB4wYTPb7CQVbCyEAJA1kRImN8hYCsjhHZFDnILhhRKICUvL0eXKM86KUgu7Uj4kyRgeyMoRxfEhAw/neld3x1g4Dx+4DpQQFEcKi/WqIVpQuEdrzXTAcB47haLSjNDQHkGOR6RS1KEwgYZRgtj8PVIGDUYdS2BJD6fJvuKB1dVSC0o8ni56YSFED6Mq66WwpCO6qyf3vxEUpxQwAxAgFDg1HyGFzUEECMQMDQYhy15LAhgBiBgBGD8ent/WNDAIkDeYcCSGzmH1d/9U7yFoR25Eg9owCSk3vxmzsgM4AwrnKV7sfWy4YAAkhuAmaf9rEhtCNfC5D8zA8/8Yby6wyhIYfZhVwASEis7Yu+BKEd7YH23glIb4IB919RHs4QGhKQcsWSgFSElXEpIBkpV3zGAwjjqiK5oEsBCQq2Z9l/4WuAC09sfQEAAAAASUVORK5CYII=');\n    });","file":"non-html-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"relative urls created point to sibling folders","suites":["build.format","directory","Build"],"updatePoint":{"line":17,"column":56,"index":520},"line":17,"code":"      it('relative urls created point to sibling folders', async () => {\n        let html = await fixture.readFile('/nested/page/index.html');\n        let $ = cheerio.load(html);\n        expect($('#another').attr('href')).to.equal('/nested/page/another/');\n      });","file":"page-format.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"relative urls created point to sibling folders","suites":["build.format","file","Build"],"updatePoint":{"line":39,"column":56,"index":1165},"line":39,"code":"      it('relative urls created point to sibling folders', async () => {\n        let html = await fixture.readFile('/nested/page.html');\n        let $ = cheerio.load(html);\n        expect($('#another').attr('href')).to.equal('/nested/another/');\n      });","file":"page-format.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Doesn't add page styles for a page without style imports","suites":["Page-level styles"],"updatePoint":{"line":14,"column":62,"index":402},"line":14,"code":"  it(\"Doesn't add page styles for a page without style imports\", async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = await cheerioLoad(html);\n    expect($('link').length).to.equal(0);\n  });","file":"page-level-styles.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does add page styles for pages with style imports (or deps)","suites":["Page-level styles"],"updatePoint":{"line":19,"column":65,"index":623},"line":19,"code":"  it('Does add page styles for pages with style imports (or deps)', async () => {\n    let html = await fixture.readFile('/blog/index.html');\n    let $ = await cheerioLoad(html);\n    expect($('link').length).to.equal(1);\n  });","file":"page-level-styles.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in Astro page styles","suites":["PostCSS"],"updatePoint":{"line":24,"column":32,"index":945},"line":24,"code":"  it('works in Astro page styles', () => {\n    expect(bundledCSS).to.match(new RegExp(`\\.astro-page(\\.(\\w|-)*)*\\.nested`));\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in Astro component styles","suites":["PostCSS"],"updatePoint":{"line":27,"column":37,"index":1080},"line":27,"code":"  it('works in Astro component styles', () => {\n    expect(bundledCSS).to.match(new RegExp(`\\.astro-component(\\.(\\w|-)*)*\\.nested`));\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in JSX","suites":["PostCSS"],"updatePoint":{"line":30,"column":18,"index":1201},"line":30,"code":"  it('works in JSX', () => {\n    expect(bundledCSS).to.match(new RegExp(`\\.solid(\\.(\\w|-)*)*\\.nested`));\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in Vue","suites":["PostCSS"],"updatePoint":{"line":33,"column":18,"index":1312},"line":33,"code":"  it('works in Vue', () => {\n    expect(bundledCSS).to.match(new RegExp(`\\.vue(\\.(\\w|-)*)*\\.nested`));\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works in Svelte","suites":["PostCSS"],"updatePoint":{"line":36,"column":21,"index":1424},"line":36,"code":"  it('works in Svelte', () => {\n    expect(bundledCSS).to.match(new RegExp(`\\.svelte(\\.(\\w|-)*)*\\.nested`));\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"ignores CSS in public/","suites":["PostCSS"],"updatePoint":{"line":39,"column":28,"index":1546},"line":39,"code":"  it('ignores CSS in public/', async () => {\n    const publicCSS = (await fixture.readFile('/global.css')).trim().replace(/\\s/g, '').replace('/n', '');\n    // neither minified nor prefixed\n    expect(eol.lf(publicCSS)).to.equal(`.global{appearance:none;}`);\n  });","file":"postcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Counter","suites":["Preact compat component","Development"],"updatePoint":{"line":13,"column":24,"index":403},"line":13,"code":"    it('Can load Counter', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n      expect($('#counter-text').text()).to.be.eq('0');\n    });","file":"preact-compat-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Counter","suites":["Preact compat component","Build"],"updatePoint":{"line":27,"column":24,"index":823},"line":27,"code":"    it('Can load Counter', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#counter-text').text()).to.be.eq('0');\n    });","file":"preact-compat-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load class component","suites":["Preact component"],"updatePoint":{"line":13,"column":30,"index":386},"line":13,"code":"  it('Can load class component', async () => {\n    const html = await fixture.readFile('/class/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can use class components\n    expect($('#class-component')).to.have.lengthOf(1);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load function component","suites":["Preact component"],"updatePoint":{"line":20,"column":33,"index":634},"line":20,"code":"  it('Can load function component', async () => {\n    const html = await fixture.readFile('/fn/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can use function components\n    expect($('#fn-component')).to.have.lengthOf(1);\n    // test 2: Can use function components\n    expect($('#arrow-fn-component')).to.have.lengthOf(1);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load TS component","suites":["Preact component"],"updatePoint":{"line":29,"column":27,"index":974},"line":29,"code":"  it('Can load TS component', async () => {\n    const html = await fixture.readFile('/ts-components/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: Can use TS components\n    expect($('.ts-component')).to.have.lengthOf(1);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can use hooks","suites":["Preact component"],"updatePoint":{"line":36,"column":19,"index":1210},"line":36,"code":"  it('Can use hooks', async () => {\n    const html = await fixture.readFile('/hooks/index.html');\n    const $ = cheerio.load(html);\n    expect($('#world')).to.have.lengthOf(1);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can export a Fragment","suites":["Preact component"],"updatePoint":{"line":41,"column":27,"index":1401},"line":41,"code":"  it('Can export a Fragment', async () => {\n    const html = await fixture.readFile('/frag/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: nothing rendered but it didn’t throw\n    expect($('body').children()).to.have.lengthOf(0);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can use a pragma comment","suites":["Preact component"],"updatePoint":{"line":48,"column":30,"index":1656},"line":48,"code":"  it('Can use a pragma comment', async () => {\n    const html = await fixture.readFile('/pragma-comment/index.html');\n    const $ = cheerio.load(html);\n\n    // test 1: rendered the PragmaComment component\n    expect($('.pragma-comment')).to.have.lengthOf(1);\n    expect($('.pragma-comment-tsx')).to.have.lengthOf(1);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Uses the new JSX transform","suites":["Preact component"],"line":58,"code":"  it.skip('Uses the new JSX transform', async () => {","file":"preact-component.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"Can use shared signals between islands","suites":["Preact component"],"updatePoint":{"line":76,"column":44,"index":2743},"line":76,"code":"  it('Can use shared signals between islands', async () => {\n    const html = await fixture.readFile('/signals/index.html');\n    const $ = cheerio.load(html);\n    expect($('.preact-signal')).to.have.a.lengthOf(2);\n    const sigs1Raw = $($('astro-island')[0]).attr('data-preact-signals');\n    const sigs2Raw = $($('astro-island')[1]).attr('data-preact-signals');\n    expect(sigs1Raw).to.not.be.undefined;\n    expect(sigs2Raw).to.not.be.undefined;\n    const sigs1 = JSON.parse(sigs1Raw);\n    const sigs2 = JSON.parse(sigs2Raw);\n    expect(sigs1.count).to.not.be.undefined;\n    expect(sigs1.count).to.equal(sigs2.count);\n  });","file":"preact-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":29,"column":28,"index":1002},"line":29,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":33,"column":59,"index":1186},"line":33,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n        expect(response.redirected).to.equal(false);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":38,"column":62,"index":1431},"line":38,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading another page with subpath used","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":42,"column":57,"index":1617},"line":42,"code":"      it('404 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":46,"column":40,"index":1795},"line":46,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":50,"column":48,"index":1974},"line":50,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":76,"column":28,"index":2892},"line":76,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":80,"column":59,"index":3076},"line":80,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":84,"column":62,"index":3268},"line":84,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":88,"column":57,"index":3454},"line":88,"code":"      it('200 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading another page with subpath not used","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":92,"column":61,"index":3653},"line":92,"code":"      it('404 when loading another page with subpath not used', async () => {\n        const response = await fixture.fetch('/blog/another');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":96,"column":40,"index":3830},"line":96,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":100,"column":48,"index":4010},"line":100,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":126,"column":28,"index":4929},"line":126,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":130,"column":59,"index":5113},"line":130,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":134,"column":62,"index":5305},"line":134,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":138,"column":57,"index":5491},"line":138,"code":"      it('200 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath not used","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":142,"column":61,"index":5690},"line":142,"code":"      it('200 when loading another page with subpath not used', async () => {\n        const response = await fixture.fetch('/blog/another');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":146,"column":40,"index":5867},"line":146,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: directory","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":150,"column":48,"index":6047},"line":150,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":181,"column":28,"index":7070},"line":181,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":185,"column":59,"index":7254},"line":185,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n        expect(response.redirected).to.equal(false);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":190,"column":62,"index":7499},"line":190,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading another page with subpath used","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":194,"column":57,"index":7685},"line":194,"code":"      it('404 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":198,"column":40,"index":7863},"line":198,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: never"],"updatePoint":{"line":202,"column":48,"index":8042},"line":202,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":231,"column":28,"index":9019},"line":231,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":235,"column":59,"index":9203},"line":235,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":239,"column":62,"index":9395},"line":239,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":243,"column":57,"index":9581},"line":243,"code":"      it('200 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading another page with subpath not used","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":247,"column":61,"index":9780},"line":247,"code":"      it('404 when loading another page with subpath not used', async () => {\n        const response = await fixture.fetch('/blog/another');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":251,"column":40,"index":9957},"line":251,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: always"],"updatePoint":{"line":255,"column":48,"index":10137},"line":255,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":284,"column":28,"index":11115},"line":284,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath root with trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":288,"column":59,"index":11299},"line":288,"code":"      it('200 when loading subpath root with trailing slash', async () => {\n        const response = await fixture.fetch('/blog/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading subpath root without trailing slash","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":292,"column":62,"index":11491},"line":292,"code":"      it('404 when loading subpath root without trailing slash', async () => {\n        const response = await fixture.fetch('/blog');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":296,"column":57,"index":11677},"line":296,"code":"      it('200 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath not used","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":300,"column":61,"index":11876},"line":300,"code":"      it('200 when loading another page with subpath not used', async () => {\n        const response = await fixture.fetch('/blog/another');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":304,"column":40,"index":12053},"line":304,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1/');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: file","Subpath without trailing slash and trailingSlash: ignore"],"updatePoint":{"line":308,"column":48,"index":12233},"line":308,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading /","suites":["Preview Routing","build format: file","Exact file path"],"updatePoint":{"line":337,"column":28,"index":13170},"line":337,"code":"      it('404 when loading /', async () => {\n        const response = await fixture.fetch('/');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading subpath with index.html","suites":["Preview Routing","build format: file","Exact file path"],"updatePoint":{"line":341,"column":50,"index":13345},"line":341,"code":"      it('200 when loading subpath with index.html', async () => {\n        const response = await fixture.fetch('/blog/index.html');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading another page with subpath used","suites":["Preview Routing","build format: file","Exact file path"],"updatePoint":{"line":345,"column":57,"index":13542},"line":345,"code":"      it('200 when loading another page with subpath used', async () => {\n        const response = await fixture.fetch('/blog/another.html');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading dynamic route","suites":["Preview Routing","build format: file","Exact file path"],"updatePoint":{"line":349,"column":40,"index":13724},"line":349,"code":"      it('200 when loading dynamic route', async () => {\n        const response = await fixture.fetch('/blog/1.html');\n        expect(response.status).to.equal(200);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 when loading invalid dynamic route","suites":["Preview Routing","build format: file","Exact file path"],"updatePoint":{"line":353,"column":48,"index":13908},"line":353,"code":"      it('404 when loading invalid dynamic route', async () => {\n        const response = await fixture.fetch('/blog/2.html');\n        expect(response.status).to.equal(404);\n      });","file":"preview-routing.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /@vite/client","suites":["Public dev with base"],"updatePoint":{"line":18,"column":36,"index":548},"line":18,"code":"  it('200 when loading /@vite/client', async () => {\n    const response = await fixture.fetch('/@vite/client', {\n      redirect: 'manual'\n    });\n    expect(response.status).to.equal(200);\n    const content = await response.text();\n    expect(content).to.contain('vite');\n  });","file":"public-base-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"200 when loading /blog/twitter.png","suites":["Public dev with base"],"updatePoint":{"line":26,"column":40,"index":830},"line":26,"code":"  it('200 when loading /blog/twitter.png', async () => {\n    const response = await fixture.fetch('/blog/twitter.png', {\n      redirect: 'manual'\n    });\n    expect(response.status).to.equal(200);\n  });","file":"public-base-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"custom 404 page when loading /blog/blog/","suites":["Public dev with base"],"updatePoint":{"line":32,"column":46,"index":1039},"line":32,"code":"  it('custom 404 page when loading /blog/blog/', async () => {\n    const response = await fixture.fetch('/blog/blog/');\n    const html = await response.text();\n    $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('404');\n  });","file":"public-base-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"default 404 hint page when loading /","suites":["Public dev with base"],"updatePoint":{"line":38,"column":42,"index":1273},"line":38,"code":"  it('default 404 hint page when loading /', async () => {\n    const response = await fixture.fetch('/');\n    expect(response.status).to.equal(404);\n    const html = await response.text();\n    $ = cheerio.load(html);\n    expect($('a').first().text()).to.equal('/blog/');\n  });","file":"public-base-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"default 404 page when loading /none/","suites":["Public dev with base"],"updatePoint":{"line":45,"column":42,"index":1550},"line":45,"code":"  it('default 404 page when loading /none/', async () => {\n    const response = await fixture.fetch('/none/', {\n      headers: {\n        accept: 'text/html,*/*'\n      }\n    });\n    expect(response.status).to.equal(404);\n    const html = await response.text();\n    $ = cheerio.load(html);\n    expect($('h1').text()).to.equal('404:  Not found');\n    expect($('pre').text()).to.equal('Path: /none/');\n  });","file":"public-base-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Reads jsxImportSource from tsconfig","suites":["Solid app with some React components"],"updatePoint":{"line":13,"column":41,"index":416},"line":13,"code":"  it('Reads jsxImportSource from tsconfig', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    expect($('#example-solid').text()).to.equal('example solidjs component');\n    expect($('#example-react').text()).to.equal('example react component');\n  });","file":"react-and-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load React","suites":["React Components","build"],"updatePoint":{"line":15,"column":22,"index":412},"line":15,"code":"    it('Can load React', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerioLoad(html);\n\n      // test 1: basic component renders\n      expect($('#react-static').text()).to.equal('Hello static!');\n\n      // test 2: no reactroot\n      expect($('#react-static').attr('data-reactroot')).to.equal(undefined);\n\n      // test 3: Can use function components\n      expect($('#arrow-fn-component')).to.have.lengthOf(1);\n\n      // test 4: Can use spread for components\n      expect($('#component-spread-props')).to.have.lengthOf(1);\n\n      // test 5: spread props renders\n      expect($('#component-spread-props').text(), 'Hello world!');\n\n      // test 6: Can use TS components\n      expect($('.ts-component')).to.have.lengthOf(1);\n\n      // test 7: Can use Pure components\n      expect($('#pure')).to.have.lengthOf(1);\n\n      // test 8: Check number of islands\n      expect($('astro-island[uid]')).to.have.lengthOf(7);\n\n      // test 9: Check island deduplication\n      const uniqueRootUIDs = new Set($('astro-island').map((i, el) => $(el).attr('uid')));\n      expect(uniqueRootUIDs.size).to.equal(6);\n\n      // test 10: Should properly render children passed as props\n      const islandsWithChildren = $('.with-children');\n      expect(islandsWithChildren).to.have.lengthOf(2);\n      expect($(islandsWithChildren[0]).html()).to.equal($(islandsWithChildren[1]).html());\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Vue","suites":["React Components","build"],"updatePoint":{"line":52,"column":20,"index":1824},"line":52,"code":"    it('Can load Vue', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerioLoad(html);\n      expect($('#vue-h2').text()).to.equal('Hasta la vista, baby');\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can use a pragma comment","suites":["React Components","build"],"updatePoint":{"line":57,"column":32,"index":2042},"line":57,"code":"    it('Can use a pragma comment', async () => {\n      const html = await fixture.readFile('/pragma-comment/index.html');\n      const $ = cheerioLoad(html);\n\n      // test 1: rendered the PragmaComment component\n      expect($('.pragma-comment')).to.have.lengthOf(2);\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes reactroot on hydrating components","suites":["React Components","build"],"line":66,"code":"    it.skip('Includes reactroot on hydrating components', async () => {","file":"react-component.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"Can load Suspense-using components","suites":["React Components","build"],"updatePoint":{"line":77,"column":42,"index":2764},"line":77,"code":"    it('Can load Suspense-using components', async () => {\n      const html = await fixture.readFile('/suspense/index.html');\n      const $ = cheerioLoad(html);\n      expect($('#client #lazy')).to.have.lengthOf(1);\n      expect($('#server #lazy')).to.have.lengthOf(1);\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can pass through props with cloneElement","suites":["React Components","build"],"updatePoint":{"line":83,"column":48,"index":3047},"line":83,"code":"    it('Can pass through props with cloneElement', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerioLoad(html);\n      expect($('#cloned').text()).to.equal('Cloned With Props');\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"scripts proxy correctly","suites":["React Components","dev"],"updatePoint":{"line":99,"column":31,"index":3532},"line":99,"code":"    it('scripts proxy correctly', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerioLoad(html);\n      for (const script of $('script').toArray()) {\n        const {\n          src\n        } = script.attribs;\n        if (!src) continue;\n        expect((await fixture.fetch(src)).status, `404: ${src}`).to.equal(200);\n      }\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Throws helpful error message on window SSR","suites":["React Components","dev"],"line":112,"code":"    it.skip('Throws helpful error message on window SSR', async () => {","file":"react-component.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"uses the new JSX transform","suites":["React Components","dev"],"line":121,"code":"    it.skip('uses the new JSX transform', async () => {","file":"react-component.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"When a nested component throws it does not crash the server","suites":["React Components","dev"],"updatePoint":{"line":139,"column":67,"index":5131},"line":139,"code":"    it('When a nested component throws it does not crash the server', async () => {\n      const res = await fixture.fetch('/error-rendering');\n      await res.arrayBuffer();\n    });","file":"react-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load all JSX components","suites":["react-jsx-export"],"updatePoint":{"line":25,"column":33,"index":1056},"line":25,"code":"  it('Can load all JSX components', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    ids.forEach(id => {\n      expect($(`#${id}`).text()).to.equal('Example');\n    });\n  });","file":"react-jsx-export.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Cannot output React Invalid Hook warning","suites":["react-jsx-export"],"updatePoint":{"line":32,"column":46,"index":1301},"line":32,"code":"  it('Cannot output React Invalid Hook warning', async () => {\n    expect(logs.every(log => log.message.indexOf(reactInvalidHookWarning) === -1)).to.be.true;\n  });","file":"react-jsx-export.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to build and renders and stuff","suites":["Re-exported astro components with client components"],"updatePoint":{"line":12,"column":44,"index":413},"line":12,"code":"  it('Is able to build and renders and stuff', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('astro-island').length).to.equal(1);\n    expect($('astro-island').attr('component-export')).to.equal('One');\n  });","file":"reexport-astro-containing-client-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes all styles on the page","suites":["Remote CSS"],"updatePoint":{"line":12,"column":37,"index":333},"line":12,"code":"  it('Includes all styles on the page', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const relPath = $('link').attr('href');\n    const css = await fixture.readFile(relPath);\n    expect(css).to.match(/https:\\/\\/unpkg.com\\/open-props/);\n    expect(css).to.match(/body/);\n  });","file":"remote-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"when the srcDir is \".\" which parser style in index.astro","suites":["srcDir"],"updatePoint":{"line":12,"column":62,"index":359},"line":12,"code":"  it('when the srcDir is \".\" which parser style in index.astro', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    const relPath = $('link').attr('href');\n    const css = await fixture.readFile(relPath);\n    console.log(css);\n    expect(css).to.match(/body{color:green}/);\n  });","file":"root-srcdir-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":" (trailing slash)","suites":["Routing priority","dev"],"updatePoint":{"line":195,"column":41,"index":5005},"line":195,"code":"      it(`${description} (trailing slash)`, async () => {\n        const html = await fixture.fetch(appendForwardSlash(url)).then(res => res.text());\n        const $ = cheerioLoad(html);\n        if (fourOhFour) {\n          expect($('title').text()).to.equal('404: Not Found');\n          return;\n        }\n        if (h1) {\n          expect($('h1').text()).to.equal(h1);\n        }\n        if (p) {\n          expect($('p').text()).to.equal(p);\n        }\n        if (htmlMatch) {\n          expect(html).to.equal(htmlMatch);\n        }\n      });","file":"routing-priority.test.js","skipped":false,"dir":"packages/astro/test"},{"name":" (index.html)","suites":["Routing priority","dev"],"updatePoint":{"line":214,"column":37,"index":5613},"line":214,"code":"      it(`${description} (index.html)`, async () => {\n        const html = await fixture.fetch(`${appendForwardSlash(url)}index.html`).then(res => res.text());\n        const $ = cheerioLoad(html);\n        if (fourOhFour) {\n          expect($('title').text()).to.equal('404: Not Found');\n          return;\n        }\n        if (h1) {\n          expect($('h1').text()).to.equal(h1);\n        }\n        if (p) {\n          expect($('p').text()).to.equal(p);\n        }\n        if (htmlMatch) {\n          expect(html).to.equal(htmlMatch);\n        }\n      });","file":"routing-priority.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a plain value","suites":["serialize"],"updatePoint":{"line":4,"column":30,"index":162},"line":4,"code":"  it('serializes a plain value', () => {\n    const input = {\n      a: 1\n    };\n    const output = `{\"a\":[0,1]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes an array","suites":["serialize"],"updatePoint":{"line":11,"column":25,"index":328},"line":11,"code":"  it('serializes an array', () => {\n    const input = {\n      a: [0]\n    };\n    const output = `{\"a\":[1,\"[[0,0]]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a regular expression","suites":["serialize"],"updatePoint":{"line":18,"column":37,"index":516},"line":18,"code":"  it('serializes a regular expression', () => {\n    const input = {\n      a: /b/\n    };\n    const output = `{\"a\":[2,\"b\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Date","suites":["serialize"],"updatePoint":{"line":25,"column":23,"index":684},"line":25,"code":"  it('serializes a Date', () => {\n    const input = {\n      a: new Date(0)\n    };\n    const output = `{\"a\":[3,\"1970-01-01T00:00:00.000Z\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Map","suites":["serialize"],"updatePoint":{"line":32,"column":22,"index":882},"line":32,"code":"  it('serializes a Map', () => {\n    const input = {\n      a: new Map([[0, 1]])\n    };\n    const output = `{\"a\":[4,\"[[1,\\\\\"[[0,0],[0,1]]\\\\\"]]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Set","suites":["serialize"],"updatePoint":{"line":39,"column":22,"index":1087},"line":39,"code":"  it('serializes a Set', () => {\n    const input = {\n      a: new Set([0, 1, 2, 3])\n    };\n    const output = `{\"a\":[5,\"[[0,0],[0,1],[0,2],[0,3]]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a BigInt","suites":["serialize"],"updatePoint":{"line":46,"column":25,"index":1299},"line":46,"code":"  it('serializes a BigInt', () => {\n    const input = {\n      a: BigInt('1')\n    };\n    const output = `{\"a\":[6,\"1\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a URL","suites":["serialize"],"updatePoint":{"line":53,"column":22,"index":1474},"line":53,"code":"  it('serializes a URL', () => {\n    const input = {\n      a: new URL('https://example.com/')\n    };\n    const output = `{\"a\":[7,\"https://example.com/\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Uint8Array","suites":["serialize"],"updatePoint":{"line":60,"column":29,"index":1695},"line":60,"code":"  it('serializes a Uint8Array', () => {\n    const input = {\n      a: new Uint8Array([1, 2, 3])\n    };\n    const output = `{\"a\":[8,\"[1,2,3]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Uint16Array","suites":["serialize"],"updatePoint":{"line":67,"column":30,"index":1898},"line":67,"code":"  it('serializes a Uint16Array', () => {\n    const input = {\n      a: new Uint16Array([1, 2, 3])\n    };\n    const output = `{\"a\":[9,\"[1,2,3]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"serializes a Uint32Array","suites":["serialize"],"updatePoint":{"line":74,"column":30,"index":2102},"line":74,"code":"  it('serializes a Uint32Array', () => {\n    const input = {\n      a: new Uint32Array([1, 2, 3])\n    };\n    const output = `{\"a\":[10,\"[1,2,3]\"]}`;\n    expect(serializeProps(input)).to.equal(output);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"cannot serialize a cyclic reference","suites":["serialize"],"updatePoint":{"line":81,"column":41,"index":2318},"line":81,"code":"  it('cannot serialize a cyclic reference', () => {\n    const a = {};\n    a.b = a;\n    const input = {\n      a\n    };\n    expect(() => serializeProps(input)).to.throw(/cyclic/);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"cannot serialize a cyclic array","suites":["serialize"],"updatePoint":{"line":89,"column":37,"index":2498},"line":89,"code":"  it('cannot serialize a cyclic array', () => {\n    const input = {\n      foo: ['bar']\n    };\n    input.foo.push(input);\n    expect(() => serializeProps(input)).to.throw(/cyclic/);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"cannot serialize a deep cyclic reference","suites":["serialize"],"updatePoint":{"line":96,"column":46,"index":2694},"line":96,"code":"  it('cannot serialize a deep cyclic reference', () => {\n    const a = {\n      b: {}\n    };\n    a.b.c = a;\n    const input = {\n      a\n    };\n    expect(() => serializeProps(input)).to.throw(/cyclic/);\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can serialize shared references that are not cyclic","suites":["serialize"],"updatePoint":{"line":106,"column":57,"index":2913},"line":106,"code":"  it('can serialize shared references that are not cyclic', () => {\n    const b = {};\n    const input = {\n      a: {\n        b,\n        b\n      },\n      b\n    };\n    expect(() => serializeProps(input)).not.to.throw();\n  });","file":"serialize.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can take a fetch()","suites":["set:html","Development"],"updatePoint":{"line":24,"column":26,"index":705},"line":24,"code":"    it('can take a fetch()', async () => {\n      let res = await fixture.fetch('/fetch');\n      expect(res.status).to.equal(200);\n      let html = await res.text();\n      const $ = cheerio.load(html);\n      expect($('#fetched-html')).to.have.a.lengthOf(1);\n      expect($('#fetched-html').text()).to.equal('works');\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can take a string of HTML","suites":["set:html","Build"],"updatePoint":{"line":37,"column":33,"index":1132},"line":37,"code":"    it('can take a string of HTML', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#html-inner')).to.have.a.lengthOf(1);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can take a Promise to a string of HTML","suites":["set:html","Build"],"updatePoint":{"line":42,"column":46,"index":1351},"line":42,"code":"    it('can take a Promise to a string of HTML', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#promise-html-inner')).to.have.a.lengthOf(1);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can take a Response to a string of HTML","suites":["set:html","Build"],"updatePoint":{"line":47,"column":47,"index":1579},"line":47,"code":"    it('can take a Response to a string of HTML', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#response-html-inner')).to.have.a.lengthOf(1);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can take an Iterator","suites":["set:html","Build"],"updatePoint":{"line":52,"column":28,"index":1789},"line":52,"code":"    it('can take an Iterator', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#iterator-num')).to.have.a.lengthOf(5);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can take an AsyncIterator","suites":["set:html","Build"],"updatePoint":{"line":57,"column":33,"index":1997},"line":57,"code":"    it('Can take an AsyncIterator', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#asynciterator-num')).to.have.a.lengthOf(5);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can take a ReadableStream","suites":["set:html","Build"],"updatePoint":{"line":62,"column":33,"index":2210},"line":62,"code":"    it('Can take a ReadableStream', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#readable-inner')).to.have.a.lengthOf(1);\n    });","file":"set-html.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Preact"],"updatePoint":{"line":12,"column":26,"index":327},"line":12,"code":"  it('Renders default slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default-self-closing').text().trim()).to.equal('Fallback');\n    expect($('#default-empty').text().trim()).to.equal('Fallback');\n    expect($('#zero').text().trim()).to.equal('0');\n    expect($('#false').text().trim()).to.equal('');\n    expect($('#string').text().trim()).to.equal('');\n    expect($('#content').text().trim()).to.equal('Hello world!');\n  });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Preact"],"updatePoint":{"line":22,"column":24,"index":830},"line":22,"code":"  it('Renders named slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#named').text().trim()).to.equal('Fallback / Named');\n  });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: Preact"],"updatePoint":{"line":27,"column":42,"index":1053},"line":27,"code":"  it('Converts dash-case slot to camelCase', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n  });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Preact","For MDX Pages"],"updatePoint":{"line":33,"column":28,"index":1306},"line":33,"code":"    it('Renders default slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#content').text().trim()).to.equal('Hello world!');\n    });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Preact","For MDX Pages"],"updatePoint":{"line":38,"column":26,"index":1523},"line":38,"code":"    it('Renders named slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#named').text().trim()).to.equal('Fallback / Named');\n    });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: Preact","For MDX Pages"],"updatePoint":{"line":43,"column":44,"index":1760},"line":43,"code":"    it('Converts dash-case slot to camelCase', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n    });","file":"slots-preact.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: React"],"updatePoint":{"line":12,"column":26,"index":325},"line":12,"code":"  it('Renders default slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default-self-closing').text().trim()).to.equal('Fallback');\n    expect($('#default-empty').text().trim()).to.equal('Fallback');\n    expect($('#zero').text().trim()).to.equal('0');\n    expect($('#false').text().trim()).to.equal('');\n    expect($('#string').text().trim()).to.equal('');\n    expect($('#content').text().trim()).to.equal('Hello world!');\n  });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: React"],"updatePoint":{"line":22,"column":24,"index":828},"line":22,"code":"  it('Renders named slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#named').text().trim()).to.equal('Fallback / Named');\n  });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: React"],"updatePoint":{"line":27,"column":42,"index":1051},"line":27,"code":"  it('Converts dash-case slot to camelCase', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n  });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: React","For MDX Pages"],"updatePoint":{"line":33,"column":28,"index":1304},"line":33,"code":"    it('Renders default slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#content').text().trim()).to.equal('Hello world!');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: React","For MDX Pages"],"updatePoint":{"line":38,"column":26,"index":1521},"line":38,"code":"    it('Renders named slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#named').text().trim()).to.equal('Fallback / Named');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: React","For MDX Pages"],"updatePoint":{"line":43,"column":44,"index":1758},"line":43,"code":"    it('Converts dash-case slot to camelCase', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Simple imperative slot render","suites":["Slots: React","Slots.render() API"],"updatePoint":{"line":50,"column":37,"index":2049},"line":50,"code":"    it('Simple imperative slot render', async () => {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render')).to.have.lengthOf(1);\n      expect($('#render').text()).to.equal('render');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Child function render without args","suites":["Slots: React","Slots.render() API"],"updatePoint":{"line":56,"column":42,"index":2330},"line":56,"code":"    it('Child function render without args', async () => {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render-fn')).to.have.lengthOf(1);\n      expect($('#render-fn').text()).to.equal('render-fn');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Child function render with args","suites":["Slots: React","Slots.render() API"],"updatePoint":{"line":62,"column":39,"index":2617},"line":62,"code":"    it('Child function render with args', async () => {\n      const html = await fixture.readFile('/slottedapi-render/index.html');\n      const $ = cheerio.load(html);\n      expect($('#render-args')).to.have.lengthOf(1);\n      expect($('#render-args span')).to.have.lengthOf(1);\n      expect($('#render-args').text()).to.equal('render-args');\n    });","file":"slots-react.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Solid"],"updatePoint":{"line":12,"column":26,"index":325},"line":12,"code":"  it('Renders default slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default-self-closing').text().trim()).to.equal('Fallback');\n    expect($('#default-empty').text().trim()).to.equal('Fallback');\n    expect($('#zero').text().trim()).to.equal('0');\n    expect($('#false').text().trim()).to.equal('');\n    expect($('#string').text().trim()).to.equal('');\n    expect($('#content').text().trim()).to.equal('Hello world!');\n  });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Solid"],"updatePoint":{"line":22,"column":24,"index":828},"line":22,"code":"  it('Renders named slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#named').text().trim()).to.equal('Fallback / Named');\n  });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: Solid"],"updatePoint":{"line":27,"column":42,"index":1051},"line":27,"code":"  it('Converts dash-case slot to camelCase', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n  });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Solid","For MDX Pages"],"updatePoint":{"line":33,"column":28,"index":1304},"line":33,"code":"    it('Renders default slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#content').text().trim()).to.equal('Hello world!');\n    });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Solid","For MDX Pages"],"updatePoint":{"line":38,"column":26,"index":1521},"line":38,"code":"    it('Renders named slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#named').text().trim()).to.equal('Fallback / Named');\n    });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: Solid","For MDX Pages"],"updatePoint":{"line":43,"column":44,"index":1758},"line":43,"code":"    it('Converts dash-case slot to camelCase', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n    });","file":"slots-solid.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Svelte"],"updatePoint":{"line":12,"column":26,"index":327},"line":12,"code":"  it('Renders default slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default-self-closing').text().trim()).to.equal('Fallback');\n    expect($('#default-empty').text().trim()).to.equal('Fallback');\n    expect($('#zero').text().trim()).to.equal('0');\n    expect($('#false').text().trim()).to.equal('');\n    expect($('#string').text().trim()).to.equal('');\n    expect($('#content').text().trim()).to.equal('Hello world!');\n  });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Svelte"],"updatePoint":{"line":22,"column":24,"index":830},"line":22,"code":"  it('Renders named slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#named').text().trim()).to.equal('Fallback / Named');\n  });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Preserves dash-case slot","suites":["Slots: Svelte"],"updatePoint":{"line":27,"column":30,"index":1041},"line":27,"code":"  it('Preserves dash-case slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n  });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Svelte","For MDX Pages"],"updatePoint":{"line":33,"column":28,"index":1294},"line":33,"code":"    it('Renders default slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#content').text().trim()).to.equal('Hello world!');\n    });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Svelte","For MDX Pages"],"updatePoint":{"line":38,"column":26,"index":1511},"line":38,"code":"    it('Renders named slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#named').text().trim()).to.equal('Fallback / Named');\n    });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Preserves dash-case slot","suites":["Slots: Svelte","For MDX Pages"],"updatePoint":{"line":43,"column":32,"index":1736},"line":43,"code":"    it('Preserves dash-case slot', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n    });","file":"slots-svelte.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Vue"],"updatePoint":{"line":12,"column":26,"index":321},"line":12,"code":"  it('Renders default slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#default-self-closing').text().trim()).to.equal('Fallback');\n    expect($('#default-empty').text().trim()).to.equal('Fallback');\n    expect($('#zero').text().trim()).to.equal('0');\n    expect($('#false').text().trim()).to.equal('');\n    expect($('#string').text().trim()).to.equal('');\n    expect($('#content').text().trim()).to.equal('Hello world!');\n  });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Vue"],"updatePoint":{"line":22,"column":24,"index":824},"line":22,"code":"  it('Renders named slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#named').text().trim()).to.equal('Fallback / Named');\n  });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Preserves dash-case slot","suites":["Slots: Vue"],"updatePoint":{"line":27,"column":30,"index":1035},"line":27,"code":"  it('Preserves dash-case slot', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n  });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders default slot","suites":["Slots: Vue","For MDX Pages"],"updatePoint":{"line":33,"column":28,"index":1288},"line":33,"code":"    it('Renders default slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#content').text().trim()).to.equal('Hello world!');\n    });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders named slot","suites":["Slots: Vue","For MDX Pages"],"updatePoint":{"line":38,"column":26,"index":1505},"line":38,"code":"    it('Renders named slot', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#named').text().trim()).to.equal('Fallback / Named');\n    });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Converts dash-case slot to camelCase","suites":["Slots: Vue","For MDX Pages"],"updatePoint":{"line":43,"column":44,"index":1742},"line":43,"code":"    it('Converts dash-case slot to camelCase', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerio.load(html);\n      expect($('#dash-case').text().trim()).to.equal('Fallback / Dash Case');\n    });","file":"slots-vue.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a component","suites":["Solid component","build"],"updatePoint":{"line":15,"column":28,"index":408},"line":15,"code":"    it('Can load a component', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n\n      // test 1: Works\n      expect($('.hello')).to.have.lengthOf(1);\n\n      // test 2: Support rendering proxy components\n      expect($('#proxy-component').text()).to.be.equal('Hello world');\n    });","file":"solid-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load a component","suites":["Solid component","dev"],"updatePoint":{"line":35,"column":28,"index":971},"line":35,"code":"    it('Can load a component', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n\n      // test 1: Works\n      expect($('.hello')).to.have.lengthOf(1);\n\n      // test 2: Support rendering proxy components\n      expect($('#proxy-component').text()).to.be.equal('Hello world');\n    });","file":"solid-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"scripts proxy correctly","suites":["Solid component","dev"],"updatePoint":{"line":45,"column":31,"index":1327},"line":45,"code":"    it('scripts proxy correctly', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n      for (const script of $('script').toArray()) {\n        const {\n          src\n        } = script.attribs;\n        if (!src) continue;\n        expect((await fixture.fetch(src)).status, `404: ${src}`).to.equal(200);\n      }\n    });","file":"solid-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds sourcemap","suites":["Sourcemap"],"updatePoint":{"line":11,"column":22,"index":286},"line":11,"code":"  it('Builds sourcemap', async () => {\n    const dir = await fixture.readdir('./_astro');\n    const counterMap = dir.find(file => file.match(/^Counter\\.\\w+\\.js\\.map$/));\n    expect(counterMap).to.be.ok;\n  });","file":"sourcemap.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds non-empty sourcemap","suites":["Sourcemap"],"updatePoint":{"line":16,"column":32,"index":505},"line":16,"code":"  it('Builds non-empty sourcemap', async () => {\n    const map = await fixture.readFile('entry.mjs.map');\n    expect(map).to.not.include('\"sources\":[]');\n  });","file":"sourcemap.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Work with hoisted scripts","suites":["Projects with a space in the folder name","dev"],"updatePoint":{"line":20,"column":33,"index":586},"line":20,"code":"    it('Work with hoisted scripts', async () => {\n      const html = await fixture.fetch('/').then(r => r.text());\n      const $ = cheerio.load(html);\n      expect($('script[src*=\"space in folder name\"]')).to.have.a.lengthOf(1);\n    });","file":"space-in-folder-name.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Build succeeds","suites":["Special chars in component import paths","build"],"updatePoint":{"line":20,"column":22,"index":658},"line":20,"code":"    it('Build succeeds', async () => {\n      const html = await fixture.readFile('/index.html');\n      expect(html).to.contain('<html>');\n    });","file":"special-chars-in-component-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Special chars in imports work from .astro files","suites":["Special chars in component import paths","build"],"updatePoint":{"line":24,"column":55,"index":837},"line":24,"code":"    it('Special chars in imports work from .astro files', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerioLoad(html);\n\n      // Test 1: Correct page\n      expect($('h1').text()).to.contain('.astro');\n\n      // Test 2: All components exist\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId}`), `Component #${componentId} does not exist`).to.have.lengthOf(1);\n      });\n\n      // Test 3: Component contents were rendered properly\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId} > div`).text()).to.equal(`${componentId}: 0`);\n      });\n\n      // Test 4: There is an island for each component\n      expect($('astro-island[uid]')).to.have.lengthOf(componentIds.length);\n    });","file":"special-chars-in-component-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Special chars in imports work from .mdx files","suites":["Special chars in component import paths","build"],"updatePoint":{"line":44,"column":53,"index":1612},"line":44,"code":"    it('Special chars in imports work from .mdx files', async () => {\n      const html = await fixture.readFile('/mdx/index.html');\n      const $ = cheerioLoad(html);\n\n      // Test 1: Correct page\n      expect($('h1').text()).to.contain('.mdx');\n\n      // Test 2: All components exist\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId}`), `Component #${componentId} does not exist`).to.have.lengthOf(1);\n      });\n\n      // Test 3: Component contents were rendered properly\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId} > div`).text()).to.equal(`${componentId}: 0`);\n      });\n\n      // Test 4: There is an island for each component\n      expect($('astro-island[uid]')).to.have.lengthOf(componentIds.length);\n    });","file":"special-chars-in-component-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Special chars in imports work from .astro files","suites":["Special chars in component import paths","dev"],"updatePoint":{"line":74,"column":55,"index":2612},"line":74,"code":"    it('Special chars in imports work from .astro files', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerioLoad(html);\n\n      // Test 1: Correct page\n      expect($('h1').text()).to.contain('.astro');\n\n      // Test 2: All components exist\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId}`), `Component #${componentId} does not exist`).to.have.lengthOf(1);\n      });\n\n      // Test 3: Component contents were rendered properly\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId} > div`).text()).to.equal(`${componentId}: 0`);\n      });\n\n      // Test 4: There is an island for each component\n      expect($('astro-island[uid]')).to.have.lengthOf(componentIds.length);\n    });","file":"special-chars-in-component-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Special chars in imports work from .mdx files","suites":["Special chars in component import paths","dev"],"updatePoint":{"line":94,"column":53,"index":3398},"line":94,"code":"    it('Special chars in imports work from .mdx files', async () => {\n      const html = await fixture.fetch('/mdx').then(res => res.text());\n      const $ = cheerioLoad(html);\n\n      // Test 1: Correct page\n      expect($('h1').text()).to.contain('.mdx');\n\n      // Test 2: All components exist\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId}`), `Component #${componentId} does not exist`).to.have.lengthOf(1);\n      });\n\n      // Test 3: Component contents were rendered properly\n      componentIds.forEach(componentId => {\n        expect($(`#${componentId} > div`).text()).to.equal(`${componentId}: 0`);\n      });\n\n      // Test 4: There is an island for each component\n      expect($('astro-island[uid]')).to.have.lengthOf(componentIds.length);\n    });","file":"special-chars-in-component-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns 404 when hitting an API route with the wrong method","suites":["404 and 500 pages","Development"],"updatePoint":{"line":24,"column":67,"index":754},"line":24,"code":"    it('Returns 404 when hitting an API route with the wrong method', async () => {\n      let res = await fixture.fetch('/api/route', {\n        method: 'PUT'\n      });\n      let html = await res.text();\n      let $ = cheerio.load(html);\n      expect($('h1').text()).to.equal(`Something went horribly wrong!`);\n    });","file":"ssr-404-500-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 page returned when a route does not match","suites":["404 and 500 pages","Production"],"updatePoint":{"line":37,"column":53,"index":1161},"line":37,"code":"    it('404 page returned when a route does not match', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/some/fake/route');\n      const response = await app.render(request);\n      expect(response.status).to.equal(404);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Something went horribly wrong!');\n    });","file":"ssr-404-500-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"404 page returned when a route does not match and passing routeData","suites":["404 and 500 pages","Production"],"updatePoint":{"line":46,"column":75,"index":1634},"line":46,"code":"    it('404 page returned when a route does not match and passing routeData', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/some/fake/route');\n      const routeData = app.match(request, {\n        matchNotFound: true\n      });\n      const response = await app.render(request, routeData);\n      expect(response.status).to.equal(404);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Something went horribly wrong!');\n    });","file":"ssr-404-500-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"500 page returned when there is an error","suites":["404 and 500 pages","Production"],"updatePoint":{"line":58,"column":48,"index":2174},"line":58,"code":"    it('500 page returned when there is an error', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/causes-error');\n      const response = await app.render(request);\n      expect(response.status).to.equal(500);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('This is an error page');\n    });","file":"ssr-404-500-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns 404 when hitting an API route with the wrong method","suites":["404 and 500 pages","Production"],"updatePoint":{"line":67,"column":67,"index":2627},"line":67,"code":"    it('Returns 404 when hitting an API route with the wrong method', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/api/route', {\n        method: 'PUT'\n      });\n      const response = await app.render(request);\n      expect(response.status).to.equal(404);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal(`Something went horribly wrong!`);\n    });","file":"ssr-404-500-pages.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Puts client files in the client folder","suites":["Integration buildConfig hook"],"updatePoint":{"line":56,"column":44,"index":1827},"line":56,"code":"  it('Puts client files in the client folder', async () => {\n    let data = await fixture.readFile('/.root/client/cars.json');\n    expect(data).to.not.be.undefined;\n  });","file":"ssr-adapter-build-config.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Puts the server entry into the server folder","suites":["Integration buildConfig hook"],"updatePoint":{"line":60,"column":50,"index":2004},"line":60,"code":"  it('Puts the server entry into the server folder', async () => {\n    let data = await fixture.readFile('/.root/server/entry.mjs');\n    expect(data).to.not.be.undefined;\n  });","file":"ssr-adapter-build-config.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Basic pages work","suites":["API routes in SSR"],"updatePoint":{"line":16,"column":22,"index":480},"line":16,"code":"  it('Basic pages work', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/');\n    const response = await app.render(request);\n    const html = await response.text();\n    expect(html).to.not.be.empty;\n  });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load the API route too","suites":["API routes in SSR"],"updatePoint":{"line":23,"column":32,"index":765},"line":23,"code":"  it('Can load the API route too', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/food.json');\n    const response = await app.render(request);\n    expect(response.status).to.equal(200);\n    expect(response.headers.get('Content-Type')).to.equal('application/json;charset=utf-8');\n    expect(response.headers.get('Content-Length')).to.not.be.empty;\n    const body = await response.json();\n    expect(body.length).to.equal(3);\n  });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Has valid api context","suites":["API routes in SSR"],"updatePoint":{"line":33,"column":27,"index":1261},"line":33,"code":"  it('Has valid api context', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/context/any');\n    const response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const data = await response.json();\n    expect(data.cookiesExist).to.equal(true);\n    expect(data.requestExist).to.equal(true);\n    expect(data.redirectExist).to.equal(true);\n    expect(data.propsExist).to.equal(true);\n    expect(data.params).to.deep.equal({\n      param: 'any'\n    });\n    expect(data.generator).to.match(/^Astro v/);\n    expect(data.url).to.equal('http://example.com/context/any');\n    expect(data.clientAddress).to.equal('0.0.0.0');\n  });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can POST to API routes","suites":["API routes in SSR","API Routes - Dev"],"updatePoint":{"line":58,"column":30,"index":2183},"line":58,"code":"    it('Can POST to API routes', async () => {\n      const response = await fixture.fetch('/food.json', {\n        method: 'POST',\n        body: `some data`\n      });\n      expect(response.status).to.equal(200);\n      const text = await response.text();\n      expect(text).to.equal(`ok`);\n    });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can be passed binary data from multipart formdata","suites":["API routes in SSR","API Routes - Dev"],"updatePoint":{"line":67,"column":57,"index":2506},"line":67,"code":"    it('Can be passed binary data from multipart formdata', async () => {\n      const formData = new FormData();\n      const raw = await fs.promises.readFile(new URL('./fixtures/ssr-api-route/src/images/penguin.jpg', import.meta.url));\n      const file = new File([raw], 'penguin.jpg', {\n        type: 'text/jpg'\n      });\n      formData.set('file', file, 'penguin.jpg');\n      const res = await fixture.fetch('/binary', {\n        method: 'POST',\n        body: formData\n      });\n      expect(res.status).to.equal(200);\n    });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Infer content type with charset for { body } shorthand","suites":["API routes in SSR","API Routes - Dev"],"updatePoint":{"line":80,"column":62,"index":3039},"line":80,"code":"    it('Infer content type with charset for { body } shorthand', async () => {\n      const response = await fixture.fetch('/food.json', {\n        method: 'GET'\n      });\n      expect(response.headers.get('Content-Type')).to.equal('application/json;charset=utf-8');\n    });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can set multiple headers of the same type","suites":["API routes in SSR","API Routes - Dev"],"updatePoint":{"line":86,"column":49,"index":3299},"line":86,"code":"    it('Can set multiple headers of the same type', async () => {\n      const response = await fixture.fetch('/login', {\n        method: 'POST'\n      });\n      const setCookie = response.headers.get('set-cookie');\n      expect(setCookie).to.equal('foo=foo; HttpOnly, bar=bar; HttpOnly');\n    });","file":"ssr-api-route.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Do not have to implement getStaticPaths","suites":["SSR Assets"],"updatePoint":{"line":15,"column":45,"index":452},"line":15,"code":"  it('Do not have to implement getStaticPaths', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    /** @type {Set<string>} */\n    const assets = app.manifest.assets;\n    expect(assets.size).to.equal(1);\n    expect(Array.from(assets)[0].endsWith('.css')).to.be.true;\n  });","file":"ssr-assets.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Do not have to implement getStaticPaths","suites":["Dynamic pages in SSR"],"updatePoint":{"line":35,"column":45,"index":1212},"line":35,"code":"  it('Do not have to implement getStaticPaths', async () => {\n    const html = await fetchHTML('/123');\n    const $ = cheerioLoad(html);\n    expect($('h1').text()).to.equal('Item 123');\n  });","file":"ssr-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Includes page styles","suites":["Dynamic pages in SSR"],"updatePoint":{"line":40,"column":26,"index":1385},"line":40,"code":"  it('Includes page styles', async () => {\n    const html = await fetchHTML('/123');\n    const $ = cheerioLoad(html);\n    expect($('link').length).to.equal(1);\n  });","file":"ssr-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Dynamic API routes work","suites":["Dynamic pages in SSR"],"updatePoint":{"line":45,"column":29,"index":1554},"line":45,"code":"  it('Dynamic API routes work', async () => {\n    const json = await fetchJSON('/api/products/33');\n    expect(json.id).to.equal('33');\n  });","file":"ssr-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Public assets take priority","suites":["Dynamic pages in SSR"],"updatePoint":{"line":49,"column":33,"index":1700},"line":49,"code":"  it('Public assets take priority', async () => {\n    const favicon = await matchRoute('/favicon.ico');\n    expect(favicon).to.equal(undefined);\n  });","file":"ssr-dynamic.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"import.meta.env.SSR is true","suites":["SSR Environment Variables"],"updatePoint":{"line":16,"column":33,"index":488},"line":16,"code":"  it('import.meta.env.SSR is true', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/ssr');\n    const response = await app.render(request);\n    const html = await response.text();\n    const $ = cheerio.load(html);\n    expect($('#ssr').text()).to.equal('true');\n  });","file":"ssr-env.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Inlined scripts get included","suites":["Hoisted scripts in SSR"],"updatePoint":{"line":23,"column":34,"index":766},"line":23,"code":"  it('Inlined scripts get included', async () => {\n    const html = await fetchHTML('/');\n    const $ = cheerioLoad(html);\n    expect($('script').length).to.equal(1);\n  });","file":"ssr-hoisted-script.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Inlined scripts get included without base path in the script","suites":["Hoisted scripts in SSR","base path"],"updatePoint":{"line":39,"column":68,"index":1259},"line":39,"code":"    it('Inlined scripts get included without base path in the script', async () => {\n      const html = await fetchHTML('/hello/');\n      const $ = cheerioLoad(html);\n      expect($('script').html()).to.equal('console.log(\"hello world\");\\n');\n    });","file":"ssr-hoisted-script.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Using response.arrayBuffer() gets the right HTML","suites":["SSR with Large Array and client rendering"],"updatePoint":{"line":16,"column":54,"index":529},"line":16,"code":"  it('Using response.arrayBuffer() gets the right HTML', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/');\n    const response = await app.render(request);\n    const data = await response.arrayBuffer();\n    const html = new TextDecoder().decode(data);\n    const $ = cheerio.load(html);\n    expect($('head meta[name=\"viewport\"]')).to.have.a.lengthOf(1);\n    expect($('head link[rel=\"icon\"]')).to.have.a.lengthOf(1);\n    expect($('main')).to.have.a.lengthOf(1);\n    expect($('astro-island')).to.have.a.lengthOf(1);\n    expect($('h1').text()).to.equal('Hello, Solid!');\n  });","file":"ssr-large-array.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to load","suites":["Lit integration in SSR"],"updatePoint":{"line":23,"column":21,"index":746},"line":23,"code":"  it('Is able to load', async () => {\n    const html = await fetchHTML('/');\n    const $ = cheerioLoad(html);\n    expect($('#str').text()).to.equal('initialized');\n  });","file":"ssr-lit.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"works","suites":["astro:ssr-manifest"],"updatePoint":{"line":16,"column":11,"index":464},"line":16,"code":"  it('works', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/');\n    const response = await app.render(request);\n    const html = await response.text();\n    const $ = cheerio.load(html);\n    expect($('#assets').text()).to.equal('[\"/_astro/index.1bad7273.css\"]');\n  });","file":"ssr-manifest.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Renders markdown pages correctly","suites":["Markdown pages in SSR"],"updatePoint":{"line":23,"column":38,"index":763},"line":23,"code":"  it('Renders markdown pages correctly', async () => {\n    const html = await fetchHTML('/post');\n    const $ = cheerioLoad(html);\n    expect($('#subheading').text()).to.equal('Subheading');\n  });","file":"ssr-markdown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Params are passed to component","suites":["Astro.params in SSR"],"updatePoint":{"line":17,"column":36,"index":519},"line":17,"code":"  it('Params are passed to component', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/users/houston/food');\n    const response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const html = await response.text();\n    const $ = cheerio.load(html);\n    expect($('.category').text()).to.equal('food');\n  });","file":"ssr-params.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Has the scripts in the page","suites":["Using the Partytown integration in SSR"],"updatePoint":{"line":16,"column":33,"index":518},"line":16,"code":"  it('Has the scripts in the page', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/');\n    const response = await app.render(request);\n    const html = await response.text();\n    const $ = cheerioLoad(html);\n    expect($('script')).to.have.a.lengthOf(1);\n  });","file":"ssr-partytown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"The partytown scripts are in the manifest","suites":["Using the Partytown integration in SSR"],"updatePoint":{"line":24,"column":47,"index":864},"line":24,"code":"  it('The partytown scripts are in the manifest', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    expect(app.manifest.assets).to.contain('/~partytown/partytown-sw.js');\n  });","file":"ssr-partytown.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Prerendered 404.astro page is not rendered","suites":["SSR: prerender 404","Prerendering"],"updatePoint":{"line":19,"column":50,"index":562},"line":19,"code":"    it('Prerendered 404.astro page is not rendered', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/non-existent-page');\n      const response = await app.render(request);\n      expect(response.status).to.equal(404);\n      expect(response.statusText).to.equal('Not found', 'should be actual 404 response, not 404 page');\n    });","file":"ssr-prerender-404.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is only called once during build","suites":["prerender getStaticPaths - build calls"],"updatePoint":{"line":15,"column":38,"index":541},"line":15,"code":"  it('is only called once during build', () => {\n    // useless expect; if build() throws in setup then this test fails\n    expect(true).to.equal(true);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"only calls prerender getStaticPaths once","suites":["prerender getStaticPaths - dev calls"],"updatePoint":{"line":34,"column":46,"index":1139},"line":34,"code":"  it('only calls prerender getStaticPaths once', async () => {\n    let res = await fixture.fetch('/a');\n    expect(res.status).to.equal(200);\n    res = await fixture.fetch('/b');\n    expect(res.status).to.equal(200);\n    res = await fixture.fetch('/c');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - named params","suites":["prerender getStaticPaths - 404 behavior"],"updatePoint":{"line":57,"column":57,"index":1882},"line":57,"code":"  it('resolves 200 on matching static path - named params', async () => {\n    const res = await fixture.fetch('/pizza/provolone-sausage');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 404 on pattern match without static path - named params","suites":["prerender getStaticPaths - 404 behavior"],"updatePoint":{"line":61,"column":70,"index":2078},"line":61,"code":"  it('resolves 404 on pattern match without static path - named params', async () => {\n    const res = await fixture.fetch('/pizza/provolone-pineapple');\n    const html = await res.text();\n    expect(res.status).to.equal(404);\n    expect(html).to.match(/404/);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - rest params","suites":["prerender getStaticPaths - 404 behavior"],"updatePoint":{"line":67,"column":56,"index":2331},"line":67,"code":"  it('resolves 200 on matching static path - rest params', async () => {\n    const res = await fixture.fetch('/pizza/grimaldis/new-york');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 404 on pattern match without static path - rest params","suites":["prerender getStaticPaths - 404 behavior"],"updatePoint":{"line":71,"column":69,"index":2527},"line":71,"code":"  it('resolves 404 on pattern match without static path - rest params', async () => {\n    const res = await fixture.fetch('/pizza/pizza-hut');\n    const html = await res.text();\n    expect(res.status).to.equal(404);\n    expect(html).to.match(/404/);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on nested array parameters","suites":["prerender getStaticPaths - route params type validation"],"updatePoint":{"line":91,"column":45,"index":3209},"line":91,"code":"  it('resolves 200 on nested array parameters', async () => {\n    const res = await fixture.fetch('/nested-arrays/slug1');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - string params","suites":["prerender getStaticPaths - route params type validation"],"updatePoint":{"line":95,"column":58,"index":3389},"line":95,"code":"  it('resolves 200 on matching static path - string params', async () => {\n    // route provided with { params: { year: \"2022\", slug: \"post-2\" }}\n    const res = await fixture.fetch('/blog/2022/post-1');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static path - numeric params","suites":["prerender getStaticPaths - route params type validation"],"updatePoint":{"line":100,"column":59,"index":3638},"line":100,"code":"  it('resolves 200 on matching static path - numeric params', async () => {\n    // route provided with { params: { year: 2022, slug: \"post-2\" }}\n    const res = await fixture.fetch('/blog/2022/post-2');\n    expect(res.status).to.equal(200);\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves 200 on matching static paths","suites":["prerender getStaticPaths - numeric route params"],"updatePoint":{"line":121,"column":43,"index":4352},"line":121,"code":"  it('resolves 200 on matching static paths', async () => {\n    // routes params provided for pages /posts/1, /posts/2, and /posts/3\n    for (const page of [1, 2, 3]) {\n      let res = await fixture.fetch(`/posts/${page}`);\n      expect(res.status).to.equal(200);\n      const html = await res.text();\n      const $ = cheerio.load(html);\n      const canonical = $('link[rel=canonical]');\n      expect(canonical.attr('href')).to.equal(`https://mysite.dev/posts/${page}`, `doesn't trim the /${page} route param`);\n    }\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Sets the current pathname","suites":["prerender getStaticPaths - Astro.url"],"updatePoint":{"line":145,"column":31,"index":5289},"line":145,"code":"  it('Sets the current pathname', async () => {\n    const html = await fixture.readFile('/food/tacos/index.html');\n    const $ = cheerio.load(html);\n    expect($('#url').text()).to.equal('/food/tacos/');\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Sets the current pathname","suites":["prerender getStaticPaths - props"],"updatePoint":{"line":163,"column":31,"index":5921},"line":163,"code":"  it('Sets the current pathname', async () => {\n    const html = await fixture.readFile('/food/tacos/index.html');\n    const $ = cheerio.load(html);\n    expect($('#props').text()).to.equal('10');\n  });","file":"ssr-prerender-get-static-paths.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Does not render static page","suites":["SSR: prerender","Prerendering"],"updatePoint":{"line":22,"column":35,"index":697},"line":22,"code":"    it('Does not render static page', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/static');\n      const response = await app.render(request);\n      expect(response.status).to.equal(404);\n    });","file":"ssr-prerender.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"includes prerendered pages in the asset manifest","suites":["SSR: prerender","Prerendering"],"updatePoint":{"line":28,"column":56,"index":991},"line":28,"code":"    it('includes prerendered pages in the asset manifest', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      /** @type {Set<string>} */\n      const assets = app.manifest.assets;\n      expect(assets.size).to.equal(1);\n      expect(Array.from(assets)[0].endsWith('static/index.html')).to.be.true;\n    });","file":"ssr-prerender.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Params are passed to component","suites":["SSR: prerender","Astro.params in SSR"],"updatePoint":{"line":37,"column":38,"index":1348},"line":37,"code":"    it('Params are passed to component', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/users/houston');\n      const response = await app.render(request);\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('.user').text()).to.equal('houston');\n    });","file":"ssr-prerender.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"fix bug id #6020","suites":["SSR: prerender","New prerender option breaks catch-all route on root when using preview"],"updatePoint":{"line":49,"column":24,"index":1867},"line":49,"code":"    it('fix bug id #6020', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/some');\n      const response = await app.render(request);\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('p').text()).to.include('not give 404');\n    });","file":"ssr-prerender.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"preview server works","suites":["SSR Preview"],"updatePoint":{"line":18,"column":26,"index":493},"line":18,"code":"  it('preview server works', async () => {\n    /** @type {import('./test-utils').PreviewServer} */\n    const previewServer = await fixture.preview();\n    await previewServer.stop();\n  });","file":"ssr-preview.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns a 302 status","suites":["Astro.redirect"],"updatePoint":{"line":15,"column":26,"index":439},"line":15,"code":"  it('Returns a 302 status', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/secret');\n    const response = await app.render(request);\n    expect(response.status).to.equal(302);\n    expect(response.headers.get('location')).to.equal('/login');\n  });","file":"ssr-redirect.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Warns when used inside a component","suites":["Astro.redirect"],"updatePoint":{"line":22,"column":40,"index":772},"line":22,"code":"  it('Warns when used inside a component', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/late');\n    const response = await app.render(request);\n    try {\n      const text = await response.text();\n      expect(false).to.equal(true);\n    } catch (e) {\n      expect(e.message).to.equal('The response has already been sent to the browser and cannot be altered.');\n    }\n  });","file":"ssr-redirect.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Gets the request passed in","suites":["Using Astro.request in SSR"],"updatePoint":{"line":32,"column":32,"index":862},"line":32,"code":"  it('Gets the request passed in', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/subpath/request');\n    const response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const html = await response.text();\n    const $ = cheerioLoad(html);\n    expect($('#origin').text()).to.equal('http://example.com');\n  });","file":"ssr-request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"public file is copied over","suites":["Using Astro.request in SSR"],"updatePoint":{"line":41,"column":32,"index":1268},"line":41,"code":"  it('public file is copied over', async () => {\n    const json = await fixture.readFile('/client/cars.json');\n    expect(json).to.not.be.undefined;\n  });","file":"ssr-request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"CSS assets have their base prefix","suites":["Using Astro.request in SSR"],"updatePoint":{"line":45,"column":39,"index":1430},"line":45,"code":"  it('CSS assets have their base prefix', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    let request = new Request('http://example.com/subpath/request');\n    let response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const html = await response.text();\n    const $ = cheerioLoad(html);\n    const linkHref = $('link').attr('href');\n    expect(linkHref.startsWith('/subpath/')).to.equal(true);\n    request = new Request('http://example.com' + linkHref);\n    response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const css = await response.text();\n    expect(css).to.not.be.an('undefined');\n  });","file":"ssr-request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"script assets have their base prefix","suites":["Using Astro.request in SSR"],"updatePoint":{"line":60,"column":42,"index":2111},"line":60,"code":"  it('script assets have their base prefix', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    let request = new Request('http://example.com/subpath/request');\n    let response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const html = await response.text();\n    const $ = cheerioLoad(html);\n    for (const el of $('script')) {\n      const scriptSrc = $(el).attr('src');\n      expect(scriptSrc.startsWith('/subpath/')).to.equal(true);\n      request = new Request('http://example.com' + scriptSrc);\n      response = await app.render(request);\n      expect(response.status).to.equal(200);\n      const js = await response.text();\n      expect(js).to.not.be.an('undefined');\n    }\n  });","file":"ssr-request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"assets can be fetched","suites":["Using Astro.request in SSR"],"updatePoint":{"line":77,"column":27,"index":2829},"line":77,"code":"  it('assets can be fetched', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/subpath/cars.json');\n    const response = await app.render(request);\n    expect(response.status).to.equal(200);\n    const data = await response.json();\n    expect(data).to.be.an('array');\n  });","file":"ssr-request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can set the status","suites":["Using Astro.response in SSR"],"updatePoint":{"line":15,"column":24,"index":450},"line":15,"code":"  it('Can set the status', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/status-code');\n    const response = await app.render(request);\n    expect(response.status).to.equal(404);\n  });","file":"ssr-response.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can set the statusText","suites":["Using Astro.response in SSR"],"updatePoint":{"line":21,"column":28,"index":711},"line":21,"code":"  it('Can set the statusText', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/status-code');\n    const response = await app.render(request);\n    expect(response.statusText).to.equal('Oops');\n  });","file":"ssr-response.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can add headers","suites":["Using Astro.response in SSR"],"updatePoint":{"line":27,"column":21,"index":972},"line":27,"code":"  it('Can add headers', async () => {\n    const app = await fixture.loadTestAdapterApp();\n    const request = new Request('http://example.com/some-header');\n    const response = await app.render(request);\n    const headers = response.headers;\n    expect(headers.get('one-two')).to.equal('three');\n    expect(headers.get('four-five')).to.equal('six');\n    expect(headers.get('Cache-Control')).to.equal(`max-age=0, s-maxage=86400`);\n  });","file":"ssr-response.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Are included in the manifest.assets so that an adapter can know to serve static","suites":["SSR Hydrated component scripts"],"updatePoint":{"line":15,"column":85,"index":513},"line":15,"code":"  it('Are included in the manifest.assets so that an adapter can know to serve static', async () => {\n    const app = await fixture.loadTestAdapterApp();\n\n    /** @type {Set<string>} */\n    const assets = app.manifest.assets;\n    expect(assets.size).to.be.greaterThan(0);\n  });","file":"ssr-scripts.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to build successfully","suites":["Code component inside static build"],"updatePoint":{"line":12,"column":35,"index":372},"line":12,"code":"  it('Is able to build successfully', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerio.load(html);\n    expect($('pre').length, 1, 'pre tag loaded');\n  });","file":"static-build-code-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"dir takes the URL path to the output directory","suites":["Static build: dir takes the URL path to the output directory"],"updatePoint":{"line":29,"column":52,"index":761},"line":29,"code":"  it('dir takes the URL path to the output directory', async () => {\n    const removeTrailingSlash = str => str.replace(/\\/$/, '');\n    expect(removeTrailingSlash(checkDir.toString())).to.be.equal(removeTrailingSlash(new URL('./fixtures/static-build-dir/dist', import.meta.url).toString()));\n    expect(checkDir.toString()).to.be.equal(checkGeneratedDir.toString());\n  });","file":"static-build-dir.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can build preact","suites":["Static build - frameworks"],"updatePoint":{"line":15,"column":22,"index":392},"line":15,"code":"  it('can build preact', async () => {\n    const html = await fixture.readFile('/preact/index.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build-frameworks.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can build react","suites":["Static build - frameworks"],"updatePoint":{"line":19,"column":21,"index":535},"line":19,"code":"  it('can build react', async () => {\n    const html = await fixture.readFile('/react/index.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build-frameworks.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can build lit","suites":["Static build - frameworks"],"line":26,"code":"  it.skip('can build lit', async () => {","file":"static-build-frameworks.test.js","skipped":true,"dir":"packages/astro/test"},{"name":"can build nested framework usage","suites":["Static build - frameworks"],"updatePoint":{"line":30,"column":38,"index":1002},"line":30,"code":"  it('can build nested framework usage', async () => {\n    const html = await fixture.readFile('/nested/index.html');\n    const $ = cheerio.load(html);\n    const counter = $('.nested-counter .counter');\n    expect(counter.length).to.equal(1, 'Found the counter');\n  });","file":"static-build-frameworks.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Pages routes have distURL","suites":["Static build: pages routes have distURL"],"updatePoint":{"line":23,"column":31,"index":651},"line":23,"code":"  it('Pages routes have distURL', async () => {\n    expect(checkRoutes).to.have.lengthOf.above(0, 'Pages not found: build end hook not being called');\n    checkRoutes.forEach(p => expect(p).to.have.property('distURL').that.is.a('URL', `${p.pathname} doesn't include distURL`));\n  });","file":"static-build-page-dist-url.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds pages in root","suites":["Static build - format: 'file'"],"updatePoint":{"line":15,"column":26,"index":445},"line":15,"code":"  it('Builds pages in root', async () => {\n    const html = await fixture.readFile('/one.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build-page-url-format.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds pages in subfolders","suites":["Static build - format: 'file'"],"updatePoint":{"line":19,"column":32,"index":590},"line":19,"code":"  it('Builds pages in subfolders', async () => {\n    const html = await fixture.readFile('/sub/page.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build-page-url-format.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Vite Plugins are included/excluded properly","suites":["Static build: vite plugins included when required"],"updatePoint":{"line":67,"column":49,"index":2651},"line":67,"code":"  it('Vite Plugins are included/excluded properly', async () => {\n    expect(pluginsCalled.size).to.equal(expectedPluginResult.size, 'Not all plugins were initialized');\n    Array.from(expectedPluginResult.entries()).forEach(([plugin, called]) => expect(pluginsCalled.get(plugin)).to.equal(called, `${plugin} was ${called ? 'not' : ''} called`));\n  });","file":"static-build-vite-plugins.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds out .astro pages","suites":["Static build"],"updatePoint":{"line":38,"column":29,"index":954},"line":38,"code":"  it('Builds out .astro pages', async () => {\n    const html = await fixture.readFile('/index.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can build pages using Astro.glob()","suites":["Static build"],"updatePoint":{"line":42,"column":40,"index":1109},"line":42,"code":"  it('can build pages using Astro.glob()', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n    const link = $('.posts a');\n    const href = link.attr('href');\n    expect(href).to.be.equal('/subpath/posts/thoughts');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds out .md pages","suites":["Static build"],"updatePoint":{"line":49,"column":26,"index":1372},"line":49,"code":"  it('Builds out .md pages', async () => {\n    const html = await fixture.readFile('/posts/thoughts/index.html');\n    expect(html).to.be.a('string');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds out .json files","suites":["Static build"],"updatePoint":{"line":53,"column":28,"index":1530},"line":53,"code":"  it('Builds out .json files', async () => {\n    const content = await fixture.readFile('/company.json').then(text => JSON.parse(text));\n    expect(content.name).to.equal('Astro Technology Company');\n    expect(content.url).to.equal('https://astro.build/');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds out async .json files","suites":["Static build"],"updatePoint":{"line":58,"column":34,"index":1800},"line":58,"code":"  it('Builds out async .json files', async () => {\n    const content = await fixture.readFile('/posts.json').then(text => JSON.parse(text));\n    expect(Array.isArray(content)).to.equal(true);\n    expect(content).deep.equal([{\n      filename: './posts/nested/more.md',\n      title: 'More post'\n    }, {\n      filename: './posts/thoughts.md',\n      title: 'Thoughts post'\n    }]);\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Builds out dynamic .json files","suites":["Static build"],"updatePoint":{"line":69,"column":36,"index":2187},"line":69,"code":"  it('Builds out dynamic .json files', async () => {\n    const slugs = ['thing1', 'thing2'];\n    for (const slug of slugs) {\n      const content = await fixture.readFile(`/data/${slug}.json`).then(text => JSON.parse(text));\n      expect(content.name).to.equal('Astro Technology Company');\n      expect(content.url).to.equal('https://astro.build/');\n      expect(content.slug).to.equal(slug);\n    }\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Page level CSS is added","suites":["Static build","Page CSS"],"updatePoint":{"line":106,"column":31,"index":3621},"line":106,"code":"    it('Page level CSS is added', async () => {\n      const found = await findEvidence('/index.html');\n      expect(found).to.equal(true, 'Did not find page-level CSS on this page');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Included on the index page","suites":["Static build","Shared CSS"],"updatePoint":{"line":113,"column":34,"index":3913},"line":113,"code":"    it('Included on the index page', async () => {\n      const found = await findEvidence('/index.html');\n      expect(found).to.equal(true, 'Did not find shared CSS on this page');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Included on a md page","suites":["Static build","Shared CSS"],"updatePoint":{"line":117,"column":29,"index":4098},"line":117,"code":"    it('Included on a md page', async () => {\n      const found = await findEvidence('/posts/thoughts/index.html');\n      expect(found).to.equal(true, 'Did not find shared CSS on this page');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is included in the index CSS","suites":["Static build","CSS modules"],"updatePoint":{"line":124,"column":36,"index":4410},"line":124,"code":"    it('Is included in the index CSS', async () => {\n      const found = await findEvidence('/index.html');\n      expect(found).to.equal(true, 'Did not find shared CSS module code');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Get bundled together on the page","suites":["Static build","Hoisted scripts"],"updatePoint":{"line":130,"column":40,"index":4649},"line":130,"code":"    it('Get bundled together on the page', async () => {\n      const html = await fixture.readFile('/hoisted/index.html');\n      const $ = cheerioLoad(html);\n      expect($('script[type=\"module\"]').length).to.equal(1, 'hoisted script added');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Do not get added to the wrong page","suites":["Static build","Hoisted scripts"],"updatePoint":{"line":135,"column":42,"index":4902},"line":135,"code":"    it('Do not get added to the wrong page', async () => {\n      const hoistedHTML = await fixture.readFile('/hoisted/index.html');\n      const $ = cheerioLoad(hoistedHTML);\n      const href = $('script[type=\"module\"]').attr('src');\n      const indexHTML = await fixture.readFile('/index.html');\n      const $$ = cheerioLoad(indexHTML);\n      expect($$(`script[src=\"${href}\"]`).length).to.equal(0, 'no script added to different page');\n    });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"honors ssr config","suites":["Static build","Hoisted scripts"],"updatePoint":{"line":144,"column":23,"index":5333},"line":144,"code":"  it('honors ssr config', async () => {\n    const html = await fixture.readFile('/index.html');\n    const $ = cheerioLoad(html);\n    expect($('#ssr-config').text()).to.equal('testing');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"warns when accessing headers","suites":["Static build","Hoisted scripts"],"updatePoint":{"line":149,"column":34,"index":5536},"line":149,"code":"  it('warns when accessing headers', async () => {\n    let found = false;\n    for (const log of logs) {\n      if (log.type === 'ssg' && /[hH]eaders are not exposed in static \\(SSG\\) output mode/.test(log.message)) {\n        found = true;\n      }\n    }\n    expect(found).to.equal(true, 'Found the log message');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Copies public files","suites":["Static build SSR"],"updatePoint":{"line":160,"column":25,"index":5885},"line":160,"code":"  it('Copies public files', async () => {\n    const fixture = await loadFixture({\n      root: './fixtures/static-build-ssr/'\n    });\n    await fixture.build();\n    await fixture.readFile('/client/nested/asset2.txt');\n    await fixture.readFile('/client/.well-known/apple-app-site-association');\n  });","file":"static-build.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"builds to 404.html","suites":["Status Code Pages"],"updatePoint":{"line":13,"column":24,"index":311},"line":13,"code":"  it('builds to 404.html', async () => {\n    const html = await fixture.readFile('/404.html');\n    expect(html).to.be.ok;\n  });","file":"status-page.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Body is chunked","suites":["Streaming","Development"],"updatePoint":{"line":26,"column":23,"index":745},"line":26,"code":"    it('Body is chunked', async () => {\n      let res = await fixture.fetch('/');\n      let chunks = [];\n      for await (const bytes of streamAsyncIterator(res.body)) {\n        let chunk = bytes.toString('utf-8');\n        chunks.push(chunk);\n      }\n      expect(chunks.length).to.be.greaterThan(1);\n    });","file":"streaming.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can get the full html body","suites":["Streaming","Production"],"updatePoint":{"line":40,"column":34,"index":1166},"line":40,"code":"    it('Can get the full html body', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/');\n      const response = await app.render(request);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('header h1')).to.have.a.lengthOf(1);\n      expect($('ul li')).to.have.a.lengthOf(10);\n    });","file":"streaming.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Body is chunked","suites":["Streaming","Production"],"updatePoint":{"line":49,"column":23,"index":1555},"line":49,"code":"    it('Body is chunked', async () => {\n      const app = await fixture.loadTestAdapterApp();\n      const request = new Request('http://example.com/');\n      const response = await app.render(request);\n      let chunks = [];\n      let decoder = new TextDecoder();\n      for await (const bytes of streamAsyncIterator(response.body)) {\n        let chunk = decoder.decode(bytes);\n        chunks.push(chunk);\n      }\n      expect(chunks.length).to.be.greaterThan(1);\n    });","file":"streaming.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Body is chunked","suites":["Streaming disabled","Development"],"updatePoint":{"line":87,"column":23,"index":2625},"line":87,"code":"    it('Body is chunked', async () => {\n      let res = await fixture.fetch('/');\n      let chunks = [];\n      for await (const bytes of streamAsyncIterator(res.body)) {\n        let chunk = bytes.toString('utf-8');\n        chunks.push(chunk);\n      }\n      expect(chunks.length).to.be.greaterThan(1);\n    });","file":"streaming.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can get the full html body","suites":["Streaming disabled","Production"],"updatePoint":{"line":105,"column":34,"index":3210},"line":105,"code":"    it('Can get the full html body', async () => {\n      const app = await fixture.loadTestAdapterApp(false);\n      const request = new Request('http://example.com/');\n      const response = await app.render(request);\n      expect(response.status).to.equal(200);\n      expect(response.headers.get('content-type')).to.equal('text/html');\n      expect(response.headers.has('content-length')).to.equal(true);\n      expect(parseInt(response.headers.get('content-length'))).to.be.greaterThan(0);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('header h1')).to.have.a.lengthOf(1);\n      expect($('ul li')).to.have.a.lengthOf(10);\n    });","file":"streaming.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with TypeScript","suites":["Svelte component","build"],"updatePoint":{"line":15,"column":29,"index":411},"line":15,"code":"    it('Works with TypeScript', async () => {\n      const html = await fixture.readFile('/typescript/index.html');\n      const $ = cheerio.load(html);\n      expect($('#svelte-ts').text()).to.equal('Hello, TypeScript');\n    });","file":"svelte-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Works with custom Svelte config","suites":["Svelte component","build"],"updatePoint":{"line":20,"column":39,"index":648},"line":20,"code":"    it('Works with custom Svelte config', async () => {\n      const html = await fixture.readFile('/typescript/index.html');\n      const $ = cheerio.load(html);\n      expect($('#svelte-custom-ext').text()).to.equal('Hello, Custom Extensions');\n    });","file":"svelte-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"scripts proxy correctly","suites":["Svelte component","dev"],"updatePoint":{"line":35,"column":31,"index":1113},"line":35,"code":"    it('scripts proxy correctly', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n      for (const script of $('script').toArray()) {\n        const {\n          src\n        } = script.attribs;\n        if (!src) continue;\n        expect((await fixture.fetch(src)).status, `404: ${src}`).to.equal(200);\n      }\n    });","file":"svelte-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"resolves CSS in src/styles","suites":["Tailwind","build"],"updatePoint":{"line":25,"column":34,"index":782},"line":25,"code":"    it('resolves CSS in src/styles', async () => {\n      expect(bundledCSS, 'includes used component classes').to.match(/\\.bg-purple-600{/);\n\n      // tests a random tailwind class that isn't used on the page\n      expect(bundledCSS, 'purges unused classes').not.to.match(/\\.bg-blue-600{/);\n\n      // tailwind escapes colons, `lg:py-3` compiles to `lg\\:py-3`\n      expect(bundledCSS, 'includes responsive classes').to.match(/\\.lg\\\\:py-3{/);\n\n      // tailwind escapes brackets, `font-[900]` compiles to `font-\\[900\\]`\n      expect(bundledCSS, 'supports arbitrary value classes').to.match(/\\.font-\\\\\\[900\\\\\\]{/);\n\n      // custom theme colors were included\n      expect(bundledCSS, 'includes custom theme colors').to.match(/\\.text-midnight{/);\n      expect(bundledCSS, 'includes custom theme colors').to.match(/\\.bg-dawn{/);\n    });","file":"tailwindcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"maintains classes in HTML","suites":["Tailwind","build"],"updatePoint":{"line":41,"column":33,"index":1613},"line":41,"code":"    it('maintains classes in HTML', async () => {\n      const button = $('button');\n      expect(button.hasClass('text-white'), 'basic class').to.be.true;\n      expect(button.hasClass('lg:py-3'), 'responsive class').to.be.true;\n      expect(button.hasClass('font-[900]', 'arbitrary value')).to.be.true;\n    });","file":"tailwindcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"handles complex classes in HTML","suites":["Tailwind","build"],"updatePoint":{"line":47,"column":39,"index":1930},"line":47,"code":"    it('handles complex classes in HTML', async () => {\n      const button = $('#complex');\n      expect(button.hasClass('w-10/12'), 'solidus').to.be.true;\n      expect(button.hasClass('2xl:w-[80%]'), 'complex class').to.be.true;\n    });","file":"tailwindcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"handles Markdown pages","suites":["Tailwind","build"],"updatePoint":{"line":52,"column":30,"index":2159},"line":52,"code":"    it('handles Markdown pages', async () => {\n      const html = await fixture.readFile('/markdown-page/index.html');\n      const $md = cheerio.load(html);\n      const bundledCSSHREF = $md('link[rel=stylesheet][href^=/_astro/]').attr('href');\n      const mdBundledCSS = await fixture.readFile(bundledCSSHREF.replace(/^\\/?/, '/'));\n      expect(mdBundledCSS, 'includes used component classes').to.match(/\\.bg-purple-600{/);\n    });","file":"tailwindcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"handles MDX pages (with integration)","suites":["Tailwind","build"],"updatePoint":{"line":59,"column":44,"index":2605},"line":59,"code":"    it('handles MDX pages (with integration)', async () => {\n      const html = await fixture.readFile('/mdx-page/index.html');\n      const $md = cheerio.load(html);\n      const bundledCSSHREF = $md('link[rel=stylesheet][href^=/_astro/]').attr('href');\n      const mdBundledCSS = await fixture.readFile(bundledCSSHREF.replace(/^\\/?/, '/'));\n      expect(mdBundledCSS, 'includes used component classes').to.match(/\\.bg-purple-600{/);\n    });","file":"tailwindcss.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders a page using a third-party .astro component","suites":["third-party .astro component","build"],"updatePoint":{"line":15,"column":59,"index":443},"line":15,"code":"    it('renders a page using a third-party .astro component', async () => {\n      const html = await fixture.readFile('/astro-embed/index.html');\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Third-Party .astro test');\n    });","file":"third-party-astro.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders a page using a third-party .astro component","suites":["third-party .astro component","dev"],"updatePoint":{"line":29,"column":59,"index":895},"line":29,"code":"    it('renders a page using a third-party .astro component', async () => {\n      const html = await fixture.fetch('/astro-embed/').then(res => res.text());\n      const $ = cheerio.load(html);\n      expect($('h1').text()).to.equal('Third-Party .astro test');\n    });","file":"third-party-astro.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows importing types from \"astro\"","suites":["Type Imports"],"updatePoint":{"line":11,"column":41,"index":310},"line":11,"code":"  it('Allows importing types from \"astro\"', async () => {\n    // if the build passes then the test succeeds\n    expect(true).to.be.true;\n  });","file":"type-imports.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws an aggregate error with the errors","suites":["astro/src/core/compile","Invalid CSS"],"updatePoint":{"line":8,"column":49,"index":375},"line":8,"code":"    it('throws an aggregate error with the errors', async () => {\n      let error;\n      try {\n        let r = await cachedCompilation({\n          astroConfig: {\n            root: pathToFileURL('/')\n          },\n          viteConfig: await resolveConfig({\n            configFile: false\n          }, 'serve'),\n          filename: '/src/pages/index.astro',\n          source: `\n\t---\n\t---\n\t<style lang=\"scss\">\n\t\tarticle:global(:is(h1, h2, h3, h4, h5, h6):hover {\n\t\t\tcolor: purple;\n\t\t}\n\t</style>\n\t<style lang=\"scss\">\n\t\tarticle:is(h1, h2, h3, h4, h5, h6:hover {\n\t\t\tcolor: purple;\n\t\t}\n\t</style>\n\t`\n        });\n      } catch (err) {\n        error = err;\n      }\n      expect(error).to.be.an.instanceOf(AggregateError);\n      expect(error.errors[0].message).to.contain('expected \")\"');\n    });","file":"units/compile/invalid-css.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be specified via --host flag","suites":["config.server","host"],"updatePoint":{"line":16,"column":40,"index":535},"line":16,"code":"    it('can be specified via --host flag', async () => {\n      const projectRootURL = new URL('../../fixtures/astro-basic/', import.meta.url);\n      const {\n        astroConfig\n      } = await openConfigWithFlags({\n        root: fileURLToPath(projectRootURL),\n        host: true\n      });\n      expect(astroConfig.server.host).to.equal(true);\n    });","file":"units/config/config-server.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be passed via relative --config","suites":["config.server","config","relative path"],"updatePoint":{"line":29,"column":45,"index":964},"line":29,"code":"      it('can be passed via relative --config', async () => {\n        const projectRootURL = new URL('../../fixtures/astro-basic/', import.meta.url);\n        const configFileURL = 'my-config.mjs';\n        const {\n          astroConfig\n        } = await openConfigWithFlags({\n          root: fileURLToPath(projectRootURL),\n          config: configFileURL\n        });\n        expect(astroConfig.server.port).to.equal(8080);\n      });","file":"units/config/config-server.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be passed via relative --config","suites":["config.server","config","relative path with leading ./"],"updatePoint":{"line":42,"column":45,"index":1458},"line":42,"code":"      it('can be passed via relative --config', async () => {\n        const projectRootURL = new URL('../../fixtures/astro-basic/', import.meta.url);\n        const configFileURL = './my-config.mjs';\n        const {\n          astroConfig\n        } = await openConfigWithFlags({\n          root: fileURLToPath(projectRootURL),\n          config: configFileURL\n        });\n        expect(astroConfig.server.port).to.equal(8080);\n      });","file":"units/config/config-server.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"fails and exits when config does not exist","suites":["config.server","config","incorrect path"],"updatePoint":{"line":55,"column":52,"index":1946},"line":55,"code":"      it('fails and exits when config does not exist', async () => {\n        const projectRootURL = new URL('../../fixtures/astro-basic/', import.meta.url);\n        const configFileURL = './does-not-exist.mjs';\n        try {\n          await openConfigWithFlags({\n            root: fileURLToPath(projectRootURL),\n            config: configFileURL\n          });\n          expect(false).to.equal(true, 'this should not have resolved');\n        } catch (err) {\n          expect(err.message).to.match(/Unable to resolve/);\n        }\n      });","file":"units/config/config-server.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can load tsconfig.json","suites":["TSConfig handling","tsconfig / jsconfig loading"],"updatePoint":{"line":14,"column":30,"index":722},"line":14,"code":"    it('can load tsconfig.json', () => {\n      const config = loadTSConfig(cwd);\n      expect(config.exists).to.equal(true);\n      expect(config.config.files).to.deep.equal(['im-a-test']);\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can resolve tsconfig.json up directories","suites":["TSConfig handling","tsconfig / jsconfig loading"],"updatePoint":{"line":19,"column":48,"index":937},"line":19,"code":"    it('can resolve tsconfig.json up directories', () => {\n      const config = loadTSConfig(path.join(cwd, 'nested-folder'));\n      expect(config.exists).to.equal(true);\n      expect(config.path).to.equal(path.join(cwd, 'tsconfig.json'));\n      expect(config.config.files).to.deep.equal(['im-a-test']);\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can fallback to jsconfig.json if tsconfig.json does not exists","suites":["TSConfig handling","tsconfig / jsconfig loading"],"updatePoint":{"line":25,"column":70,"index":1271},"line":25,"code":"    it('can fallback to jsconfig.json if tsconfig.json does not exists', () => {\n      const config = loadTSConfig(path.join(cwd, 'jsconfig'), false);\n      expect(config.exists).to.equal(true);\n      expect(config.path).to.equal(path.join(cwd, 'jsconfig', 'jsconfig.json'));\n      expect(config.config.files).to.deep.equal(['im-a-test-js']);\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"properly return errors when not resolving","suites":["TSConfig handling","tsconfig / jsconfig loading"],"updatePoint":{"line":31,"column":49,"index":1601},"line":31,"code":"    it('properly return errors when not resolving', () => {\n      const invalidConfig = loadTSConfig(path.join(cwd, 'invalid'), false);\n      const missingConfig = loadTSConfig(path.join(cwd, 'missing'), false);\n      expect(invalidConfig.exists).to.equal(false);\n      expect(invalidConfig.reason).to.equal('invalid-config');\n      expect(missingConfig.exists).to.equal(false);\n      expect(missingConfig.reason).to.equal('not-found');\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can update a tsconfig with a framework config","suites":["TSConfig handling","tsconfig / jsconfig updates"],"updatePoint":{"line":41,"column":53,"index":2106},"line":41,"code":"    it('can update a tsconfig with a framework config', () => {\n      const config = loadTSConfig(cwd);\n      const updatedConfig = updateTSConfigForFramework(config.config, 'react');\n      expect(config.config).to.not.equal('react-jsx');\n      expect(updatedConfig.compilerOptions.jsx).to.equal('react-jsx');\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"produce no changes on invalid frameworks","suites":["TSConfig handling","tsconfig / jsconfig updates"],"updatePoint":{"line":47,"column":48,"index":2419},"line":47,"code":"    it('produce no changes on invalid frameworks', () => {\n      const config = loadTSConfig(cwd);\n      const updatedConfig = updateTSConfigForFramework(config.config, 'doesnt-exist');\n      expect(config.config).to.deep.equal(updatedConfig);\n    });","file":"units/config/config-tsconfig.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"empty user config is valid","suites":["Config Validation"],"updatePoint":{"line":7,"column":32,"index":307},"line":7,"code":"  it('empty user config is valid', async () => {\n    expect(() => validateConfig({}, process.cwd()).catch(err => err)).not.to.throw();\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Zod errors are returned when invalid config is used","suites":["Config Validation"],"updatePoint":{"line":10,"column":57,"index":473},"line":10,"code":"  it('Zod errors are returned when invalid config is used', async () => {\n    const configError = await validateConfig({\n      site: 42\n    }, process.cwd()).catch(err => err);\n    expect(configError instanceof z.ZodError).to.equal(true);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"A validation error can be formatted correctly","suites":["Config Validation"],"updatePoint":{"line":16,"column":51,"index":712},"line":16,"code":"  it('A validation error can be formatted correctly', async () => {\n    const configError = await validateConfig({\n      site: 42\n    }, process.cwd()).catch(err => err);\n    expect(configError instanceof z.ZodError).to.equal(true);\n    const formattedError = stripAnsi(formatConfigErrorMessage(configError));\n    expect(formattedError).to.equal(`[config] Astro found issue(s) with your configuration:\n  ! site  Expected string, received number.`);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Multiple validation errors can be formatted correctly","suites":["Config Validation"],"updatePoint":{"line":25,"column":59,"index":1175},"line":25,"code":"  it('Multiple validation errors can be formatted correctly', async () => {\n    const veryBadConfig = {\n      integrations: [42],\n      build: {\n        format: 'invalid'\n      }\n    };\n    const configError = await validateConfig(veryBadConfig, process.cwd()).catch(err => err);\n    expect(configError instanceof z.ZodError).to.equal(true);\n    const formattedError = stripAnsi(formatConfigErrorMessage(configError));\n    expect(formattedError).to.equal(`[config] Astro found issue(s) with your configuration:\n  ! integrations.0  Expected object, received number.\n  ! build.format  Invalid input.`);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"ignores falsey \"integration\" values","suites":["Config Validation"],"updatePoint":{"line":39,"column":41,"index":1764},"line":39,"code":"  it('ignores falsey \"integration\" values', async () => {\n    const result = await validateConfig({\n      integrations: [0, false, null, undefined]\n    }, process.cwd());\n    expect(result.integrations).to.deep.equal([]);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"normalizes \"integration\" values","suites":["Config Validation"],"updatePoint":{"line":45,"column":37,"index":1988},"line":45,"code":"  it('normalizes \"integration\" values', async () => {\n    const result = await validateConfig({\n      integrations: [{\n        name: '@astrojs/a'\n      }]\n    }, process.cwd());\n    expect(result.integrations).to.deep.equal([{\n      name: '@astrojs/a',\n      hooks: {}\n    }]);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"flattens array \"integration\" values","suites":["Config Validation"],"updatePoint":{"line":56,"column":41,"index":2276},"line":56,"code":"  it('flattens array \"integration\" values', async () => {\n    const result = await validateConfig({\n      integrations: [{\n        name: '@astrojs/a'\n      }, [{\n        name: '@astrojs/b'\n      }, {\n        name: '@astrojs/c'\n      }]]\n    }, process.cwd());\n    expect(result.integrations).to.deep.equal([{\n      name: '@astrojs/a',\n      hooks: {}\n    }, {\n      name: '@astrojs/b',\n      hooks: {}\n    }, {\n      name: '@astrojs/c',\n      hooks: {}\n    }]);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"ignores null or falsy \"integration\" values","suites":["Config Validation"],"updatePoint":{"line":77,"column":48,"index":2751},"line":77,"code":"  it('ignores null or falsy \"integration\" values', async () => {\n    const configError = await validateConfig({\n      integrations: [null, undefined, false, '', ``]\n    }, process.cwd()).catch(err => err);\n    expect(configError).to.be.not.instanceOf(Error);\n  });","file":"units/config/config-validate.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"An mjs config can import TypeScript modules","suites":["Astro config formats"],"updatePoint":{"line":10,"column":49,"index":514},"line":10,"code":"  it('An mjs config can import TypeScript modules', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': ``,\n      '/src/stuff.ts': `export default 'works';`,\n      '/astro.config.mjs': `\n\t\t\t\t\timport stuff from './src/stuff.ts';\n\t\t\t\t\texport default {}\n\t\t\t\t`\n    }, root);\n    const {\n      astroConfig\n    } = await openConfig({\n      cwd: root,\n      flags: {},\n      cmd: 'dev',\n      logging: defaultLogging,\n      fsMod: fs\n    });\n    const settings = createSettings(astroConfig);\n    await runInContainer({\n      fs,\n      root,\n      settings\n    }, () => {\n      expect(true).to.equal(true, 'We were able to get into the container which means the config loaded.');\n    });\n  });","file":"units/config/format.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Prefixes messages with object key","suites":["Content Collections - error map"],"updatePoint":{"line":6,"column":39,"index":274},"line":6,"code":"  it('Prefixes messages with object key', () => {\n    const error = getParseError(z.object({\n      base: z.string(),\n      nested: z.object({\n        key: z.string()\n      }),\n      union: z.union([z.string(), z.number()])\n    }), {\n      base: 1,\n      nested: {\n        key: 2\n      },\n      union: true\n    });\n    const msgs = messages(error).sort();\n    expect(msgs).to.have.length(3);\n    // expect \"**\" for bolding\n    expect(msgs[0].startsWith('**base**')).to.equal(true);\n    expect(msgs[1].startsWith('**nested.key**')).to.equal(true);\n    expect(msgs[2].startsWith('**union**')).to.equal(true);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns formatted error for type mismatch","suites":["Content Collections - error map"],"updatePoint":{"line":27,"column":47,"index":894},"line":27,"code":"  it('Returns formatted error for type mismatch', () => {\n    const error = getParseError(z.object({\n      foo: z.string()\n    }), {\n      foo: 1\n    });\n    expect(messages(error)).to.deep.equal(['**foo**: Expected type `\"string\"`, received \"number\"']);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns formatted error for literal mismatch","suites":["Content Collections - error map"],"updatePoint":{"line":35,"column":50,"index":1158},"line":35,"code":"  it('Returns formatted error for literal mismatch', () => {\n    const error = getParseError(z.object({\n      lang: z.literal('en')\n    }), {\n      lang: 'es'\n    });\n    expect(messages(error)).to.deep.equal(['**lang**: Expected `\"en\"`, received \"es\"']);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Replaces undefined errors with \"Required\"","suites":["Content Collections - error map"],"updatePoint":{"line":43,"column":47,"index":1417},"line":43,"code":"  it('Replaces undefined errors with \"Required\"', () => {\n    const error = getParseError(z.object({\n      foo: z.string(),\n      bar: z.string()\n    }), {\n      foo: 'foo'\n    });\n    expect(messages(error)).to.deep.equal(['**bar**: Required']);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns formatted error for basic union mismatch","suites":["Content Collections - error map"],"updatePoint":{"line":52,"column":54,"index":1677},"line":52,"code":"  it('Returns formatted error for basic union mismatch', () => {\n    const error = getParseError(z.union([z.boolean(), z.number()]), 'not a boolean or a number, oops!');\n    expect(messages(error)).to.deep.equal([fixLineEndings('Did not match union:\\n> Expected type `\"boolean\" | \"number\"`, received \"string\"')]);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns formatted error for union mismatch on nested object properties","suites":["Content Collections - error map"],"updatePoint":{"line":56,"column":76,"index":2019},"line":56,"code":"  it('Returns formatted error for union mismatch on nested object properties', () => {\n    const error = getParseError(z.union([z.object({\n      type: z.literal('tutorial')\n    }), z.object({\n      type: z.literal('article')\n    })]), {\n      type: 'integration-guide'\n    });\n    expect(messages(error)).to.deep.equal([fixLineEndings('Did not match union:\\n> **type**: Expected `\"tutorial\" | \"article\"`, received \"integration-guide\"')]);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Lets unhandled errors fall through","suites":["Content Collections - error map"],"updatePoint":{"line":66,"column":40,"index":2428},"line":66,"code":"  it('Lets unhandled errors fall through', () => {\n    const error = getParseError(z.object({\n      lang: z.enum(['en', 'fr'])\n    }), {\n      lang: 'jp'\n    });\n    expect(messages(error)).to.deep.equal([\"**lang**: Invalid enum value. Expected 'en' | 'fr', received 'jp'\"]);\n  });","file":"units/content-collections/error-map.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"errors in content/ does not crash server","suites":["frontmatter"],"updatePoint":{"line":17,"column":46,"index":759},"line":17,"code":"  it('errors in content/ does not crash server', async () => {\n    const fs = createFs({\n      ...getTypesDts(),\n      '/src/content/posts/blog.md': `\n\t\t\t\t\t---\n\t\t\t\t\ttitle: One\n\t\t\t\t\t---\n\t\t\t\t`,\n      '/src/content/config.ts': `\n\t\t\t\t\timport { defineCollection, z } from 'astro:content';\n\n\t\t\t\t\tconst posts = defineCollection({\n\t\t\t\t\t\tschema: z.string()\n\t\t\t\t\t});\n\n\t\t\t\t\texport const collections = {\n\t\t\t\t\t\tposts\n\t\t\t\t\t};\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head><title>Test</title></head>\n\t\t\t\t\t\t<body class=\"one\">\n\t\t\t\t\t\t\t<h1>Test</h1>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root\n    }, async container => {\n      await attachContentServerListeners(container);\n      fs.writeFileFromRootSync('/src/content/posts/blog.md', `\n\t\t\t\t---\n\t\t\t\ttitle: One\n\t\t\t\ttitle: two\n\t\t\t\t---\n\t\t\t\t`);\n      triggerFSEvent(container, fs, '/src/content/posts/blog.md', 'change');\n      await new Promise(resolve => setTimeout(resolve, 100));\n      // Note, if we got here, it didn't crash\n    });\n  });","file":"units/content-collections/frontmatter.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns correct entry info","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":5,"column":32,"index":245},"line":5,"code":"  it('Returns correct entry info', () => {\n    const entry = new URL('blog/first-post.md', contentDir);\n    const info = getEntryInfo({\n      entry,\n      contentDir\n    });\n    expect(info.id).to.equal('first-post.md');\n    expect(info.slug).to.equal('first-post');\n    expect(info.collection).to.equal('blog');\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns correct slug when spaces used","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":15,"column":43,"index":575},"line":15,"code":"  it('Returns correct slug when spaces used', () => {\n    const entry = new URL('blog/first post.mdx', contentDir);\n    const info = getEntryInfo({\n      entry,\n      contentDir\n    });\n    expect(info.slug).to.equal('first-post');\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns correct slug when nested directories used","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":23,"column":55,"index":825},"line":23,"code":"  it('Returns correct slug when nested directories used', () => {\n    const entry = new URL('blog/2021/01/01/index.md', contentDir);\n    const info = getEntryInfo({\n      entry,\n      contentDir\n    });\n    expect(info.slug).to.equal('2021/01/01');\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns correct collection when nested directories used","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":31,"column":61,"index":1086},"line":31,"code":"  it('Returns correct collection when nested directories used', () => {\n    const entry = new URL('blog/2021/01/01/index.md', contentDir);\n    const info = getEntryInfo({\n      entry,\n      contentDir\n    });\n    expect(info.collection).to.equal('blog');\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns error when outside collection directory","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":39,"column":53,"index":1339},"line":39,"code":"  it('Returns error when outside collection directory', () => {\n    const entry = new URL('blog.md', contentDir);\n    expect(getEntryInfo({\n      entry,\n      contentDir\n    }) instanceof Error).to.equal(true);\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Silences error on `allowFilesOutsideCollection`","suites":["Content Collections - getEntryInfo"],"updatePoint":{"line":46,"column":53,"index":1556},"line":46,"code":"  it('Silences error on `allowFilesOutsideCollection`', () => {\n    const entry = new URL('blog.md', contentDir);\n    const entryInfo = getEntryInfo({\n      entry,\n      contentDir,\n      allowFilesOutsideCollection: true\n    });\n    expect(entryInfo instanceof Error).to.equal(false);\n    expect(entryInfo.id).to.equal('blog.md');\n  });","file":"units/content-collections/get-entry-info.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"content\" for Markdown files","suites":["Content Collections - getEntryType"],"updatePoint":{"line":30,"column":46,"index":896},"line":30,"code":"      it('Returns \"content\" for Markdown files', () => {\n        for (const entryPath of ['blog/first-post.md', 'blog/first-post.mdx']) {\n          const entry = fileURLToPath(new URL(entryPath, contentPaths.contentDir));\n          const type = getEntryType(entry, contentPaths, contentFileExts);\n          expect(type).to.equal('content');\n        }\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"content\" for Markdown files in nested directories","suites":["Content Collections - getEntryType"],"updatePoint":{"line":37,"column":68,"index":1279},"line":37,"code":"      it('Returns \"content\" for Markdown files in nested directories', () => {\n        for (const entryPath of ['blog/2021/01/01/index.md', 'blog/2021/01/01/index.mdx']) {\n          const entry = fileURLToPath(new URL(entryPath, contentPaths.contentDir));\n          const type = getEntryType(entry, contentPaths, contentFileExts);\n          expect(type).to.equal('content');\n        }\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"config\" for config files","suites":["Content Collections - getEntryType"],"updatePoint":{"line":44,"column":43,"index":1649},"line":44,"code":"      it('Returns \"config\" for config files', () => {\n        const entry = fileURLToPath(contentPaths.config.url);\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('config');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"unsupported\" for non-Markdown files","suites":["Content Collections - getEntryType"],"updatePoint":{"line":49,"column":54,"index":1900},"line":49,"code":"      it('Returns \"unsupported\" for non-Markdown files', () => {\n        const entry = fileURLToPath(new URL('blog/robots.txt', contentPaths.contentDir));\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('unsupported');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"ignored\" for .DS_Store","suites":["Content Collections - getEntryType"],"updatePoint":{"line":54,"column":41,"index":2171},"line":54,"code":"      it('Returns \"ignored\" for .DS_Store', () => {\n        const entry = fileURLToPath(new URL('blog/.DS_Store', contentPaths.contentDir));\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('ignored');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"ignored\" for unsupported files using an underscore","suites":["Content Collections - getEntryType"],"updatePoint":{"line":59,"column":69,"index":2465},"line":59,"code":"      it('Returns \"ignored\" for unsupported files using an underscore', () => {\n        const entry = fileURLToPath(new URL('blog/_draft-robots.txt', contentPaths.contentDir));\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('ignored');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"ignored\" when using underscore on file name","suites":["Content Collections - getEntryType"],"updatePoint":{"line":64,"column":62,"index":2760},"line":64,"code":"      it('Returns \"ignored\" when using underscore on file name', () => {\n        const entry = fileURLToPath(new URL('blog/_first-post.md', contentPaths.contentDir));\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('ignored');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Returns \"ignored\" when using underscore on directory name","suites":["Content Collections - getEntryType"],"updatePoint":{"line":69,"column":67,"index":3057},"line":69,"code":"      it('Returns \"ignored\" when using underscore on directory name', () => {\n        const entry = fileURLToPath(new URL('blog/_draft/first-post.md', contentPaths.contentDir));\n        const type = getEntryType(entry, contentPaths, contentFileExts);\n        expect(type).to.equal('ignored');\n      });","file":"units/content-collections/get-entry-type.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"creates a Set-Cookie header to delete it","suites":["astro/src/core/cookies","Astro.cookies.delete"],"updatePoint":{"line":7,"column":48,"index":324},"line":7,"code":"    it('creates a Set-Cookie header to delete it', () => {\n      let req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      let cookies = new AstroCookies(req);\n      expect(cookies.get('foo').value).to.equal('bar');\n      cookies.delete('foo');\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n    });","file":"units/cookies/delete.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"calling cookies.get() after returns undefined","suites":["astro/src/core/cookies","Astro.cookies.delete"],"updatePoint":{"line":19,"column":53,"index":740},"line":19,"code":"    it('calling cookies.get() after returns undefined', () => {\n      let req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      let cookies = new AstroCookies(req);\n      expect(cookies.get('foo').value).to.equal('bar');\n      cookies.delete('foo');\n      expect(cookies.get('foo').value).to.equal(undefined);\n    });","file":"units/cookies/delete.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"calling cookies.has() after returns false","suites":["astro/src/core/cookies","Astro.cookies.delete"],"updatePoint":{"line":30,"column":49,"index":1116},"line":30,"code":"    it('calling cookies.has() after returns false', () => {\n      let req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      let cookies = new AstroCookies(req);\n      expect(cookies.has('foo')).to.equal(true);\n      cookies.delete('foo');\n      expect(cookies.has('foo')).to.equal(false);\n    });","file":"units/cookies/delete.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can provide a path","suites":["astro/src/core/cookies","Astro.cookies.delete"],"updatePoint":{"line":41,"column":26,"index":1452},"line":41,"code":"    it('can provide a path', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.delete('foo', {\n        path: '/subpath/'\n      });\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.match(/Path=\\/subpath\\//);\n    });","file":"units/cookies/delete.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can provide a domain","suites":["astro/src/core/cookies","Astro.cookies.delete"],"updatePoint":{"line":51,"column":28,"index":1811},"line":51,"code":"    it('can provide a domain', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.delete('foo', {\n        domain: '.example.com'\n      });\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.match(/Domain=\\.example\\.com/);\n    });","file":"units/cookies/delete.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Produces an error if the response is already sent","suites":["astro/src/core/cookies","errors"],"updatePoint":{"line":7,"column":57,"index":319},"line":7,"code":"    it('Produces an error if the response is already sent', () => {\n      const req = new Request('http://example.com/', {});\n      const cookies = new AstroCookies(req);\n      req[Symbol.for('astro.responseSent')] = true;\n      try {\n        cookies.set('foo', 'bar');\n        expect(false).to.equal(true);\n      } catch (err) {\n        expect(err.errorCode).to.equal(3030);\n      }\n    });","file":"units/cookies/error.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"gets the cookie value","suites":["astro/src/core/cookies","Astro.cookies.get"],"updatePoint":{"line":7,"column":29,"index":302},"line":7,"code":"    it('gets the cookie value', () => {\n      const req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      const cookies = new AstroCookies(req);\n      expect(cookies.get('foo').value).to.equal('bar');\n    });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns a JavaScript object","suites":["astro/src/core/cookies","Astro.cookies.get",".json()"],"updatePoint":{"line":17,"column":37,"index":613},"line":17,"code":"      it('returns a JavaScript object', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=%7B%22key%22%3A%22value%22%7D'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const json = cookies.get('foo').json();\n        expect(json).to.be.an('object');\n        expect(json.key).to.equal('value');\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws if the value is undefined","suites":["astro/src/core/cookies","Astro.cookies.get",".json()"],"updatePoint":{"line":28,"column":42,"index":1012},"line":28,"code":"      it('throws if the value is undefined', () => {\n        const req = new Request('http://example.com/');\n        let cookies = new AstroCookies(req);\n        let cookie = cookies.get('foo');\n        expect(() => cookie.json()).to.throw('Cannot convert undefined to an object.');\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces into a number","suites":["astro/src/core/cookies","Astro.cookies.get",".number()"],"updatePoint":{"line":36,"column":31,"index":1336},"line":36,"code":"      it('Coerces into a number', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=22'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').number();\n        expect(value).to.be.an('number');\n        expect(value).to.equal(22);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces non-number into NaN","suites":["astro/src/core/cookies","Astro.cookies.get",".number()"],"updatePoint":{"line":47,"column":37,"index":1699},"line":47,"code":"      it('Coerces non-number into NaN', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=bar'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').number();\n        expect(value).to.be.an('number');\n        expect(Number.isNaN(value)).to.equal(true);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces true into `true`","suites":["astro/src/core/cookies","Astro.cookies.get",".boolean()"],"updatePoint":{"line":60,"column":34,"index":2119},"line":60,"code":"      it('Coerces true into `true`', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=true'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').boolean();\n        expect(value).to.be.an('boolean');\n        expect(value).to.equal(true);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces false into `false`","suites":["astro/src/core/cookies","Astro.cookies.get",".boolean()"],"updatePoint":{"line":71,"column":36,"index":2487},"line":71,"code":"      it('Coerces false into `false`', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=false'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').boolean();\n        expect(value).to.be.an('boolean');\n        expect(value).to.equal(false);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces 1 into `true`","suites":["astro/src/core/cookies","Astro.cookies.get",".boolean()"],"updatePoint":{"line":82,"column":31,"index":2852},"line":82,"code":"      it('Coerces 1 into `true`', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=1'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').boolean();\n        expect(value).to.be.an('boolean');\n        expect(value).to.equal(true);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces 0 into `false`","suites":["astro/src/core/cookies","Astro.cookies.get",".boolean()"],"updatePoint":{"line":93,"column":32,"index":3213},"line":93,"code":"      it('Coerces 0 into `false`', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=0'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').boolean();\n        expect(value).to.be.an('boolean');\n        expect(value).to.equal(false);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Coerces truthy strings into `true`","suites":["astro/src/core/cookies","Astro.cookies.get",".boolean()"],"updatePoint":{"line":104,"column":44,"index":3587},"line":104,"code":"      it('Coerces truthy strings into `true`', () => {\n        const req = new Request('http://example.com/', {\n          headers: {\n            cookie: 'foo=bar'\n          }\n        });\n        let cookies = new AstroCookies(req);\n        const value = cookies.get('foo').boolean();\n        expect(value).to.be.an('boolean');\n        expect(value).to.equal(true);\n      });","file":"units/cookies/get.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns true if the request has the cookie","suites":["astro/src/core/cookies","Astro.cookies.has"],"updatePoint":{"line":7,"column":50,"index":323},"line":7,"code":"    it('returns true if the request has the cookie', () => {\n      let req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      let cookies = new AstroCookies(req);\n      expect(cookies.has('foo')).to.equal(true);\n    });","file":"units/cookies/has.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns false if the request does not have the cookie","suites":["astro/src/core/cookies","Astro.cookies.has"],"updatePoint":{"line":16,"column":61,"index":615},"line":16,"code":"    it('returns false if the request does not have the cookie', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      expect(cookies.has('foo')).to.equal(false);\n    });","file":"units/cookies/has.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"returns true if the cookie has been set","suites":["astro/src/core/cookies","Astro.cookies.has"],"updatePoint":{"line":21,"column":47,"index":826},"line":21,"code":"    it('returns true if the cookie has been set', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('foo', 'bar');\n      expect(cookies.has('foo')).to.equal(true);\n    });","file":"units/cookies/has.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Sets a cookie value that can be serialized","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":7,"column":50,"index":323},"line":7,"code":"    it('Sets a cookie value that can be serialized', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('foo', 'bar');\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.equal('foo=bar');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can set cookie options","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":15,"column":30,"index":642},"line":15,"code":"    it('Can set cookie options', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('foo', 'bar', {\n        httpOnly: true,\n        path: '/subpath/'\n      });\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.equal('foo=bar; Path=/subpath/; HttpOnly');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can pass a JavaScript object that will be serialized","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":26,"column":60,"index":1078},"line":26,"code":"    it('Can pass a JavaScript object that will be serialized', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('options', {\n        one: 'two',\n        three: 4\n      });\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(JSON.parse(decodeURIComponent(headers[0].slice(8))).one).to.equal('two');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can pass a number","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":37,"column":25,"index":1478},"line":37,"code":"    it('Can pass a number', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('one', 2);\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.equal('one=2');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can pass a boolean","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":45,"column":26,"index":1787},"line":45,"code":"    it('Can pass a boolean', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('admin', true);\n      expect(cookies.get('admin').boolean()).to.equal(true);\n      let headers = Array.from(cookies.headers());\n      expect(headers).to.have.a.lengthOf(1);\n      expect(headers[0]).to.equal('admin=true');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can get the value after setting","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":54,"column":39,"index":2180},"line":54,"code":"    it('Can get the value after setting', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('foo', 'bar');\n      let r = cookies.get('foo');\n      expect(r.value).to.equal('bar');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can get the JavaScript object after setting","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":61,"column":51,"index":2451},"line":61,"code":"    it('Can get the JavaScript object after setting', () => {\n      let req = new Request('http://example.com/');\n      let cookies = new AstroCookies(req);\n      cookies.set('options', {\n        one: 'two',\n        three: 4\n      });\n      let cook = cookies.get('options');\n      let value = cook.json();\n      expect(value).to.be.an('object');\n      expect(value.one).to.equal('two');\n      expect(value.three).to.be.a('number');\n      expect(value.three).to.equal(4);\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Overrides a value in the request","suites":["astro/src/core/cookies","Astro.cookies.set"],"updatePoint":{"line":75,"column":40,"index":2920},"line":75,"code":"    it('Overrides a value in the request', () => {\n      let req = new Request('http://example.com/', {\n        headers: {\n          cookie: 'foo=bar'\n        }\n      });\n      let cookies = new AstroCookies(req);\n      expect(cookies.get('foo').value).to.equal('bar');\n\n      // Set a new value\n      cookies.set('foo', 'baz');\n      expect(cookies.get('foo').value).to.equal('baz');\n    });","file":"units/cookies/set.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Requests that include a trailing slash 404","suites":["base configuration","with trailingSlash: \"never\"","index route"],"updatePoint":{"line":8,"column":52,"index":410},"line":8,"code":"      it('Requests that include a trailing slash 404', async () => {\n        const fs = createFs({\n          '/src/pages/index.astro': `<h1>testing</h1>`\n        }, root);\n        await runInContainer({\n          fs,\n          root,\n          userConfig: {\n            base: '/docs',\n            trailingSlash: 'never'\n          }\n        }, async container => {\n          const {\n            req,\n            res,\n            done\n          } = createRequestAndResponse({\n            method: 'GET',\n            url: '/docs/'\n          });\n          container.handle(req, res);\n          await done;\n          expect(res.statusCode).to.equal(404);\n        });\n      });","file":"units/dev/base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Requests that exclude a trailing slash 200","suites":["base configuration","with trailingSlash: \"never\"","index route"],"updatePoint":{"line":33,"column":52,"index":1080},"line":33,"code":"      it('Requests that exclude a trailing slash 200', async () => {\n        const fs = createFs({\n          '/src/pages/index.astro': `<h1>testing</h1>`\n        }, root);\n        await runInContainer({\n          fs,\n          root,\n          userConfig: {\n            base: '/docs',\n            trailingSlash: 'never'\n          }\n        }, async container => {\n          const {\n            req,\n            res,\n            done\n          } = createRequestAndResponse({\n            method: 'GET',\n            url: '/docs'\n          });\n          container.handle(req, res);\n          await done;\n          expect(res.statusCode).to.equal(200);\n        });\n      });","file":"units/dev/base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Requests that include a trailing slash 404","suites":["base configuration","with trailingSlash: \"never\"","sub route"],"updatePoint":{"line":60,"column":52,"index":1791},"line":60,"code":"      it('Requests that include a trailing slash 404', async () => {\n        const fs = createFs({\n          '/src/pages/sub/index.astro': `<h1>testing</h1>`\n        }, root);\n        await runInContainer({\n          fs,\n          root,\n          userConfig: {\n            base: '/docs',\n            trailingSlash: 'never'\n          }\n        }, async container => {\n          const {\n            req,\n            res,\n            done\n          } = createRequestAndResponse({\n            method: 'GET',\n            url: '/docs/sub/'\n          });\n          container.handle(req, res);\n          await done;\n          expect(res.statusCode).to.equal(404);\n        });\n      });","file":"units/dev/base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Requests that exclude a trailing slash 200","suites":["base configuration","with trailingSlash: \"never\"","sub route"],"updatePoint":{"line":85,"column":52,"index":2469},"line":85,"code":"      it('Requests that exclude a trailing slash 200', async () => {\n        const fs = createFs({\n          '/src/pages/sub/index.astro': `<h1>testing</h1>`\n        }, root);\n        await runInContainer({\n          fs,\n          root,\n          userConfig: {\n            base: '/docs',\n            trailingSlash: 'never'\n          }\n        }, async container => {\n          const {\n            req,\n            res,\n            done\n          } = createRequestAndResponse({\n            method: 'GET',\n            url: '/docs/sub'\n          });\n          container.handle(req, res);\n          await done;\n          expect(res.statusCode).to.equal(200);\n        });\n      });","file":"units/dev/base.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be called in a page component","suites":["Content Collections - render()"],"updatePoint":{"line":17,"column":39,"index":862},"line":17,"code":"  it('can be called in a page component', async () => {\n    const fs = createFsWithFallback({\n      '/src/content/config.ts': `\n\t\t\t\t\timport { z, defineCollection } from 'astro:content';\n\n\t\t\t\t\tconst blog = defineCollection({\n\t\t\t\t\t\tschema: z.object({\n\t\t\t\t\t\t\ttitle: z.string(),\n\t\t\t\t\t\t\tdescription: z.string().max(60, 'For SEO purposes, keep descriptions short!'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\n\t\t\t\t\texport const collections = { blog };\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport { getCollection } from 'astro:content';\n\t\t\t\t\tconst blog = await getCollection('blog');\n\t\t\t\t\tconst launchWeekEntry = blog.find(post => post.id === 'promo/launch-week.mdx');\n\t\t\t\t\tconst { Content } = await launchWeekEntry.render();\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head><title>Testing</title></head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<h1>testing</h1>\n\t\t\t\t\t\t\t<Content />\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`\n    }, root);\n    await runInContainerWithContentListeners({\n      fs,\n      root,\n      userConfig: {\n        integrations: [mdx()],\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      // Rendered the content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Rendered the styles\n      expect($('style')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/collections-renderentry.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be used in a layout component","suites":["Content Collections - render()"],"updatePoint":{"line":79,"column":39,"index":2434},"line":79,"code":"  it('can be used in a layout component', async () => {\n    const fs = createFsWithFallback({\n      // Loading the content config with `astro:content` oddly\n      // causes this test to fail. Spoof a different src/content entry\n      // to ensure `existsSync` checks pass.\n      // TODO: revisit after addressing this issue\n      // https://github.com/withastro/astro/issues/6121\n      '/src/content/blog/promo/launch-week.mdx': `---\ntitle: Launch Week\ndescription: Astro is launching this week!\n---\n# Launch Week\n- [x] Launch Astro\n- [ ] Celebrate`,\n      '/src/components/Layout.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport { getCollection } from 'astro:content';\n\t\t\t\t\tconst blog = await getCollection('blog');\n\t\t\t\t\tconst launchWeekEntry = blog.find(post => post.id === 'promo/launch-week.mdx');\n\t\t\t\t\tconst { Content } = await launchWeekEntry.render();\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head></head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<slot name=\"title\"></slot>\n\t\t\t\t\t\t\t<article>\n\t\t\t\t\t\t\t\t<Content />\n\t\t\t\t\t\t\t</article>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport Layout from '../components/Layout.astro';\n\t\t\t\t\t---\n\t\t\t\t\t<Layout>\n\t\t\t\t\t\t<h1 slot=\"title\">Index page</h2>\n\t\t\t\t\t</Layout>\n\t\t\t\t`\n    }, root);\n    await runInContainerWithContentListeners({\n      fs,\n      root,\n      userConfig: {\n        integrations: [mdx()],\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      // Rendered the content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Rendered the styles\n      expect($('style')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/collections-renderentry.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be used in a slot","suites":["Content Collections - render()"],"updatePoint":{"line":152,"column":27,"index":4327},"line":152,"code":"  it('can be used in a slot', async () => {\n    const fs = createFsWithFallback({\n      '/src/content/config.ts': `\n\t\t\t\t\timport { z, defineCollection } from 'astro:content';\n\n\t\t\t\t\tconst blog = defineCollection({\n\t\t\t\t\t\tschema: z.object({\n\t\t\t\t\t\t\ttitle: z.string(),\n\t\t\t\t\t\t\tdescription: z.string().max(60, 'For SEO purposes, keep descriptions short!'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\n\t\t\t\t\texport const collections = { blog };\n\t\t\t\t`,\n      '/src/components/Layout.astro': `\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head></head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<slot name=\"title\"></slot>\n\t\t\t\t\t\t\t<article>\n\t\t\t\t\t\t\t\t<slot name=\"main\"></slot>\n\t\t\t\t\t\t\t</article>\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport Layout from '../components/Layout.astro';\n\t\t\t\t\timport { getCollection } from 'astro:content';\n\t\t\t\t\tconst blog = await getCollection('blog');\n\t\t\t\t\tconst launchWeekEntry = blog.find(post => post.id === 'promo/launch-week.mdx');\n\t\t\t\t\tconst { Content } = await launchWeekEntry.render();\n\t\t\t\t\t---\n\t\t\t\t\t<Layout>\n\t\t\t\t\t\t<h1 slot=\"title\">Index page</h2>\n\t\t\t\t\t\t<Content slot=\"main\" />\n\t\t\t\t\t</Layout>\n\t\t\t\t`\n    }, root);\n    await runInContainerWithContentListeners({\n      fs,\n      root,\n      userConfig: {\n        integrations: [mdx()],\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      // Rendered the content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Rendered the styles\n      expect($('style')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/collections-renderentry.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can be called from any js/ts file","suites":["Content Collections - render()"],"updatePoint":{"line":223,"column":39,"index":6136},"line":223,"code":"  it('can be called from any js/ts file', async () => {\n    const fs = createFsWithFallback({\n      '/src/content/config.ts': `\n\t\t\t\t\timport { z, defineCollection } from 'astro:content';\n\n\t\t\t\t\tconst blog = defineCollection({\n\t\t\t\t\t\tschema: z.object({\n\t\t\t\t\t\t\ttitle: z.string(),\n\t\t\t\t\t\t\tdescription: z.string().max(60, 'For SEO purposes, keep descriptions short!'),\n\t\t\t\t\t\t}),\n\t\t\t\t\t});\n\n\t\t\t\t\texport const collections = { blog };\n\t\t\t\t`,\n      '/src/launch-week.ts': `\n\t\t\t\t\timport { getCollection } from 'astro:content';\n\n\t\t\t\t\texport let Content;\n\n\t\t\t\t\tconst blog = await getCollection('blog');\n\t\t\t\t\tconst launchWeekEntry = blog.find(post => post.id === 'promo/launch-week.mdx');\n\t\t\t\t\tconst mod = await launchWeekEntry.render();\n\n\t\t\t\t\tContent = mod.Content;\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport { Content } from '../launch-week.ts';\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head><title>Testing</title></head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<h1>Testing</h1>\n\t\t\t\t\t\t\t<Content />\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`\n    }, root);\n    await runInContainerWithContentListeners({\n      fs,\n      root,\n      userConfig: {\n        integrations: [mdx()],\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      // Rendered the content\n      expect($('ul li')).to.have.a.lengthOf(3);\n\n      // Rendered the styles\n      expect($('style')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/collections-renderentry.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"can render requests","suites":["dev container"],"updatePoint":{"line":7,"column":25,"index":344},"line":7,"code":"  it('can render requests', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `\n\t\t\t\t---\n\t\t\t\tconst name = 'Testing';\n\t\t\t\t---\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>{name}</title></head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<h1>{name}</h1>\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root\n    }, async container => {\n      const {\n        req,\n        res,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      const html = await text();\n      const $ = cheerio.load(html);\n      expect(res.statusCode).to.equal(200);\n      expect($('h1')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/dev.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"HMR only short circuits on previously cached modules","suites":["dev container"],"updatePoint":{"line":40,"column":58,"index":1074},"line":40,"code":"  it('HMR only short circuits on previously cached modules', async () => {\n    const fs = createFs({\n      '/src/components/Header.astro': `\n\t\t\t\t\t<h1>{Astro.props.title}</h1>\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport Header from '../components/Header.astro';\n\t\t\t\t\tconst name = 'Testing';\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head><title>{name}</title></head>\n\t\t\t\t\t\t<body class=\"one\">\n\t\t\t\t\t\t\t<Header title={name} />\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root\n    }, async container => {\n      let r = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(r.req, r.res);\n      let html = await r.text();\n      let $ = cheerio.load(html);\n      expect($('body.one')).to.have.a.lengthOf(1);\n      fs.writeFileFromRootSync('/src/components/Header.astro', `\n\t\t\t\t<h1>{Astro.props.title}</h1>\n\t\t\t`);\n      triggerFSEvent(container, fs, '/src/components/Header.astro', 'change');\n      fs.writeFileFromRootSync('/src/pages/index.astro', `\n\t\t\t\t---\n\t\t\t\timport Header from '../components/Header.astro';\n\t\t\t\tconst name = 'Testing';\n\t\t\t\t---\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>{name}</title></head>\n\t\t\t\t\t<body class=\"two\">\n\t\t\t\t\t\t<Header title={name} />\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`);\n      triggerFSEvent(container, fs, '/src/pages/index.astro', 'change');\n      r = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(r.req, r.res);\n      html = await r.text();\n      $ = cheerio.load(html);\n      expect($('body.one')).to.have.a.lengthOf(0);\n      expect($('body.two')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/dev.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Allows dynamic segments in injected routes","suites":["dev container"],"updatePoint":{"line":98,"column":48,"index":2710},"line":98,"code":"  it('Allows dynamic segments in injected routes', async () => {\n    const fs = createFs({\n      '/src/components/test.astro': `<h1>{Astro.params.slug}</h1>`,\n      '/src/pages/test-[slug].astro': `<h1>{Astro.params.slug}</h1>`\n    }, root);\n    await runInContainer({\n      fs,\n      root,\n      userConfig: {\n        output: 'server',\n        integrations: [{\n          name: '@astrojs/test-integration',\n          hooks: {\n            'astro:config:setup': ({\n              injectRoute\n            }) => {\n              injectRoute({\n                pattern: '/another-[slug]',\n                entryPoint: './src/components/test.astro'\n              });\n            }\n          }\n        }]\n      }\n    }, async container => {\n      let r = createRequestAndResponse({\n        method: 'GET',\n        url: '/test-one'\n      });\n      container.handle(r.req, r.res);\n      await r.done;\n      expect(r.res.statusCode).to.equal(200);\n\n      // Try with the injected route\n      r = createRequestAndResponse({\n        method: 'GET',\n        url: '/another-two'\n      });\n      container.handle(r.req, r.res);\n      await r.done;\n      expect(r.res.statusCode).to.equal(200);\n    });\n  });","file":"units/dev/dev.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"items in public/ are not available from root when using a base","suites":["dev container"],"updatePoint":{"line":141,"column":68,"index":3917},"line":141,"code":"  it('items in public/ are not available from root when using a base', async () => {\n    await runInContainer({\n      root,\n      userConfig: {\n        base: '/sub/'\n      }\n    }, async container => {\n      // First try the subpath\n      let r = createRequestAndResponse({\n        method: 'GET',\n        url: '/sub/test.txt'\n      });\n      container.handle(r.req, r.res);\n      await r.done;\n      expect(r.res.statusCode).to.equal(200);\n\n      // Next try the root path\n      r = createRequestAndResponse({\n        method: 'GET',\n        url: '/test.txt'\n      });\n      container.handle(r.req, r.res);\n      await r.done;\n      expect(r.res.statusCode).to.equal(301);\n      expect(r.res.getHeader('location')).to.equal('/sub/test.txt');\n    });\n  });","file":"units/dev/dev.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"items in public/ are available from root when not using a base","suites":["dev container"],"updatePoint":{"line":168,"column":68,"index":4672},"line":168,"code":"  it('items in public/ are available from root when not using a base', async () => {\n    await runInContainer({\n      root\n    }, async container => {\n      // Try the root path\n      let r = createRequestAndResponse({\n        method: 'GET',\n        url: '/test.txt'\n      });\n      container.handle(r.req, r.res);\n      await r.done;\n      expect(r.res.statusCode).to.equal(200);\n    });\n  });","file":"units/dev/dev.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Dynamic injection from component created in the page frontmatter","suites":["head injection"],"updatePoint":{"line":7,"column":70,"index":374},"line":7,"code":"  it('Dynamic injection from component created in the page frontmatter', async () => {\n    const fs = createFs({\n      '/src/components/Other.astro': `\n\t\t\t\t\t<style>\n\t\t\t\t\t\tdiv {\n\t\t\t\t\t\t\tbackground: grey;\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t\t<div id=\"other\">Other</div>\n\t\t\t\t`,\n      '/src/common/head.js': `\n\t\t\t\t\t// astro-head-inject\n\t\t\t\t\timport Other from '../components/Other.astro';\n\t\t\t\t\timport {\n\t\t\t\t\t\tcreateComponent,\n\t\t\t\t\t\tcreateHeadAndContent,\n\t\t\t\t\t\trenderComponent,\n\t\t\t\t\t\trenderTemplate,\n\t\t\t\t\t\trenderUniqueStylesheet,\n\t\t\t\t\t\tunescapeHTML\n\t\t\t\t\t} from 'astro/runtime/server/index.js';\n\n\t\t\t\t\texport function renderEntry() {\n\t\t\t\t\t\treturn createComponent({\n\t\t\t\t\t\t\tfactory(result, props, slots) {\n\t\t\t\t\t\t\t\treturn createHeadAndContent(\n\t\t\t\t\t\t\t\t\tunescapeHTML(renderUniqueStylesheet(result, {\n\t\t\t\t\t\t\t\t\t\thref: '/some/fake/styles.css'\n\t\t\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t\t\t\trenderTemplate\\`$\\{renderComponent(result, 'Other', Other, props, slots)}\\`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpropagation: 'self'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t`.trim(),\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport { renderEntry } from '../common/head.js';\n\t\t\t\t\tconst Head = renderEntry();\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head><title>Testing</title></head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<h1>testing</h1>\n\t\t\t\t\t\t\t<Head />\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root,\n      userConfig: {\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      expect($('link[rel=stylesheet][href=\"/some/fake/styles.css\"]')).to.have.a.lengthOf(1);\n      expect($('#other')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Dynamic injection from a layout component","suites":["head injection"],"updatePoint":{"line":85,"column":47,"index":2266},"line":85,"code":"  it('Dynamic injection from a layout component', async () => {\n    const fs = createFs({\n      '/src/components/Other.astro': `\n\t\t\t\t\t<style>\n\t\t\t\t\t\tdiv {\n\t\t\t\t\t\t\tbackground: grey;\n\t\t\t\t\t\t}\n\t\t\t\t\t</style>\n\t\t\t\t\t<div id=\"other\">Other</div>\n\t\t\t\t`,\n      '/src/common/head.js': `\n\t\t\t\t\t// astro-head-inject\n\t\t\t\t\timport Other from '../components/Other.astro';\n\t\t\t\t\timport {\n\t\t\t\t\t\tcreateComponent,\n\t\t\t\t\t\tcreateHeadAndContent,\n\t\t\t\t\t\trenderComponent,\n\t\t\t\t\t\trenderTemplate,\n\t\t\t\t\t\trenderUniqueStylesheet,\n\t\t\t\t\t\tunescapeHTML,\n\t\t\t\t\t} from 'astro/runtime/server/index.js';\n\n\t\t\t\t\texport function renderEntry() {\n\t\t\t\t\t\treturn createComponent({\n\t\t\t\t\t\t\tfactory(result, props, slots) {\n\t\t\t\t\t\t\t\treturn createHeadAndContent(\n\t\t\t\t\t\t\t\t\tunescapeHTML(renderUniqueStylesheet(result, {\n\t\t\t\t\t\t\t\t\t\thref: '/some/fake/styles.css'\n\t\t\t\t\t\t\t\t\t})),\n\t\t\t\t\t\t\t\t\trenderTemplate\\`$\\{renderComponent(result, 'Other', Other, props, slots)}\\`\n\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\tpropagation: 'self'\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t`.trim(),\n      '/src/components/Layout.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport { renderEntry } from '../common/head.js';\n\t\t\t\t\tconst ExtraHead = renderEntry();\n\t\t\t\t\t---\n\t\t\t\t\t<html>\n\t\t\t\t\t\t<head>\n\t\t\t\t\t\t\t<title>Normal head stuff</title>\n\t\t\t\t\t\t</head>\n\t\t\t\t\t\t<body>\n\t\t\t\t\t\t\t<slot name=\"title\" />\n\t\t\t\t\t\t\t<ExtraHead />\n\t\t\t\t\t\t</body>\n\t\t\t\t\t</html>\n\t\t\t\t`,\n      '/src/pages/index.astro': `\n\t\t\t\t\t---\n\t\t\t\t\timport Layout from '../components/Layout.astro';\n\t\t\t\t\t---\n\t\t\t\t\t<Layout>\n\t\t\t\t\t\t<h1 slot=\"title\">Test page</h1>\n\t\t\t\t\t</Layout>\n\t\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root,\n      userConfig: {\n        vite: {\n          server: {\n            middlewareMode: true\n          }\n        }\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      expect($('link[rel=stylesheet][href=\"/some/fake/styles.css\"]')).to.have.a.lengthOf(1);\n      expect($('#other')).to.have.a.lengthOf(1);\n    });\n  });","file":"units/dev/head-injection.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should not crash when reassigning a hydrated component","suites":["dev container"],"updatePoint":{"line":8,"column":60,"index":449},"line":8,"code":"  it('should not crash when reassigning a hydrated component', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `\n\t\t\t\t---\n\t\t\t\timport Svelte from '../components/Client.svelte';\n\t\t\t\tconst Foo = Svelte;\n\t\t\t\tconst Bar = Svelte;\n\t\t\t\t---\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>testing</title></head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<Foo client:load />\n\t\t\t\t\t\t<Bar client:load />\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root,\n      logging: {\n        ...defaultLogging,\n        // Error is expected in this test\n        level: 'silent'\n      },\n      userConfig: {\n        integrations: [svelte()]\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      const html = await done;\n      expect(res.statusCode).to.equal(200, \"We get a 200 because the error occurs in the template, but we didn't crash!\");\n    });\n  });","file":"units/dev/hydration.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Surfaces config errors on restarts","suites":["dev container restarts"],"updatePoint":{"line":10,"column":40,"index":588},"line":10,"code":"  it('Surfaces config errors on restarts', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>Test</title></head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<h1>Test</h1>\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`,\n      '/astro.config.mjs': `\n\t\t\t\t\n\t\t\t\t`\n    }, root);\n    let restart = await createContainerWithAutomaticRestart({\n      params: {\n        fs,\n        root\n      }\n    });\n    try {\n      let r = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      restart.container.handle(r.req, r.res);\n      let html = await r.text();\n      const $ = cheerio.load(html);\n      expect(r.res.statusCode).to.equal(200);\n      expect($('h1')).to.have.a.lengthOf(1);\n\n      // Create an error\n      let restartComplete = restart.restarted();\n      fs.writeFileFromRootSync('/astro.config.mjs', 'const foo = bar');\n\n      // Vite watches the real filesystem, so we have to mock this part. It's not so bad.\n      restart.container.viteServer.watcher.emit('change', fs.getFullyResolvedPath('/astro.config.mjs'));\n\n      // Wait for the restart to finish\n      let hmrError = await restartComplete;\n      expect(hmrError).to.not.be.a('undefined');\n\n      // Do it a second time to make sure we are still watching\n\n      restartComplete = restart.restarted();\n      fs.writeFileFromRootSync('/astro.config.mjs', 'const foo = bar2');\n\n      // Vite watches the real filesystem, so we have to mock this part. It's not so bad.\n      restart.container.viteServer.watcher.emit('change', fs.getFullyResolvedPath('/astro.config.mjs'));\n      hmrError = await restartComplete;\n      expect(hmrError).to.not.be.a('undefined');\n    } finally {\n      await restart.container.close();\n    }\n  });","file":"units/dev/restart.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Restarts the container if previously started","suites":["dev container restarts"],"updatePoint":{"line":65,"column":50,"index":2320},"line":65,"code":"  it('Restarts the container if previously started', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>Test</title></head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<h1>Test</h1>\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`,\n      '/astro.config.mjs': ``\n    }, root);\n    let restart = await createContainerWithAutomaticRestart({\n      params: {\n        fs,\n        root\n      }\n    });\n    await startContainer(restart.container);\n    expect(isStarted(restart.container)).to.equal(true);\n    try {\n      // Trigger a change\n      let restartComplete = restart.restarted();\n      triggerFSEvent(restart.container, fs, '/astro.config.mjs', 'change');\n      await restartComplete;\n      expect(isStarted(restart.container)).to.equal(true);\n    } finally {\n      await restart.container.close();\n    }\n  });","file":"units/dev/restart.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to restart project using Tailwind + astro.config.ts","suites":["dev container restarts"],"updatePoint":{"line":95,"column":65,"index":3155},"line":95,"code":"  it('Is able to restart project using Tailwind + astro.config.ts', async () => {\n    const troot = new URL('../../fixtures/tailwindcss-ts/', import.meta.url);\n    const fs = createFs({\n      '/src/pages/index.astro': ``,\n      '/astro.config.ts': ``\n    }, troot);\n    const {\n      astroConfig\n    } = await openConfig({\n      cwd: troot,\n      flags: {},\n      cmd: 'dev',\n      logging: defaultLogging\n    });\n    const settings = createSettings(astroConfig);\n    let restart = await createContainerWithAutomaticRestart({\n      params: {\n        fs,\n        root,\n        settings\n      }\n    });\n    await startContainer(restart.container);\n    expect(isStarted(restart.container)).to.equal(true);\n    try {\n      // Trigger a change\n      let restartComplete = restart.restarted();\n      triggerFSEvent(restart.container, fs, '/astro.config.ts', 'change');\n      await restartComplete;\n      expect(isStarted(restart.container)).to.equal(true);\n    } finally {\n      await restart.container.close();\n    }\n  });","file":"units/dev/restart.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to restart project on package.json changes","suites":["dev container restarts"],"updatePoint":{"line":129,"column":56,"index":4164},"line":129,"code":"  it('Is able to restart project on package.json changes', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': ``\n    }, root);\n    const {\n      astroConfig\n    } = await openConfig({\n      cwd: root,\n      flags: {},\n      cmd: 'dev',\n      logging: defaultLogging\n    });\n    const settings = createSettings(astroConfig, fileURLToPath(root));\n    let restart = await createContainerWithAutomaticRestart({\n      params: {\n        fs,\n        root,\n        settings\n      }\n    });\n    await startContainer(restart.container);\n    expect(isStarted(restart.container)).to.equal(true);\n    try {\n      let restartComplete = restart.restarted();\n      fs.writeFileSync('/package.json', `{}`);\n      triggerFSEvent(restart.container, fs, '/package.json', 'change');\n      await restartComplete;\n    } finally {\n      await restart.container.close();\n    }\n  });","file":"units/dev/restart.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Is able to restart on viteServer.restart API call","suites":["dev container restarts"],"updatePoint":{"line":160,"column":55,"index":5042},"line":160,"code":"  it('Is able to restart on viteServer.restart API call', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': ``\n    }, root);\n    const {\n      astroConfig\n    } = await openConfig({\n      cwd: root,\n      flags: {},\n      cmd: 'dev',\n      logging: defaultLogging\n    });\n    const settings = createSettings(astroConfig, fileURLToPath(root));\n    let restart = await createContainerWithAutomaticRestart({\n      params: {\n        fs,\n        root,\n        settings\n      }\n    });\n    await startContainer(restart.container);\n    expect(isStarted(restart.container)).to.equal(true);\n    try {\n      let restartComplete = restart.restarted();\n      await restart.container.viteServer.restart();\n      await restartComplete;\n    } finally {\n      await restart.container.close();\n    }\n  });","file":"units/dev/restart.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should sanitize dynamic tags","suites":["core/render components"],"updatePoint":{"line":9,"column":34,"index":468},"line":9,"code":"  it('should sanitize dynamic tags', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `\n\t\t\t\t---\n\t\t\t\tconst TagA = 'p style=color:red;'\n\t\t\t\tconst TagB = 'p><script id=\"pwnd\">console.log(\"pwnd\")</script>'\n\t\t\t\t---\n\t\t\t\t<html>\n\t\t\t\t\t<head><title>testing</title></head>\n\t\t\t\t\t<body>\n\t\t\t\t\t\t<TagA id=\"target\" />\n\t\t\t\t\t\t<TagB />\n\t\t\t\t\t</body>\n\t\t\t\t</html>\n\t\t\t`\n    }, root);\n    await runInContainer({\n      fs,\n      root,\n      logging: {\n        ...defaultLogging,\n        // Error is expected in this test\n        level: 'silent'\n      },\n      userConfig: {\n        integrations: [svelte()]\n      }\n    }, async container => {\n      const {\n        req,\n        res,\n        done,\n        text\n      } = createRequestAndResponse({\n        method: 'GET',\n        url: '/'\n      });\n      container.handle(req, res);\n      await done;\n      const html = await text();\n      const $ = cheerio.load(html);\n      const target = $('#target');\n      expect(target).not.to.be.undefined;\n      expect(target.attr('id')).to.equal('target');\n      expect(target.attr('style')).to.be.undefined;\n      expect($('#pwnd').length).to.equal(0);\n    });\n  });","file":"units/render/components.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Multi-level layouts and head injection, with explicit head","suites":["core/render","Injected head contents"],"updatePoint":{"line":18,"column":66,"index":744},"line":18,"code":"    it('Multi-level layouts and head injection, with explicit head', async () => {\n      const BaseLayout = createComponent((result, _props, slots) => {\n        return render`<html>\n\t\t\t\t\t<head>\n\t\t\t\t\t${renderSlot(result, slots['head'])}\n\t\t\t\t\t${renderHead(result)}\n\t\t\t\t\t</head>\n\t\t\t\t\t${maybeRenderHead(result)}\n\t\t\t\t\t<body>\n\t\t\t\t\t\t${renderSlot(result, slots['default'])}\n\t\t\t\t\t</body>\n\t\t\t\t</html>`;\n      });\n      const PageLayout = createComponent((result, _props, slots) => {\n        return render`${renderComponent(result, 'Layout', BaseLayout, {}, {\n          default: () => render`\n\t\t\t\t\t\t\t${maybeRenderHead(result)}\n\t\t\t\t\t\t\t<main>\n\t\t\t\t\t\t\t\t${renderSlot(result, slots['default'])}\n\t\t\t\t\t\t\t</main>\n\t\t\t\t\t\t`,\n          head: () => render`\n\t\t\t\t\t\t\t${renderComponent(result, 'Fragment', Fragment, {\n            slot: 'head'\n          }, {\n            default: () => render`${renderSlot(result, slots['head'])}`\n          })}\n\t\t\t\t\t\t`\n        })}\n\t\t\t\t`;\n      });\n      const Page = createComponent((result, _props) => {\n        return render`${renderComponent(result, 'PageLayout', PageLayout, {}, {\n          default: () => render`${maybeRenderHead(result)}<div>hello world</div>`,\n          head: () => render`\n\t\t\t\t\t\t${renderComponent(result, 'Fragment', Fragment, {\n            slot: 'head'\n          }, {\n            default: () => render`<meta charset=\"utf-8\">`\n          })}\n\t\t\t\t\t`\n        })}`;\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/'),\n        links: [{\n          name: 'link',\n          props: {\n            rel: 'stylesheet',\n            href: '/main.css'\n          },\n          children: ''\n        }]\n      });\n      const PageModule = createAstroModule(Page);\n      const response = await renderPage(PageModule, ctx, env);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('head link')).to.have.a.lengthOf(1);\n      expect($('body link')).to.have.a.lengthOf(0);\n    });","file":"units/render/head.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Multi-level layouts and head injection, without explicit head","suites":["core/render","Injected head contents"],"updatePoint":{"line":79,"column":69,"index":2723},"line":79,"code":"    it('Multi-level layouts and head injection, without explicit head', async () => {\n      const BaseLayout = createComponent((result, _props, slots) => {\n        return render`<html>\n\t\t\t\t\t${renderSlot(result, slots['head'])}\n\t\t\t\t\t${maybeRenderHead(result)}\n\t\t\t\t\t<body>\n\t\t\t\t\t\t${renderSlot(result, slots['default'])}\n\t\t\t\t\t</body>\n\t\t\t\t</html>`;\n      });\n      const PageLayout = createComponent((result, _props, slots) => {\n        return render`${renderComponent(result, 'Layout', BaseLayout, {}, {\n          default: () => render`\n\t\t\t\t\t\t\t${maybeRenderHead(result)}\n\t\t\t\t\t\t\t<main>\n\t\t\t\t\t\t\t\t${renderSlot(result, slots['default'])}\n\t\t\t\t\t\t\t</main>\n\t\t\t\t\t\t`,\n          head: () => render`\n\t\t\t\t\t\t\t${renderComponent(result, 'Fragment', Fragment, {\n            slot: 'head'\n          }, {\n            default: () => render`${renderSlot(result, slots['head'])}`\n          })}\n\t\t\t\t\t\t`\n        })}\n\t\t\t\t`;\n      });\n      const Page = createComponent((result, _props) => {\n        return render`${renderComponent(result, 'PageLayout', PageLayout, {}, {\n          default: () => render`${maybeRenderHead(result)}<div>hello world</div>`,\n          head: () => render`\n\t\t\t\t\t\t${renderComponent(result, 'Fragment', Fragment, {\n            slot: 'head'\n          }, {\n            default: () => render`<meta charset=\"utf-8\">`\n          })}\n\t\t\t\t\t`\n        })}`;\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/'),\n        links: [{\n          name: 'link',\n          props: {\n            rel: 'stylesheet',\n            href: '/main.css'\n          },\n          children: ''\n        }]\n      });\n      const PageModule = createAstroModule(Page);\n      const response = await renderPage(PageModule, ctx, env);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('head link')).to.have.a.lengthOf(1);\n      expect($('body link')).to.have.a.lengthOf(0);\n    });","file":"units/render/head.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Multi-level layouts and head injection, without any content in layouts","suites":["core/render","Injected head contents"],"updatePoint":{"line":137,"column":78,"index":4659},"line":137,"code":"    it('Multi-level layouts and head injection, without any content in layouts', async () => {\n      const BaseLayout = createComponent((result, _props, slots) => {\n        return render`${renderSlot(result, slots['default'])}`;\n      });\n      const PageLayout = createComponent((result, _props, slots) => {\n        return render`${renderComponent(result, 'Layout', BaseLayout, {}, {\n          default: () => render`${renderSlot(result, slots['default'])}\t`\n        })}\n\t\t\t\t`;\n      });\n      const Page = createComponent((result, _props) => {\n        return render`${renderComponent(result, 'PageLayout', PageLayout, {}, {\n          default: () => render`${maybeRenderHead(result)}<div>hello world</div>`\n        })}`;\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/'),\n        links: [{\n          name: 'link',\n          props: {\n            rel: 'stylesheet',\n            href: '/main.css'\n          },\n          children: ''\n        }]\n      });\n      const PageModule = createAstroModule(Page);\n      const response = await renderPage(PageModule, ctx, env);\n      const html = await response.text();\n      const $ = cheerio.load(html);\n      expect($('link')).to.have.a.lengthOf(1);\n    });","file":"units/render/head.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can render slots","suites":["core/render","Astro JSX components"],"updatePoint":{"line":20,"column":24,"index":888},"line":20,"code":"    it('Can render slots', async () => {\n      const Wrapper = createComponent((result, _props, slots = {}) => {\n        return render`<div>${renderSlot(result, slots['myslot'])}</div>`;\n      });\n      const Page = createAstroJSXComponent(() => {\n        return jsx(Wrapper, {\n          children: [jsx('p', {\n            slot: 'myslot',\n            className: 'n',\n            children: 'works'\n          })]\n        });\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/')\n      });\n      const response = await renderPage(createAstroModule(Page), ctx, env);\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      expect(html).to.include('<div><p class=\"n\">works</p></div>');\n    });","file":"units/render/jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can render slots with a dash in the name","suites":["core/render","Astro JSX components"],"updatePoint":{"line":41,"column":48,"index":1685},"line":41,"code":"    it('Can render slots with a dash in the name', async () => {\n      const Wrapper = createComponent((result, _props, slots = {}) => {\n        return render`<div>${renderSlot(result, slots['my-slot'])}</div>`;\n      });\n      const Page = createAstroJSXComponent(() => {\n        return jsx('main', {\n          children: [jsx(Wrapper, {\n            // Children as an array\n            children: [jsx('p', {\n              slot: 'my-slot',\n              className: 'n',\n              children: 'works'\n            })]\n          }), jsx(Wrapper, {\n            // Children as a VNode\n            children: jsx('p', {\n              slot: 'my-slot',\n              className: 'p',\n              children: 'works'\n            })\n          })]\n        });\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/')\n      });\n      const response = await renderPage(createAstroModule(Page), ctx, env);\n      expect(response.status).to.equal(200);\n      const html = await response.text();\n      expect(html).to.include('<main><div><p class=\"n\">works</p></div><div><p class=\"p\">works</p></div></main>');\n    });","file":"units/render/jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Errors in JSX components are raised","suites":["core/render","Astro JSX components"],"updatePoint":{"line":72,"column":43,"index":2825},"line":72,"code":"    it('Errors in JSX components are raised', async () => {\n      const Component = createAstroJSXComponent(() => {\n        throw new Error('uh oh');\n      });\n      const Page = createComponent((result, _props) => {\n        return render`<div>${renderComponent(result, 'Component', Component, {})}</div>`;\n      });\n      const ctx = createRenderContext({\n        request: new Request('http://example.com/')\n      });\n      const response = await renderPage(createAstroModule(Page), ctx, env);\n      try {\n        await response.text();\n        expect(false).to.equal(true, 'should not have been successful');\n      } catch (err) {\n        expect(err.message).to.equal('uh oh');\n      }\n    });","file":"units/render/jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"using trailingSlash: \"never\" does not match the index route when it contains a trailing slash","suites":["routing - createRouteManifest"],"updatePoint":{"line":8,"column":99,"index":491},"line":8,"code":"  it('using trailingSlash: \"never\" does not match the index route when it contains a trailing slash', async () => {\n    const fs = createFs({\n      '/src/pages/index.astro': `<h1>test</h1>`\n    }, root);\n    const settings = await createDefaultDevSettings({\n      base: '/search',\n      trailingSlash: 'never'\n    }, root);\n    const manifest = createRouteManifest({\n      cwd: fileURLToPath(root),\n      settings,\n      fsMod: fs\n    });\n    const [{\n      pattern\n    }] = manifest.routes;\n    expect(pattern.test('')).to.equal(true);\n    expect(pattern.test('/')).to.equal(false);\n  });","file":"units/routing/manifest.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"uses the bundles themes for built-in themes","suites":["<Code />","Shiki - getHighlighterOptions"],"updatePoint":{"line":20,"column":51,"index":721},"line":20,"code":"    it('uses the bundles themes for built-in themes', async () => {\n      const {\n        resolveHighlighterOptions\n      } = mod;\n      const opts = await resolveHighlighterOptions({\n        theme: 'css-variables'\n      });\n      const themes = opts.themes;\n      expect(themes).to.have.a.lengthOf(1);\n      expect(themes[0]).to.be.an('object');\n    });","file":"units/shiki/shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"uses the string theme name for custom themes","suites":["<Code />","Shiki - getHighlighterOptions"],"updatePoint":{"line":31,"column":52,"index":1077},"line":31,"code":"    it('uses the string theme name for custom themes', async () => {\n      const {\n        resolveHighlighterOptions\n      } = mod;\n      const opts = await resolveHighlighterOptions({\n        theme: 'some-custom-theme'\n      });\n      const themes = opts.themes;\n      expect(themes).to.have.a.lengthOf(1);\n      expect(themes[0]).to.be.an('string');\n      expect(themes[0]).to.equal('some-custom-theme');\n    });","file":"units/shiki/shiki.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"calls the onError method when an error occurs in the handler","suites":["vite-plugin-astro-server","controller"],"updatePoint":{"line":6,"column":68,"index":358},"line":6,"code":"    it('calls the onError method when an error occurs in the handler', async () => {\n      const controller = createController({\n        loader: createLoader()\n      });\n      let error = undefined;\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        run() {\n          throw new Error('oh no');\n        },\n        onError(err) {\n          error = err;\n        }\n      });\n      expect(error).to.not.be.an('undefined');\n      expect(error).to.be.an.instanceOf(Error);\n    });","file":"units/vite-plugin-astro-server/controller.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"sets the state to error when an error occurs in the handler","suites":["vite-plugin-astro-server","controller"],"updatePoint":{"line":24,"column":67,"index":866},"line":24,"code":"    it('sets the state to error when an error occurs in the handler', async () => {\n      const controller = createController({\n        loader: createLoader()\n      });\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        run() {\n          throw new Error('oh no');\n        },\n        onError() {}\n      });\n      expect(controller.state.state).to.equal('error');\n    });","file":"units/vite-plugin-astro-server/controller.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"calls reload when a file change occurs when in an error state","suites":["vite-plugin-astro-server","controller"],"updatePoint":{"line":38,"column":69,"index":1273},"line":38,"code":"    it('calls reload when a file change occurs when in an error state', async () => {\n      let reloads = 0;\n      const loader = createLoader({\n        eachModule() {},\n        clientReload() {\n          reloads++;\n        }\n      });\n      const controller = createController({\n        loader\n      });\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(0);\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        run() {\n          throw new Error('oh no');\n        },\n        onError() {}\n      });\n      expect(reloads).to.equal(0);\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(1);\n    });","file":"units/vite-plugin-astro-server/controller.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"does not call reload on file change if not in an error state","suites":["vite-plugin-astro-server","controller"],"updatePoint":{"line":63,"column":68,"index":1944},"line":63,"code":"    it('does not call reload on file change if not in an error state', async () => {\n      let reloads = 0;\n      const loader = createLoader({\n        eachModule() {},\n        clientReload() {\n          reloads++;\n        }\n      });\n      const controller = createController({\n        loader\n      });\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(0);\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        run() {\n          throw new Error('oh no');\n        },\n        onError() {}\n      });\n      expect(reloads).to.equal(0);\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(1);\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(2);\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        // No error here\n        run() {}\n      });\n      loader.events.emit('file-change');\n      expect(reloads).to.equal(2);\n    });","file":"units/vite-plugin-astro-server/controller.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Invalidates broken modules when a change occurs in an error state","suites":["vite-plugin-astro-server","controller"],"updatePoint":{"line":98,"column":73,"index":2902},"line":98,"code":"    it('Invalidates broken modules when a change occurs in an error state', async () => {\n      const mods = [{\n        id: 'one',\n        ssrError: new Error('one')\n      }, {\n        id: 'two',\n        ssrError: null\n      }, {\n        id: 'three',\n        ssrError: new Error('three')\n      }];\n      const loader = createLoader({\n        eachModule(cb) {\n          return mods.forEach(cb);\n        },\n        invalidateModule(mod) {\n          mod.ssrError = null;\n        }\n      });\n      const controller = createController({\n        loader\n      });\n      await runWithErrorHandling({\n        controller,\n        pathname: '/',\n        run() {\n          throw new Error('oh no');\n        },\n        onError() {}\n      });\n      loader.events.emit('file-change');\n      expect(mods).to.deep.equal([{\n        id: 'one',\n        ssrError: null\n      }, {\n        id: 'two',\n        ssrError: null\n      }, {\n        id: 'three',\n        ssrError: null\n      }]);\n    });","file":"units/vite-plugin-astro-server/controller.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"renders a request","suites":["vite-plugin-astro-server","request"],"updatePoint":{"line":23,"column":25,"index":1071},"line":23,"code":"    it('renders a request', async () => {\n      const env = await createDevEnvironment({\n        loader: createLoader({\n          import() {\n            const Page = createComponent(() => {\n              return render`<div id=\"test\">testing</div>`;\n            });\n            return createAstroModule(Page);\n          }\n        })\n      });\n      const controller = createController({\n        loader: env.loader\n      });\n      const {\n        req,\n        res,\n        text\n      } = createRequestAndResponse();\n      const fs = createFs({\n        // Note that the content doesn't matter here because we are using a custom loader.\n        '/src/pages/index.astro': ''\n      }, '/');\n      const manifest = createRouteManifest({\n        fsMod: fs,\n        settings: env.settings\n      }, logging);\n      try {\n        await handleRequest(env, manifest, controller, req, res);\n      } catch (err) {\n        expect(err.message).to.be.undefined();\n      }\n      const html = await text();\n      expect(res.statusCode).to.equal(200);\n      expect(html).to.include('<div id=\"test\">');\n    });","file":"units/vite-plugin-astro-server/request.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should compile a single file","suites":["astro full compile"],"updatePoint":{"line":32,"column":34,"index":742},"line":32,"code":"  it('should compile a single file', async () => {\n    const result = await compile(`<h1>Hello World</h1>`, '/src/components/index.astro');\n    expect(result.code).to.be.ok;\n  });","file":"units/vite-plugin-astro/compile.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should compile typescript","suites":["astro full compile"],"updatePoint":{"line":36,"column":31,"index":919},"line":36,"code":"  it('should compile typescript', async () => {\n    const result = await compile(`\\\n---\nconst name: string = 'world'\n---\n\n<h1>Hello {name}</h1>`, '/src/components/index.astro');\n    expect(result.code).to.be.ok;\n  });","file":"units/vite-plugin-astro/compile.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should error on invalid js","suites":["astro full compile"],"updatePoint":{"line":45,"column":32,"index":1138},"line":45,"code":"  it('should error on invalid js', async () => {\n    let result;\n    try {\n      result = await compile(`\\\n---\nconst name = 'world\n---\n\n<h1>Hello {name}</h1>`, '/src/components/index.astro');\n    } catch (e) {\n      expect(e.message).to.include('Unterminated string literal');\n    }\n    expect(result).to.be.undefined;\n  });","file":"units/vite-plugin-astro/compile.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"injects hmr code","suites":["astro full compile"],"updatePoint":{"line":59,"column":22,"index":1453},"line":59,"code":"  it('injects hmr code', async () => {\n    const result = await compile(`<h1>Hello World</h1>`, '/src/components/index.astro');\n    expect(result.code).to.include('import.meta.hot');\n  });","file":"units/vite-plugin-astro/compile.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"has file and url exports for markdwon compat","suites":["astro full compile"],"updatePoint":{"line":63,"column":50,"index":1670},"line":63,"code":"  it('has file and url exports for markdwon compat', async () => {\n    const result = await compile(`<h1>Hello World</h1>`, '/src/components/index.astro');\n    await init;\n    const [, exports] = parse(result.code);\n    const names = exports.map(e => e.n);\n    expect(names).to.include('default');\n    expect(names).to.include('file');\n    expect(names).to.include('url');\n  });","file":"units/vite-plugin-astro/compile.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"should return empty object","suites":["astro scan"],"updatePoint":{"line":4,"column":32,"index":161},"line":4,"code":"  it('should return empty object', async () => {\n    const result = await scan(`export {}`, '/src/components/index.astro');\n    expect(Object.keys(result).length).to.equal(0);\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"recognizes constant boolean literal (false)","suites":["astro scan"],"updatePoint":{"line":8,"column":49,"index":360},"line":8,"code":"  it('recognizes constant boolean literal (false)', async () => {\n    const result = await scan(`export const prerender = true;`, '/src/components/index.astro');\n    expect(result.prerender).to.equal(true);\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"recognizes constant boolean literal (false)","suites":["astro scan"],"updatePoint":{"line":12,"column":49,"index":573},"line":12,"code":"  it('recognizes constant boolean literal (false)', async () => {\n    const result = await scan(`export const prerender = false;`, '/src/components/index.astro');\n    expect(result.prerender).to.equal(false);\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on let boolean literal","suites":["astro scan"],"updatePoint":{"line":16,"column":35,"index":774},"line":16,"code":"  it('throws on let boolean literal', async () => {\n    try {\n      const result = await scan(`export let prerender = true;`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on var boolean literal","suites":["astro scan"],"updatePoint":{"line":25,"column":35,"index":1162},"line":25,"code":"  it('throws on var boolean literal', async () => {\n    try {\n      const result = await scan(`export var prerender = true;`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on unknown values I","suites":["astro scan"],"updatePoint":{"line":34,"column":32,"index":1547},"line":34,"code":"  it('throws on unknown values I', async () => {\n    try {\n      const result = await scan(`export const prerender = !!value;`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on unknown values II","suites":["astro scan"],"updatePoint":{"line":43,"column":33,"index":1938},"line":43,"code":"  it('throws on unknown values II', async () => {\n    try {\n      const result = await scan(`export const prerender = value;`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on unknown values III","suites":["astro scan"],"updatePoint":{"line":52,"column":34,"index":2328},"line":52,"code":"  it('throws on unknown values III', async () => {\n    try {\n      const result = await scan(`export let prerender = undefined; prerender = true;`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"throws on unknown values IV","suites":["astro scan"],"updatePoint":{"line":61,"column":33,"index":2737},"line":61,"code":"  it('throws on unknown values IV', async () => {\n    try {\n      const result = await scan(`let prerender = true; export { prerender }`, '/src/components/index.astro');\n      expect(false).to.be.true;\n    } catch (e) {\n      expect(e.errorCode).to.equal(3019);\n      expect(e.message).to.contain(`A \\`prerender\\` export has been detected, but its value cannot be statically analyzed.`);\n    }\n  });","file":"units/vite-plugin-scanner/scan.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"is able to build with the slot missing","suites":["Unused slot"],"updatePoint":{"line":12,"column":44,"index":342},"line":12,"code":"  it('is able to build with the slot missing', async () => {\n    let html = await fixture.readFile('/index.html');\n    let $ = cheerio.load(html);\n    // No children, slot rendered as empty\n    expect($('body p').children().length).to.equal(0);\n  });","file":"unused-slot.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Vue","suites":["Vue component","build"],"updatePoint":{"line":15,"column":20,"index":396},"line":15,"code":"    it('Can load Vue', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const allPreValues = $('pre').toArray().map(el => $(el).text());\n\n      // test 1: renders all components correctly\n      expect(allPreValues).to.deep.equal(['0', '1', '1', '1', '10', '100', '1000']);\n\n      // test 2: renders 3 <astro-island>s\n      expect($('astro-island')).to.have.lengthOf(6);\n\n      // test 3: all <astro-island>s have uid attributes\n      expect($('astro-island[uid]')).to.have.lengthOf(6);\n\n      // test 4: treats <my-button> as a custom element\n      expect($('my-button')).to.have.lengthOf(7);\n\n      // test 5: components with identical render output and props have been deduplicated\n      const uniqueRootUIDs = $('astro-island').map((i, el) => $(el).attr('uid'));\n      expect(new Set(uniqueRootUIDs).size).to.equal(5);\n\n      // test 6: import public files work\n      expect($('#vue-img')).to.be.ok;\n    });","file":"vue-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"scripts proxy correctly","suites":["Vue component","dev"],"updatePoint":{"line":49,"column":31,"index":1604},"line":49,"code":"    it('scripts proxy correctly', async () => {\n      const html = await fixture.fetch('/').then(res => res.text());\n      const $ = cheerio.load(html);\n      for (const script of $('script').toArray()) {\n        const {\n          src\n        } = script.attribs;\n        if (!src) continue;\n        expect((await fixture.fetch(src)).status, `404: ${src}`).to.equal(200);\n      }\n    });","file":"vue-component.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"Can load Vue JSX","suites":["Vue JSX","build"],"updatePoint":{"line":15,"column":24,"index":377},"line":15,"code":"    it('Can load Vue JSX', async () => {\n      const html = await fixture.readFile('/index.html');\n      const $ = cheerio.load(html);\n      const allPreValues = $('pre').toArray().map(el => $(el).text());\n      expect(allPreValues).to.deep.equal(['2345', '0', '1', '1', '1', '10', '100', '1000']);\n    });","file":"vue-jsx.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"builds with another renderer present","suites":["Vue with multi-renderer"],"updatePoint":{"line":11,"column":42,"index":337},"line":11,"code":"  it('builds with another renderer present', async () => {\n    try {\n      await fixture.build();\n    } catch (e) {\n      expect(e).to.equal(undefined, `Should not throw`);\n    }\n  });","file":"vue-with-multi-renderer.test.js","skipped":false,"dir":"packages/astro/test"},{"name":"no arguments","suites":["context"],"updatePoint":{"line":5,"column":18,"index":151},"line":5,"code":"  it('no arguments', async () => {\n    const ctx = await getContext([]);\n    expect(ctx.projectName).to.be.undefined;\n    expect(ctx.template).to.be.undefined;\n    expect(ctx.skipHouston).to.eq(os.platform() === 'win32');\n    expect(ctx.dryRun).to.be.undefined;\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"project name","suites":["context"],"updatePoint":{"line":12,"column":18,"index":419},"line":12,"code":"  it('project name', async () => {\n    const ctx = await getContext(['foobar']);\n    expect(ctx.projectName).to.eq('foobar');\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"template","suites":["context"],"updatePoint":{"line":16,"column":14,"index":547},"line":16,"code":"  it('template', async () => {\n    const ctx = await getContext(['--template', 'minimal']);\n    expect(ctx.template).to.eq('minimal');\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"skip houston (explicit)","suites":["context"],"updatePoint":{"line":20,"column":29,"index":703},"line":20,"code":"  it('skip houston (explicit)', async () => {\n    const ctx = await getContext(['--skip-houston']);\n    expect(ctx.skipHouston).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"skip houston (yes)","suites":["context"],"updatePoint":{"line":24,"column":24,"index":845},"line":24,"code":"  it('skip houston (yes)', async () => {\n    const ctx = await getContext(['-y']);\n    expect(ctx.skipHouston).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"skip houston (no)","suites":["context"],"updatePoint":{"line":28,"column":23,"index":974},"line":28,"code":"  it('skip houston (no)', async () => {\n    const ctx = await getContext(['-n']);\n    expect(ctx.skipHouston).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"skip houston (install)","suites":["context"],"updatePoint":{"line":32,"column":28,"index":1108},"line":32,"code":"  it('skip houston (install)', async () => {\n    const ctx = await getContext(['--install']);\n    expect(ctx.skipHouston).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"dry run","suites":["context"],"updatePoint":{"line":36,"column":13,"index":1234},"line":36,"code":"  it('dry run', async () => {\n    const ctx = await getContext(['--dry-run']);\n    expect(ctx.dryRun).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"install","suites":["context"],"updatePoint":{"line":40,"column":13,"index":1355},"line":40,"code":"  it('install', async () => {\n    const ctx = await getContext(['--install']);\n    expect(ctx.install).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"no install","suites":["context"],"updatePoint":{"line":44,"column":16,"index":1480},"line":44,"code":"  it('no install', async () => {\n    const ctx = await getContext(['--no-install']);\n    expect(ctx.install).to.eq(false);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"git","suites":["context"],"updatePoint":{"line":48,"column":9,"index":1602},"line":48,"code":"  it('git', async () => {\n    const ctx = await getContext(['--git']);\n    expect(ctx.git).to.eq(true);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"no git","suites":["context"],"updatePoint":{"line":52,"column":12,"index":1715},"line":52,"code":"  it('no git', async () => {\n    const ctx = await getContext(['--no-git']);\n    expect(ctx.git).to.eq(false);\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"typescript","suites":["context"],"updatePoint":{"line":56,"column":16,"index":1836},"line":56,"code":"  it('typescript', async () => {\n    const ctx = await getContext(['--typescript', 'strict']);\n    expect(ctx.typescript).to.eq('strict');\n  });","file":"context.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"--yes","suites":["dependencies"],"updatePoint":{"line":6,"column":11,"index":188},"line":6,"code":"  it('--yes', async () => {\n    const context = {\n      cwd: '',\n      yes: true,\n      pkgManager: 'npm',\n      dryRun: true,\n      prompt: () => ({\n        deps: true\n      })\n    };\n    await dependencies(context);\n    expect(fixture.hasMessage('Skipping dependency installation')).to.be.true;\n  });","file":"dependencies.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"prompt yes","suites":["dependencies"],"updatePoint":{"line":19,"column":16,"index":496},"line":19,"code":"  it('prompt yes', async () => {\n    const context = {\n      cwd: '',\n      pkgManager: 'npm',\n      dryRun: true,\n      prompt: () => ({\n        deps: true\n      }),\n      install: undefined\n    };\n    await dependencies(context);\n    expect(fixture.hasMessage('Skipping dependency installation')).to.be.true;\n    expect(context.install).to.eq(true);\n  });","file":"dependencies.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"prompt no","suites":["dependencies"],"updatePoint":{"line":33,"column":15,"index":853},"line":33,"code":"  it('prompt no', async () => {\n    const context = {\n      cwd: '',\n      pkgManager: 'npm',\n      dryRun: true,\n      prompt: () => ({\n        deps: false\n      }),\n      install: undefined\n    };\n    await dependencies(context);\n    expect(fixture.hasMessage('Skipping dependency installation')).to.be.true;\n    expect(context.install).to.eq(false);\n  });","file":"dependencies.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"--install","suites":["dependencies"],"updatePoint":{"line":47,"column":15,"index":1212},"line":47,"code":"  it('--install', async () => {\n    const context = {\n      cwd: '',\n      install: true,\n      pkgManager: 'npm',\n      dryRun: true,\n      prompt: () => ({\n        deps: false\n      })\n    };\n    await dependencies(context);\n    expect(fixture.hasMessage('Skipping dependency installation')).to.be.true;\n    expect(context.install).to.eq(true);\n  });","file":"dependencies.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"--no-install","suites":["dependencies"],"updatePoint":{"line":61,"column":18,"index":1568},"line":61,"code":"  it('--no-install', async () => {\n    const context = {\n      cwd: '',\n      install: false,\n      pkgManager: 'npm',\n      dryRun: true,\n      prompt: () => ({\n        deps: false\n      })\n    };\n    await dependencies(context);\n    expect(fixture.hasMessage('Skipping dependency installation')).to.be.true;\n    expect(context.install).to.eq(false);\n  });","file":"dependencies.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"none","suites":["git"],"updatePoint":{"line":8,"column":10,"index":221},"line":8,"code":"  it('none', async () => {\n    const context = {\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        git: false\n      })\n    };\n    await git(context);\n    expect(fixture.hasMessage('Skipping Git initialization')).to.be.true;\n  });","file":"git.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"already initialized","suites":["git"],"updatePoint":{"line":19,"column":25,"index":482},"line":19,"code":"  it('already initialized', async () => {\n    const context = {\n      git: true,\n      cwd: './test/fixtures/not-empty',\n      dryRun: true,\n      prompt: () => ({\n        git: false\n      })\n    };\n    await execa('git', ['init'], {\n      cwd: './test/fixtures/not-empty'\n    });\n    await git(context);\n    expect(fixture.hasMessage('Git has already been initialized')).to.be.true;\n\n    // Cleanup\n    fs.rmSync('./test/fixtures/not-empty/.git', {\n      recursive: true,\n      force: true\n    });\n  });","file":"git.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"yes (--dry-run)","suites":["git"],"updatePoint":{"line":40,"column":21,"index":983},"line":40,"code":"  it('yes (--dry-run)', async () => {\n    const context = {\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        git: true\n      })\n    };\n    await git(context);\n    expect(fixture.hasMessage('Skipping Git initialization')).to.be.true;\n  });","file":"git.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"no (--dry-run)","suites":["git"],"updatePoint":{"line":51,"column":20,"index":1238},"line":51,"code":"  it('no (--dry-run)', async () => {\n    const context = {\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        git: false\n      })\n    };\n    await git(context);\n    expect(fixture.hasMessage('Skipping Git initialization')).to.be.true;\n  });","file":"git.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"no arguments","suites":["intro"],"updatePoint":{"line":6,"column":18,"index":181},"line":6,"code":"  it('no arguments', async () => {\n    await intro({\n      skipHouston: false,\n      version: '0.0.0',\n      username: 'user'\n    });\n    expect(fixture.hasMessage('Houston:')).to.be.true;\n    expect(fixture.hasMessage('Welcome to  astro  v0.0.0')).to.be.true;\n  });","file":"intro.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"--skip-houston","suites":["intro"],"updatePoint":{"line":15,"column":20,"index":450},"line":15,"code":"  it('--skip-houston', async () => {\n    await intro({\n      skipHouston: true,\n      version: '0.0.0',\n      username: 'user'\n    });\n    expect(fixture.length()).to.eq(1);\n    expect(fixture.hasMessage('Houston:')).to.be.false;\n    expect(fixture.hasMessage('Launch sequence initiated')).to.be.true;\n  });","file":"intro.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"no arguments","suites":["next steps"],"updatePoint":{"line":6,"column":18,"index":185},"line":6,"code":"  it('no arguments', async () => {\n    await next({\n      skipHouston: false,\n      cwd: './it/fixtures/not-empty',\n      pkgManager: 'npm'\n    });\n    expect(fixture.hasMessage('Liftoff confirmed.')).to.be.true;\n    expect(fixture.hasMessage('npm run dev')).to.be.true;\n    expect(fixture.hasMessage('Good luck out there, astronaut!')).to.be.true;\n  });","file":"next.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"--skip-houston","suites":["next steps"],"updatePoint":{"line":16,"column":20,"index":542},"line":16,"code":"  it('--skip-houston', async () => {\n    await next({\n      skipHouston: true,\n      cwd: './it/fixtures/not-empty',\n      pkgManager: 'npm'\n    });\n    expect(fixture.hasMessage('Good luck out there, astronaut!')).to.be.false;\n  });","file":"next.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"pass in name","suites":["project name"],"updatePoint":{"line":6,"column":18,"index":194},"line":6,"code":"  it('pass in name', async () => {\n    const context = {\n      projectName: '',\n      cwd: './foo/bar/baz',\n      prompt: () => {}\n    };\n    await projectName(context);\n    expect(context.cwd).to.eq('./foo/bar/baz');\n    expect(context.projectName).to.eq('baz');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"dot","suites":["project name"],"updatePoint":{"line":16,"column":9,"index":455},"line":16,"code":"  it('dot', async () => {\n    const context = {\n      projectName: '',\n      cwd: '.',\n      prompt: () => ({\n        name: 'foobar'\n      })\n    };\n    await projectName(context);\n    expect(fixture.hasMessage('\".\" is not empty!')).to.be.true;\n    expect(context.projectName).to.eq('foobar');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"dot slash","suites":["project name"],"updatePoint":{"line":28,"column":15,"index":761},"line":28,"code":"  it('dot slash', async () => {\n    const context = {\n      projectName: '',\n      cwd: './',\n      prompt: () => ({\n        name: 'foobar'\n      })\n    };\n    await projectName(context);\n    expect(fixture.hasMessage('\"./\" is not empty!')).to.be.true;\n    expect(context.projectName).to.eq('foobar');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"empty","suites":["project name"],"updatePoint":{"line":40,"column":11,"index":1065},"line":40,"code":"  it('empty', async () => {\n    const context = {\n      projectName: '',\n      cwd: './test/fixtures/empty',\n      prompt: () => ({\n        name: 'foobar'\n      })\n    };\n    await projectName(context);\n    expect(fixture.hasMessage('\"./test/fixtures/empty\" is not empty!')).to.be.false;\n    expect(context.projectName).to.eq('empty');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"not empty","suites":["project name"],"updatePoint":{"line":52,"column":15,"index":1411},"line":52,"code":"  it('not empty', async () => {\n    const context = {\n      projectName: '',\n      cwd: './test/fixtures/not-empty',\n      prompt: () => ({\n        name: 'foobar'\n      })\n    };\n    await projectName(context);\n    expect(fixture.hasMessage('\"./test/fixtures/not-empty\" is not empty!')).to.be.true;\n    expect(context.projectName).to.eq('foobar');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"basic","suites":["project name"],"updatePoint":{"line":64,"column":11,"index":1761},"line":64,"code":"  it('basic', async () => {\n    const context = {\n      projectName: '',\n      cwd: '',\n      prompt: () => ({\n        name: 'foobar'\n      })\n    };\n    await projectName(context);\n    expect(context.cwd).to.eq('foobar');\n    expect(context.projectName).to.eq('foobar');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"normalize","suites":["project name"],"updatePoint":{"line":76,"column":15,"index":2043},"line":76,"code":"  it('normalize', async () => {\n    const context = {\n      projectName: '',\n      cwd: '',\n      prompt: () => ({\n        name: 'Invalid Name'\n      })\n    };\n    await projectName(context);\n    expect(context.cwd).to.eq('Invalid Name');\n    expect(context.projectName).to.eq('invalid-name');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"remove leading/trailing dashes","suites":["project name"],"updatePoint":{"line":88,"column":36,"index":2364},"line":88,"code":"  it('remove leading/trailing dashes', async () => {\n    const context = {\n      projectName: '',\n      cwd: '',\n      prompt: () => ({\n        name: '(invalid)'\n      })\n    };\n    await projectName(context);\n    expect(context.projectName).to.eq('invalid');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"handles scoped packages","suites":["project name"],"updatePoint":{"line":99,"column":29,"index":2623},"line":99,"code":"  it('handles scoped packages', async () => {\n    const context = {\n      projectName: '',\n      cwd: '',\n      prompt: () => ({\n        name: '@astro/site'\n      })\n    };\n    await projectName(context);\n    expect(context.cwd).to.eq('@astro/site');\n    expect(context.projectName).to.eq('@astro/site');\n  });","file":"project-name.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"none","suites":["template"],"updatePoint":{"line":6,"column":10,"index":179},"line":6,"code":"  it('none', async () => {\n    const context = {\n      template: '',\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        template: 'blog'\n      })\n    };\n    await template(context);\n    expect(fixture.hasMessage('Skipping template copying')).to.be.true;\n    expect(context.template).to.eq('blog');\n  });","file":"template.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"minimal (--dry-run)","suites":["template"],"updatePoint":{"line":19,"column":25,"index":513},"line":19,"code":"  it('minimal (--dry-run)', async () => {\n    const context = {\n      template: 'minimal',\n      cwd: '',\n      dryRun: true,\n      prompt: () => {}\n    };\n    await template(context);\n    expect(fixture.hasMessage('Using minimal as project template')).to.be.true;\n  });","file":"template.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"basics (--dry-run)","suites":["template"],"updatePoint":{"line":29,"column":24,"index":783},"line":29,"code":"  it('basics (--dry-run)', async () => {\n    const context = {\n      template: 'basics',\n      cwd: '',\n      dryRun: true,\n      prompt: () => {}\n    };\n    await template(context);\n    expect(fixture.hasMessage('Using basics as project template')).to.be.true;\n  });","file":"template.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"blog (--dry-run)","suites":["template"],"updatePoint":{"line":39,"column":22,"index":1049},"line":39,"code":"  it('blog (--dry-run)', async () => {\n    const context = {\n      template: 'blog',\n      cwd: '',\n      dryRun: true,\n      prompt: () => {}\n    };\n    await template(context);\n    expect(fixture.hasMessage('Using blog as project template')).to.be.true;\n  });","file":"template.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"none","suites":["typescript"],"updatePoint":{"line":8,"column":10,"index":268},"line":8,"code":"  it('none', async () => {\n    const context = {\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict',\n        useTs: true\n      })\n    };\n    await typescript(context);\n    expect(fixture.hasMessage('Skipping TypeScript setup')).to.be.true;\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"use false","suites":["typescript"],"updatePoint":{"line":20,"column":15,"index":547},"line":20,"code":"  it('use false', async () => {\n    const context = {\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict',\n        useTs: false\n      })\n    };\n    await typescript(context);\n    expect(fixture.hasMessage('No worries')).to.be.true;\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"strict","suites":["typescript"],"updatePoint":{"line":32,"column":12,"index":809},"line":32,"code":"  it('strict', async () => {\n    const context = {\n      typescript: 'strict',\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict'\n      })\n    };\n    await typescript(context);\n    expect(fixture.hasMessage('Using strict TypeScript configuration')).to.be.true;\n    expect(fixture.hasMessage('Skipping TypeScript setup')).to.be.true;\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"default","suites":["typescript"],"updatePoint":{"line":45,"column":13,"index":1177},"line":45,"code":"  it('default', async () => {\n    const context = {\n      typescript: 'default',\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict'\n      })\n    };\n    await typescript(context);\n    expect(fixture.hasMessage('Using default TypeScript configuration')).to.be.true;\n    expect(fixture.hasMessage('Skipping TypeScript setup')).to.be.true;\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"relaxed","suites":["typescript"],"updatePoint":{"line":58,"column":13,"index":1547},"line":58,"code":"  it('relaxed', async () => {\n    const context = {\n      typescript: 'relaxed',\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict'\n      })\n    };\n    await typescript(context);\n    expect(fixture.hasMessage('Using relaxed TypeScript configuration')).to.be.true;\n    expect(fixture.hasMessage('Skipping TypeScript setup')).to.be.true;\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"other","suites":["typescript"],"updatePoint":{"line":71,"column":11,"index":1915},"line":71,"code":"  it('other', async () => {\n    const context = {\n      typescript: 'other',\n      cwd: '',\n      dryRun: true,\n      prompt: () => ({\n        ts: 'strict'\n      }),\n      exit(code) {\n        throw code;\n      }\n    };\n    let err = null;\n    try {\n      await typescript(context);\n    } catch (e) {\n      err = e;\n    }\n    expect(err).to.eq(1);\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"none","suites":["typescript: setup"],"updatePoint":{"line":93,"column":10,"index":2310},"line":93,"code":"  it('none', async () => {\n    const root = new URL('./fixtures/empty/', import.meta.url);\n    const tsconfig = new URL('./tsconfig.json', root);\n    await setupTypeScript('strict', {\n      cwd: fileURLToPath(root)\n    });\n    expect(JSON.parse(fs.readFileSync(tsconfig, {\n      encoding: 'utf-8'\n    }))).to.deep.eq({\n      extends: 'astro/tsconfigs/strict'\n    });\n    fs.rmSync(tsconfig);\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"},{"name":"exists","suites":["typescript: setup"],"updatePoint":{"line":106,"column":12,"index":2710},"line":106,"code":"  it('exists', async () => {\n    const root = new URL('./fixtures/not-empty/', import.meta.url);\n    const tsconfig = new URL('./tsconfig.json', root);\n    await setupTypeScript('strict', {\n      cwd: fileURLToPath(root)\n    });\n    expect(JSON.parse(fs.readFileSync(tsconfig, {\n      encoding: 'utf-8'\n    }))).to.deep.eq({\n      extends: 'astro/tsconfigs/strict'\n    });\n    fs.writeFileSync(tsconfig, `{}`);\n  });","file":"typescript.test.js","skipped":false,"dir":"packages/create-astro/test"}]}