{"repo":"supabase/supabase","url":"https://github.com/supabase/supabase","branch":"master","configs":[{"lang":"js","dir":"examples/sveltejs-todo-list/tests","framework":"jest","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"},{"package":"supabase","lang":"js","dir":"tests","framework":"jest","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"},{"package":"studio","lang":"ts","dir":"studio/tests","framework":"jest","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"it should create new todo","suites":["New todo"],"updatePoint":{"line":2,"column":31,"index":61},"line":2,"code":"  it('it should create new todo', () => {\n    cy.visit('/');\n    cy.contains('h1', 'todos');\n    cy.get('.new-todo').type('Demo').type('{enter}');\n    cy.get('.main .todo-list .view').contains('Demo');\n  });","file":"e2e/new-todo.spec.js","skipped":false,"dir":"examples/sveltejs-todo-list/tests"},{"name":"Unauthorized","suites":[],"updatePoint":{"line":6,"column":18,"index":352},"line":6,"code":"test('Unauthorized', async () => {\n  const {\n    error\n  } = await unauthorized.from('profiles').select();\n  expect(error.message).toBe('Invalid authentication credentials');\n});","file":"integration/index.test.ts","skipped":false,"dir":"tests"},{"name":"Simple test","suites":[],"updatePoint":{"line":12,"column":17,"index":530},"line":12,"code":"test('Simple test', async () => {\n  const fakeOne = {\n    email: faker.internet.email().toLowerCase(),\n    password: faker.internet.password(),\n    username: faker.internet.userName()\n  };\n  const fakeTwo = {\n    email: faker.internet.email().toLowerCase(),\n    password: faker.internet.password(),\n    username: faker.internet.userName()\n  };\n  const first = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY_ANON);\n  const second = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_KEY_ANON);\n  const {\n    user: firstUser\n  } = await first.auth.signUp({\n    email: fakeOne.email,\n    password: fakeOne.password\n  });\n  const {\n    user: secondUser\n  } = await second.auth.signUp({\n    email: fakeTwo.email,\n    password: fakeTwo.password\n  });\n  expect(firstUser.email).toEqual(fakeOne.email);\n  expect(secondUser.email).toEqual(fakeTwo.email);\n  const {\n    data: firstProfile\n  } = await first.from('profiles').insert({\n    id: firstUser.id,\n    username: fakeOne.username\n  }).single();\n  expect(firstProfile.username).toMatch(fakeOne.username); // Cannot insert the second user on the first client\n\n  const {\n    error: secondProfile\n  } = await first.from('profiles').insert({\n    id: secondUser.id,\n    username: fakeTwo.username\n  }).single();\n  expect(secondProfile.message).toMatch(/new row violates row-level security policy for table/);\n  const {\n    data: firstProfileList\n  } = await first.from('profiles').select();\n  const {\n    data: secondProfileList\n  } = await second.from('profiles').select();\n  const {\n    data: adminProfileList\n  } = await admin.from('profiles').select();\n  expect(firstProfileList.length).toBe(1);\n  expect(secondProfileList.length).toBe(0);\n  expect(adminProfileList.length).toBeGreaterThanOrEqual(1);\n});","file":"integration/index.test.ts","skipped":false,"dir":"tests"},{"name":"mounts correctly","suites":[],"updatePoint":{"line":59,"column":22},"line":59,"code":"test('mounts correctly', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('usage')) return {}\n    return { data: MOCK_CHART_DATA }\n  })\n  render(<ProjectUsage project=\"12345\" />)\n  await waitFor(() => screen.getByText(/Statistics for past 24 hours/))\n  await waitFor(() => screen.getByText(/123/))\n  await waitFor(() => screen.getByText(/223/))\n  await waitFor(() => screen.getByText(/323/))\n  await waitFor(() => screen.getByText(/333/))\n})","file":"components/Home/ProjectUsage.test.js","skipped":false,"dir":"studio/tests"},{"name":"dropdown options changes chart query","suites":[],"updatePoint":{"line":72,"column":42},"line":72,"code":"test('dropdown options changes chart query', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('usage')) return {}\n    return { data: MOCK_CHART_DATA }\n  })\n  render(<ProjectUsage project=\"12345\" />)\n  await waitFor(() => screen.getByText(/Statistics for past 24 hours/))\n  await waitFor(() => screen.getAllByRole('button', { name: '24 hours' }))\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(expect.stringContaining('interval=hourly'))\n  })\n  // find button that has radix id\n  const [btn] = screen.getAllByRole('button', { name: '24 hours' }).filter((e) => e.id)\n  clickDropdown(btn)\n  await waitFor(() => screen.getByText(/7 days/))\n  await waitFor(() => screen.getByText(/60 minutes/))\n\n  // simulate changing of dropdown\n  userEvent.click(screen.getByText(/60 minutes/))\n  await waitFor(() => screen.getByText(/Statistics for past 60 minutes/))\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('interval=minutely'))\n})","file":"components/Home/ProjectUsage.test.js","skipped":false,"dir":"studio/tests"},{"name":"renders chart","suites":[],"updatePoint":{"line":11,"column":19},"line":11,"code":"test('renders chart', async () => {\n  const mockFn = jest.fn()\n  const tsMicro = new Date().getTime() * 1000\n  render(\n    <LogEventChart\n      data={[{ timestamp: tsMicro }, { timestamp: tsMicro + 1 }]}\n      onBarClick={mockFn}\n    />\n  )\n  // TODO: figure out how to test rechart bar chart rendering, svg does not get rendered for some reason.\n  // should only have one bar rendered\n  // await waitFor(\n  //   () => {\n  //     const paths = container.querySelectorAll('path')\n  //     console.log(paths)\n  //     expect(paths.length).toBe(1)\n  //   },\n  //   { timeout: 1000 }\n  // )\n  // userEvent.click(paths[0])\n  // expect(mock).toBeCalledTimes(1)\n  await screen.findByText('Events')\n})","file":"pages/projects/LogEventChart.test.js","skipped":false,"dir":"studio/tests"},{"name":"can display log data and metadata","suites":[],"updatePoint":{"line":72,"column":39},"line":72,"code":"test('can display log data and metadata', async () => {\n  get.mockResolvedValue({\n    result: [\n      logDataFixture({\n        id: 'some-event-happened-id',\n        metadata: {\n          my_key: 'something_value',\n        },\n      }),\n    ],\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  fireEvent.click(await screen.findByText(/some-event-happened-id/))\n  await screen.findByText(/my_key/)\n  await screen.findByText(/something_value/)\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"Refresh page","suites":[],"updatePoint":{"line":89,"column":18},"line":89,"code":"test('Refresh page', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) return { result: { count: 0 } }\n    return {\n      result: [\n        logDataFixture({\n          id: 'some-event-id',\n          metadata: { my_key: 'something_value' },\n        }),\n      ],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  const row = await screen.findByText(/some-event-id/)\n  fireEvent.click(row)\n  await screen.findByText(/my_key/)\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"Search will trigger a log refresh","suites":[],"updatePoint":{"line":108,"column":39},"line":108,"code":"test('Search will trigger a log refresh', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('something')) {\n      return {\n        result: [logDataFixture({ id: 'some-event-id' })],\n      }\n    }\n    return { result: [] }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  userEvent.type(screen.getByPlaceholderText(/Search events/), 'something{enter}')\n\n  await waitFor(\n    () => {\n      expect(get).toHaveBeenCalledWith(expect.stringContaining('something'))\n\n      // updates router query params\n      const router = useRouter()\n      expect(router.push).toHaveBeenCalledWith(\n        expect.objectContaining({\n          pathname: expect.any(String),\n          query: expect.objectContaining({\n            s: expect.stringContaining('something'),\n          }),\n        })\n      )\n    },\n    { timeout: 1500 }\n  )\n  await screen.findByText(/some-event-id/)\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"poll count for new messages","suites":[],"updatePoint":{"line":141,"column":33},"line":141,"code":"test('poll count for new messages', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return { result: [{ count: 125 }] }\n    }\n    return {\n      result: [logDataFixture({ id: 'some-uuid123' })],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  await waitFor(() => screen.queryByText(/some-uuid123/) === null)\n  // should display new logs count\n  await waitFor(() => screen.getByText(/125/))\n\n  userEvent.click(screen.getByText(/Refresh/))\n  await waitFor(() => screen.queryByText(/125/) === null)\n  await screen.findByText(/some-uuid123/)\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"s= query param will populate the search bar","suites":[],"updatePoint":{"line":160,"column":49},"line":160,"code":"test('s= query param will populate the search bar', async () => {\n  const router = defaultRouterMock()\n  router.query = { ...router.query, s: 'someSearch' }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  // should populate search input with the search param\n  await screen.findByDisplayValue('someSearch')\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('someSearch'))\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"te= query param will populate the timestamp to input","suites":[],"updatePoint":{"line":170,"column":58},"line":170,"code":"test('te= query param will populate the timestamp to input', async () => {\n  // get time 20 mins before\n  const newDate = new Date()\n  newDate.setMinutes(new Date().getMinutes() - 20)\n  const isoString = newDate.toISOString()\n  const unixMicro = newDate.getTime() * 1000 //microseconds\n  const router = defaultRouterMock()\n  router.query = { ...router.query, te: unixMicro }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(\n      expect.stringContaining(`timestamp_end=${encodeURIComponent(unixMicro)}`)\n    )\n  })\n  userEvent.click(await screen.findByText('Custom'))\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_end=' + unixMicro))\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"ts= query param will populate the timestamp from input","suites":[],"updatePoint":{"line":189,"column":60},"line":189,"code":"test('ts= query param will populate the timestamp from input', async () => {\n  // get time 20 mins before\n  const newDate = new Date()\n  newDate.setMinutes(new Date().getMinutes() - 20)\n  const isoString = newDate.toISOString()\n  const unixMicro = newDate.getTime() * 1000 //microseconds\n  const router = defaultRouterMock()\n  router.query = { ...router.query, ts: unixMicro }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(\n      expect.stringContaining(`timestamp_start=${encodeURIComponent(unixMicro)}`)\n    )\n  })\n  userEvent.click(await screen.findByText('Custom'))\n  await screen.findByText(new RegExp(newDate.getFullYear()))\n  await screen.findByText(/Apply/)\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_start=' + unixMicro))\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"load older btn will fetch older logs","suites":[],"updatePoint":{"line":211,"column":42},"line":211,"code":"test('load older btn will fetch older logs', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return {\n      result: [logDataFixture({ id: 'first event' })],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  // should display first log but not second\n  await waitFor(() => screen.getByText('first event'))\n  await expect(screen.findByText('second event')).rejects.toThrow()\n\n  get.mockResolvedValueOnce({\n    result: [logDataFixture({ id: 'second event' })],\n  })\n  // should display first and second log\n  userEvent.click(await screen.findByText('Load older'))\n  await screen.findByText('first event')\n  await screen.findByText('second event')\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_end='))\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"bug: load older btn does not error out when previous page is empty","suites":[],"updatePoint":{"line":235,"column":72},"line":235,"code":"test('bug: load older btn does not error out when previous page is empty', async () => {\n  // bugfix for https://sentry.io/organizations/supabase/issues/2903331460/?project=5459134&referrer=slack\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return { result: [] }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  userEvent.click(await screen.findByText('Load older'))\n  // NOTE: potential race condition, since we are asserting that something DOES NOT EXIST\n  // wait for 500s to make sure all ui logic is complete\n  // need to wrap in act because internal react state is changing during this time.\n  await act(async () => await wait(100))\n\n  // clicking load older multiple times should not give error\n  await waitFor(() => {\n    expect(screen.queryByText(/Sorry/)).toBeNull()\n    expect(screen.queryByText(/An error occured/)).toBeNull()\n    expect(screen.queryByText(/undefined/)).toBeNull()\n  })\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"log event chart hide","suites":[],"updatePoint":{"line":259,"column":26},"line":259,"code":"test('log event chart hide', async () => {\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  await screen.findByText('Events')\n  const toggle = await screen.findByText(/Chart/)\n  userEvent.click(toggle)\n  await expect(screen.findByText('Events')).rejects.toThrow()\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"bug: nav backwards with params change results in ui changing","suites":[],"updatePoint":{"line":267,"column":66},"line":267,"code":"test('bug: nav backwards with params change results in ui changing', async () => {\n  // bugfix for https://sentry.io/organizations/supabase/issues/2903331460/?project=5459134&referrer=slack\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return { data: [] }\n  })\n  const { container, rerender } = render(\n    <LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />\n  )\n\n  await expect(screen.findByDisplayValue('simple-query')).rejects.toThrow()\n\n  const router = defaultRouterMock()\n  router.query = { ...router.query, s: 'simple-query' }\n  useRouter.mockReturnValue(router)\n  rerender(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await screen.findByDisplayValue('simple-query')\n})","file":"pages/projects/logs-preview.test.js","skipped":false,"dir":"studio/tests"},{"name":"can display log data","suites":[],"updatePoint":{"line":72,"column":26},"line":72,"code":"test('can display log data', async () => {\n  get.mockResolvedValue({\n    result: [\n      logDataFixture({\n        id: 'some-event-happened',\n        metadata: {\n          my_key: 'something_value',\n        },\n      }),\n    ],\n  })\n  const {container} = render(<LogsExplorerPage />)\n  let editor = container.querySelector('.monaco-editor')\n  await waitFor(() => {\n    editor = container.querySelector('.monaco-editor')\n    expect(editor).toBeTruthy()\n  })\n  // type new query\n  userEvent.type(editor, 'select \\ncount(*) as my_count \\nfrom edge_logs')\n\n  userEvent.click(await screen.findByText(/Run/))\n  const row  = await screen.findByText(\"some-event-happened\")\n  screen.debug()\n  userEvent.click(row)\n  await screen.findByText(/something_value/)\n})","file":"pages/projects/logs-query.test.js","skipped":false,"dir":"studio/tests"},{"name":"q= query param will populate the query input","suites":[],"updatePoint":{"line":99,"column":50},"line":99,"code":"test('q= query param will populate the query input', async () => {\n  const router = defaultRouterMock()\n  router.query = { ...router.query, type: 'api', q: 'some_query' }\n  useRouter.mockReturnValue(router)\n  render(<LogsExplorerPage />)\n  // should populate editor with the query param\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(expect.stringContaining('sql=some_query'))\n  })\n})","file":"pages/projects/logs-query.test.js","skipped":false,"dir":"studio/tests"},{"name":"custom sql querying","suites":[],"updatePoint":{"line":110,"column":25},"line":110,"code":"test('custom sql querying', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('sql=') && url.includes('select')) {\n      return {\n        result: [\n          {\n            my_count: 12345,\n          },\n        ],\n      }\n    }\n    return { result: [] }\n  })\n  const { container } = render(<LogsExplorerPage />)\n  let editor = container.querySelector('.monaco-editor')\n  expect(editor).toBeTruthy()\n\n  // type into the query editor\n  await waitFor(() => {\n    editor = container.querySelector('.monaco-editor')\n    expect(editor).toBeTruthy()\n  })\n  editor = container.querySelector('.monaco-editor')\n  // type new query\n  userEvent.type(editor, 'select \\ncount(*) as my_count \\nfrom edge_logs')\n\n  // should trigger query\n  userEvent.click(await screen.findByText('Run'))\n  await waitFor(\n    () => {\n      expect(get).toHaveBeenCalledWith(expect.stringContaining(encodeURI('\\n')))\n      expect(get).toHaveBeenCalledWith(expect.stringContaining('sql='))\n      expect(get).toHaveBeenCalledWith(expect.stringContaining('select'))\n      expect(get).toHaveBeenCalledWith(expect.stringContaining('edge_logs'))\n      expect(get).not.toHaveBeenCalledWith(expect.stringContaining('where'))\n    },\n    { timeout: 1000 }\n  )\n\n  await screen.findByText(/my_count/) //column header\n  const rowValue = await screen.findByText(/12345/) // row value\n\n  // clicking on the row value should not show log selection panel\n  userEvent.click(rowValue)\n  await expect(screen.findByText(/Metadata/)).rejects.toThrow()\n\n  // should not see chronological features\n  await expect(screen.findByText(/Load older/)).rejects.toThrow()\n})","file":"pages/projects/logs-query.test.js","skipped":false,"dir":"studio/tests"},{"name":"can display log data and metadata","suites":[],"updatePoint":{"line":71,"column":39},"line":71,"code":"test('can display log data and metadata', async () => {\n  get.mockResolvedValue({\n    result: [\n      logDataFixture({\n        id: 'some-event-happened-id',\n        metadata: {\n          my_key: 'something_value',\n        },\n      }),\n    ],\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  fireEvent.click(await screen.findByText(/some-event-happened-id/))\n  await screen.findByText(/my_key/)\n  await screen.findByText(/something_value/)\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"Refresh page","suites":[],"updatePoint":{"line":88,"column":18},"line":88,"code":"test('Refresh page', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) return { result: { count: 0 } }\n    return {\n      result: [\n        logDataFixture({\n          id: 'some-event-id',\n          metadata: { my_key: 'something_value' },\n        }),\n      ],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  const row = await screen.findByText(/some-event-id/)\n  fireEvent.click(row)\n  await screen.findByText(/my_key/)\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"Search will trigger a log refresh","suites":[],"updatePoint":{"line":107,"column":39},"line":107,"code":"test('Search will trigger a log refresh', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('something')) {\n      return {\n        result: [logDataFixture({ id: 'some-event-id' })],\n      }\n    }\n    return { result: [] }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  userEvent.type(screen.getByPlaceholderText(/Search events/), 'something{enter}')\n\n  await waitFor(\n    () => {\n      expect(get).toHaveBeenCalledWith(expect.stringContaining('something'))\n\n      // updates router query params\n      const router = useRouter()\n      expect(router.push).toHaveBeenCalledWith(\n        expect.objectContaining({\n          pathname: expect.any(String),\n          query: expect.objectContaining({\n            s: expect.stringContaining('something'),\n          }),\n        })\n      )\n    },\n    { timeout: 1500 }\n  )\n  await screen.findByText(/some-event-id/)\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"poll count for new messages","suites":[],"updatePoint":{"line":140,"column":33},"line":140,"code":"test('poll count for new messages', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return { result: [{ count: 125 }] }\n    }\n    return {\n      result: [logDataFixture({ id: 'some-uuid123' })],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  await waitFor(() => screen.queryByText(/some-uuid123/) === null)\n  // should display new logs count\n  await waitFor(() => screen.getByText(/125/))\n\n  userEvent.click(screen.getByText(/Refresh/))\n  await waitFor(() => screen.queryByText(/125/) === null)\n  await screen.findByText(/some-uuid123/)\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"s= query param will populate the search bar","suites":[],"updatePoint":{"line":159,"column":49},"line":159,"code":"test('s= query param will populate the search bar', async () => {\n  const router = defaultRouterMock()\n  router.query = { ...router.query, s: 'someSearch' }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  // should populate search input with the search param\n  await screen.findByDisplayValue('someSearch')\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('someSearch'))\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"te= query param will populate the timestamp to input","suites":[],"updatePoint":{"line":169,"column":58},"line":169,"code":"test('te= query param will populate the timestamp to input', async () => {\n  // get time 20 mins before\n  const newDate = new Date()\n  newDate.setMinutes(new Date().getMinutes() - 20)\n  const isoString = newDate.toISOString()\n  const unixMicro = newDate.getTime() * 1000 //microseconds\n  const router = defaultRouterMock()\n  router.query = { ...router.query, te: unixMicro }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(\n      expect.stringContaining(`timestamp_end=${encodeURIComponent(unixMicro)}`)\n    )\n  })\n  userEvent.click(await screen.findByText('Custom'))\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_end=' + unixMicro))\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"ts= query param will populate the timestamp from input","suites":[],"updatePoint":{"line":188,"column":60},"line":188,"code":"test('ts= query param will populate the timestamp from input', async () => {\n  // get time 20 mins before\n  const newDate = new Date()\n  newDate.setMinutes(new Date().getMinutes() - 20)\n  const unixMicro = newDate.getTime() * 1000 //microseconds\n  const router = defaultRouterMock()\n  router.query = { ...router.query, ts: unixMicro }\n  useRouter.mockReturnValue(router)\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await waitFor(() => {\n    expect(get).toHaveBeenCalledWith(\n      expect.stringContaining(`timestamp_start=${encodeURIComponent(unixMicro)}`)\n    )\n  })\n  userEvent.click(await screen.findByText('Custom'))\n  await screen.findByText(new RegExp(newDate.getFullYear()))\n  await screen.findByText(/Apply/)\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_start=' + unixMicro))\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"load older btn will fetch older logs","suites":[],"updatePoint":{"line":209,"column":42},"line":209,"code":"test('load older btn will fetch older logs', async () => {\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return {\n      result: [logDataFixture({ id: 'first event' })],\n    }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  // should display first log but not second\n  await waitFor(() => screen.getByText('first event'))\n  await expect(screen.findByText('second event')).rejects.toThrow()\n\n  get.mockResolvedValueOnce({\n    result: [logDataFixture({ id: 'second event' })],\n  })\n  // should display first and second log\n  userEvent.click(await screen.findByText('Load older'))\n  await screen.findByText('first event')\n  await screen.findByText('second event')\n  expect(get).toHaveBeenCalledWith(expect.stringContaining('timestamp_end='))\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"bug: load older btn does not error out when previous page is empty","suites":[],"updatePoint":{"line":233,"column":72},"line":233,"code":"test('bug: load older btn does not error out when previous page is empty', async () => {\n  // bugfix for https://sentry.io/organizations/supabase/issues/2903331460/?project=5459134&referrer=slack\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return { result: [] }\n  })\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  userEvent.click(await screen.findByText('Load older'))\n  // NOTE: potential race condition, since we are asserting that something DOES NOT EXIST\n  // wait for 500s to make sure all ui logic is complete\n  // need to wrap in act because internal react state is changing during this time.\n  await act(async () => await wait(100))\n\n  // clicking load older multiple times should not give error\n  await waitFor(() => {\n    expect(screen.queryByText(/Sorry/)).toBeNull()\n    expect(screen.queryByText(/An error occured/)).toBeNull()\n    expect(screen.queryByText(/undefined/)).toBeNull()\n  })\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"log event chart hide","suites":[],"updatePoint":{"line":257,"column":26},"line":257,"code":"test('log event chart hide', async () => {\n  render(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n  await screen.findByText('Events')\n  const toggle = await screen.findByText(/Chart/)\n  userEvent.click(toggle)\n  await expect(screen.findByText('Events')).rejects.toThrow()\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"bug: nav backwards with params change results in ui changing","suites":[],"updatePoint":{"line":265,"column":66},"line":265,"code":"test('bug: nav backwards with params change results in ui changing', async () => {\n  // bugfix for https://sentry.io/organizations/supabase/issues/2903331460/?project=5459134&referrer=slack\n  get.mockImplementation((url) => {\n    if (url.includes('count')) {\n      return {}\n    }\n    return { data: [] }\n  })\n  const { container, rerender } = render(\n    <LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />\n  )\n\n  await expect(screen.findByDisplayValue('simple-query')).rejects.toThrow()\n\n  const router = defaultRouterMock()\n  router.query = { ...router.query, s: 'simple-query' }\n  useRouter.mockReturnValue(router)\n  rerender(<LogsPreviewer projectRef=\"123\" tableName={LogsTableName.EDGE} />)\n\n  await screen.findByDisplayValue('simple-query')\n})","file":"pages/projects/LogsPreviewer.test.js","skipped":false,"dir":"studio/tests"},{"name":"templates","suites":[],"line":12,"code":"test.todo('templates')","file":"pages/projects/LogsQueryPanel.test.js","skipped":true,"dir":"studio/tests"},{"name":"run and clear","suites":[],"updatePoint":{"line":14,"column":19},"line":14,"code":"test('run and clear', async () => {\n  const mockRun = jest.fn()\n  const mockClear = jest.fn()\n  render(<LogsQueryPanel onRun={mockRun} onClear={mockClear} hasEditorValue/>)\n  await expect(screen.findByPlaceholderText(/Search/)).rejects.toThrow()\n  const run = await screen.findByText(/Run/)\n  userEvent.click(run)\n  expect(mockRun).toBeCalled()\n  const clear = await screen.findByText(/Clear/)\n  userEvent.click(clear)\n  expect(mockClear).toBeCalled()\n  \n})","file":"pages/projects/LogsQueryPanel.test.js","skipped":false,"dir":"studio/tests"},{"name":"can display log data","suites":[],"updatePoint":{"line":4,"column":26},"line":4,"code":"test('can display log data', async () => {\n  render(\n    <LogTable\n      data={[\n        {\n          id: 'some-uuid',\n          timestamp: 1621323232312,\n          event_message: 'some event happened',\n          metadata: {\n            my_key: 'something_value',\n          },\n        },\n      ]}\n    />\n  )\n\n  const row = await screen.findByText(/some-uuid/)\n  userEvent.click(row)\n  await waitFor(() => screen.getByText(/my_key/))\n  await waitFor(() => screen.getByText(/something_value/))\n})","file":"pages/projects/LogTable.test.js","skipped":false,"dir":"studio/tests"},{"name":"dedupes log lines with exact id","suites":[],"updatePoint":{"line":26,"column":37},"line":26,"code":"test('dedupes log lines with exact id', async () => {\n  // chronological mode requires 4 columns\n  render(\n    <LogTable\n      data={[\n        {\n          id: 'some-uuid',\n          timestamp: 1621323232312,\n          event_message: 'some event happened',\n          metadata: {},\n        },\n        {\n          id: 'some-uuid',\n          timestamp: 1621323232312,\n          event_message: 'some event happened',\n          metadata: {},\n        },\n      ]}\n    />\n  )\n\n  // should only have one element, this line will fail if there are >1 element\n  await screen.findByText(/some-uuid/)\n})","file":"pages/projects/LogTable.test.js","skipped":false,"dir":"studio/tests"},{"name":"can display custom columns and headers based on data input","suites":[],"updatePoint":{"line":51,"column":64},"line":51,"code":"test('can display custom columns and headers based on data input', async () => {\n  render(<LogTable data={[{ some_header: 'some_data', kinda: 123456 }]} />)\n  await waitFor(() => screen.getByText(/some_header/))\n  await waitFor(() => screen.getByText(/some_data/))\n  await waitFor(() => screen.getByText(/kinda/))\n  await waitFor(() => screen.getByText(/123456/))\n})","file":"pages/projects/LogTable.test.js","skipped":false,"dir":"studio/tests"},{"name":"toggle histogram","suites":[],"updatePoint":{"line":59,"column":22},"line":59,"code":"test('toggle histogram', async () => {\n  const mockFn = jest.fn()\n  render(<LogTable onHistogramToggle={mockFn} isHistogramShowing={true} />)\n  const toggle = await screen.getByText(/Histogram/)\n  userEvent.click(toggle)\n  expect(mockFn).toBeCalled()\n})","file":"pages/projects/LogTable.test.js","skipped":false,"dir":"studio/tests"},{"name":"templates","suites":[],"line":13,"code":"test.todo('templates')","file":"pages/projects/PreviewFilterPanel.test.js","skipped":true,"dir":"studio/tests"},{"name":"filter input change and submit","suites":[],"updatePoint":{"line":30,"column":36},"line":30,"code":"test('filter input change and submit', async () => {\n  const mockFn = jest.fn()\n  render(<PreviewFilterPanel onSearch={mockFn} />)\n  expect(mockFn).not.toBeCalled()\n  const search = screen.getByPlaceholderText(/Search/)\n  userEvent.type(search, '12345{enter}')\n  expect(mockFn).toBeCalled()\n})","file":"pages/projects/PreviewFilterPanel.test.js","skipped":false,"dir":"studio/tests"},{"name":"filter input value","suites":[],"updatePoint":{"line":39,"column":24},"line":39,"code":"test('filter input value', async () => {\n  render(<PreviewFilterPanel defaultSearchValue={'1234'} />)\n  await screen.findByDisplayValue('1234')\n})","file":"pages/projects/PreviewFilterPanel.test.js","skipped":false,"dir":"studio/tests"},{"name":"Manual refresh","suites":[],"updatePoint":{"line":44,"column":20},"line":44,"code":"test('Manual refresh', async () => {\n  const mockFn = jest.fn()\n  render(<PreviewFilterPanel onRefresh={mockFn} />)\n  const btn = await screen.findByText(/Refresh/)\n  userEvent.click(btn)\n  expect(mockFn).toBeCalled()\n})","file":"pages/projects/PreviewFilterPanel.test.js","skipped":false,"dir":"studio/tests"},{"name":"Datepicker dropdown","suites":[],"updatePoint":{"line":51,"column":25},"line":51,"code":"test('Datepicker dropdown', async () => {\n  render(<PreviewFilterPanel />)\n  clickDropdown(await screen.findByText(/Last hour/))\n  userEvent.click(await screen.findByText(/Last 3 hours/))\n  await screen.findByText(/Last 3 hours/)\n  await expect(screen.findByText(/Last hour/)).rejects.toThrow()\n})","file":"pages/projects/PreviewFilterPanel.test.js","skipped":false,"dir":"studio/tests"},{"name":"timestamp to/from filter default value","suites":[],"line":59,"code":"test.todo('timestamp to/from filter default value')","file":"pages/projects/PreviewFilterPanel.test.js","skipped":true,"dir":"studio/tests"},{"name":"timestamp to/from filter value change","suites":[],"line":69,"code":"test.todo('timestamp to/from filter value change')","file":"pages/projects/PreviewFilterPanel.test.js","skipped":true,"dir":"studio/tests"}]}