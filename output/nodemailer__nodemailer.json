{"repo":"nodemailer/nodemailer","url":"https://github.com/nodemailer/nodemailer","branch":"master","configs":[{"package":"nodemailer","lang":"js","dir":"test","framework":"mocha","pattern":"**/*[._-]{test,spec,unittest,unit}.{ts,js}"}],"tests":[{"name":"should handle single address correctly","suites":["#addressparser"],"updatePoint":{"line":13,"column":44},"line":13,"code":"  it('should handle single address correctly', function () {\n    let input = 'andris@tr.ee';\n    let expected = [{\n      address: 'andris@tr.ee',\n      name: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle multiple addresses correctly","suites":["#addressparser"],"updatePoint":{"line":21,"column":48},"line":21,"code":"  it('should handle multiple addresses correctly', function () {\n    let input = 'andris@tr.ee, andris@example.com';\n    let expected = [{\n      address: 'andris@tr.ee',\n      name: ''\n    }, {\n      address: 'andris@example.com',\n      name: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle unquoted name correctly","suites":["#addressparser"],"updatePoint":{"line":32,"column":43},"line":32,"code":"  it('should handle unquoted name correctly', function () {\n    let input = 'andris <andris@tr.ee>';\n    let expected = [{\n      name: 'andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle quoted name correctly","suites":["#addressparser"],"updatePoint":{"line":40,"column":41},"line":40,"code":"  it('should handle quoted name correctly', function () {\n    let input = '\"reinman, andris\" <andris@tr.ee>';\n    let expected = [{\n      name: 'reinman, andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle quoted semicolons correctly","suites":["#addressparser"],"updatePoint":{"line":48,"column":47},"line":48,"code":"  it('should handle quoted semicolons correctly', function () {\n    let input = '\"reinman; andris\" <andris@tr.ee>';\n    let expected = [{\n      name: 'reinman; andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle unquoted name, unquoted address correctly","suites":["#addressparser"],"updatePoint":{"line":56,"column":61},"line":56,"code":"  it('should handle unquoted name, unquoted address correctly', function () {\n    let input = 'andris andris@tr.ee';\n    let expected = [{\n      name: 'andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle emtpy group correctly","suites":["#addressparser"],"updatePoint":{"line":64,"column":41},"line":64,"code":"  it('should handle emtpy group correctly', function () {\n    let input = 'Undisclosed:;';\n    let expected = [{\n      name: 'Undisclosed',\n      group: []\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle address group correctly","suites":["#addressparser"],"updatePoint":{"line":72,"column":43},"line":72,"code":"  it('should handle address group correctly', function () {\n    let input = 'Disclosed:andris@tr.ee, andris@example.com;';\n    let expected = [{\n      name: 'Disclosed',\n      group: [{\n        address: 'andris@tr.ee',\n        name: ''\n      }, {\n        address: 'andris@example.com',\n        name: ''\n      }]\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle semicolon as a delimiter","suites":["#addressparser"],"updatePoint":{"line":86,"column":44},"line":86,"code":"  it('should handle semicolon as a delimiter', function () {\n    let input = 'andris@tr.ee; andris@example.com;';\n    let expected = [{\n      address: 'andris@tr.ee',\n      name: ''\n    }, {\n      address: 'andris@example.com',\n      name: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle mixed group correctly","suites":["#addressparser"],"updatePoint":{"line":97,"column":41},"line":97,"code":"  it('should handle mixed group correctly', function () {\n    let input = 'Test User <test.user@mail.ee>, Disclosed:andris@tr.ee, andris@example.com;,,,, Undisclosed:;';\n    let expected = [{\n      address: 'test.user@mail.ee',\n      name: 'Test User'\n    }, {\n      name: 'Disclosed',\n      group: [{\n        address: 'andris@tr.ee',\n        name: ''\n      }, {\n        address: 'andris@example.com',\n        name: ''\n      }]\n    }, {\n      name: 'Undisclosed',\n      group: []\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should flatten mixed group correctly","suites":["#addressparser"],"updatePoint":{"line":117,"column":42},"line":117,"code":"  it('should flatten mixed group correctly', function () {\n    let input = 'Test User <test.user@mail.ee>, Disclosed:andris@tr.ee, andris@example.com;,,,, Undisclosed:; bob@example.com BOB;';\n    let expected = [{\n      address: 'test.user@mail.ee',\n      name: 'Test User'\n    }, {\n      address: 'andris@tr.ee',\n      name: ''\n    }, {\n      address: 'andris@example.com',\n      name: ''\n    }, {\n      address: 'bob@example.com',\n      name: 'BOB'\n    }];\n    expect(addressparser(input, {\n      flatten: true\n    })).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"semicolon as delimiter should not break group parsing","suites":["#addressparser"],"updatePoint":{"line":136,"column":59},"line":136,"code":"  it('semicolon as delimiter should not break group parsing', function () {\n    let input = 'Test User <test.user@mail.ee>; Disclosed:andris@tr.ee, andris@example.com;,,,, Undisclosed:; bob@example.com;';\n    let expected = [{\n      address: 'test.user@mail.ee',\n      name: 'Test User'\n    }, {\n      name: 'Disclosed',\n      group: [{\n        address: 'andris@tr.ee',\n        name: ''\n      }, {\n        address: 'andris@example.com',\n        name: ''\n      }]\n    }, {\n      name: 'Undisclosed',\n      group: []\n    }, {\n      address: 'bob@example.com',\n      name: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle name from comment correctly","suites":["#addressparser"],"updatePoint":{"line":159,"column":47},"line":159,"code":"  it('should handle name from comment correctly', function () {\n    let input = 'andris@tr.ee (andris)';\n    let expected = [{\n      name: 'andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle skip comment correctly","suites":["#addressparser"],"updatePoint":{"line":167,"column":42},"line":167,"code":"  it('should handle skip comment correctly', function () {\n    let input = 'andris@tr.ee (reinman) andris';\n    let expected = [{\n      name: 'andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle missing address correctly","suites":["#addressparser"],"updatePoint":{"line":175,"column":45},"line":175,"code":"  it('should handle missing address correctly', function () {\n    let input = 'andris';\n    let expected = [{\n      name: 'andris',\n      address: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle apostrophe in name correctly","suites":["#addressparser"],"updatePoint":{"line":183,"column":48},"line":183,"code":"  it('should handle apostrophe in name correctly', function () {\n    let input = 'O\\x27Neill';\n    let expected = [{\n      name: 'O\\x27Neill',\n      address: ''\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle particularily bad input, unescaped colon correctly","suites":["#addressparser"],"updatePoint":{"line":191,"column":70},"line":191,"code":"  it('should handle particularily bad input, unescaped colon correctly', function () {\n    let input = 'FirstName Surname-WithADash :: Company <firstname@company.com>';\n    let expected = [{\n      name: 'FirstName Surname-WithADash',\n      group: [{\n        name: undefined,\n        group: [{\n          address: 'firstname@company.com',\n          name: 'Company'\n        }]\n      }]\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  }); // should not change an invalid email to valid email","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle invalid email address correctly","suites":["#addressparser"],"updatePoint":{"line":206,"column":51},"line":206,"code":"  it('should handle invalid email address correctly', function () {\n    let input = 'name@address.com@address2.com';\n    let expected = [{\n      name: '',\n      address: 'name@address.com@address2.com'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle unexpected <","suites":["#addressparser"],"updatePoint":{"line":214,"column":32},"line":214,"code":"  it('should handle unexpected <', function () {\n    let input = 'reinman > andris < test <andris@tr.ee>';\n    let expected = [{\n      name: 'reinman > andris',\n      address: 'andris@tr.ee'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"should handle escapes","suites":["#addressparser"],"updatePoint":{"line":222,"column":27},"line":222,"code":"  it('should handle escapes', function () {\n    let input = '\"Firstname \\\\\" \\\\\\\\\\\\, Lastname \\\\(Test\\\\)\" test@example.com';\n    let expected = [{\n      address: 'test@example.com',\n      name: 'Firstname \" \\\\, Lastname (Test)'\n    }];\n    expect(addressparser(input)).to.deep.equal(expected);\n  });","file":"addressparser/addressparser-test.js","skipped":false,"dir":"test"},{"name":"shoud encode UTF-8 string to base64","suites":["Base64 Tests","#encode"],"updatePoint":{"line":24,"column":43},"line":24,"code":"    it('shoud encode UTF-8 string to base64', function () {\n      encodeFixtures.forEach(function (test) {\n        expect(base64.encode(test[0])).to.equal(test[1]);\n      });\n    });","file":"base64/base64-test.js","skipped":false,"dir":"test"},{"name":"shoud encode Buffer to base64","suites":["Base64 Tests","#encode"],"updatePoint":{"line":29,"column":37},"line":29,"code":"    it('shoud encode Buffer to base64', function () {\n      expect(base64.encode(Buffer.from([0x00, 0x01, 0x02, 0x20, 0x03]))).to.equal('AAECIAM=');\n    });","file":"base64/base64-test.js","skipped":false,"dir":"test"},{"name":"should wrap long base64 encoded lines","suites":["Base64 Tests","#wrap"],"updatePoint":{"line":34,"column":45},"line":34,"code":"    it('should wrap long base64 encoded lines', function () {\n      wrapFixtures.forEach(function (test) {\n        expect(base64.wrap(test[0], 20)).to.equal(test[1]);\n      });\n    });","file":"base64/base64-test.js","skipped":false,"dir":"test"},{"name":"should transform incoming bytes to base64","suites":["Base64 Tests","base64 Streams"],"updatePoint":{"line":41,"column":49},"line":41,"code":"    it('should transform incoming bytes to base64', function (done) {\n      let encoder = new base64.Encoder({\n        lineLength: 9\n      });\n      let bytes = Buffer.from(streamFixture[0]),\n          i = 0,\n          buf = [],\n          buflen = 0;\n      encoder.on('data', function (chunk) {\n        buf.push(chunk);\n        buflen += chunk.length;\n      });\n      encoder.on('end', function (chunk) {\n        if (chunk) {\n          buf.push(chunk);\n          buflen += chunk.length;\n        }\n\n        buf = Buffer.concat(buf, buflen);\n        expect(buf.toString()).to.equal(streamFixture[1]);\n        done();\n      });\n\n      let sendNextByte = function () {\n        if (i >= bytes.length) {\n          return encoder.end();\n        }\n\n        let ord = bytes[i++];\n        encoder.write(Buffer.from([ord]));\n        setImmediate(sendNextByte);\n      };\n\n      sendNextByte();\n    });","file":"base64/base64-test.js","skipped":false,"dir":"test"},{"name":"should transform incoming bytes to base64 and back","suites":["Base64 Tests","base64 Streams"],"updatePoint":{"line":76,"column":58},"line":76,"code":"    it('should transform incoming bytes to base64 and back', function (done) {\n      let decoder = new libbase64.Decoder();\n      let encoder = new base64.Encoder();\n      let file = fs.createReadStream(__dirname + '/fixtures/alice.txt');\n      let fhash = crypto.createHash('md5');\n      let dhash = crypto.createHash('md5');\n      file.pipe(encoder).pipe(decoder);\n      file.on('data', function (chunk) {\n        fhash.update(chunk);\n      });\n      file.on('end', function () {\n        fhash = fhash.digest('hex');\n      });\n      decoder.on('data', function (chunk) {\n        dhash.update(chunk);\n      });\n      decoder.on('end', function () {\n        dhash = dhash.digest('hex');\n        expect(fhash).to.equal(dhash);\n        done();\n      });\n    });","file":"base64/base64-test.js","skipped":false,"dir":"test"},{"name":"should sign message","suites":["DKIM Tests"],"updatePoint":{"line":44,"column":25},"line":44,"code":"  it('should sign message', function (done) {\n    let message = `From: saatja aadress\nTo: Saaja aadress\nSubject: pealkiri\n  mitmel\n  real\nMessage-Id: test\n\ntere tere\nteine rida\n`;\n    let s = new PassThrough();\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey\n    });\n    let output = dkim.sign(s);\n    let chunks = [];\n    let reading = false;\n\n    let readNext = () => {\n      let chunk = output.read(10 * 1024);\n\n      if (chunk === null) {\n        reading = false;\n        return;\n      }\n\n      reading = true;\n      chunks.push(chunk);\n      setImmediate(readNext);\n    };\n\n    output.on('readable', () => {\n      if (!reading) {\n        readNext();\n      }\n    });\n    output.on('end', () => {\n      let message = Buffer.concat(chunks).toString();\n      expect(message).to.equal('DKIM-Signature: v=1; a=rsa-sha256; c=relaxed/relaxed; d=node.ee; q=dns/txt;\\r\\n' + ' s=dkim; bh=h2JdEKA6yVYSGuI3DQCDlg2KL+96GxA7Yw7owvsYDUM=;\\r\\n' + ' h=from:subject:message-id:to;\\r\\n' + ' b=tey8mL2VQVuy/phh7yEKi86Y0Yyzyy04qTy73G4yg3qdEDB7uymjNr32ruRPVFmC9PimIK75p\\r\\n' + ' KVPF5T1oB8/oY6TFqyyuECRrI4D2CfG3VXWBShK32r1Wtv7eWN04b4s\\r\\n' + 'From: saatja aadress\\n' + 'To: Saaja aadress\\n' + 'Subject: pealkiri\\n' + '  mitmel\\n' + '  real\\n' + 'Message-Id: test\\n' + '\\n' + 'tere tere\\n' + 'teine rida\\n');\n      done();\n    });\n    let inputPos = 0;\n    let messageBuf = Buffer.from(message);\n\n    let writeNext = () => {\n      if (inputPos >= messageBuf.length) {\n        return s.end();\n      }\n\n      s.write(Buffer.from([messageBuf[inputPos++]]));\n      setImmediate(writeNext);\n    };\n\n    writeNext();\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should sign large message using cache dir","suites":["DKIM Tests"],"updatePoint":{"line":102,"column":47},"line":102,"code":"  it('should sign large message using cache dir', function (done) {\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey,\n      cacheDir: path.join(__dirname, 'cache')\n    });\n    let output = dkim.sign(fs.createReadStream(__dirname + '/fixtures/large.eml'));\n    output.on('error', err => {\n      expect(err).to.not.exist;\n      done();\n    });\n    let chunks = [];\n    let reading = false;\n\n    let readNext = () => {\n      let chunk = output.read();\n\n      if (chunk === null) {\n        reading = false;\n        return;\n      }\n\n      reading = true;\n      chunks.push(chunk);\n      setImmediate(readNext);\n    };\n\n    output.on('readable', () => {\n      if (!reading) {\n        readNext();\n      }\n    });\n    output.on('end', () => {\n      let message = Buffer.concat(chunks).toString();\n      expect(message.indexOf('bh=ST+2Z7mCDd8CPa6pWbCWnFBLKyl8/I5d0JCaEQub550=')).is.gte(0);\n      expect(crypto.createHash('md5').update(Buffer.from(message.substr(message.indexOf('X-Zone-Loop')))).digest('hex')).to.equal('16078d67ecb4c9954f2568b3bd20e8b5');\n      expect(output.usingCache).to.be.true;\n      done();\n    });\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should sign large message without cache dir","suites":["DKIM Tests"],"updatePoint":{"line":143,"column":49},"line":143,"code":"  it('should sign large message without cache dir', function (done) {\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey\n    });\n    let output = dkim.sign(fs.createReadStream(__dirname + '/fixtures/large.eml'));\n    output.on('error', err => {\n      expect(err).to.not.exist;\n      done();\n    });\n    let chunks = [];\n    let reading = false;\n\n    let readNext = () => {\n      let chunk = output.read();\n\n      if (chunk === null) {\n        reading = false;\n        return;\n      }\n\n      reading = true;\n      chunks.push(chunk);\n      setImmediate(readNext);\n    };\n\n    output.on('readable', () => {\n      if (!reading) {\n        readNext();\n      }\n    });\n    output.on('end', () => {\n      let message = Buffer.concat(chunks).toString();\n      expect(message.indexOf('bh=ST+2Z7mCDd8CPa6pWbCWnFBLKyl8/I5d0JCaEQub550=')).is.gte(0);\n      expect(crypto.createHash('md5').update(Buffer.from(message.substr(message.indexOf('X-Zone-Loop')))).digest('hex')).to.equal('16078d67ecb4c9954f2568b3bd20e8b5');\n      expect(output.usingCache).to.be.false;\n      done();\n    });\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should emit cache error","suites":["DKIM Tests"],"updatePoint":{"line":183,"column":29},"line":183,"code":"  it('should emit cache error', function (done) {\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey,\n      cacheDir: '/rootertewywrtyreetwert' // expecting that this location does not exist or is unwritable\n\n    });\n    let output = dkim.sign(fs.createReadStream(__dirname + '/fixtures/large.eml'));\n    output.on('error', err => {\n      expect(err).to.exist;\n      done();\n    });\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should sign large message as Buffer","suites":["DKIM Tests"],"updatePoint":{"line":197,"column":41},"line":197,"code":"  it('should sign large message as Buffer', function (done) {\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey,\n      cacheDir: path.join(__dirname, 'cache')\n    });\n    let output = dkim.sign(fs.readFileSync(__dirname + '/fixtures/large.eml'));\n    output.on('error', err => {\n      expect(err).to.not.exist;\n      done();\n    });\n    let chunks = [];\n    let reading = false;\n\n    let readNext = () => {\n      let chunk = output.read();\n\n      if (chunk === null) {\n        reading = false;\n        return;\n      }\n\n      reading = true;\n      chunks.push(chunk);\n      setImmediate(readNext);\n    };\n\n    output.on('readable', () => {\n      if (!reading) {\n        readNext();\n      }\n    });\n    output.on('end', () => {\n      let message = Buffer.concat(chunks).toString();\n      expect(message.indexOf('bh=ST+2Z7mCDd8CPa6pWbCWnFBLKyl8/I5d0JCaEQub550=')).is.gte(0);\n      expect(crypto.createHash('md5').update(Buffer.from(message.substr(message.indexOf('X-Zone-Loop')))).digest('hex')).to.equal('16078d67ecb4c9954f2568b3bd20e8b5');\n      expect(output.usingCache).to.be.true;\n      done();\n    });\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should sign large message as String","suites":["DKIM Tests"],"updatePoint":{"line":238,"column":41},"line":238,"code":"  it('should sign large message as String', function (done) {\n    let dkim = new DKIM({\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey,\n      cacheDir: path.join(__dirname, 'cache')\n    });\n    let output = dkim.sign(fs.readFileSync(__dirname + '/fixtures/large.eml', 'utf-8'));\n    output.on('error', err => {\n      expect(err).to.not.exist;\n      done();\n    });\n    let chunks = [];\n    let reading = false;\n\n    let readNext = () => {\n      let chunk = output.read();\n\n      if (chunk === null) {\n        reading = false;\n        return;\n      }\n\n      reading = true;\n      chunks.push(chunk);\n      setImmediate(readNext);\n    };\n\n    output.on('readable', () => {\n      if (!reading) {\n        readNext();\n      }\n    });\n    output.on('end', () => {\n      let message = Buffer.concat(chunks).toString();\n      expect(message.indexOf('bh=ST+2Z7mCDd8CPa6pWbCWnFBLKyl8/I5d0JCaEQub550=')).is.gte(0);\n      expect(crypto.createHash('md5').update(Buffer.from(message.substr(message.indexOf('X-Zone-Loop')))).digest('hex')).to.equal('16078d67ecb4c9954f2568b3bd20e8b5');\n      expect(output.usingCache).to.be.true;\n      done();\n    });\n  });","file":"dkim/dkim-test.js","skipped":false,"dir":"test"},{"name":"should extract header and body","suites":["DKIM MessageParser Tests"],"updatePoint":{"line":14,"column":36},"line":14,"code":"  it('should extract header and body', function (done) {\n    let parser = new MessageParser();\n    let message = `From: saatja aadress\nTo: Saaja aadress\nSubject: pealkiri\n  mitmel\n  real\nMessage-Id: test\n\ntere tere\nteine rida\n`;\n    let chunks = [];\n    let headers = false;\n    let end = false;\n    parser.on('data', chunk => {\n      chunks.push(chunk);\n    });\n    parser.on('end', () => {\n      end = true;\n      let body = Buffer.concat(chunks).toString();\n      expect(body).to.equal('tere tere\\nteine rida\\n');\n\n      if (headers) {\n        return done();\n      }\n    });\n    parser.on('headers', data => {\n      expect(data).to.deep.equal([// fix auto format\n      {\n        key: 'from',\n        line: 'From: saatja aadress'\n      }, {\n        key: 'to',\n        line: 'To: Saaja aadress'\n      }, {\n        key: 'subject',\n        line: 'Subject: pealkiri\\n  mitmel\\n  real'\n      }, {\n        key: 'message-id',\n        line: 'Message-Id: test'\n      }]);\n      headers = true;\n\n      if (end) {\n        return done();\n      }\n    });\n    parser.end(Buffer.from(message));\n  });","file":"dkim/message-parser-test.js","skipped":false,"dir":"test"},{"name":"Should calculate body hash byte by byte","suites":["DKIM RelaxedBody Tests"],"updatePoint":{"line":16,"column":45},"line":16,"code":"  it('Should calculate body hash byte by byte', function (done) {\n    fs.readFile(__dirname + '/fixtures/message1.eml', 'utf-8', (err, message) => {\n      expect(err).to.not.exist;\n      message = message.replace(/\\r?\\n/g, '\\r\\n');\n      message = message.split('\\r\\n\\r\\n');\n      message.shift();\n      message = message.join('\\r\\n\\r\\n');\n      message = Buffer.from(message);\n      let s = new RelaxedBody({\n        hashAlgo: 'sha256',\n        debug: true\n      });\n      s.on('hash', hash => {\n        expect(hash).to.equal('D2H5TEwtUgM2u8Ew0gG6vnt/Na6L+Zep7apmSmfy8IQ=');\n        done();\n      });\n      let pos = 0;\n\n      let stream = () => {\n        if (pos >= message.length) {\n          return s.end();\n        }\n\n        let ord = Buffer.from([message[pos++]]);\n        s.write(ord);\n        setImmediate(stream);\n      };\n\n      setImmediate(stream);\n    });\n  });","file":"dkim/relaxed-body-test.js","skipped":false,"dir":"test"},{"name":"Should calculate body hash all at once","suites":["DKIM RelaxedBody Tests"],"updatePoint":{"line":47,"column":44},"line":47,"code":"  it('Should calculate body hash all at once', function (done) {\n    fs.readFile(__dirname + '/fixtures/message1.eml', 'utf-8', (err, message) => {\n      expect(err).to.not.exist;\n      message = message.replace(/\\r?\\n/g, '\\r\\n');\n      message = message.split('\\r\\n\\r\\n');\n      message.shift();\n      message = message.join('\\r\\n\\r\\n');\n      message = Buffer.from(message);\n      let s = new RelaxedBody({\n        hashAlgo: 'sha256',\n        debug: true\n      });\n      s.on('hash', hash => {\n        expect(hash).to.equal('D2H5TEwtUgM2u8Ew0gG6vnt/Na6L+Zep7apmSmfy8IQ=');\n        done();\n      });\n      setImmediate(() => s.end(message));\n    });\n  });","file":"dkim/relaxed-body-test.js","skipped":false,"dir":"test"},{"name":"should create relaxed headers","suites":["DKIM Sign Tests"],"updatePoint":{"line":34,"column":35},"line":34,"code":"  it('should create relaxed headers', function () {\n    let headerLines = [{\n      key: 'a',\n      line: 'A: X'\n    }, {\n      key: 'b',\n      line: 'B: Y\\t\\r\\n\\tZ  '\n    }];\n    expect(sign.relaxedHeaders(headerLines, 'a:b:c:d')).to.deep.equal({\n      headers: 'a:X\\r\\nb:Y Z\\r\\n',\n      fieldNames: 'a:b'\n    });\n  });","file":"dkim/sign-test.js","skipped":false,"dir":"test"},{"name":"should skip specific headers","suites":["DKIM Sign Tests"],"updatePoint":{"line":47,"column":34},"line":47,"code":"  it('should skip specific headers', function () {\n    let headerLines = [{\n      key: 'a',\n      line: 'A: X'\n    }, {\n      key: 'b',\n      line: 'B: Y\\t\\r\\n\\tZ  '\n    }, {\n      key: 'c',\n      line: 'C: X'\n    }, {\n      key: 'd',\n      line: 'D: X'\n    }];\n    expect(sign.relaxedHeaders(headerLines, 'a:b:c:d', 'a:c')).to.deep.equal({\n      headers: 'b:Y Z\\r\\nd:X\\r\\n',\n      fieldNames: 'b:d'\n    });\n  });","file":"dkim/sign-test.js","skipped":false,"dir":"test"},{"name":"should sign headers","suites":["DKIM Sign Tests"],"updatePoint":{"line":66,"column":25},"line":66,"code":"  it('should sign headers', function () {\n    let headerLines = [{\n      key: 'from',\n      line: 'From: andris@node.ee'\n    }, {\n      key: 'to',\n      line: 'To:andris@kreata.ee'\n    }, {\n      key: 'message-id',\n      line: 'Message-ID: <testkiri@kreata.ee>'\n    }];\n    let dkimField = sign(headerLines, 'sha256', 'z6TUz85EdYrACGMHYgZhJGvVy5oQI0dooVMKa2ZT7c4=', {\n      skipFields: 'message-id:references',\n      domainName: 'node.ee',\n      keySelector: 'dkim',\n      privateKey\n    });\n    expect(dkimField.replace(/\\r?\\n\\s*/g, '').replace(/\\s+/g, '')).to.equal('DKIM-Signature:v=1;a=rsa-sha256;c=relaxed/relaxed;d=node.ee;q=dns/txt;s=dkim;bh=z6TUz85EdYrACGMHYgZhJGvVy5oQI0dooVMKa2ZT7c4=;h=from:to;b=pVd+Dp+EjmYBcc1AWlBAP4ESpuAJ2WMS4gbxWLoeUZ1vZRodVN7K9UXvcCsLuqjJktCZMN2+8dyEUaYW2VIcxg4sVBCS1wqB/tqYZ/gxXLnG2/nZf4fyD2vxltJP4pDL');\n  });","file":"dkim/sign-test.js","skipped":false,"dir":"test"},{"name":"should sign headers for unicode domain","suites":["DKIM Sign Tests"],"updatePoint":{"line":85,"column":44},"line":85,"code":"  it('should sign headers for unicode domain', function () {\n    let headerLines = [{\n      key: 'from',\n      line: 'From: andris@node.ee'\n    }, {\n      key: 'to',\n      line: 'To:andris@kreata.ee'\n    }];\n    let dkimField = sign(headerLines, 'sha256', 'z6TUz85EdYrACGMHYgZhJGvVy5oQI0dooVMKa2ZT7c4=', {\n      domainName: 'müriaad-polüteism.info',\n      keySelector: 'dkim',\n      privateKey\n    });\n    expect(dkimField.replace(/\\r?\\n\\s*/g, '').replace(/\\s+/g, '')).to.equal('DKIM-Signature:v=1;a=rsa-sha256;c=relaxed/relaxed;d=xn--mriaad-polteism-zvbj.info;q=dns/txt;s=dkim;bh=z6TUz85EdYrACGMHYgZhJGvVy5oQI0dooVMKa2ZT7c4=;h=from:to;b=oBJ1MkwEkftfXa2AK4Expjp2xgIcAR43SVrftSEHVQ6F1SlGjP3EKP+cn/hLkhUel3rY0icthk/myDu6uhTBmM6DMtzIBW/7uQd6q9hfgaiYnw5Iew2tZc4TzBEYSdKi');\n  });","file":"dkim/sign-test.js","skipped":false,"dir":"test"},{"name":"should create an account and send a message","suites":["Ethereal Tests"],"updatePoint":{"line":15,"column":49},"line":15,"code":"  it('should create an account and send a message', function (done) {\n    // Generate SMTP service account from ethereal.email\n    nodemailer.createTestAccount((err, account) => {\n      expect(err).to.not.exist;\n      expect(account.user).to.exist;\n      let transporter = nodemailer.createTransport({\n        host: account.smtp.host,\n        port: account.smtp.port,\n        secure: account.smtp.secure,\n        auth: {\n          user: account.user,\n          pass: account.pass\n        }\n      }); // Message object\n\n      let message = {\n        from: 'Pangalink <no-reply@pangalink.net>',\n        to: 'Andris Reinman <andris.reinman@gmail.com>',\n        subject: 'Ethereal unit test message',\n        text: 'Hello world',\n        html: '<p>Hello world</p>'\n      };\n      transporter.sendMail(message, (err, info) => {\n        expect(err).to.not.exist;\n        expect(nodemailer.getTestMessageUrl(info)).to.include('ethereal');\n        done();\n      });\n    });\n  });","file":"ethereal-test.js","skipped":false,"dir":"test"},{"name":"should cache a created test account","suites":["Ethereal Tests"],"updatePoint":{"line":44,"column":41},"line":44,"code":"  it('should cache a created test account', function (done) {\n    nodemailer.createTestAccount((err, account) => {\n      expect(err).to.not.exist;\n      nodemailer.createTestAccount((err, account2) => {\n        expect(err).to.not.exist;\n        expect(account2).to.equal(account);\n        done();\n      });\n    });\n  });","file":"ethereal-test.js","skipped":false,"dir":"test"},{"name":"should cache a created test account when using promises","suites":["Ethereal Tests"],"updatePoint":{"line":54,"column":61},"line":54,"code":"  it('should cache a created test account when using promises', function (done) {\n    nodemailer.createTestAccount().then(account => {\n      nodemailer.createTestAccount().then(account2 => {\n        expect(account2).to.equal(account);\n        done();\n      });\n    });\n  });","file":"ethereal-test.js","skipped":false,"dir":"test"},{"name":"should return root path","suites":["Cookie Tests","#getPath"],"updatePoint":{"line":19,"column":31},"line":19,"code":"    it('should return root path', function () {\n      expect(biskviit.getPath('/')).to.equal('/');\n      expect(biskviit.getPath('')).to.equal('/');\n      expect(biskviit.getPath('/index.php')).to.equal('/');\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should return without file","suites":["Cookie Tests","#getPath"],"updatePoint":{"line":24,"column":34},"line":24,"code":"    it('should return without file', function () {\n      expect(biskviit.getPath('/path/to/file')).to.equal('/path/to/');\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should match expired cookie","suites":["Cookie Tests","#isExpired"],"updatePoint":{"line":29,"column":35},"line":29,"code":"    it('should match expired cookie', function () {\n      expect(biskviit.isExpired({\n        name: 'a',\n        value: 'b',\n        expires: new Date(Date.now() + 10000)\n      })).to.be.false;\n      expect(biskviit.isExpired({\n        name: 'a',\n        value: '',\n        expires: new Date(Date.now() + 10000)\n      })).to.be.true;\n      expect(biskviit.isExpired({\n        name: 'a',\n        value: 'b',\n        expires: new Date(Date.now() - 10000)\n      })).to.be.true;\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should match similar cookies","suites":["Cookie Tests","#compare"],"updatePoint":{"line":48,"column":36},"line":48,"code":"    it('should match similar cookies', function () {\n      expect(biskviit.compare({\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      }, {\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      })).to.be.true;\n      expect(biskviit.compare({\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      }, {\n        name: 'yyy',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      })).to.be.false;\n      expect(biskviit.compare({\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      }, {\n        name: 'zzz',\n        path: '/amp',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      })).to.be.false;\n      expect(biskviit.compare({\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      }, {\n        name: 'zzz',\n        path: '/',\n        domain: 'examples.com',\n        secure: false,\n        httponly: false\n      })).to.be.false;\n      expect(biskviit.compare({\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      }, {\n        name: 'zzz',\n        path: '/',\n        domain: 'example.com',\n        secure: true,\n        httponly: false\n      })).to.be.false;\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should append new cookie","suites":["Cookie Tests","#add"],"updatePoint":{"line":117,"column":32},"line":117,"code":"    it('should append new cookie', function () {\n      expect(biskviit.cookies.length).to.equal(0);\n      biskviit.add({\n        name: 'zzz',\n        value: 'abc',\n        path: '/',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      });\n      expect(biskviit.cookies.length).to.equal(1);\n      expect(biskviit.cookies[0].name).to.equal('zzz');\n      expect(biskviit.cookies[0].value).to.equal('abc');\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should update existing cookie","suites":["Cookie Tests","#add"],"updatePoint":{"line":132,"column":37},"line":132,"code":"    it('should update existing cookie', function () {\n      expect(biskviit.cookies.length).to.equal(0);\n      biskviit.add({\n        name: 'zzz',\n        value: 'abc',\n        path: '/',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      });\n      biskviit.add({\n        name: 'zzz',\n        value: 'def',\n        path: '/',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      });\n      expect(biskviit.cookies.length).to.equal(1);\n      expect(biskviit.cookies[0].name).to.equal('zzz');\n      expect(biskviit.cookies[0].value).to.equal('def');\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should check if a cookie matches particular domain and path","suites":["Cookie Tests","#match"],"updatePoint":{"line":158,"column":67},"line":158,"code":"    it('should check if a cookie matches particular domain and path', function () {\n      let cookie = {\n        name: 'zzz',\n        value: 'abc',\n        path: '/def/',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      };\n      expect(biskviit.match(cookie, 'http://example.com/def/')).to.be.true;\n      expect(biskviit.match(cookie, 'http://example.com/bef/')).to.be.false;\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should check if a cookie matches particular domain and path","suites":["Cookie Tests","#match"],"updatePoint":{"line":171,"column":67},"line":171,"code":"    it('should check if a cookie matches particular domain and path', function () {\n      let cookie = {\n        name: 'zzz',\n        value: 'abc',\n        path: '/def',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: false,\n        httponly: false\n      };\n      expect(biskviit.match(cookie, 'http://example.com/def/')).to.be.true;\n      expect(biskviit.match(cookie, 'http://example.com/bef/')).to.be.false;\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should check if a cookie is secure","suites":["Cookie Tests","#match"],"updatePoint":{"line":184,"column":42},"line":184,"code":"    it('should check if a cookie is secure', function () {\n      let cookie = {\n        name: 'zzz',\n        value: 'abc',\n        path: '/def/',\n        expires: new Date(Date.now() + 10000),\n        domain: 'example.com',\n        secure: true,\n        httponly: false\n      };\n      expect(biskviit.match(cookie, 'https://example.com/def/')).to.be.true;\n      expect(biskviit.match(cookie, 'http://example.com/def/')).to.be.false;\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should parse Set-Cookie value","suites":["Cookie Tests","#parse"],"updatePoint":{"line":199,"column":37},"line":199,"code":"    it('should parse Set-Cookie value', function () {\n      expect(biskviit.parse('theme=plain')).to.deep.equal({\n        name: 'theme',\n        value: 'plain'\n      });\n      expect(biskviit.parse('SSID=Ap4P….GTEq; Domain=foo.com; Path=/; Expires=Wed, 13 Jan 2031 22:23:01 GMT; Secure; HttpOnly')).to.deep.equal({\n        name: 'ssid',\n        value: 'Ap4P….GTEq',\n        domain: '.foo.com',\n        path: '/',\n        httponly: true,\n        secure: true,\n        expires: new Date('Wed, 13 Jan 2031 22:23:01 GMT')\n      });\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should ignore invalid expire header","suites":["Cookie Tests","#parse"],"updatePoint":{"line":214,"column":43},"line":214,"code":"    it('should ignore invalid expire header', function () {\n      expect(biskviit.parse('theme=plain; Expires=Wed, 13 Jan 2031 22:23:01 GMT')).to.deep.equal({\n        name: 'theme',\n        value: 'plain',\n        expires: new Date('Wed, 13 Jan 2031 22:23:01 GMT')\n      });\n      expect(biskviit.parse('theme=plain; Expires=ZZZZZZZZ GMT')).to.deep.equal({\n        name: 'theme',\n        value: 'plain'\n      });\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should return matching cookies for an URL","suites":["Cookie Tests","Listing","#list"],"updatePoint":{"line":271,"column":51},"line":271,"code":"      it('should return matching cookies for an URL', function () {\n        expect(biskviit.list('https://www.foo.com')).to.deep.equal([{\n          name: 'ssid1',\n          value: 'Ap4P….GTEq1',\n          domain: '.foo.com',\n          path: '/',\n          httponly: true,\n          secure: true,\n          expires: new Date('Wed, 13 Jan 2031 22:23:01 GMT')\n        }, {\n          name: 'ssid4',\n          value: 'Ap4P….GTEq4',\n          domain: 'www.foo.com',\n          path: '/',\n          httponly: true,\n          secure: true,\n          expires: new Date('Wed, 13 Jan 2031 22:23:01 GMT')\n        }]);\n      });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should return matching cookies for an URL","suites":["Cookie Tests","Listing","#get"],"updatePoint":{"line":292,"column":51},"line":292,"code":"      it('should return matching cookies for an URL', function () {\n        expect(biskviit.get('https://www.foo.com')).to.equal('ssid1=Ap4P….GTEq1; ssid4=Ap4P….GTEq4');\n      });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should set cookie","suites":["Cookie Tests","#set"],"updatePoint":{"line":298,"column":25},"line":298,"code":"    it('should set cookie', function () {\n      // short\n      biskviit.set('theme=plain', 'https://foo.com/'); // long\n\n      biskviit.set('SSID=Ap4P….GTEq; Domain=foo.com; Path=/test; Expires=Wed, 13 Jan 2031 22:23:01 GMT; Secure; HttpOnly', 'https://foo.com/'); // subdomains\n\n      biskviit.set('SSID=Ap4P….GTEq; Domain=.foo.com; Path=/; Expires=Wed, 13 Jan 2031 22:23:01 GMT; Secure; HttpOnly', 'https://www.foo.com/'); // invalid cors\n\n      biskviit.set('invalid_1=cors; domain=example.com', 'https://foo.com/');\n      biskviit.set('invalid_2=cors; domain=www.foo.com', 'https://foo.com/'); // invalid date\n\n      biskviit.set('invalid_3=date; Expires=zzzz', 'https://foo.com/'); // invalid tld\n\n      biskviit.set('invalid_4=cors; domain=.co.uk', 'https://foo.co.uk/'); // should not be added\n\n      biskviit.set('expired_1=date; Expires=1999-01-01 01:01:01 GMT', 'https://foo.com/');\n      expect(biskviit.cookies.map(function (cookie) {\n        delete cookie.expires;\n        return cookie;\n      })).to.deep.equal([{\n        name: 'theme',\n        value: 'plain',\n        domain: 'foo.com',\n        path: '/'\n      }, {\n        name: 'ssid',\n        value: 'Ap4P….GTEq',\n        domain: 'foo.com',\n        path: '/test',\n        secure: true,\n        httponly: true\n      }, {\n        name: 'ssid',\n        value: 'Ap4P….GTEq',\n        domain: 'www.foo.com',\n        path: '/',\n        secure: true,\n        httponly: true\n      }, {\n        name: 'invalid_1',\n        value: 'cors',\n        domain: 'foo.com',\n        path: '/'\n      }, {\n        name: 'invalid_2',\n        value: 'cors',\n        domain: 'foo.com',\n        path: '/'\n      }, {\n        name: 'invalid_3',\n        value: 'date',\n        domain: 'foo.com',\n        path: '/'\n      }, {\n        name: 'invalid_4',\n        value: 'cors',\n        domain: 'foo.co.uk',\n        path: '/'\n      }]);\n    });","file":"fetch/cookies-test.js","skipped":false,"dir":"test"},{"name":"should fetch HTTP data","suites":["Fetch Tests"],"updatePoint":{"line":163,"column":28},"line":163,"code":"  it('should fetch HTTP data', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT);\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTP\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should fetch HTTPS data","suites":["Fetch Tests"],"updatePoint":{"line":174,"column":29},"line":174,"code":"  it('should fetch HTTPS data', function (done) {\n    let req = fetch('https://localhost:' + HTTPS_PORT);\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTPS\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should fetch HTTP data with redirects","suites":["Fetch Tests"],"updatePoint":{"line":185,"column":43},"line":185,"code":"  it('should fetch HTTP data with redirects', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/redirect3');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTP\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for too many redirects","suites":["Fetch Tests"],"updatePoint":{"line":196,"column":48},"line":196,"code":"  it('should return error for too many redirects', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/redirect6');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should fetch HTTP data with custom redirect limit","suites":["Fetch Tests"],"updatePoint":{"line":208,"column":55},"line":208,"code":"  it('should fetch HTTP data with custom redirect limit', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/redirect3', {\n      maxRedirects: 3\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTP\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for custom redirect limit","suites":["Fetch Tests"],"updatePoint":{"line":221,"column":51},"line":221,"code":"  it('should return error for custom redirect limit', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/redirect3', {\n      maxRedirects: 2\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return disable redirects","suites":["Fetch Tests"],"updatePoint":{"line":235,"column":37},"line":235,"code":"  it('should return disable redirects', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/redirect1', {\n      maxRedirects: 0\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should unzip compressed HTTP data","suites":["Fetch Tests"],"updatePoint":{"line":249,"column":39},"line":249,"code":"  it('should unzip compressed HTTP data', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/gzip');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTP\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for unresolved host","suites":["Fetch Tests"],"updatePoint":{"line":260,"column":45},"line":260,"code":"  it('should return error for unresolved host', function (done) {\n    let req = fetch('http://asfhaskhhgbjdsfhgbsdjgk');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid status","suites":["Fetch Tests"],"updatePoint":{"line":272,"column":44},"line":272,"code":"  it('should return error for invalid status', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/invalid');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should allow invalid status","suites":["Fetch Tests"],"updatePoint":{"line":284,"column":33},"line":284,"code":"  it('should allow invalid status', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/invalid', {\n      allowErrorResponse: true\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.not.exist;\n    });\n    req.on('end', function () {\n      expect(req.statusCode).to.equal(500);\n      expect(Buffer.concat(buf).toString()).to.equal('Hello World HTTP\\n');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid url","suites":["Fetch Tests"],"updatePoint":{"line":301,"column":41},"line":301,"code":"  it('should return error for invalid url', function (done) {\n    let req = fetch('http://localhost:99999999/');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return timeout error","suites":["Fetch Tests"],"updatePoint":{"line":313,"column":33},"line":313,"code":"  it('should return timeout error', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/forever', {\n      timeout: 1000\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should handle basic HTTP auth","suites":["Fetch Tests"],"updatePoint":{"line":327,"column":35},"line":327,"code":"  it('should handle basic HTTP auth', function (done) {\n    let req = fetch('http://user:pass@localhost:' + HTTP_PORT + '/auth');\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('user:pass');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid protocol","suites":["Fetch Tests"],"updatePoint":{"line":341,"column":48},"line":341,"code":"    it('should return error for invalid protocol', function (done) {\n      let req = fetch('http://localhost:' + HTTPS_PORT);\n      let buf = [];\n      req.on('data', function (chunk) {\n        buf.push(chunk);\n      });\n      req.on('error', function (err) {\n        expect(err).to.exist;\n        done();\n      });\n      req.on('end', function () {});\n    });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should set cookie value","suites":["Fetch Tests"],"updatePoint":{"line":355,"column":29},"line":355,"code":"  it('should set cookie value', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/cookie', {\n      cookie: 'test=pest'\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('test=pest');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should set user agent","suites":["Fetch Tests"],"updatePoint":{"line":368,"column":27},"line":368,"code":"  it('should set user agent', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/ua', {\n      userAgent: 'nodemailer-fetch'\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('nodemailer-fetch');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should post data","suites":["Fetch Tests"],"updatePoint":{"line":381,"column":22},"line":381,"code":"  it('should post data', function (done) {\n    let req = fetch('http://localhost:' + HTTP_PORT + '/post', {\n      method: 'post',\n      body: {\n        hello: 'world 😭',\n        another: 'value'\n      }\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal('hello=world%20%F0%9F%98%AD&another=value');\n      done();\n    });\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should post stream data","suites":["Fetch Tests"],"updatePoint":{"line":398,"column":29},"line":398,"code":"  it('should post stream data', function (done) {\n    let body = new PassThrough();\n    let data = Buffer.from('hello=world%20%F0%9F%98%AD&another=value');\n    let req = fetch('http://localhost:' + HTTP_PORT + '/post', {\n      method: 'post',\n      body\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('end', function () {\n      expect(Buffer.concat(buf).toString()).to.equal(data.toString());\n      done();\n    });\n    let pos = 0;\n\n    let writeNext = function () {\n      if (pos >= data.length) {\n        return body.end();\n      }\n\n      let char = data.slice(pos++, pos);\n      body.write(char);\n      setImmediate(writeNext);\n    };\n\n    setImmediate(writeNext);\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid cert","suites":["Fetch Tests"],"updatePoint":{"line":427,"column":42},"line":427,"code":"  it('should return error for invalid cert', function (done) {\n    let req = fetch('https://localhost:' + HTTPS_PORT, {\n      tls: {\n        rejectUnauthorized: true\n      }\n    });\n    let buf = [];\n    req.on('data', function (chunk) {\n      buf.push(chunk);\n    });\n    req.on('error', function (err) {\n      expect(err).to.exist;\n      done();\n    });\n    req.on('end', function () {});\n  });","file":"fetch/fetch-test.js","skipped":false,"dir":"test"},{"name":"should return an JSON string","suites":["JSON Transport Tests"],"updatePoint":{"line":15,"column":34},"line":15,"code":"  it('should return an JSON string', function (done) {\n    let transport = nodemailer.createTransport({\n      jsonTransport: true\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: {\n        path: __dirname + '/fixtures/body.html'\n      },\n      text: 'hello world',\n      attachments: [{\n        filename: 'img.png',\n        path: __dirname + '/fixtures/image.png'\n      }, {\n        path: __dirname + '/fixtures/image.png'\n      }]\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(JSON.parse(info.message)).to.deep.equal({\n        from: {\n          address: 'andris.reinman@gmail.com',\n          name: 'Andris Reinman'\n        },\n        to: [//\n        {\n          address: 'andris@kreata.ee',\n          name: 'Andris Kreata'\n        }, {\n          address: 'andris@nodemailer.com',\n          name: ''\n        }],\n        cc: [{\n          address: 'info@nodemailer.com',\n          name: ''\n        }],\n        subject: 'Awesome!',\n        html: '<h1>Message</h1>\\n\\n<p>\\n    Body\\n</p>\\n',\n        text: 'hello world',\n        attachments: [{\n          content: 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAD///+l2Z/dAAAAM0lEQVR4nGP4/5/h/1+G/58ZDrAz3D/McH8yw83NDDeNGe4Ug9C9zwz3gVLMDA/A6P9/AFGGFyjOXZtQAAAAAElFTkSuQmCC',\n          filename: 'img.png',\n          contentType: 'image/png',\n          encoding: 'base64'\n        }, {\n          content: 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAD///+l2Z/dAAAAM0lEQVR4nGP4/5/h/1+G/58ZDrAz3D/McH8yw83NDDeNGe4Ug9C9zwz3gVLMDA/A6P9/AFGGFyjOXZtQAAAAAElFTkSuQmCC',\n          filename: 'image.png',\n          contentType: 'image/png',\n          encoding: 'base64'\n        }],\n        headers: {},\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>'\n      });\n      done();\n    });\n  });","file":"json-transport/json-transport-test.js","skipped":false,"dir":"test"},{"name":"should return an JSON string for calendar event","suites":["JSON Transport Tests"],"updatePoint":{"line":76,"column":53},"line":76,"code":"  it('should return an JSON string for calendar event', function (done) {\n    let transport = nodemailer.createTransport({\n      jsonTransport: true\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: '<p>hello world!</p>',\n      text: 'hello world',\n      icalEvent: {\n        method: 'request',\n        path: __dirname + '/fixtures/event.ics'\n      }\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(JSON.parse(info.message)).to.deep.equal({\n        from: {\n          address: 'andris.reinman@gmail.com',\n          name: 'Andris Reinman'\n        },\n        to: [//\n        {\n          address: 'andris@kreata.ee',\n          name: 'Andris Kreata'\n        }, {\n          address: 'andris@nodemailer.com',\n          name: ''\n        }],\n        cc: [{\n          address: 'info@nodemailer.com',\n          name: ''\n        }],\n        subject: 'Awesome!',\n        text: 'hello world',\n        html: '<p>hello world!</p>',\n        icalEvent: {\n          content: 'QkVHSU46VkNBTEVOREFSClZFUlNJT046Mi4wClBST0RJRDotLy9oYWNrc3cvaGFuZGNhbC8vTk9OU0dNTCB2MS4wLy9FTgpCRUdJTjpWRVZFTlQKVUlEOnVpZDFAZXhhbXBsZS5jb20KRFRTVEFNUDoxOTk3MDcxNFQxNzAwMDBaCk9SR0FOSVpFUjtDTj1Kb2huIERvZTpNQUlMVE86am9obi5kb2VAZXhhbXBsZS5jb20KRFRTVEFSVDoxOTk3MDcxNFQxNzAwMDBaCkRURU5EOjE5OTcwNzE1VDAzNTk1OVoKU1VNTUFSWTpCYXN0aWxsZSBEYXkgUGFydHkKRU5EOlZFVkVOVApFTkQ6VkNBTEVOREFSCg==',\n          encoding: 'base64',\n          method: 'request'\n        },\n        headers: {},\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>'\n      });\n      done();\n    });\n  });","file":"json-transport/json-transport-test.js","skipped":false,"dir":"test"},{"name":"should create new MailComposer","suites":["MailComposer unit tests"],"updatePoint":{"line":15,"column":36},"line":15,"code":"  it('should create new MailComposer', function () {\n    expect(new MailComposer({})).to.exist;\n  });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use Mixed structure with text and attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":19,"column":59},"line":19,"code":"    it('should use Mixed structure with text and attachment', function () {\n      let data = {\n        text: 'abc',\n        attachments: [{\n          content: 'abc'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createMixed');\n      compiler.compile();\n      expect(compiler._createMixed.callCount).to.equal(1);\n\n      compiler._createMixed.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use Mixed structure with multiple attachments","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":33,"column":60},"line":33,"code":"    it('should use Mixed structure with multiple attachments', function () {\n      let data = {\n        attachments: [{\n          content: 'abc'\n        }, {\n          content: 'def'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createMixed');\n      compiler.compile();\n      expect(compiler._createMixed.callCount).to.equal(1);\n\n      compiler._createMixed.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure with text and html","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":48,"column":62},"line":48,"code":"    it('should create Alternative structure with text and html', function () {\n      let data = {\n        text: 'abc',\n        html: 'def'\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile();\n      expect(compiler._createAlternative.callCount).to.equal(1);\n      expect(compiler._alternatives.length).to.equal(2);\n      expect(compiler._alternatives[0].contentType).to.equal('text/plain; charset=utf-8');\n      expect(compiler._alternatives[1].contentType).to.equal('text/html; charset=utf-8');\n\n      compiler._createAlternative.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure with text, watchHtml and html","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":63,"column":73},"line":63,"code":"    it('should create Alternative structure with text, watchHtml and html', function () {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        watchHtml: 'ghi'\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile();\n      expect(compiler._createAlternative.callCount).to.equal(1);\n      expect(compiler._alternatives.length).to.equal(3);\n      expect(compiler._alternatives[0].contentType).to.equal('text/plain; charset=utf-8');\n      expect(compiler._alternatives[1].contentType).to.equal('text/watch-html; charset=utf-8');\n      expect(compiler._alternatives[2].contentType).to.equal('text/html; charset=utf-8');\n\n      compiler._createAlternative.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure with text, amp and html","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":80,"column":67},"line":80,"code":"    it('should create Alternative structure with text, amp and html', function () {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        amp: 'ghi'\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile();\n      expect(compiler._createAlternative.callCount).to.equal(1);\n      expect(compiler._alternatives.length).to.equal(3);\n      expect(compiler._alternatives[0].contentType).to.equal('text/plain; charset=utf-8');\n      expect(compiler._alternatives[1].contentType).to.equal('text/x-amp-html; charset=utf-8');\n      expect(compiler._alternatives[2].contentType).to.equal('text/html; charset=utf-8');\n\n      compiler._createAlternative.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure with text, icalEvent and html","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":97,"column":73},"line":97,"code":"    it('should create Alternative structure with text, icalEvent and html', function () {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        icalEvent: 'ghi'\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile();\n      expect(compiler._createAlternative.callCount).to.equal(1);\n      expect(compiler._alternatives.length).to.equal(3);\n      expect(compiler._alternatives[0].contentType).to.equal('text/plain; charset=utf-8');\n      expect(compiler._alternatives[1].contentType).to.equal('text/html; charset=utf-8');\n      expect(compiler._alternatives[2].contentType).to.equal('text/calendar; charset=utf-8; method=PUBLISH');\n\n      compiler._createAlternative.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure using encoded icalEvent","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":114,"column":67},"line":114,"code":"    it('should create Alternative structure using encoded icalEvent', function (done) {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        icalEvent: {\n          method: 'publish',\n          content: 'dGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZQ==',\n          encoding: 'base64'\n        }\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile().build(function (err, message) {\n        expect(err).to.not.exist;\n        let msg = message.toString();\n        expect(msg.indexOf('\\r\\ntere tere tere tere tere tere tere tere tere tere tere tere tere tere tere =\\r\\ntere tere tere tere tere tere tere\\r\\n')).to.be.gte(0);\n        expect(msg.indexOf('\\r\\ndGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRl\\r\\ncmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZSB0ZXJlIHRlcmUgdGVyZQ==\\r\\n')).to.be.gte(0);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Alternative structure with text, html and cid attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":134,"column":78},"line":134,"code":"    it('should create Alternative structure with text, html and cid attachment', function () {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        attachments: [{\n          content: 'abc',\n          cid: 'aaa'\n        }, {\n          content: 'def',\n          cid: 'bbb'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createAlternative');\n      compiler.compile();\n      expect(compiler._createAlternative.callCount).to.equal(1);\n\n      compiler._createAlternative.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create Related structure with html and cid attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":153,"column":68},"line":153,"code":"    it('should create Related structure with html and cid attachment', function () {\n      let data = {\n        html: 'def',\n        attachments: [{\n          content: 'abc',\n          cid: 'aaa'\n        }, {\n          content: 'def',\n          cid: 'bbb'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createRelated');\n      compiler.compile();\n      expect(compiler._createRelated.callCount).to.equal(1);\n\n      compiler._createRelated.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create content node with only text","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":171,"column":49},"line":171,"code":"    it('should create content node with only text', function () {\n      let data = {\n        text: 'def'\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createContentNode');\n      compiler.compile();\n      expect(compiler._createContentNode.callCount).to.equal(1);\n\n      compiler._createContentNode.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create content node with only an attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":182,"column":58},"line":182,"code":"    it('should create content node with only an attachment', function () {\n      let data = {\n        attachments: [{\n          content: 'abc',\n          cid: 'aaa'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      sinon.spy(compiler, '_createContentNode');\n      compiler.compile();\n      expect(compiler._createContentNode.callCount).to.equal(1);\n\n      compiler._createContentNode.restore();\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create content node with encoded buffer","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":196,"column":54},"line":196,"code":"    it('should create content node with encoded buffer', function () {\n      let str = 'tere tere';\n      let data = {\n        text: {\n          content: Buffer.from(str).toString('base64'),\n          encoding: 'base64'\n        }\n      };\n      let compiler = new MailComposer(data);\n      compiler.compile();\n      expect(compiler.message.content).to.deep.equal(Buffer.from(str));\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create content node from data url","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":208,"column":48},"line":208,"code":"    it('should create content node from data url', function () {\n      let str = 'tere tere';\n      let data = {\n        attachments: [{\n          href: 'data:image/png,tere%20tere'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      let mail = compiler.compile();\n      expect(mail.messageId()).to.exist;\n      expect(compiler.mail.attachments[0].content).to.deep.equal(Buffer.from(str));\n      expect(compiler.mail.attachments[0].contentType).to.equal('image/png');\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should not treat invalid content-type as multipart","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":221,"column":58},"line":221,"code":"    it('should not treat invalid content-type as multipart', function () {\n      let data = {\n        from: {\n          name: 'sender name',\n          address: 'sender@example.com'\n        },\n        to: [{\n          address: 'andris@ethereal.email'\n        }],\n        subject: 'Hello world!',\n        text: 'Test message',\n        attachments: [{\n          contentType: 'other',\n          content: Buffer.from('tere').toString('base64'),\n          encoding: 'base64'\n        }]\n      };\n      let compiler = new MailComposer(data);\n      let mail = compiler.compile();\n      let attachmentHeaders = mail.childNodes[1].buildHeaders(); // attachment header must not contain mutipart header\n\n      expect(attachmentHeaders.indexOf('boundary=')).to.lt(0);\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should create the same output","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":244,"column":37},"line":244,"code":"    it('should create the same output', function (done) {\n      let data = {\n        text: 'abc',\n        html: 'def',\n        baseBoundary: 'test',\n        messageId: '<zzzzzz>',\n        headers: {\n          'x-processed': 'a really long header or value with non-ascii characters 👮',\n          'x-unprocessed': {\n            prepared: true,\n            value: 'a really long header or value with non-ascii characters 👮'\n          }\n        },\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000'\n      };\n      let expected = '' + 'Content-Type: multipart/alternative; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'X-Processed: =?UTF-8?Q?a_really_long_header_or_value_with_non-a?=\\r\\n' + ' =?UTF-8?Q?scii_characters_=F0=9F=91=AE?=\\r\\n' + 'X-Unprocessed: a really long header or value with non-ascii characters 👮\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'abc\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/html; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'def\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      expect(mail.messageId()).to.equal('<zzzzzz>');\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use raw input for the message","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":268,"column":44},"line":268,"code":"    it('should use raw input for the message', function (done) {\n      let data = {\n        raw: 'test test test\\r\\n',\n        envelope: {\n          from: 'Daemon <deamon@kreata.ee>',\n          to: 'mailer@kreata.ee, Mailer <mailer2@kreata.ee>'\n        }\n      };\n      let expected = 'test test test\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(mail.getEnvelope()).to.deep.equal({\n          from: 'deamon@kreata.ee',\n          to: ['mailer@kreata.ee', 'mailer2@kreata.ee']\n        });\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use raw input for different parts","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":288,"column":48},"line":288,"code":"    it('should use raw input for different parts', function (done) {\n      let data = {\n        from: 'test1@example.com',\n        to: 'test2@example.com',\n        bcc: 'test3@example.com',\n        text: {\n          raw: 'rawtext'\n        },\n        html: {\n          raw: 'rawhtml'\n        },\n        watchHtml: {\n          raw: 'rawwatch'\n        },\n        amp: {\n          raw: 'rawamp'\n        },\n        messageId: 'rawtest',\n        icalEvent: {\n          raw: 'rawcalendar'\n        },\n        attachments: [{\n          raw: 'rawattachment'\n        }],\n        alternatives: [{\n          raw: 'rawalternative'\n        }],\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        baseBoundary: 'test'\n      };\n      let expected = 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'From: test1@example.com\\r\\n' + 'To: test2@example.com\\r\\n' + 'Message-ID: <rawtest>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: multipart/alternative; boundary=\"--_NmP-test-Part_2\"\\r\\n' + '\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawtext\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawwatch\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawamp\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawhtml\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawcalendar\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'rawalternative\\r\\n' + '----_NmP-test-Part_2--\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'rawattachment\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'rawcalendar\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should discard BCC","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":326,"column":26},"line":326,"code":"    it('should discard BCC', function (done) {\n      let data = {\n        from: 'test1@example.com',\n        to: 'test2@example.com',\n        bcc: 'test3@example.com',\n        text: 'def',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000'\n      };\n      let expected = '' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'From: test1@example.com\\r\\n' + 'To: test2@example.com\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'def\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should autodetect text encoding","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":343,"column":39},"line":343,"code":"    it('should autodetect text encoding', function (done) {\n      let data = {\n        from: 'ÄÄÄÄ test1@example.com',\n        to: 'AAAÄ test2@example.com',\n        subject: 'def ÄÄÄÄ foo AAAÄ',\n        text: 'def ÄÄÄÄ foo AAAÄ',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000'\n      };\n      let expected = '' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'From: =?UTF-8?B?w4TDhMOEw4Q=?= <test1@example.com>\\r\\n' + 'To: =?UTF-8?Q?AAA=C3=84?= <test2@example.com>\\r\\n' + 'Subject: =?UTF-8?Q?def_=C3=84=C3=84=C3=84=C3=84_foo_AAA?=\\r\\n' + ' =?UTF-8?Q?=C3=84?=\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'Content-Transfer-Encoding: quoted-printable\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'def =C3=84=C3=84=C3=84=C3=84 foo AAA=C3=84\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use quoted-printable text encoding","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":360,"column":49},"line":360,"code":"    it('should use quoted-printable text encoding', function (done) {\n      let data = {\n        from: 'ÄÄÄÄ test1@example.com',\n        to: 'AAAÄ test2@example.com',\n        subject: 'def ÄÄÄÄ foo AAAÄ',\n        text: 'def ÄÄÄÄ foo AAAÄ',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        textEncoding: 'quoted-printable'\n      };\n      let expected = '' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'From: =?UTF-8?Q?=C3=84=C3=84=C3=84=C3=84?= <test1@example.com>\\r\\n' + 'To: =?UTF-8?Q?AAA=C3=84?= <test2@example.com>\\r\\n' + 'Subject: =?UTF-8?Q?def_=C3=84=C3=84=C3=84=C3=84_foo_AAA?=\\r\\n' + ' =?UTF-8?Q?=C3=84?=\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'Content-Transfer-Encoding: quoted-printable\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'def =C3=84=C3=84=C3=84=C3=84 foo AAA=C3=84\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use base64 text encoding","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":378,"column":39},"line":378,"code":"    it('should use base64 text encoding', function (done) {\n      let data = {\n        from: 'ÄÄÄÄ test1@example.com',\n        to: 'AAAÄ test2@example.com',\n        subject: 'def ÄÄÄÄ foo AAAÄ',\n        text: 'def ÄÄÄÄ foo AAAÄ',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        textEncoding: 'base64'\n      };\n      let expected = '' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'From: =?UTF-8?B?w4TDhMOEw4Q=?= <test1@example.com>\\r\\n' + 'To: =?UTF-8?B?QUFBw4Q=?= <test2@example.com>\\r\\n' + 'Subject: =?UTF-8?B?ZGVmIMOEw4TDhMOEIGZvbyBBQUHDhA==?=\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'ZGVmIMOEw4TDhMOEIGZvbyBBQUHDhA==\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should keep BCC","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":396,"column":23},"line":396,"code":"    it('should keep BCC', function (done) {\n      let data = {\n        from: 'test1@example.com',\n        to: 'test2@example.com',\n        bcc: 'test3@example.com',\n        text: 'def',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000'\n      };\n      let expected = '' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'From: test1@example.com\\r\\n' + 'To: test2@example.com\\r\\n' + 'Bcc: test3@example.com\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'def\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.keepBcc = true;\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should set headers for attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":414,"column":41},"line":414,"code":"    it('should set headers for attachment', function (done) {\n      let data = {\n        text: 'abc',\n        baseBoundary: 'test',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        attachments: [{\n          headers: {\n            'X-Test-1': 12345,\n            'X-Test-2': 'ÕÄÖÜ',\n            'X-Test-3': ['foo', 'bar']\n          },\n          content: 'test',\n          filename: 'test.txt'\n        }]\n      };\n      let expected = '' + 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'abc\\r\\n-' + '---_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; name=test.txt\\r\\n' + 'X-Test-1: 12345\\r\\n' + 'X-Test-2: =?UTF-8?B?w5XDhMOWw5w=?=\\r\\n' + 'X-Test-3: foo\\r\\n' + 'X-Test-3: bar\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'Content-Disposition: attachment; filename=test.txt\\r\\n' + '\\r\\n' + 'dGVzdA==\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should encode filename","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":438,"column":30},"line":438,"code":"    it('should encode filename', function (done) {\n      let data = {\n        text: 'abc',\n        baseBoundary: 'test',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        attachments: [{\n          content: 'test',\n          filename: '\"test\" it is.txt'\n        }]\n      };\n      let expected = '' + 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'abc\\r\\n-' + '---_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; name=\"=?UTF-8?Q?=22test=22_it_is=2Etxt?=\"\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'Content-Disposition: attachment;\\r\\n' + \" filename*0*=utf-8''%22test%22%20it%20is.txt\\r\\n\" + '\\r\\n' + 'dGVzdA==\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should keep plaintext for attachment","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":457,"column":44},"line":457,"code":"    it('should keep plaintext for attachment', function (done) {\n      let data = {\n        text: 'abc',\n        baseBoundary: 'test',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        attachments: [{\n          headers: {\n            'X-Test-1': 12345,\n            'X-Test-2': 'ÕÄÖÜ',\n            'X-Test-3': ['foo', 'bar']\n          },\n          content: 'test',\n          filename: 'test.txt',\n          contentTransferEncoding: false\n        }]\n      };\n      let expected = '' + 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'abc\\r\\n-' + '---_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; name=test.txt\\r\\n' + 'X-Test-1: 12345\\r\\n' + 'X-Test-2: =?UTF-8?B?w5XDhMOWw5w=?=\\r\\n' + 'X-Test-3: foo\\r\\n' + 'X-Test-3: bar\\r\\n' + 'Content-Disposition: attachment; filename=test.txt\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'test\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should ignore attachment filename","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":482,"column":41},"line":482,"code":"    it('should ignore attachment filename', function (done) {\n      let data = {\n        text: 'abc',\n        baseBoundary: 'test',\n        messageId: 'zzzzzz',\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        attachments: [{\n          content: 'test',\n          filename: 'test.txt'\n        }, {\n          content: 'test2',\n          filename: false\n        }]\n      };\n      let expected = '' + 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Message-ID: <zzzzzz>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'abc\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain; name=test.txt\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'Content-Disposition: attachment; filename=test.txt\\r\\n' + '\\r\\n' + 'dGVzdA==\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: application/octet-stream\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'Content-Disposition: attachment\\r\\n' + '\\r\\n' + 'dGVzdDI=\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should add ical alternative","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":504,"column":35},"line":504,"code":"    it('should add ical alternative', function (done) {\n      let data = {\n        from: 'test1@example.com',\n        to: 'test2@example.com',\n        bcc: 'test3@example.com',\n        text: 'def',\n        messageId: 'icaltest',\n        icalEvent: {\n          method: 'request',\n          content: Buffer.from('test').toString('hex'),\n          encoding: 'hex'\n        },\n        date: 'Sat, 21 Jun 2014 10:52:44 +0000',\n        baseBoundary: 'test'\n      };\n      let expected = '' + 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'From: test1@example.com\\r\\n' + 'To: test2@example.com\\r\\n' + 'Message-ID: <icaltest>\\r\\n' + 'Date: Sat, 21 Jun 2014 10:52:44 +0000\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: multipart/alternative; boundary=\"--_NmP-test-Part_2\"\\r\\n' + '\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'Content-Type: text/plain; charset=utf-8\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'def\\r\\n' + '----_NmP-test-Part_2\\r\\n' + 'Content-Type: text/calendar; charset=utf-8; method=REQUEST\\r\\n' + 'Content-Transfer-Encoding: quoted-printable\\r\\n' + '\\r\\n' + 'test\\r\\n' + '----_NmP-test-Part_2--\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: application/ics; name=invite.ics\\r\\n' + 'Content-Disposition: attachment; filename=invite.ics\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + '\\r\\n' + 'dGVzdA==\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.equal(expected);\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should use load attachment from file","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":527,"column":44},"line":527,"code":"    it('should use load attachment from file', function (done) {\n      let data = {\n        text: 'abc',\n        attachments: [{\n          path: __dirname + '/fixtures/attachment.bin'\n        }]\n      };\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.not.exist;\n        expect(message.toString()).to.include('w7VrdmEK');\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should not load attachment from file","suites":["MailComposer unit tests","#compile"],"updatePoint":{"line":541,"column":44},"line":541,"code":"    it('should not load attachment from file', function (done) {\n      let data = {\n        text: 'abc',\n        attachments: [{\n          path: __dirname + '/fixtures/attachment.bin'\n        }],\n        disableFileAccess: true\n      };\n      let mail = new MailComposer(data).compile();\n      mail.build(function (err, message) {\n        expect(err).to.exist;\n        expect(message).to.not.exist;\n        done();\n      });\n    });","file":"mail-composer/mail-composer-test.js","skipped":false,"dir":"test"},{"name":"should detect plain text","suites":["Mime-Funcs Tests","#isPlainText"],"updatePoint":{"line":16,"column":32},"line":16,"code":"    it('should detect plain text', function () {\n      expect(mimeFuncs.isPlainText('abc')).to.be.true;\n      expect(mimeFuncs.isPlainText('abc\\x02')).to.be.false;\n      expect(mimeFuncs.isPlainText('abcõ')).to.be.false;\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should return true","suites":["Mime-Funcs Tests","#isPlainText"],"updatePoint":{"line":21,"column":26},"line":21,"code":"    it('should return true', function () {\n      expect(mimeFuncs.isPlainText('az09\\t\\r\\n~!?')).to.be.true;\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should return false on low bits","suites":["Mime-Funcs Tests","#isPlainText"],"updatePoint":{"line":24,"column":39},"line":24,"code":"    it('should return false on low bits', function () {\n      expect(mimeFuncs.isPlainText('az09\\n\\x08!?')).to.be.false;\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should return false on high bits","suites":["Mime-Funcs Tests","#isPlainText"],"updatePoint":{"line":27,"column":40},"line":27,"code":"    it('should return false on high bits', function () {\n      expect(mimeFuncs.isPlainText('az09\\nõ!?')).to.be.false;\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should detect longer lines","suites":["Mime-Funcs Tests","#hasLongerLines"],"updatePoint":{"line":32,"column":34},"line":32,"code":"    it('should detect longer lines', function () {\n      expect(mimeFuncs.hasLongerLines('abc\\ndef', 5)).to.be.false;\n      expect(mimeFuncs.hasLongerLines('juf\\nabcdef\\nghi', 5)).to.be.true;\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode quoted-printable","suites":["Mime-Funcs Tests","#encodeWord"],"updatePoint":{"line":38,"column":38},"line":38,"code":"    it('should encode quoted-printable', function () {\n      expect('=?UTF-8?Q?See_on_=C3=B5hin_test?=').to.equal(mimeFuncs.encodeWord('See on õhin test'));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode base64","suites":["Mime-Funcs Tests","#encodeWord"],"updatePoint":{"line":41,"column":28},"line":41,"code":"    it('should encode base64', function () {\n      expect('=?UTF-8?B?U2VlIG9uIMO1aGluIHRlc3Q=?=').to.equal(mimeFuncs.encodeWord('See on õhin test', 'B'));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode Ascii range","suites":["Mime-Funcs Tests","#encodeWords"],"updatePoint":{"line":46,"column":33},"line":46,"code":"    it('should encode Ascii range', function () {\n      let input1 = 'метель\" вьюга',\n          input2 = 'метель\\x27вьюга',\n          input3 = 'Verão você vai adorar!',\n          output1 = '=?UTF-8?Q?=D0=BC=D0=B5=D1=82=D0=B5=D0=BB=D1=8C=22_?= =?UTF-8?Q?=D0=B2=D1=8C=D1=8E=D0=B3=D0=B0?=',\n          output2 = '=?UTF-8?Q?=D0=BC=D0=B5=D1=82=D0=B5=D0=BB=D1=8C=27?= =?UTF-8?Q?=D0=B2=D1=8C=D1=8E=D0=B3=D0=B0?=',\n          output3 = '=?UTF-8?Q?Ver=C3=A3o_voc=C3=AA?= vai adorar!',\n          output4 = '=?UTF-8?Q?Ver=C3=A3o_voc=C3=AA_vai_adorar!?=';\n      expect(mimeFuncs.encodeWords(input1, 'Q', 52)).to.equal(output1);\n      expect(mimeFuncs.encodeWords(input2, 'Q', 52)).to.equal(output2);\n      expect(mimeFuncs.encodeWords(input3, 'Q', 52)).to.equal(output3);\n      expect(mimeFuncs.encodeWords(input3, 'Q', 52, true)).to.equal(output4);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should split QP on maxLength","suites":["Mime-Funcs Tests","#encodeWords"],"updatePoint":{"line":59,"column":36},"line":59,"code":"    it('should split QP on maxLength', function () {\n      let inputStr = 'Jõgeva Jõgeva Jõgeva mugeva Jõgeva Jõgeva Jõgeva Jõgeva Jõgeva',\n          outputStr = '=?UTF-8?Q?J=C3=B5geva_?= =?UTF-8?Q?J=C3=B5geva_?= =?UTF-8?Q?J=C3=B5geva_?= =?UTF-8?Q?mugeva_J?= =?UTF-8?Q?=C3=B5geva_J?= =?UTF-8?Q?=C3=B5geva_J?= =?UTF-8?Q?=C3=B5geva_J?= =?UTF-8?Q?=C3=B5geva_J?= =?UTF-8?Q?=C3=B5geva?=',\n          encoded = mimeFuncs.encodeWords(inputStr, 'Q', 16);\n      expect(outputStr).to.equal(encoded);\n      expect(inputStr).to.equal(libmime.decodeWords(encoded));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should split base64 on maxLength","suites":["Mime-Funcs Tests","#encodeWords"],"updatePoint":{"line":66,"column":40},"line":66,"code":"    it('should split base64 on maxLength', function () {\n      let inputStr = 'õõõõõ õõõõõ õõõõõ mugeva õõõõõ õõõõõ õõõõõ õõõõõ Jõgeva',\n          outputStr = '=?UTF-8?B?w7XDtcO1w7XDtSA=?= =?UTF-8?B?w7XDtcO1w7XDtSA=?= =?UTF-8?B?w7XDtcO1w7XDtSBt?= =?UTF-8?B?dWdldmEgw7XDtcO1?= =?UTF-8?B?w7XDtSDDtcO1w7U=?= =?UTF-8?B?w7XDtSDDtcO1w7U=?= =?UTF-8?B?w7XDtSDDtcO1w7U=?= =?UTF-8?B?w7XDtSBKw7VnZXZh?=',\n          encoded = mimeFuncs.encodeWords(inputStr, 'B', 30);\n      expect(outputStr).to.equal(encoded);\n      expect(inputStr).to.equal(libmime.decodeWords(encoded));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should return unmodified","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":75,"column":32},"line":75,"code":"    it('should return unmodified', function () {\n      expect([{\n        key: 'title',\n        value: 'this is just a title'\n      }]).to.deep.equal(mimeFuncs.buildHeaderParam('title', 'this is just a title', 500));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode and split ascii","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":81,"column":37},"line":81,"code":"    it('should encode and split ascii', function () {\n      expect([{\n        key: 'title*0',\n        value: 'this '\n      }, {\n        key: 'title*1',\n        value: 'is ju'\n      }, {\n        key: 'title*2',\n        value: 'st a '\n      }, {\n        key: 'title*3',\n        value: 'title'\n      }]).to.deep.equal(mimeFuncs.buildHeaderParam('title', 'this is just a title', 5));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode double byte unicode characters","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":96,"column":52},"line":96,"code":"    it('should encode double byte unicode characters', function () {\n      expect([{\n        key: 'title*0*',\n        value: 'utf-8\\x27\\x27Unicode%20title%20%F0%9F%98%8A'\n      }]).to.deep.equal(mimeFuncs.buildHeaderParam('title', 'Unicode title 😊', 50));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode and split unicode","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":102,"column":39},"line":102,"code":"    it('should encode and split unicode', function () {\n      expect([{\n        key: 'title*0*',\n        value: 'utf-8\\x27\\x27this%20is%20'\n      }, {\n        key: 'title*1',\n        value: 'just a title '\n      }, {\n        key: 'title*2*',\n        value: '%C3%B5%C3%A4%C3%B6'\n      }, {\n        key: 'title*3*',\n        value: '%C3%BC'\n      }]).to.deep.equal(mimeFuncs.buildHeaderParam('title', 'this is just a title õäöü', 20));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode and split filename with dashes","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":117,"column":52},"line":117,"code":"    it('should encode and split filename with dashes', function () {\n      expect([{\n        key: 'filename*0*',\n        value: 'utf-8\\x27\\x27%C6%94------%C6%94------%C6%94------%C6%94'\n      }, {\n        key: 'filename*1*',\n        value: '------%C6%94------%C6%94------%C6%94------.pdf'\n      }]).to.deep.equal(mimeFuncs.buildHeaderParam('filename', 'Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------.pdf', 50));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should encode and decode","suites":["Mime-Funcs Tests","#buildHeaderParam"],"updatePoint":{"line":126,"column":32},"line":126,"code":"    it('should encode and decode', function () {\n      let input = 'Lorěm ipsum doloř siť amet, háš peřpetua compřéhenšam at, ei nám modó soleát éxpétěndá! Boňorum vocibůs dignisšim pro ad, ea sensibus efficiendi intellegam ius. Ad nam aperiam delicata voluptaria, vix nobis luptatum ea, ců úsú graeco viďiššě ňusqúam. ';\n      let headerLine = 'content-disposition: attachment; ' + mimeFuncs.buildHeaderParam('filename', input, 50).map(function (item) {\n        return item.key + '=\"' + item.value + '\"';\n      }).join('; ');\n      let parsedHeader = mimeFuncs.parseHeaderValue(headerLine);\n      expect(input).to.equal(libmime.decodeWords(parsedHeader.params.filename));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle default value only","suites":["Mime-Funcs Tests","#parseHeaderValue"],"updatePoint":{"line":136,"column":40},"line":136,"code":"    it('should handle default value only', function () {\n      let str = 'text/plain',\n          obj = {\n        value: 'text/plain',\n        params: {}\n      };\n      expect(mimeFuncs.parseHeaderValue(str)).to.deep.equal(obj);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle unquoted params","suites":["Mime-Funcs Tests","#parseHeaderValue"],"updatePoint":{"line":144,"column":37},"line":144,"code":"    it('should handle unquoted params', function () {\n      let str = 'text/plain; CHARSET= UTF-8; format=flowed;',\n          obj = {\n        value: 'text/plain',\n        params: {\n          charset: 'UTF-8',\n          format: 'flowed'\n        }\n      };\n      expect(mimeFuncs.parseHeaderValue(str)).to.deep.equal(obj);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle quoted params","suites":["Mime-Funcs Tests","#parseHeaderValue"],"updatePoint":{"line":155,"column":35},"line":155,"code":"    it('should handle quoted params', function () {\n      let str = 'text/plain; filename= \";;;\\\\\"\"; format=flowed;',\n          obj = {\n        value: 'text/plain',\n        params: {\n          filename: ';;;\"',\n          format: 'flowed'\n        }\n      };\n      expect(mimeFuncs.parseHeaderValue(str)).to.deep.equal(obj);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle multi line values","suites":["Mime-Funcs Tests","#parseHeaderValue"],"updatePoint":{"line":166,"column":39},"line":166,"code":"    it('should handle multi line values', function () {\n      let str = 'text/plain; single_encoded*=\"UTF-8\\'\\'%C3%95%C3%84%C3%96%C3%9C\";\\n' + ' multi_encoded*0*=UTF-8\\x27\\x27%C3%96%C3%9C;\\n' + ' multi_encoded*1*=%C3%95%C3%84;\\n' + ' no_charset*0=OA;\\n' + ' no_charset*1=OU;\\n' + ' invalid*=utf-8\\x27\\x27 _?\\x27=%ab',\n          obj = {\n        value: 'text/plain',\n        params: {\n          single_encoded: '=?UTF-8?Q?=C3=95=C3=84=C3=96=C3=9C?=',\n          multi_encoded: '=?UTF-8?Q?=C3=96=C3=9C=C3=95=C3=84?=',\n          no_charset: 'OAOU',\n          invalid: '=?utf-8?Q?_=5f=3f\\x27=3d=ab?='\n        }\n      };\n      expect(mimeFuncs.parseHeaderValue(str)).to.deep.equal(obj);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle params only","suites":["Mime-Funcs Tests","#parseHeaderValue"],"updatePoint":{"line":179,"column":33},"line":179,"code":"    it('should handle params only', function () {\n      let str = '; CHARSET= UTF-8; format=flowed;',\n          obj = {\n        value: '',\n        params: {\n          charset: 'UTF-8',\n          format: 'flowed'\n        }\n      };\n      expect(mimeFuncs.parseHeaderValue(str)).to.deep.equal(obj);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should build header value","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":192,"column":33},"line":192,"code":"    it('should build header value', function () {\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test'\n      })).to.equal('test');\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: 'b'\n        }\n      })).to.equal('test; a=b');\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: ';'\n        }\n      })).to.equal('test; a=\";\"');\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: ';\"'\n        }\n      })).to.equal(\"test; a*0*=utf-8''%3B%22\");\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: 'b',\n          c: 'd'\n        }\n      })).to.equal('test; a=b; c=d');\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle unicode filename","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":222,"column":38},"line":222,"code":"    it('should handle unicode filename', function () {\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: 'b',\n          filename: '😁😂 *\\'%()<>@,;:\\\\\"[]?=😃😄zzz😊õäöü😓.pdf'\n        }\n      })).to.equal('test; a=b; filename*0*=utf-8\\x27\\x27%F0%9F%98%81%F0%9F%98%82%20%2A%27%25%28%29; filename*1*=%3C%3E%40%2C%3B%3A%5C%22%5B%5D%3F%3D%F0%9F%98%83; filename*2*=%F0%9F%98%84zzz%F0%9F%98%8A%C3%B5%C3%A4%C3%B6; filename*3*=%C3%BC%F0%9F%98%93.pdf');\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should handle dashed filename","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":231,"column":37},"line":231,"code":"    it('should handle dashed filename', function () {\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          filename: 'Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------.pdf'\n        }\n      })).to.equal('test; filename*0*=utf-8\\x27\\x27%C6%94------%C6%94------%C6%94------%C6%94; filename*1*=------%C6%94------%C6%94------%C6%94------.pdf');\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should split emoji filename","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":239,"column":35},"line":239,"code":"    it('should split emoji filename', function () {\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          a: 'b',\n          filename: 'Jõge-vaŽJõge-vaŽJõge-vaŽ.pdf'\n        }\n      })).to.equal('test; a=b; filename*0*=utf-8\\x27\\x27J%C3%B5ge-va%C5%BDJ%C3%B5ge-va%C5%BDJ; filename*1*=%C3%B5ge-va%C5%BD.pdf');\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should quote filename with spaces","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":248,"column":41},"line":248,"code":"    it('should quote filename with spaces', function () {\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          filename: 'document a.pdf'\n        }\n      })).to.equal('test; filename=\"document a.pdf\"');\n    }); // For exhaustive list of special characters","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should quote filename with special characters","suites":["Mime-Funcs Tests","#_buildHeaderValue"],"updatePoint":{"line":258,"column":53},"line":258,"code":"    it('should quote filename with special characters', function () {\n      // The case of browser downloads when we download multiple files with same name.\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          filename: 'receipt(3).pdf'\n        }\n      })).to.equal('test; filename=\"receipt(3).pdf\"'); // For headers which are comma separated as in case of multiple from members elements.\n\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          filename: 'jack,jill.pdf'\n        }\n      })).to.equal('test; filename=\"jack,jill.pdf\"'); // Added support for some more special characters\n\n      let correctString = ['space=\"x y\"', 'small_bracket_open=\"x(y\"', 'small_bracket_close=\"x)y\"', 'angle_bracket_open=\"x<y\"', 'angle_bracket_close=\"x>y\"', 'at_the_rate=\"x@y\"', 'semicolon=\"x;y\"', 'colon=\"x:y\"', 'back_slash=\"x\\\\\\\\y\"', 'single_quote=\"x\\'y\"', \"double_quotes*0*=utf-8''x%22y\", 'forward_slash=\"x/y\"', 'big_bracket_open=\"x[y\"', 'big_bracket_close=\"x]y\"', 'question_mark=\"x?y\"', 'comma=\"x,y\"', 'equals=\"x=y\"', 'negative_in_mid=x-y', 'negative_in_start=\"-x\"'].join('; ');\n      expect(mimeFuncs.buildHeaderValue({\n        value: 'test',\n        params: {\n          space: 'x y',\n          small_bracket_open: 'x(y',\n          small_bracket_close: 'x)y',\n          angle_bracket_open: 'x<y',\n          angle_bracket_close: 'x>y',\n          at_the_rate: 'x@y',\n          semicolon: 'x;y',\n          colon: 'x:y',\n          back_slash: 'x\\\\y',\n          single_quote: 'x\\x27y',\n          double_quotes: 'x\"y',\n          forward_slash: 'x/y',\n          big_bracket_open: 'x[y',\n          big_bracket_close: 'x]y',\n          question_mark: 'x?y',\n          comma: 'x,y',\n          equals: 'x=y',\n          negative_in_mid: 'x-y',\n          negative_in_start: '-x'\n        }\n      })).to.equal('test; ' + correctString);\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should Fold long header line","suites":["Mime-Funcs Tests","#foldLines"],"updatePoint":{"line":302,"column":36},"line":302,"code":"    it('should Fold long header line', function () {\n      let inputStr = 'Subject: Testin command line kirja õkva kakva mõni tõnis kõllas põllas tõllas rõllas jušla kušla tušla musla',\n          outputStr = 'Subject: Testin command line kirja\\r\\n' + ' =?UTF-8?Q?=C3=B5kva_kakva_m=C3=B5ni_t=C3=B5nis_k?=\\r\\n' + ' =?UTF-8?Q?=C3=B5llas_p=C3=B5llas_t=C3=B5llas_r?=\\r\\n' + ' =?UTF-8?Q?=C3=B5llas_ju=C5=A1la_ku=C5=A1la_tu?= =?UTF-8?Q?=C5=A1la?= musla',\n          encodedHeaderLine = mimeFuncs.encodeWords(inputStr, 'Q', 52);\n      expect(outputStr).to.equal(mimeFuncs.foldLines(encodedHeaderLine, 76));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should Fold flowed text","suites":["Mime-Funcs Tests","#foldLines"],"updatePoint":{"line":308,"column":31},"line":308,"code":"    it('should Fold flowed text', function () {\n      let inputStr = 'Testin command line kirja õkva kakva mõni tõnis kõllas põllas tõllas rõllas jušla kušla tušla musla Testin command line kirja õkva kakva mõni tõnis kõllas põllas tõllas rõllas jušla kušla tušla musla',\n          outputStr = 'Testin command line kirja õkva kakva mõni tõnis kõllas põllas tõllas rõllas \\r\\n' + 'jušla kušla tušla musla Testin command line kirja õkva kakva mõni tõnis \\r\\n' + 'kõllas põllas tõllas rõllas jušla kušla tušla musla';\n      expect(outputStr).to.equal(mimeFuncs.foldLines(inputStr, 76, true));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should fold one long line","suites":["Mime-Funcs Tests","#foldLines"],"updatePoint":{"line":313,"column":33},"line":313,"code":"    it('should fold one long line', function () {\n      let inputStr = 'Subject: =?UTF-8?Q?=CB=86=C2=B8=C3=81=C3=8C=C3=93=C4=B1=C3=8F=CB=87=C3=81=C3=9B^=C2=B8\\\\=C3=81=C4=B1=CB=86=C3=8C=C3=81=C3=9B=C3=98^\\\\=CB=9C=C3=9B=CB=9D=E2=84=A2=CB=87=C4=B1=C3=93=C2=B8^\\\\=CB=9C=EF=AC=81^\\\\=C2=B7\\\\=CB=9C=C3=98^=C2=A3=CB=9C#=EF=AC=81^\\\\=C2=A3=EF=AC=81^\\\\=C2=A3=EF=AC=81^\\\\?=',\n          outputStr = 'Subject:\\r\\n =?UTF-8?Q?=CB=86=C2=B8=C3=81=C3=8C=C3=93=C4=B1=C3=8F=CB=87=C3=81=C3=9B^=C2=B8\\\\=C3=81=C4=B1=CB=86=C3=8C=C3=81=C3=9B=C3=98^\\\\=CB=9C=C3=9B=CB=9D=E2=84=A2=CB=87=C4=B1=C3=93=C2=B8^\\\\=CB=9C=EF=AC=81^\\\\=C2=B7\\\\=CB=9C=C3=98^=C2=A3=CB=9C#=EF=AC=81^\\\\=C2=A3=EF=AC=81^\\\\=C2=A3=EF=AC=81^\\\\?=';\n      expect(outputStr).to.equal(mimeFuncs.foldLines(inputStr, 76));\n    });","file":"mime-funcs/mime-funcs-test.js","skipped":false,"dir":"test"},{"name":"should detect default extension","suites":["Mime-Type Tests","#detectExtension"],"updatePoint":{"line":15,"column":39},"line":15,"code":"    it('should detect default extension', function () {\n      expect(mimeTypes.detectExtension(false)).to.equal('bin');\n      expect(mimeTypes.detectExtension('unknown')).to.equal('bin');\n      expect(mimeTypes.detectExtension('application/unknown')).to.equal('bin');\n      expect(mimeTypes.detectExtension('text/unknown')).to.equal('txt');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should detect single extension","suites":["Mime-Type Tests","#detectExtension"],"updatePoint":{"line":21,"column":38},"line":21,"code":"    it('should detect single extension', function () {\n      expect(mimeTypes.detectExtension('text/plain')).to.equal('txt');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should detect first matching extension","suites":["Mime-Type Tests","#detectExtension"],"updatePoint":{"line":24,"column":46},"line":24,"code":"    it('should detect first matching extension', function () {\n      expect(mimeTypes.detectExtension('application/vnd.ms-excel')).to.equal('xls');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should detect default mime type","suites":["Mime-Type Tests","#detectMimeType"],"updatePoint":{"line":29,"column":39},"line":29,"code":"    it('should detect default mime type', function () {\n      expect(mimeTypes.detectMimeType(false)).to.equal('application/octet-stream');\n      expect(mimeTypes.detectMimeType('unknown')).to.equal('application/octet-stream');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should detect single mime type","suites":["Mime-Type Tests","#detectMimeType"],"updatePoint":{"line":33,"column":38},"line":33,"code":"    it('should detect single mime type', function () {\n      expect(mimeTypes.detectMimeType('txt')).to.equal('text/plain');\n      expect(mimeTypes.detectMimeType('test.txt')).to.equal('text/plain');\n      expect(mimeTypes.detectMimeType('path/to/test.txt?id=123')).to.equal('text/plain');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should detect first matching mime type","suites":["Mime-Type Tests","#detectMimeType"],"updatePoint":{"line":38,"column":46},"line":38,"code":"    it('should detect first matching mime type', function () {\n      expect(mimeTypes.detectMimeType('sgml')).to.equal('text/sgml');\n      expect(mimeTypes.detectMimeType('test.sgml')).to.equal('text/sgml');\n      expect(mimeTypes.detectMimeType('path/to/test.sgml?id=123')).to.equal('text/sgml');\n    });","file":"mime-funcs/mime-types-test.js","skipped":false,"dir":"test"},{"name":"should create MimeNode object","suites":["MimeNode Tests"],"updatePoint":{"line":21,"column":35},"line":21,"code":"  it('should create MimeNode object', function () {\n    expect(new MimeNode()).to.exist;\n  });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should create child","suites":["MimeNode Tests","#createChild"],"updatePoint":{"line":25,"column":27},"line":25,"code":"    it('should create child', function () {\n      let mb = new MimeNode('multipart/mixed');\n      let child = mb.createChild('multipart/mixed');\n      expect(child.parentNode).to.equal(mb);\n      expect(child.rootNode).to.equal(mb);\n      let subchild1 = child.createChild('text/html');\n      expect(subchild1.parentNode).to.equal(child);\n      expect(subchild1.rootNode).to.equal(mb);\n      let subchild2 = child.createChild('text/html');\n      expect(subchild2.parentNode).to.equal(child);\n      expect(subchild2.rootNode).to.equal(mb);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should append child node","suites":["MimeNode Tests","#appendChild"],"updatePoint":{"line":39,"column":32},"line":39,"code":"    it('should append child node', function () {\n      let mb = new MimeNode('multipart/mixed');\n      let child = new MimeNode('text/plain');\n      mb.appendChild(child);\n      expect(child.parentNode).to.equal(mb);\n      expect(child.rootNode).to.equal(mb);\n      expect(mb.childNodes.length).to.equal(1);\n      expect(mb.childNodes[0]).to.equal(child);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should replace node","suites":["MimeNode Tests","#replace"],"updatePoint":{"line":50,"column":27},"line":50,"code":"    it('should replace node', function () {\n      let mb = new MimeNode(),\n          child = mb.createChild('text/plain'),\n          replacement = new MimeNode('image/png');\n      child.replace(replacement);\n      expect(mb.childNodes.length).to.equal(1);\n      expect(mb.childNodes[0]).to.equal(replacement);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should remove node","suites":["MimeNode Tests","#remove"],"updatePoint":{"line":60,"column":26},"line":60,"code":"    it('should remove node', function () {\n      let mb = new MimeNode(),\n          child = mb.createChild('text/plain');\n      child.remove();\n      expect(mb.childNodes.length).to.equal(0);\n      expect(child.parenNode).to.not.exist;\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set header","suites":["MimeNode Tests","#setHeader"],"updatePoint":{"line":69,"column":25},"line":69,"code":"    it('should set header', function () {\n      let mb = new MimeNode();\n      mb.setHeader('key', 'value');\n      mb.setHeader('key', 'value1');\n      expect(mb.getHeader('Key')).to.equal('value1');\n      mb.setHeader([{\n        key: 'key',\n        value: 'value2'\n      }, {\n        key: 'key2',\n        value: 'value3'\n      }]);\n      expect(mb._headers).to.deep.equal([{\n        key: 'Key',\n        value: 'value2'\n      }, {\n        key: 'Key2',\n        value: 'value3'\n      }]);\n      mb.setHeader({\n        key: 'value4',\n        key2: 'value5'\n      });\n      expect(mb._headers).to.deep.equal([{\n        key: 'Key',\n        value: 'value4'\n      }, {\n        key: 'Key2',\n        value: 'value5'\n      }]);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set multiple headers with the same key","suites":["MimeNode Tests","#setHeader"],"updatePoint":{"line":100,"column":53},"line":100,"code":"    it('should set multiple headers with the same key', function () {\n      let mb = new MimeNode();\n      mb.setHeader('key', ['value1', 'value2', 'value3']);\n      expect(mb._headers).to.deep.equal([{\n        key: 'Key',\n        value: ['value1', 'value2', 'value3']\n      }]);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should add header","suites":["MimeNode Tests","#addHeader"],"updatePoint":{"line":110,"column":25},"line":110,"code":"    it('should add header', function () {\n      let mb = new MimeNode();\n      mb.addHeader('key', 'value1');\n      mb.addHeader('key', 'value2');\n      mb.addHeader([{\n        key: 'key',\n        value: 'value2'\n      }, {\n        key: 'key2',\n        value: 'value3'\n      }]);\n      mb.addHeader({\n        key: 'value4',\n        key2: 'value5'\n      });\n      expect(mb._headers).to.deep.equal([{\n        key: 'Key',\n        value: 'value1'\n      }, {\n        key: 'Key',\n        value: 'value2'\n      }, {\n        key: 'Key',\n        value: 'value2'\n      }, {\n        key: 'Key2',\n        value: 'value3'\n      }, {\n        key: 'Key',\n        value: 'value4'\n      }, {\n        key: 'Key2',\n        value: 'value5'\n      }]);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set multiple headers with the same key","suites":["MimeNode Tests","#addHeader"],"updatePoint":{"line":145,"column":53},"line":145,"code":"    it('should set multiple headers with the same key', function () {\n      let mb = new MimeNode();\n      mb.addHeader('key', ['value1', 'value2', 'value3']);\n      expect(mb._headers).to.deep.equal([{\n        key: 'Key',\n        value: 'value1'\n      }, {\n        key: 'Key',\n        value: 'value2'\n      }, {\n        key: 'Key',\n        value: 'value3'\n      }]);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return first matching header value","suites":["MimeNode Tests","#getHeader"],"updatePoint":{"line":161,"column":49},"line":161,"code":"    it('should return first matching header value', function () {\n      let mb = new MimeNode();\n      mb._headers = [{\n        key: 'Key',\n        value: 'value4'\n      }, {\n        key: 'Key2',\n        value: 'value5'\n      }];\n      expect(mb.getHeader('KEY')).to.equal('value4');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set the contents for a node","suites":["MimeNode Tests","#setContent"],"updatePoint":{"line":174,"column":42},"line":174,"code":"    it('should set the contents for a node', function () {\n      let mb = new MimeNode();\n      mb.setContent('abc');\n      expect(mb.content).to.equal('abc');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should build root node","suites":["MimeNode Tests","#build"],"updatePoint":{"line":181,"column":30},"line":181,"code":"    it('should build root node', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: text/plain\\r\\n' + 'Date: 12345\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'Hello world!\\r\\n';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should build child node","suites":["MimeNode Tests","#build"],"updatePoint":{"line":194,"column":31},"line":194,"code":"    it('should build child node', function (done) {\n      let mb = new MimeNode('multipart/mixed'),\n          childNode = mb.createChild('text/plain').setContent('Hello world!'),\n          expected = 'Content-Type: text/plain\\r\\nContent-Transfer-Encoding: 7bit\\r\\n\\r\\nHello world!\\r\\n';\n      childNode.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should build multipart node","suites":["MimeNode Tests","#build"],"updatePoint":{"line":205,"column":35},"line":205,"code":"    it('should build multipart node', function (done) {\n      let mb = new MimeNode('multipart/mixed', {\n        baseBoundary: 'test'\n      }).setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }),\n          expected = 'Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Date: 12345\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + 'Content-Type: text/plain\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + '\\r\\n' + 'Hello world!\\r\\n' + '----_NmP-test-Part_1--\\r\\n';\n      mb.createChild('text/plain').setContent('Hello world!');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should build root with generated headers","suites":["MimeNode Tests","#build"],"updatePoint":{"line":221,"column":48},"line":221,"code":"    it('should build root with generated headers', function (done) {\n      let mb = new MimeNode('text/plain');\n      mb.hostname = 'abc';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Date:\\s/m.test(msg)).to.be.true;\n        expect(/^Message-ID:\\s/m.test(msg)).to.be.true;\n        expect(/^MIME-Version: 1\\.0$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not include bcc missing in output, but in envelope","suites":["MimeNode Tests","#build"],"updatePoint":{"line":233,"column":65},"line":233,"code":"    it('should not include bcc missing in output, but in envelope', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        from: 'sender@example.com',\n        to: 'receiver@example.com',\n        bcc: 'bcc@example.com'\n      });\n      let envelope = mb.getEnvelope();\n      expect(envelope).to.deep.equal({\n        from: 'sender@example.com',\n        to: ['receiver@example.com', 'bcc@example.com']\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^From: sender@example.com$/m.test(msg)).to.be.true;\n        expect(/^To: receiver@example.com$/m.test(msg)).to.be.true;\n        expect(!/^Bcc:/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should include bcc missing in output and in envelope","suites":["MimeNode Tests","#build"],"updatePoint":{"line":253,"column":60},"line":253,"code":"    it('should include bcc missing in output and in envelope', function (done) {\n      let mb = new MimeNode('text/plain', {\n        keepBcc: true\n      }).setHeader({\n        from: 'sender@example.com',\n        to: 'receiver@example.com',\n        bcc: 'bcc@example.com'\n      });\n      let envelope = mb.getEnvelope();\n      expect(envelope).to.deep.equal({\n        from: 'sender@example.com',\n        to: ['receiver@example.com', 'bcc@example.com']\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^From: sender@example.com$/m.test(msg)).to.be.true;\n        expect(/^To: receiver@example.com$/m.test(msg)).to.be.true;\n        expect(/^Bcc: bcc@example.com$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use set envelope","suites":["MimeNode Tests","#build"],"updatePoint":{"line":275,"column":31},"line":275,"code":"    it('should use set envelope', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        from: 'sender@example.com',\n        to: 'receiver@example.com',\n        bcc: 'bcc@example.com'\n      }).setEnvelope({\n        from: 'U Name, A Name <a@a.a>',\n        to: 'B Name <b@b.b>, c@c.c',\n        bcc: 'P P P, <u@u.u>',\n        fooField: {\n          barValue: 'foobar'\n        }\n      });\n      let envelope = mb.getEnvelope();\n      expect(envelope).to.deep.equal({\n        from: 'a@a.a',\n        to: ['b@b.b', 'c@c.c', 'u@u.u'],\n        fooField: {\n          barValue: 'foobar'\n        }\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^From: sender@example.com$/m.test(msg)).to.be.true;\n        expect(/^To: receiver@example.com$/m.test(msg)).to.be.true;\n        expect(!/^Bcc:/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should have unicode subject","suites":["MimeNode Tests","#build"],"updatePoint":{"line":305,"column":35},"line":305,"code":"    it('should have unicode subject', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        subject: 'jõgeval istus kägu metsas'\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Subject: =\\?UTF-8\\?Q\\?j=C3=B5geval_istus_k=C3=A4gu_metsas\\?=$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should have unicode subject with strange characters","suites":["MimeNode Tests","#build"],"updatePoint":{"line":316,"column":59},"line":316,"code":"    it('should have unicode subject with strange characters', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        subject: 'ˆ¸ÁÌÓıÏˇÁÛ^¸\\\\ÁıˆÌÁÛØ^\\\\˜Û˝™ˇıÓ¸^\\\\˜ﬁ^\\\\·\\\\˜Ø^£˜#ﬁ^\\\\£ﬁ^\\\\£ﬁ^\\\\'\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg.match(/\\bSubject: [^\\r]*\\r\\n( [^\\r]*\\r\\n)*/)[0]).to.equal('Subject: =?UTF-8?B?y4bCuMOBw4zDk8Sxw4/Lh8OBw5tewrhcw4HEscuG?=\\r\\n =?UTF-8?B?w4zDgcObw5heXMucw5vLneKEosuHxLHDk8K4Xlw=?=\\r\\n =?UTF-8?B?y5zvrIFeXMK3XMucw5hewqPLnCPvrIFeXMKj76yB?=\\r\\n =?UTF-8?B?XlzCo++sgV5c?=\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should keep 7bit text as is","suites":["MimeNode Tests","#build"],"updatePoint":{"line":327,"column":35},"line":327,"code":"    it('should keep 7bit text as is', function (done) {\n      let mb = new MimeNode('text/plain').setContent('tere tere');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/\\r\\n\\r\\ntere tere\\r\\n$/.test(msg)).to.be.true;\n        expect(/^Content-Type: text\\/plain$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: 7bit$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should prefer base64","suites":["MimeNode Tests","#build"],"updatePoint":{"line":338,"column":28},"line":338,"code":"    it('should prefer base64', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        subject: 'õõõõ'\n      }).setContent('õõõõõõõõ');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain; charset=utf-8$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: base64$/m.test(msg)).to.be.true;\n        expect(/^Subject: =\\?UTF-8\\?B\\?w7XDtcO1w7U=\\?=$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('w7XDtcO1w7XDtcO1w7XDtQ==\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should force quoted-printable","suites":["MimeNode Tests","#build"],"updatePoint":{"line":355,"column":37},"line":355,"code":"    it('should force quoted-printable', function (done) {\n      let mb = new MimeNode('text/plain', {\n        textEncoding: 'quoted-printable'\n      }).setHeader({\n        subject: 'õõõõ'\n      }).setContent('õõõõõõõõ');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain; charset=utf-8$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        expect(/^Subject: =\\?UTF-8\\?Q\\?=C3=B5=C3=B5=C3=B5=C3=B5\\?=$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('=C3=B5=C3=B5=C3=B5=C3=B5=C3=B5=C3=B5=C3=B5=C3=B5\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should prefer quoted-printable","suites":["MimeNode Tests","#build"],"updatePoint":{"line":374,"column":38},"line":374,"code":"    it('should prefer quoted-printable', function (done) {\n      let mb = new MimeNode('text/plain').setContent('ooooooooõ');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain; charset=utf-8$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('oooooooo=C3=B5\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not flow text","suites":["MimeNode Tests","#build"],"updatePoint":{"line":388,"column":28},"line":388,"code":"    it('should not flow text', function (done) {\n      let mb = new MimeNode('text/plain').setContent('a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0 a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0 a b c d=\\r\\n e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 =\\r\\n0\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not flow html","suites":["MimeNode Tests","#build"],"updatePoint":{"line":402,"column":28},"line":402,"code":"    it('should not flow html', function (done) {\n      let mb = new MimeNode('text/html').setContent('a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0 a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/html$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('a b c d e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 0 a b c d=\\r\\n e f g h i j k l m o p q r s t u w x y z 1 2 3 4 5 6 7 8 9 =\\r\\n0\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use 7bit for html","suites":["MimeNode Tests","#build"],"updatePoint":{"line":416,"column":32},"line":416,"code":"    it('should use 7bit for html', function (done) {\n      let mb = new MimeNode('text/html').setContent('a b c d e f g h i j k l m o p\\r\\nq r s t u w x y z 1 2 3 4 5 6\\r\\n7 8 9 0 a b c d e f g h i j k\\r\\nl m o p q r s t u w x y z\\r\\n1 2 3 4 5 6 7 8 9 0');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/html$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: 7bit$/m.test(msg)).to.be.true;\n        msg = msg.split('\\r\\n\\r\\n');\n        msg.shift();\n        msg = msg.join('\\r\\n\\r\\n');\n        expect(msg).to.equal('a b c d e f g h i j k l m o p\\r\\nq r s t u w x y z 1 2 3 4 5 6\\r\\n7 8 9 0 a b c d e f g h i j k\\r\\nl m o p q r s t u w x y z\\r\\n1 2 3 4 5 6 7 8 9 0\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should fetch ascii filename","suites":["MimeNode Tests","#build"],"updatePoint":{"line":430,"column":35},"line":430,"code":"    it('should fetch ascii filename', function (done) {\n      let mb = new MimeNode('text/plain', {\n        filename: 'jogeva.txt'\n      }).setContent('jogeva');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/\\r\\n\\r\\njogeva\\r\\n$/.test(msg)).to.be.true;\n        expect(/^Content-Type: text\\/plain; name=jogeva.txt$/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: 7bit$/m.test(msg)).to.be.true;\n        expect(/^Content-Disposition: attachment; filename=jogeva.txt$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set unicode filename","suites":["MimeNode Tests","#build"],"updatePoint":{"line":444,"column":35},"line":444,"code":"    it('should set unicode filename', function (done) {\n      let mb = new MimeNode('text/plain', {\n        filename: 'jõgeva.txt'\n      }).setContent('jõgeva');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain; charset=utf-8;/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        expect(/^Content-Disposition: attachment; filename\\*0\\*=utf-8''j%C3%B5geva.txt$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set dashed filename","suites":["MimeNode Tests","#build"],"updatePoint":{"line":457,"column":34},"line":457,"code":"    it('should set dashed filename', function (done) {\n      let mb = new MimeNode('text/plain', {\n        filename: 'Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------Ɣ------.pdf'\n      }).setContent('jõgeva');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg.indexOf('Content-Disposition: attachment;\\r\\n' + \" filename*0*=utf-8''%C6%94------%C6%94------%C6%94------%C6%94;\\r\\n\" + // eslint-disable-line\n        ' filename*1*=------%C6%94------%C6%94------%C6%94------.pdf')).to.be.gte(0);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should encode filename with a space","suites":["MimeNode Tests","#build"],"updatePoint":{"line":469,"column":43},"line":469,"code":"    it('should encode filename with a space', function (done) {\n      let mb = new MimeNode('text/plain', {\n        filename: 'document a.test.pdf'\n      }).setContent('jõgeva');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: text\\/plain; charset=utf-8;/m.test(msg)).to.be.true;\n        expect(/^Content-Transfer-Encoding: quoted-printable$/m.test(msg)).to.be.true;\n        expect(/^Content-Disposition: attachment; filename=\"document a.test.pdf\"$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should detect content type from filename","suites":["MimeNode Tests","#build"],"updatePoint":{"line":482,"column":48},"line":482,"code":"    it('should detect content type from filename', function (done) {\n      let mb = new MimeNode(false, {\n        filename: 'jogeva.zip'\n      }).setContent('jogeva');\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Content-Type: application\\/zip;/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should convert address objects","suites":["MimeNode Tests","#build"],"updatePoint":{"line":493,"column":38},"line":493,"code":"    it('should convert address objects', function (done) {\n      let mb = new MimeNode(false).setHeader({\n        from: [{\n          name: 'the safewithme õ testuser',\n          address: 'safewithme.testuser@jõgeva.com'\n        }],\n        cc: [{\n          name: 'the safewithme testuser',\n          address: 'safewithme.testuser@jõgeva.com'\n        }]\n      });\n      expect(mb.getEnvelope()).to.deep.equal({\n        from: 'safewithme.testuser@xn--jgeva-dua.com',\n        to: ['safewithme.testuser@xn--jgeva-dua.com']\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^From: =\\?UTF-8\\?Q\\?the_safewithme_=C3=B5_testuser\\?=$/m.test(msg)).to.be.true;\n        expect(/^\\s+<safewithme.testuser@xn--jgeva-dua.com>$/m.test(msg)).to.be.true;\n        expect(/^Cc: the safewithme testuser <safewithme.testuser@xn--jgeva-dua.com>$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should skip empty header","suites":["MimeNode Tests","#build"],"updatePoint":{"line":517,"column":32},"line":517,"code":"    it('should skip empty header', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        a: 'b',\n        cc: '',\n        dd: [],\n        o: false,\n        date: 'zzz',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: text/plain\\r\\n' + 'A: b\\r\\n' + 'Date: zzz\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'Hello world!\\r\\n';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not process prepared headers","suites":["MimeNode Tests","#build"],"updatePoint":{"line":534,"column":43},"line":534,"code":"    it('should not process prepared headers', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        unprepared: {\n          value: new Array(100).join('a b')\n        },\n        prepared: {\n          value: new Array(100).join('a b'),\n          prepared: true\n        },\n        unicode: {\n          value: 'õäöü',\n          prepared: true\n        },\n        date: 'zzz',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: text/plain\\r\\n' + // long folded value\n      'Unprepared: a ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba\\r\\n' + ' ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba\\r\\n' + ' ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba\\r\\n' + ' ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba\\r\\n' + ' ba ba ba b\\r\\n' + // long unfolded value\n      'Prepared: a ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba ba b\\r\\n' + // non-ascii value\n      'Unicode: õäöü\\r\\n' + 'Date: zzz\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'Content-Transfer-Encoding: 7bit\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'Hello world!\\r\\n';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should set default transfer encoding for application content","suites":["MimeNode Tests","#build"],"updatePoint":{"line":561,"column":68},"line":561,"code":"    it('should set default transfer encoding for application content', function (done) {\n      let mb = new MimeNode('application/x-my-stuff').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: application/x-my-stuff\\r\\n' + 'Date: 12345\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'Content-Transfer-Encoding: base64\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'SGVsbG8gd29ybGQh\\r\\n';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not set transfer encoding for multipart content","suites":["MimeNode Tests","#build"],"updatePoint":{"line":574,"column":62},"line":574,"code":"    it('should not set transfer encoding for multipart content', function (done) {\n      let mb = new MimeNode('multipart/global').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: multipart/global; boundary=abc\\r\\n' + 'Date: 12345\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + 'Hello world!\\r\\n' + '--abc--' + '\\r\\n';\n      mb.boundary = 'abc';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should not set transfer encoding for message/ content","suites":["MimeNode Tests","#build"],"updatePoint":{"line":588,"column":61},"line":588,"code":"    it('should not set transfer encoding for message/ content', function (done) {\n      let mb = new MimeNode('message/rfc822').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!'),\n          expected = 'Content-Type: message/rfc822\\r\\nDate: 12345\\r\\nMessage-ID: <67890>\\r\\nMIME-Version: 1.0\\r\\n\\r\\nHello world!\\r\\n';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use from domain for message-id","suites":["MimeNode Tests","#build"],"updatePoint":{"line":601,"column":45},"line":601,"code":"    it('should use from domain for message-id', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        from: 'test@example.com'\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Message-ID: <[0-9a-f-]+@example\\.com>$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should fallback to hostname for message-id","suites":["MimeNode Tests","#build"],"updatePoint":{"line":612,"column":50},"line":612,"code":"    it('should fallback to hostname for message-id', function (done) {\n      let mb = new MimeNode('text/plain');\n      mb.hostname = 'abc';\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^Message-ID: <[0-9a-f-]+@abc>$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should get envelope","suites":["MimeNode Tests","#getEnvelope"],"updatePoint":{"line":624,"column":27},"line":624,"code":"    it('should get envelope', function () {\n      expect(new MimeNode().addHeader({\n        from: 'From <from@example.com>',\n        sender: 'Sender <sender@example.com>',\n        to: 'receiver1@example.com'\n      }).addHeader({\n        to: 'receiver2@example.com',\n        cc: 'receiver1@example.com, receiver3@example.com',\n        bcc: 'receiver4@example.com, Rec5 <receiver5@example.com>'\n      }).getEnvelope()).to.deep.equal({\n        from: 'from@example.com',\n        to: ['receiver1@example.com', 'receiver2@example.com', 'receiver3@example.com', 'receiver4@example.com', 'receiver5@example.com']\n      });\n      expect(new MimeNode().addHeader({\n        sender: 'Sender <sender@example.com>',\n        to: 'receiver1@example.com'\n      }).addHeader({\n        to: 'receiver2@example.com',\n        cc: 'receiver1@example.com, receiver3@example.com',\n        bcc: 'receiver4@example.com, Rec5 <receiver5@example.com>'\n      }).getEnvelope()).to.deep.equal({\n        from: 'sender@example.com',\n        to: ['receiver1@example.com', 'receiver2@example.com', 'receiver3@example.com', 'receiver4@example.com', 'receiver5@example.com']\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should create and return message-Id","suites":["MimeNode Tests","#messageId"],"updatePoint":{"line":651,"column":43},"line":651,"code":"    it('should create and return message-Id', function () {\n      let mail = new MimeNode().addHeader({\n        from: 'From <from@example.com>'\n      });\n      let messageId = mail.messageId();\n      expect(/^<[\\w-]+@example\\.com>$/.test(messageId)).to.be.true;\n      expect(messageId).to.equal(mail.messageId());\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should get address object","suites":["MimeNode Tests","#getAddresses"],"updatePoint":{"line":661,"column":33},"line":661,"code":"    it('should get address object', function () {\n      expect(new MimeNode().addHeader({\n        from: 'From <from@example.com>',\n        sender: 'Sender <sender@example.com>',\n        to: 'receiver1@example.com'\n      }).addHeader({\n        to: 'receiver2@example.com',\n        cc: 'receiver1@example.com, receiver3@example.com',\n        bcc: 'receiver4@example.com, Rec5 <receiver5@example.com>'\n      }).getAddresses()).to.deep.equal({\n        from: [{\n          address: 'from@example.com',\n          name: 'From'\n        }],\n        sender: [{\n          address: 'sender@example.com',\n          name: 'Sender'\n        }],\n        to: [{\n          address: 'receiver1@example.com',\n          name: ''\n        }, {\n          address: 'receiver2@example.com',\n          name: ''\n        }],\n        cc: [{\n          address: 'receiver1@example.com',\n          name: ''\n        }, {\n          address: 'receiver3@example.com',\n          name: ''\n        }],\n        bcc: [{\n          address: 'receiver4@example.com',\n          name: ''\n        }, {\n          address: 'receiver5@example.com',\n          name: 'Rec5'\n        }]\n      });\n      expect(new MimeNode().addHeader({\n        sender: 'Sender <sender@example.com>',\n        to: 'receiver1@example.com'\n      }).addHeader({\n        to: 'receiver2@example.com',\n        cc: 'receiver1@example.com, receiver1@example.com',\n        bcc: 'receiver4@example.com, Rec5 <receiver5@example.com>'\n      }).getAddresses()).to.deep.equal({\n        sender: [{\n          address: 'sender@example.com',\n          name: 'Sender'\n        }],\n        to: [{\n          address: 'receiver1@example.com',\n          name: ''\n        }, {\n          address: 'receiver2@example.com',\n          name: ''\n        }],\n        cc: [{\n          address: 'receiver1@example.com',\n          name: ''\n        }],\n        bcc: [{\n          address: 'receiver4@example.com',\n          name: ''\n        }, {\n          address: 'receiver5@example.com',\n          name: 'Rec5'\n        }]\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should normalize header key","suites":["MimeNode Tests","#_parseAddresses"],"updatePoint":{"line":735,"column":35},"line":735,"code":"    it('should normalize header key', function () {\n      let mb = new MimeNode();\n      expect(mb._parseAddresses('test address@example.com')).to.deep.equal([{\n        address: 'address@example.com',\n        name: 'test'\n      }]);\n      expect(mb._parseAddresses(['test address@example.com'])).to.deep.equal([{\n        address: 'address@example.com',\n        name: 'test'\n      }]);\n      expect(mb._parseAddresses([['test address@example.com']])).to.deep.equal([{\n        address: 'address@example.com',\n        name: 'test'\n      }]);\n      expect(mb._parseAddresses([{\n        address: 'address@example.com',\n        name: 'test'\n      }])).to.deep.equal([{\n        address: 'address@example.com',\n        name: 'test'\n      }]);\n      expect(mb._parseAddresses([{\n        address: 'root',\n        name: 'Charlie Root'\n      }])).to.deep.equal([{\n        address: 'root',\n        name: 'Charlie Root'\n      }]);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should normalize header key","suites":["MimeNode Tests","#_normalizeHeaderKey"],"updatePoint":{"line":766,"column":35},"line":766,"code":"    it('should normalize header key', function () {\n      let mb = new MimeNode();\n      expect(mb._normalizeHeaderKey('key')).to.equal('Key');\n      expect(mb._normalizeHeaderKey('mime-vERSION')).to.equal('MIME-Version');\n      expect(mb._normalizeHeaderKey('-a-long-name')).to.equal('-A-Long-Name');\n      expect(mb._normalizeHeaderKey('some-spf')).to.equal('Some-SPF');\n      expect(mb._normalizeHeaderKey('dkim-some')).to.equal('DKIM-Some');\n      expect(mb._normalizeHeaderKey('x-smtpapi')).to.equal('X-SMTPAPI');\n      expect(mb._normalizeHeaderKey('message-id')).to.equal('Message-ID');\n      expect(mb._normalizeHeaderKey('CONTENT-FEATUres')).to.equal('Content-features');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should do nothing on non multipart","suites":["MimeNode Tests","#_handleContentType"],"updatePoint":{"line":779,"column":42},"line":779,"code":"    it('should do nothing on non multipart', function () {\n      let mb = new MimeNode();\n      expect(mb.boundary).to.not.exist;\n\n      mb._handleContentType({\n        value: 'text/plain'\n      });\n\n      expect(mb.boundary).to.be.false;\n      expect(mb.multipart).to.be.false;\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use provided boundary","suites":["MimeNode Tests","#_handleContentType"],"updatePoint":{"line":790,"column":36},"line":790,"code":"    it('should use provided boundary', function () {\n      let mb = new MimeNode();\n      expect(mb.boundary).to.not.exist;\n\n      mb._handleContentType({\n        value: 'multipart/mixed',\n        params: {\n          boundary: 'abc'\n        }\n      });\n\n      expect(mb.boundary).to.equal('abc');\n      expect(mb.multipart).to.equal('mixed');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should generate boundary","suites":["MimeNode Tests","#_handleContentType"],"updatePoint":{"line":804,"column":32},"line":804,"code":"    it('should generate boundary', function () {\n      let mb = new MimeNode();\n      sinon.stub(mb, '_generateBoundary').returns('def');\n      expect(mb.boundary).to.not.exist;\n\n      mb._handleContentType({\n        value: 'multipart/mixed',\n        params: {}\n      });\n\n      expect(mb.boundary).to.equal('def');\n      expect(mb.multipart).to.equal('mixed');\n\n      mb._generateBoundary.restore();\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should genereate boundary string","suites":["MimeNode Tests","#_generateBoundary "],"updatePoint":{"line":821,"column":40},"line":821,"code":"    it('should genereate boundary string', function () {\n      let mb = new MimeNode();\n      mb._nodeId = 'abc';\n      mb.rootNode.baseBoundary = 'def';\n      expect(mb._generateBoundary()).to.equal('--_NmP-def-Part_abc');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should do noting if possible","suites":["MimeNode Tests","#_encodeHeaderValue"],"updatePoint":{"line":829,"column":36},"line":829,"code":"    it('should do noting if possible', function () {\n      let mb = new MimeNode();\n      expect(mb._encodeHeaderValue('x-my', 'test value')).to.equal('test value');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should encode non ascii characters","suites":["MimeNode Tests","#_encodeHeaderValue"],"updatePoint":{"line":833,"column":42},"line":833,"code":"    it('should encode non ascii characters', function () {\n      let mb = new MimeNode();\n      expect(mb._encodeHeaderValue('x-my', 'test jõgeva value')).to.equal('=?UTF-8?Q?test_j=C3=B5geva_value?=');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should format references","suites":["MimeNode Tests","#_encodeHeaderValue"],"updatePoint":{"line":837,"column":32},"line":837,"code":"    it('should format references', function () {\n      let mb = new MimeNode();\n      expect(mb._encodeHeaderValue('references', 'abc def')).to.equal('<abc> <def>');\n      expect(mb._encodeHeaderValue('references', ['abc', 'def'])).to.equal('<abc> <def>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should format message-id","suites":["MimeNode Tests","#_encodeHeaderValue"],"updatePoint":{"line":842,"column":32},"line":842,"code":"    it('should format message-id', function () {\n      let mb = new MimeNode();\n      expect(mb._encodeHeaderValue('message-id', 'abc')).to.equal('<abc>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should format addresses","suites":["MimeNode Tests","#_encodeHeaderValue"],"updatePoint":{"line":846,"column":31},"line":846,"code":"    it('should format addresses', function () {\n      let mb = new MimeNode();\n      expect(mb._encodeHeaderValue('from', {\n        name: 'the safewithme testuser',\n        address: 'safewithme.testuser@jõgeva.com'\n      })).to.equal('the safewithme testuser <safewithme.testuser@xn--jgeva-dua.com>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should convert address object to a string","suites":["MimeNode Tests","#_convertAddresses"],"updatePoint":{"line":855,"column":49},"line":855,"code":"    it('should convert address object to a string', function () {\n      let mb = new MimeNode();\n      expect(mb._convertAddresses([{\n        name: 'Jõgeva Ants',\n        address: 'ants@jõgeva.ee'\n      }, {\n        name: 'Composers',\n        group: [{\n          address: 'sebu@example.com',\n          name: 'Bach, Sebastian'\n        }, {\n          address: 'mozart@example.com',\n          name: 'Mozzie'\n        }]\n      }])).to.equal('=?UTF-8?Q?J=C3=B5geva_Ants?= <ants@xn--jgeva-dua.ee>, Composers:\"Bach, Sebastian\" <sebu@example.com>, Mozzie <mozart@example.com>;');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should keep ascii name as is","suites":["MimeNode Tests","#_convertAddresses"],"updatePoint":{"line":871,"column":36},"line":871,"code":"    it('should keep ascii name as is', function () {\n      let mb = new MimeNode();\n      expect(mb._convertAddresses([{\n        name: \"O'Vigala Sass\",\n        // eslint-disable-line\n        address: 'a@b.c'\n      }])).to.equal(\"O'Vigala Sass <a@b.c>\"); // eslint-disable-line\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should include name in quotes for special symbols","suites":["MimeNode Tests","#_convertAddresses"],"updatePoint":{"line":879,"column":57},"line":879,"code":"    it('should include name in quotes for special symbols', function () {\n      let mb = new MimeNode();\n      expect(mb._convertAddresses([{\n        name: 'Sass, Vigala',\n        address: 'a@b.c'\n      }])).to.equal('\"Sass, Vigala\" <a@b.c>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should escape quotes","suites":["MimeNode Tests","#_convertAddresses"],"updatePoint":{"line":886,"column":28},"line":886,"code":"    it('should escape quotes', function () {\n      let mb = new MimeNode();\n      expect(mb._convertAddresses([{\n        name: '\"Vigala Sass\"',\n        address: 'a@b.c'\n      }])).to.equal('\"\\\\\"Vigala Sass\\\\\"\" <a@b.c>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should mime encode unicode names","suites":["MimeNode Tests","#_convertAddresses"],"updatePoint":{"line":893,"column":40},"line":893,"code":"    it('should mime encode unicode names', function () {\n      let mb = new MimeNode();\n      expect(mb._convertAddresses([{\n        name: '\"Jõgeva Sass\"',\n        address: 'a@b.c'\n      }])).to.equal('=?UTF-8?Q?=22J=C3=B5geva_Sass=22?= <a@b.c>');\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should generate uuid-looking message-id","suites":["MimeNode Tests","#_generateMessageId"],"updatePoint":{"line":902,"column":47},"line":902,"code":"    it('should generate uuid-looking message-id', function () {\n      let mb = new MimeNode();\n\n      let mid = mb._generateMessageId();\n\n      expect(/^<[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}@.*>/.test(mid)).to.be.true;\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use default header keys","suites":["MimeNode Tests","#_generateMessageId"],"updatePoint":{"line":910,"column":36},"line":910,"code":"  it('should use default header keys', function (done) {\n    let mb = new MimeNode('text/plain');\n    mb.addHeader('test', 'test');\n    mb.addHeader('BEST', 'best');\n    mb.build(function (err, msg) {\n      expect(err).to.not.exist;\n      msg = msg.toString();\n      expect(/^Test: test$/m.test(msg));\n      expect(/^Best: best$/m.test(msg));\n      done();\n    });\n  });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should use custom header keys","suites":["MimeNode Tests","#_generateMessageId"],"updatePoint":{"line":922,"column":35},"line":922,"code":"  it('should use custom header keys', function (done) {\n    let mb = new MimeNode('text/plain', {\n      normalizeHeaderKey: key => key.toUpperCase()\n    });\n    mb.addHeader('test', 'test');\n    mb.addHeader('BEST', 'best');\n    mb.build(function (err, msg) {\n      expect(err).to.not.exist;\n      msg = msg.toString();\n      expect(/^TEST: test$/m.test(msg));\n      expect(/^BEST: best$/m.test(msg));\n      done();\n    });\n  });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should pipe URL as an attachment","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":963,"column":40},"line":963,"code":"    it('should pipe URL as an attachment', function (done) {\n      let mb = new MimeNode('text/plain').setContent({\n        href: 'http://localhost:' + port\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^=C3=A4/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should reject URL attachment","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":974,"column":36},"line":974,"code":"    it('should reject URL attachment', function (done) {\n      let mb = new MimeNode('text/plain', {\n        disableUrlAccess: true\n      }).setContent({\n        href: 'http://localhost:' + port\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.exist;\n        expect(msg).to.not.exist;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return an error on invalid url","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":986,"column":45},"line":986,"code":"    it('should return an error on invalid url', function (done) {\n      let mb = new MimeNode('text/plain').setContent({\n        href: 'http://__should_not_exist:58888'\n      });\n      mb.build(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should pipe file as an attachment","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":995,"column":41},"line":995,"code":"    it('should pipe file as an attachment', function (done) {\n      let mb = new MimeNode('application/octet-stream').setContent({\n        path: __dirname + '/fixtures/attachment.bin'\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(/^w7VrdmEK$/m.test(msg)).to.be.true;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should reject file as an attachment","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":1006,"column":43},"line":1006,"code":"    it('should reject file as an attachment', function (done) {\n      let mb = new MimeNode('application/octet-stream', {\n        disableFileAccess: true\n      }).setContent({\n        path: __dirname + '/fixtures/attachment.bin'\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.exist;\n        expect(msg).to.not.exist;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return an error on invalid file path","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":1018,"column":51},"line":1018,"code":"    it('should return an error on invalid file path', function (done) {\n      let mb = new MimeNode('text/plain').setContent({\n        href: '/ASfsdfsdf/Sdgsgdfg/SDFgdfgdfg'\n      });\n      mb.build(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return a error for an errored stream","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":1027,"column":51},"line":1027,"code":"    it('should return a error for an errored stream', function (done) {\n      let s = new PassThrough();\n      let mb = new MimeNode('text/plain').setContent(s);\n      s.write('abc');\n      s.emit('error', new Error('Stream error'));\n      setTimeout(function () {\n        mb.build(function (err) {\n          expect(err).to.exist;\n          done();\n        });\n      }, 100);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return a stream error","suites":["MimeNode Tests","Attachment streaming"],"updatePoint":{"line":1039,"column":36},"line":1039,"code":"    it('should return a stream error', function (done) {\n      let s = new PassThrough();\n      let mb = new MimeNode('text/plain').setContent(s);\n      mb.build(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n      s.write('abc');\n      setTimeout(function () {\n        s.emit('error', new Error('Stream error'));\n      }, 100);\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should pipe through provided stream","suites":["MimeNode Tests","#transform"],"updatePoint":{"line":1053,"column":43},"line":1053,"code":"    it('should pipe through provided stream', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!');\n      let expected = 'Content-Type:\\ttext/plain\\r\\n' + 'Date:\\t12345\\r\\n' + 'Message-ID:\\t<67890>\\r\\n' + 'Content-Transfer-Encoding:\\t7bit\\r\\n' + 'MIME-Version:\\t1.0\\r\\n' + '\\r\\n' + 'Hello\\tworld!\\r\\n'; // Transform stream that replaces all spaces with tabs\n\n      let transform = new Transform();\n\n      transform._transform = function (chunk, encoding, done) {\n        if (encoding !== 'buffer') {\n          chunk = Buffer.from(chunk, encoding);\n        }\n\n        for (let i = 0, len = chunk.length; i < len; i++) {\n          if (chunk[i] === 0x20) {\n            chunk[i] = 0x09;\n          }\n        }\n\n        this.push(chunk);\n        done();\n      };\n\n      mb.transform(transform);\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should pipe through provided process function","suites":["MimeNode Tests","#processFunc"],"updatePoint":{"line":1087,"column":53},"line":1087,"code":"    it('should pipe through provided process function', function (done) {\n      let mb = new MimeNode('text/plain').setHeader({\n        date: '12345',\n        'message-id': '67890'\n      }).setContent('Hello world!');\n      let expected = 'Content-Type:\\ttext/plain\\r\\n' + 'Date:\\t12345\\r\\n' + 'Message-ID:\\t<67890>\\r\\n' + 'Content-Transfer-Encoding:\\t7bit\\r\\n' + 'MIME-Version:\\t1.0\\r\\n' + '\\r\\n' + 'Hello\\tworld!\\r\\n'; // Transform stream that replaces all spaces with tabs\n\n      let transform = new Transform();\n\n      transform._transform = function (chunk, encoding, done) {\n        if (encoding !== 'buffer') {\n          chunk = Buffer.from(chunk, encoding);\n        }\n\n        for (let i = 0, len = chunk.length; i < len; i++) {\n          if (chunk[i] === 0x20) {\n            chunk[i] = 0x09;\n          }\n        }\n\n        this.push(chunk);\n        done();\n      };\n\n      mb.processFunc(input => {\n        setImmediate(() => input.pipe(transform));\n        return transform;\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return pregenerated content","suites":["MimeNode Tests","Raw content"],"updatePoint":{"line":1124,"column":42},"line":1124,"code":"    it('should return pregenerated content', function (done) {\n      let expected = new Array(100).join('Test\\n');\n      let mb = new MimeNode('text/plain').setRaw(expected);\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return pregenerated content for a child node","suites":["MimeNode Tests","Raw content"],"updatePoint":{"line":1134,"column":59},"line":1134,"code":"    it('should return pregenerated content for a child node', function (done) {\n      let expected = new Array(100).join('Test\\n');\n      let mb = new MimeNode('multipart/mixed', {\n        baseBoundary: 'test'\n      }).setHeader({\n        date: '12345',\n        'message-id': '67890'\n      });\n      let child = mb.createChild();\n      child.setRaw(expected);\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal('Content-Type: multipart/mixed; boundary=\"--_NmP-test-Part_1\"\\r\\n' + 'Date: 12345\\r\\n' + 'Message-ID: <67890>\\r\\n' + 'MIME-Version: 1.0\\r\\n' + '\\r\\n' + '----_NmP-test-Part_1\\r\\n' + expected + '\\r\\n' + '----_NmP-test-Part_1--\\r\\n');\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should return pregenerated content from a stream","suites":["MimeNode Tests","Raw content"],"updatePoint":{"line":1151,"column":56},"line":1151,"code":"    it('should return pregenerated content from a stream', function (done) {\n      let expected = new Array(100).join('Test\\n');\n      let raw = new PassThrough();\n      let mb = new MimeNode('text/plain').setRaw(raw);\n      setImmediate(function () {\n        raw.end(expected);\n      });\n      mb.build(function (err, msg) {\n        expect(err).to.not.exist;\n        msg = msg.toString();\n        expect(msg).to.equal(expected);\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should catch error from a raw stream 1","suites":["MimeNode Tests","Raw content"],"updatePoint":{"line":1165,"column":46},"line":1165,"code":"    it('should catch error from a raw stream 1', function (done) {\n      let raw = new PassThrough();\n      let mb = new MimeNode('text/plain').setRaw(raw);\n      raw.emit('error', new Error('Stream error'));\n      mb.build(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"should catch error from a raw stream 2","suites":["MimeNode Tests","Raw content"],"updatePoint":{"line":1174,"column":46},"line":1174,"code":"    it('should catch error from a raw stream 2', function (done) {\n      let raw = new PassThrough();\n      let mb = new MimeNode('text/plain').setRaw(raw);\n      mb.build(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n      setImmediate(function () {\n        raw.emit('error', new Error('Stream error'));\n      });\n    });","file":"mime-node/mime-node-test.js","skipped":false,"dir":"test"},{"name":"shoud encode UTF-8 string to QP","suites":["Quoted-Printable Tests","#encode"],"updatePoint":{"line":24,"column":39},"line":24,"code":"    it('shoud encode UTF-8 string to QP', function () {\n      encodeFixtures.forEach(function (test) {\n        expect(qp.encode(test[0])).to.equal(test[1]);\n      });\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"shoud encode Buffer to QP","suites":["Quoted-Printable Tests","#encode"],"updatePoint":{"line":29,"column":33},"line":29,"code":"    it('shoud encode Buffer to QP', function () {\n      expect(qp.encode(Buffer.from([0x00, 0x01, 0x02, 0x20, 0x03]))).to.equal('=00=01=02 =03');\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"should wrap long QP encoded lines","suites":["Quoted-Printable Tests","#wrap"],"updatePoint":{"line":34,"column":41},"line":34,"code":"    it('should wrap long QP encoded lines', function () {\n      wrapFixtures.forEach(function (test) {\n        expect(qp.wrap(test[0], 20)).to.equal(test[1]);\n      });\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"should wrap line ending with <CR>","suites":["Quoted-Printable Tests","#wrap"],"updatePoint":{"line":39,"column":41},"line":39,"code":"    it('should wrap line ending with <CR>', function () {\n      expect(qp.wrap('alfa palfa kalfa ralfa\\r', 10)).to.equal('alfa palf=\\r\\na kalfa =\\r\\nralfa\\r');\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"should transform incoming bytes to QP","suites":["Quoted-Printable Tests","QP Streams"],"updatePoint":{"line":44,"column":45},"line":44,"code":"    it('should transform incoming bytes to QP', function (done) {\n      let encoder = new qp.Encoder({\n        lineLength: 9\n      });\n      let bytes = Buffer.from(streamFixture[0]),\n          i = 0,\n          buf = [],\n          buflen = 0;\n      encoder.on('data', function (chunk) {\n        buf.push(chunk);\n        buflen += chunk.length;\n      });\n      encoder.on('end', function (chunk) {\n        if (chunk) {\n          buf.push(chunk);\n          buflen += chunk.length;\n        }\n\n        buf = Buffer.concat(buf, buflen);\n        expect(buf.toString()).to.equal(streamFixture[1]);\n        done();\n      });\n\n      let sendNextByte = function () {\n        if (i >= bytes.length) {\n          return encoder.end();\n        }\n\n        let ord = bytes[i++];\n        encoder.write(Buffer.from([ord]));\n        setImmediate(sendNextByte);\n      };\n\n      sendNextByte();\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"should transform incoming bytes to QP and back","suites":["Quoted-Printable Tests","QP Streams"],"updatePoint":{"line":79,"column":54},"line":79,"code":"    it('should transform incoming bytes to QP and back', function (done) {\n      let decoder = new libqp.Decoder();\n      let encoder = new qp.Encoder();\n      let file = fs.createReadStream(__dirname + '/fixtures/alice.txt');\n      let fhash = crypto.createHash('md5');\n      let dhash = crypto.createHash('md5');\n      file.pipe(encoder).pipe(decoder);\n      file.on('data', function (chunk) {\n        fhash.update(chunk);\n      });\n      file.on('end', function () {\n        fhash = fhash.digest('hex');\n      });\n      decoder.on('data', function (chunk) {\n        dhash.update(chunk);\n      });\n      decoder.on('end', function () {\n        dhash = dhash.digest('hex');\n        expect(fhash).to.equal(dhash);\n        done();\n      });\n    });","file":"qp/qp-test.js","skipped":false,"dir":"test"},{"name":"should rewrite all linebreaks (byte by byte)","suites":["Sendmail Unix Newlines"],"updatePoint":{"line":13,"column":50},"line":13,"code":"  it('should rewrite all linebreaks (byte by byte)', function (done) {\n    let source = 'tere tere\\nteine rida\\nkolmas rida\\r\\nneljas rida\\r\\nviies rida\\n kuues rida';\n    let chunks = [];\n    let out = new LeUnix();\n    out.on('data', chunk => chunks.push(chunk));\n    out.on('end', () => {\n      expect(Buffer.concat(chunks).toString()).to.equal(source.replace(/\\r?\\n/g, '\\n'));\n      done();\n    });\n    let data = Buffer.from(source);\n    let pos = 0;\n\n    let writeNextByte = () => {\n      if (pos >= data.length) {\n        return out.end();\n      }\n\n      out.write(Buffer.from([data[pos++]]));\n      setImmediate(writeNextByte);\n    };\n\n    setImmediate(writeNextByte);\n  });","file":"sendmail/le-unix.test.js","skipped":false,"dir":"test"},{"name":"should rewrite all linebreaks (all at once)","suites":["Sendmail Unix Newlines"],"updatePoint":{"line":36,"column":49},"line":36,"code":"  it('should rewrite all linebreaks (all at once)', function (done) {\n    let source = 'tere tere\\nteine rida\\nkolmas rida\\r\\nneljas rida\\r\\nviies rida\\n kuues rida';\n    let chunks = [];\n    let out = new LeUnix();\n    out.on('data', chunk => chunks.push(chunk));\n    out.on('end', () => {\n      expect(Buffer.concat(chunks).toString()).to.equal(source.replace(/\\r?\\n/g, '\\n'));\n      done();\n    });\n    let data = Buffer.from(source);\n    out.end(data);\n  });","file":"sendmail/le-unix.test.js","skipped":false,"dir":"test"},{"name":"should rewrite all linebreaks (byte by byte)","suites":["Sendmail Windows Newlines"],"updatePoint":{"line":13,"column":50},"line":13,"code":"  it('should rewrite all linebreaks (byte by byte)', function (done) {\n    let source = 'tere tere\\nteine rida\\nkolmas rida\\r\\nneljas rida\\r\\nviies rida\\n kuues rida';\n    let chunks = [];\n    let out = new LeWindows();\n    out.on('data', chunk => chunks.push(chunk));\n    out.on('end', () => {\n      expect(Buffer.concat(chunks).toString()).to.equal(source.replace(/\\r?\\n/g, '\\r\\n'));\n      done();\n    });\n    let data = Buffer.from(source);\n    let pos = 0;\n\n    let writeNextByte = () => {\n      if (pos >= data.length) {\n        return out.end();\n      }\n\n      out.write(Buffer.from([data[pos++]]));\n      setImmediate(writeNextByte);\n    };\n\n    setImmediate(writeNextByte);\n  });","file":"sendmail/le-windows-test.js","skipped":false,"dir":"test"},{"name":"should rewrite all linebreaks (all at once)","suites":["Sendmail Windows Newlines"],"updatePoint":{"line":36,"column":49},"line":36,"code":"  it('should rewrite all linebreaks (all at once)', function (done) {\n    let source = 'tere tere\\nteine rida\\nkolmas rida\\r\\nneljas rida\\r\\nviies rida\\n kuues rida';\n    let chunks = [];\n    let out = new LeWindows();\n    out.on('data', chunk => chunks.push(chunk));\n    out.on('end', () => {\n      expect(Buffer.concat(chunks).toString()).to.equal(source.replace(/\\r?\\n/g, '\\r\\n'));\n      done();\n    });\n    let data = Buffer.from(source);\n    out.end(data);\n  });","file":"sendmail/le-windows-test.js","skipped":false,"dir":"test"},{"name":"Should expose version number","suites":["Sendmail Transport Tests"],"updatePoint":{"line":52,"column":34},"line":52,"code":"  it('Should expose version number', function () {\n    let client = new SendmailTransport();\n    expect(client.name).to.exist;\n    expect(client.version).to.exist;\n  });","file":"sendmail/sendmail-test.js","skipped":false,"dir":"test"},{"name":"Should send message","suites":["Sendmail Transport Tests"],"updatePoint":{"line":57,"column":25},"line":57,"code":"  it('Should send message', function (done) {\n    let client = new SendmailTransport();\n    let stubbedSpawn = new EventEmitter();\n    stubbedSpawn.stdin = new PassThrough();\n    stubbedSpawn.stdout = new PassThrough();\n    let output = '';\n    stubbedSpawn.stdin.on('data', function (chunk) {\n      output += chunk.toString();\n    });\n    stubbedSpawn.stdin.on('end', function () {\n      stubbedSpawn.emit('close', 0);\n      stubbedSpawn.emit('exit', 0);\n    });\n    sinon.stub(client, '_spawn').returns(stubbedSpawn);\n    client.send({\n      data: {},\n      message: new MailComposer({\n        from: 'test@valid.sender',\n        to: 'test@valid.recipient',\n        newline: '\\n',\n        raw: Buffer.from('message\\r\\nline 2')\n      }).compile()\n    }, function (err) {\n      expect(err).to.not.exist;\n      expect(output).to.equal('message\\nline 2\\n');\n\n      client._spawn.restore();\n\n      done();\n    });\n  });","file":"sendmail/sendmail-test.js","skipped":false,"dir":"test"},{"name":"Should reject message","suites":["Sendmail Transport Tests"],"updatePoint":{"line":88,"column":27},"line":88,"code":"  it('Should reject message', function (done) {\n    let client = new SendmailTransport();\n    let stubbedSpawn = new EventEmitter();\n    stubbedSpawn.stdin = new PassThrough();\n    stubbedSpawn.stdout = new PassThrough();\n    let output = '';\n    stubbedSpawn.stdin.on('data', function (chunk) {\n      output += chunk.toString();\n    });\n    stubbedSpawn.stdin.on('end', function () {\n      stubbedSpawn.emit('close', 0);\n      stubbedSpawn.emit('exit', 0);\n    });\n    sinon.stub(client, '_spawn').returns(stubbedSpawn);\n    client.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: '-d0.1a@example.com'\n      }, 'message\\r\\nline 2')\n    }, function (err, data) {\n      expect(err).to.exist;\n      expect(data).to.not.exist;\n      expect(output).to.equal('');\n\n      client._spawn.restore();\n\n      done();\n    });\n  });","file":"sendmail/sendmail-test.js","skipped":false,"dir":"test"},{"name":"Should return an error","suites":["Sendmail Transport Tests"],"updatePoint":{"line":118,"column":28},"line":118,"code":"  it('Should return an error', function (done) {\n    let client = new SendmailTransport();\n    let stubbedSpawn = new EventEmitter();\n    stubbedSpawn.stdin = new PassThrough();\n    stubbedSpawn.stdout = new PassThrough();\n    stubbedSpawn.stdin.on('data', () => false);\n    stubbedSpawn.stdin.on('end', function () {\n      stubbedSpawn.emit('close', 127);\n      stubbedSpawn.emit('exit', 127);\n    });\n    sinon.stub(client, '_spawn').returns(stubbedSpawn);\n    client.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: 'test@valid.recipient'\n      }, 'message\\r\\nline 2')\n    }, function (err, data) {\n      expect(err).to.exist;\n      expect(data).to.not.exist;\n\n      client._spawn.restore();\n\n      done();\n    });\n  });","file":"sendmail/sendmail-test.js","skipped":false,"dir":"test"},{"name":"should return MessageId, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":27,"column":62},"line":27,"code":"  it('should return MessageId, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        // Prevent tests from actually sending mail by mocking sendRawEmail\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setImmediate(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                });\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: {\n        path: __dirname + '/../json-transport/fixtures/body.html'\n      },\n      text: 'hello world',\n      attachments: [{\n        filename: 'image.png',\n        path: __dirname + '/../json-transport/fixtures/image.png'\n      }]\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n      expect(info.envelope).to.deep.equal({\n        from: 'andris.reinman@gmail.com',\n        to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n      });\n      expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n      expect(info.response).to.equal('testtest');\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should return MessageId, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":80,"column":62},"line":80,"code":"  it('should return MessageId, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          // Prevent tests from actually sending mail by mocking send method\n          send(message) {\n            return new Promise(resolve => {\n              setImmediate(() => resolve(message));\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            return {\n              MessageId: 'testtest'\n            };\n          }\n        }\n      }\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: {\n        path: __dirname + '/../json-transport/fixtures/body.html'\n      },\n      text: 'hello world',\n      attachments: [{\n        filename: 'image.png',\n        path: __dirname + '/../json-transport/fixtures/image.png'\n      }]\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n      expect(info.envelope).to.deep.equal({\n        from: 'andris.reinman@gmail.com',\n        to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n      });\n      expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n      expect(info.response).to.equal('testtest');\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should verify ses configuration using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":136,"column":69},"line":136,"code":"  it('should verify ses configuration using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        // Prevent tests from actually sending mail by mocking sendRawEmail\n        sendRawEmail(message, callback) {\n          return new Promise(resolve => {\n            setImmediate(() => {\n              callback(null, message);\n              return resolve();\n            });\n          });\n        }\n\n      }\n    });\n    transport.verify().then(info => {\n      expect(info).to.exist;\n      expect(info).to.equal(true);\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should verify ses configuration using AWS SES JavaScript SDK v2, with supplied callback","suites":["SES Transport Tests"],"updatePoint":{"line":161,"column":93},"line":161,"code":"  it('should verify ses configuration using AWS SES JavaScript SDK v2, with supplied callback', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        // Prevent tests from actually sending mail by mocking sendRawEmail\n        sendRawEmail(message, callback) {\n          return new Promise(resolve => {\n            setImmediate(() => {\n              callback(null, message);\n              return resolve();\n            });\n          });\n        }\n\n      }\n    });\n    transport.verify((err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.equal(true);\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should verify ses configuration using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":187,"column":69},"line":187,"code":"  it('should verify ses configuration using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          // Prevent tests from actually sending mail by mocking send method\n          send(message, callback) {\n            return new Promise(resolve => {\n              setImmediate(() => {\n                callback(null, message);\n                return resolve();\n              });\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    transport.verify().then(info => {\n      expect(info).to.exist;\n      expect(info).to.equal(true);\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should verify ses configuration using AWS SES JavaScript SDK v3, with supplied callback","suites":["SES Transport Tests"],"updatePoint":{"line":222,"column":93},"line":222,"code":"  it('should verify ses configuration using AWS SES JavaScript SDK v3, with supplied callback', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          // Prevent tests from actually sending mail by mocking send method\n          send(message, callback) {\n            return new Promise(resolve => {\n              setImmediate(() => {\n                callback(null, message);\n                return resolve();\n              });\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    transport.verify((err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.equal(true);\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should sign message with DKIM, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":258,"column":68},"line":258,"code":"  it('should sign message with DKIM, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail(message) {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                expect(message.RawMessage.Data.toString()).to.include('h=from:subject:to:cc:mime-version:content-type;');\n                setImmediate(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                });\n              });\n            }\n\n          };\n        }\n\n      },\n      dkim: {\n        domainName: 'node.ee',\n        keySelector: 'dkim',\n        privateKey\n      }\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: {\n        path: __dirname + '/../json-transport/fixtures/body.html'\n      },\n      text: 'hello world',\n      attachments: [{\n        filename: 'image.png',\n        path: __dirname + '/../json-transport/fixtures/image.png'\n      }]\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n      expect(info.envelope).to.deep.equal({\n        from: 'andris.reinman@gmail.com',\n        to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n      });\n      expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n      expect(info.response).to.equal('testtest');\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should sign message with DKIM, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":316,"column":68},"line":316,"code":"  it('should sign message with DKIM, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setImmediate(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              });\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function (message) {\n            expect(message.RawMessage.Data.toString()).to.include('h=from:subject:to:cc:mime-version:content-type;');\n            return message;\n          }\n        }\n      },\n      dkim: {\n        domainName: 'node.ee',\n        keySelector: 'dkim',\n        privateKey\n      }\n    });\n    let messageObject = {\n      from: 'Andris Reinman <andris.reinman@gmail.com>',\n      to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n      cc: 'info@nodemailer.com',\n      subject: 'Awesome!',\n      messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n      html: {\n        path: __dirname + '/../json-transport/fixtures/body.html'\n      },\n      text: 'hello world',\n      attachments: [{\n        filename: 'image.png',\n        path: __dirname + '/../json-transport/fixtures/image.png'\n      }]\n    };\n    transport.sendMail(messageObject, (err, info) => {\n      expect(err).to.not.exist;\n      expect(info).to.exist;\n      expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n      expect(info.envelope).to.deep.equal({\n        from: 'andris.reinman@gmail.com',\n        to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n      });\n      expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n      expect(info.response).to.equal('testtest');\n      done();\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should limit parallel connections, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":377,"column":72},"line":377,"code":"  it('should limit parallel connections, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      maxConnections: 2,\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setTimeout(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                }, 100);\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(5000);\n          expect(Date.now() - start).to.be.lte(10000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should limit parallel connections, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":442,"column":72},"line":442,"code":"  it('should limit parallel connections, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      maxConnections: 2,\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setTimeout(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              }, 100);\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(5000);\n          expect(Date.now() - start).to.be.lte(10000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit messages, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":512,"column":65},"line":512,"code":"  it('should rate limit messages, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 10,\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setTimeout(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                }, 100);\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit messages, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":577,"column":65},"line":577,"code":"  it('should rate limit messages, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 10,\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setTimeout(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              }, 100);\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit long messages, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":647,"column":70},"line":647,"code":"  it('should rate limit long messages, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 30,\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setTimeout(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                }, 3000);\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(12000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit long messages, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":712,"column":70},"line":712,"code":"  it('should rate limit long messages, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 30,\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setTimeout(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              }, 3000);\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(12000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit messages and connections, using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":782,"column":81},"line":782,"code":"  it('should rate limit messages and connections, using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 100,\n      maxConnections: 1,\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setTimeout(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                }, 100);\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"should rate limit messages and connections, using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":848,"column":81},"line":848,"code":"  it('should rate limit messages and connections, using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 100,\n      maxConnections: 1,\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setTimeout(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              }, 100);\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n\n    for (let i = 0; i < total; i++) {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    }\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"detect sending slots on idle events, , using AWS SES JavaScript SDK v2","suites":["SES Transport Tests"],"updatePoint":{"line":919,"column":76},"line":919,"code":"  it('detect sending slots on idle events, , using AWS SES JavaScript SDK v2', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 100,\n      maxConnections: 1,\n      SES: {\n        config: {\n          region: 'eu-west-1'\n        },\n\n        sendRawEmail() {\n          return {\n            promise() {\n              return new Promise(resolve => {\n                setTimeout(() => {\n                  resolve({\n                    MessageId: 'testtest'\n                  });\n                }, 100);\n              });\n            }\n\n          };\n        }\n\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n    let sent = 0;\n\n    let sendNext = () => {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    };\n\n    transport.on('idle', () => {\n      while (transport.isIdle() && sent < total) {\n        sent++;\n        sendNext();\n      }\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"detect sending slots on idle events, , using AWS SES JavaScript SDK v3","suites":["SES Transport Tests"],"updatePoint":{"line":993,"column":76},"line":993,"code":"  it('detect sending slots on idle events, , using AWS SES JavaScript SDK v3', function (done) {\n    let transport = nodemailer.createTransport({\n      sendingRate: 100,\n      maxConnections: 1,\n      SES: {\n        ses: {\n          config: {\n            region: 'eu-west-1'\n          },\n\n          send() {\n            return new Promise(resolve => {\n              setTimeout(() => {\n                resolve({\n                  MessageId: 'testtest'\n                });\n              }, 100);\n            });\n          }\n\n        },\n        aws: {\n          /* eslint-disable */\n          SendRawEmailCommand: function\n            /*message*/\n          () {\n            /* Constructor */\n          }\n        }\n      }\n    });\n    let total = 100;\n    let finished = 0;\n    let start = Date.now();\n    let sent = 0;\n\n    let sendNext = () => {\n      let messageObject = {\n        from: 'Andris Reinman <andris.reinman@gmail.com>',\n        to: 'Andris Kreata <andris@kreata.ee>, andris@nodemailer.com',\n        cc: 'info@nodemailer.com',\n        subject: 'Awesome!',\n        messageId: '<fede478a-aab9-af02-789c-ad93a76a3548@gmail.com>',\n        html: {\n          path: __dirname + '/../json-transport/fixtures/body.html'\n        },\n        text: 'hello world',\n        attachments: [{\n          filename: 'image.png',\n          path: __dirname + '/../json-transport/fixtures/image.png'\n        }]\n      };\n      transport.sendMail(messageObject, (err, info) => {\n        finished++;\n        expect(err).to.not.exist;\n        expect(info).to.exist;\n        expect(info).to.have.keys('envelope', 'messageId', 'response', 'raw');\n        expect(info.envelope).to.deep.equal({\n          from: 'andris.reinman@gmail.com',\n          to: ['andris@kreata.ee', 'andris@nodemailer.com', 'info@nodemailer.com']\n        });\n        expect(info.messageId).to.equal('<testtest@eu-west-1.amazonses.com>');\n        expect(info.response).to.equal('testtest');\n\n        if (total === finished) {\n          expect(Date.now() - start).to.be.gte(10000);\n          expect(Date.now() - start).to.be.lte(15000);\n          return done();\n        }\n      });\n    };\n\n    transport.on('idle', () => {\n      while (transport.isIdle() && sent < total) {\n        sent++;\n        sendNext();\n      }\n    });\n  });","file":"ses-transport/ses-transport-test.js","skipped":false,"dir":"test"},{"name":"Should create a logger","suites":["Shared Funcs Tests","Logger tests"],"updatePoint":{"line":21,"column":30},"line":21,"code":"    it('Should create a logger', function () {\n      expect(typeof shared.getLogger({\n        logger: false\n      })).to.equal('object');\n      expect(typeof shared.getLogger({\n        logger: true\n      })).to.equal('object');\n      expect(typeof shared.getLogger()).to.equal('object');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"Should parse connection url","suites":["Shared Funcs Tests","Connection url parser tests"],"updatePoint":{"line":32,"column":35},"line":32,"code":"    it('Should parse connection url', function () {\n      let url = 'smtps://user:pass@localhost:123?tls.rejectUnauthorized=false&name=horizon';\n      expect(shared.parseConnectionUrl(url)).to.deep.equal({\n        secure: true,\n        port: 123,\n        host: 'localhost',\n        auth: {\n          user: 'user',\n          pass: 'pass'\n        },\n        tls: {\n          rejectUnauthorized: false\n        },\n        name: 'horizon'\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should not choke on special symbols in auth","suites":["Shared Funcs Tests","Connection url parser tests"],"updatePoint":{"line":48,"column":51},"line":48,"code":"    it('should not choke on special symbols in auth', function () {\n      let url = 'smtps://user%40gmail.com:%3Apasswith%25Char@smtp.gmail.com';\n      expect(shared.parseConnectionUrl(url)).to.deep.equal({\n        secure: true,\n        host: 'smtp.gmail.com',\n        auth: {\n          user: 'user@gmail.com',\n          pass: ':passwith%Char'\n        }\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from html string","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":91,"column":40},"line":91,"code":"    it('should set text from html string', function (done) {\n      let mail = {\n        data: {\n          html: '<p>Tere, tere</p><p>vana kere!</p>\\n'\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.equal('<p>Tere, tere</p><p>vana kere!</p>\\n');\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from html buffer","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":103,"column":40},"line":103,"code":"    it('should set text from html buffer', function (done) {\n      let mail = {\n        data: {\n          html: Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n')\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(mail.data.html);\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from a html file","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":115,"column":40},"line":115,"code":"    it('should set text from a html file', function (done) {\n      let mail = {\n        data: {\n          html: {\n            path: __dirname + '/fixtures/message.html'\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from an html url","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":129,"column":40},"line":129,"code":"    it('should set text from an html url', function (done) {\n      let mail = {\n        data: {\n          html: {\n            path: 'http://localhost:' + port + '/message.html'\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from redirecting url","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":143,"column":44},"line":143,"code":"    it('should set text from redirecting url', function (done) {\n      let mail = {\n        data: {\n          html: {\n            path: 'http://localhost:' + port + '/redirect.html'\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from gzipped url","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":157,"column":40},"line":157,"code":"    it('should set text from gzipped url', function (done) {\n      let mail = {\n        data: {\n          html: {\n            path: 'http://localhost:' + port + '/compressed.html'\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set text from a html stream","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":171,"column":42},"line":171,"code":"    it('should set text from a html stream', function (done) {\n      let mail = {\n        data: {\n          html: fs.createReadStream(__dirname + '/fixtures/message.html')\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(mail).to.deep.equal({\n          data: {\n            html: Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n')\n          }\n        });\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should set content from a stream and preserve other properties","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":188,"column":70},"line":188,"code":"    it('should set content from a stream and preserve other properties', function (done) {\n      let mail = {\n        data: {\n          attachment: {\n            filename: 'message.html',\n            content: fs.createReadStream(__dirname + '/fixtures/message.html')\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'attachment', function (err, value) {\n        expect(err).to.not.exist;\n        expect(mail).to.deep.equal({\n          data: {\n            attachment: {\n              filename: 'message.html',\n              content: Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n')\n            }\n          }\n        });\n        expect(value).to.deep.equal(Buffer.from('<p>Tere, tere</p><p>vana kere!</p>\\n'));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should return an error","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":211,"column":30},"line":211,"code":"    it('should return an error', function (done) {\n      let mail = {\n        data: {\n          html: {\n            path: 'http://localhost:' + (port + 1000) + '/message.html'\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should return encoded string as buffer","suites":["Shared Funcs Tests","Resolver tests"],"updatePoint":{"line":224,"column":46},"line":224,"code":"    it('should return encoded string as buffer', function (done) {\n      let str = '<p>Tere, tere</p><p>vana kere!</p>\\n';\n      let mail = {\n        data: {\n          html: {\n            encoding: 'base64',\n            content: Buffer.from(str).toString('base64')\n          }\n        }\n      };\n      shared.resolveContent(mail.data, 'html', function (err, value) {\n        expect(err).to.not.exist;\n        expect(value).to.deep.equal(Buffer.from(str));\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve with mime type and base64","suites":["Shared Funcs Tests","Resolver tests","data uri tests"],"updatePoint":{"line":241,"column":50},"line":241,"code":"      it('should resolve with mime type and base64', function (done) {\n        let mail = {\n          data: {\n            attachment: {\n              path: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='\n            }\n          }\n        };\n        shared.resolveContent(mail.data, 'attachment', function (err, value) {\n          expect(err).to.not.exist;\n          expect(value).to.deep.equal(Buffer.from('iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==', 'base64'));\n          done();\n        });\n      });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve with mime type and plaintext","suites":["Shared Funcs Tests","Resolver tests","data uri tests"],"updatePoint":{"line":255,"column":53},"line":255,"code":"      it('should resolve with mime type and plaintext', function (done) {\n        let mail = {\n          data: {\n            attachment: {\n              path: 'data:image/png,tere%20tere'\n            }\n          }\n        };\n        shared.resolveContent(mail.data, 'attachment', function (err, value) {\n          expect(err).to.not.exist;\n          expect(value).to.deep.equal(Buffer.from('tere tere'));\n          done();\n        });\n      });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve with plaintext","suites":["Shared Funcs Tests","Resolver tests","data uri tests"],"updatePoint":{"line":269,"column":39},"line":269,"code":"      it('should resolve with plaintext', function (done) {\n        let mail = {\n          data: {\n            attachment: {\n              path: 'data:,tere%20tere'\n            }\n          }\n        };\n        shared.resolveContent(mail.data, 'attachment', function (err, value) {\n          expect(err).to.not.exist;\n          expect(value).to.deep.equal(Buffer.from('tere tere'));\n          done();\n        });\n      });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve with mime type, charset and base64","suites":["Shared Funcs Tests","Resolver tests","data uri tests"],"updatePoint":{"line":283,"column":59},"line":283,"code":"      it('should resolve with mime type, charset and base64', function (done) {\n        let mail = {\n          data: {\n            attachment: {\n              path: 'data:image/png;charset=iso-8859-1;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg=='\n            }\n          }\n        };\n        shared.resolveContent(mail.data, 'attachment', function (err, value) {\n          expect(err).to.not.exist;\n          expect(value).to.deep.equal(Buffer.from('iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==', 'base64'));\n          done();\n        });\n      });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should assign multiple objects to target","suites":["Shared Funcs Tests","#assign tests"],"updatePoint":{"line":300,"column":48},"line":300,"code":"    it('should assign multiple objects to target', function () {\n      let target = {\n        a: 1,\n        b: 2,\n        c: 3\n      };\n      let arg1 = {\n        b: 5,\n        y: 66,\n        e: 33\n      };\n      let arg2 = {\n        y: 17,\n        qq: 98\n      };\n      shared.assign(target, arg1, arg2);\n      expect(target).to.deep.equal({\n        a: 1,\n        b: 5,\n        c: 3,\n        y: 17,\n        e: 33,\n        qq: 98\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should not encode atom","suites":["Shared Funcs Tests","#encodeXText tests"],"updatePoint":{"line":327,"column":30},"line":327,"code":"    it('should not encode atom', function () {\n      expect(shared.encodeXText('teretere')).to.equal('teretere');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should not encode email","suites":["Shared Funcs Tests","#encodeXText tests"],"updatePoint":{"line":330,"column":31},"line":330,"code":"    it('should not encode email', function () {\n      expect(shared.encodeXText('andris.reinman@gmail.com')).to.equal('andris.reinman@gmail.com');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should encode space","suites":["Shared Funcs Tests","#encodeXText tests"],"updatePoint":{"line":333,"column":27},"line":333,"code":"    it('should encode space', function () {\n      expect(shared.encodeXText('tere tere')).to.equal('tere+20tere');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should encode unicode","suites":["Shared Funcs Tests","#encodeXText tests"],"updatePoint":{"line":336,"column":29},"line":336,"code":"    it('should encode unicode', function () {\n      expect(shared.encodeXText('tere tõre')).to.equal('tere+20t+C3+B5re');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should encode low codes","suites":["Shared Funcs Tests","#encodeXText tests"],"updatePoint":{"line":339,"column":31},"line":339,"code":"    it('should encode low codes', function () {\n      expect(shared.encodeXText('tere t\\tre')).to.equal('tere+20t+09re');\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve a single IPv4 entry","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":363,"column":42},"line":363,"code":"    it('should resolve a single IPv4 entry', function (done) {\n      shared.resolveHostname({\n        host: 'ipv4.single.dev.ethereal.email'\n      }, (err, result) => {\n        expect(err).to.not.exist;\n        expect(result).to.deep.equal({\n          servername: 'ipv4.single.dev.ethereal.email',\n          host: '54.36.85.114',\n          cached: false\n        });\n        shared.resolveHostname({\n          host: 'ipv4.single.dev.ethereal.email'\n        }, (err, result) => {\n          expect(err).to.not.exist;\n          expect(result).to.deep.equal({\n            servername: 'ipv4.single.dev.ethereal.email',\n            host: '54.36.85.114',\n            cached: true\n          });\n          done();\n        });\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve multiple IPv4 entries","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":386,"column":44},"line":386,"code":"    it('should resolve multiple IPv4 entries', function (done) {\n      let found = new Set();\n      let count = 0;\n\n      let resolveNext = () => {\n        if (count++ > 100) {\n          expect(new Error('too many tries')).to.not.exist;\n          return done();\n        }\n\n        if (found.size === 3) {\n          return done();\n        }\n\n        shared.resolveHostname({\n          host: 'ipv4.multi.dev.ethereal.email'\n        }, (err, result) => {\n          expect(err).to.not.exist;\n          expect(result.servername).to.equal('ipv4.multi.dev.ethereal.email');\n          expect(result.host).to.exist;\n          found.add(result.host);\n          resolveNext();\n        });\n      };\n\n      resolveNext();\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should resolve a single IPv6 entry","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":413,"column":42},"line":413,"code":"    it('should resolve a single IPv6 entry', function (done) {\n      // ensure that there is a single Ipv6 interface \"available\"\n      Object.keys(shared.networkInterfaces).forEach(key => {\n        delete shared.networkInterfaces[key];\n      });\n      shared.networkInterfaces.en0 = [{\n        address: 'fe80::184e:7a8e:2d67:be86',\n        netmask: 'ffff:ffff:ffff:ffff::',\n        family: 'IPv6',\n        mac: 'f0:18:98:57:76:44',\n        internal: false,\n        cidr: 'fe80::184e:7a8e:2d67:be86/64',\n        scopeid: 6\n      }];\n      shared.resolveHostname({\n        host: 'ipv6.single.dev.ethereal.email'\n      }, (err, result) => {\n        expect(err).to.not.exist;\n        expect(result).to.deep.equal({\n          servername: 'ipv6.single.dev.ethereal.email',\n          host: '2001:41d0:304:200::baa9',\n          cached: false\n        });\n        shared.resolveHostname({\n          host: 'ipv6.single.dev.ethereal.email'\n        }, (err, result) => {\n          expect(err).to.not.exist;\n          expect(result).to.deep.equal({\n            servername: 'ipv6.single.dev.ethereal.email',\n            host: '2001:41d0:304:200::baa9',\n            cached: true\n          });\n          done();\n        });\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should fail resolving a single IPv6 entry","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":449,"column":49},"line":449,"code":"    it('should fail resolving a single IPv6 entry', function (done) {\n      // ensure that there is a single Ipv4 interface \"available\"\n      Object.keys(shared.networkInterfaces).forEach(key => {\n        delete shared.networkInterfaces[key];\n      });\n      shared.networkInterfaces.en0 = [{\n        address: '192.168.1.175',\n        netmask: '255.255.255.0',\n        family: 'IPv4',\n        mac: 'f0:18:98:57:76:44',\n        internal: false,\n        cidr: '192.168.1.175/24'\n      }];\n      shared.resolveHostname({\n        host: 'ipv6.single.dev.ethereal.email'\n      }, err => {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should fail missing address","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":469,"column":35},"line":469,"code":"    it('should fail missing address', function (done) {\n      shared.resolveHostname({\n        host: 'missing.single.dev.ethereal.email'\n      }, err => {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should return provided IP","suites":["Shared Funcs Tests","#resolveHostname tests"],"updatePoint":{"line":477,"column":33},"line":477,"code":"    it('should return provided IP', function (done) {\n      shared.resolveHostname({\n        host: '1.2.3.4',\n        servername: 'example.com'\n      }, (err, result) => {\n        expect(err).to.not.exist;\n        expect(result).to.deep.equal({\n          servername: 'example.com',\n          host: '1.2.3.4',\n          cached: false\n        });\n        done();\n      });\n    });","file":"shared/shared-test.js","skipped":false,"dir":"test"},{"name":"should connect to a socket through proxy","suites":["HTTP Proxy Client Tests"],"updatePoint":{"line":21,"column":46},"line":21,"code":"  it('should connect to a socket through proxy', function (done) {\n    let smtpServer = new SMTPServer({\n      logger: false\n    });\n    smtpServer.listen(TARGET_PORT, () => {\n      let proxyServer = proxy(http.createServer());\n      proxyServer.listen(PROXY_PORT, () => {\n        httpProxyClient('http://localhost:' + PROXY_PORT, TARGET_PORT, '127.0.0.1', (err, socket) => {\n          expect(err).to.not.exist;\n          socket.once('data', chunk => {\n            expect(/^220[ -]/.test(chunk.toString())).to.be.true;\n            socket.end();\n            socket.on('close', () => {\n              socket.destroy();\n              smtpServer.close(() => setImmediate(done) && proxyServer.close());\n            });\n          });\n        });\n      });\n    });\n  });","file":"smtp-connection/http-proxy-client-test.js","skipped":false,"dir":"test"},{"name":"should connect to a socket through proxy with auth","suites":["HTTP Proxy Client Tests"],"updatePoint":{"line":42,"column":56},"line":42,"code":"  it('should connect to a socket through proxy with auth', function (done) {\n    let smtpServer = new SMTPServer({\n      logger: false\n    });\n    smtpServer.listen(TARGET_PORT, () => {\n      let proxyServer = proxy(http.createServer());\n\n      proxyServer.authenticate = (req, cb) => {\n        cb(null, req.headers['proxy-authorization'] === 'Basic dGVzdDpwZXN0');\n      };\n\n      proxyServer.listen(PROXY_PORT, () => {\n        httpProxyClient('http://test:pest@localhost:' + PROXY_PORT, TARGET_PORT, '127.0.0.1', (err, socket) => {\n          expect(err).to.not.exist;\n          socket.once('data', chunk => {\n            expect(/^220[ -]/.test(chunk.toString())).to.be.true;\n            socket.end();\n            socket.on('close', () => {\n              socket.destroy();\n              smtpServer.close(() => setImmediate(done) && proxyServer.close());\n            });\n          });\n        });\n      });\n    });\n  });","file":"smtp-connection/http-proxy-client-test.js","skipped":false,"dir":"test"},{"name":"should should fail auth","suites":["HTTP Proxy Client Tests"],"updatePoint":{"line":68,"column":29},"line":68,"code":"  it('should should fail auth', function (done) {\n    let smtpServer = new SMTPServer({\n      logger: false\n    });\n    smtpServer.listen(TARGET_PORT, () => {\n      let proxyServer = proxy(http.createServer());\n\n      proxyServer.authenticate = (req, cb) => {\n        cb(null, req.headers['proxy-authorization'] === 'Basic dGVzdDpwZXN0');\n      };\n\n      proxyServer.listen(PROXY_PORT, () => {\n        httpProxyClient('http://test:kest@localhost:' + PROXY_PORT, TARGET_PORT, '127.0.0.1', (err, socket) => {\n          expect(err).to.exist;\n          expect(socket).to.not.exist;\n          smtpServer.close(() => setImmediate(done) && proxyServer.close());\n        });\n      });\n    });\n  });","file":"smtp-connection/http-proxy-client-test.js","skipped":false,"dir":"test"},{"name":"Should expose version number","suites":["SMTP-Connection Tests","Version test"],"updatePoint":{"line":37,"column":36},"line":37,"code":"    it('Should expose version number', function () {\n      let client = new SMTPConnection();\n      expect(client.version).to.equal(packageData.version);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect to unsecure server","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":121,"column":41},"line":121,"code":"    it('should connect to unsecure server', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 3,\n        ignoreTLS: true,\n        logger: false\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.false;\n        client.close();\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect to a server and upgrade with STARTTLS","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":136,"column":60},"line":136,"code":"    it('should connect to a server and upgrade with STARTTLS', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER,\n        logger: false\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.true;\n        client.close();\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect to a server and upgrade with forced STARTTLS","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":150,"column":67},"line":150,"code":"    it('should connect to a server and upgrade with forced STARTTLS', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER,\n        requireTLS: true,\n        transactionLog: true,\n        logger: false\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.true;\n        client.close();\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect to a server and try to upgrade STARTTLS","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":166,"column":62},"line":166,"code":"    it('should connect to a server and try to upgrade STARTTLS', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 3,\n        logger: false,\n        requireTLS: true,\n        opportunisticTLS: true\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.false;\n        client.close();\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should try upgrade with STARTTLS where not advertised","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":182,"column":61},"line":182,"code":"    it('should try upgrade with STARTTLS where not advertised', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 3,\n        requireTLS: true,\n        logger: false\n      });\n      client.connect(function () {\n        // should not run\n        expect(false).to.be.true;\n        client.close();\n      });\n      client.once('error', function (err) {\n        expect(err).to.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should close connection after STARTTLS","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":198,"column":46},"line":198,"code":"    it('should close connection after STARTTLS', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER,\n        logger: false\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.true;\n        server.connections.forEach(function (conn) {\n          conn.close();\n        });\n      });\n      client.on('error', function (err) {\n        expect(err.message).to.equal('Connection closed unexpectedly');\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect to a secure server","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":214,"column":41},"line":214,"code":"    it('should connect to a secure server', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 2,\n        secure: true,\n        logger: false\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.true;\n        client.close();\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should emit error for invalid port","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":229,"column":42},"line":229,"code":"    it('should emit error for invalid port', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 10,\n        logger: false\n      });\n      client.connect(function () {\n        // should not run\n        expect(false).to.be.true;\n        client.close();\n      });\n      client.once('error', function (err) {\n        expect(err).to.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should emit error for too large port","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":244,"column":44},"line":244,"code":"    it('should emit error for too large port', function (done) {\n      let client = new SMTPConnection({\n        port: 999999999,\n        logger: false\n      });\n      client.connect(function () {\n        // should not run\n        expect(false).to.be.true;\n        client.close();\n      });\n      client.once('error', function (err) {\n        expect(err).to.exist;\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should emit inactivity timeout error","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":259,"column":44},"line":259,"code":"    it('should emit inactivity timeout error', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER,\n        socketTimeout: 100,\n        logger: false\n      });\n      client.connect(function () {// do nothing\n      });\n      client.once('error', function (err) {\n        expect(err).to.exist;\n        expect(err.code).to.equal('ETIMEDOUT');\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect through proxy","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":273,"column":36},"line":273,"code":"    it('should connect through proxy', function (done) {\n      let runTest = function (socket) {\n        let client = new SMTPConnection({\n          logger: false,\n          port: PORT_NUMBER,\n          connection: socket\n        });\n        client.connect(function () {\n          expect(client.secure).to.be.true;\n          client.login({\n            user: 'testuser',\n            credentials: {\n              user: 'testuser',\n              pass: 'testpass'\n            }\n          }, function (err) {\n            expect(err).to.not.exist;\n            expect(client.authenticated).to.be.true;\n            client.close();\n          });\n        });\n        client.on('error', function (err) {\n          expect(err).to.not.exist;\n        });\n        client.on('end', done);\n      };\n\n      proxyConnect(PROXY_PORT_NUMBER, '127.0.0.1', PORT_NUMBER, '127.0.0.1', function (err, socket) {\n        expect(err).to.not.exist;\n        runTest(socket);\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should connect through proxy to secure server","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":305,"column":53},"line":305,"code":"    it('should connect through proxy to secure server', function (done) {\n      let runTest = function (socket) {\n        let client = new SMTPConnection({\n          logger: false,\n          port: PORT_NUMBER + 2,\n          secure: true,\n          connection: socket\n        });\n        client.connect(function () {\n          expect(client.secure).to.be.true;\n          client.login({\n            user: 'testuser',\n            credentials: {\n              user: 'testuser',\n              pass: 'testpass'\n            }\n          }, function (err) {\n            expect(err).to.not.exist;\n            expect(client.authenticated).to.be.true;\n            client.close();\n          });\n        });\n        client.on('error', function (err) {\n          expect(err).to.not.exist;\n        });\n        client.on('end', done);\n      };\n\n      proxyConnect(PROXY_PORT_NUMBER, '127.0.0.1', PORT_NUMBER + 2, '127.0.0.1', function (err, socket) {\n        expect(err).to.not.exist;\n        runTest(socket);\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send to unsecure server","suites":["SMTP-Connection Tests","Connection tests"],"updatePoint":{"line":338,"column":38},"line":338,"code":"    it('should send to unsecure server', function (done) {\n      let client = new SMTPConnection({\n        port: PORT_NUMBER + 3,\n        ignoreTLS: true,\n        logger: false\n      });\n      client.on('error', function (err) {\n        expect(err).to.not.exist;\n      });\n      client.connect(function () {\n        expect(client.secure).to.be.false;\n        let chunks = [],\n            fname = __dirname + '/../../LICENSE',\n            message = fs.readFileSync(fname, 'utf-8');\n        server.on('data', function (connection, chunk) {\n          chunks.push(chunk);\n        });\n        server.removeAllListeners('dataReady');\n        server.on('dataReady', function (connection, callback) {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.toString().trim().replace(/\\n/g, '\\r\\n'));\n          callback(null, 'ABC1');\n        });\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, fs.createReadStream(fname), function (err) {\n          expect(err).to.not.exist;\n          client.close();\n        });\n      });\n      client.on('end', done);\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should login","suites":["SMTP-Connection Tests","Login tests"],"updatePoint":{"line":514,"column":20},"line":514,"code":"    it('should login', function (done) {\n      expect(client.authenticated).to.be.false;\n      client.login({\n        user: 'testuser',\n        credentials: {\n          user: 'testuser',\n          pass: 'testpass'\n        }\n      }, function (err) {\n        expect(err).to.not.exist;\n        expect(client.authenticated).to.be.true;\n        done();\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid login","suites":["SMTP-Connection Tests","Login tests"],"updatePoint":{"line":528,"column":45},"line":528,"code":"    it('should return error for invalid login', function (done) {\n      expect(client.authenticated).to.be.false;\n      client.login({\n        user: 'testuser',\n        credentials: {\n          user: 'testuser',\n          pass: 'invalid'\n        }\n      }, function (err) {\n        expect(err).to.exist;\n        expect(client.authenticated).to.be.false;\n        expect(err.code).to.equal('EAUTH');\n        expect(err.responseCode).to.equal(535);\n        done();\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for missing credentials","suites":["SMTP-Connection Tests","Login tests"],"updatePoint":{"line":544,"column":51},"line":544,"code":"    it('should return error for missing credentials', function (done) {\n      expect(client.authenticated).to.be.false;\n      client.login({\n        user: 'testuser'\n      }, function (err) {\n        expect(err).to.exist;\n        expect(client.authenticated).to.be.false;\n        expect(err.message).to.match(/^Missing credentials/);\n        expect(err.code).to.equal('EAUTH');\n        expect(err.response).to.be.undefined;\n        done();\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for incomplete credentials","suites":["SMTP-Connection Tests","Login tests"],"updatePoint":{"line":557,"column":54},"line":557,"code":"    it('should return error for incomplete credentials', function (done) {\n      expect(client.authenticated).to.be.false;\n      client.login({\n        user: 'testuser',\n        credentials: {\n          user: 'testuser'\n        }\n      }, function (err) {\n        expect(err).to.exist;\n        expect(client.authenticated).to.be.false;\n        expect(err.message).to.match(/^Missing credentials/);\n        expect(err.code).to.equal('EAUTH');\n        expect(err.response).to.be.undefined;\n        done();\n      });\n    });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should login with xoauth2 string","suites":["SMTP-Connection Tests","Login tests","xoauth2 login"],"updatePoint":{"line":589,"column":42},"line":589,"code":"      it('should login with xoauth2 string', function (done) {\n        expect(client.authenticated).to.be.false;\n        client.login({\n          type: 'oauth2',\n          user: 'testuser',\n          oauth2: new XOAuth2({\n            user: 'testuser',\n            accessToken: testtoken\n          })\n        }, function (err) {\n          expect(err).to.not.exist;\n          expect(client.authenticated).to.be.true;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid xoauth2 string token","suites":["SMTP-Connection Tests","Login tests","xoauth2 login"],"updatePoint":{"line":604,"column":62},"line":604,"code":"      it('should return error for invalid xoauth2 string token', function (done) {\n        expect(client.authenticated).to.be.false;\n        client.login({\n          type: 'oauth2',\n          user: 'testuser',\n          oauth2: new XOAuth2({\n            user: 'testuser',\n            accessToken: 'invalid'\n          })\n        }, function (err) {\n          expect(err).to.exist;\n          expect(client.authenticated).to.be.false;\n          expect(err.code).to.equal('EAUTH');\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should login with xoauth2 object","suites":["SMTP-Connection Tests","Login tests","xoauth2 login"],"updatePoint":{"line":620,"column":42},"line":620,"code":"      it('should login with xoauth2 object', function (done) {\n        expect(client.authenticated).to.be.false;\n        client.login({\n          type: 'oauth2',\n          user: 'testuser',\n          oauth2: new XOAuth2({\n            user: 'testuser',\n            clientId: '{Client ID}',\n            clientSecret: '{Client Secret}',\n            refreshToken: 'refresh-token',\n            accessToken: 'uuuuu',\n            accessUrl: 'http://localhost:' + XOAUTH_PORT\n          })\n        }, function (err) {\n          expect(err).to.not.exist;\n          expect(client.authenticated).to.be.true;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should fail with xoauth2 object","suites":["SMTP-Connection Tests","Login tests","xoauth2 login"],"updatePoint":{"line":639,"column":41},"line":639,"code":"      it('should fail with xoauth2 object', function (done) {\n        expect(client.authenticated).to.be.false;\n        client.login({\n          type: 'oauth2',\n          user: 'testuser',\n          oauth2: new XOAuth2({\n            user: 'testuser',\n            clientId: '{Client ID}',\n            clientSecret: '{Client Secret}',\n            refreshToken: 'refrsesh-token',\n            accessToken: 'uuuuu',\n            accessUrl: 'http://localhost:' + XOAUTH_PORT\n          })\n        }, function (err) {\n          expect(err).to.exist;\n          expect(client.authenticated).to.be.false;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should fail with invalid xoauth2 response","suites":["SMTP-Connection Tests","Login tests","xoauth2 login"],"updatePoint":{"line":658,"column":51},"line":658,"code":"      it('should fail with invalid xoauth2 response', function (done) {\n        expect(client.authenticated).to.be.false;\n        let oauth2 = new XOAuth2({\n          user: 'testuser',\n          clientId: '{Client ID}',\n          clientSecret: '{Client Secret}',\n          refreshToken: 'refrsesh-token',\n          accessToken: 'uuuuu',\n          accessUrl: 'http://localhost:' + XOAUTH_PORT\n        });\n        sinon.stub(oauth2, 'generateToken').yields(null, 'dXNlcj10ZXN0dXNlcgFhdXRoPUJlYXJlciB1dXV1dQEB');\n        client.login({\n          type: 'oauth2',\n          user: 'testuser',\n          oauth2\n        }, function (err) {\n          expect(err).to.exist;\n          expect(client.authenticated).to.be.false;\n          oauth2.generateToken.restore();\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should login","suites":["SMTP-Connection Tests","Login tests","custom login"],"updatePoint":{"line":708,"column":22},"line":708,"code":"      it('should login', function (done) {\n        expect(customClient.authenticated).to.be.false;\n        customClient.login({\n          method: 'mytest',\n          user: 'testuser',\n          credentials: {\n            user: 'testuser',\n            pass: 'testpass'\n          }\n        }, function (err) {\n          expect(err).to.not.exist;\n          expect(customClient.authenticated).to.be.true;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send only to valid recipients without PIPELINING","suites":["SMTP-Connection Tests","Login tests","Send without PIPELINING"],"updatePoint":{"line":751,"column":65},"line":751,"code":"      it('should send only to valid recipients without PIPELINING', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3@valid.recipient']\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test1@valid.recipient', 'test3@valid.recipient'],\n            rejected: ['test2@invalid.recipient'],\n            rejectedErrors: info.rejectedErrors,\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          expect(info.rejectedErrors.length).to.equal(1);\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send message","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":784,"column":29},"line":784,"code":"      it('should send message', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test@valid.recipient'],\n            rejected: [],\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send multiple messages","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":801,"column":39},"line":801,"code":"      it('should send multiple messages', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test@valid.recipient'],\n            rejected: [],\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          client.reset(function (err) {\n            expect(err).to.not.exist;\n            client.send({\n              from: 'test2@valid.sender',\n              to: 'test2@valid.recipient'\n            }, 'test2', function (err, info) {\n              expect(err).to.not.exist;\n              expect(info).to.deep.equal({\n                accepted: ['test2@valid.recipient'],\n                rejected: [],\n                envelopeTime: info.envelopeTime,\n                messageTime: info.messageTime,\n                messageSize: info.messageSize,\n                response: '250 OK: message queued'\n              });\n              done();\n            });\n          });\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send only to valid recipients","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":835,"column":46},"line":835,"code":"      it('should send only to valid recipients', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3@valid.recipient']\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test1@valid.recipient', 'test3@valid.recipient'],\n            rejected: ['test2@invalid.recipient'],\n            rejectedErrors: info.rejectedErrors,\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          expect(info.rejectedErrors.length).to.equal(1);\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should reject all recipients","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":854,"column":38},"line":854,"code":"      it('should reject all recipients', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test1@invalid.recipient', 'test2@invalid.recipient', 'test3@invalid.recipient']\n        }, 'test', function (err, info) {\n          expect(err).to.exist;\n          expect(info).to.not.exist;\n          expect(err.rejected).to.deep.equal(['test1@invalid.recipient', 'test2@invalid.recipient', 'test3@invalid.recipient']);\n          expect(err.rejectedErrors.length).to.equal(3);\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should reject too large SIZE arguments","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":866,"column":48},"line":866,"code":"      it('should reject too large SIZE arguments', function (done) {\n        client.send({\n          from: 'test2@valid.sender',\n          to: 'test2@valid.recipient',\n          size: 1024 * 1024\n        }, 'test', function (err, info) {\n          expect(err).to.exist;\n          expect(info).to.not.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should reject too large message","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":877,"column":41},"line":877,"code":"      it('should reject too large message', function (done) {\n        client.send({\n          from: 'test2@valid.sender',\n          to: 'test2@valid.recipient',\n          size: 70 * 1024\n        }, 'test', function (err, info) {\n          expect(err).to.exist;\n          expect(info).to.not.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should declare SIZE","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":888,"column":29},"line":888,"code":"      it('should declare SIZE', function (done) {\n        client.send({\n          from: 'test2@valid.sender',\n          to: 'test2@valid.recipient',\n          size: 10 * 1024\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test2@valid.recipient'],\n            rejected: [],\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"lmtp should send only to valid recipients","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":906,"column":51},"line":906,"code":"      it('lmtp should send only to valid recipients', function (done) {\n        lmtpClient.send({\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3@valid.recipient', 'test4@valid.recipient', 'test5@valid.recipient', 'test6@valid.recipient']\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info.accepted).to.deep.equal(['test3@valid.recipient', 'test5@valid.recipient']);\n          expect(info.rejected).to.deep.equal(['test2@invalid.recipient', 'test1@valid.recipient', 'test4@valid.recipient', 'test6@valid.recipient']);\n          expect(info.rejectedErrors.length).to.equal(info.rejected.length);\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send using SMTPUTF8","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":918,"column":36},"line":918,"code":"      it('should send using SMTPUTF8', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3õ@valid.recipient']\n        }, 'test', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test1@valid.recipient', 'test3õ@valid.recipient'],\n            rejected: ['test2@invalid.recipient'],\n            rejectedErrors: info.rejectedErrors,\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send using 8BITMIME","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":936,"column":36},"line":936,"code":"      it('should send using 8BITMIME', function (done) {\n        client.send({\n          use8BitMime: true,\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3õ@valid.recipient']\n        }, 'õõõõ', function (err, info) {\n          expect(err).to.not.exist;\n          expect(info).to.deep.equal({\n            accepted: ['test1@valid.recipient', 'test3õ@valid.recipient'],\n            rejected: ['test2@invalid.recipient'],\n            rejectedErrors: info.rejectedErrors,\n            envelopeTime: info.envelopeTime,\n            messageTime: info.messageTime,\n            messageSize: info.messageSize,\n            response: '250 OK: message queued'\n          });\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should receive error for 8-bit content without 8BITMIME declaration","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":955,"column":77},"line":955,"code":"      it('should receive error for 8-bit content without 8BITMIME declaration', function (done) {\n        client.send({\n          use8BitMime: false,\n          from: 'test@valid.sender',\n          to: ['test1@valid.recipient', 'test2@invalid.recipient', 'test3õ@valid.recipient']\n        }, 'õõõõ', function (err) {\n          expect(/8 bit content not allowed/.test(err.message)).to.be.true;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalidly formatted recipients","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":965,"column":64},"line":965,"code":"      it('should return error for invalidly formatted recipients', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test@valid.recipient', '\"address\\r\\n with folding\"@valid.recipient']\n        }, 'test', function (err) {\n          expect(/^Invalid recipient/.test(err.message)).to.be.true;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for no valid recipients","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":974,"column":53},"line":974,"code":"      it('should return error for no valid recipients', function (done) {\n        client.send({\n          from: 'test@valid.sender',\n          to: ['test1@invalid.recipient', 'test2@invalid.recipient', 'test3@invalid.recipient']\n        }, 'test', function (err) {\n          expect(err).to.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should return error for invalid sender","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":983,"column":48},"line":983,"code":"      it('should return error for invalid sender', function (done) {\n        client.send({\n          from: 'test@invalid.sender',\n          to: 'test@valid.recipient'\n        }, 'test', function (err) {\n          expect(err).to.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send message string","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":992,"column":36},"line":992,"code":"      it('should send message string', function (done) {\n        let chunks = [],\n            message = new Array(1024).join('teretere, vana kere\\n');\n        server.on('data', function (connection, chunk) {\n          chunks.push(chunk);\n        });\n        server.removeAllListeners('dataReady');\n        server.on('dataReady', function (connection, callback) {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n'));\n          callback(null, 'ABC1');\n        });\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message, function (err) {\n          expect(err).to.not.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send message buffer","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":1012,"column":36},"line":1012,"code":"      it('should send message buffer', function (done) {\n        let chunks = [],\n            message = Buffer.from(new Array(1024).join('teretere, vana kere\\n'));\n        server.on('data', function (connection, chunk) {\n          chunks.push(chunk);\n        });\n        server.removeAllListeners('dataReady');\n        server.on('dataReady', function (connection, callback) {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.toString().trim().replace(/\\n/g, '\\r\\n'));\n          callback(null, 'ABC1');\n        });\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message, function (err) {\n          expect(err).to.not.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"should send message stream","suites":["SMTP-Connection Tests","Login tests","Send messages"],"updatePoint":{"line":1032,"column":36},"line":1032,"code":"      it('should send message stream', function (done) {\n        let chunks = [],\n            fname = __dirname + '/../../LICENSE',\n            message = fs.readFileSync(fname, 'utf-8');\n        server.on('data', function (connection, chunk) {\n          chunks.push(chunk);\n        });\n        server.removeAllListeners('dataReady');\n        server.on('dataReady', function (connection, callback) {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.toString().trim().replace(/\\n/g, '\\r\\n'));\n          callback(null, 'ABC1');\n        });\n        client.send({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, fs.createReadStream(fname), function (err) {\n          expect(err).to.not.exist;\n          done();\n        });\n      });","file":"smtp-connection/smtp-connection-test.js","skipped":false,"dir":"test"},{"name":"Should expose version number","suites":["SMTP Pool Tests"],"updatePoint":{"line":109,"column":34},"line":109,"code":"  it('Should expose version number', function () {\n    let pool = new SMTPPool();\n    expect(pool.name).to.exist;\n    expect(pool.version).to.exist;\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"Should detect wellknown data","suites":["SMTP Pool Tests"],"updatePoint":{"line":114,"column":34},"line":114,"code":"  it('Should detect wellknown data', function () {\n    let pool = new SMTPPool({\n      service: 'google mail'\n    });\n    expect(pool.options.host).to.equal('smtp.gmail.com');\n    expect(pool.options.port).to.equal(465);\n    expect(pool.options.secure).to.be.true;\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should send mail","suites":["SMTP Pool Tests"],"updatePoint":{"line":122,"column":22},"line":122,"code":"  it('should send mail', function (done) {\n    let pool = new SMTPPool({\n      port: PORT_NUMBER,\n      auth: {\n        user: 'testuser',\n        pass: 'testpass'\n      },\n      logger: false,\n      debug: true\n    });\n    let message = new Array(1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    pool.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: 'test@valid.recipient'\n      }, message)\n    }, function (err) {\n      expect(err).to.not.exist;\n      pool.close();\n      done();\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should send multiple mails","suites":["SMTP Pool Tests"],"updatePoint":{"line":158,"column":32},"line":158,"code":"  it('should send multiple mails', function (done) {\n    let pool = new SMTPPool('smtp://testuser:testpass@localhost:' + PORT_NUMBER + '/?logger=false');\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        callback();\n      });\n    }\n\n    let total = 100;\n    let returned = 0;\n\n    let cb = function () {\n      let sent = 0;\n\n      if (++returned === total) {\n        expect(pool._connections.length).to.be.above(1);\n\n        pool._connections.forEach(function (conn) {\n          expect(conn.messages).to.be.above(1);\n          sent += conn.messages;\n        });\n\n        expect(sent).to.be.equal(total);\n        pool.close();\n        return done();\n      }\n    };\n\n    for (let i = 0; i < total; i++) {\n      sendMessage(cb);\n    }\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should tolerate connection errors","suites":["SMTP Pool Tests"],"updatePoint":{"line":211,"column":39},"line":211,"code":"  it('should tolerate connection errors', function (done) {\n    let pool = new SMTPPool({\n      port: PORT_NUMBER,\n      auth: {\n        user: 'testuser',\n        pass: 'testpass'\n      },\n      logger: false\n    });\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    let c = 0;\n\n    function sendMessage(callback) {\n      let isErr = c++ % 2; // fail 50% of messages\n\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: isErr ? 'test@invalid.sender' : 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        if (isErr) {\n          expect(err).to.exist;\n        } else {\n          expect(err).to.not.exist;\n        }\n\n        callback();\n      });\n    }\n\n    let total = 100;\n    let returned = 0;\n\n    let cb = function () {\n      if (++returned === total) {\n        pool.close();\n        return done();\n      }\n    };\n\n    for (let i = 0; i < total; i++) {\n      sendMessage(cb);\n    }\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should tolerate idle connections and re-assign messages to other connections","suites":["SMTP Pool Tests"],"updatePoint":{"line":270,"column":82},"line":270,"code":"  it('should tolerate idle connections and re-assign messages to other connections', function (done) {\n    let pool = new SMTPPool({\n      port: PORT_NUMBER,\n      auth: {\n        user: 'testuser',\n        pass: 'testpass'\n      },\n      logger: false\n    });\n    let total = 20;\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n    let sentMessages = 0;\n    let killedConnections = false;\n\n    server.onData = function (stream, session, callback) {\n      let callCallback = true;\n      stream.on('data', function () {\n        // If we hit half the messages, simulate the server closing connections\n        // that are open for long time\n        if (!killedConnections && sentMessages === total / 2) {\n          killedConnections = true;\n          callCallback = false;\n          server.connections.forEach(function (connection) {\n            connection._socket.end();\n          });\n        }\n      });\n      stream.on('end', function () {\n        if (callCallback) {\n          sentMessages += 1;\n          return callback();\n        }\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        if (err) {\n          expect(err.message).to.equal('Connection closed unexpectedly');\n        }\n\n        callback();\n      });\n    } // Send 10 messages in a row.. then wait a bit and send 10 more\n    // When we wait a bit.. the server will kill the \"idle\" connections\n    // so that we can ensure the pool will handle it properly\n\n\n    let returned = 0;\n\n    let cb = function () {\n      returned++;\n\n      if (returned === total) {\n        pool.close();\n        return done();\n      } else if (returned === total / 2) {\n        setTimeout(sendHalfBulk, 1500);\n      }\n    };\n\n    function sendHalfBulk() {\n      for (let i = 0; i < total / 2; i++) {\n        sendMessage(cb);\n      }\n    }\n\n    sendHalfBulk();\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should call back with connection errors to senders having messages in flight","suites":["SMTP Pool Tests"],"updatePoint":{"line":345,"column":82},"line":345,"code":"  it('should call back with connection errors to senders having messages in flight', function (done) {\n    let pool = new SMTPPool({\n      maxConnections: 1,\n      socketTimeout: 200,\n      port: PORT_NUMBER,\n      auth: {\n        user: 'testuser',\n        pass: 'testpass'\n      },\n      logger: false\n    });\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n    pool.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: 'test@valid.recipient'\n      }, message)\n    }, function (err) {\n      expect(err).not.to.exist;\n    });\n    pool.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: 'test+timeout@valid.recipient'\n      }, message)\n    }, function (err) {\n      expect(err).to.exist;\n      pool.close();\n      done();\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should not send more then allowed for one connection","suites":["SMTP Pool Tests"],"updatePoint":{"line":378,"column":58},"line":378,"code":"  it('should not send more then allowed for one connection', function (done) {\n    let pool = new SMTPPool('smtp://testuser:testpass@localhost:' + PORT_NUMBER + '/?maxConnections=1&maxMessages=5&logger=false');\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        callback();\n      });\n    }\n\n    let total = 100;\n    let returned = 0;\n\n    let cb = function () {\n      if (++returned === total) {\n        expect(pool._connections.length).to.be.equal(1);\n        expect(pool._connections[0].messages).to.be.below(6);\n        pool.close();\n        return done();\n      }\n    };\n\n    for (let i = 0; i < total; i++) {\n      sendMessage(cb);\n    }\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should send multiple mails with rate limit","suites":["SMTP Pool Tests"],"updatePoint":{"line":423,"column":48},"line":423,"code":"  it('should send multiple mails with rate limit', function (done) {\n    let pool = new SMTPPool({\n      port: PORT_NUMBER,\n      auth: {\n        user: 'testuser',\n        pass: 'testpass'\n      },\n      maxConnections: 10,\n      rateLimit: 200,\n      // 200 messages in sec, so sending 5000 messages should take at least 24 seconds and probably under 25 sec\n      logger: false\n    });\n    let message = 'teretere, vana kere\\n';\n    let startTime = Date.now();\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        callback();\n      });\n    }\n\n    let total = 5000;\n    let returned = 0;\n\n    let cb = function () {\n      if (++returned === total) {\n        let endTime = Date.now();\n        expect(endTime - startTime).to.be.at.least(24000);\n        pool.close();\n        return done();\n      }\n    };\n\n    let i = 0;\n\n    let send = function () {\n      if (i++ >= total) {\n        return;\n      }\n\n      sendMessage(cb);\n      setImmediate(send);\n    };\n\n    send();\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should return pending messages once closed","suites":["SMTP Pool Tests"],"updatePoint":{"line":488,"column":48},"line":488,"code":"  it('should return pending messages once closed', function (done) {\n    let pool = new SMTPPool('smtp://testuser:testpass@localhost:' + PORT_NUMBER + '/?maxConnections=1&logger=false');\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.exist;\n        callback();\n      });\n    }\n\n    let total = 100;\n    let returned = 0;\n\n    let cb = function () {\n      if (++returned === total) {\n        return done();\n      }\n    };\n\n    for (let i = 0; i < total; i++) {\n      sendMessage(cb);\n    }\n\n    pool.close();\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"should emit idle for free slots in the pool","suites":["SMTP Pool Tests"],"updatePoint":{"line":532,"column":49},"line":532,"code":"  it('should emit idle for free slots in the pool', function (done) {\n    let pool = new SMTPPool('smtp://testuser:testpass@localhost:' + PORT_NUMBER + '/?logger=false');\n    let message = new Array(10 * 1024).join('teretere, vana kere\\n');\n\n    server.onData = function (stream, session, callback) {\n      let chunks = [];\n      stream.on('data', function (chunk) {\n        chunks.push(chunk);\n      });\n      stream.on('end', function () {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n        callback();\n      });\n    };\n\n    function sendMessage(callback) {\n      pool.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, callback);\n    }\n\n    let total = 100;\n    let returned = 0;\n\n    let cb = function () {\n      if (++returned === total) {\n        pool.close();\n        return done();\n      }\n    };\n\n    let i = 0;\n    pool.on('idle', function () {\n      setTimeout(function () {\n        while (i < total && pool.isIdle()) {\n          i++;\n          sendMessage(cb);\n        }\n\n        if (i > 50) {\n          // kill all connections. We should still end up with the same amount of callbacks\n          setImmediate(function () {\n            for (let j = 5 - 1; j >= 0; j--) {\n              if (pool._connections[j] && pool._connections[j].connection) {\n                pool._connections[j].connection._socket.emit('error', new Error('TESTERROR'));\n              }\n            }\n          });\n        }\n      }, 1000);\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"Should login and send mail using proxied socket","suites":["SMTP Pool Tests"],"updatePoint":{"line":589,"column":53},"line":589,"code":"  it('Should login and send mail using proxied socket', function (done) {\n    let pool = new SMTPPool({\n      url: 'smtp:testuser:testpass@www.example.com:1234',\n      logger: false,\n\n      getSocket(options, callback) {\n        let socket = net.connect(PORT_NUMBER, 'localhost');\n\n        let errHandler = function (err) {\n          callback(err);\n        };\n\n        socket.on('error', errHandler);\n        socket.on('connect', function () {\n          socket.removeListener('error', errHandler);\n          callback(null, {\n            connection: socket\n          });\n        });\n      }\n\n    });\n    let chunks = [],\n        message = new Array(1024).join('teretere, vana kere\\n');\n    server.on('data', function (connection, chunk) {\n      chunks.push(chunk);\n    });\n    server.on('dataReady', function (connection, callback) {\n      let body = Buffer.concat(chunks);\n      expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n') + '\\r\\n');\n      callback(null, true);\n    });\n    pool.send({\n      data: {},\n      message: new MockBuilder({\n        from: 'test@valid.sender',\n        to: 'test@valid.recipient'\n      }, message)\n    }, function (err) {\n      expect(err).to.not.exist;\n      pool.close();\n      return done();\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"Should verify connection with success","suites":["SMTP Pool Tests"],"updatePoint":{"line":633,"column":43},"line":633,"code":"  it('Should verify connection with success', function (done) {\n    let client = new SMTPPool({\n      url: 'smtp:testuser:testpass@localhost:' + PORT_NUMBER,\n      logger: false\n    });\n    client.verify(function (err, success) {\n      expect(err).to.not.exist;\n      expect(success).to.be.true;\n      client.close();\n      done();\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"Should not verify connection","suites":["SMTP Pool Tests"],"updatePoint":{"line":645,"column":34},"line":645,"code":"  it('Should not verify connection', function (done) {\n    let client = new SMTPPool({\n      url: 'smtp:testuser:testpass@localhost:999' + PORT_NUMBER,\n      logger: false\n    });\n    client.verify(function (err) {\n      expect(err).to.exist;\n      client.close();\n      done();\n    });\n  });","file":"smtp-pool/smtp-pool-test.js","skipped":false,"dir":"test"},{"name":"Should expose version number","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":123,"column":36},"line":123,"code":"    it('Should expose version number', function () {\n      let client = new SMTPTransport();\n      expect(client.name).to.exist;\n      expect(client.version).to.exist;\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should detect wellknown data","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":128,"column":36},"line":128,"code":"    it('Should detect wellknown data', function () {\n      let client = new SMTPTransport({\n        service: 'google mail',\n        logger: false\n      });\n      expect(client.options.host).to.equal('smtp.gmail.com');\n      expect(client.options.port).to.equal(465);\n      expect(client.options.secure).to.be.true;\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should fail envelope","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":137,"column":28},"line":137,"code":"    it('Should fail envelope', function (done) {\n      let client = new SMTPTransport({\n        port: PORT_NUMBER,\n        logger: false\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@invalid.sender',\n          to: 'test@valid.recipient'\n        }, 'test')\n      }, function (err) {\n        expect(err.code).to.equal('EENVELOPE');\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should not fail auth","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":153,"column":28},"line":153,"code":"    it('Should not fail auth', function (done) {\n      let client = new SMTPTransport({\n        port: PORT_NUMBER,\n        auth: {\n          user: 'zzz'\n        },\n        logger: false\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, 'message')\n      }, function (err) {\n        expect(err).to.not.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should fail auth if forceAuth=true","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":172,"column":42},"line":172,"code":"    it('Should fail auth if forceAuth=true', function (done) {\n      let client = new SMTPTransport({\n        port: PORT_NUMBER,\n        auth: {\n          user: 'zzz'\n        },\n        forceAuth: true,\n        logger: false\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, 'message')\n      }, function (err) {\n        expect(err.code).to.equal('EAUTH');\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should send mail","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":192,"column":24},"line":192,"code":"    it('Should send mail', function (done) {\n      let client = new SMTPTransport('smtp:localhost:' + PORT_NUMBER + '?logger=false');\n      let chunks = [],\n          message = new Array(1024).join('teretere, vana kere\\n');\n      server.on('data', function (connection, chunk) {\n        chunks.push(chunk);\n      });\n      server.on('dataReady', function (connection, callback) {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n'));\n        callback(null, true);\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should recover unexpeced close during transmission","suites":["SMTP Transport Tests","Anonymous sender tests"],"updatePoint":{"line":215,"column":58},"line":215,"code":"    it('Should recover unexpeced close during transmission', function (done) {\n      let client = new SMTPTransport('smtp:localhost:' + (PORT_NUMBER + 1) + '?logger=false');\n      let chunks = [],\n          message = new Array(1024).join('teretere, vana kere\\n');\n      server.on('data', function (connection, chunk) {\n        chunks.push(chunk);\n      });\n      server.on('dataReady', function (connection, callback) {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n'));\n        callback(null, true);\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should login and send mail","suites":["SMTP Transport Tests","Authenticated sender tests"],"updatePoint":{"line":294,"column":34},"line":294,"code":"    it('Should login and send mail', function (done) {\n      let client = new SMTPTransport({\n        url: 'smtp:testuser:testpass@localhost:' + PORT_NUMBER,\n        logger: false\n      });\n      let chunks = [],\n          message = new Array(1024).join('teretere, vana kere\\n');\n      server.on('data', function (connection, chunk) {\n        chunks.push(chunk);\n      });\n      server.on('dataReady', function (connection, callback) {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n'));\n        callback(null, true);\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should verify connection with success","suites":["SMTP Transport Tests","Authenticated sender tests"],"updatePoint":{"line":320,"column":45},"line":320,"code":"    it('Should verify connection with success', function (done) {\n      let client = new SMTPTransport({\n        url: 'smtp:testuser:testpass@localhost:' + PORT_NUMBER,\n        logger: false\n      });\n      client.verify(function (err, success) {\n        expect(err).to.not.exist;\n        expect(success).to.be.true;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should not verify connection","suites":["SMTP Transport Tests","Authenticated sender tests"],"updatePoint":{"line":331,"column":36},"line":331,"code":"    it('Should not verify connection', function (done) {\n      let client = new SMTPTransport({\n        url: 'smtp:testuser:testpass@localhost:999' + PORT_NUMBER,\n        logger: false\n      });\n      client.verify(function (err) {\n        expect(err).to.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should login and send mail using proxied socket","suites":["SMTP Transport Tests","Authenticated sender tests"],"updatePoint":{"line":341,"column":55},"line":341,"code":"    it('Should login and send mail using proxied socket', function (done) {\n      let client = new SMTPTransport({\n        url: 'smtp:testuser:testpass@www.example.com:1234',\n        logger: false,\n\n        getSocket(options, callback) {\n          let socket = net.connect(PORT_NUMBER, 'localhost');\n\n          let errHandler = function (err) {\n            callback(err);\n          };\n\n          socket.on('error', errHandler);\n          socket.on('connect', function () {\n            socket.removeListener('error', errHandler);\n            callback(null, {\n              connection: socket\n            });\n          });\n        }\n\n      });\n      let chunks = [],\n          message = new Array(1024).join('teretere, vana kere\\n');\n      server.on('data', function (connection, chunk) {\n        chunks.push(chunk);\n      });\n      server.on('dataReady', function (connection, callback) {\n        let body = Buffer.concat(chunks);\n        expect(body.toString()).to.equal(message.trim().replace(/\\n/g, '\\r\\n'));\n        callback(null, true);\n      });\n      client.send({\n        data: {},\n        message: new MockBuilder({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient'\n        }, message)\n      }, function (err) {\n        expect(err).to.not.exist;\n        done();\n      });\n    });","file":"smtp-transport/smtp-tranport-test.js","skipped":false,"dir":"test"},{"name":"Should expose version number","suites":["Stream Transport Tests"],"updatePoint":{"line":18,"column":34},"line":18,"code":"  it('Should expose version number', function () {\n    let client = new StreamTransport();\n    expect(client.name).to.exist;\n    expect(client.version).to.exist;\n  });","file":"stream-transport/stream-transport-test.js","skipped":false,"dir":"test"},{"name":"Should send mail using unix newlines","suites":["Stream Transport Tests","Send as stream"],"updatePoint":{"line":24,"column":44},"line":24,"code":"    it('Should send mail using unix newlines', function (done) {\n      let client = new StreamTransport();\n      let chunks = [],\n          message = new Array(100).join('teretere\\r\\nvana kere\\r\\n');\n      client.send({\n        data: {},\n        message: new MailComposer({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient',\n          newline: '\\n',\n          raw: Buffer.from(message)\n        }).compile()\n      }, function (err, info) {\n        expect(err).to.not.exist;\n        expect(info.envelope).to.deep.equal({\n          from: 'test@valid.sender',\n          to: ['test@valid.recipient']\n        });\n        info.message.on('data', function (chunk) {\n          chunks.push(chunk);\n        });\n        info.message.on('end', function () {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.replace(/\\r\\n/g, '\\n'));\n          done();\n        });\n      });\n    });","file":"stream-transport/stream-transport-test.js","skipped":false,"dir":"test"},{"name":"Should send mail using windows newlines","suites":["Stream Transport Tests","Send as stream"],"updatePoint":{"line":52,"column":47},"line":52,"code":"    it('Should send mail using windows newlines', function (done) {\n      let client = new StreamTransport({\n        newline: 'windows'\n      });\n      let chunks = [],\n          message = new Array(100).join('teretere\\nvana kere\\n');\n      client.send({\n        data: {},\n        message: new MailComposer({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient',\n          newline: '\\r\\n',\n          raw: Buffer.from(message)\n        }).compile()\n      }, function (err, info) {\n        expect(err).to.not.exist;\n        info.message.on('data', function (chunk) {\n          chunks.push(chunk);\n        });\n        info.message.on('end', function () {\n          let body = Buffer.concat(chunks);\n          expect(body.toString()).to.equal(message.replace(/\\n/g, '\\r\\n'));\n          done();\n        });\n      });\n    });","file":"stream-transport/stream-transport-test.js","skipped":false,"dir":"test"},{"name":"Should send mail using unix newlines","suites":["Stream Transport Tests","Send as buffer"],"updatePoint":{"line":80,"column":44},"line":80,"code":"    it('Should send mail using unix newlines', function (done) {\n      let client = new StreamTransport({\n        buffer: true\n      });\n      let message = new Array(100).join('teretere\\r\\nvana kere\\r\\n');\n      client.send({\n        data: {},\n        message: new MailComposer({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient',\n          newline: '\\n',\n          raw: Buffer.from(message)\n        }).compile()\n      }, function (err, info) {\n        expect(err).to.not.exist;\n        expect(info.message.toString()).to.equal(message.replace(/\\r\\n/g, '\\n'));\n        done();\n      });\n    });","file":"stream-transport/stream-transport-test.js","skipped":false,"dir":"test"},{"name":"Should send mail using windows newlines","suites":["Stream Transport Tests","Send as buffer"],"updatePoint":{"line":99,"column":47},"line":99,"code":"    it('Should send mail using windows newlines', function (done) {\n      let client = new StreamTransport({\n        newline: 'windows',\n        buffer: true\n      });\n      let message = new Array(100).join('teretere\\nvana kere\\n');\n      client.send({\n        data: {},\n        message: new MailComposer({\n          from: 'test@valid.sender',\n          to: 'test@valid.recipient',\n          newline: '\\r\\n',\n          raw: Buffer.from(message)\n        }).compile()\n      }, function (err, info) {\n        expect(err).to.not.exist;\n        expect(info.message.toString()).to.equal(message.replace(/\\n/g, '\\r\\n'));\n        done();\n      });\n    });","file":"stream-transport/stream-transport-test.js","skipped":false,"dir":"test"},{"name":"Should find by key","suites":["Well-Known Services Tests","#wellKnown"],"updatePoint":{"line":15,"column":26},"line":15,"code":"    it('Should find by key', function () {\n      expect(wellKnown('Gmail')).to.deep.equal({\n        host: 'smtp.gmail.com',\n        port: 465,\n        secure: true\n      });\n    });","file":"well-known/well-known-test.js","skipped":false,"dir":"test"},{"name":"Should find by alias","suites":["Well-Known Services Tests","#wellKnown"],"updatePoint":{"line":22,"column":28},"line":22,"code":"    it('Should find by alias', function () {\n      expect(wellKnown('Google Mail')).to.deep.equal({\n        host: 'smtp.gmail.com',\n        port: 465,\n        secure: true\n      });\n    });","file":"well-known/well-known-test.js","skipped":false,"dir":"test"},{"name":"Should find by domain","suites":["Well-Known Services Tests","#wellKnown"],"updatePoint":{"line":29,"column":29},"line":29,"code":"    it('Should find by domain', function () {\n      expect(wellKnown('GoogleMail.com')).to.deep.equal({\n        host: 'smtp.gmail.com',\n        port: 465,\n        secure: true\n      });\n    });","file":"well-known/well-known-test.js","skipped":false,"dir":"test"},{"name":"Should find no match","suites":["Well-Known Services Tests","#wellKnown"],"updatePoint":{"line":36,"column":28},"line":36,"code":"    it('Should find no match', function () {\n      expect(wellKnown('zzzzzz')).to.be.false;\n    });","file":"well-known/well-known-test.js","skipped":false,"dir":"test"},{"name":"should get an existing access token","suites":["XOAuth2 tests"],"updatePoint":{"line":33,"column":41},"line":33,"code":"  it('should get an existing access token', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      accessToken: 'abc',\n      timeout: 3600\n    });\n    xoauth2.getToken(false, function (err, accessToken) {\n      expect(err).to.not.exist;\n      expect(accessToken).to.equal('abc');\n      done();\n    });\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should convert access token to XOAuth2 token","suites":["XOAuth2 tests"],"updatePoint":{"line":49,"column":50},"line":49,"code":"  it('should convert access token to XOAuth2 token', function () {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      accessToken: 'abc'\n    });\n    expect(xoauth2.buildXOAuth2Token()).to.equal('dXNlcj10ZXN0QGV4YW1wbGUuY29tAWF1dGg9QmVhcmVyIGFiYwEB');\n    expect(xoauth2.buildXOAuth2Token('bbb')).to.equal('dXNlcj10ZXN0QGV4YW1wbGUuY29tAWF1dGg9QmVhcmVyIGJiYgEB');\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should get an existing access token, no timeout","suites":["XOAuth2 tests"],"updatePoint":{"line":57,"column":53},"line":57,"code":"  it('should get an existing access token, no timeout', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      accessToken: 'abc'\n    });\n    xoauth2.getToken(false, function (err, accessToken) {\n      expect(err).to.not.exist;\n      expect(accessToken).to.equal('abc');\n      done();\n    });\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should generate a fresh access token","suites":["XOAuth2 tests"],"updatePoint":{"line":72,"column":42},"line":72,"code":"  it('should generate a fresh access token', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      timeout: 3600\n    });\n    xoauth2.getToken(false, function (err, accessToken) {\n      expect(err).to.not.exist;\n      expect(accessToken).to.equal(users['test@example.com']);\n      done();\n    });\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should generate a fresh access token with custom method","suites":["XOAuth2 tests"],"updatePoint":{"line":87,"column":61},"line":87,"code":"  it('should generate a fresh access token with custom method', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      timeout: 3600,\n      provisionCallback: (user, renew, cb) => {\n        cb(null, 'zzz');\n      }\n    });\n    xoauth2.getToken(false, function (err, accessToken) {\n      expect(err).to.not.exist;\n      expect(accessToken).to.equal('zzz');\n      done();\n    });\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should fail generating a fresh access token with custom method","suites":["XOAuth2 tests"],"updatePoint":{"line":105,"column":68},"line":105,"code":"  it('should fail generating a fresh access token with custom method', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      timeout: 3600,\n      provisionCallback: (user, renew, cb) => {\n        cb(new Error('fail'));\n      }\n    });\n    xoauth2.getToken(false, function (err, accessToken) {\n      expect(err).to.exist;\n      expect(accessToken).to.not.exist;\n      done();\n    });\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should generate a fresh access token after timeout","suites":["XOAuth2 tests"],"updatePoint":{"line":123,"column":56},"line":123,"code":"  it('should generate a fresh access token after timeout', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      accessToken: 'abc',\n      timeout: 1\n    });\n    setTimeout(function () {\n      xoauth2.getToken(false, function (err, accessToken) {\n        expect(err).to.not.exist;\n        expect(accessToken).to.equal(users['test@example.com']);\n        done();\n      });\n    }, 3000);\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should emit access token update","suites":["XOAuth2 tests"],"updatePoint":{"line":141,"column":37},"line":141,"code":"  it('should emit access token update', function (done) {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      clientId: '{Client ID}',\n      clientSecret: '{Client Secret}',\n      refreshToken: 'saladus',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      timeout: 3600\n    });\n    xoauth2.once('token', function (tokenData) {\n      expect(tokenData.expires).to.be.gte(Date.now() + 3000 * 1000);\n      expect(tokenData).to.deep.equal({\n        user: 'test@example.com',\n        accessToken: users['test@example.com'],\n        expires: tokenData.expires\n      });\n      done();\n    });\n    xoauth2.getToken(false, function () {});\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"},{"name":"should sign payload","suites":["XOAuth2 tests"],"updatePoint":{"line":161,"column":25},"line":161,"code":"  it('should sign payload', function () {\n    let xoauth2 = new XOAuth2({\n      user: 'test@example.com',\n      serviceClient: '{Client ID}',\n      accessUrl: 'http://localhost:' + XOAUTH_PORT + '/',\n      timeout: 3600,\n      privateKey: '-----BEGIN RSA PRIVATE KEY-----\\n' + 'MIIEpAIBAAKCAQEA6Z5Qqhw+oWfhtEiMHE32Ht94mwTBpAfjt3vPpX8M7DMCTwHs\\n' + '1xcXvQ4lQ3rwreDTOWdoJeEEy7gMxXqH0jw0WfBx+8IIJU69xstOyT7FRFDvA1yT\\n' + 'RXY2yt9K5s6SKken/ebMfmZR+03ND4UFsDzkz0FfgcjrkXmrMF5Eh5UXX/+9YHeU\\n' + 'xlp0gMAt+/SumSmgCaysxZLjLpd4uXz+X+JVxsk1ACg1NoEO7lWJC/3WBP7MIcu2\\n' + 'wVsMd2XegLT0gWYfT1/jsIH64U/mS/SVXC9QhxMl9Yfko2kx1OiYhDxhHs75RJZh\\n' + 'rNRxgfiwgSb50Gw4NAQaDIxr/DJPdLhgnpY6UQIDAQABAoIBAE+tfzWFjJbgJ0ql\\n' + 's6Ozs020Sh4U8TZQuonJ4HhBbNbiTtdDgNObPK1uNadeNtgW5fOeIRdKN6iDjVeN\\n' + 'AuXhQrmqGDYVZ1HSGUfD74sTrZQvRlWPLWtzdhybK6Css41YAyPFo9k4bJ2ZW2b/\\n' + 'p4EEQ8WsNja9oBpttMU6YYUchGxo1gujN8hmfDdXUQx3k5Xwx4KA68dveJ8GasIt\\n' + 'd+0Jd/FVwCyyx8HTiF1FF8QZYQeAXxbXJgLBuCsMQJghlcpBEzWkscBR3Ap1U0Zi\\n' + '4oat8wrPZGCblaA6rNkRUVbc/+Vw0stnuJ/BLHbPxyBs6w495yBSjBqUWZMvljNz\\n' + 'm9/aK0ECgYEA9oVIVAd0enjSVIyAZNbw11ElidzdtBkeIJdsxqhmXzeIFZbB39Gd\\n' + 'bjtAVclVbq5mLsI1j22ER2rHA4Ygkn6vlLghK3ZMPxZa57oJtmL3oP0RvOjE4zRV\\n' + 'dzKexNGo9gU/x9SQbuyOmuauvAYhXZxeLpv+lEfsZTqqrvPUGeBiEQcCgYEA8poG\\n' + 'WVnykWuTmCe0bMmvYDsWpAEiZnFLDaKcSbz3O7RMGbPy1cypmqSinIYUpURBT/WY\\n' + 'wVPAGtjkuTXtd1Cy58m7PqziB7NNWMcsMGj+lWrTPZ6hCHIBcAImKEPpd+Y9vGJX\\n' + 'oatFJguqAGOz7rigBq6iPfeQOCWpmprNAuah++cCgYB1gcybOT59TnA7mwlsh8Qf\\n' + 'bm+tSllnin2A3Y0dGJJLmsXEPKtHS7x2Gcot2h1d98V/TlWHe5WNEUmx1VJbYgXB\\n' + 'pw8wj2ACxl4ojNYqWPxegaLd4DpRbtW6Tqe9e47FTnU7hIggR6QmFAWAXI+09l8y\\n' + 'amssNShqjE9lu5YDi6BTKwKBgQCuIlKGViLfsKjrYSyHnajNWPxiUhIgGBf4PI0T\\n' + '/Jg1ea/aDykxv0rKHnw9/5vYGIsM2st/kR7l5mMecg/2Qa145HsLfMptHo1ZOPWF\\n' + '9gcuttPTegY6aqKPhGthIYX2MwSDMM+X0ri6m0q2JtqjclAjG7yG4CjbtGTt/UlE\\n' + 'WMlSZwKBgQDslGeLUnkW0bsV5EG3AKRUyPKz/6DVNuxaIRRhOeWVKV101claqXAT\\n' + 'wXOpdKrvkjZbT4AzcNrlGtRl3l7dEVXTu+dN7/ZieJRu7zaStlAQZkIyP9O3DdQ3\\n' + 'rIcetQpfrJ1cAqz6Ng0pD0mh77vQ13WG1BBmDFa2A9BuzLoBituf4g==\\n' + '-----END RSA PRIVATE KEY-----'\n    });\n    expect(xoauth2.jwtSignRS256({\n      some: 'payload'\n    })).to.equal('eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJzb21lIjoicGF5bG9hZCJ9.yBo28P5qE8t8yMkN0hC6uWstUAGh8RGW-zLe1NHdtit8ZVlAEdnhXbZvjGEfDWjOeWe1aZ2eZ65i83awWsx02G9HDsI1xMOFTHpviSHLIWnOf1D2hqJxm0On9zYRjd6oFxuRlmJtI9PIDlMJltG7K3leqReLLC6ZOAYL1Au0WY5swdG2eA6Oi83BTEckLj9c-0TYYRYtyRSG9o298Iuc8JL2KhrAbM8d62JgAPuI3hN_NgEtxs36bidt3SHbuWSszAdt1lHR-bFCZ-kXy_DAGlGiYRHRNyvsLR_q_v4GhV2oVi3WSPR816UhHrTryA0NlbanACb8T22bJGRQ708m_g');\n  });","file":"xoauth2/xoauth2-test.js","skipped":false,"dir":"test"}]}